"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[710],{7102:(mn,Qe,M)=>{M.d(Qe,{ST:()=>W0});var v=M(5e3),F=M(4986),y=M(8306),ie=M(8996),me=M(9646),ue=M(2122),z=M(4482),Re=M(5403);function Pe(){return(0,z.e)((n,e)=>{let t,i=!1;n.subscribe((0,Re.x)(e,r=>{const s=t;t=r,i&&e.next([s,r]),i=!0}))})}var E,be=M(8675),ge=M(4004),re=M(5026),Ee=M(1884),fe=M(9300),Se=M(2011),d=M(9808),xe=(M(9169),M(3942)),R=M(5861),Ue=M(9681),Ae=M(4859),Ie=M(1877),J=M(2090),Ve="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},X={},he=he||{},ee=Ve||self;function Rt(){}function We(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Nt(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var ft="closure_uid_"+(1e9*Math.random()>>>0),Zt=0;function xn(n,e,t){return n.call.apply(n.bind,arguments)}function jn(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function $e(n,e,t){return($e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?xn:jn).apply(null,arguments)}function Je(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Oe(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,r,s){for(var u=Array(arguments.length-2),h=2;h<arguments.length;h++)u[h-2]=arguments[h];return e.prototype[r].apply(i,u)}}function Tt(){this.s=this.s,this.o=this.o}Tt.prototype.s=!1,Tt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function zn(n){Object.prototype.hasOwnProperty.call(n,ft)&&n[ft]||(n[ft]=++Zt)}(this)},Tt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Jt=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function G(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function $(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(We(i)){const r=n.length||0,s=i.length||0;n.length=r+s;for(let u=0;u<s;u++)n[r+u]=i[u]}else n.push(i)}}function C(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}C.prototype.h=function(){this.defaultPrevented=!0};var S=function(){if(!ee.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{ee.addEventListener("test",Rt,e),ee.removeEventListener("test",Rt,e)}catch(t){}return n}();function q(n){return/^[\s\xa0]*$/.test(n)}var w=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function L(n,e){return n<e?-1:n>e?1:0}function T(){var n=ee.navigator;return n&&(n=n.userAgent)?n:""}function O(n){return-1!=T().indexOf(n)}function b(n){return b[" "](n),n}b[" "]=Rt;var ms,n,W=O("Opera"),te=O("Trident")||O("MSIE"),ae=O("Edge"),Mt=ae||te,Kn=O("Gecko")&&!(-1!=T().toLowerCase().indexOf("webkit")&&!O("Edge"))&&!(O("Trident")||O("MSIE"))&&!O("Edge"),lr=-1!=T().toLowerCase().indexOf("webkit")&&!O("Edge");function Vl(){var n=ee.document;return n?n.documentMode:void 0}e:{var hr="",dr=(n=T(),Kn?/rv:([^\);]+)(\)|;)/.exec(n):ae?/Edge\/([\d\.]+)/.exec(n):te?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):lr?/WebKit\/(\S+)/.exec(n):W?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(dr&&(hr=dr?dr[1]:""),te){var Ii=Vl();if(null!=Ii&&Ii>parseFloat(hr)){ms=String(Ii);break e}}ms=hr}var Bl={};var Zl=ee.document&&te&&(Vl()||parseInt(ms,10))||void 0;function wi(n,e){if(C.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Kn){e:{try{b(e.nodeName);var r=!0;break e}catch(s){}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:pr[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&wi.X.h.call(this)}}Oe(wi,C);var pr={2:"touch",3:"pen",4:"mouse"};wi.prototype.h=function(){wi.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var $n="closure_listenable_"+(1e6*Math.random()|0),ql=0;function zo(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=r,this.key=++ql,this.ba=this.ea=!1}function gs(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function jo(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function Ou(n){const e={};for(const t in n)e[t]=n[t];return e}const _s="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Ei(n,e){let t,i;for(let r=1;r<arguments.length;r++){for(t in i=arguments[r],i)n[t]=i[t];for(let s=0;s<_s.length;s++)t=_s[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function zt(n){this.src=n,this.g={},this.h=0}function _n(n,e){var t=e.type;if(t in n.g){var s,i=n.g[t],r=Jt(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(gs(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Nu(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==i)return r}return-1}zt.prototype.add=function(n,e,t,i,r){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=Nu(n,e,i,r);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new zo(e,this.src,s,!!i,r)).ea=t,n.push(e)),e};var An="closure_lm_"+(1e6*Math.random()|0),yn={};function Hn(n,e,t,i,r){if(i&&i.once)return ys(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)Hn(n,e[s],t,i,r);return null}return t=Ho(t),n&&n[$n]?n.N(e,t,Nt(i)?!!i.capture:!!i,r):Ko(n,e,t,!1,i,r)}function Ko(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var u=Nt(r)?!!r.capture:!!r,h=Is(n);if(h||(n[An]=h=new zt(n)),(t=h.add(e,t,i,u,s)).proxy)return t;if(i=function Mu(){const e=Pu;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)S||(r=u),void 0===r&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(Ti(e.toString()),i);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(i)}return t}function ys(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ys(n,e[s],t,i,r);return null}return t=Ho(t),n&&n[$n]?n.O(e,t,Nt(i)?!!i.capture:!!i,r):Ko(n,e,t,!0,i,r)}function $o(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)$o(n,e[s],t,i,r);else i=Nt(i)?!!i.capture:!!i,t=Ho(t),n&&n[$n]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Nu(s=n.g[e],t,i,r))&&(gs(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=Is(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Nu(e,t,i,r)),(t=-1<n?e[n]:null)&&vs(t))}function vs(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[$n])_n(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(Ti(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=Is(e))?(_n(t,n),0==t.h&&(t.src=null,e[An]=null)):gs(n)}}}function Ti(n){return n in yn?yn[n]:yn[n]="on"+n}function Pu(n,e){if(n.ba)n=!0;else{e=new wi(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&vs(n),n=t.call(i,e)}return n}function Is(n){return(n=n[An])instanceof zt?n:null}var kn="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ho(n){return"function"==typeof n?n:(n[kn]||(n[kn]=function(e){return n.handleEvent(e)}),n[kn])}function ct(){Tt.call(this),this.i=new zt(this),this.P=this,this.I=null}function pt(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,"string"==typeof e)e=new C(e,n);else if(e instanceof C)e.target=e.target||n;else{var r=e;Ei(e=new C(i,n),r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];r=mr(u,i,!0,e)&&r}if(r=mr(u=e.g=n,i,!0,e)&&r,r=mr(u,i,!1,e)&&r,t)for(s=0;s<t.length;s++)r=mr(u=e.g=t[s],i,!1,e)&&r}function mr(n,e,t,i){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var h=u.listener,f=u.ha||u.src;u.ea&&_n(n.i,u),r=!1!==h.call(f,i)&&r}}return r&&!i.defaultPrevented}Oe(ct,Tt),ct.prototype[$n]=!0,ct.prototype.removeEventListener=function(n,e,t,i){$o(this,n,e,t,i)},ct.prototype.M=function(){if(ct.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)gs(t[i]);delete n.g[e],n.h--}}this.I=null},ct.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)},ct.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};var Yo=ee.JSON.stringify;function Lu(){var n=Vu;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ws,Fu=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new lt,n=>n.reset());class lt{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function Uu(n){ee.setTimeout(()=>{throw n},0)}function Qo(n,e){ws||function Wl(){var n=ee.Promise.resolve(void 0);ws=function(){n.then(bi)}}(),Es||(ws(),Es=!0),Vu.add(n,e)}var Es=!1,Vu=new class Gl{constructor(){this.h=this.g=null}add(e,t){const i=Fu.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}};function bi(){for(var n;n=Lu();){try{n.h.call(n.g)}catch(t){Uu(t)}var e=Fu;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}Es=!1}function gr(n,e){ct.call(this),this.h=n||1,this.g=e||ee,this.j=$e(this.lb,this),this.l=Date.now()}function _r(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Ts(n,e,t){if("function"==typeof n)t&&(n=$e(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=$e(n.handleEvent,n)}return 2147483647<Number(e)?-1:ee.setTimeout(n,e||0)}function bs(n){n.g=Ts(()=>{n.g=null,n.i&&(n.i=!1,bs(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Oe(gr,ct),(E=gr.prototype).ca=!1,E.R=null,E.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),pt(this,"tick"),this.ca&&(_r(this),this.start()))}},E.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},E.M=function(){gr.X.M.call(this),_r(this),delete this.g};class zl extends Tt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:bs(this)}M(){super.M(),this.g&&(ee.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Yn(n){Tt.call(this),this.h=n,this.g={}}Oe(Yn,Tt);var Bu=[];function xs(n,e,t,i){Array.isArray(t)||(t&&(Bu[0]=t.toString()),t=Bu);for(var r=0;r<t.length;r++){var s=Hn(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function yr(n){jo(n.g,function(e,t){this.g.hasOwnProperty(t)&&vs(e)},n),n.g={}}function xi(){this.g=!0}function Ai(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function Kl(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<r.length;u++)r[u]=""}}}return Yo(t)}catch(h){return e}}(n,t)+(i?" "+i:"")})}Yn.prototype.M=function(){Yn.X.M.call(this),yr(this)},Yn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},xi.prototype.Aa=function(){this.g=!1},xi.prototype.info=function(){};var vn={},Zu=null;function ki(){return Zu=Zu||new ct}function qu(n){C.call(this,vn.Pa,n)}function Qn(n){const e=ki();pt(e,new qu(e))}function Gu(n,e){C.call(this,vn.STAT_EVENT,n),this.stat=e}function mt(n){const e=ki();pt(e,new Gu(e,n))}function Ci(n,e){C.call(this,vn.Qa,n),this.size=e}function Pt(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return ee.setTimeout(function(){n()},e)}vn.Pa="serverreachability",Oe(qu,C),vn.STAT_EVENT="statevent",Oe(Gu,C),vn.Qa="timingevent",Oe(Ci,C);var Si={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},Wu={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function qt(){}function As(){}qt.prototype.h=null;var wr,vr={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function Ir(){C.call(this,"d")}function ea(){C.call(this,"c")}function ks(){}function Er(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new Yn(this),this.O=Jn,this.T=new gr(n=Mt?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Cs}function Cs(){this.i=null,this.g="",this.h=!1}Oe(Ir,C),Oe(ea,C),Oe(ks,qt),ks.prototype.g=function(){return new XMLHttpRequest},ks.prototype.i=function(){return{}},wr=new ks;var Jn=45e3,ta={},Ss={};function Xn(n,e,t){n.K=1,n.v=xr(tn(e)),n.s=t,n.P=!0,$l(n,null)}function $l(n,e){n.F=Date.now(),en(n),n.A=tn(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),ca(t.i,"t",i),n.C=0,t=n.l.H,n.h=new Cs,n.g=rh(n.l,t?e:null,!n.s),0<n.N&&(n.L=new zl($e(n.La,n,n.g),n.N)),xs(n.S,n.g,"readystatechange",n.ib),e=n.H?Ou(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Qn(),function jl(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var u="",h=s.split("&"),f=0;f<h.length;f++){var m=h[f].split("=");if(1<m.length){var _=m[0];m=m[1];var I=_.split("_");u=2<=I.length&&"type"==I[1]?u+(_+"=")+m+"&":u+(_+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Ds(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Xt(n,e,t){let r,i=!0;for(;!n.I&&n.C<t.length;){if(r=Di(n,t),r==Ss){4==e&&(n.o=4,mt(14),i=!1),Ai(n.j,n.m,null,"[Incomplete Response]");break}if(r==ta){n.o=4,mt(15),Ai(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}Ai(n.j,n.m,r,null),Cn(n,r)}Ds(n)&&r!=Ss&&r!=ta&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,mt(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),va(e),e.K=!0,mt(11))):(Ai(n.j,n.m,t,"[Invalid Chunked Response]"),ei(n),Ri(n))}function Di(n,e){var t=n.C,i=e.indexOf("\n",t);return-1==i?Ss:(t=Number(e.substring(t,i)),isNaN(t)?ta:(i+=1)+t>e.length?Ss:(e=e.substr(i,t),n.C=i+t,e))}function en(n){n.V=Date.now()+n.O,na(n,n.O)}function na(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Pt($e(n.gb,n),e)}function Tr(n){n.B&&(ee.clearTimeout(n.B),n.B=null)}function Ri(n){0==n.l.G||n.I||th(n.l,n)}function ei(n){Tr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,_r(n.T),yr(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function Cn(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Mi(t.h,n)))if(!n.J&&Mi(t.h,n)&&3==t.G){try{var i=t.Fa.g.parse(e)}catch(m){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0])e:if(t.u)t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&0==t.A&&!t.v&&(t.v=Pt($e(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;qs(t),Zs(t)}ya(t),mt(18)}if(1>=Ls(t.h)&&t.ja){try{t.ja()}catch(m){}t.ja=void 0}}else ri(t,11)}else if((n.J||t.g==n)&&qs(t),!q(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let m=r[e];if(t.T=m[0],m=m[1],2==t.G)if("c"==m[0]){t.I=m[1],t.ka=m[2];const _=m[3];null!=_&&(t.ma=_,t.j.info("VER="+t.ma));const I=m[4];null!=I&&(t.Ca=I,t.j.info("SVER="+t.Ca));const k=m[5];null!=k&&"number"==typeof k&&0<k&&(t.J=i=1.5*k,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const U=n.g;if(U){const B=U.g?U.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(B){var s=i.h;s.g||-1==B.indexOf("spdy")&&-1==B.indexOf("quic")&&-1==B.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Cr(s,s.h),s.h=null))}if(i.D){const Y=U.g?U.g.getResponseHeader("X-HTTP-Session-Id"):null;Y&&(i.za=Y,qe(i.F,i.D,Y))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((i=t).sa=ih(i,i.H?i.ka:null,i.V),u.J){Sr(i.h,u);var h=u,f=i.J;f&&h.setTimeout(f),h.B&&(Tr(h),en(h)),i.g=u}else rc(i);0<t.i.length&&Nr(t)}else"stop"!=m[0]&&"close"!=m[0]||ri(t,7);else 3==t.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?ri(t,7):Or(t):"noop"!=m[0]&&t.l&&t.l.wa(m),t.A=0)}Qn()}catch(m){}}function ia(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(We(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function Rs(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(We(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}(n),i=function Hl(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(We(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}for(i in e=[],t=0,n)e[t++]=n[i];return e}(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}(E=Er.prototype).setTimeout=function(n){this.O=n},E.ib=function(n){n=n.target;const e=this.L;e&&3==jt(n)?e.l():this.La(n)},E.La=function(n){try{if(n==this.g)e:{const _=jt(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>_)&&(3!=_||Mt||this.g&&(this.h.h||this.g.fa()||ec(this.g)))){this.I||4!=_||7==e||Qn(),Tr(this);var t=this.g.aa();this.Y=t;t:if(Ds(this)){var i=ec(this.g);n="";var r=i.length,s=4==jt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ei(this),Ri(this);var u="";break t}this.h.i=new ee.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function Jo(n,e,t,i,r,s,u){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,_,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var h,f=this.g;if((h=f.g?f.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!q(h)){var m=h;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,mt(12),ei(this),Ri(this);break e}Ai(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Cn(this,t)}this.P?(Xt(this,_,u),Mt&&this.i&&3==_&&(xs(this.S,this.T,"tick",this.hb),this.T.start())):(Ai(this.j,this.m,u,null),Cn(this,u)),4==_&&ei(this),this.i&&!this.I&&(4==_?th(this.l,this):(this.i=!1,en(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,mt(12)):(this.o=0,mt(13)),ei(this),Ri(this)}}}catch(_){}},E.hb=function(){if(this.g){var n=jt(this.g),e=this.g.fa();this.C<e.length&&(Tr(this),Xt(this,n,e),this.i&&4!=n&&en(this))}},E.cancel=function(){this.I=!0,ei(this)},E.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function Xo(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Qn(),mt(17)),ei(this),this.o=2,Ri(this)):na(this,this.V-n)};var ra=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ht(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof ht){this.h=void 0!==e?e:n.h,Os(this,n.j),this.s=n.s,this.g=n.g,Oi(this,n.m),this.l=n.l,e=n.i;var t=new Ni;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),br(this,t),this.o=n.o}else n&&(t=String(n).match(ra))?(this.h=!!e,Os(this,t[1]||"",!0),this.s=Ar(t[2]||""),this.g=Ar(t[3]||"",!0),Oi(this,t[4]),this.l=Ar(t[5]||"",!0),br(this,t[6]||"",!0),this.o=Ar(t[7]||"")):(this.h=!!e,this.i=new Ni(null,this.h))}function tn(n){return new ht(n)}function Os(n,e,t){n.j=t?Ar(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Oi(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function br(n,e,t){e instanceof Ni?(n.i=e,function Ku(n,e){e&&!n.j&&(nn(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(kr(this,i),ca(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=ti(e,ju)),n.i=new Ni(e,n.h))}function qe(n,e,t){n.i.set(e,t)}function xr(n){return qe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ar(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function ti(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,oa),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function oa(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}ht.prototype.toString=function(){var n=[],e=this.j;e&&n.push(ti(e,Ns,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(ti(e,Ns,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(ti(t,"/"==t.charAt(0)?aa:Ms,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",ti(t,ua)),n.join("")};var Ns=/[#\/\?@]/g,Ms=/[#\?:]/g,aa=/[#\?]/g,ju=/[#\?@]/g,ua=/#/g;function Ni(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function nn(n){n.g||(n.g=new Map,n.h=0,n.i&&function sa(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function kr(n,e){nn(n),e=Sn(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Ps(n,e){return nn(n),e=Sn(n,e),n.g.has(e)}function ca(n,e,t){kr(n,e),0<t.length&&(n.i=null,n.g.set(Sn(n,e),G(t)),n.h+=t.length)}function Sn(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function $u(n){this.l=n||ha,n=ee.PerformanceNavigationTiming?0<(n=ee.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(ee.g&&ee.g.Ga&&ee.g.Ga()&&ee.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(E=Ni.prototype).add=function(n,e){nn(this),this.i=null,n=Sn(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},E.forEach=function(n,e){nn(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)},E.oa=function(){nn(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t},E.W=function(n){nn(this);let e=[];if("string"==typeof n)Ps(this,n)&&(e=e.concat(this.g.get(Sn(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},E.set=function(n,e){return nn(this),this.i=null,Ps(this,n=Sn(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},E.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},E.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const s=encodeURIComponent(String(i)),u=this.W(i);for(i=0;i<u.length;i++){var r=s;""!==u[i]&&(r+="="+encodeURIComponent(String(u[i]))),n.push(r)}}return this.i=n.join("&")};var ha=10;function Hu(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Ls(n){return n.h?1:n.g?n.g.size:0}function Mi(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Cr(n,e){n.g?n.g.add(e):n.h=e}function Sr(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Yu(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return G(n.i)}function Dr(){}function Yl(){this.g=new Dr}function da(n,e,t){const i=t||"";try{ia(n,function(r,s){let u=r;Nt(r)&&(u=Yo(r)),e.push(i+s+"="+encodeURIComponent(u))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function Pi(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(s){}}function Li(n){this.l=n.ac||null,this.j=n.jb||!1}function Fi(n,e){ct.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=fa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}$u.prototype.cancel=function(){if(this.i=Yu(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},Dr.prototype.stringify=function(n){return ee.JSON.stringify(n,void 0)},Dr.prototype.parse=function(n){return ee.JSON.parse(n,void 0)},Oe(Li,qt),Li.prototype.g=function(){return new Fi(this.l,this.j)},Li.prototype.i=function(n){return function(){return n}}({}),Oe(Fi,ct);var fa=0;function Fs(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Rr(n){n.readyState=4,n.l=null,n.j=null,n.A=null,ni(n)}function ni(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(E=Fi.prototype).open=function(n,e){if(this.readyState!=fa)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,ni(this)},E.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||ee).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},E.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Rr(this)),this.readyState=fa},E.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,ni(this)),this.g&&(this.readyState=3,ni(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==ee.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Fs(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},E.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Rr(this):ni(this),3==this.readyState&&Fs(this)}},E.Va=function(n){this.g&&(this.response=this.responseText=n,Rr(this))},E.Ua=function(n){this.g&&(this.response=n,Rr(this))},E.ga=function(){this.g&&Rr(this)},E.setRequestHeader=function(n,e){this.v.append(n,e)},E.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},E.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Fi.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var Jl=ee.JSON.parse;function Xe(n){ct.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Us,this.K=this.L=!1}Oe(Xe,ct);var Us="",Xl=/^https?$/i,eh=["POST","PUT"];function Qu(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Vs(n),Ui(n)}function Vs(n){n.D||(n.D=!0,pt(n,"complete"),pt(n,"error"))}function Ju(n){if(n.h&&void 0!==he&&(!n.C[1]||4!=jt(n)||2!=n.aa()))if(n.v&&4==jt(n))Ts(n.Ha,0,n);else if(pt(n,"readystatechange"),4==jt(n)){n.h=!1;try{const h=n.aa();e:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=0===h){var r=String(n.H).match(ra)[1]||null;if(!r&&ee.self&&ee.self.location){var s=ee.self.location.protocol;r=s.substr(0,s.length-1)}i=!Xl.test(r?r.toLowerCase():"")}t=i}if(t)pt(n,"complete"),pt(n,"success");else{n.m=6;try{var u=2<jt(n)?n.g.statusText:""}catch(f){u=""}n.j=u+" ["+n.aa()+"]",Vs(n)}}finally{Ui(n)}}}function Ui(n,e){if(n.g){Xu(n);const t=n.g,i=n.C[0]?Rt:null;n.g=null,n.C=null,e||pt(n,"ready");try{t.onreadystatechange=i}catch(r){}}}function Xu(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(ee.clearTimeout(n.A),n.A=null)}function jt(n){return n.g?n.g.readyState:0}function ec(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Us:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Bs(n){let e="";return jo(n,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function ma(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=Bs(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):qe(n,e,t))}function ii(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function tc(n){this.Ca=0,this.i=[],this.j=new xi,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=ii("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=ii("baseRetryDelayMs",5e3,n),this.bb=ii("retryDelaySeedMs",1e4,n),this.$a=ii("forwardChannelMaxRetries",2,n),this.ta=ii("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new $u(n&&n.concurrentRequestLimit),this.Fa=new Yl,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Or(n){if(nc(n),3==n.G){var e=n.U++,t=tn(n.F);qe(t,"SID",n.I),qe(t,"RID",e),qe(t,"TYPE","terminate"),rn(n,t),(e=new Er(n,n.j,e,void 0)).K=2,e.v=xr(tn(t)),t=!1,ee.navigator&&ee.navigator.sendBeacon&&(t=ee.navigator.sendBeacon(e.v.toString(),"")),!t&&ee.Image&&((new Image).src=e.v,t=!0),t||(e.g=rh(e.l,null),e.g.da(e.v)),e.F=Date.now(),en(e)}nh(n)}function Zs(n){n.g&&(va(n),n.g.cancel(),n.g=null)}function nc(n){Zs(n),n.u&&(ee.clearTimeout(n.u),n.u=null),qs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&ee.clearTimeout(n.m),n.m=null)}function Nr(n){Hu(n.h)||n.m||(n.m=!0,Qo(n.Ja,n),n.C=0)}function ic(n,e){var t;t=e?e.m:n.U++;const i=tn(n.F);qe(i,"SID",n.I),qe(i,"RID",t),qe(i,"AID",n.T),rn(n,i),n.o&&n.s&&ma(i,n.o,n.s),t=new Er(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=_a(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Cr(n.h,t),Xn(t,i,e)}function rn(n,e){n.ia&&jo(n.ia,function(t,i){qe(e,i,t)}),n.l&&ia({},function(t,i){qe(e,i,t)})}function _a(n,e,t){t=Math.min(n.i.length,t);var i=n.l?$e(n.l.Ra,n.l,n):null;e:{var r=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=r[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let h=!0;for(let f=0;f<t;f++){let m=r[f].h;const _=r[f].g;if(m-=s,0>m)s=Math.max(0,r[f].h-100),h=!1;else try{da(_,u,"req"+m+"_")}catch(I){i&&i(_)}}if(h){i=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function rc(n){n.g||n.u||(n.Z=1,Qo(n.Ia,n),n.A=0)}function ya(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Pt($e(n.Ia,n),oc(n,n.A)),n.A++,0))}function va(n){null!=n.B&&(ee.clearTimeout(n.B),n.B=null)}function sc(n){n.g=new Er(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=tn(n.sa);qe(e,"RID","rpc"),qe(e,"SID",n.I),qe(e,"CI",n.L?"0":"1"),qe(e,"AID",n.T),qe(e,"TYPE","xmlhttp"),rn(n,e),n.o&&n.s&&ma(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=xr(tn(e)),t.s=null,t.P=!0,$l(t,n)}function qs(n){null!=n.v&&(ee.clearTimeout(n.v),n.v=null)}function th(n,e){var t=null;if(n.g==e){qs(n),va(n),n.g=null;var i=2}else{if(!Mi(n.h,e))return;t=e.D,Sr(n.h,e),i=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==i){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;pt(i=ki(),new Ci(i,t)),Nr(n)}else rc(n);else if(3==(r=e.o)||0==r&&0<n.pa||!(1==i&&function ga(n,e){return!(Ls(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Pt($e(n.Ja,n,e),oc(n,n.C)),n.C++,0)))}(n,e)||2==i&&ya(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:ri(n,5);break;case 4:ri(n,10);break;case 3:ri(n,6);break;default:ri(n,2)}}function oc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function ri(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var i=$e(n.kb,n);t||(t=new ht("//www.google.com/images/cleardot.gif"),ee.location&&"http"==ee.location.protocol||Os(t,"https"),xr(t)),function Ql(n,e){const t=new xi;if(ee.Image){const i=new Image;i.onload=Je(Pi,t,i,"TestLoadImage: loaded",!0,e),i.onerror=Je(Pi,t,i,"TestLoadImage: error",!1,e),i.onabort=Je(Pi,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=Je(Pi,t,i,"TestLoadImage: timeout",!1,e),ee.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}(t.toString(),i)}else mt(2);n.G=0,n.l&&n.l.va(e),nh(n),nc(n)}function nh(n){if(n.G=0,n.la=[],n.l){const e=Yu(n.h);(0!=e.length||0!=n.i.length)&&($(n.la,e),$(n.la,n.i),n.h.i.length=0,G(n.i),n.i.length=0),n.l.ua()}}function ih(n,e,t){var i=t instanceof ht?tn(t):new ht(t,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),Oi(i,i.m);else{var r=ee.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new ht(null,void 0);i&&Os(s,i),e&&(s.g=e),r&&Oi(s,r),t&&(s.l=t),i=s}return e=n.za,(t=n.D)&&e&&qe(i,t,e),qe(i,"VER",n.ma),rn(n,i),i}function rh(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Xe(t&&n.Da&&!n.ra?new Li({jb:!0}):n.ra)).Ka(n.H),e}function sh(){}function Ia(){if(te&&!(10<=Number(Zl)))throw Error("Environmental error: no available transport.")}function bt(n,e){ct.call(this),this.g=new tc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!q(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!q(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Vi(this)}function Dn(n){Ir.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Gs(){ea.call(this),this.status=1}function Vi(n){this.g=n}(E=Xe.prototype).Ka=function(n){this.L=n},E.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():wr.g(),this.C=function zu(n){return n.h||(n.h=n.i())}(this.u?this.u:wr),this.g.onreadystatechange=$e(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Qu(this,s)}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const s of i.keys())t.set(s,i.get(s))}i=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),r=ee.FormData&&n instanceof ee.FormData,!(0<=Jt(eh,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Xu(this),0<this.B&&((this.K=function pa(n){return te&&function gn(){return function x(n){var e=Bl;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=w(String(ms)).split("."),t=w("9").split("."),i=Math.max(e.length,t.length);for(let u=0;0==n&&u<i;u++){var r=e[u]||"",s=t[u]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;n=L(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||L(0==r[2].length,0==s[2].length)||L(r[2],s[2]),r=r[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=$e(this.qa,this)):this.A=Ts(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Qu(this,s)}},E.qa=function(){void 0!==he&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,pt(this,"timeout"),this.abort(8))},E.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,pt(this,"complete"),pt(this,"abort"),Ui(this))},E.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ui(this,!0)),Xe.X.M.call(this)},E.Ha=function(){this.s||(this.F||this.v||this.l?Ju(this):this.fb())},E.fb=function(){Ju(this)},E.aa=function(){try{return 2<jt(this)?this.g.status:-1}catch(n){return-1}},E.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},E.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),Jl(e)}},E.Ea=function(){return this.m},E.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(E=tc.prototype).ma=8,E.G=1,E.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new Er(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=Ou(s),Ei(s,this.S)):s=this.S),null!==this.o||this.N||(r.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var i=this.i[t];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=_a(this,r,e),qe(t=tn(this.F),"RID",n),qe(t,"CVER",22),this.D&&qe(t,"X-HTTP-Session-Id",this.D),rn(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(Bs(s)))+"&"+e:this.o&&ma(t,this.o,s)),Cr(this.h,r),this.Ya&&qe(t,"TYPE","init"),this.O?(qe(t,"$req",e),qe(t,"SID","null"),r.Z=!0,Xn(r,t,null)):Xn(r,t,e),this.G=2}}else 3==this.G&&(n?ic(this,n):0==this.i.length||Hu(this.h)||ic(this))},E.Ia=function(){if(this.u=null,sc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Pt($e(this.eb,this),n)}},E.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,mt(10),Zs(this),sc(this))},E.cb=function(){null!=this.v&&(this.v=null,Zs(this),ya(this),mt(19))},E.kb=function(n){n?(this.j.info("Successfully pinged google.com"),mt(2)):(this.j.info("Failed to ping google.com"),mt(1))},(E=sh.prototype).xa=function(){},E.wa=function(){},E.va=function(){},E.ua=function(){},E.Ra=function(){},Ia.prototype.g=function(n,e){return new bt(n,e)},Oe(bt,ct),bt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;mt(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=ih(n,null,n.V),Nr(n)},bt.prototype.close=function(){Or(this.g)},bt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Yo(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&Nr(e)},bt.prototype.M=function(){this.g.l=null,delete this.j,Or(this.g),delete this.g,bt.X.M.call(this)},Oe(Dn,Ir),Oe(Gs,ea),Oe(Vi,sh),Vi.prototype.xa=function(){pt(this.g,"a")},Vi.prototype.wa=function(n){pt(this.g,new Dn(n))},Vi.prototype.va=function(n){pt(this.g,new Gs)},Vi.prototype.ua=function(){pt(this.g,"b")},Ia.prototype.createWebChannel=Ia.prototype.g,bt.prototype.send=bt.prototype.u,bt.prototype.open=bt.prototype.m,bt.prototype.close=bt.prototype.close,Si.NO_ERROR=0,Si.TIMEOUT=8,Si.HTTP_ERROR=6,Wu.COMPLETE="complete",As.EventType=vr,vr.OPEN="a",vr.CLOSE="b",vr.ERROR="c",vr.MESSAGE="d",ct.prototype.listen=ct.prototype.N,Xe.prototype.listenOnce=Xe.prototype.O,Xe.prototype.getLastError=Xe.prototype.Oa,Xe.prototype.getLastErrorCode=Xe.prototype.Ea,Xe.prototype.getStatus=Xe.prototype.aa,Xe.prototype.getResponseJson=Xe.prototype.Sa,Xe.prototype.getResponseText=Xe.prototype.fa,Xe.prototype.send=Xe.prototype.da,Xe.prototype.setWithCredentials=Xe.prototype.Ka;var oh=X.createWebChannelTransport=function(){return new Ia},ah=X.getStatEventTarget=function(){return ki()},wa=X.ErrorCode=Si,Ea=X.EventType=Wu,Ta=X.Event=vn,ac=X.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Ws=X.FetchXmlHttpFactory=Li,Mr=X.WebChannel=As,uh=X.XhrIo=Xe;const uc="@firebase/firestore";class dt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}dt.UNAUTHENTICATED=new dt(null),dt.GOOGLE_CREDENTIALS=new dt("google-credentials-uid"),dt.FIRST_PARTY=new dt("first-party-uid"),dt.MOCK_USER=new dt("mock-user");let Pr="9.15.0";const Kt=new Ie.Yd("@firebase/firestore");function cc(){return Kt.logLevel}function Z(n,...e){if(Kt.logLevel<=Ie.in.DEBUG){const t=e.map(ba);Kt.debug(`Firestore (${Pr}): ${n}`,...t)}}function it(n,...e){if(Kt.logLevel<=Ie.in.ERROR){const t=e.map(ba);Kt.error(`Firestore (${Pr}): ${n}`,...t)}}function $t(n,...e){if(Kt.logLevel<=Ie.in.WARN){const t=e.map(ba);Kt.warn(`Firestore (${Pr}): ${n}`,...t)}}function ba(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function K(n="Unexpected state"){const e=`FIRESTORE (${Pr}) INTERNAL ASSERTION FAILED: `+n;throw it(e),new Error(e)}function oe(n,e){n||K()}function Q(n,e){return n}const N={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class V extends J.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class at{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Aa{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class ch{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(dt.UNAUTHENTICATED))}shutdown(){}}class zs{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class lc{constructor(e){this.t=e,this.currentUser=dt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var i=this;let r=this.i;const s=m=>this.i!==r?(r=this.i,t(m)):Promise.resolve();let u=new at;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new at,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const m=u;e.enqueueRetryable((0,R.Z)(function*(){yield m.promise,yield s(i.currentUser)}))},f=m=>{Z("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(Z("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new at)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(Z("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(oe("string"==typeof i.accessToken),new Aa(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return oe(null===e||"string"==typeof e),new dt(e)}}class Lr{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r,this.type="FirstParty",this.user=dt.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(oe(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class js{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r}getToken(){return Promise.resolve(new Lr(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(dt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class hc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class ka{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=s=>{null!=s.error&&Z("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,Z("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{Z("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?r(s):Z("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(oe("string"==typeof t.token),this.A=t.token,new hc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ca(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class dc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const r=Ca(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}}function pe(n,e){return n<e?-1:n>e?1:0}function si(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function fc(n){return n+"\0"}class ze{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new V(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new V(N.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new V(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new V(N.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return ze.fromMillis(Date.now())}static fromDate(e){return ze.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new ze(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?pe(this.nanoseconds,e.nanoseconds):pe(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ce{constructor(e){this.timestamp=e}static fromTimestamp(e){return new ce(e)}static min(){return new ce(new ze(0,0))}static max(){return new ce(new ze(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class sn{constructor(e,t,i){void 0===t?t=0:t>e.length&&K(),void 0===i?i=e.length-t:i>e.length-t&&K(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return 0===sn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof sn?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),u=t.get(r);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class Ne extends sn{construct(e,t,i){return new Ne(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new V(N.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new Ne(t)}static emptyPath(){return new Ne([])}}const hh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class et extends sn{construct(e,t,i){return new et(e,t,i)}static isValidIdentifier(e){return hh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),et.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new et(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(0===i.length)throw new V(N.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let u=!1;for(;r<e.length;){const h=e[r];if("\\"===h){if(r+1===e.length)throw new V(N.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[r+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new V(N.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,r+=2}else"`"===h?(u=!u,r++):"."!==h||u?(i+=h,r++):(s(),r++)}if(s(),u)throw new V(N.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new et(t)}static emptyPath(){return new et([])}}class H{constructor(e){this.path=e}static fromPath(e){return new H(Ne.fromString(e))}static fromName(e){return new H(Ne.fromString(e).popFirst(5))}static empty(){return new H(Ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new H(new Ne(e.slice()))}}class Ks{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function $s(n){return n.fields.find(e=>2===e.kind)}function On(n){return n.fields.filter(e=>2!==e.kind)}Ks.UNKNOWN_ID=-1;class Hs{constructor(e,t){this.fieldPath=e,this.kind=t}}class Fr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Fr(0,xt.min())}}function pc(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=ce.fromTimestamp(1e9===i?new ze(t+1,0):new ze(t,i));return new xt(r,H.empty(),e)}function mc(n){return new xt(n.readTime,n.key,-1)}class xt{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new xt(ce.min(),H.empty(),-1)}static max(){return new xt(ce.max(),H.empty(),-1)}}function Sa(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=H.comparator(n.documentKey,e.documentKey),0!==t?t:pe(n.largestBatchId,e.largestBatchId))}const gc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class _c{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Nn(n){return Da.apply(this,arguments)}function Da(){return Da=(0,R.Z)(function*(n){if(n.code!==N.FAILED_PRECONDITION||n.message!==gc)throw n;Z("LocalStore","Unexpectedly lost primary lease")}),Da.apply(this,arguments)}class D{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&K(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new D((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof D?t:D.resolve(t)}catch(t){return D.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):D.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):D.reject(t)}static resolve(e){return new D((t,i)=>{t(e)})}static reject(e){return new D((t,i)=>{i(e)})}static waitFor(e){return new D((t,i)=>{let r=0,s=0,u=!1;e.forEach(h=>{++r,h.next(()=>{++s,u&&s===r&&t()},f=>i(f))}),u=!0,s===r&&t()})}static or(e){let t=D.resolve(!1);for(const i of e)t=t.next(r=>r?D.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new D((i,r)=>{const s=e.length,u=new Array(s);let h=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(_=>{u[m]=_,++h,h===s&&i(u)},_=>r(_))}})}static doWhile(e,t){return new D((i,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):i()};s()})}}class Qs{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new at,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new oi(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const r=Oa(i.target.error);this.P.reject(new oi(e,r))}}static open(e,t,i,r){try{return new Qs(t,e.transaction(r,i))}catch(s){throw new oi(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(Z("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ra(t)}}class Ht{constructor(e,t,i){this.name=e,this.version=t,this.S=i,12.2===Ht.D((0,J.z$)())&&it("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return Z("SimpleDb","Removing database:",e),ai(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,J.hl)())return!1;if(Ht.N())return!0;const e=(0,J.z$)(),t=Ht.D(e),i=0<t&&t<10,r=Ht.k(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}F(e){var t=this;return(0,R.Z)(function*(){return t.db||(Z("SimpleDb","Opening database:",t.name),t.db=yield new Promise((i,r)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{i(u.target.result)},s.onblocked=()=>{r(new oi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const h=u.target.error;r("VersionError"===h.name?new V(N.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new V(N.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new oi(e,h))},s.onupgradeneeded=u=>{Z("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{Z("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=i=>t.B(i)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){var s=this;return(0,R.Z)(function*(){const u="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.F(e);const f=Qs.open(s.db,e,u?"readonly":"readwrite",i),m=r(f).next(_=>(f.V(),_)).catch(_=>(f.abort(_),D.reject(_))).toPromise();return m.catch(()=>{}),yield f.v,m}catch(f){const m=f,_="FirebaseError"!==m.name&&h<3;if(Z("SimpleDb","Transaction failed with error:",m.message,"Retrying:",_),s.close(),!_)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class fh{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return ai(this.q.delete())}}class oi extends V{constructor(e,t){super(N.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Mn(n){return"IndexedDbTransactionError"===n.name}class Ra{constructor(e){this.store=e}put(e,t){let i;return void 0!==t?(Z("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(Z("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),ai(i)}add(e){return Z("SimpleDb","ADD",this.store.name,e,e),ai(this.store.add(e))}get(e){return ai(this.store.get(e)).next(t=>(void 0===t&&(t=null),Z("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return Z("SimpleDb","DELETE",this.store.name,e),ai(this.store.delete(e))}count(){return Z("SimpleDb","COUNT",this.store.name),ai(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||"function"!=typeof this.store.getAll){const r=this.cursor(i),s=[];return this.H(r,(u,h)=>{s.push(h)}).next(()=>s)}{const r=this.store.getAll(i.range);return new D((s,u)=>{r.onerror=h=>{u(h.target.error)},r.onsuccess=h=>{s(h.target.result)}})}}J(e,t){const i=this.store.getAll(e,null===t?void 0:t);return new D((r,s)=>{i.onerror=u=>{s(u.target.error)},i.onsuccess=u=>{r(u.target.result)}})}Y(e,t){Z("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const r=this.cursor(i);return this.H(r,(s,u,h)=>h.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.H(r,t)}tt(e){const t=this.cursor({});return new D((i,r)=>{t.onerror=s=>{const u=Oa(s.target.error);r(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(h=>{h?u.continue():i()}):i()}})}H(e,t){const i=[];return new D((r,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void r();const f=new fh(h),m=t(h.primaryKey,h.value,f);if(m instanceof D){const _=m.catch(I=>(f.done(),D.reject(I)));i.push(_)}f.isDone?r():null===f.G?h.continue():h.continue(f.G)}}).next(()=>D.waitFor(i))}options(e,t){let i;return void 0!==e&&("string"==typeof e?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function ai(n){return new D((e,t)=>{n.onsuccess=i=>{e(i.target.result)},n.onerror=i=>{const r=Oa(i.target.error);t(r)}})}let Js=!1;function Oa(n){const e=Ht.D((0,J.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new V("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Js||(Js=!0,setTimeout(()=>{throw i},0)),i}}return n}class Na{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;Z("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,R.Z)(function*(){t.task=null;try{Z("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(i){Mn(i)?Z("IndexBackiller","Ignoring IndexedDB error during index backfill: ",i):yield Nn(i)}yield t.nt(6e4)}))}}class Xs{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,R.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",i=>t.it(i,e))})()}it(e,t){const i=new Set;let r=t,s=!0;return D.doWhile(()=>!0===s&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!i.has(u))return Z("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,r).next(h=>{r-=h,i.add(u)});s=!1})).next(()=>t-r)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(r,s)).next(h=>(Z("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>u.size)}))}ot(e,t){let i=e;return t.changes.forEach((r,s)=>{const u=mc(s);Sa(u,i)>0&&(i=u)}),new xt(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}let At=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>i.writeSequenceNumber(r))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class ph{constructor(e,t,i,r,s,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.useFetchStreams=f}}class on{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new on("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof on&&e.projectId===this.projectId&&e.database===this.database}}function Bi(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Lt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function eo(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ur(n){return null==n}function Vr(n){return 0===n&&1/n==-1/0}function yc(n){return"number"==typeof n&&Number.isInteger(n)&&!Vr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class rt{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new rt(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new rt(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return pe(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}rt.EMPTY_BYTE_STRING=new rt("");const mh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Pn(n){if(oe(!!n),"string"==typeof n){let e=0;const t=mh.exec(n);if(oe(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:je(n.seconds),nanos:je(n.nanos)}}function je(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function ui(n){return"string"==typeof n?rt.fromBase64String(n):rt.fromUint8Array(n)}function Br(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function vc(n){const e=n.mapValue.fields.__previous_value__;return Br(e)?vc(e):e}function ci(n){const e=Pn(n.mapValue.fields.__local_write_time__.timestampValue);return new ze(e.seconds,e.nanos)}const an={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},to={nullValue:"NULL_VALUE"};function Yt(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Br(n)?4:Ec(n)?9007199254740991:10:K()}function un(n,e){if(n===e)return!0;const t=Yt(n);if(t!==Yt(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return ci(n).isEqual(ci(e));case 3:return function(i,r){if("string"==typeof i.timestampValue&&"string"==typeof r.timestampValue&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=Pn(i.timestampValue),u=Pn(r.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,ui(n.bytesValue).isEqual(ui(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return je(i.geoPointValue.latitude)===je(r.geoPointValue.latitude)&&je(i.geoPointValue.longitude)===je(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return je(i.integerValue)===je(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=je(i.doubleValue),u=je(r.doubleValue);return s===u?Vr(s)===Vr(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return si(n.arrayValue.values||[],e.arrayValue.values||[],un);case 10:return function(i,r){const s=i.mapValue.fields||{},u=r.mapValue.fields||{};if(Bi(s)!==Bi(u))return!1;for(const h in s)if(s.hasOwnProperty(h)&&(void 0===u[h]||!un(s[h],u[h])))return!1;return!0}(n,e);default:return K()}var r}function Zr(n,e){return void 0!==(n.values||[]).find(t=>un(t,e))}function cn(n,e){if(n===e)return 0;const t=Yt(n),i=Yt(e);if(t!==i)return pe(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return pe(n.booleanValue,e.booleanValue);case 2:return function(r,s){const u=je(r.integerValue||r.doubleValue),h=je(s.integerValue||s.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return no(n.timestampValue,e.timestampValue);case 4:return no(ci(n),ci(e));case 5:return pe(n.stringValue,e.stringValue);case 6:return function(r,s){const u=ui(r),h=ui(s);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const u=r.split("/"),h=s.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=pe(u[f],h[f]);if(0!==m)return m}return pe(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const u=pe(je(r.latitude),je(s.latitude));return 0!==u?u:pe(je(r.longitude),je(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const u=r.values||[],h=s.values||[];for(let f=0;f<u.length&&f<h.length;++f){const m=cn(u[f],h[f]);if(m)return m}return pe(u.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){if(r===an.mapValue&&s===an.mapValue)return 0;if(r===an.mapValue)return 1;if(s===an.mapValue)return-1;const u=r.fields||{},h=Object.keys(u),f=s.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let _=0;_<h.length&&_<m.length;++_){const I=pe(h[_],m[_]);if(0!==I)return I;const k=cn(u[h[_]],f[m[_]]);if(0!==k)return k}return pe(h.length,m.length)}(n.mapValue,e.mapValue);default:throw K()}}function no(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return pe(n,e);const t=Pn(n),i=Pn(e),r=pe(t.seconds,i.seconds);return 0!==r?r:pe(t.nanos,i.nanos)}function Ln(n){return Pa(n)}function Pa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=Pn(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?ui(n.bytesValue).toBase64():"referenceValue"in n?H.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const u of i.values||[])s?s=!1:r+=",",r+=Pa(u);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",u=!0;for(const h of r)u?u=!1:s+=",",s+=`${h}:${Pa(i.fields[h])}`;return s+"}"}(n.mapValue):K();var e}function In(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function io(n){return!!n&&"integerValue"in n}function Zi(n){return!!n&&"arrayValue"in n}function Ic(n){return!!n&&"nullValue"in n}function wc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qi(n){return!!n&&"mapValue"in n}function qr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Lt(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=qr(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=qr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Ec(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function La(n){return"nullValue"in n?to:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?In(on.empty(),H.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:K()}function gh(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?In(on.empty(),H.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?an:K()}function Tc(n,e){const t=cn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ro(n,e){const t=cn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Fn{constructor(e,t){this.position=e,this.inclusive=t}}function so(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],u=n.position[r];if(i=s.field.isKeyField()?H.comparator(H.fromName(u.referenceValue),t.key):cn(u,t.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Gr(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!un(n.position[t],e.position[t]))return!1;return!0}class oo{}class ke extends oo{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,i):new _h(e,t,i):"array-contains"===t?new vh(e,i):"in"===t?new Za(e,i):"not-in"===t?new Ih(e,i):"array-contains-any"===t?new co(e,i):new ke(e,t,i)}static createKeyFieldInFilter(e,t,i){return"in"===t?new yh(e,i):new Ba(e,i)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(cn(t,this.value)):null!==t&&Yt(this.value)===Yt(t)&&this.matchesComparison(cn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return K()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class Le extends oo{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new Le(e,t)}matches(e){return Gi(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Gi(n){return"and"===n.op}function ao(n){return"or"===n.op}function Fa(n){return Ua(n)&&Gi(n)}function Ua(n){for(const e of n.filters)if(e instanceof Le)return!1;return!0}function bc(n){if(n instanceof ke)return n.field.canonicalString()+n.op.toString()+Ln(n.value);{const e=n.filters.map(t=>bc(t)).join(",");return`${n.op}(${e})`}}function Va(n,e){return n instanceof ke?(t=n,(i=e)instanceof ke&&t.op===i.op&&t.field.isEqual(i.field)&&un(t.value,i.value)):n instanceof Le?function(t,i){return i instanceof Le&&t.op===i.op&&t.filters.length===i.filters.length&&t.filters.reduce((r,s,u)=>r&&Va(s,i.filters[u]),!0)}(n,e):void K();var t,i}function uo(n,e){const t=n.filters.concat(e);return Le.create(t,n.op)}function xc(n){return n instanceof ke?`${(e=n).field.canonicalString()} ${e.op} ${Ln(e.value)}`:n instanceof Le?function(e){return e.op.toString()+" {"+e.getFilters().map(xc).join(" ,")+"}"}(n):"Filter";var e}class _h extends ke{constructor(e,t,i){super(e,t,i),this.key=H.fromName(i.referenceValue)}matches(e){const t=H.comparator(e.key,this.key);return this.matchesComparison(t)}}class yh extends ke{constructor(e,t){super(e,"in",t),this.keys=Ac(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Ba extends ke{constructor(e,t){super(e,"not-in",t),this.keys=Ac(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Ac(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(i=>H.fromName(i.referenceValue))}class vh extends ke{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Zi(t)&&Zr(t.arrayValue,this.value)}}class Za extends ke{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Zr(this.value.arrayValue,t)}}class Ih extends ke{constructor(e,t){super(e,"not-in",t)}matches(e){if(Zr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Zr(this.value.arrayValue,t)}}class co extends ke{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Zi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>Zr(this.value.arrayValue,i))}}class Wi{constructor(e,t="asc"){this.field=e,this.dir=t}}function wh(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class tt{constructor(e,t){this.comparator=e,this.root=t||gt.EMPTY}insert(e,t){return new tt(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,gt.BLACK,null,null))}remove(e){return new tt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,gt.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(0===i)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(0===r)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lo(this.root,e,this.comparator,!1)}getReverseIterator(){return new lo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lo(this.root,e,this.comparator,!0)}}class lo{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class gt{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=null!=i?i:gt.RED,this.left=null!=r?r:gt.EMPTY,this.right=null!=s?s:gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new gt(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return gt.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return gt.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw K();const e=this.left.check();if(e!==this.right.check())throw K();return e+(this.isRed()?0:1)}}gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1,gt.EMPTY=new class{constructor(){this.size=0}get key(){throw K()}get value(){throw K()}get color(){throw K()}get left(){throw K()}get right(){throw K()}copy(n,e,t,i,r){return this}insert(n,e,t){return new gt(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Be{constructor(e){this.comparator=e,this.data=new tt(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new kc(this.data.getIterator())}getIteratorFrom(e){return new kc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof Be)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(0!==this.comparator(r,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new Be(this.comparator);return t.data=e,t}}class kc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function zi(n){return n.hasNext()?n.getNext():void 0}class kt{constructor(e){this.fields=e,e.sort(et.comparator)}static empty(){return new kt([])}unionWith(e){let t=new Be(et.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new kt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return si(this.fields,e.fields,(t,i)=>t.isEqual(i))}}class _t{constructor(e){this.value=e}static empty(){return new _t({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!qi(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=qr(t)}setAll(e){let t=et.emptyPath(),i={},r=[];e.forEach((u,h)=>{if(!t.isImmediateParentOf(h)){const f=this.getFieldsMap(t);this.applyChanges(f,i,r),i={},r=[],t=h.popLast()}u?i[h.lastSegment()]=qr(u):r.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());qi(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return un(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];qi(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Lt(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new _t(qr(this.value))}}function Cc(n){const e=[];return Lt(n.fields,(t,i)=>{const r=new et([t]);if(qi(i)){const s=Cc(i.mapValue).fields;if(0===s.length)e.push(r);else for(const u of s)e.push(r.child(u))}else e.push(r)}),new kt(e)}class Ge{constructor(e,t,i,r,s,u,h){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=u,this.documentState=h}static newInvalidDocument(e){return new Ge(e,0,ce.min(),ce.min(),ce.min(),_t.empty(),0)}static newFoundDocument(e,t,i,r){return new Ge(e,1,t,ce.min(),i,r,0)}static newNoDocument(e,t){return new Ge(e,2,t,ce.min(),ce.min(),_t.empty(),0)}static newUnknownDocument(e,t){return new Ge(e,3,t,ce.min(),ce.min(),_t.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(ce.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=_t.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=_t.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ce.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ge&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ge(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Eh{constructor(e,t=null,i=[],r=[],s=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=u,this.endAt=h,this.ft=null}}function qa(n,e=null,t=[],i=[],r=null,s=null,u=null){return new Eh(n,e,t,i,r,s,u)}function Un(n){const e=Q(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>bc(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>{return(r=i).field.canonicalString()+r.dir;var r}).join(","),Ur(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ln(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ln(i)).join(",")),e.ft=t}return e.ft}function Wr(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!wh(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Va(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Gr(n.startAt,e.startAt)&&Gr(n.endAt,e.endAt)}function ho(n){return H.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function fo(n,e){return n.filters.filter(t=>t instanceof ke&&t.field.isEqual(e))}function Sc(n,e,t){let i=to,r=!0;for(const s of fo(n,e)){let u=to,h=!0;switch(s.op){case"<":case"<=":u=La(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,h=!1;break;case"!=":case"not-in":u=to}Tc({value:i,inclusive:r},{value:u,inclusive:h})<0&&(i=u,r=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Tc({value:i,inclusive:r},{value:u,inclusive:t.inclusive})<0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}function po(n,e,t){let i=an,r=!0;for(const s of fo(n,e)){let u=an,h=!0;switch(s.op){case">=":case">":u=gh(s.value),h=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,h=!1;break;case"!=":case"not-in":u=an}ro({value:i,inclusive:r},{value:u,inclusive:h})>0&&(i=u,r=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];ro({value:i,inclusive:r},{value:u,inclusive:t.inclusive})>0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}class wn{constructor(e,t=null,i=[],r=[],s=null,u="F",h=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=u,this.startAt=h,this.endAt=f,this.dt=null,this._t=null}}function mo(n,e,t,i,r,s,u,h){return new wn(n,e,t,i,r,s,u,h)}function ji(n){return new wn(n)}function Ga(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Wa(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Ki(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function za(n){return null!==n.collectionGroup}function Vn(n){const e=Q(n);if(null===e.dt){e.dt=[];const t=Ki(e),i=Wa(e);if(null!==t&&null===i)t.isKeyField()||e.dt.push(new Wi(t)),e.dt.push(new Wi(et.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Wi(et.keyField(),s))}}}return e.dt}function vt(n){const e=Q(n);if(!e._t)if("F"===e.limitType)e._t=qa(e.path,e.collectionGroup,Vn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Vn(e))t.push(new Wi(s.field,"desc"===s.dir?"asc":"desc"));const i=e.endAt?new Fn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new Fn(e.startAt.position,e.startAt.inclusive):null;e._t=qa(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e._t}function ja(n,e){e.getFirstInequalityField(),Ki(n);const t=n.filters.concat([e]);return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function go(n,e,t){return new wn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function zr(n,e){return Wr(vt(n),vt(e))&&n.limitType===e.limitType}function Dc(n){return`${Un(vt(n))}|lt:${n.limitType}`}function Ka(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>xc(i)).join(", ")}]`),Ur(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>{return`${(r=i).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ln(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ln(i)).join(",")),`Target(${t})`}(vt(n))}; limitType=${n.limitType})`}function _o(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return null!==t.collectionGroup?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):H.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of Vn(t))if(!r.field.isKeyField()&&null===i.data.field(r.field))return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&(i=e,!((t=n).startAt&&!function(r,s,u){const h=so(r,s,u);return r.inclusive?h<=0:h<0}(t.startAt,Vn(t),i)||t.endAt&&!function(r,s,u){const h=so(r,s,u);return r.inclusive?h>=0:h>0}(t.endAt,Vn(t),i)));var t,i}function Rc(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Th(n){return(e,t)=>{let i=!1;for(const r of Vn(n)){const s=li(r,e,t);if(0!==s)return s;i=i||r.field.isKeyField()}return 0}}function li(n,e,t){const i=n.field.isKeyField()?H.comparator(e.key,t.key):function(r,s,u){const h=s.data.field(r),f=u.data.field(r);return null!==h&&null!==f?cn(h,f):K()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return K()}}function Oc(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vr(e)?"-0":e}}function Nc(n){return{integerValue:""+n}}function yo(n,e){return yc(e)?Nc(e):Oc(n,e)}class vo{constructor(){this._=void 0}}function $a(n,e,t){return n instanceof Bn?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof hi?Pc(n,e):n instanceof En?Lc(n,e):function(i,r){const s=Mc(i,r),u=Fc(s)+Fc(i.gt);return io(s)&&io(i.gt)?Nc(u):Oc(i.yt,u)}(n,e)}function bh(n,e,t){return n instanceof hi?Pc(n,e):n instanceof En?Lc(n,e):t}function Mc(n,e){return n instanceof $i?io(t=e)||(i=t)&&"doubleValue"in i?e:{integerValue:0}:null;var i,t}class Bn extends vo{}class hi extends vo{constructor(e){super(),this.elements=e}}function Pc(n,e){const t=Uc(e);for(const i of n.elements)t.some(r=>un(r,i))||t.push(i);return{arrayValue:{values:t}}}class En extends vo{constructor(e){super(),this.elements=e}}function Lc(n,e){let t=Uc(e);for(const i of n.elements)t=t.filter(r=>!un(r,i));return{arrayValue:{values:t}}}class $i extends vo{constructor(e,t){super(),this.yt=e,this.gt=t}}function Fc(n){return je(n.integerValue||n.doubleValue)}function Uc(n){return Zi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class jr{constructor(e,t){this.field=e,this.transform=t}}class Ha{constructor(e,t){this.version=e,this.transformResults=t}}class Ke{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new Ke}static exists(e){return new Ke(void 0,e)}static updateTime(e){return new Ke(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Io(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class Hi{}function wo(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Qi(n.key,Ke.none()):new Yi(n.key,n.data,Ke.none());{const t=n.data,i=_t.empty();let r=new Be(et.comparator);for(let s of e.fields)if(!r.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?i.delete(s):i.set(s,u),r=r.add(s)}return new Tn(n.key,i,new kt(r.toArray()),Ke.none())}}function xh(n,e,t){n instanceof Yi?function(i,r,s){const u=i.value.clone(),h=Zc(i.fieldTransforms,r,s.transformResults);u.setAll(h),r.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Tn?function(i,r,s){if(!Io(i.precondition,r))return void r.convertToUnknownDocument(s.version);const u=Zc(i.fieldTransforms,r,s.transformResults),h=r.data;h.setAll(Ya(i)),h.setAll(u),r.convertToFoundDocument(s.version,h).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Kr(n,e,t,i){return n instanceof Yi?function(r,s,u,h){if(!Io(r.precondition,s))return u;const f=r.value.clone(),m=qc(r.fieldTransforms,h,s);return f.setAll(m),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,i):n instanceof Tn?function(r,s,u,h){if(!Io(r.precondition,s))return u;const f=qc(r.fieldTransforms,h,s),m=s.data;return m.setAll(Ya(r)),m.setAll(f),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===u?null:u.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(_=>_.field))}(n,e,t,i):(u=t,Io(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function Eo(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=Mc(i.transform,r||null);null!=s&&(null===t&&(t=_t.empty()),t.set(i.field,s))}return t||null}function Bc(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===i||t&&i&&si(t,i,(r,s)=>function Vc(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(t=n.transform)instanceof hi&&i instanceof hi||t instanceof En&&i instanceof En?si(t.elements,i.elements,un):t instanceof $i&&i instanceof $i?un(t.gt,i.gt):t instanceof Bn&&i instanceof Bn);var t,i}(r,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,i}class Yi extends Hi{constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Tn extends Hi{constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Ya(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function Zc(n,e,t){const i=new Map;oe(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],u=s.transform,h=e.data.field(s.field);i.set(s.field,bh(u,h,t[r]))}return i}function qc(n,e,t){const i=new Map;for(const r of n){const s=r.transform,u=t.data.field(r.field);i.set(r.field,$a(s,u,e))}return i}class Qi extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Qa extends Hi{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class $r{constructor(e){this.count=e}}var st,De;function Gc(n){switch(n){default:return K();case N.CANCELLED:case N.UNKNOWN:case N.DEADLINE_EXCEEDED:case N.RESOURCE_EXHAUSTED:case N.INTERNAL:case N.UNAVAILABLE:case N.UNAUTHENTICATED:return!1;case N.INVALID_ARGUMENT:case N.NOT_FOUND:case N.ALREADY_EXISTS:case N.PERMISSION_DENIED:case N.FAILED_PRECONDITION:case N.ABORTED:case N.OUT_OF_RANGE:case N.UNIMPLEMENTED:case N.DATA_LOSS:return!0}}function Wc(n){if(void 0===n)return it("GRPC error has no .code"),N.UNKNOWN;switch(n){case st.OK:return N.OK;case st.CANCELLED:return N.CANCELLED;case st.UNKNOWN:return N.UNKNOWN;case st.DEADLINE_EXCEEDED:return N.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return N.RESOURCE_EXHAUSTED;case st.INTERNAL:return N.INTERNAL;case st.UNAVAILABLE:return N.UNAVAILABLE;case st.UNAUTHENTICATED:return N.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return N.INVALID_ARGUMENT;case st.NOT_FOUND:return N.NOT_FOUND;case st.ALREADY_EXISTS:return N.ALREADY_EXISTS;case st.PERMISSION_DENIED:return N.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return N.FAILED_PRECONDITION;case st.ABORTED:return N.ABORTED;case st.OUT_OF_RANGE:return N.OUT_OF_RANGE;case st.UNIMPLEMENTED:return N.UNIMPLEMENTED;case st.DATA_LOSS:return N.DATA_LOSS;default:return K()}}(De=st||(st={}))[De.OK=0]="OK",De[De.CANCELLED=1]="CANCELLED",De[De.UNKNOWN=2]="UNKNOWN",De[De.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",De[De.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",De[De.NOT_FOUND=5]="NOT_FOUND",De[De.ALREADY_EXISTS=6]="ALREADY_EXISTS",De[De.PERMISSION_DENIED=7]="PERMISSION_DENIED",De[De.UNAUTHENTICATED=16]="UNAUTHENTICATED",De[De.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",De[De.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",De[De.ABORTED=10]="ABORTED",De[De.OUT_OF_RANGE=11]="OUT_OF_RANGE",De[De.UNIMPLEMENTED=12]="UNIMPLEMENTED",De[De.INTERNAL=13]="INTERNAL",De[De.UNAVAILABLE=14]="UNAVAILABLE",De[De.DATA_LOSS=15]="DATA_LOSS";class Zn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0!==i)for(const[r,s]of i)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(void 0===r)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return 1===i.length?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Lt(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return eo(this.inner)}size(){return this.innerSize}}const Ah=new tt(H.comparator);function Ct(){return Ah}const To=new tt(H.comparator);function di(...n){let e=To;for(const t of n)e=e.insert(t.key,t);return e}function Ja(n){let e=To;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function ln(){return Hr()}function bo(){return Hr()}function Hr(){return new Zn(n=>n.toString(),(n,e)=>n.isEqual(e))}const Ft=new tt(H.comparator),Yr=new Be(H.comparator);function _e(...n){let e=Yr;for(const t of n)e=e.add(t);return e}const kh=new Be(pe);function Ji(){return kh}class fi{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,Qr.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new fi(ce.min(),r,Ji(),Ct(),_e())}}class Qr{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new Qr(i,t,_e(),_e(),_e())}}class Jr{constructor(e,t,i,r){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=r}}class zc{constructor(e,t){this.targetId=e,this.Et=t}}class bn{constructor(e,t,i=rt.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class Xa{constructor(){this.At=0,this.Rt=Kc(),this.bt=rt.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=_e(),t=_e(),i=_e();return this.Rt.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:K()}}),new Qr(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=Kc()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Ch{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Ct(),this.qt=jc(),this.Ut=new Be(pe)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:K()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,r)=>{this.zt(r)&&t(r)})}Jt(e){const t=e.targetId,i=e.Et.count,r=this.Yt(t);if(r){const s=r.target;if(ho(s))if(0===i){const u=new H(s.path);this.Qt(t,u,Ge.newNoDocument(u,ce.min()))}else oe(1===i);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,u)=>{const h=this.Yt(u);if(h){if(s.current&&ho(h.target)){const f=new H(h.target.path);null!==this.Lt.get(f)||this.te(u,f)||this.Qt(u,f,Ge.newNoDocument(f,e))}s.St&&(t.set(u,s.Ct()),s.xt())}});let i=_e();this.qt.forEach((s,u)=>{let h=!0;u.forEachWhile(f=>{const m=this.Yt(f);return!m||2===m.purpose||(h=!1,!1)}),h&&(i=i.add(s))}),this.Lt.forEach((s,u)=>u.setReadTime(e));const r=new fi(e,t,this.Ut,this.Lt,i);return this.Lt=Ct(),this.qt=jc(),this.Ut=new Be(pe),r}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Xa,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new Be(pe),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||Z("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Xa),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function jc(){return new tt(H.comparator)}function Kc(){return new tt(H.comparator)}const $c={asc:"ASCENDING",desc:"DESCENDING"},Ot={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},eu={and:"AND",or:"OR"};class tu{constructor(e,t){this.databaseId=e,this.wt=t}}function Xi(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function hn(n,e){return n.wt?e.toBase64():e.toUint8Array()}function Xr(n,e){return Xi(n,e.toTimestamp())}function nt(n){return oe(!!n),ce.fromTimestamp(function(e){const t=Pn(e);return new ze(t.seconds,t.nanos)}(n))}function xo(n,e){return(t=n,new Ne(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Hc(n){const e=Ne.fromString(n);return oe(su(e)),e}function pi(n,e){return xo(n.databaseId,e.path)}function dn(n,e){const t=Hc(e);if(t.get(1)!==n.databaseId.projectId)throw new V(N.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new V(N.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new H(c(t))}function nu(n,e){return xo(n.databaseId,e)}function Yc(n){const e=Hc(n);return 4===e.length?Ne.emptyPath():c(e)}function es(n){return new Ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function c(n){return oe(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function o(n,e,t){return{name:pi(n,e),fields:t.value.mapValue.fields}}function a(n,e,t){const i=dn(n,e.name),r=nt(e.updateTime),s=e.createTime?nt(e.createTime):ce.min(),u=new _t({mapValue:{fields:e.fields}}),h=Ge.newFoundDocument(i,r,s,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function g(n,e){let t;if(e instanceof Yi)t={update:o(n,e.key,e.value)};else if(e instanceof Qi)t={delete:pi(n,e.key)};else if(e instanceof Tn)t={update:o(n,e.key,e.data),updateMask:ru(e.fieldMask)};else{if(!(e instanceof Qa))return K();t={verify:pi(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const u=s.transform;if(u instanceof Bn)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof hi)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof En)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof $i)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw K()}(0,i))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:Xr(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:K()),t;var r}function A(n,e){const t=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?Ke.updateTime(nt(r.updateTime)):void 0!==r.exists?Ke.exists(r.exists):Ke.none():Ke.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,u){let h=null;"setToServerValue"in u?(oe("REQUEST_TIME"===u.setToServerValue),h=new Bn):"appendMissingElements"in u?h=new hi(u.appendMissingElements.values||[]):"removeAllFromArray"in u?h=new En(u.removeAllFromArray.values||[]):"increment"in u?h=new $i(s,u.increment):K();const f=et.fromServerFormat(u.fieldPath);return new jr(f,h)}(n,r)):[];var r;if(e.update){const r=dn(n,e.update.name),s=new _t({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new kt((e.updateMask.fieldPaths||[]).map(m=>et.fromServerFormat(m)));return new Tn(r,s,u,t,i)}return new Yi(r,s,t,i)}if(e.delete){const r=dn(n,e.delete);return new Qi(r,t)}if(e.verify){const r=dn(n,e.verify);return new Qa(r,t)}return K()}function j(n,e){return{documents:[nu(n,e.path)]}}function ne(n,e){const t={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(t.parent=nu(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=nu(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(f){if(0!==f.length)return iu(Le.create(f,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(f){if(0!==f.length)return f.map(m=>{return{field:qn((_=m).field),direction:Qt(_.dir)};var _})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(m=e.limit,n.wt||Ur(m)?m:{value:m});var m,h,f;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt={before:!(f=e.endAt).inclusive,values:f.position}),t}function de(n){let e=Yc(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){oe(1===i);const _=t.from[0];_.allDescendants?r=_.collectionId:e=e.child(_.collectionId)}let s=[];t.where&&(s=function(_){const I=ot(_);return I instanceof Le&&Fa(I)?I.getFilters():[I]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(_=>{return new Wi(mi((I=_).field),function(k){switch(k){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(I.direction));var I}));let h=null;t.limit&&(h=function(_){let I;return I="object"==typeof _?_.value:_,Ur(I)?null:I}(t.limit));let f=null;var _;t.startAt&&(f=new Fn((_=t.startAt).values||[],!!_.before));let m=null;return t.endAt&&(m=function(_){return new Fn(_.values||[],!_.before)}(t.endAt)),mo(e,r,u,s,h,"F",f,m)}function ot(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=mi(e.unaryFilter.field);return ke.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=mi(e.unaryFilter.field);return ke.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=mi(e.unaryFilter.field);return ke.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=mi(e.unaryFilter.field);return ke.create(s,"!=",{nullValue:"NULL_VALUE"});default:return K()}}(n):void 0!==n.fieldFilter?ke.create(mi((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return K()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return Le.create(e.compositeFilter.filters.map(t=>ot(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return K()}}(e.compositeFilter.op))}(n):K();var e}function Qt(n){return $c[n]}function Ao(n){return Ot[n]}function Qc(n){return eu[n]}function qn(n){return{fieldPath:n.canonicalString()}}function mi(n){return et.fromServerFormat(n.fieldPath)}function iu(n){return n instanceof ke?function(e){if("=="===e.op){if(wc(e.value))return{unaryFilter:{field:qn(e.field),op:"IS_NAN"}};if(Ic(e.value))return{unaryFilter:{field:qn(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(wc(e.value))return{unaryFilter:{field:qn(e.field),op:"IS_NOT_NAN"}};if(Ic(e.value))return{unaryFilter:{field:qn(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:qn(e.field),op:Ao(e.op),value:e.value}}}(n):n instanceof Le?function(e){const t=e.getFilters().map(i=>iu(i));return 1===t.length?t[0]:{compositeFilter:{op:Qc(e.op),filters:t}}}(n):K()}function ru(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function su(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function It(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=au(e)),e=ou(n.get(t),e);return au(e)}function ou(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function au(n){return n+"\x01\x01"}function fn(n){const e=n.length;if(oe(e>=2),2===e)return oe("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),Ne.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&K(),n.charAt(u+1)){case"\x01":const h=n.substring(s,u);let f;0===r.length?f=h:(r+=h,f=r,r=""),i.push(f);break;case"\x10":r+=n.substring(s,u),r+="\0";break;case"\x11":r+=n.substring(s,u+1);break;default:K()}s=u+2}return new Ne(i)}const ko=["userId","batchId"];function Co(n,e){return[n,It(e)]}function zf(n,e,t){return[n,It(e),t]}const Ng={},Mg=["prefixPath","collectionGroup","readTime","documentId"],Pg=["prefixPath","collectionGroup","documentId"],Lg=["collectionGroup","readTime","prefixPath","documentId"],Fg=["canonicalId","targetId"],Ug=["targetId","path"],Vg=["path","targetId"],Bg=["collectionId","parent"],Zg=["indexId","uid"],qg=["uid","sequenceNumber"],Gg=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Wg=["indexId","uid","orderedDocumentKey"],zg=["userId","collectionPath","documentId"],jg=["userId","collectionPath","largestBatchId"],Kg=["userId","collectionGroup","largestBatchId"],jf=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],$g=[...jf,"documentOverlays"],Kf=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],$f=Kf,Hg=[...$f,"indexConfiguration","indexState","indexEntries"];class Sh extends _c{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function wt(n,e){const t=Q(n);return Ht.M(t.se,e)}class Dh{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&xh(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Kr(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Kr(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=bo();return this.mutations.forEach(r=>{const s=e.get(r.key),u=s.overlayedDocument;let h=this.applyToLocalView(u,s.mutatedFields);h=t.has(r.key)?null:h;const f=wo(u,h);null!==f&&i.set(r.key,f),u.isValidDocument()||u.convertToNoDocument(ce.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),_e())}isEqual(e){return this.batchId===e.batchId&&si(this.mutations,e.mutations,(t,i)=>Bc(t,i))&&si(this.baseMutations,e.baseMutations,(t,i)=>Bc(t,i))}}class Rh{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){oe(e.mutations.length===i.length);let r=Ft;const s=e.mutations;for(let u=0;u<s.length;u++)r=r.insert(s[u].key,i[u].version);return new Rh(e,t,i,r)}}class Oh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class er{constructor(e,t,i,r,s=ce.min(),u=ce.min(),h=rt.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h}withSequenceNumber(e){return new er(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new er(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new er(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Hf{constructor(e){this.ie=e}}function Yf(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:Jc(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document={name:pi(r=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:Xi(r,s.version.toTimestamp()),createTime:Xi(r,s.createTime.toTimestamp())};else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:ts(e.version)};else{if(!e.isUnknownDocument())return K();i.unknownDocument={path:t.path.toArray(),version:ts(e.version)}}var r,s;return i}function Jc(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function ts(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ns(n){const e=new ze(n.seconds,n.nanoseconds);return ce.fromTimestamp(e)}function is(n,e){const t=(e.baseMutations||[]).map(s=>A(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const i=e.mutations.map(s=>A(n.ie,s)),r=ze.fromMillis(e.localWriteTimeMs);return new Dh(e.batchId,r,t,i)}function uu(n){const e=ns(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?ns(n.lastLimboFreeSnapshotVersion):ce.min();let i;var r;return void 0!==n.query.documents?(oe(1===(r=n.query).documents.length),i=vt(ji(Yc(r.documents[0])))):i=vt(de(n.query)),new er(i,n.targetId,0,n.lastListenSequenceNumber,e,t,rt.fromBase64String(n.resumeToken))}function Qf(n,e){const t=ts(e.snapshotVersion),i=ts(e.lastLimboFreeSnapshotVersion);let r;r=ho(e.target)?j(n.ie,e.target):ne(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:Un(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function Nh(n){const e=de({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?go(e,e.limit,"L"):e}function Mh(n,e){return new Oh(e.largestBatchId,A(n.ie,e.overlayMutation))}function Jf(n,e){const t=e.path.lastSegment();return[n,It(e.path.popLast()),t]}function Xf(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:ts(i.readTime),documentKey:It(i.documentKey.path),largestBatchId:i.largestBatchId}}class Qg{getBundleMetadata(e,t){return ep(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:ns(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return ep(e).put({bundleId:(i=t).id,createTime:ts(nt(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return tp(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:Nh(r.bundledQuery),readTime:ns(r.readTime)};var r})}saveNamedQuery(e,t){return tp(e).put({name:(i=t).name,readTime:ts(nt(i.readTime)),bundledQuery:i.bundledQuery});var i}}function ep(n){return wt(n,"bundles")}function tp(n){return wt(n,"namedQueries")}class Xc{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new Xc(e,t.uid||"")}getOverlay(e,t){return cu(e).get(Jf(this.userId,t)).next(i=>i?Mh(this.yt,i):null)}getOverlays(e,t){const i=ln();return D.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,u)=>{const h=new Oh(t,u);r.push(this.oe(e,h))}),D.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(u=>r.add(It(u.getCollectionPath())));const s=[];return r.forEach(u=>{const h=IDBKeyRange.bound([this.userId,u,i],[this.userId,u,i+1],!1,!0);s.push(cu(e).Y("collectionPathOverlayIndex",h))}),D.waitFor(s)}getOverlaysForCollection(e,t,i){const r=ln(),s=It(t),u=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return cu(e).W("collectionPathOverlayIndex",u).next(h=>{for(const f of h){const m=Mh(this.yt,f);r.set(m.getKey(),m)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=ln();let u;const h=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return cu(e).Z({index:"collectionGroupOverlayIndex",range:h},(f,m,_)=>{const I=Mh(this.yt,m);s.size()<r||I.largestBatchId===u?(s.set(I.getKey(),I),u=I.largestBatchId):_.done()}).next(()=>s)}oe(e,t){return cu(e).put(function(i,r,s){const[u,h,f]=Jf(r,s.mutation.key);return{userId:r,collectionPath:h,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:g(i.ie,s.mutation)}}(this.yt,this.userId,t))}}function cu(n){return wt(n,"documentOverlays")}class rs{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(je(e.integerValue));else if("doubleValue"in e){const i=je(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),Vr(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),"string"==typeof i?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(ui(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?Ec(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):K()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const r of Object.keys(i))this.de(r,t),this.ce(i[r],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const r of i)this.ce(r,t)}me(e,t){this.he(t,37),H.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function Jg(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function np(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=Jg(255&t[r]);if(i+=s,8!==s)break}return i}(n);return Math.ceil(e/8)}rs.Ie=new rs;class Xg{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const r=t.codePointAt(0);this.Ee(240|r>>>18),this.Ee(128|63&r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const r=t.codePointAt(0);this.be(240|r>>>18),this.be(128|63&r>>>12),this.be(128|63&r>>>6),this.be(128|63&r)}}this.Pe()}Se(e){const t=this.De(e),i=np(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){const t=this.De(e),i=np(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=0!=(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class e_{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class t_{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class lu{constructor(){this.$e=new Xg,this.Be=new e_(this.$e),this.Le=new t_(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class ss{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new ss(this.indexId,this.documentKey,this.arrayValue,i)}}function tr(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=ip(n.arrayValue,e.arrayValue),0!==t?t:(t=ip(n.directionalValue,e.directionalValue),0!==t?t:H.comparator(n.documentKey,e.documentKey)))}function ip(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(0!==i)return i}return n.length-e.length}class n_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){oe(e.collectionGroup===this.collectionId);const t=$s(e);if(void 0!==t&&!this.We(t))return!1;const i=On(e);let r=0,s=0;for(;r<i.length&&this.We(i[r]);++r);if(r===i.length)return!0;if(void 0!==this.Qe){const u=i[r];if(!this.ze(this.Qe,u)||!this.He(this.Ke[s++],u))return!1;++r}for(;r<i.length;++r){const u=i[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rp(n){var e,t;if(oe(n instanceof ke||n instanceof Le),n instanceof ke){if(n instanceof Za){const r=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>ke.create(n.field,"==",s)))||[];return Le.create(r,"or")}return n}const i=n.filters.map(r=>rp(r));return Le.create(i,n.op)}function i_(n){if(0===n.getFilters().length)return[];const e=Fh(rp(n));return oe(sp(e)),Ph(e)||Lh(e)?[e]:e.getFilters()}function Ph(n){return n instanceof ke}function Lh(n){return n instanceof Le&&Fa(n)}function sp(n){return Ph(n)||Lh(n)||function(e){if(e instanceof Le&&ao(e)){for(const t of e.getFilters())if(!Ph(t)&&!Lh(t))return!1;return!0}return!1}(n)}function Fh(n){if(oe(n instanceof ke||n instanceof Le),n instanceof ke)return n;if(1===n.filters.length)return Fh(n.filters[0]);const e=n.filters.map(i=>Fh(i));let t=Le.create(e,n.op);return t=el(t),sp(t)?t:(oe(t instanceof Le),oe(Gi(t)),oe(t.filters.length>1),t.filters.reduce((i,r)=>Uh(i,r)))}function Uh(n,e){let t;return oe(n instanceof ke||n instanceof Le),oe(e instanceof ke||e instanceof Le),t=n instanceof ke?e instanceof ke?Le.create([n,e],"and"):op(n,e):e instanceof ke?op(e,n):function(i,r){if(oe(i.filters.length>0&&r.filters.length>0),Gi(i)&&Gi(r))return uo(i,r.getFilters());const s=ao(i)?i:r,u=ao(i)?r:i,h=s.filters.map(f=>Uh(f,u));return Le.create(h,"or")}(n,e),el(t)}function op(n,e){if(Gi(e))return uo(e,n.getFilters());{const t=e.filters.map(i=>Uh(n,i));return Le.create(t,"or")}}function el(n){if(oe(n instanceof ke||n instanceof Le),n instanceof ke)return n;const e=n.getFilters();if(1===e.length)return el(e[0]);if(Ua(n))return n;const t=e.map(r=>el(r)),i=[];return t.forEach(r=>{r instanceof ke?i.push(r):r instanceof Le&&(r.op===n.op?i.push(...r.filters):i.push(r))}),1===i.length?i[0]:Le.create(i,n.op)}class r_{constructor(){this.Je=new Vh}addToCollectionParentIndex(e,t){return this.Je.add(t),D.resolve()}getCollectionParents(e,t){return D.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return D.resolve()}deleteFieldIndex(e,t){return D.resolve()}getDocumentsMatchingTarget(e,t){return D.resolve(null)}getIndexType(e,t){return D.resolve(0)}getFieldIndexes(e,t){return D.resolve([])}getNextCollectionGroupToUpdate(e){return D.resolve(null)}getMinOffset(e,t){return D.resolve(xt.min())}getMinOffsetFromCollectionGroup(e,t){return D.resolve(xt.min())}updateCollectionGroup(e,t,i){return D.resolve()}updateIndexEntries(e,t){return D.resolve()}}class Vh{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new Be(Ne.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new Be(Ne.comparator)).toArray()}}const tl=new Uint8Array(0);class s_{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new Vh,this.Xe=new Zn(i=>Un(i),(i,r)=>Wr(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:i,parent:It(r)};return ap(e).put(s)}return D.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[fc(t),""],!1,!0);return ap(e).W(r).next(s=>{for(const u of s){if(u.collectionId!==t)break;i.push(fn(u.parent))}return i})}addFieldIndex(e,t){const i=nl(e),r={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])};var u;delete r.indexId;const s=i.add(r);if(t.indexState){const u=du(e);return s.next(h=>{u.put(Xf(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=nl(e),r=du(e),s=hu(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=hu(e);let r=!0;const s=new Map;return D.forEach(this.Ze(t),u=>this.tn(e,u).next(h=>{r&&(r=!!h),s.set(u,h)})).next(()=>{if(r){let u=_e();const h=[];return D.forEach(s,(f,m)=>{var _;Z("IndexedDbIndexManager",`Using index ${_=f,`id=${_.indexId}|cg=${_.collectionGroup}|f=${_.fields.map(Ce=>`${Ce.fieldPath}:${Ce.kind}`).join(",")}`} to execute ${Un(t)}`);const I=function(Ce,we){const ve=$s(we);if(void 0===ve)return null;for(const Te of fo(Ce,ve.fieldPath))switch(Te.op){case"array-contains-any":return Te.value.arrayValue.values||[];case"array-contains":return[Te.value]}return null}(m,f),k=function(Ce,we){const ve=new Map;for(const Te of On(we))for(const yt of fo(Ce,Te.fieldPath))switch(yt.op){case"==":case"in":ve.set(Te.fieldPath.canonicalString(),yt.value);break;case"not-in":case"!=":return ve.set(Te.fieldPath.canonicalString(),yt.value),Array.from(ve.values())}return null}(m,f),U=function(Ce,we){const ve=[];let Te=!0;for(const yt of On(we)){const Du=0===yt.kind?Sc(Ce,yt.fieldPath,Ce.startAt):po(Ce,yt.fieldPath,Ce.startAt);ve.push(Du.value),Te&&(Te=Du.inclusive)}return new Fn(ve,Te)}(m,f),B=function(Ce,we){const ve=[];let Te=!0;for(const yt of On(we)){const Du=0===yt.kind?po(Ce,yt.fieldPath,Ce.endAt):Sc(Ce,yt.fieldPath,Ce.endAt);ve.push(Du.value),Te&&(Te=Du.inclusive)}return new Fn(ve,Te)}(m,f),Y=this.en(f,m,U),se=this.en(f,m,B),Fe=this.nn(f,m,k),Ze=this.sn(f.indexId,I,Y,U.inclusive,se,B.inclusive,Fe);return D.forEach(Ze,Ce=>i.J(Ce,t.limit).next(we=>{we.forEach(ve=>{const Te=H.fromSegments(ve.documentKey);u.has(Te)||(u=u.add(Te),h.push(Te))})}))}).next(()=>h)}return D.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:i_(Le.create(e.filters,"and")).map(i=>qa(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,r,s,u,h){const f=(null!=t?t.length:1)*Math.max(i.length,s.length),m=f/(null!=t?t.length:1),_=[];for(let I=0;I<f;++I){const k=t?this.rn(t[I/m]):tl,U=this.on(e,k,i[I%m],r),B=this.un(e,k,s[I%m],u),Y=h.map(se=>this.on(e,k,se,!0));_.push(...this.createRange(U,B,Y))}return _}on(e,t,i,r){const s=new ss(e,H.empty(),t,i);return r?s:s.Ue()}un(e,t,i,r){const s=new ss(e,H.empty(),t,i);return r?s.Ue():s}tn(e,t){const i=new n_(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let u=null;for(const h of s)i.je(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u})}getIndexType(e,t){let i=2;const r=this.Ze(t);return D.forEach(r,s=>this.tn(e,s).next(u=>{u?0!==i&&u.fields.length<function(h){let f=new Be(et.comparator),m=!1;for(const _ of h.filters)for(const I of _.getFlattenedFilters())I.field.isKeyField()||("array-contains"===I.op||"array-contains-any"===I.op?m=!0:f=f.add(I.field));for(const _ of h.orderBy)_.field.isKeyField()||(f=f.add(_.field));return f.size+(m?1:0)}(s)&&(i=1):i=0})).next(()=>null!==t.limit&&r.length>1&&2===i?1:i)}cn(e,t){const i=new lu;for(const r of On(e)){const s=t.data.field(r.fieldPath);if(null==s)return null;const u=i.qe(r.kind);rs.Ie.ue(s,u)}return i.Fe()}rn(e){const t=new lu;return rs.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new lu;return rs.Ie.ue(In(this.databaseId,t),i.qe(function(r){const s=On(r);return 0===s.length?0:s[s.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(null===i)return[];let r=[];r.push(new lu);let s=0;for(const u of On(e)){const h=i[s++];for(const f of r)if(this.hn(t,u.fieldPath)&&Zi(h))r=this.ln(r,u,h);else{const m=f.qe(u.kind);rs.Ie.ue(h,m)}}return this.fn(r)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const r=[...e],s=[];for(const u of i.arrayValue.values||[])for(const h of r){const f=new lu;f.seed(h.Fe()),rs.Ie.ue(u,f.qe(t.kind)),s.push(f)}return s}hn(e,t){return!!e.filters.find(i=>i instanceof ke&&i.field.isEqual(t)&&("in"===i.op||"not-in"===i.op))}getFieldIndexes(e,t){const i=nl(e),r=du(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(s=>{const u=[];return D.forEach(s,h=>r.get([h.indexId,this.uid]).next(f=>{u.push(function(m,_){const I=_?new Fr(_.sequenceNumber,new xt(ns(_.readTime),new H(fn(_.documentKey)),_.largestBatchId)):Fr.empty(),k=m.fields.map(([U,B])=>new Hs(et.fromServerFormat(U),B));return new Ks(m.indexId,m.collectionGroup,k,I)}(h,f))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return 0!==s?s:pe(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=nl(e),s=du(e);return this.dn(e).next(u=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>D.forEach(h,f=>s.put(Xf(f.indexId,this.user,u,i)))))}updateIndexEntries(e,t){const i=new Map;return D.forEach(t,(r,s)=>{const u=i.get(r.collectionGroup);return(u?D.resolve(u):this.getFieldIndexes(e,r.collectionGroup)).next(h=>(i.set(r.collectionGroup,h),D.forEach(h,f=>this._n(e,r,f).next(m=>{const _=this.wn(s,f);return m.isEqual(_)?D.resolve():this.mn(e,s,f,m,_)}))))})}gn(e,t,i,r){return hu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,r){return hu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const r=hu(e);let s=new Be(tr);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(u,h)=>{s=s.add(new ss(i.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}wn(e,t){let i=new Be(tr);const r=this.cn(t,e);if(null==r)return i;const s=$s(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Zi(u))for(const h of u.arrayValue.values||[])i=i.add(new ss(t.indexId,e.key,this.rn(h),r))}else i=i.add(new ss(t.indexId,e.key,tl,r));return i}mn(e,t,i,r,s){Z("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(h,f,m,_,I){const k=h.getIterator(),U=f.getIterator();let B=zi(k),Y=zi(U);for(;B||Y;){let se=!1,Fe=!1;if(B&&Y){const Ze=m(B,Y);Ze<0?Fe=!0:Ze>0&&(se=!0)}else null!=B?Fe=!0:se=!0;se?(_(Y),Y=zi(U)):Fe?(I(B),B=zi(k)):(B=zi(k),Y=zi(U))}}(r,s,tr,h=>{u.push(this.gn(e,t,i,h))},h=>{u.push(this.yn(e,t,i,h))}),D.waitFor(u)}dn(e){let t=1;return du(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((u,h)=>tr(u,h)).filter((u,h,f)=>!h||0!==tr(u,f[h-1]));const r=[];r.push(e);for(const u of i){const h=tr(u,e),f=tr(u,t);if(0===h)r[0]=e.Ue();else if(h>0&&f<0)r.push(u),r.push(u.Ue());else if(f>0)break}r.push(t);const s=[];for(let u=0;u<r.length;u+=2){if(this.pn(r[u],r[u+1]))return[];s.push(IDBKeyRange.bound([r[u].indexId,this.uid,r[u].arrayValue,r[u].directionalValue,tl,[]],[r[u+1].indexId,this.uid,r[u+1].arrayValue,r[u+1].directionalValue,tl,[]]))}return s}pn(e,t){return tr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(up)}getMinOffset(e,t){return D.mapArray(this.Ze(t),i=>this.tn(e,i).next(r=>r||K())).next(up)}}function ap(n){return wt(n,"collectionParents")}function hu(n){return wt(n,"indexEntries")}function nl(n){return wt(n,"indexConfiguration")}function du(n){return wt(n,"indexState")}function up(n){oe(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Sa(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new xt(e.readTime,e.documentKey,t)}const cp={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Gt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new Gt(e,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function lp(n,e,t){const i=n.store("mutations"),r=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let h=0;const f=i.Z({range:u},(_,I,k)=>(h++,k.delete()));s.push(f.next(()=>{oe(1===h)}));const m=[];for(const _ of t.mutations){const I=zf(e,_.key.path,t.batchId);s.push(r.delete(I)),m.push(_.key)}return D.waitFor(s).next(()=>m)}function il(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw K();e=n.noDocument}return JSON.stringify(e).length}Gt.DEFAULT_COLLECTION_PERCENTILE=10,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Gt.DEFAULT=new Gt(41943040,Gt.DEFAULT_COLLECTION_PERCENTILE,Gt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Gt.DISABLED=new Gt(-1,0,0);class rl{constructor(e,t,i,r){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=r,this.In={}}static re(e,t,i,r){oe(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new rl(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return nr(e).Z({index:"userMutationsIndex",range:i},(r,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=So(e),u=nr(e);return u.add({}).next(h=>{oe("number"==typeof h);const f=new Dh(h,t,i,r),m=function(k,U,B){const Y=B.baseMutations.map(Fe=>g(k.ie,Fe)),se=B.mutations.map(Fe=>g(k.ie,Fe));return{userId:U,batchId:B.batchId,localWriteTimeMs:B.localWriteTime.toMillis(),baseMutations:Y,mutations:se}}(this.yt,this.userId,f),_=[];let I=new Be((k,U)=>pe(k.canonicalString(),U.canonicalString()));for(const k of r){const U=zf(this.userId,k.key.path,h);I=I.add(k.key.path.popLast()),_.push(u.put(m)),_.push(s.put(U,Ng))}return I.forEach(k=>{_.push(this.indexManager.addToCollectionParentIndex(e,k))}),e.addOnCommittedListener(()=>{this.In[h]=f.keys()}),D.waitFor(_).next(()=>f)})}lookupMutationBatch(e,t){return nr(e).get(t).next(i=>i?(oe(i.userId===this.userId),is(this.yt,i)):null)}Tn(e,t){return this.In[t]?D.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.In[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return nr(e).Z({index:"userMutationsIndex",range:r},(u,h,f)=>{h.userId===this.userId&&(oe(h.batchId>=i),s=is(this.yt,h)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return nr(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(r,s,u)=>{i=s.batchId,u.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return nr(e).W("userMutationsIndex",t).next(i=>i.map(r=>is(this.yt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=Co(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return So(e).Z({range:r},(u,h,f)=>{const[m,_,I]=u,k=fn(_);if(m===this.userId&&t.path.isEqual(k))return nr(e).get(I).next(U=>{if(!U)throw K();oe(U.userId===this.userId),s.push(is(this.yt,U))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Be(pe);const r=[];return t.forEach(s=>{const u=Co(this.userId,s.path),h=IDBKeyRange.lowerBound(u),f=So(e).Z({range:h},(m,_,I)=>{const[k,U,B]=m,Y=fn(U);k===this.userId&&s.path.isEqual(Y)?i=i.add(B):I.done()});r.push(f)}),D.waitFor(r).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=Co(this.userId,i),u=IDBKeyRange.lowerBound(s);let h=new Be(pe);return So(e).Z({range:u},(f,m,_)=>{const[I,k,U]=f,B=fn(k);I===this.userId&&i.isPrefixOf(B)?B.length===r&&(h=h.add(U)):_.done()}).next(()=>this.En(e,h))}En(e,t){const i=[],r=[];return t.forEach(s=>{r.push(nr(e).get(s).next(u=>{if(null===u)throw K();oe(u.userId===this.userId),i.push(is(this.yt,u))}))}),D.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return lp(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),D.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return D.resolve();const i=IDBKeyRange.lowerBound([this.userId]),r=[];return So(e).Z({range:i},(s,u,h)=>{if(s[0]===this.userId){const f=fn(s[1]);r.push(f)}else h.done()}).next(()=>{oe(0===r.length)})})}containsKey(e,t){return hp(e,this.userId,t)}Rn(e){return dp(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hp(n,e,t){const i=Co(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let u=!1;return So(n).Z({range:s,X:!0},(h,f,m)=>{const[_,I,k]=h;_===e&&I===r&&(u=!0),m.done()}).next(()=>u)}function nr(n){return wt(n,"mutations")}function So(n){return wt(n,"documentMutations")}function dp(n){return wt(n,"mutationQueues")}class os{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new os(0)}static vn(){return new os(-1)}}class o_{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new os(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>ce.fromTimestamp(new ze(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Do(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(oe(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Do(e).Z((u,h)=>{const f=uu(h);f.sequenceNumber<=t&&null===i.get(f.targetId)&&(r++,s.push(this.removeTargetData(e,f)))}).next(()=>D.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Do(e).Z((i,r)=>{const s=uu(r);t(s)})}Vn(e){return fp(e).get("targetGlobalKey").next(t=>(oe(null!==t),t))}Sn(e,t){return fp(e).put("targetGlobalKey",t)}Dn(e,t){return Do(e).put(Qf(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=Un(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Do(e).Z({range:r,index:"queryTargetsIndex"},(u,h,f)=>{const m=uu(h);Wr(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=ir(e);return t.forEach(u=>{const h=It(u.path);r.push(s.put({targetId:i,path:h})),r.push(this.referenceDelegate.addReference(e,i,u))}),D.waitFor(r)}removeMatchingKeys(e,t,i){const r=ir(e);return D.forEach(t,s=>{const u=It(s.path);return D.waitFor([r.delete([i,u]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=ir(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=ir(e);let s=_e();return r.Z({range:i,X:!0},(u,h,f)=>{const m=fn(u[1]),_=new H(m);s=s.add(_)}).next(()=>s)}containsKey(e,t){const i=It(t.path),r=IDBKeyRange.bound([i],[fc(i)],!1,!0);let s=0;return ir(e).Z({index:"documentTargetsIndex",X:!0,range:r},([u,h],f,m)=>{0!==u&&(s++,m.done())}).next(()=>s>0)}ne(e,t){return Do(e).get(t).next(i=>i?uu(i):null)}}function Do(n){return wt(n,"targets")}function fp(n){return wt(n,"targetGlobal")}function ir(n){return wt(n,"targetDocuments")}function pp([n,e],[t,i]){const r=pe(n,t);return 0===r?pe(e,i):r}class a_{constructor(e){this.xn=e,this.buffer=new Be(pp),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();pp(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class u_{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;Z("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,R.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(i){Mn(i)?Z("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):yield Nn(i)}yield t.Fn(3e5)}))}}class c_{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(0===t)return D.resolve(At.at);const i=new a_(t);return this.$n.forEachTarget(e,r=>i.On(r.sequenceNumber)).next(()=>this.$n.Ln(e,r=>i.On(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(Z("LruGarbageCollector","Garbage collection skipped; disabled"),D.resolve(cp)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(Z("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cp):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,r,s,u,h,f,m;const _=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(I=>(I>this.params.maximumSequenceNumbersToCollect?(Z("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),r=this.params.maximumSequenceNumbersToCollect):r=I,u=Date.now(),this.nthSequenceNumber(e,r))).next(I=>(i=I,h=Date.now(),this.removeTargets(e,i,t))).next(I=>(s=I,f=Date.now(),this.removeOrphanedDocuments(e,i))).next(I=>(m=Date.now(),cc()<=Ie.in.DEBUG&&Z("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-_}ms\n\tDetermined least recently used ${r} in `+(h-u)+`ms\n\tRemoved ${s} targets in `+(f-h)+`ms\n\tRemoved ${I} documents in `+(m-f)+`ms\nTotal Duration: ${m-_}ms`),D.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:I})))}}class l_{constructor(e,t){this.db=e,this.garbageCollector=new c_(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,r)=>t(r))}addReference(e,t,i){return sl(e,i)}removeReference(e,t,i){return sl(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return sl(e,t)}Gn(e,t){return function(i,r){let s=!1;return dp(i).tt(u=>hp(i,u,r).next(h=>(h&&(s=!0),D.resolve(!h)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(e,(u,h)=>{if(h<=t){const f=this.Gn(e,u).next(m=>{if(!m)return s++,i.getEntry(e,u).next(()=>(i.removeEntry(u,ce.min()),ir(e).delete([0,It(u.path)])))});r.push(f)}}).next(()=>D.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return sl(e,t)}Kn(e,t){const i=ir(e);let r,s=At.at;return i.Z({index:"documentTargetsIndex"},([u,h],{path:f,sequenceNumber:m})=>{0===u?(s!==At.at&&t(new H(fn(r)),s),s=m,r=f):s=At.at}).next(()=>{s!==At.at&&t(new H(fn(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function sl(n,e){return ir(n).put((i=n.currentSequenceNumber,{targetId:0,path:It(e.path),sequenceNumber:i}));var i}class mp{constructor(){this.changes=new Zn(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ge.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return void 0!==i?D.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class h_{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return as(e).put(i)}removeEntry(e,t,i){return as(e).delete(function(r,s){const u=r.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],Jc(s),u[u.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=Ge.newInvalidDocument(t);return as(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(fu(t))},(r,s)=>{i=this.jn(t,s)}).next(()=>i)}Wn(e,t){let i={size:0,document:Ge.newInvalidDocument(t)};return as(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(fu(t))},(r,s)=>{i={document:this.jn(t,s),size:il(s)}}).next(()=>i)}getEntries(e,t){let i=Ct();return this.zn(e,t,(r,s)=>{const u=this.jn(r,s);i=i.insert(r,u)}).next(()=>i)}Hn(e,t){let i=Ct(),r=new tt(H.comparator);return this.zn(e,t,(s,u)=>{const h=this.jn(s,u);i=i.insert(s,h),r=r.insert(s,il(u))}).next(()=>({documents:i,Jn:r}))}zn(e,t,i){if(t.isEmpty())return D.resolve();let r=new Be(vp);t.forEach(f=>r=r.add(f));const s=IDBKeyRange.bound(fu(r.first()),fu(r.last())),u=r.getIterator();let h=u.getNext();return as(e).Z({index:"documentKeyIndex",range:s},(f,m,_)=>{const I=H.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;h&&vp(h,I)<0;)i(h,null),h=u.getNext();h&&h.isEqual(I)&&(i(h,m),h=u.hasNext()?u.getNext():null),h?_.j(fu(h)):_.done()}).next(()=>{for(;h;)i(h,null),h=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,i){const r=[t.popLast().toArray(),t.lastSegment(),Jc(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return as(e).W(IDBKeyRange.bound(r,s,!0)).next(u=>{let h=Ct();for(const f of u){const m=this.jn(H.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);h=h.insert(m.key,m)}return h})}getAllFromCollectionGroup(e,t,i,r){let s=Ct();const u=yp(t,i),h=yp(t,xt.max());return as(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,h,!0)},(f,m,_)=>{const I=this.jn(H.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(I.key,I),s.size===r&&_.done()}).next(()=>s)}newChangeBuffer(e){return new d_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _p(e).get("remoteDocumentGlobalKey").next(t=>(oe(!!t),t))}Qn(e,t){return _p(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=function Yg(n,e){let t;if(e.document)t=a(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=H.fromSegments(e.noDocument.path),r=ns(e.noDocument.readTime);t=Ge.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return K();{const i=H.fromSegments(e.unknownDocument.path),r=ns(e.unknownDocument.version);t=Ge.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(i){const r=new ze(i[0],i[1]);return ce.fromTimestamp(r)}(e.readTime)),t}(this.yt,t);if(!i.isNoDocument()||!i.version.isEqual(ce.min()))return i}return Ge.newInvalidDocument(e)}}function gp(n){return new h_(n)}class d_ extends mp{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Zn(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new Be((s,u)=>pe(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const h=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,h.readTime)),u.isValidDocument()){const f=Yf(this.Yn.yt,u);r=r.add(s.path.popLast()),i+=il(f)-h.size,t.push(this.Yn.addEntry(e,s,f))}else if(i-=h.size,this.trackRemovals){const f=Yf(this.Yn.yt,u.convertToNoDocument(ce.min()));t.push(this.Yn.addEntry(e,s,f))}}),r.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,i)),D.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:r})=>(r.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:i.get(s).readTime})}),i))}}function _p(n){return wt(n,"remoteDocumentGlobal")}function as(n){return wt(n,"remoteDocumentsV14")}function fu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function yp(n,e){const t=e.documentKey.path.toArray();return[n,Jc(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vp(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=pe(t[s],i[s]),r)return r;return r=pe(t.length,i.length),r||(r=pe(t[t.length-2],i[i.length-2]),r||pe(t[t.length-1],i[i.length-1]))}class f_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ip{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==i&&Kr(i.mutation,r,kt.empty(),ze.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,_e()).next(()=>i))}getLocalViewOfDocuments(e,t,i=_e()){const r=ln();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let u=di();return s.forEach((h,f)=>{u=u.insert(h,f.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const i=ln();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,_e()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((u,h)=>{t.set(u,h)})})}computeViews(e,t,i,r){let s=Ct();const u=Hr(),h=Hr();return t.forEach((f,m)=>{const _=i.get(m.key);r.has(m.key)&&(void 0===_||_.mutation instanceof Tn)?s=s.insert(m.key,m):void 0!==_&&(u.set(m.key,_.mutation.getFieldMask()),Kr(_.mutation,m,_.mutation.getFieldMask(),ze.now()))}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,_)=>u.set(m,_)),t.forEach((m,_)=>{var I;return h.set(m,new f_(_,null!==(I=u.get(m))&&void 0!==I?I:null))}),h))}recalculateAndSaveOverlays(e,t){const i=Hr();let r=new tt((u,h)=>u-h),s=_e();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const h of u)h.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let _=i.get(f)||kt.empty();_=h.applyToLocalView(m,_),i.set(f,_);const I=(r.get(h.batchId)||_e()).add(f);r=r.insert(h.batchId,I)})}).next(()=>{const u=[],h=r.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,_=f.value,I=bo();_.forEach(k=>{if(!s.has(k)){const U=wo(t.get(k),i.get(k));null!==U&&I.set(k,U),s=s.add(k)}}),u.push(this.documentOverlayCache.saveOverlays(e,m,I))}return D.waitFor(u)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return H.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):za(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i);var r}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const u=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):D.resolve(ln());let h=-1,f=s;return u.next(m=>D.forEach(m,(_,I)=>(h<I.largestBatchId&&(h=I.largestBatchId),s.get(_)?D.resolve():this.remoteDocumentCache.getEntry(e,_).next(k=>{f=f.insert(_,k)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,_e())).next(_=>({batchId:h,changes:Ja(_)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new H(t)).next(i=>{let r=di();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const r=t.collectionGroup;let s=di();return this.indexManager.getCollectionParents(e,r).next(u=>D.forEach(u,h=>{const f=(m=t,_=h.child(r),new wn(_,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,_;return this.getDocumentsMatchingCollectionQuery(e,f,i).next(m=>{m.forEach((_,I)=>{s=s.insert(_,I)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,i).next(s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId))).next(s=>{s.forEach((h,f)=>{const m=f.getKey();null===r.get(m)&&(r=r.insert(m,Ge.newInvalidDocument(m)))});let u=di();return r.forEach((h,f)=>{const m=s.get(h);void 0!==m&&Kr(m.mutation,f,kt.empty(),ze.now()),_o(t,f)&&(u=u.insert(h,f))}),u})}}class p_{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return D.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:nt(i.createTime)}),D.resolve()}getNamedQuery(e,t){return D.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(i=t).name,query:Nh(i.bundledQuery),readTime:nt(i.readTime)}),D.resolve();var i}}class m_{constructor(){this.overlays=new tt(H.comparator),this.es=new Map}getOverlay(e,t){return D.resolve(this.overlays.get(t))}getOverlays(e,t){const i=ln();return D.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.oe(e,t,s)}),D.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.es.get(i);return void 0!==r&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(i)),D.resolve()}getOverlaysForCollection(e,t,i){const r=ln(),s=t.length+1,u=new H(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>i&&r.set(f.getKey(),f)}return D.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new tt((m,_)=>m-_);const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>i){let _=s.get(m.largestBatchId);null===_&&(_=ln(),s=s.insert(m.largestBatchId,_)),_.set(m.getKey(),m)}}const h=ln(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,_)=>h.set(m,_)),!(h.size()>=r)););return D.resolve(h)}oe(e,t,i){const r=this.overlays.get(i.key);if(null!==r){const u=this.es.get(r.largestBatchId).delete(i.key);this.es.set(r.largestBatchId,u)}this.overlays=this.overlays.insert(i.key,new Oh(t,i));let s=this.es.get(t);void 0===s&&(s=_e(),this.es.set(t,s)),this.es.set(t,s.add(i.key))}}class Bh{constructor(){this.ns=new Be(Et.ss),this.rs=new Be(Et.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new Et(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new Et(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new H(new Ne([])),i=new Et(t,e),r=new Et(t,e+1),s=[];return this.rs.forEachInRange([i,r],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new H(new Ne([])),i=new Et(t,e),r=new Et(t,e+1);let s=_e();return this.rs.forEachInRange([i,r],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new Et(e,0),i=this.ns.firstAfterOrEqual(t);return null!==i&&e.isEqual(i.key)}}class Et{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return H.comparator(e.key,t.key)||pe(e._s,t._s)}static os(e,t){return pe(e._s,t._s)||H.comparator(e.key,t.key)}}class g_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new Be(Et.ss)}checkEmpty(e){return D.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,i,r){const s=this.ws;this.ws++;const u=new Dh(s,t,i,r);this.mutationQueue.push(u);for(const h of r)this.gs=this.gs.add(new Et(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return D.resolve(u)}lookupMutationBatch(e,t){return D.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.ps(t+1),s=r<0?0:r;return D.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return D.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return D.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new Et(t,0),r=new Et(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([i,r],u=>{const h=this.ys(u._s);s.push(h)}),D.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new Be(pe);return t.forEach(r=>{const s=new Et(r,0),u=new Et(r,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],h=>{i=i.add(h._s)})}),D.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;H.isDocumentKey(s)||(s=s.child(""));const u=new Et(new H(s),0);let h=new Be(pe);return this.gs.forEachWhile(f=>{const m=f.key.path;return!!i.isPrefixOf(m)&&(m.length===r&&(h=h.add(f._s)),!0)},u),D.resolve(this.Is(h))}Is(e){const t=[];return e.forEach(i=>{const r=this.ys(i);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){oe(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return D.forEach(t.mutations,r=>{const s=new Et(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new Et(t,0),r=this.gs.firstAfterOrEqual(i);return D.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return D.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class __{constructor(e){this.Es=e,this.docs=new tt(H.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,u=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return D.resolve(i?i.document.mutableCopy():Ge.newInvalidDocument(t))}getEntries(e,t){let i=Ct();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():Ge.newInvalidDocument(r))}),D.resolve(i)}getAllFromCollection(e,t,i){let r=Ct();const s=new H(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!t.isPrefixOf(h.path))break;h.path.length>t.length+1||Sa(mc(f),i)<=0||(r=r.insert(f.key,f.mutableCopy()))}return D.resolve(r)}getAllFromCollectionGroup(e,t,i,r){K()}As(e,t){return D.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new y_(this)}getSize(e){return D.resolve(this.size)}}class y_ extends mp{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(i)}),D.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class v_{constructor(e){this.persistence=e,this.Rs=new Zn(t=>Un(t),Wr),this.lastRemoteSnapshotVersion=ce.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Bh,this.targetCount=0,this.vs=os.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,r)=>t(r)),D.resolve()}getLastRemoteSnapshotVersion(e){return D.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return D.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),D.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),D.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new os(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,D.resolve()}updateTargetData(e,t){return this.Dn(t),D.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,D.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.Rs.forEach((u,h)=>{h.sequenceNumber<=t&&null===i.get(h.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),r++)}),D.waitFor(s).next(()=>r)}getTargetCount(e){return D.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return D.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),D.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(u=>{s.push(r.markPotentiallyOrphaned(e,u))}),D.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),D.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return D.resolve(i)}containsKey(e,t){return D.resolve(this.Ps.containsKey(t))}}class wp{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new At(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new v_(this),this.indexManager=new r_,this.remoteDocumentCache=new __(i=>this.referenceDelegate.xs(i)),this.yt=new Hf(t),this.Ns=new p_(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new m_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new g_(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){Z("MemoryPersistence","Starting transaction:",e);const r=new I_(this.Ss.next());return this.referenceDelegate.ks(),i(r).next(s=>this.referenceDelegate.Os(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ms(e,t){return D.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class I_ extends _c{constructor(e){super(),this.currentSequenceNumber=e}}class ol{constructor(e){this.persistence=e,this.Fs=new Bh,this.$s=null}static Bs(e){return new ol(e)}get Ls(){if(this.$s)return this.$s;throw K()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),D.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),D.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),D.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(r=>this.Ls.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Ls.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return D.forEach(this.Ls,i=>{const r=H.fromPath(i);return this.qs(e,r).next(s=>{s||t.removeEntry(r,ce.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return D.or([()=>D.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class w_{constructor(e){this.yt=e}$(e,t,i,r){const s=new Qs("createOrUpgrade",t);var h;i<1&&r>=1&&(e.createObjectStore("owner"),(h=e).createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ko,{unique:!0}),h.createObjectStore("documentMutations"),Ep(e),function(h){h.createObjectStore("remoteDocuments")}(e));let u=D.resolve();return i<3&&r>=3&&(0!==i&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),Ep(e)),u=u.next(()=>function(h){const f=h.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:ce.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),i<4&&r>=4&&(0!==i&&(u=u.next(()=>function(h,f){return f.store("mutations").W().next(m=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",ko,{unique:!0});const _=f.store("mutations"),I=m.map(k=>_.put(k));return D.waitFor(I)})}(e,s))),u=u.next(()=>{!function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),i<5&&r>=5&&(u=u.next(()=>this.Us(s))),i<6&&r>=6&&(u=u.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),i<7&&r>=7&&(u=u.next(()=>this.Gs(s))),i<8&&r>=8&&(u=u.next(()=>this.Qs(e,s))),i<9&&r>=9&&(u=u.next(()=>{!function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")}(e)})),i<10&&r>=10&&(u=u.next(()=>this.js(s))),i<11&&r>=11&&(u=u.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(u=u.next(()=>{!function(h){const f=h.createObjectStore("documentOverlays",{keyPath:zg});f.createIndex("collectionPathOverlayIndex",jg,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",Kg,{unique:!1})}(e)})),i<13&&r>=13&&(u=u.next(()=>function(h){const f=h.createObjectStore("remoteDocumentsV14",{keyPath:Mg});f.createIndex("documentKeyIndex",Pg),f.createIndex("collectionGroupIndex",Lg)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(u=u.next(()=>this.zs(e,s))),i<15&&r>=15&&(u=u.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:Zg}).createIndex("sequenceNumberIndex",qg,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:Gg}).createIndex("documentKeyIndex",Wg,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,r)=>{t+=il(r)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(r=>D.forEach(r,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",u).next(h=>D.forEach(h,f=>{oe(f.userId===s.userId);const m=is(this.yt,f);return lp(e,s.userId,m).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const s=[];return i.Z((u,h)=>{const f=new Ne(u),m=[0,It(f)];s.push(t.get(m).next(_=>_?D.resolve():t.put({targetId:0,path:It(f),sequenceNumber:r.highestListenSequenceNumber})))}).next(()=>D.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:Bg});const i=t.store("collectionParents"),r=new Vh,s=u=>{if(r.add(u)){const h=u.lastSegment(),f=u.popLast();return i.put({collectionId:h,parent:It(f)})}};return t.store("remoteDocuments").Z({X:!0},(u,h)=>{const f=new Ne(u);return s(f.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,h,f],m)=>{const _=fn(h);return s(_.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,r)=>{const s=uu(r),u=Qf(this.yt,s);return t.put(u)})}Ws(e,t){const i=t.store("remoteDocuments"),r=[];return i.Z((s,u)=>{const h=t.store("remoteDocumentsV14"),f=(m=u,m.document?new H(Ne.fromString(m.document.name).popFirst(5)):m.noDocument?H.fromSegments(m.noDocument.path):m.unknownDocument?H.fromSegments(m.unknownDocument.path):K()).path.toArray();var m;const _={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};r.push(h.put(_))}).next(()=>D.waitFor(r))}zs(e,t){const i=t.store("mutations"),r=gp(this.yt),s=new wp(ol.Bs,this.yt.ie);return i.W().next(u=>{const h=new Map;return u.forEach(f=>{var m;let _=null!==(m=h.get(f.userId))&&void 0!==m?m:_e();is(this.yt,f).keys().forEach(I=>_=_.add(I)),h.set(f.userId,_)}),D.forEach(h,(f,m)=>{const _=new dt(m),I=Xc.re(this.yt,_),k=s.getIndexManager(_),U=rl.re(_,this.yt,k,s.referenceDelegate);return new Ip(r,U,I,k).recalculateAndSaveOverlaysForDocumentKeys(new Sh(t,At.at),f).next()})})}}function Ep(n){n.createObjectStore("targetDocuments",{keyPath:Ug}).createIndex("documentTargetsIndex",Vg,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",Fg,{unique:!0}),n.createObjectStore("targetGlobal")}const Zh="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class qh{constructor(e,t,i,r,s,u,h,f,m,_,I=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=s,this.window=u,this.document=h,this.Js=m,this.Ys=_,this.Xs=I,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=k=>Promise.resolve(),!qh.C())throw new V(N.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new l_(this,r),this.ii=t+"main",this.yt=new Hf(f),this.ri=new Ht(this.ii,this.Xs,new w_(this.yt)),this.Cs=new o_(this.referenceDelegate,this.yt),this.remoteDocumentCache=gp(this.yt),this.Ns=new Qg,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===_&&it("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new V(N.FAILED_PRECONDITION,Zh);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new At(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var i=(0,R.Z)(function*(r){if(t.started)return e(r)});return function(r){return i.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,R.Z)(function*(i){null===i.newVersion&&(yield e())});return function(i){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,R.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>al(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Mn(e))return Z("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return Z("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return pu(e).get("owner").next(t=>D.resolve(this.mi(t)))}gi(e){return al(e).delete(this.clientId)}yi(){var e=this;return(0,R.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",i=>{const r=wt(i,"clientMetadata");return r.W().next(s=>{const u=e.Ii(s,18e5),h=s.filter(f=>-1===u.indexOf(f));return D.forEach(h,f=>r.delete(f.clientId)).next(()=>h)})}).catch(()=>[]);if(e.oi)for(const i of t)e.oi.removeItem(e.Ti(i.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?D.resolve(!0):pu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new V(N.FAILED_PRECONDITION,Zh);return!1}}return!(!this.networkEnabled||!this.inForeground)||al(e).W().next(i=>void 0===this.Ii(i,5e3).find(r=>{if(this.clientId!==r.clientId){const u=!this.inForeground&&r.inForeground,h=this.networkEnabled===r.networkEnabled;if(!this.networkEnabled&&r.networkEnabled||u&&h)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&Z("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,R.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const i=new Sh(t,At.at);return e._i(i).next(()=>e.gi(i))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>al(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return rl.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new s_(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return Xc.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){Z("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?Hg:14===u?$f:13===u?Kf:12===u?$g:11===u?jf:void K();var u;let h;return this.ri.runTransaction(e,r,s,f=>(h=new Sh(f,this.Ss?this.Ss.next():At.at),"readwrite-primary"===t?this.fi(h).next(m=>!!m||this.di(h)).next(m=>{if(!m)throw it(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new V(N.FAILED_PRECONDITION,gc);return i(h)}).next(m=>this.wi(h).next(()=>m)):this.Vi(h).next(()=>i(h)))).then(f=>(h.raiseOnCommittedEvent(),f))}Vi(e){return pu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new V(N.FAILED_PRECONDITION,Zh)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return pu(e).put("owner",t)}static C(){return Ht.C()}_i(e){const t=pu(e);return t.get("owner").next(i=>this.mi(i)?(Z("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):D.resolve())}pi(e,t){const i=Date.now();return!(e<i-t||e>i&&(it(`Detected an update time that is in the future: ${e} > ${i}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,J.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return Z("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return it("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){it("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function pu(n){return wt(n,"owner")}function al(n){return wt(n,"clientMetadata")}function Gh(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class Wh{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=r}static Ci(e,t){let i=_e(),r=_e();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new Wh(e,t.fromCache,i,r)}}class Tp{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,r){return this.ki(e,t).next(s=>s||this.Oi(e,t,r,i)).next(s=>s||this.Mi(e,t))}ki(e,t){if(Ga(t))return D.resolve(null);let i=vt(t);return this.indexManager.getIndexType(e,i).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=go(t,null,"F"),i=vt(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const u=_e(...s);return this.Ni.getDocuments(e,u).next(h=>this.indexManager.getMinOffset(e,i).next(f=>{const m=this.Fi(t,h);return this.$i(t,m,u,f.readTime)?this.ki(e,go(t,null,"F")):this.Bi(e,m,t,f)}))})))}Oi(e,t,i,r){return Ga(t)||r.isEqual(ce.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,i,r)?this.Mi(e,t):(cc()<=Ie.in.DEBUG&&Z("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Ka(t)),this.Bi(e,u,t,pc(r,-1)))})}Fi(e,t){let i=new Be(Th(e));return t.forEach((r,s)=>{_o(e,s)&&(i=i.add(s))}),i}$i(e,t,i,r){if(null===e.limit)return!1;if(i.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(e,t){return cc()<=Ie.in.DEBUG&&Z("QueryEngine","Using full collection scan to execute query:",Ka(t)),this.Ni.getDocumentsMatchingQuery(e,t,xt.min())}Bi(e,t,i,r){return this.Ni.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class E_{constructor(e,t,i,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new tt(pe),this.Ui=new Zn(s=>Un(s),Wr),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ip(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function bp(n,e,t,i){return new E_(n,e,t,i)}function xp(n,e){return zh.apply(this,arguments)}function zh(){return zh=(0,R.Z)(function*(n,e){const t=Q(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const u=[],h=[];let f=_e();for(const m of r){u.push(m.batchId);for(const _ of m.mutations)f=f.add(_.key)}for(const m of s){h.push(m.batchId);for(const _ of m.mutations)f=f.add(_.key)}return t.localDocuments.getDocuments(i,f).next(m=>({ji:m,removedBatchIds:u,addedBatchIds:h}))})})}),zh.apply(this,arguments)}function T_(n,e){const t=Q(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,h,f,m){const _=f.batch,I=_.keys();let k=D.resolve();return I.forEach(U=>{k=k.next(()=>m.getEntry(h,U)).next(B=>{const Y=f.docVersions.get(U);oe(null!==Y),B.version.compareTo(Y)<0&&(_.applyToRemoteDocument(B,f),B.isValidDocument()&&(B.setReadTime(f.commitVersion),m.addEntry(B)))})}),k.next(()=>u.mutationQueue.removeMutationBatch(h,_))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(u){let h=_e();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function Ap(n){const e=Q(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function b_(n,e){const t=Q(n),i=e.snapshotVersion;let r=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});r=t.qi;const h=[];e.targetChanges.forEach((_,I)=>{const k=r.get(I);if(!k)return;h.push(t.Cs.removeMatchingKeys(s,_.removedDocuments,I).next(()=>t.Cs.addMatchingKeys(s,_.addedDocuments,I)));let U=k.withSequenceNumber(s.currentSequenceNumber);var B,Y,se;e.targetMismatches.has(I)?U=U.withResumeToken(rt.EMPTY_BYTE_STRING,ce.min()).withLastLimboFreeSnapshotVersion(ce.min()):_.resumeToken.approximateByteSize()>0&&(U=U.withResumeToken(_.resumeToken,i)),r=r.insert(I,U),Y=U,se=_,(0===(B=k).resumeToken.approximateByteSize()||Y.snapshotVersion.toMicroseconds()-B.snapshotVersion.toMicroseconds()>=3e8||se.addedDocuments.size+se.modifiedDocuments.size+se.removedDocuments.size>0)&&h.push(t.Cs.updateTargetData(s,U))});let f=Ct(),m=_e();if(e.documentUpdates.forEach(_=>{e.resolvedLimboDocuments.has(_)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,_))}),h.push(kp(s,u,e.documentUpdates).next(_=>{f=_.Wi,m=_.zi})),!i.isEqual(ce.min())){const _=t.Cs.getLastRemoteSnapshotVersion(s).next(I=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,i));h.push(_)}return D.waitFor(h).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.qi=r,s))}function kp(n,e,t){let i=_e(),r=_e();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let u=Ct();return t.forEach((h,f)=>{const m=s.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(h)),f.isNoDocument()&&f.version.isEqual(ce.min())?(e.removeEntry(h,f.readTime),u=u.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(h,f)):Z("LocalStore","Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)}),{Wi:u,zi:r}})}function x_(n,e){const t=Q(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function Ro(n,e){const t=Q(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Cs.getTargetData(i,e).next(s=>s?(r=s,D.resolve(r)):t.Cs.allocateTargetId(i).next(u=>(r=new er(e,u,0,i.currentSequenceNumber),t.Cs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.qi.get(i.targetId);return(null===r||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}function Oo(n,e,t){return jh.apply(this,arguments)}function jh(){return jh=(0,R.Z)(function*(n,e,t){const i=Q(n),r=i.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,u=>i.persistence.referenceDelegate.removeTarget(u,r)))}catch(u){if(!Mn(u))throw u;Z("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}i.qi=i.qi.remove(e),i.Ui.delete(r.target)}),jh.apply(this,arguments)}function ul(n,e,t){const i=Q(n);let r=ce.min(),s=_e();return i.persistence.runTransaction("Execute query","readonly",u=>function(h,f,m){const _=Q(h),I=_.Ui.get(m);return void 0!==I?D.resolve(_.qi.get(I)):_.Cs.getTargetData(f,m)}(i,u,vt(e)).next(h=>{if(h)return r=h.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(u,h.targetId).next(f=>{s=f})}).next(()=>i.Li.getDocumentsMatchingQuery(u,e,t?r:ce.min(),t?s:_e())).next(h=>(Dp(i,Rc(e),h),{documents:h,Hi:s})))}function Cp(n,e){const t=Q(n),i=Q(t.Cs),r=t.qi.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ne(s,e).next(u=>u?u.target:null))}function Sp(n,e){const t=Q(n),i=t.Ki.get(e)||ce.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.Gi.getAllFromCollectionGroup(r,e,pc(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(Dp(t,e,r),r))}function Dp(n,e,t){let i=n.Ki.get(e)||ce.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ki.set(e,i)}function Kh(){return Kh=(0,R.Z)(function*(n,e,t,i){const r=Q(n);let s=_e(),u=Ct();for(const m of t){const _=e.Ji(m.metadata.name);m.document&&(s=s.add(_));const I=e.Yi(m);I.setReadTime(e.Xi(m.metadata.readTime)),u=u.insert(_,I)}const h=r.Gi.newChangeBuffer({trackRemovals:!0}),f=yield Ro(r,(m=i,vt(ji(Ne.fromString(`__bundle__/docs/${m}`)))));var m;return r.persistence.runTransaction("Apply bundle documents","readwrite",m=>kp(m,h,u).next(_=>(h.apply(m),_)).next(_=>r.Cs.removeMatchingKeysForTargetId(m,f.targetId).next(()=>r.Cs.addMatchingKeys(m,s,f.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(m,_.Wi,_.zi)).next(()=>_.Wi)))}),Kh.apply(this,arguments)}function k_(n,e){return $h.apply(this,arguments)}function $h(){return $h=(0,R.Z)(function*(n,e,t=_e()){const i=yield Ro(n,vt(Nh(e.bundledQuery))),r=Q(n);return r.persistence.runTransaction("Save named query","readwrite",s=>{const u=nt(e.readTime);if(i.snapshotVersion.compareTo(u)>=0)return r.Ns.saveNamedQuery(s,e);const h=i.withResumeToken(rt.EMPTY_BYTE_STRING,u);return r.qi=r.qi.insert(h.targetId,h),r.Cs.updateTargetData(s,h).next(()=>r.Cs.removeMatchingKeysForTargetId(s,i.targetId)).next(()=>r.Cs.addMatchingKeys(s,t,i.targetId)).next(()=>r.Ns.saveNamedQuery(s,e))})}),$h.apply(this,arguments)}function Rp(n,e){return`firestore_clients_${n}_${e}`}function Op(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function Hh(n,e){return`firestore_targets_${n}_${e}`}class cl{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Zi(e,t,i){const r=JSON.parse(i);let s,u="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return u&&r.error&&(u="string"==typeof r.error.message&&"string"==typeof r.error.code,u&&(s=new V(r.error.code,r.error.message))),u?new cl(e,t,r.state,s):(it("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class mu{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Zi(e,t){const i=JSON.parse(t);let r,s="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code,s&&(r=new V(i.error.code,i.error.message))),s?new mu(e,i.state,r):(it("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class ll{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const i=JSON.parse(t);let r="object"==typeof i&&i.activeTargetIds instanceof Array,s=Ji();for(let u=0;r&&u<i.activeTargetIds.length;++u)r=yc(i.activeTargetIds[u]),s=s.add(i.activeTargetIds[u]);return r?new ll(e,s):(it("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Yh{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Yh(t.clientId,t.onlineState):(it("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Qh{constructor(){this.activeTargetIds=Ji()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class Jh{constructor(e,t,i,r,s){this.window=e,this.Hs=t,this.persistenceKey=i,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new tt(pe),this.started=!1,this.cr=[];const u=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Rp(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new Qh),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,R.Z)(function*(){const t=yield e.syncEngine.vi();for(const r of t){if(r===e.sr)continue;const s=e.getItem(Rp(e.persistenceKey,r));if(s){const u=ll.Zi(r,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const i=e.storage.getItem(e.wr);if(i){const r=e.yr(i);r&&e.pr(r)}for(const r of e.cr)e.rr(r);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,i){this.Tr(e,t,i),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(Hh(this.persistenceKey,e));if(i){const r=mu.Zi(e,i);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(Hh(this.persistenceKey,e))}updateQueryState(e,t,i){this.Rr(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Er(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return Z("SharedClientState","READ",e,t),t}setItem(e,t){Z("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){Z("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const i=e;if(i.storageArea===this.storage){if(Z("SharedClientState","EVENT",i.key,i.newValue),i.key===this.ar)return void it("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,R.Z)(function*(){if(t.started){if(null!==i.key)if(t.lr.test(i.key)){if(null==i.newValue){const r=t.vr(i.key);return t.Vr(r,null)}{const r=t.Sr(i.key,i.newValue);if(r)return t.Vr(r.clientId,r)}}else if(t.dr.test(i.key)){if(null!==i.newValue){const r=t.Dr(i.key,i.newValue);if(r)return t.Cr(r)}}else if(t._r.test(i.key)){if(null!==i.newValue){const r=t.Nr(i.key,i.newValue);if(r)return t.kr(r)}}else if(i.key===t.wr){if(null!==i.newValue){const r=t.yr(i.newValue);if(r)return t.pr(r)}}else if(i.key===t.hr){const r=function(s){let u=At.at;if(null!=s)try{const h=JSON.parse(s);oe("number"==typeof h),u=h}catch(h){it("SharedClientState","Failed to read sequence number from WebStorage",h)}return u}(i.newValue);r!==At.at&&t.sequenceNumberHandler(r)}else if(i.key===t.mr){const r=t.Or(i.newValue);yield Promise.all(r.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(i)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,i){const r=new cl(this.currentUser,e,t,i),s=Op(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){const t=Op(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,i){const r=Hh(this.persistenceKey,e),s=new mu(e,t,i);this.setItem(r,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const i=this.vr(e);return ll.Zi(i,t)}Dr(e,t){const i=this.dr.exec(e),r=Number(i[1]);return cl.Zi(new dt(void 0!==i[2]?i[2]:null),r,t)}Nr(e,t){const i=this._r.exec(e),r=Number(i[1]);return mu.Zi(r,t)}yr(e){return Yh.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,R.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);Z("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const i=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(i),u=[],h=[];return s.forEach(f=>{r.has(f)||u.push(f)}),r.forEach(f=>{s.has(f)||h.push(f)}),this.syncEngine.Br(u,h).then(()=>{this.ur=i})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=Ji();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class Np{constructor(){this.Lr=new Qh,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Qh,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class C_{Ur(e){}shutdown(){}}class Mp{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){Z("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){Z("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const S_={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class D_{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class R_ extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,r,s){const u=this.ho(e,t);Z("RestConnection","Sending: ",u,i);const h={};return this.lo(h,r,s),this.fo(e,u,h,i).then(f=>(Z("RestConnection","Received: ",f),f),f=>{throw $t("RestConnection",`${e} failed with error: `,f,"url: ",u,"request:",i),f})}_o(e,t,i,r,s,u){return this.ao(e,t,i,r,s)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Pr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}ho(e,t){return`${this.oo}/v1/${t}:${S_[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,r){return new Promise((s,u)=>{const h=new uh;h.setWithCredentials(!0),h.listenOnce(Ea.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case wa.NO_ERROR:const m=h.getResponseJson();Z("Connection","XHR received:",JSON.stringify(m)),s(m);break;case wa.TIMEOUT:Z("Connection",'RPC "'+e+'" timed out'),u(new V(N.DEADLINE_EXCEEDED,"Request time out"));break;case wa.HTTP_ERROR:const _=h.getStatus();if(Z("Connection",'RPC "'+e+'" failed with status:',_,"response text:",h.getResponseText()),_>0){let I=h.getResponseJson();Array.isArray(I)&&(I=I[0]);const k=null==I?void 0:I.error;if(k&&k.status&&k.message){const U=function(B){const Y=B.toLowerCase().replace(/_/g,"-");return Object.values(N).indexOf(Y)>=0?Y:N.UNKNOWN}(k.status);u(new V(U,k.message))}else u(new V(N.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new V(N.UNAVAILABLE,"Connection failed."));break;default:K()}}finally{Z("Connection",'RPC "'+e+'" completed.')}});const f=JSON.stringify(r);h.send(t,"POST",f,i,15)})}wo(e,t,i){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=oh(),u=ah(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(h.xmlHttpFactory=new Ws({})),this.lo(h.initMessageHeaders,t,i),h.encodeInitMessageHeaders=!0;const f=r.join("");Z("Connection","Creating WebChannel: "+f,h);const m=s.createWebChannel(f,h);let _=!1,I=!1;const k=new D_({Hr:B=>{I?Z("Connection","Not sending because WebChannel is closed:",B):(_||(Z("Connection","Opening WebChannel transport."),m.open(),_=!0),Z("Connection","WebChannel sending:",B),m.send(B))},Jr:()=>m.close()}),U=(B,Y,se)=>{B.listen(Y,Fe=>{try{se(Fe)}catch(Ze){setTimeout(()=>{throw Ze},0)}})};return U(m,Mr.EventType.OPEN,()=>{I||Z("Connection","WebChannel transport opened.")}),U(m,Mr.EventType.CLOSE,()=>{I||(I=!0,Z("Connection","WebChannel transport closed"),k.io())}),U(m,Mr.EventType.ERROR,B=>{I||(I=!0,$t("Connection","WebChannel transport errored:",B),k.io(new V(N.UNAVAILABLE,"The operation could not be completed")))}),U(m,Mr.EventType.MESSAGE,B=>{var Y;if(!I){const se=B.data[0];oe(!!se);const Fe=se,Ze=Fe.error||(null===(Y=Fe[0])||void 0===Y?void 0:Y.error);if(Ze){Z("Connection","WebChannel received error:",Ze);const Ce=Ze.status;let we=function(Te){const yt=st[Te];if(void 0!==yt)return Wc(yt)}(Ce),ve=Ze.message;void 0===we&&(we=N.INTERNAL,ve="Unknown error status: "+Ce+" with message "+Ze.message),I=!0,k.io(new V(we,ve)),m.close()}else Z("Connection","WebChannel received:",se),k.ro(se)}}),U(u,Ta.STAT_EVENT,B=>{B.stat===ac.PROXY?Z("Connection","Detected buffering proxy"):B.stat===ac.NOPROXY&&Z("Connection","Detected no buffering proxy")}),setTimeout(()=>{k.so()},0),k}}function Pp(){return"undefined"!=typeof window?window:null}function hl(){return"undefined"!=typeof document?document:null}function gu(n){return new tu(n,!0)}class Xh{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-i);r>0&&Z("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Lp{constructor(e,t,i,r,s,u,h,f){this.Hs=e,this.vo=i,this.Vo=r,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Xh(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,R.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,R.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var i=this;return(0,R.Z)(function*(){i.Lo(),i.qo(),i.xo.cancel(),i.So++,4!==e?i.xo.reset():t&&t.code===N.RESOURCE_EXHAUSTED?(it(t.toString()),it("Using maximum backoff delay to prevent overloading the backend."),i.xo.Ao()):t&&t.code===N.UNAUTHENTICATED&&3!==i.state&&(i.authCredentialsProvider.invalidateToken(),i.appCheckCredentialsProvider.invalidateToken()),null!==i.stream&&(i.Uo(),i.stream.close(),i.stream=null),i.state=e,yield i.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.So===t&&this.Go(i,r)},i=>{e(()=>{const r=new V(N.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(r)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(r=>{i(()=>this.Qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,R.Z)(function*(){e.state=0,e.start()}))}Qo(e){return Z("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(Z("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class O_ extends Lp{constructor(e,t,i,r,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,u),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function p(n,e){let t;if("targetChange"in e){const i="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:K(),r=e.targetChange.targetIds||[],s=function(f,m){return f.wt?(oe(void 0===m||"string"==typeof m),rt.fromBase64String(m||"")):(oe(void 0===m||m instanceof Uint8Array),rt.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&function(f){const m=void 0===f.code?N.UNKNOWN:Wc(f.code);return new V(m,f.message||"")}(u);t=new bn(i,r,s,h||null)}else if("documentChange"in e){const i=e.documentChange,r=dn(n,i.document.name),s=nt(i.document.updateTime),u=i.document.createTime?nt(i.document.createTime):ce.min(),h=new _t({mapValue:{fields:i.document.fields}}),f=Ge.newFoundDocument(r,s,u,h);t=new Jr(i.targetIds||[],i.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const i=e.documentDelete,r=dn(n,i.document),s=i.readTime?nt(i.readTime):ce.min(),u=Ge.newNoDocument(r,s);t=new Jr([],i.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const i=e.documentRemove,r=dn(n,i.document);t=new Jr([],i.removedTargetIds||[],r,null)}else{if(!("filter"in e))return K();{const i=e.filter,s=new $r(i.count||0);t=new zc(i.targetId,s)}}var f;return t}(this.yt,e),i=function(r){if(!("targetChange"in r))return ce.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?ce.min():s.readTime?nt(s.readTime):ce.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=es(this.yt),t.addTarget=function(r,s){let u;const h=s.target;return u=ho(h)?{documents:j(r,h)}:{query:ne(r,h)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=hn(r,s.resumeToken):s.snapshotVersion.compareTo(ce.min())>0&&(u.readTime=Xi(r,s.snapshotVersion.toTimestamp())),u}(this.yt,e);const i=function le(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return K()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=es(this.yt),t.removeTarget=e,this.Bo(t)}}class N_ extends Lp{constructor(e,t,i,r,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,u),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(oe(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function P(n,e){return n&&n.length>0?(oe(void 0!==e),n.map(t=>function(i,r){let s=nt(i.updateTime?i.updateTime:r);return s.isEqual(ce.min())&&(s=nt(r)),new Ha(s,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),i=nt(e.commitTime);return this.listener.Zo(i,t)}return oe(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=es(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>g(this.yt,i))};this.Bo(t)}}class M_ extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=r,this.nu=!1}su(){if(this.nu)throw new V(N.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.ao(e,t,i,r,s)).catch(r=>{throw"FirebaseError"===r.name?(r.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new V(N.UNKNOWN,r.toString())})}_o(e,t,i,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection._o(e,t,i,s,u,r)).catch(s=>{throw"FirebaseError"===s.name?(s.code===N.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new V(N.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class L_{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(it(t),this.ou=!1):Z("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class F_{constructor(e,t,i,r,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(h=>{i.enqueueAndForget((0,R.Z)(function*(){var f;gi(u)&&(Z("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,R.Z)(function*(m){const _=Q(m);_._u.add(4),yield No(_),_.gu.set("Unknown"),_._u.delete(4),yield _u(_)}),function(m){return f.apply(this,arguments)})(u))}))}),this.gu=new L_(i,r)}}function _u(n){return td.apply(this,arguments)}function td(){return td=(0,R.Z)(function*(n){if(gi(n))for(const e of n.wu)yield e(!0)}),td.apply(this,arguments)}function No(n){return nd.apply(this,arguments)}function nd(){return nd=(0,R.Z)(function*(n){for(const e of n.wu)yield e(!1)}),nd.apply(this,arguments)}function dl(n,e){const t=Q(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),sd(t)?rd(t):Po(t).ko()&&id(t,e))}function yu(n,e){const t=Q(n),i=Po(t);t.du.delete(e),i.ko()&&Fp(t,e),0===t.du.size&&(i.ko()?i.Fo():gi(t)&&t.gu.set("Unknown"))}function id(n,e){n.yu.Ot(e.targetId),Po(n).zo(e)}function Fp(n,e){n.yu.Ot(e),Po(n).Ho(e)}function rd(n){n.yu=new Ch({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),Po(n).start(),n.gu.uu()}function sd(n){return gi(n)&&!Po(n).No()&&n.du.size>0}function gi(n){return 0===Q(n)._u.size}function Up(n){n.yu=void 0}function U_(n){return od.apply(this,arguments)}function od(){return od=(0,R.Z)(function*(n){n.du.forEach((e,t)=>{id(n,e)})}),od.apply(this,arguments)}function V_(n,e){return ad.apply(this,arguments)}function ad(){return ad=(0,R.Z)(function*(n,e){Up(n),sd(n)?(n.gu.hu(e),rd(n)):n.gu.set("Unknown")}),ad.apply(this,arguments)}function B_(n,e,t){return ud.apply(this,arguments)}function ud(){return ud=(0,R.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof bn&&2===e.state&&e.cause)try{yield(i=(0,R.Z)(function*(r,s){const u=s.cause;for(const h of s.targetIds)r.du.has(h)&&(yield r.remoteSyncer.rejectListen(h,u),r.du.delete(h),r.yu.removeTarget(h))}),function(r,s){return i.apply(this,arguments)})(n,e)}catch(i){Z("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield fl(n,i)}else if(e instanceof Jr?n.yu.Kt(e):e instanceof zc?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(ce.min()))try{const i=yield Ap(n.localStore);t.compareTo(i)>=0&&(yield function(r,s){const u=r.yu.Zt(s);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=r.du.get(f);m&&r.du.set(f,m.withResumeToken(h.resumeToken,s))}}),u.targetMismatches.forEach(h=>{const f=r.du.get(h);if(!f)return;r.du.set(h,f.withResumeToken(rt.EMPTY_BYTE_STRING,f.snapshotVersion)),Fp(r,h);const m=new er(f.target,h,1,f.sequenceNumber);id(r,m)}),r.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(i){Z("RemoteStore","Failed to raise snapshot:",i),yield fl(n,i)}var i}),ud.apply(this,arguments)}function fl(n,e,t){return cd.apply(this,arguments)}function cd(){return cd=(0,R.Z)(function*(n,e,t){if(!Mn(e))throw e;n._u.add(1),yield No(n),n.gu.set("Offline"),t||(t=()=>Ap(n.localStore)),n.asyncQueue.enqueueRetryable((0,R.Z)(function*(){Z("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield _u(n)}))}),cd.apply(this,arguments)}function Vp(n,e){return e().catch(t=>fl(n,t,e))}function Mo(n){return ld.apply(this,arguments)}function ld(){return ld=(0,R.Z)(function*(n){const e=Q(n),t=rr(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Z_(e);)try{const r=yield x_(e.localStore,i);if(null===r){0===e.fu.length&&t.Fo();break}i=r.batchId,q_(e,r)}catch(r){yield fl(e,r)}Bp(e)&&Zp(e)}),ld.apply(this,arguments)}function Z_(n){return gi(n)&&n.fu.length<10}function q_(n,e){n.fu.push(e);const t=rr(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Bp(n){return gi(n)&&!rr(n).No()&&n.fu.length>0}function Zp(n){rr(n).start()}function G_(n){return hd.apply(this,arguments)}function hd(){return hd=(0,R.Z)(function*(n){rr(n).eu()}),hd.apply(this,arguments)}function W_(n){return dd.apply(this,arguments)}function dd(){return dd=(0,R.Z)(function*(n){const e=rr(n);for(const t of n.fu)e.Xo(t.mutations)}),dd.apply(this,arguments)}function z_(n,e,t){return fd.apply(this,arguments)}function fd(){return fd=(0,R.Z)(function*(n,e,t){const i=n.fu.shift(),r=Rh.from(i,e,t);yield Vp(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield Mo(n)}),fd.apply(this,arguments)}function j_(n,e){return pd.apply(this,arguments)}function pd(){return pd=(0,R.Z)(function*(n,e){var t;e&&rr(n).Yo&&(yield(t=(0,R.Z)(function*(i,r){if(Gc(s=r.code)&&s!==N.ABORTED){const u=i.fu.shift();rr(i).Mo(),yield Vp(i,()=>i.remoteSyncer.rejectFailedWrite(u.batchId,r)),yield Mo(i)}var s}),function(i,r){return t.apply(this,arguments)})(n,e)),Bp(n)&&Zp(n)}),pd.apply(this,arguments)}function qp(n,e){return md.apply(this,arguments)}function md(){return md=(0,R.Z)(function*(n,e){const t=Q(n);t.asyncQueue.verifyOperationInProgress(),Z("RemoteStore","RemoteStore received new credentials");const i=gi(t);t._u.add(3),yield No(t),i&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield _u(t)}),md.apply(this,arguments)}function gd(n,e){return _d.apply(this,arguments)}function _d(){return _d=(0,R.Z)(function*(n,e){const t=Q(n);e?(t._u.delete(2),yield _u(t)):e||(t._u.add(2),yield No(t),t.gu.set("Unknown"))}),_d.apply(this,arguments)}function Po(n){return n.pu||(n.pu=function(e,t,i){const r=Q(e);return r.su(),new O_(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:U_.bind(null,n),Zr:V_.bind(null,n),Wo:B_.bind(null,n)}),n.wu.push(function(){var e=(0,R.Z)(function*(t){t?(n.pu.Mo(),sd(n)?rd(n):n.gu.set("Unknown")):(yield n.pu.stop(),Up(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function rr(n){return n.Iu||(n.Iu=function(e,t,i){const r=Q(e);return r.su(),new N_(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:G_.bind(null,n),Zr:j_.bind(null,n),tu:W_.bind(null,n),Zo:z_.bind(null,n)}),n.wu.push(function(){var e=(0,R.Z)(function*(t){t?(n.Iu.Mo(),yield Mo(n)):(yield n.Iu.stop(),n.fu.length>0&&(Z("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class yd{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new at,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,i,r,s){const u=Date.now()+i,h=new yd(e,t,u,r,s);return h.start(i),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(N.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Lo(n,e){if(it("AsyncQueue",`${e}: ${n}`),Mn(n))return new V(N.UNAVAILABLE,`${e}: ${n}`);throw n}class Fo{constructor(e){this.comparator=e?(t,i)=>e(t,i)||H.comparator(t.key,i.key):(t,i)=>H.comparator(t.key,i.key),this.keyedMap=di(),this.sortedSet=new tt(this.comparator)}static emptySet(e){return new Fo(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Fo)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const i=new Fo;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Gp{constructor(){this.Tu=new tt(H.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?0!==e.type&&3===i.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==i.type?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):2===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===i.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===i.type?this.Tu=this.Tu.remove(t):1===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):0===e.type&&1===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):K():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class Uo{constructor(e,t,i,r,s,u,h,f,m){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,i,r,s){const u=[];return t.forEach(h=>{u.push({type:0,doc:h})}),new Uo(e,t,Fo.emptySet(t),u,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&zr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}class K_{constructor(){this.Au=void 0,this.listeners=[]}}class $_{constructor(){this.queries=new Zn(e=>Dc(e),zr),this.onlineState="Unknown",this.Ru=new Set}}function vd(n,e){return Id.apply(this,arguments)}function Id(){return Id=(0,R.Z)(function*(n,e){const t=Q(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new K_),r)try{s.Au=yield t.onListen(i)}catch(u){const h=Lo(u,`Initialization of query '${Ka(e.query)}' failed`);return void e.onError(h)}t.queries.set(i,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&Td(t)}),Id.apply(this,arguments)}function wd(n,e){return Ed.apply(this,arguments)}function Ed(){return Ed=(0,R.Z)(function*(n,e){const t=Q(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),r=0===s.listeners.length)}if(r)return t.queries.delete(i),t.onUnlisten(i)}),Ed.apply(this,arguments)}function H_(n,e){const t=Q(n);let i=!1;for(const r of e){const u=t.queries.get(r.query);if(u){for(const h of u.listeners)h.Pu(r)&&(i=!0);u.Au=r}}i&&Td(t)}function Y_(n,e,t){const i=Q(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function Td(n){n.Ru.forEach(e=>{e.next()})}class bd{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)3!==r.type&&i.push(r);e=new Uo(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Uo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Q_{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Wp{constructor(e){this.yt=e}Ji(e){return dn(this.yt,e)}Yi(e){return e.metadata.exists?a(this.yt,e.document,!1):Ge.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return nt(e)}}class J_{constructor(e,t,i){this.Mu=e,this.localStore=t,this.yt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=zp(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const i=Ne.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,i=new Wp(this.yt);for(const r of e)if(r.metadata.queries){const s=i.Ji(r.metadata.name);for(const u of r.metadata.queries){const h=(t.get(u)||_e()).add(s);t.set(u,h)}}return t}complete(){var e=this;return(0,R.Z)(function*(){const t=yield function A_(n,e,t,i){return Kh.apply(this,arguments)}(e.localStore,new Wp(e.yt),e.documents,e.Mu.id),i=e.$u(e.documents);for(const r of e.queries)yield k_(e.localStore,r,i.get(r.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function zp(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class jp{constructor(e){this.key=e}}class Kp{constructor(e){this.key=e}}class $p{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=_e(),this.mutatedKeys=_e(),this.Gu=Th(e),this.Qu=new Fo(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new Gp,r=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=r,h=!1;const f="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,m="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((_,I)=>{const k=r.get(_),U=_o(this.query,I)?I:null,B=!!k&&this.mutatedKeys.has(k.key),Y=!!U&&(U.hasLocalMutations||this.mutatedKeys.has(U.key)&&U.hasCommittedMutations);let se=!1;k&&U?k.data.isEqual(U.data)?B!==Y&&(i.track({type:3,doc:U}),se=!0):this.Hu(k,U)||(i.track({type:2,doc:U}),se=!0,(f&&this.Gu(U,f)>0||m&&this.Gu(U,m)<0)&&(h=!0)):!k&&U?(i.track({type:0,doc:U}),se=!0):k&&!U&&(i.track({type:1,doc:k}),se=!0,(f||m)&&(h=!0)),se&&(U?(u=u.add(U),s=Y?s.add(_):s.delete(_)):(u=u.delete(_),s=s.delete(_)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const _="F"===this.query.limitType?u.last():u.first();u=u.delete(_.key),s=s.delete(_.key),i.track({type:1,doc:_})}return{Qu:u,zu:i,$i:h,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((m,_)=>function(I,k){const U=B=>{switch(B){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return K()}};return U(I)-U(k)}(m.type,_.type)||this.Gu(m.doc,_.doc)),this.Ju(i);const u=t?this.Yu():[],h=0===this.Ku.size&&this.current?1:0,f=h!==this.Uu;return this.Uu=h,0!==s.length||f?{snapshot:new Uo(this.query,e.Qu,r,s,e.mutatedKeys,0===h,f,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Gp,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=_e(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new Kp(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new jp(i))}),t}tc(e){this.qu=e.Hi,this.Ku=_e();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Uo.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class X_{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class ey{constructor(e){this.key=e,this.nc=!1}}class ty{constructor(e,t,i,r,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new Zn(h=>Dc(h),zr),this.rc=new Map,this.oc=new Set,this.uc=new tt(H.comparator),this.cc=new Map,this.ac=new Bh,this.hc={},this.lc=new Map,this.fc=os.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function ny(n,e){return xd.apply(this,arguments)}function xd(){return xd=(0,R.Z)(function*(n,e){const t=$d(n);let i,r;const s=t.ic.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.ec();else{const u=yield Ro(t.localStore,vt(e));t.isPrimaryClient&&dl(t.remoteStore,u);const h=t.sharedClientState.addLocalQueryTarget(u.targetId);i=u.targetId,r=yield Ad(t,e,i,"current"===h,u.resumeToken)}return r}),xd.apply(this,arguments)}function Ad(n,e,t,i,r){return kd.apply(this,arguments)}function kd(){return kd=(0,R.Z)(function*(n,e,t,i,r){n._c=(I,k,U)=>{return(B=(0,R.Z)(function*(Y,se,Fe,Ze){let Ce=se.view.Wu(Fe);Ce.$i&&(Ce=yield ul(Y.localStore,se.query,!1).then(({documents:Te})=>se.view.Wu(Te,Ce)));const we=Ze&&Ze.targetChanges.get(se.targetId),ve=se.view.applyChanges(Ce,Y.isPrimaryClient,we);return Fd(Y,se.targetId,ve.Xu),ve.snapshot}),function(Y,se,Fe,Ze){return B.apply(this,arguments)})(n,I,k,U);var B};const s=yield ul(n.localStore,e,!0),u=new $p(e,s.Hi),h=u.Wu(s.documents),f=Qr.createSynthesizedTargetChangeForCurrentChange(t,i&&"Offline"!==n.onlineState,r),m=u.applyChanges(h,n.isPrimaryClient,f);Fd(n,t,m.Xu);const _=new X_(e,t,u);return n.ic.set(e,_),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),m.snapshot}),kd.apply(this,arguments)}function iy(n,e){return Cd.apply(this,arguments)}function Cd(){return Cd=(0,R.Z)(function*(n,e){const t=Q(n),i=t.ic.get(e),r=t.rc.get(i.targetId);if(r.length>1)return t.rc.set(i.targetId,r.filter(s=>!zr(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||(yield Oo(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),yu(t.remoteStore,i.targetId),Vo(t,i.targetId)}).catch(Nn))):(Vo(t,i.targetId),yield Oo(t.localStore,i.targetId,!0))}),Cd.apply(this,arguments)}function Sd(){return Sd=(0,R.Z)(function*(n,e,t){const i=Hd(n);try{const r=yield function(s,u){const h=Q(s),f=ze.now(),m=u.reduce((k,U)=>k.add(U.key),_e());let _,I;return h.persistence.runTransaction("Locally write mutations","readwrite",k=>{let U=Ct(),B=_e();return h.Gi.getEntries(k,m).next(Y=>{U=Y,U.forEach((se,Fe)=>{Fe.isValidDocument()||(B=B.add(se))})}).next(()=>h.localDocuments.getOverlayedDocuments(k,U)).next(Y=>{_=Y;const se=[];for(const Fe of u){const Ze=Eo(Fe,_.get(Fe.key).overlayedDocument);null!=Ze&&se.push(new Tn(Fe.key,Ze,Cc(Ze.value.mapValue),Ke.exists(!0)))}return h.mutationQueue.addMutationBatch(k,f,se,u)}).next(Y=>{I=Y;const se=Y.applyToLocalDocumentSet(_,B);return h.documentOverlayCache.saveOverlays(k,Y.batchId,se)})}).then(()=>({batchId:I.batchId,changes:Ja(_)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,u,h){let f=s.hc[s.currentUser.toKey()];f||(f=new tt(pe)),f=f.insert(u,h),s.hc[s.currentUser.toKey()]=f}(i,r.batchId,t),yield _i(i,r.changes),yield Mo(i.remoteStore)}catch(r){const s=Lo(r,"Failed to persist write");t.reject(s)}}),Sd.apply(this,arguments)}function Hp(n,e){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,R.Z)(function*(n,e){const t=Q(n);try{const i=yield b_(t.localStore,e);e.targetChanges.forEach((r,s)=>{const u=t.cc.get(s);u&&(oe(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?u.nc=!0:r.modifiedDocuments.size>0?oe(u.nc):r.removedDocuments.size>0&&(oe(u.nc),u.nc=!1))}),yield _i(t,i,e)}catch(i){yield Nn(i)}}),Dd.apply(this,arguments)}function Yp(n,e,t){const i=Q(n);if(i.isPrimaryClient&&0===t||!i.isPrimaryClient&&1===t){const r=[];i.ic.forEach((s,u)=>{const h=u.view.bu(e);h.snapshot&&r.push(h.snapshot)}),function(s,u){const h=Q(s);h.onlineState=u;let f=!1;h.queries.forEach((m,_)=>{for(const I of _.listeners)I.bu(u)&&(f=!0)}),f&&Td(h)}(i.eventManager,e),r.length&&i.sc.Wo(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function sy(n,e,t){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,R.Z)(function*(n,e,t){const i=Q(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.cc.get(e),s=r&&r.key;if(s){let u=new tt(H.comparator);u=u.insert(s,Ge.newNoDocument(s,ce.min()));const h=_e().add(s),f=new fi(ce.min(),new Map,new Be(pe),u,h);yield Hp(i,f),i.uc=i.uc.remove(s),i.cc.delete(e),Ud(i)}else yield Oo(i.localStore,e,!1).then(()=>Vo(i,e,t)).catch(Nn)}),Rd.apply(this,arguments)}function oy(n,e){return Od.apply(this,arguments)}function Od(){return Od=(0,R.Z)(function*(n,e){const t=Q(n),i=e.batch.batchId;try{const r=yield T_(t.localStore,e);Ld(t,i,null),Pd(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield _i(t,r)}catch(r){yield Nn(r)}}),Od.apply(this,arguments)}function ay(n,e,t){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,R.Z)(function*(n,e,t){const i=Q(n);try{const r=yield function(s,u){const h=Q(s);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next(_=>(oe(null!==_),m=_.keys(),h.mutationQueue.removeMutationBatch(f,_))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(i.localStore,e);Ld(i,e,t),Pd(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield _i(i,r)}catch(r){yield Nn(r)}}),Nd.apply(this,arguments)}function Md(){return Md=(0,R.Z)(function*(n,e){const t=Q(n);gi(t.remoteStore)||Z("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=yield function(s){const u=Q(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>u.mutationQueue.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(-1===i)return void e.resolve();const r=t.lc.get(i)||[];r.push(e),t.lc.set(i,r)}catch(i){const r=Lo(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}),Md.apply(this,arguments)}function Pd(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function Ld(n,e,t){const i=Q(n);let r=i.hc[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.hc[i.currentUser.toKey()]=r}}function Vo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||Qp(n,i)})}function Qp(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(yu(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),Ud(n))}function Fd(n,e,t){for(const i of t)i instanceof jp?(n.ac.addReference(i.key,e),cy(n,i)):i instanceof Kp?(Z("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||Qp(n,i.key)):K()}function cy(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(Z("SyncEngine","New document in limbo: "+t),n.oc.add(i),Ud(n))}function Ud(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new H(Ne.fromString(e)),i=n.fc.next();n.cc.set(i,new ey(t)),n.uc=n.uc.insert(t,i),dl(n.remoteStore,new er(vt(ji(t.path)),i,2,At.at))}}function _i(n,e,t){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,R.Z)(function*(n,e,t){const i=Q(n),r=[],s=[],u=[];var h;i.ic.isEmpty()||(i.ic.forEach((h,f)=>{u.push(i._c(f,e,t).then(m=>{if((m||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(f.targetId,(null==m?void 0:m.fromCache)?"not-current":"current"),m){r.push(m);const _=Wh.Ci(f.targetId,m);s.push(_)}}))}),yield Promise.all(u),i.sc.Wo(r),yield(h=(0,R.Z)(function*(f,m){const _=Q(f);try{yield _.persistence.runTransaction("notifyLocalViewChanges","readwrite",I=>D.forEach(m,k=>D.forEach(k.Si,U=>_.persistence.referenceDelegate.addReference(I,k.targetId,U)).next(()=>D.forEach(k.Di,U=>_.persistence.referenceDelegate.removeReference(I,k.targetId,U)))))}catch(I){if(!Mn(I))throw I;Z("LocalStore","Failed to update sequence numbers: "+I)}for(const I of m){const k=I.targetId;if(!I.fromCache){const U=_.qi.get(k),Y=U.withLastLimboFreeSnapshotVersion(U.snapshotVersion);_.qi=_.qi.insert(k,Y)}}}),function(f,m){return h.apply(this,arguments)})(i.localStore,s))}),Vd.apply(this,arguments)}function ly(n,e){return Bd.apply(this,arguments)}function Bd(){return Bd=(0,R.Z)(function*(n,e){const t=Q(n);if(!t.currentUser.isEqual(e)){Z("SyncEngine","User change. New user:",e.toKey());const i=yield xp(t.localStore,e);t.currentUser=e,(r=t).lc.forEach(u=>{u.forEach(h=>{h.reject(new V(N.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.lc.clear(),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield _i(t,i.ji)}var r}),Bd.apply(this,arguments)}function hy(n,e){const t=Q(n),i=t.cc.get(e);if(i&&i.nc)return _e().add(i.key);{let r=_e();const s=t.rc.get(e);if(!s)return r;for(const u of s){const h=t.ic.get(u);r=r.unionWith(h.view.ju)}return r}}function dy(n,e){return Zd.apply(this,arguments)}function Zd(){return Zd=(0,R.Z)(function*(n,e){const t=Q(n),i=yield ul(t.localStore,e.query,!0),r=e.view.tc(i);return t.isPrimaryClient&&Fd(t,e.targetId,r.Xu),r}),Zd.apply(this,arguments)}function fy(n,e){return qd.apply(this,arguments)}function qd(){return qd=(0,R.Z)(function*(n,e){const t=Q(n);return Sp(t.localStore,e).then(i=>_i(t,i))}),qd.apply(this,arguments)}function py(n,e,t,i){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,R.Z)(function*(n,e,t,i){const r=Q(n),s=yield function(u,h){const f=Q(u),m=Q(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",_=>m.Tn(_,h).next(I=>I?f.localDocuments.getDocuments(_,I):D.resolve(null)))}(r.localStore,e);var h;null!==s?("pending"===t?yield Mo(r.remoteStore):"acknowledged"===t||"rejected"===t?(Ld(r,e,i||null),Pd(r,e),h=e,Q(Q(r.localStore).mutationQueue).An(h)):K(),yield _i(r,s)):Z("SyncEngine","Cannot apply mutation batch with id: "+e)}),Gd.apply(this,arguments)}function Wd(){return Wd=(0,R.Z)(function*(n,e){const t=Q(n);if($d(t),Hd(t),!0===e&&!0!==t.dc){const i=t.sharedClientState.getAllActiveQueryTargets(),r=yield Jp(t,i.toArray());t.dc=!0,yield gd(t.remoteStore,!0);for(const s of r)dl(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const i=[];let r=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?i.push(u):r=r.then(()=>(Vo(t,u),Oo(t.localStore,u,!0))),yu(t.remoteStore,u)}),yield r,yield Jp(t,i),function(s){const u=Q(s);u.cc.forEach((h,f)=>{yu(u.remoteStore,f)}),u.ac.fs(),u.cc=new Map,u.uc=new tt(H.comparator)}(t),t.dc=!1,yield gd(t.remoteStore,!1)}}),Wd.apply(this,arguments)}function Jp(n,e,t){return zd.apply(this,arguments)}function zd(){return zd=(0,R.Z)(function*(n,e,t){const i=Q(n),r=[],s=[];for(const u of e){let h;const f=i.rc.get(u);if(f&&0!==f.length){h=yield Ro(i.localStore,vt(f[0]));for(const m of f){const _=i.ic.get(m),I=yield dy(i,_);I.snapshot&&s.push(I.snapshot)}}else{const m=yield Cp(i.localStore,u);h=yield Ro(i.localStore,m),yield Ad(i,Xp(m),u,!1,h.resumeToken)}r.push(h)}return i.sc.Wo(s),r}),zd.apply(this,arguments)}function Xp(n){return mo(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function gy(n){const e=Q(n);return Q(Q(e.localStore).persistence).vi()}function _y(n,e,t,i){return jd.apply(this,arguments)}function jd(){return jd=(0,R.Z)(function*(n,e,t,i){const r=Q(n);if(r.dc)return void Z("SyncEngine","Ignoring unexpected query state notification.");const s=r.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield Sp(r.localStore,Rc(s[0])),h=fi.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,rt.EMPTY_BYTE_STRING);yield _i(r,u,h);break}case"rejected":yield Oo(r.localStore,e,!0),Vo(r,e,i);break;default:K()}}),jd.apply(this,arguments)}function yy(n,e,t){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,R.Z)(function*(n,e,t){const i=$d(n);if(i.dc){for(const r of e){if(i.rc.has(r)){Z("SyncEngine","Adding an already active target "+r);continue}const s=yield Cp(i.localStore,r),u=yield Ro(i.localStore,s);yield Ad(i,Xp(s),u.targetId,!1,u.resumeToken),dl(i.remoteStore,u)}for(const r of t)i.rc.has(r)&&(yield Oo(i.localStore,r,!1).then(()=>{yu(i.remoteStore,r),Vo(i,r)}).catch(Nn))}}),Kd.apply(this,arguments)}function $d(n){const e=Q(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Hp.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hy.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=sy.bind(null,e),e.sc.Wo=H_.bind(null,e.eventManager),e.sc.wc=Y_.bind(null,e.eventManager),e}function Hd(n){const e=Q(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=oy.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=ay.bind(null,e),e}class em{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,R.Z)(function*(){t.yt=gu(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return bp(this.persistence,new Tp,e.initialUser,this.yt)}yc(e){return new wp(ol.Bs,this.yt)}gc(e){return new Np}terminate(){var e=this;return(0,R.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class tm extends em{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,i=this;return(0,R.Z)(function*(){yield t().call(i,e),yield i.Ac.initialize(i,e),yield Hd(i.Ac.syncEngine),yield Mo(i.Ac.remoteStore),yield i.persistence.li(()=>(i.gcScheduler&&!i.gcScheduler.started&&i.gcScheduler.start(),i.indexBackfillerScheduler&&!i.indexBackfillerScheduler.started&&i.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return bp(this.persistence,new Tp,e.initialUser,this.yt)}Tc(e,t){return new u_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const i=new Xs(t,this.persistence);return new Na(e.asyncQueue,i)}yc(e){const t=Gh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=void 0!==this.cacheSizeBytes?Gt.withCacheSize(this.cacheSizeBytes):Gt.DEFAULT;return new qh(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Pp(),hl(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Np}}class Iy extends tm{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,i=this;return(0,R.Z)(function*(){yield t().call(i,e);const r=i.Ac.syncEngine;i.sharedClientState instanceof Jh&&(i.sharedClientState.syncEngine={Fr:py.bind(null,r),$r:_y.bind(null,r),Br:yy.bind(null,r),vi:gy.bind(null,r),Mr:fy.bind(null,r)},yield i.sharedClientState.start()),yield i.persistence.li(function(){var s=(0,R.Z)(function*(u){yield function my(n,e){return Wd.apply(this,arguments)}(i.Ac.syncEngine,u),i.gcScheduler&&(u&&!i.gcScheduler.started?i.gcScheduler.start():u||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(u&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():u||i.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Pp();if(!Jh.C(t))throw new V(N.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=Gh(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new Jh(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class Yd{initialize(e,t){var i=this;return(0,R.Z)(function*(){i.localStore||(i.localStore=e.localStore,i.sharedClientState=e.sharedClientState,i.datastore=i.createDatastore(t),i.remoteStore=i.createRemoteStore(t),i.eventManager=i.createEventManager(t),i.syncEngine=i.createSyncEngine(t,!e.synchronizeTabs),i.sharedClientState.onlineStateHandler=r=>Yp(i.syncEngine,r,1),i.remoteStore.remoteSyncer.handleCredentialChange=ly.bind(null,i.syncEngine),yield gd(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(e){return new $_}createDatastore(e){const t=gu(e.databaseInfo.databaseId),i=new R_(e.databaseInfo);return new M_(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=h=>Yp(this.syncEngine,h,0),u=Mp.C()?new Mp:new C_,new F_(t,i,r,s,u);var t,i,r,s,u}createSyncEngine(e,t){return function(i,r,s,u,h,f,m){const _=new ty(i,r,s,u,h,f);return m&&(_.dc=!0),_}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,R.Z)(function*(t){const i=Q(t);Z("RemoteStore","RemoteStore shutting down."),i._u.add(5),yield No(i),i.mu.shutdown(),i.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function Qd(n,e,t){if(!t)throw new V(N.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function nm(n,e,t,i){if(!0===e&&!0===i)throw new V(N.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function im(n){if(!H.isDocumentKey(n))throw new V(N.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rm(n){if(H.isDocumentKey(n))throw new V(N.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function pl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":K()}function Me(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new V(N.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=pl(n);throw new V(N.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sm(n,e){if(e<=0)throw new V(N.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const om=new Map;class am{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new V(N.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new V(N.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,nm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class vu{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new am({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new V(N.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new V(N.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new am(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new ch;switch(t.type){case"gapi":return new js(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new V(N.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=om.get(e);t&&(Z("ComponentProvider","Removing Datastore"),om.delete(e),t.terminate())}(this),Promise.resolve()}}class He{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Gn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new He(this.firestore,e,this._key)}}class St{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new St(this.firestore,e,this._query)}}class Gn extends St{constructor(e,t,i){super(e,t,ji(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new He(this.firestore,null,new H(e))}withConverter(e){return new Gn(this.firestore,e,this._path)}}function cm(n,e,...t){if(n=(0,J.m9)(n),Qd("collection","path",e),n instanceof vu){const i=Ne.fromString(e,...t);return rm(i),new Gn(n,null,i)}{if(!(n instanceof He||n instanceof Gn))throw new V(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Ne.fromString(e,...t));return rm(i),new Gn(n.firestore,null,i)}}function ml(n,e,...t){if(n=(0,J.m9)(n),1===arguments.length&&(e=dc.R()),Qd("doc","path",e),n instanceof vu){const i=Ne.fromString(e,...t);return im(i),new He(n,null,new H(i))}{if(!(n instanceof He||n instanceof Gn))throw new V(N.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(Ne.fromString(e,...t));return im(i),new He(n.firestore,n instanceof Gn?n.converter:null,new H(i))}}function lm(n,e){return n=(0,J.m9)(n),e=(0,J.m9)(e),(n instanceof He||n instanceof Gn)&&(e instanceof He||e instanceof Gn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Jd(n,e){return n=(0,J.m9)(n),e=(0,J.m9)(e),n instanceof St&&e instanceof St&&n.firestore===e.firestore&&zr(n._query,e._query)&&n.converter===e.converter}function hm(n,e=10240){let t=0;return{read:()=>(0,R.Z)(function*(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})(),cancel:()=>(0,R.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class gl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):it("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Ey{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new at,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(i=>{i&&i.Ou()?this.metadata.resolve(i.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==i?void 0:i.ku)}`))},i=>this.metadata.reject(i))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,R.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,R.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,R.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const i=e.vc.decode(t),r=Number(i);isNaN(r)&&e.Dc(`length string (${i}) is not valid number`);const s=yield e.Cc(r);return new Q_(JSON.parse(s),t.length+r)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,R.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const i=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),i})()}Cc(e){var t=this;return(0,R.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const i=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),i})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,R.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const i=new Uint8Array(e.buffer.length+t.value.length);i.set(e.buffer),i.set(t.value,e.buffer.length),e.buffer=i}return t.done})()}}class xy{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,R.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new V(N.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield(r=(0,R.Z)(function*(s,u){const h=Q(s),f=es(h.yt)+"/documents",m={documents:u.map(U=>pi(h.yt,U))},_=yield h._o("BatchGetDocuments",f,m,u.length),I=new Map;_.forEach(U=>{const B=function l(n,e){return"found"in e?function(t,i){oe(!!i.found);const r=dn(t,i.found.name),s=nt(i.found.updateTime),u=i.found.createTime?nt(i.found.createTime):ce.min(),h=new _t({mapValue:{fields:i.found.fields}});return Ge.newFoundDocument(r,s,u,h)}(n,e):"missing"in e?function(t,i){oe(!!i.missing),oe(!!i.readTime);const r=dn(t,i.missing),s=nt(i.readTime);return Ge.newNoDocument(r,s)}(n,e):K()}(h.yt,U);I.set(B.key.toString(),B)});const k=[];return u.forEach(U=>{const B=I.get(U.toString());oe(!!B),k.push(B)}),k}),function(s,u){return r.apply(this,arguments)})(t.datastore,e);var r;return i.forEach(r=>t.recordVersion(r)),i})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Qi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,R.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var i;e.mutations.forEach(i=>{t.delete(i.key.toString())}),t.forEach((i,r)=>{const s=H.fromPath(r);e.mutations.push(new Qa(s,e.precondition(s)))}),yield(i=(0,R.Z)(function*(r,s){const u=Q(r),h=es(u.yt)+"/documents",f={writes:s.map(m=>g(u.yt,m))};yield u.ao("Commit",h,f)}),function(r,s){return i.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw K();t=ce.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new V(N.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(ce.min())?Ke.exists(!1):Ke.updateTime(t):Ke.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(ce.min()))throw new V(N.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Ke.updateTime(t)}return Ke.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Ay{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.kc=i.maxAttempts,this.xo=new Xh(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,R.Z)(function*(){const t=new xy(e.datastore),i=e.Mc(t);i&&i.then(r=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(r)}).catch(s=>{e.Fc(s)}))}).catch(r=>{e.Fc(r)})}))}Mc(e){try{const t=this.updateFunction(e);return!Ur(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Gc(t)}return!1}}class ky{constructor(e,t,i,r){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=dt.UNAUTHENTICATED,this.clientId=dc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,function(){var u=(0,R.Z)(function*(h){Z("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(i,u=>(Z("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,R.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new V(N.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new at;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,R.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(i){const r=Lo(i,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function dm(n,e){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,R.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),Z("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,R.Z)(function*(s){i.isEqual(s)||(yield xp(e.localStore,s),i=s)});return function(s){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Xd.apply(this,arguments)}function fm(n,e){return ef.apply(this,arguments)}function ef(){return ef=(0,R.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield tf(n);Z("FirestoreClient","Initializing OnlineComponentProvider");const i=yield n.getConfiguration();yield e.initialize(t,i),n.setCredentialChangeListener(r=>qp(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>qp(e.remoteStore,s)),n.onlineComponents=e}),ef.apply(this,arguments)}function tf(n){return nf.apply(this,arguments)}function nf(){return nf=(0,R.Z)(function*(n){return n.offlineComponents||(Z("FirestoreClient","Using default OfflineComponentProvider"),yield dm(n,new em)),n.offlineComponents}),nf.apply(this,arguments)}function _l(n){return rf.apply(this,arguments)}function rf(){return rf=(0,R.Z)(function*(n){return n.onlineComponents||(Z("FirestoreClient","Using default OnlineComponentProvider"),yield fm(n,new Yd)),n.onlineComponents}),rf.apply(this,arguments)}function pm(n){return tf(n).then(e=>e.persistence)}function yl(n){return tf(n).then(e=>e.localStore)}function sf(n){return _l(n).then(e=>e.remoteStore)}function of(n){return _l(n).then(e=>e.syncEngine)}function Bo(n){return af.apply(this,arguments)}function af(){return af=(0,R.Z)(function*(n){const e=yield _l(n),t=e.eventManager;return t.onListen=ny.bind(null,e.syncEngine),t.onUnlisten=iy.bind(null,e.syncEngine),t}),af.apply(this,arguments)}function gm(n,e,t={}){const i=new at;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function(r,s,u,h,f){const m=new gl({next:I=>{s.enqueueAndForget(()=>wd(r,_));const k=I.docs.has(u);!k&&I.fromCache?f.reject(new V(N.UNAVAILABLE,"Failed to get document because the client is offline.")):k&&I.fromCache&&h&&"server"===h.source?f.reject(new V(N.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(I)},error:I=>f.reject(I)}),_=new bd(ji(u.path),m,{includeMetadataChanges:!0,Nu:!0});return vd(r,_)}(yield Bo(n),n.asyncQueue,e,t,i)})),i.promise}function _m(n,e,t={}){const i=new at;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function(r,s,u,h,f){const m=new gl({next:I=>{s.enqueueAndForget(()=>wd(r,_)),I.fromCache&&"server"===h.source?f.reject(new V(N.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(I)},error:I=>f.reject(I)}),_=new bd(u,m,{includeMetadataChanges:!0,Nu:!0});return vd(r,_)}(yield Bo(n),n.asyncQueue,e,t,i)})),i.promise}class Py{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Xh(this,"async_queue_retry"),this.Wc=()=>{const t=hl();t&&Z("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=hl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=hl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new at;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,R.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!Mn(t))throw t;Z("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{throw this.Kc=i,this.Gc=!1,it("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(i)),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=yd.createAndSchedule(this,e,t,i,s=>this.Yc(s));return this.Uc.push(r),r}zc(){this.Kc&&K()}verifyOperationInProgress(){}Xc(){var e=this;return(0,R.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function uf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const i=e;for(const r of["next","error","complete"])if(r in i&&"function"==typeof i[r])return!0;return!1}(n)}class Ly{constructor(){this._progressObserver={},this._taskCompletionResolver=new at,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class Ye extends vu{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new Py,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||ym(this),this._firestoreClient.terminate()}}function ut(n){return n._firestoreClient||ym(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function ym(n){var e;const t=n._freezeSettings(),i=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new ph(n._databaseId,s,n._persistenceKey,(h=t).host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,h.useFetchStreams));var s,h;n._firestoreClient=new ky(n._authCredentials,n._appCheckCredentials,n._queue,i)}function vm(n,e,t){const i=new at;return n.asyncQueue.enqueue((0,R.Z)(function*(){try{yield dm(n,t),yield fm(n,e),i.resolve()}catch(r){const s=r;if(!("FirebaseError"===(u=s).name?u.code===N.FAILED_PRECONDITION||u.code===N.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;$t("Error enabling offline persistence. Falling back to persistence disabled: "+s),i.reject(s)}var u})).then(()=>i.promise)}function Im(n){if(n._initialized||n._terminated)throw new V(N.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class Wn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Wn(rt.fromBase64String(e))}catch(t){throw new V(N.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new Wn(rt.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class yi{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new V(N.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new et(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class us{constructor(e){this._methodName=e}}class vl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new V(N.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new V(N.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return pe(this._lat,e._lat)||pe(this._long,e._long)}}const jy=/^__.*__$/;class Ky{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return null!==this.fieldMask?new Tn(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yi(e,this.data,t,this.fieldTransforms)}}class wm{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Tn(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Em(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw K()}}class Il{constructor(e,t,i,r,s,u){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Il(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.ua(e),r}ca(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Tl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(Em(this.sa)&&jy.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class $y{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||gu(e)}da(e,t,i,r=!1){return new Il({sa:e,methodName:t,fa:i,path:et.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function cs(n){const e=n._freezeSettings(),t=gu(n._databaseId);return new $y(n._databaseId,!!e.ignoreUndefinedProperties,t)}function wl(n,e,t,i,r,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,r);df("Data must be an object, but it was:",u,i);const h=xm(i,u);let f,m;if(s.merge)f=new kt(u.fieldMask),m=u.fieldTransforms;else if(s.mergeFields){const _=[];for(const I of s.mergeFields){const k=ff(e,I,t);if(!u.contains(k))throw new V(N.INVALID_ARGUMENT,`Field '${k}' is specified in your field mask but missing from your input data.`);km(_,k)||_.push(k)}f=new kt(_),m=u.fieldTransforms.filter(I=>f.covers(I.field))}else f=null,m=u.fieldTransforms;return new Ky(new _t(h),f,m)}class Iu extends us{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Iu}}function Tm(n,e,t){return new Il({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class cf extends us{_toFieldTransform(e){return new jr(e.path,new Bn)}isEqual(e){return e instanceof cf}}class Hy extends us{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Tm(this,e,!0),i=this._a.map(s=>ls(s,t)),r=new hi(i);return new jr(e.path,r)}isEqual(e){return this===e}}class Yy extends us{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Tm(this,e,!0),i=this._a.map(s=>ls(s,t)),r=new En(i);return new jr(e.path,r)}isEqual(e){return this===e}}class Qy extends us{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new $i(e.yt,yo(e.yt,this.wa));return new jr(e.path,t)}isEqual(e){return this===e}}function lf(n,e,t,i){const r=n.da(1,e,t);df("Data must be an object, but it was:",r,i);const s=[],u=_t.empty();Lt(i,(f,m)=>{const _=El(e,f,t);m=(0,J.m9)(m);const I=r.ca(_);if(m instanceof Iu)s.push(_);else{const k=ls(m,I);null!=k&&(s.push(_),u.set(_,k))}});const h=new kt(s);return new wm(u,h,r.fieldTransforms)}function hf(n,e,t,i,r,s){const u=n.da(1,e,t),h=[ff(e,i,t)],f=[r];if(s.length%2!=0)throw new V(N.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let k=0;k<s.length;k+=2)h.push(ff(e,s[k])),f.push(s[k+1]);const m=[],_=_t.empty();for(let k=h.length-1;k>=0;--k)if(!km(m,h[k])){const U=h[k];let B=f[k];B=(0,J.m9)(B);const Y=u.ca(U);if(B instanceof Iu)m.push(U);else{const se=ls(B,Y);null!=se&&(m.push(U),_.set(U,se))}}const I=new kt(m);return new wm(_,I,u.fieldTransforms)}function bm(n,e,t,i=!1){return ls(t,n.da(i?4:3,e))}function ls(n,e){if(Am(n=(0,J.m9)(n)))return df("Unsupported field value:",e,n),xm(n,e);if(n instanceof us)return function(t,i){if(!Em(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const u of t){let h=ls(u,i.aa(s));null==h&&(h={nullValue:"NULL_VALUE"}),r.push(h),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if(null===(t=(0,J.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return yo(i.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=ze.fromDate(t);return{timestampValue:Xi(i.yt,r)}}if(t instanceof ze){const r=new ze(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Xi(i.yt,r)}}if(t instanceof vl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Wn)return{bytesValue:hn(i.yt,t._byteString)};if(t instanceof He){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:xo(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${pl(t)}`)}(n,e)}function xm(n,e){const t={};return eo(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Lt(n,(i,r)=>{const s=ls(r,e.ra(i));null!=s&&(t[i]=s)}),{mapValue:{fields:t}}}function Am(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof ze||n instanceof vl||n instanceof Wn||n instanceof He||n instanceof us)}function df(n,e,t){if(!Am(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=pl(t);throw e.ha("an object"===i?n+" a custom object":n+" "+i)}var i}function ff(n,e,t){if((e=(0,J.m9)(e))instanceof yi)return e._internalPath;if("string"==typeof e)return El(n,e);throw Tl("Field path arguments must be of type string or ",n,!1,void 0,t)}const Jy=new RegExp("[~\\*/\\[\\]]");function El(n,e,t){if(e.search(Jy)>=0)throw Tl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new yi(...e.split("."))._internalPath}catch(i){throw Tl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Tl(n,e,t,i,r){const s=i&&!i.isEmpty(),u=void 0!==r;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(s||u)&&(f+=" (found",s&&(f+=` in field ${i}`),u&&(f+=` in document ${r}`),f+=")"),new V(N.INVALID_ARGUMENT,h+n+f)}function km(n,e){return n.some(t=>t.isEqual(e))}class wu{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new He(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Xy(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(bl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Xy extends wu{data(){return super.data()}}function bl(n,e){return"string"==typeof e?El(n,e):e instanceof yi?e._internalPath:e._delegate._internalPath}function Cm(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new V(N.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class pf{}class Eu extends pf{}function sr(n,e,...t){let i=[];e instanceof pf&&i.push(e),i=i.concat(t),function(r){const s=r.filter(h=>h instanceof Zo).length,u=r.filter(h=>h instanceof Tu).length;if(s>1||s>0&&u>0)throw new V(N.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Tu extends Eu{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Tu(e,t,i)}_apply(e){const t=this._parse(e);return Om(e._query,t),new St(e.firestore,e.converter,ja(e._query,t))}_parse(e){const t=cs(e.firestore);return function(r,s,u,h,f,m,_){let I;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new V(N.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Rm(_,m);const k=[];for(const U of _)k.push(Dm(h,r,U));I={arrayValue:{values:k}}}else I=Dm(h,r,_)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Rm(_,m),I=bm(u,"where",_,"in"===m||"not-in"===m);return ke.create(f,m,I)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Zo extends pf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Zo(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return 1===t.length?t[0]:Le.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,r){let s=i;const u=r.getFlattenedFilters();for(const h of u)Om(s,h),s=ja(s,h)}(e._query,t),new St(e.firestore,e.converter,ja(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class mf extends Eu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new mf(e,t)}_apply(e){const t=function(i,r,s){if(null!==i.startAt)throw new V(N.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new V(N.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new Wi(r,s);return function(h,f){if(null===Wa(h)){const m=Ki(h);null!==m&&Nm(0,m,f.field)}}(i,u),u}(e._query,this._field,this._direction);return new St(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new wn(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class xl extends Eu{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new xl(e,t,i)}_apply(e){return new St(e.firestore,e.converter,go(e._query,this._limit,this._limitType))}}class Al extends Eu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Al(e,t,i)}_apply(e){const t=Sm(e,this.type,this._docOrFields,this._inclusive);return new St(e.firestore,e.converter,(r=t,new wn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)));var i,r}}class kl extends Eu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new kl(e,t,i)}_apply(e){const t=Sm(e,this.type,this._docOrFields,this._inclusive);return new St(e.firestore,e.converter,(r=t,new wn((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)));var i,r}}function Sm(n,e,t,i){if(t[0]=(0,J.m9)(t[0]),t[0]instanceof wu)return function(r,s,u,h,f){if(!h)throw new V(N.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const _ of Vn(r))if(_.field.isKeyField())m.push(In(s,h.key));else{const I=h.data.field(_.field);if(Br(I))throw new V(N.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+_.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===I){const k=_.field.canonicalString();throw new V(N.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${k}' (used as the orderBy) does not exist.`)}m.push(I)}return new Fn(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=cs(n.firestore);return function(s,u,h,f,m,_){const I=s.explicitOrderBy;if(m.length>I.length)throw new V(N.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const k=[];for(let U=0;U<m.length;U++){const B=m[U];if(I[U].field.isKeyField()){if("string"!=typeof B)throw new V(N.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof B}`);if(!za(s)&&-1!==B.indexOf("/"))throw new V(N.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${B}' contains a slash.`);const Y=s.path.child(Ne.fromString(B));if(!H.isDocumentKey(Y))throw new V(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${Y}' is not because it contains an odd number of segments.`);const se=new H(Y);k.push(In(u,se))}else{const Y=bm(h,f,B);k.push(Y)}}return new Fn(k,_)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Dm(n,e,t){if("string"==typeof(t=(0,J.m9)(t))){if(""===t)throw new V(N.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!za(e)&&-1!==t.indexOf("/"))throw new V(N.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(Ne.fromString(t));if(!H.isDocumentKey(i))throw new V(N.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return In(n,new H(i))}if(t instanceof He)return In(n,t._key);throw new V(N.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${pl(t)}.`)}function Rm(n,e){if(!Array.isArray(n)||0===n.length)throw new V(N.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new V(N.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Om(n,e){if(e.isInequality()){const i=Ki(n),r=e.field;if(null!==i&&!i.isEqual(r))throw new V(N.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${r.toString()}'`);const s=Wa(n);null!==s&&Nm(0,r,s)}const t=function(i,r){for(const s of i)for(const u of s.getFlattenedFilters())if(r.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new V(N.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Nm(n,e,t){if(!t.isEqual(e))throw new V(N.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class gf{convertValue(e,t="none"){switch(Yt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return je(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(ui(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw K()}}convertObject(e,t){const i={};return Lt(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new vl(je(e.latitude),je(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=vc(e);return null==i?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(ci(e));default:return null}}convertTimestamp(e){const t=Pn(e);return new ze(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=Ne.fromString(e);oe(su(i));const r=new on(i.get(1),i.get(3)),s=new H(i.popFirst(5));return r.isEqual(t)||it(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Cl(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class uv extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new He(this.firestore,null,t)}}class hs{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class vi extends wu{constructor(e,t,i,r,s,u){super(e,t,i,r,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new bu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(bl("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class bu extends vi{data(e={}){return super.data(e)}}class or{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new hs(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new bu(this._firestore,this._userDataWriter,i.key,i,new hs(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(N.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new bu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new hs(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:s++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>r||3!==u.type).map(u=>{const h=new bu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new hs(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,m=-1;return 0!==u.type&&(f=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),m=s.indexOf(u.doc.key)),{type:cv(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function cv(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return K()}}function Pm(n,e){return n instanceof vi&&e instanceof vi?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof or&&e instanceof or&&n._firestore===e._firestore&&Jd(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class ar extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Wn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new He(this.firestore,null,t)}}function Lm(n,e,t){n=Me(n,He);const i=Me(n.firestore,Ye),r=Cl(n.converter,e,t);return qo(i,[wl(cs(i),"setDoc",n._key,r,null!==n.converter,t).toMutation(n._key,Ke.none())])}function Fm(n,e,t,...i){n=Me(n,He);const r=Me(n.firestore,Ye),s=cs(r);let u;return u="string"==typeof(e=(0,J.m9)(e))||e instanceof yi?hf(s,"updateDoc",n._key,e,t,i):lf(s,"updateDoc",n._key,e),qo(r,[u.toMutation(n._key,Ke.exists(!0))])}function Um(n,...e){var t,i,r;n=(0,J.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||uf(e[u])||(s=e[u],u++);const h={includeMetadataChanges:s.includeMetadataChanges};if(uf(e[u])){const I=e[u];e[u]=null===(t=I.next)||void 0===t?void 0:t.bind(I),e[u+1]=null===(i=I.error)||void 0===i?void 0:i.bind(I),e[u+2]=null===(r=I.complete)||void 0===r?void 0:r.bind(I)}let f,m,_;if(n instanceof He)m=Me(n.firestore,Ye),_=ji(n._key.path),f={next:I=>{e[u]&&e[u](_f(m,n,I))},error:e[u+1],complete:e[u+2]};else{const I=Me(n,St);m=Me(I.firestore,Ye),_=I._query;const k=new ar(m);f={next:U=>{e[u]&&e[u](new or(m,k,I,U))},error:e[u+1],complete:e[u+2]},Cm(n._query)}return function(I,k,U,B){const Y=new gl(B),se=new bd(k,Y,U);return I.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return vd(yield Bo(I),se)})),()=>{Y.bc(),I.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return wd(yield Bo(I),se)}))}}(ut(m),_,h,f)}function qo(n,e){return function(t,i){const r=new at;return t.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function ry(n,e,t){return Sd.apply(this,arguments)}(yield of(t),i,r)})),r.promise}(ut(n),e)}function _f(n,e,t){const i=t.docs.get(e._key),r=new ar(n);return new vi(n,r,e._key,i,new hs(t.hasPendingWrites,t.fromCache),e.converter)}const vv={maxAttempts:5};class Vm{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=cs(e)}set(e,t,i){this._verifyNotCommitted();const r=ur(e,this._firestore),s=Cl(r.converter,t,i),u=wl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,i);return this._mutations.push(u.toMutation(r._key,Ke.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=ur(e,this._firestore);let u;return u="string"==typeof(t=(0,J.m9)(t))||t instanceof yi?hf(this._dataReader,"WriteBatch.update",s._key,t,i,r):lf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,Ke.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=ur(e,this._firestore);return this._mutations=this._mutations.concat(new Qi(t._key,Ke.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new V(N.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ur(n,e){if((n=(0,J.m9)(n)).firestore!==e)throw new V(N.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Iv extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=cs(e)}get(e){const t=ur(e,this._firestore),i=new uv(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||1!==r.length)return K();const s=r[0];if(s.isFoundDocument())return new wu(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new wu(this._firestore,i,t._key,null,t.converter);throw K()})}set(e,t,i){const r=ur(e,this._firestore),s=Cl(r.converter,t,i),u=wl(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,i);return this._transaction.set(r._key,u),this}update(e,t,i,...r){const s=ur(e,this._firestore);let u;return u="string"==typeof(t=(0,J.m9)(t))||t instanceof yi?hf(this._dataReader,"Transaction.update",s._key,t,i,r):lf(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=ur(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=ur(e,this._firestore),i=new ar(this._firestore);return super.get(e).then(r=>new vi(this._firestore,i,t._key,r._document,new hs(!1,!1),t.converter))}}function yf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new V("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Zm(){if("undefined"==typeof Uint8Array)throw new V("unimplemented","Uint8Arrays are not available in this environment.")}function qm(){if(!function Ma(){return"undefined"!=typeof atob}())throw new V("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Pr=Ue.SDK_VERSION,(0,Ue._registerComponent)(new Ae.wA("firestore",(t,{instanceIdentifier:i,options:r})=>{const s=t.getProvider("app").getImmediate(),u=new Ye(new lc(t.getProvider("auth-internal")),new ka(t.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new V(N.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new on(h.options.projectId,f)}(s,i),s);return r=Object.assign({useFetchStreams:e},r),u._setSettings(r),u},"PUBLIC").setMultipleInstances(!0)),(0,Ue.registerVersion)(uc,"3.8.0",n),(0,Ue.registerVersion)(uc,"3.8.0","esm2017")}();class xu{constructor(e){this._delegate=e}static fromBase64String(e){return qm(),new xu(Wn.fromBase64String(e))}static fromUint8Array(e){return Zm(),new xu(Wn.fromUint8Array(e))}toBase64(){return qm(),this._delegate.toBase64()}toUint8Array(){return Zm(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function vf(n){return function Sv(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const i of e)if(i in t&&"function"==typeof t[i])return!0;return!1}(n,["next","error","complete"])}class Dv{enableIndexedDbPersistence(e,t){return function Uy(n,e){Im(n=Me(n,Ye));const t=ut(n),i=n._freezeSettings(),r=new Yd;return vm(t,r,new tm(r,i.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function Vy(n){Im(n=Me(n,Ye));const e=ut(n),t=n._freezeSettings(),i=new Yd;return vm(e,i,new Iy(i,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function By(n){if(n._initialized&&!n._terminated)throw new V(N.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new at;return n._queue.enqueueAndForgetEvenWhileRestricted((0,R.Z)(function*(){try{yield(t=(0,R.Z)(function*(i){if(!Ht.C())return Promise.resolve();const r=i+"main";yield Ht.delete(r)}),function(i){return t.apply(this,arguments)})(Gh(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Gm{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof on||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&$t("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,i={}){!function um(n,e,t,i={}){var r;const s=(n=Me(n,vu))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&$t("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let u,h;if("string"==typeof i.mockUserToken)u=i.mockUserToken,h=dt.MOCK_USER;else{u=(0,J.Sg)(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new V(N.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new dt(f)}n._authCredentials=new zs(new Aa(u,h))}}(this._delegate,e,t,i)}enableNetwork(){return function qy(n){return function Cy(n){return n.asyncQueue.enqueue((0,R.Z)(function*(){const e=yield pm(n),t=yield sf(n);return e.setNetworkEnabled(!0),function(i){const r=Q(i);return r._u.delete(0),_u(r)}(t)}))}(ut(n=Me(n,Ye)))}(this._delegate)}disableNetwork(){return function Gy(n){return function Sy(n){return n.asyncQueue.enqueue((0,R.Z)(function*(){const e=yield pm(n),t=yield sf(n);return e.setNetworkEnabled(!1),(i=(0,R.Z)(function*(r){const s=Q(r);s._u.add(0),yield No(s),s.gu.set("Offline")}),function(r){return i.apply(this,arguments)})(t);var i}))}(ut(n=Me(n,Ye)))}(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,nm("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function Zy(n){return function(e){const t=new at;return e.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return function uy(n,e){return Md.apply(this,arguments)}(yield of(e),t)})),t.promise}(ut(n=Me(n,Ye)))}(this._delegate)}onSnapshotsInSync(e){return function yv(n,e){return function Oy(n,e){const t=new gl(e);return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return i=yield Bo(n),r=t,Q(i).Ru.add(r),void r.next();var i,r})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return i=yield Bo(n),r=t,void Q(i).Ru.delete(r);var i,r}))}}(ut(n=Me(n,Ye)),uf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new V("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Go(this,cm(this._delegate,e))}catch(t){throw Ut(t,"collection()","Firestore.collection()")}}doc(e){try{return new pn(this,ml(this._delegate,e))}catch(t){throw Ut(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Vt(this,function wy(n,e){if(n=Me(n,vu),Qd("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new V(N.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new St(n,null,(t=e,new wn(Ne.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw Ut(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function wv(n,e,t){n=Me(n,Ye);const i=Object.assign(Object.assign({},vv),t);return function(r){if(r.maxAttempts<1)throw new V(N.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(r,s,u){const h=new at;return r.asyncQueue.enqueueAndForget((0,R.Z)(function*(){const f=yield function mm(n){return _l(n).then(e=>e.datastore)}(r);new Ay(r.asyncQueue,f,u,s,h).run()})),h.promise}(ut(n),r=>e(new Iv(n,r)),i)}(this._delegate,t=>e(new Wm(this,t)))}batch(){return ut(this._delegate),new zm(new Vm(this._delegate,e=>qo(this._delegate,e)))}loadBundle(e){return function Wy(n,e){const t=ut(n=Me(n,Ye)),i=new Ly;return function Ny(n,e,t,i){const r=function(s,u){let h;return h="string"==typeof s?(new TextEncoder).encode(s):s,f=function(f,m){if(f instanceof Uint8Array)return hm(f,m);if(f instanceof ArrayBuffer)return hm(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),new Ey(f,u);var f}(t,gu(e));n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){!function vy(n,e,t){const i=Q(n);var r;(r=(0,R.Z)(function*(s,u,h){try{const f=yield u.getMetadata();if(yield function(k,U){const B=Q(k),Y=nt(U.createTime);return B.persistence.runTransaction("hasNewerBundle","readonly",se=>B.Ns.getBundleMetadata(se,U.id)).then(se=>!!se&&se.createTime.compareTo(Y)>=0)}(s.localStore,f))return yield u.close(),h._completeWith({taskState:"Success",documentsLoaded:(k=f).totalDocuments,bytesLoaded:k.totalBytes,totalDocuments:k.totalDocuments,totalBytes:k.totalBytes}),Promise.resolve(new Set);h._updateProgress(zp(f));const m=new J_(f,s.localStore,u.yt);let _=yield u.mc();for(;_;){const k=yield m.Fu(_);k&&h._updateProgress(k),_=yield u.mc()}const I=yield m.complete();return yield _i(s,I.Lu,void 0),yield function(k,U){const B=Q(k);return B.persistence.runTransaction("Save bundle","readwrite",Y=>B.Ns.saveBundleMetadata(Y,U))}(s.localStore,f),h._completeWith(I.progress),Promise.resolve(I.Bu)}catch(f){return $t("SyncEngine",`Loading bundle failed with ${f}`),h._failWith(f),Promise.resolve(new Set)}var k}),function(s,u,h){return r.apply(this,arguments)})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}(yield of(n),r,i)}))}(t,n._databaseId,e,i),i}(this._delegate,e)}namedQuery(e){return function zy(n,e){return function My(n,e){return n.asyncQueue.enqueue((0,R.Z)(function*(){return function(t,i){const r=Q(t);return r.persistence.runTransaction("Get named query","readonly",s=>r.Ns.getNamedQuery(s,i))}(yield yl(n),e)}))}(ut(n=Me(n,Ye)),e).then(t=>t?new St(n,null,t.query):null)}(this._delegate,e).then(t=>t?new Vt(this,t):null)}}class Sl extends gf{constructor(e){super(),this.firestore=e}convertBytes(e){return new xu(new Wn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return pn.forKey(t,this.firestore,null)}}class Wm{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Sl(e)}get(e){const t=fs(e);return this._delegate.get(t).then(i=>new Au(this._firestore,new vi(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const r=fs(e);return i?(yf("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}}class zm{constructor(e){this._delegate=e}set(e,t,i){const r=fs(e);return i?(yf("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=fs(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=fs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ds{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new bu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new ku(this._firestore,i),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=ds.INSTANCES;let r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new ds(e,new Sl(e),t),r.set(t,s)),s}}ds.INSTANCES=new WeakMap;class pn{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Sl(e)}static forPath(e,t,i){if(e.length%2!=0)throw new V("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new pn(t,new He(t._delegate,i,new H(e)))}static forKey(e,t,i){return new pn(t,new He(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Go(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Go(this.firestore,cm(this._delegate,e))}catch(t){throw Ut(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,J.m9)(e))instanceof He&&lm(this._delegate,e)}set(e,t){t=yf("DocumentReference.set",t);try{return t?Lm(this._delegate,e,t):Lm(this._delegate,e)}catch(i){throw Ut(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return 1===arguments.length?Fm(this._delegate,e):Fm(this._delegate,e,t,...i)}catch(r){throw Ut(r,"updateDoc()","DocumentReference.update()")}}delete(){return function gv(n){return qo(Me(n.firestore,Ye),[new Qi(n._key,Ke.none())])}(this._delegate)}onSnapshot(...e){const t=jm(e),i=Km(e,r=>new Au(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Um(this._delegate,t,i)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function hv(n){n=Me(n,He);const e=Me(n.firestore,Ye),t=ut(e),i=new ar(e);return function Dy(n,e){const t=new at;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return(i=(0,R.Z)(function*(r,s,u){try{const h=yield function(f,m){const _=Q(f);return _.persistence.runTransaction("read document","readonly",I=>_.localDocuments.getDocument(I,m))}(r,s);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new V(N.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const f=Lo(h,`Failed to get document '${s} from cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield yl(n),e,t);var i})),t.promise}(t,n._key).then(r=>new vi(e,i,n._key,r,new hs(null!==r&&r.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function dv(n){n=Me(n,He);const e=Me(n.firestore,Ye);return gm(ut(e),n._key,{source:"server"}).then(t=>_f(e,n,t))}(this._delegate):function lv(n){n=Me(n,He);const e=Me(n.firestore,Ye);return gm(ut(e),n._key).then(t=>_f(e,n,t))}(this._delegate),t.then(i=>new Au(this.firestore,new vi(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new pn(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function Ut(n,e,t){return n.message=n.message.replace(e,t),n}function jm(n){for(const e of n)if("object"==typeof e&&!vf(e))return e;return{}}function Km(n,e){var t,i;let r;return r=vf(n[0])?n[0]:vf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:null===(t=r.error)||void 0===t?void 0:t.bind(r),complete:null===(i=r.complete)||void 0===i?void 0:i.bind(r)}}class Au{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new pn(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Pm(this._delegate,e._delegate)}}class ku extends Au{data(e){const t=this._delegate.data(e);return function xa(n,e){n||K()}(void 0!==t),t}}class Vt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Sl(e)}where(e,t,i){try{return new Vt(this.firestore,sr(this._delegate,function ev(n,e,t){const i=e,r=bl("where",n);return Tu._create(r,i,t)}(e,t,i)))}catch(r){throw Ut(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new Vt(this.firestore,sr(this._delegate,function tv(n,e="asc"){const t=e,i=bl("orderBy",n);return mf._create(i,t)}(e,t)))}catch(i){throw Ut(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new Vt(this.firestore,sr(this._delegate,function nv(n){return sm("limit",n),xl._create("limit",n,"F")}(e)))}catch(t){throw Ut(t,"limit()","Query.limit()")}}limitToLast(e){try{return new Vt(this.firestore,sr(this._delegate,function iv(n){return sm("limitToLast",n),xl._create("limitToLast",n,"L")}(e)))}catch(t){throw Ut(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new Vt(this.firestore,sr(this._delegate,function rv(...n){return Al._create("startAt",n,!0)}(...e)))}catch(t){throw Ut(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new Vt(this.firestore,sr(this._delegate,function sv(...n){return Al._create("startAfter",n,!1)}(...e)))}catch(t){throw Ut(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new Vt(this.firestore,sr(this._delegate,function ov(...n){return kl._create("endBefore",n,!1)}(...e)))}catch(t){throw Ut(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new Vt(this.firestore,sr(this._delegate,function av(...n){return kl._create("endAt",n,!0)}(...e)))}catch(t){throw Ut(t,"endAt()","Query.endAt()")}}isEqual(e){return Jd(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function pv(n){n=Me(n,St);const e=Me(n.firestore,Ye),t=ut(e),i=new ar(e);return function Ry(n,e){const t=new at;return n.asyncQueue.enqueueAndForget((0,R.Z)(function*(){return(i=(0,R.Z)(function*(r,s,u){try{const h=yield ul(r,s,!0),f=new $p(s,h.Hi),m=f.Wu(h.documents),_=f.applyChanges(m,!1);u.resolve(_.snapshot)}catch(h){const f=Lo(h,`Failed to execute query '${s} against cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield yl(n),e,t);var i})),t.promise}(t,n._query).then(r=>new or(e,i,n,r))}(this._delegate):"server"===(null==e?void 0:e.source)?function mv(n){n=Me(n,St);const e=Me(n.firestore,Ye),t=ut(e),i=new ar(e);return _m(t,n._query,{source:"server"}).then(r=>new or(e,i,n,r))}(this._delegate):function fv(n){n=Me(n,St);const e=Me(n.firestore,Ye),t=ut(e),i=new ar(e);return Cm(n._query),_m(t,n._query).then(r=>new or(e,i,n,r))}(this._delegate),t.then(i=>new If(this.firestore,new or(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=jm(e),i=Km(e,r=>new If(this.firestore,new or(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Um(this._delegate,t,i)}withConverter(e){return new Vt(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}class Ov{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new ku(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class If{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Vt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new ku(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new Ov(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new ku(this._firestore,i))})}isEqual(e){return Pm(this._delegate,e._delegate)}}class Go extends Vt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new pn(this.firestore,e):null}doc(e){try{return new pn(this.firestore,void 0===e?ml(this._delegate):ml(this._delegate,e))}catch(t){throw Ut(t,"doc()","CollectionReference.doc()")}}add(e){return function _v(n,e){const t=Me(n.firestore,Ye),i=ml(n),r=Cl(n.converter,e);return qo(t,[wl(cs(n.firestore),"addDoc",i._key,r,null!==n.converter,{}).toMutation(i._key,Ke.exists(!1))]).then(()=>i)}(this._delegate,e).then(t=>new pn(this.firestore,t))}isEqual(e){return lm(this._delegate,e._delegate)}withConverter(e){return new Go(this.firestore,this._delegate.withConverter(e?ds.getInstance(this.firestore,e):null))}}function fs(n){return Me(n,He)}class wf{constructor(...e){this._delegate=new yi(...e)}static documentId(){return new wf(et.keyField().canonicalString())}isEqual(e){return(e=(0,J.m9)(e))instanceof yi&&this._delegate._internalPath.isEqual(e._internalPath)}}class ps{constructor(e){this._delegate=e}static serverTimestamp(){const e=function Tv(){return new cf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ps(e)}static delete(){const e=function Ev(){return new Iu("deleteField")}();return e._methodName="FieldValue.delete",new ps(e)}static arrayUnion(...e){const t=function bv(...n){return new Hy("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new ps(t)}static arrayRemove(...e){const t=function xv(...n){return new Yy("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new ps(t)}static increment(e){const t=function Av(n){return new Qy("increment",n)}(e);return t._methodName="FieldValue.increment",new ps(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const Nv={Firestore:Gm,GeoPoint:vl,Timestamp:ze,Blob:xu,Transaction:Wm,WriteBatch:zm,DocumentReference:pn,DocumentSnapshot:Au,Query:Vt,QueryDocumentSnapshot:ku,QuerySnapshot:If,CollectionReference:Go,FieldPath:wf,FieldValue:ps,setLogLevel:function Rv(n){!function Rn(n){Kt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function Pv(n){(function Mv(n,e){n.INTERNAL.registerComponent(new Ae.wA("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},Nv)))})(n,(e,t)=>new Gm(e,t,new Dv)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(xe.Z);var Lv=M(7579),Fv=M(6451),Dl=M(5363),cr=M(3900),$m=M(4782),Uv=M(590),Vv=M(576);function Hm(n,e){return(0,Vv.m)(e)?(0,cr.w)(()=>n,e):(0,cr.w)(()=>n)}var Ef=M(9468);M(259);const bf=new Map,Qm={activated:!1,tokenObservers:[]},Wv={initialized:!1,enabled:!1};function Dt(n){return bf.get(n)||Object.assign({},Qm)}function Ol(){return Wv}class Yv{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,R.Z)(function*(){t.stop();try{t.pending=new J.BH,yield function Qv(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new J.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(i){t.retryPolicy(i)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const Bt=new J.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Xm(n){if(!Dt(n).activated)throw Bt.create("use-before-activation",{appName:n.name})}function kf(n,e){return Cf.apply(this,arguments)}function Cf(){return Cf=(0,R.Z)(function*({url:n,body:e},t){const i={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});if(r){const I=yield r.getHeartbeatsHeader();I&&(i["X-Firebase-Client"]=I)}const s={method:"POST",body:JSON.stringify(e),headers:i};let u,h;try{u=yield fetch(n,s)}catch(I){throw Bt.create("fetch-network-error",{originalErrorMessage:null==I?void 0:I.message})}if(200!==u.status)throw Bt.create("fetch-status-error",{httpStatus:u.status});try{h=yield u.json()}catch(I){throw Bt.create("fetch-parse-error",{originalErrorMessage:null==I?void 0:I.message})}const f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw Bt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});const m=1e3*Number(f[1]),_=Date.now();return{token:h.token,expireTimeMillis:_+m,issuedAtTimeMillis:_}}),Cf.apply(this,arguments)}function t0(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${i}:exchangeDebugToken?key=${r}`,body:{debug_token:e}}}const Cu="firebase-app-check-store";let Pl=null;function tg(){return Pl||(Pl=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(Bt.create("storage-open",{originalErrorMessage:null===(r=i.target.error)||void 0===r?void 0:r.message}))},t.onupgradeneeded=i=>{0===i.oldVersion&&i.target.result.createObjectStore(Cu,{keyPath:"compositeKey"})}}catch(t){e(Bt.create("storage-open",{originalErrorMessage:null==t?void 0:t.message}))}}),Pl)}function Sf(){return Sf=(0,R.Z)(function*(n,e){const i=(yield tg()).transaction(Cu,"readwrite"),s=i.objectStore(Cu).put({compositeKey:n,value:e});return new Promise((u,h)=>{s.onsuccess=f=>{u()},i.onerror=f=>{var m;h(Bt.create("storage-set",{originalErrorMessage:null===(m=f.target.error)||void 0===m?void 0:m.message}))}})}),Sf.apply(this,arguments)}const Su=new Ie.Yd("@firebase/app-check");function Of(n,e){return(0,J.hl)()?function o0(n,e){return function ng(n,e){return Sf.apply(this,arguments)}(function rg(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Su.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function sg(){return Ol().enabled}function og(){return Mf.apply(this,arguments)}function Mf(){return Mf=(0,R.Z)(function*(){const n=Ol();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),Mf.apply(this,arguments)}const d0={error:"UNKNOWN_ERROR"};function f0(n){return J.US.encodeString(JSON.stringify(n),!1)}function Ll(n){return Pf.apply(this,arguments)}function Pf(){return Pf=(0,R.Z)(function*(n,e=!1){const t=n.app;Xm(t);const i=Dt(t);let s,r=i.token;if(r&&!Wo(r)&&(i.token=void 0,r=void 0),!r){const f=yield i.cachedTokenPromise;f&&(Wo(f)?r=f:yield Of(t,void 0))}if(!e&&r&&Wo(r))return{token:r.token};let h,u=!1;if(sg()){i.exchangeTokenPromise||(i.exchangeTokenPromise=kf(t0(t,yield og()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);const f=yield i.exchangeTokenPromise;return yield Of(t,f),i.token=f,{token:f.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),r=yield Dt(t).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?Su.warn(f.message):Su.error(f),s=f}return r?s?h=Wo(r)?{token:r.token,internalError:s}:cg(s):(h={token:r.token},i.token=r,yield Of(t,r)):h=cg(s),u&&ug(t,h),h}),Pf.apply(this,arguments)}function Ff(n,e){const t=Dt(n),i=t.tokenObservers.filter(r=>r.next!==e);0===i.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function ag(n){const{app:e}=n,t=Dt(e);let i=t.tokenRefresher;i||(i=function p0(n){const{app:e}=n;return new Yv((0,R.Z)(function*(){let i;if(i=Dt(e).token?yield Ll(n,!0):yield Ll(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{const t=Dt(e);if(t.token){let i=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return i=Math.min(i,t.token.expireTimeMillis-3e5),Math.max(0,i-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function ug(n,e){const t=Dt(n).tokenObservers;for(const i of t)try{"EXTERNAL"===i.type&&null!=e.error?i.error(e.error):i.next(e)}catch(r){}}function Wo(n){return n.expireTimeMillis-Date.now()>0}function cg(n){return{token:f0(d0),error:n}}class m0{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Dt(this.app);for(const t of e)Ff(this.app,t.next);return Promise.resolve()}}const _g="app-check-internal";!function S0(){(0,Ue._registerComponent)(new Ae.wA("app-check",n=>function g0(n,e){return new m0(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(_g).initialize()})),(0,Ue._registerComponent)(new Ae.wA(_g,n=>function _0(n){return{getToken:e=>Ll(n,e),addTokenListener:e=>function Lf(n,e,t,i){const{app:r}=n,s=Dt(r);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:i,type:e}],s.token&&Wo(s.token)){const h=s.token;Promise.resolve().then(()=>{t({token:h.token}),ag(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>ag(n))}(n,"INTERNAL",e),removeTokenListener:e=>Ff(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,Ue.registerVersion)("@firebase/app-check","0.6.0")}();class Zf{constructor(){return(0,ue.vb)("app-check")}}"undefined"!=typeof window&&window,M(9260);const vg=new v.OlP("angularfire2.auth.use-emulator"),Ig=new v.OlP("angularfire2.auth.settings"),wg=new v.OlP("angularfire2.auth.tenant-id"),Eg=new v.OlP("angularfire2.auth.langugage-code"),Tg=new v.OlP("angularfire2.auth.use-device-language"),bg=new v.OlP("angularfire.auth.persistence"),xg=(n,e,t,i,r,s,u,h)=>(0,Se.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const f=e.runOutsideAngular(()=>n.auth());if(t&&f.useEmulator(...t),i&&(f.tenantId=i),f.languageCode=r,s&&f.useDeviceLanguage(),u)for(const[m,_]of Object.entries(u))f.settings[m]=_;return h&&f.setPersistence(h),f},[t,i,r,s,u,h]);let Ag=(()=>{class n{constructor(t,i,r,s,u,h,f,m,_,I,k,U){const B=new Lv.x,Y=(0,me.of)(void 0).pipe((0,Dl.Q)(u.outsideAngular),(0,cr.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(M.bind(M,9169)))),(0,ge.U)(()=>(0,Se.on)(t,s,i)),(0,ge.U)(se=>xg(se,s,h,m,_,I,f,k)),(0,$m.d)({bufferSize:1,refCount:!1}));if((0,d.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,me.of)(null);else{Y.pipe((0,Uv.P)()).subscribe();const Fe=Y.pipe((0,cr.w)(we=>we.getRedirectResult().then(ve=>ve,()=>null)),ue.iC,(0,$m.d)({bufferSize:1,refCount:!1})),Ze=Y.pipe((0,cr.w)(we=>new y.y(ve=>({unsubscribe:s.runOutsideAngular(()=>we.onAuthStateChanged(Te=>ve.next(Te),Te=>ve.error(Te),()=>ve.complete()))})))),Ce=Y.pipe((0,cr.w)(we=>new y.y(ve=>({unsubscribe:s.runOutsideAngular(()=>we.onIdTokenChanged(Te=>ve.next(Te),Te=>ve.error(Te),()=>ve.complete()))}))));this.authState=Fe.pipe(Hm(Ze),(0,Ef.R)(u.outsideAngular),(0,Dl.Q)(u.insideAngular)),this.user=Fe.pipe(Hm(Ce),(0,Ef.R)(u.outsideAngular),(0,Dl.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,cr.w)(we=>we?(0,ie.D)(we.getIdToken()):(0,me.of)(null))),this.idTokenResult=this.user.pipe((0,cr.w)(we=>we?(0,ie.D)(we.getIdTokenResult()):(0,me.of)(null))),this.credential=(0,Fv.T)(Fe,B,this.authState.pipe((0,fe.h)(we=>!we))).pipe((0,ge.U)(we=>(null==we?void 0:we.user)?we:null),(0,Ef.R)(u.outsideAngular),(0,Dl.Q)(u.insideAngular))}return(0,Se.pX)(this,Y,s,{spy:{apply:(se,Fe,Ze)=>{(se.startsWith("signIn")||se.startsWith("createUser"))&&Ze.then(Ce=>B.next(Ce))}}})}}return n.\u0275fac=function(t){return new(t||n)(v.LFG(Se.Dh),v.LFG(Se.xv,8),v.LFG(v.Lbi),v.LFG(v.R0b),v.LFG(ue.HU),v.LFG(vg,8),v.LFG(Ig,8),v.LFG(wg,8),v.LFG(Eg,8),v.LFG(Tg,8),v.LFG(bg,8),v.LFG(Zf,8))},n.\u0275prov=v.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function kg(n,e){return function P0(n,e=F.z){return new y.y(t=>{let i;return null!=e?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=i&&i()}})}(n,e)}function Gf(n,e){return kg(n,e).pipe((0,ge.U)(t=>({payload:t,type:"query"})))}function Ul(n,e){return Gf(n,e).pipe((0,be.O)(void 0),Pe(),(0,ge.U)(([t,i])=>{const r=i.payload.docChanges(),s=r.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,h)=>{const f=r.find(_=>_.doc.ref.isEqual(u.ref)),m=null==t?void 0:t.payload.docs.find(_=>_.ref.isEqual(u.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(u.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:h,newIndex:h,type:"modified",doc:u}})}),s}))}function Cg(n,e,t){return Ul(n,t).pipe((0,re.R)((i,r)=>function F0(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=function U0(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return Wf(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return Wf(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Wf(n,e.oldIndex,1)}return n}(n,i))}),n}(i,r.map(s=>s.payload),e),[]),(0,Ee.x)(),(0,ge.U)(i=>i.map(r=>({type:r.type,payload:r}))))}function Wf(n,e,t,...i){const r=n.slice();return r.splice(e,t,...i),r}function Sg(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Dg{constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Ul(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ge.U)(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe((0,be.O)(void 0),Pe(),(0,fe.h)(([i,r])=>r.length>0||!i),(0,ge.U)(([i,r])=>r),ue.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,re.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=Sg(e);return Cg(this.query,t,this.afs.schedulers.outsideAngular).pipe(ue.iC)}valueChanges(e={}){return Gf(this.query,this.afs.schedulers.outsideAngular).pipe((0,ge.U)(t=>t.payload.docs.map(i=>e.idField?Object.assign(Object.assign({},i.data()),{[e.idField]:i.id}):i.data())),ue.iC)}get(e){return(0,ie.D)(this.query.get(e)).pipe(ue.iC)}add(e){return this.ref.add(e)}doc(e){return new Rg(this.ref.doc(e),this.afs)}}class Rg{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const i=this.ref.collection(e),{ref:r,query:s}=Og(i,t);return new Dg(r,s,this.afs)}snapshotChanges(){return function L0(n,e){return kg(n,e).pipe((0,be.O)(void 0),Pe(),(0,ge.U)(([t,i])=>i.exists?(null==t?void 0:t.exists)?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ue.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ge.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,ie.D)(this.ref.get(e)).pipe(ue.iC)}}class V0{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ul(this.query,this.afs.schedulers.outsideAngular).pipe((0,ge.U)(t=>t.filter(i=>e.indexOf(i.type)>-1)),(0,fe.h)(t=>t.length>0),ue.iC):Ul(this.query,this.afs.schedulers.outsideAngular).pipe(ue.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,re.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=Sg(e);return Cg(this.query,t,this.afs.schedulers.outsideAngular).pipe(ue.iC)}valueChanges(e={}){return Gf(this.query,this.afs.schedulers.outsideAngular).pipe((0,ge.U)(i=>i.payload.docs.map(r=>e.idField?Object.assign({[e.idField]:r.id},r.data()):r.data())),ue.iC)}get(e){return(0,ie.D)(this.query.get(e)).pipe(ue.iC)}}const B0=new v.OlP("angularfire2.enableFirestorePersistence"),Z0=new v.OlP("angularfire2.firestore.persistenceSettings"),q0=new v.OlP("angularfire2.firestore.settings"),G0=new v.OlP("angularfire2.firestore.use-emulator");function Og(n,e=(t=>t)){return{query:e(n),ref:n}}let W0=(()=>{class n{constructor(t,i,r,s,u,h,f,m,_,I,k,U,B,Y,se,Fe,Ze){this.schedulers=f;const Ce=(0,Se.on)(t,h,i),we=_;I&&xg(Ce,h,k,B,Y,se,U,Fe),[this.firestore,this.persistenceEnabled$]=(0,Se.cc)(`${Ce.name}.firestore`,"AngularFirestore",Ce.name,()=>{const ve=h.runOutsideAngular(()=>Ce.firestore());if(s&&ve.settings(s),we&&ve.useEmulator(...we),r&&!(0,d.PM)(u)){const Te=()=>{try{return(0,ie.D)(ve.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(yt){return"undefined"!=typeof console&&console.warn(yt),(0,me.of)(!1)}};return[ve,h.runOutsideAngular(Te)]}return[ve,(0,me.of)(!1)]},[s,we,r])}collection(t,i){let r;r="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=Og(r,i),h=this.schedulers.ngZone.run(()=>s);return new Dg(h,u,this)}collectionGroup(t,i){const r=i||(u=>u),s=this.firestore.collectionGroup(t);return new V0(r(s),this)}doc(t){let i;i="string"==typeof t?this.firestore.doc(t):t;const r=this.schedulers.ngZone.run(()=>i);return new Rg(r,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(v.LFG(Se.Dh),v.LFG(Se.xv,8),v.LFG(B0,8),v.LFG(q0,8),v.LFG(v.Lbi),v.LFG(v.R0b),v.LFG(ue.HU),v.LFG(Z0,8),v.LFG(G0,8),v.LFG(Ag,8),v.LFG(vg,8),v.LFG(Ig,8),v.LFG(wg,8),v.LFG(Eg,8),v.LFG(Tg,8),v.LFG(bg,8),v.LFG(Zf,8))},n.\u0275prov=v.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})()},5619:(mn,Qe,M)=>{M.d(Qe,{v:()=>Pe});var v=M(5e3),F=M(4968),y=M(641),ie=M(5216),me=M(432),ue=M(2340);class z extends me.C{constructor(ge){super(void 0,ge),this.size=64}drawPosition(){}drawActorName(){}drawShape(){this._img||(this._img=document.createElement("img"),this._img.src=ue.N.production?"/vb_positions/assets/icons/icon-192x192.png":"/assets/icons/icon-192x192.png",this._img.onload=()=>this.draw()),this.context.drawImage(this._img,this.x-this.size/2,this.y-this.size/2,this.size,this.size)}isHit(ge,re){return ge>=this.x-this.size/2&&ge<=this.x+this.size/2&&re>=this.y-this.size/2&&re<=this.y+this.size/2}copy(ge){return new z(this.context)}}const Re=["field"];let Pe=(()=>{class be{constructor(){this.measureMode=!1,this.actors=[],this.lines=[],this.courtMode=ie.T.MOVE_ACTOR,this.customRender=()=>{},this.onRender=new v.vpe,this.onReady=new v.vpe,this.onLineAdded=new v.vpe,this.onLineErased=new v.vpe,this.volleyballPosition=new v.vpe,this.mouseDown=!1}ngAfterViewInit(){this.context=this.fieldElement.nativeElement.getContext("2d"),this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height;for(const re of[["touchstart","mousedown"],["touchmove","mousemove"]])this.context.canvas.addEventListener(re[0],Ee=>{const fe=Ee.touches[0];this.fieldElement.nativeElement.dispatchEvent(new MouseEvent(re[1],{clientX:fe.clientX,clientY:fe.clientY}))});this.context.canvas.addEventListener("touchend",()=>this.onMouseUp()),this.context.canvas.addEventListener("touchcancel",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousedown",re=>this.onMouseDown(re)),this.fieldElement.nativeElement.addEventListener("mouseup",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mouseleave",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousemove",re=>this.onMouseMove(re)),this.measureMode&&(this._volleyball=new z(this.context),this._volleyball.setPosition(this.context.canvas.width/2,this.context.canvas.height/2)),(0,F.R)(window,"resize").subscribe(()=>this.render()),setTimeout(()=>this.onReady.emit(this.context),100),setTimeout(()=>this.render(),50),setTimeout(()=>this.render(),500)}ngOnChanges(){!this.context||this.render()}onMouseDown(re){const Ee=this.context.canvas.getBoundingClientRect(),fe=re.clientX-Ee.left,Se=re.clientY-Ee.top;if(this.mouseDown=!0,this._volleyball&&this._volleyball.isHit(fe,Se))this.draggedShape=this._volleyball;else if(this.courtMode===ie.T.MOVE_ACTOR)for(let d=this.actors.length-1;d>=0;--d){const ye=this.actors[d];if(ye.isHit(fe,Se))return void(this.draggedShape=ye)}else this.courtMode===ie.T.DRAW_LINE&&(this.drawnLine=new y.x(this.context),this.drawnLine.addPosition(fe,Se))}onMouseUp(){this.drawnLine&&this.onLineAdded.emit(this.drawnLine),this.draggedShape=void 0,this.drawnLine=void 0,this.mouseDown=!1}onMouseMove(re){const Ee=this.context.canvas.getBoundingClientRect(),fe=re.clientX-Ee.left,Se=re.clientY-Ee.top;if(this.courtMode===ie.T.ERASE_LINE){if(this.mouseDown){const d=this.lines.find(ye=>ye.isHit(fe,Se));if(!d)return;this.onLineErased.emit(d)}}else if(this.draggedShape)this._volleyball&&this.emitVolleyballPosition(),this.draggedShape.setPosition(fe,Se);else{if(!this.drawnLine)return;this.drawnLine.addPosition(fe,Se)}this.render()}render(){this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height,this.initCourt(),this.actors.forEach(re=>re.draw()),this.lines.forEach(re=>re.draw()),this.drawnLine&&this.drawnLine.draw(),this._volleyball&&this._volleyball.draw(),this.customRender(this.context),this.onRender.emit()}initCourt(){const re=this.context.canvas.getBoundingClientRect().width,Ee=this.context.canvas.getBoundingClientRect().height;this.context.clearRect(0,0,re,Ee),this.context.fillStyle=be.OUTER_COLOR,this.context.fillRect(0,0,re,Ee);const fe=.025*re,d=(Ee-.025*Ee)/10,ye=(re-2*fe)/9,xe=fe,R=re-2*fe;this.context.fillStyle=be.FRONT_FIELD_COLOR,this.context.fillRect(xe,0,R,4*d),this.context.fillStyle=be.BACK_FIELD_COLOR,this.context.fillRect(xe,4*d,R,6*d);const Ue=d/20,Ae=ye/20;this.context.fillStyle=be.LINE_COLOR,this.context.fillRect(xe,0,Ae,10*d),this.context.fillRect(R+xe-Ae,0,Ae,10*d),this.context.fillRect(xe,4*d,R,Ue),this.context.fillRect(xe,10*d,R,Ue),this.context.fillRect(xe,d-3*Ue,R,3*Ue)}emitVolleyballPosition(){if(!this._volleyball)return;const re=this._volleyball.getFieldPosition(),Ee=[225,1e3];this.volleyballPosition.emit([re.x,re.y,Number(((re.x-Ee[0])/1e3).toFixed(2)),Number(((re.y-Ee[1])/1e3).toFixed(2))])}}return be.OUTER_COLOR="#469ABB",be.LINE_COLOR="#FFFFFF",be.FRONT_FIELD_COLOR="#FF5202",be.BACK_FIELD_COLOR="#F8A941",be.\u0275fac=function(re){return new(re||be)},be.\u0275cmp=v.Xpm({type:be,selectors:[["vpms-court"]],viewQuery:function(re,Ee){if(1&re&&v.Gf(Re,5),2&re){let fe;v.iGM(fe=v.CRH())&&(Ee.fieldElement=fe.first)}},inputs:{measureMode:"measureMode",actors:"actors",lines:"lines",courtMode:"courtMode",customRender:"customRender"},outputs:{onRender:"onRender",onReady:"onReady",onLineAdded:"onLineAdded",onLineErased:"onLineErased",volleyballPosition:"volleyballPosition"},features:[v.TTD],decls:2,vars:0,consts:[["field",""]],template:function(re,Ee){1&re&&v._UZ(0,"canvas",null,0)},styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}canvas[_ngcontent-%COMP%]{display:block;height:100%;width:100%;touch-action:none}"]}),be})()},9710:(mn,Qe,M)=>{M.r(Qe),M.d(Qe,{FieldModule:()=>L});var v=M(9298),F=M(1062),y=M(2705),ie=M(432);let me=(()=>{class T extends ie.C{constructor(b,x,W,te,ae){super(b,x,te,ae),this.dashed=W}drawShape(){this.context.beginPath(),this.context.ellipse(this.x,this.y,T.RADIUS*this.sizeCoefficientX(),T.RADIUS*this.sizeCoefficientY(),0,0,2*Math.PI),this.context.fillStyle=ie.C.ACTOR_COLOR,this.context.fill(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.stroke()}drawPosition(){const b=this.currentPosition();!b||(this.context.font="30px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(b.value.toString(),this.x,this.y+12))}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+T.RADIUS*this.sizeCoefficientY()*1.5+5))}isHit(b,x){return b>=this.x-T.RADIUS*this.sizeCoefficientX()&&b<=this.x+T.RADIUS*this.sizeCoefficientX()&&x>=this.y-T.RADIUS*this.sizeCoefficientY()&&x<=this.y+T.RADIUS*this.sizeCoefficientY()}copy(b){return new T(b,this.context,this.dashed,this.fieldPosition,this.rotationOffset)}}return T.RADIUS=25,T})();var ue=(()=>{return(T=ue||(ue={})).Setter="Setter",T.MiddleBlocker="Middle blocker",T.Libero="Libero",T.OutsideHitter="Outside hitter",T.OppositeHitter="Opposite hitter",T.DefensiveSpecialist="Defensive specialist",ue;var T})(),z=M(3075);class Re{constructor(O){if(O<1||O>6)throw new Error("Player position must be between 1 and 6.");this._position=O}get value(){return this._position}rotate(O){let x=this._position+(O._position-1);return x>6&&(x-=6),new Re(x)}}var Pe=M(7691);let be=(()=>{class T extends ie.C{constructor(b,x,W,te){super(b,x,W,te)}drawShape(){this.context.beginPath(),this.context.ellipse(this.x,this.y,T.RADIUS*this.sizeCoefficientX(),T.RADIUS*this.sizeCoefficientY(),0,0,Math.PI,!0),this.context.fillStyle=ie.C.ACTOR_COLOR,this.context.fill(),this.context.setLineDash([]),this.context.closePath(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}drawPosition(){const b=this.currentPosition();!b||(this.context.font="30px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(b.value.toString(),this.x,this.y-6))}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+T.RADIUS/2*this.sizeCoefficientY()+3))}isHit(b,x){return b>=this.x-T.RADIUS*this.sizeCoefficientX()&&b<=this.x+T.RADIUS*this.sizeCoefficientX()&&x>=this.y-T.RADIUS*this.sizeCoefficientY()&&x<=this.y}copy(b){return new T(b,this.context,this.fieldPosition,this.rotationOffset)}}return T.RADIUS=30,T})(),ge=(()=>{class T extends ie.C{constructor(b,x,W,te,ae){super(b,x,te,ae),this.dashed=W}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+T.SIZE*this.sizeCoefficientY()*1.6+5))}drawPosition(){const b=this.currentPosition();!b||(this.context.font="30px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(b.value.toString(),this.x-2,this.y+20))}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.moveTo(this.x-T.SIZE*this.sizeCoefficientX(),this.y+T.SIZE*this.sizeCoefficientY()),this.context.lineTo(this.x+T.SIZE*this.sizeCoefficientX(),this.y+T.SIZE*this.sizeCoefficientY()),this.context.lineTo(this.x,this.y-T.SIZE*this.sizeCoefficientY()),this.context.closePath(),this.context.stroke(),this.context.fillStyle=ie.C.ACTOR_COLOR,this.context.fill()}isHit(b,x){return b>=this.x-T.SIZE*this.sizeCoefficientX()&&b<=this.x+T.SIZE*this.sizeCoefficientX()&&x>=this.y-T.SIZE*this.sizeCoefficientY()&&x<=this.y+T.SIZE*this.sizeCoefficientY()}copy(b){return new T(b,this.context,this.dashed,this.fieldPosition,this.rotationOffset)}}return T.SIZE=25,T})();var re=M(641);let Ee=(()=>{class T extends ie.C{constructor(b,x,W,te){super(b,x,W,te)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+T.SIZE*this.sizeCoefficientY()*1.6+5))}drawPosition(){const b=this.currentPosition();!b||(this.context.font="30px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(b.value.toString(),this.x,this.y+T.SIZE/2*this.sizeCoefficientY()-2))}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash([]),this.context.moveTo(this.x-T.SIZE*this.sizeCoefficientX(),this.y+T.SIZE*this.sizeCoefficientY()),this.context.lineTo(this.x+T.SIZE*this.sizeCoefficientX(),this.y+T.SIZE*this.sizeCoefficientY()),this.context.lineTo(this.x+T.SIZE*this.sizeCoefficientX(),this.y-T.SIZE*this.sizeCoefficientY()),this.context.lineTo(this.x-T.SIZE*this.sizeCoefficientX(),this.y-T.SIZE*this.sizeCoefficientY()),this.context.closePath(),this.context.stroke(),this.context.fillStyle=ie.C.ACTOR_COLOR,this.context.fill()}isHit(b,x){return b>=this.x-T.SIZE*this.sizeCoefficientX()&&b<=this.x+T.SIZE*this.sizeCoefficientX()&&x>=this.y-T.SIZE*this.sizeCoefficientY()&&x<=this.y+T.SIZE*this.sizeCoefficientY()}copy(b){return new T(b,this.context,this.fieldPosition,this.rotationOffset)}}return T.SIZE=25,T})();class fe{static fromActorDto(O,b,x){const W={x:b.f.x,y:b.f.y},te="NULL"===b.ro?void 0:new Re(b.ro);switch(O.player_role){case ue.Setter:return new be(O,x,W,te);case ue.MiddleBlocker:case ue.Libero:return new ge(O,x,!1,W,te);case ue.DefensiveSpecialist:return new Ee(O,x,W,te);case ue.OutsideHitter:return new me(O,x,!1,W,te);case ue.OppositeHitter:return new me(O,x,!0,W,te)}}static fromLineDto(O,b){const x=Math.max(...Object.keys(O.f).map(te=>Number(te))),W=[];for(let te=0;te<=x;++te)W.push({x:Number(O.f[te.toString()].x),y:Number(O.f[te.toString()].y)});return new re.x(b,W)}}class Se{constructor(O,b,x,W,te){this.position=O,this.player_role=b,this.player_name=x,this._UUID=W||(0,Pe.k)(),te&&(this._shape=te)}get UUID(){return this._UUID}get shape(){return this._shape}static fromDto(O,b){const x=new Se(new Re(O.p),O.pr,"NULL"===O.pn?void 0:O.pn,O.u),W=fe.fromActorDto(x,O.s,b);return x.setShape(W),x}toDto(){var O;return{pn:null!==(O=this.player_name)&&void 0!==O?O:"NULL",pr:this.player_role,p:this.position.value,u:this.UUID,s:this.shape.toDto()}}setShape(O){this._shape=O}draw(){this.shape.draw()}toString(){return this.player_name?`${this.player_name} (${this.position.value}) - ${this.player_role.toString()}`:`Unnamed actor (${this.position.value}) - ${this.player_role.toString()}`}copy(){const O=new Se(this.position,this.player_role,this.player_name,void 0,void 0);return O.setShape(this.shape.copy(O)),O}}var d=M(5e3),ye=M(8966),xe=M(7322),R=M(7531),Ue=M(4107),Ae=M(508),Ie=M(7423);let J=(()=>{class T{constructor(b,x){this.fb=b,this.dialogRef=x,this.PlayerRole=ue}onSubmit(){this.dialogRef.close(new Se(new Re(this.formGroup.value.position),this.formGroup.value.player_role,this.formGroup.value.player_name))}ngOnInit(){this.formGroup=this.fb.group({player_name:[null],position:[null,z.kI.required],player_role:[null,z.kI.required]})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-add-actor-dialog"]],decls:56,vars:50,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","player_name"],["appearance","fill"],["formControlName","position"],[3,"value"],["formControlName","player_role"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"mat-form-field",4)(11,"mat-label"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"mat-select",5)(15,"mat-option",6),d._uU(16,"1"),d.qZA(),d.TgZ(17,"mat-option",6),d._uU(18,"2"),d.qZA(),d.TgZ(19,"mat-option",6),d._uU(20,"3"),d.qZA(),d.TgZ(21,"mat-option",6),d._uU(22,"4"),d.qZA(),d.TgZ(23,"mat-option",6),d._uU(24,"5"),d.qZA(),d.TgZ(25,"mat-option",6),d._uU(26,"6"),d.qZA()()(),d.TgZ(27,"mat-form-field",4)(28,"mat-label"),d._uU(29),d.ALo(30,"translate"),d.qZA(),d.TgZ(31,"mat-select",7)(32,"mat-option",6),d._uU(33),d.ALo(34,"translate"),d.qZA(),d.TgZ(35,"mat-option",6),d._uU(36),d.ALo(37,"translate"),d.qZA(),d.TgZ(38,"mat-option",6),d._uU(39),d.ALo(40,"translate"),d.qZA(),d.TgZ(41,"mat-option",6),d._uU(42),d.ALo(43,"translate"),d.qZA(),d.TgZ(44,"mat-option",6),d._uU(45),d.ALo(46,"translate"),d.qZA(),d.TgZ(47,"mat-option",6),d._uU(48),d.ALo(49,"translate"),d.qZA()()(),d.TgZ(50,"button",8),d._uU(51),d.ALo(52,"translate"),d.qZA(),d.TgZ(53,"button",9),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(54),d.ALo(55,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,26,"add_actor_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,28,"add_actor_dialog.placeholder.player_name")),d.xp6(5),d.Oqu(d.lcZ(13,30,"add_actor_dialog.placeholder.position")),d.xp6(3),d.Q6J("value",1),d.xp6(2),d.Q6J("value",2),d.xp6(2),d.Q6J("value",3),d.xp6(2),d.Q6J("value",4),d.xp6(2),d.Q6J("value",5),d.xp6(2),d.Q6J("value",6),d.xp6(4),d.Oqu(d.lcZ(30,32,"add_actor_dialog.placeholder.player_role")),d.xp6(3),d.Q6J("value",x.PlayerRole.Setter),d.xp6(1),d.Oqu(d.lcZ(34,34,"add_actor_dialog.player_roles.setter")),d.xp6(2),d.Q6J("value",x.PlayerRole.MiddleBlocker),d.xp6(1),d.Oqu(d.lcZ(37,36,"add_actor_dialog.player_roles.middle_blocker")),d.xp6(2),d.Q6J("value",x.PlayerRole.Libero),d.xp6(1),d.Oqu(d.lcZ(40,38,"add_actor_dialog.player_roles.libero")),d.xp6(2),d.Q6J("value",x.PlayerRole.DefensiveSpecialist),d.xp6(1),d.Oqu(d.lcZ(43,40,"add_actor_dialog.player_roles.defensive_specialist")),d.xp6(2),d.Q6J("value",x.PlayerRole.OutsideHitter),d.xp6(1),d.Oqu(d.lcZ(46,42,"add_actor_dialog.player_roles.outside_hitter")),d.xp6(2),d.Q6J("value",x.PlayerRole.OppositeHitter),d.xp6(1),d.Oqu(d.lcZ(49,44,"add_actor_dialog.player_roles.opposite_hitter")),d.xp6(2),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(52,46,"add_actor_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(55,48,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,R.Nt,z.Fj,z.JJ,z.u,Ue.gD,Ae.ey,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();var Ve=M(9808);function X(T,O){if(1&T&&(d.TgZ(0,"mat-option",7),d._uU(1),d.qZA()),2&T){const b=O.$implicit;d.Q6J("value",b.UUID),d.xp6(1),d.Oqu(b.toString())}}let E=(()=>{class T{constructor(b,x,W){this.fb=b,this.dialogRef=x,this.data=W}onSubmit(){this.dialogRef.close(this.formGroup.value.actor)}ngOnInit(){this.formGroup=this.fb.group({actor:[null,z.kI.required]})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so),d.Y36(ye.WI))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-delete-actor-dialog"]],decls:17,vars:15,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","actor"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"],[3,"value"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"mat-select",3),d.YNc(10,X,2,2,"mat-option",4),d.qZA()(),d.TgZ(11,"button",5),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"button",6),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(15),d.ALo(16,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,7,"delete_actor_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,9,"delete_actor_dialog.placeholder.actor")),d.xp6(3),d.Q6J("ngForOf",x.data.actors),d.xp6(1),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(13,11,"delete_actor_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(16,13,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,Ue.gD,z.JJ,z.u,Ve.sg,Ae.ey,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();class he{constructor(O,b,x,W,te){this.rotation=O,this.name=b,this._UUID=null!=W?W:(0,Pe.k)(),this._lines=null!=te?te:[],this._actors=null!=x?x:[]}get UUID(){return this._UUID}get lines(){return this._lines}get actors(){return this._actors}static fromDto(O,b){const x="NULL"===O.r?void 0:new Re(O.r),W=O.l.map(ae=>fe.fromLineDto(ae,b)),te=O.a.map(ae=>Se.fromDto(ae,b));return new he(x,"NULL"===O.n?void 0:O.n,te,O.u,W)}draw(){this._actors.forEach(O=>O.draw())}toDto(){var O,b,x;return{n:null!==(O=this.name)&&void 0!==O?O:"NULL",r:null!==(x=null===(b=this.rotation)||void 0===b?void 0:b.value)&&void 0!==x?x:"NULL",u:this.UUID,l:this._lines.map(W=>W.toDto()),a:this.actors.map(W=>W.toDto())}}toString(){return this.name?this.rotation?`${this.name} (${this.rotation.value})`:`${this.name}`:this.rotation?`Unknown rotation (${this.rotation.value})`:"Unknown rotation"}addLine(O){this._lines.push(O)}removeLine(O){const b=this._lines.findIndex(x=>x===O);b<0||this._lines.splice(b,1)}addActor(O){this._actors.push(O)}removeActor(O){const b=this._actors.findIndex(x=>x.UUID===O);b<0||this._actors.splice(b,1)}}function ee(T,O){if(1&T&&(d.TgZ(0,"mat-option",7),d._uU(1),d.qZA()),2&T){const b=O.$implicit;d.Q6J("value",b.UUID),d.xp6(1),d.Oqu(b.toString())}}let Rt=(()=>{class T{constructor(b,x,W){this.fb=b,this.dialogRef=x,this.data=W}onSubmit(){this.dialogRef.close(this.formGroup.value.rotation)}ngOnInit(){this.formGroup=this.fb.group({rotation:[null,z.kI.required]})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so),d.Y36(ye.WI))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-delete-rotation-dialog"]],decls:17,vars:15,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"],[3,"value"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"mat-select",3),d.YNc(10,ee,2,2,"mat-option",4),d.qZA()(),d.TgZ(11,"button",5),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"button",6),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(15),d.ALo(16,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,7,"delete_rotation_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,9,"delete_rotation_dialog.placeholder.rotation")),d.xp6(3),d.Q6J("ngForOf",x.data.rotations),d.xp6(1),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(13,11,"delete_rotation_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(16,13,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,Ue.gD,z.JJ,z.u,Ve.sg,Ae.ey,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();var We=M(7446);function Nt(T,O){if(1&T&&(d.TgZ(0,"mat-option",6),d._uU(1),d.qZA()),2&T){const b=O.$implicit;d.Q6J("value",b.UUID),d.xp6(1),d.Oqu(b.toString())}}let zn=(()=>{class T{constructor(b,x,W){this.fb=b,this.dialogRef=x,this.data=W}onSubmit(){this.dialogRef.close({rotation:new he(this.formGroup.value.current_rotation?new Re(this.formGroup.value.current_rotation):void 0,this.formGroup.value.rotation_name),add_before:this.formGroup.value.add_before,copy_actors:this.formGroup.value.copy_actors})}ngOnInit(){this.formGroup=this.fb.group({rotation_name:null,current_rotation:[1],add_before:null,copy_actors:[!0,z.kI.required]})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so),d.Y36(ye.WI))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-add-rotation-dialog"]],decls:45,vars:34,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","rotation_name"],["appearance","fill"],["formControlName","current_rotation"],[3,"value"],["formControlName","add_before"],[3,"value",4,"ngFor","ngForOf"],["formControlName","copy_actors"],["mat-raised-button","","color","primary","type","submit",2,"margin-top","1rem",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"mat-form-field",4)(11,"mat-label"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"mat-select",5)(15,"mat-option",6),d._uU(16),d.ALo(17,"translate"),d.qZA(),d.TgZ(18,"mat-option",6),d._uU(19,"1"),d.qZA(),d.TgZ(20,"mat-option",6),d._uU(21,"2"),d.qZA(),d.TgZ(22,"mat-option",6),d._uU(23,"3"),d.qZA(),d.TgZ(24,"mat-option",6),d._uU(25,"4"),d.qZA(),d.TgZ(26,"mat-option",6),d._uU(27,"5"),d.qZA(),d.TgZ(28,"mat-option",6),d._uU(29,"6"),d.qZA()()(),d.TgZ(30,"mat-form-field",4)(31,"mat-label"),d._uU(32),d.ALo(33,"translate"),d.qZA(),d.TgZ(34,"mat-select",7),d.YNc(35,Nt,2,2,"mat-option",8),d.qZA()(),d.TgZ(36,"mat-checkbox",9),d._uU(37),d.ALo(38,"translate"),d.qZA(),d.TgZ(39,"button",10),d._uU(40),d.ALo(41,"translate"),d.qZA(),d.TgZ(42,"button",11),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(43),d.ALo(44,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,18,"add_rotation_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,20,"add_rotation_dialog.placeholder.rotation_name")),d.xp6(5),d.Oqu(d.lcZ(13,22,"add_rotation_dialog.placeholder.current_rotation")),d.xp6(3),d.Q6J("value",null),d.xp6(1),d.Oqu(d.lcZ(17,24,"add_rotation_dialog.without_positions")),d.xp6(2),d.Q6J("value",1),d.xp6(2),d.Q6J("value",2),d.xp6(2),d.Q6J("value",3),d.xp6(2),d.Q6J("value",4),d.xp6(2),d.Q6J("value",5),d.xp6(2),d.Q6J("value",6),d.xp6(4),d.Oqu(d.lcZ(33,26,"add_rotation_dialog.placeholder.add_before")),d.xp6(3),d.Q6J("ngForOf",x.data.rotations),d.xp6(2),d.hij(" ",d.lcZ(38,28,"add_rotation_dialog.placeholder.copy_actors")," "),d.xp6(2),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(41,30,"add_rotation_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(44,32,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,R.Nt,z.Fj,z.JJ,z.u,Ue.gD,Ae.ey,Ve.sg,We.oG,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();class ft{static store(O,b){const x=JSON.stringify(b);window.localStorage.setItem(O,x)}static retrieve(O){const b=window.localStorage.getItem(O);if(b)return JSON.parse(b)}static remove(O){window.localStorage.removeItem(O)}}var Zt=M(8996),xn=M(7102);let jn=(()=>{class T{constructor(b,x,W,te){this.fb=b,this.dialogRef=x,this.data=W,this.store=te}onSubmit(){this.dialogRef.close(),window.navigator.clipboard.writeText(this.formGroup.value.copy_link)}ngOnInit(){this.formGroup=this.fb.group({copy_link:[{value:null,disabled:!1},z.kI.required]});const b=(0,Pe.k)(30),x=this.store.collection("rotations");(0,Zt.D)(x.doc(b).set({version:this.data.version,rotations:this.data.rotations.map(W=>W.toDto()),current_rotation:this.data.current_rotation})).subscribe(()=>{this.formGroup.patchValue({copy_link:`${window.location.href}?store=${b}`})})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so),d.Y36(ye.WI),d.Y36(xn.ST))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-export-actor-dialog"]],decls:16,vars:14,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","copy_link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"button",4),d._uU(11),d.ALo(12,"translate"),d.qZA(),d.TgZ(13,"button",5),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(14),d.ALo(15,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,6,"export_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,8,"export_dialog.placeholder.copy_link")),d.xp6(3),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(12,10,"export_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(15,12,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,R.Nt,z.Fj,z.JJ,z.u,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})(),$e=(()=>{class T{constructor(b,x){this.fb=b,this.dialogRef=x}onSubmit(){const b=this.formGroup.value.link.split("?store=");b.length<2||this.dialogRef.close(b[b.length-1])}ngOnInit(){this.formGroup=this.fb.group({link:[null,z.kI.required]})}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.so))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-import-actor-dialog"]],decls:16,vars:14,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return x.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"button",4),d._uU(11),d.ALo(12,"translate"),d.qZA(),d.TgZ(13,"button",5),d.NdJ("click",function(){return x.dialogRef.close()}),d._uU(14),d.ALo(15,"translate"),d.qZA()()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,6,"import_dialog.title")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,8,"import_dialog.placeholder.link")),d.xp6(3),d.Q6J("disabled",x.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(12,10,"import_dialog.submit")," "),d.xp6(3),d.hij(" ",d.lcZ(15,12,"field.close")," "))},directives:[ye.uh,ye.xY,z.JL,z.sg,z._Y,xe.KE,xe.hX,R.Nt,z.Fj,z.JJ,z.u,Ie.lW],pipes:[F.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();var Je=M(5216);class Oe{static isMobileDevice(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini|Mobile/i.test(navigator.userAgent)||window.matchMedia("(max-width: 600px)").matches}static isIosDevice(){return/iPhone|iPad|iPod/i.test(navigator.userAgent)&&"ontouchstart"in window}}let Tt=(()=>{class T{constructor(b){this.dialogRef=b}}return T.\u0275fac=function(b){return new(b||T)(d.Y36(ye.so))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-reset-all-dialog"]],decls:10,vars:9,consts:[["mat-dialog-title",""],["mat-raised-button","","color","primary","type","button",3,"click"],["mat-raised-button","","color","primary","type","button",2,"margin-top","1rem",3,"click"]],template:function(b,x){1&b&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content")(4,"button",1),d.NdJ("click",function(){return x.dialogRef.close(!1)}),d._uU(5),d.ALo(6,"translate"),d.qZA(),d.TgZ(7,"button",2),d.NdJ("click",function(){return x.dialogRef.close(!0)}),d._uU(8),d.ALo(9,"translate"),d.qZA()()),2&b&&(d.xp6(1),d.Oqu(d.lcZ(2,3,"reset_all.title")),d.xp6(4),d.hij(" ",d.lcZ(6,5,"field.abort")," "),d.xp6(3),d.hij(" ",d.lcZ(9,7,"reset_all.submit")," "))},directives:[ye.uh,ye.xY,Ie.lW],pipes:[F.X$],styles:["mat-dialog-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),T})();var Wt=M(2638),Jt=M(5245),G=M(5619);const $=["court"];function C(T,O){if(1&T&&(d.TgZ(0,"mat-option",13),d._uU(1),d.qZA()),2&T){const b=O.$implicit;d.Q6J("value",b.UUID),d.xp6(1),d.Oqu(b.toString())}}const q=[{path:"",component:(()=>{class T{constructor(b,x,W,te){this.formBuilder=b,this.matDialog=x,this.store=W,this.router=te,this.rotations=[],this.currentRotationIndex=0,this.CourtMode=Je.T,this.courtMode=Je.T.MOVE_ACTOR,this.ready=!1,this.__actorShapes=[],this.__lineShapes=[],this.formGroup=this.formBuilder.group({current_rotation:[null,z.kI.required]})}get rotation(){return this.rotations[this.currentRotationIndex]}get actorShapes(){var b,x;return null!==(x=null===(b=this.rotation)||void 0===b?void 0:b.actors.map(W=>W.shape))&&void 0!==x?x:[]}get lineShapes(){var b,x;return null!==(x=null===(b=this.rotation)||void 0===b?void 0:b.lines)&&void 0!==x?x:[]}onCourtReady(b){this.context=b;const x=new URLSearchParams(window.location.search);if(x&&x.get("store")&&30===x.get("store").length)this.importLink(x.get("store")),this.router.navigate(["/field"]);else{const W=ft.retrieve(T.LOCAL_STORAGE_KEY_ROTATIONS),te=ft.retrieve(T.LOCAL_STORAGE_KEY_CURRENT_ROTATION);W&&te?(this.rotations=W.map(ae=>he.fromDto(ae,this.context)),this.currentRotationIndex=this.rotations.findIndex(ae=>ae.UUID===te)):this.rotations=[new he(new Re(1),"Default rotation")],this.setShapes(),this.formGroup.patchValue({current_rotation:this.rotation.UUID})}this.formGroup.valueChanges.subscribe(W=>this.onRotationChanged(W.current_rotation)),this.ready=!0}onRotationChanged(b){this.currentRotationIndex=this.rotations.findIndex(x=>x.UUID===b),this.setShapes(),this.court.render()}onAddActorClicked(){this.matDialog.open(J,{autoFocus:!1,panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>{if(x){switch(x.player_role){case ue.Setter:this.addShape(x,new be(x,this.context));break;case ue.MiddleBlocker:this.addShape(x,new ge(x,this.context,!1));break;case ue.Libero:this.addShape(x,new ge(x,this.context,!0));break;case ue.DefensiveSpecialist:this.addShape(x,new Ee(x,this.context));break;case ue.OutsideHitter:this.addShape(x,new me(x,this.context,!1));break;case ue.OppositeHitter:this.addShape(x,new me(x,this.context,!0))}this.setShapes(),this.court.render()}})}addShape(b,x){x.setRotationProperties(this.rotation.rotation),b.setShape(x),this.rotation.addActor(b)}onDeleteActorClicked(){this.matDialog.open(E,{data:{actors:this.rotation.actors},autoFocus:!1,panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>{!x||(this.rotation.removeActor(x),this.setShapes(),this.court.render())})}onResetAllClicked(){this.matDialog.open(Tt,{autoFocus:!1,panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>{!x||(this.rotations=[new he(new Re(1),"Default rotation")],this.currentRotationIndex=0,this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.setShapes())})}onDeleteRotationClicked(){this.matDialog.open(Rt,{data:{rotations:this.rotations},autoFocus:!1,panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>{if(!x)return;const W=this.rotation.UUID,te=this.rotations.findIndex(ae=>ae.UUID===x);this.rotations.splice(te,1),W===x?(0===this.rotations.length&&this.rotations.push(new he(new Re(1),"Default rotation")),this.currentRotationIndex=0):this.currentRotationIndex=this.rotations.findIndex(ae=>ae.UUID===W),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.setShapes(),this.court.render()})}onAddRotationClicked(){this.matDialog.open(zn,{autoFocus:!1,data:{rotations:this.rotations},panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>{if(!x)return;const W=this.rotation.actors;if(x.add_before){const te=this.rotations.findIndex(ae=>ae.UUID===x.add_before);this.rotations.splice(te,0,x.rotation),this.currentRotationIndex=te}else this.rotations.push(x.rotation),this.currentRotationIndex=this.rotations.length-1;x.copy_actors&&W.forEach(te=>{const ae=te.copy();ae.shape.setRotationProperties(this.rotation.rotation),this.rotation.addActor(ae)}),this.formGroup.patchValue({current_rotation:x.rotation.UUID}),this.setShapes(),this.court.render()})}onExportClicked(){this.matDialog.open(jn,{autoFocus:!1,data:{version:T.VERSION,rotations:this.rotations,current_rotation:this.rotation.UUID},panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0})}onImportClicked(){this.matDialog.open($e,{autoFocus:!1,panelClass:Oe.isMobileDevice()?"full-screen-dialog":void 0}).afterClosed().subscribe(x=>this.importLink(x))}importLink(b){b&&30===b.length&&this.store.collection("rotations").doc(b).get().subscribe(W=>{const te=W.data();this.rotations=te.rotations.map(Mt=>he.fromDto(Mt,this.context));const ae=te.current_rotation;this.currentRotationIndex=this.rotations.findIndex(Mt=>Mt.UUID===ae),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.setShapes(),this.court.render()})}setMoveActorMode(){this.courtMode=Je.T.MOVE_ACTOR}onToggleDrawMode(){this.courtMode=this.courtMode===Je.T.DRAW_LINE?Je.T.MOVE_ACTOR:Je.T.DRAW_LINE}onToggleEraseMode(){this.courtMode=this.courtMode===Je.T.ERASE_LINE?Je.T.MOVE_ACTOR:Je.T.ERASE_LINE}onCourtRender(){!this.ready||(ft.store(T.LOCAL_STORAGE_KEY_ROTATIONS,this.rotations.map(b=>b.toDto())),ft.store(T.LOCAL_STORAGE_KEY_CURRENT_ROTATION,this.rotation.UUID),ft.store(T.LOCAL_STORAGE_KEY_VERSION,T.VERSION))}onLineAdded(b){this.rotation.addLine(b),this.setShapes()}onLineErased(b){this.rotation.removeLine(b),this.setShapes()}setShapes(){this.__actorShapes=this.actorShapes,this.__lineShapes=this.lineShapes}}return T.VERSION=2,T.LOCAL_STORAGE_KEY_ROTATIONS="rotations_storage_v2",T.LOCAL_STORAGE_KEY_CURRENT_ROTATION="current_rotation_uuid_v2",T.LOCAL_STORAGE_KEY_VERSION="version",T.\u0275fac=function(b){return new(b||T)(d.Y36(z.qu),d.Y36(ye.uw),d.Y36(xn.ST),d.Y36(y.F0))},T.\u0275cmp=d.Xpm({type:T,selectors:[["vpms-field"]],viewQuery:function(b,x){if(1&b&&d.Gf($,5),2&b){let W;d.iGM(W=d.CRH())&&(x.court=W.first)}},decls:83,vars:58,consts:[["mode","over"],["sidenav",""],[3,"formGroup"],["formControlName","current_rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],[2,"margin-top","auto"],["mat-stroked-button","","routerLink","/statistics"],["href","https://github.com/Geigerkind/vb_positions","target","_blank"],["mat-stroked-button",""],["mat-flat-button","",1,"toggle_sidenav",3,"click"],[3,"actors","lines","courtMode","onReady","onRender","onLineAdded","onLineErased"],["court",""],[3,"value"]],template:function(b,x){if(1&b){const W=d.EpF();d.TgZ(0,"mat-sidenav-container")(1,"mat-sidenav",0,1)(3,"h1"),d._uU(4),d.ALo(5,"translate"),d.qZA(),d.TgZ(6,"mat-form-field",2)(7,"mat-select",3),d.YNc(8,C,2,2,"mat-option",4),d.qZA()(),d.TgZ(9,"button",5),d.NdJ("click",function(){return x.onAddRotationClicked()}),d.TgZ(10,"mat-icon"),d._uU(11,"add"),d.qZA(),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"button",5),d.NdJ("click",function(){return x.onDeleteRotationClicked()}),d.TgZ(15,"mat-icon"),d._uU(16,"delete"),d.qZA(),d._uU(17),d.ALo(18,"translate"),d.qZA(),d.TgZ(19,"button",5),d.NdJ("click",function(){return x.onAddActorClicked()}),d.TgZ(20,"mat-icon"),d._uU(21,"add"),d.qZA(),d._uU(22),d.ALo(23,"translate"),d.qZA(),d.TgZ(24,"button",5),d.NdJ("click",function(){return x.onDeleteActorClicked()}),d.TgZ(25,"mat-icon"),d._uU(26,"delete"),d.qZA(),d._uU(27),d.ALo(28,"translate"),d.qZA(),d.TgZ(29,"button",5),d.NdJ("click",function(){return x.onResetAllClicked()}),d.TgZ(30,"mat-icon"),d._uU(31,"delete"),d.qZA(),d._uU(32),d.ALo(33,"translate"),d.qZA(),d.TgZ(34,"h1"),d._uU(35),d.ALo(36,"translate"),d.qZA(),d.TgZ(37,"button",5),d.NdJ("click",function(){return x.setMoveActorMode()}),d.TgZ(38,"mat-icon"),d._uU(39,"person"),d.qZA(),d._uU(40),d.ALo(41,"translate"),d.qZA(),d.TgZ(42,"button",5),d.NdJ("click",function(){return x.onToggleDrawMode()}),d.TgZ(43,"mat-icon"),d._uU(44,"mode_edit_outline"),d.qZA(),d._uU(45),d.ALo(46,"translate"),d.qZA(),d.TgZ(47,"button",5),d.NdJ("click",function(){return x.onToggleEraseMode()}),d.TgZ(48,"mat-icon"),d._uU(49,"auto_fix_normal"),d.qZA(),d._uU(50),d.ALo(51,"translate"),d.qZA(),d.TgZ(52,"h1"),d._uU(53),d.ALo(54,"translate"),d.qZA(),d.TgZ(55,"button",5),d.NdJ("click",function(){return x.onExportClicked()}),d.TgZ(56,"mat-icon"),d._uU(57,"share"),d.qZA(),d._uU(58),d.ALo(59,"translate"),d.qZA(),d.TgZ(60,"button",5),d.NdJ("click",function(){return x.onImportClicked()}),d.TgZ(61,"mat-icon"),d._uU(62,"import_export"),d.qZA(),d._uU(63),d.ALo(64,"translate"),d.qZA(),d.TgZ(65,"div",6)(66,"button",7)(67,"mat-icon"),d._uU(68,"bar_chart"),d.qZA(),d._uU(69),d.ALo(70,"translate"),d.qZA(),d.TgZ(71,"a",8)(72,"button",9)(73,"mat-icon"),d._uU(74,"code"),d.qZA(),d._uU(75),d.ALo(76,"translate"),d.qZA()()()(),d.TgZ(77,"mat-sidenav-content")(78,"button",10),d.NdJ("click",function(){return d.CHM(W),d.MAs(2).toggle()}),d.TgZ(79,"mat-icon"),d._uU(80,"arrow_right"),d.qZA()(),d.TgZ(81,"vpms-court",11,12),d.NdJ("onReady",function(ae){return x.onCourtReady(ae)})("onRender",function(){return x.onCourtRender()})("onLineAdded",function(ae){return x.onLineAdded(ae)})("onLineErased",function(ae){return x.onLineErased(ae)}),d.qZA()()()}if(2&b){const W=d.MAs(2);d.xp6(4),d.Oqu(d.lcZ(5,28,"field.subtitle.rotation")),d.xp6(2),d.Q6J("formGroup",x.formGroup),d.xp6(2),d.Q6J("ngForOf",x.rotations),d.xp6(4),d.hij(" ",d.lcZ(13,30,"field.add_rotation")," "),d.xp6(5),d.hij(" ",d.lcZ(18,32,"field.delete_rotation")," "),d.xp6(5),d.hij(" ",d.lcZ(23,34,"field.add_actor")," "),d.xp6(5),d.hij(" ",d.lcZ(28,36,"field.delete_actor")," "),d.xp6(5),d.hij(" ",d.lcZ(33,38,"field.reset_all")," "),d.xp6(3),d.Oqu(d.lcZ(36,40,"field.subtitle.mode")),d.xp6(2),d.ekj("toggled",x.courtMode===x.CourtMode.MOVE_ACTOR),d.xp6(3),d.hij(" ",d.lcZ(41,42,"field.actor_mode")," "),d.xp6(2),d.ekj("toggled",x.courtMode===x.CourtMode.DRAW_LINE),d.xp6(3),d.hij(" ",d.lcZ(46,44,"field.draw_mode")," "),d.xp6(2),d.ekj("toggled",x.courtMode===x.CourtMode.ERASE_LINE),d.xp6(3),d.hij(" ",d.lcZ(51,46,"field.erase_mode")," "),d.xp6(3),d.Oqu(d.lcZ(54,48,"field.subtitle.share")),d.xp6(5),d.hij(" ",d.lcZ(59,50,"field.export")," "),d.xp6(5),d.hij(" ",d.lcZ(64,52,"field.import")," "),d.xp6(6),d.hij(" ",d.lcZ(70,54,"home.statistics")," "),d.xp6(6),d.hij(" ",d.lcZ(76,56,"field.source_code")," "),d.xp6(3),d.ekj("is_opened",W.opened),d.xp6(3),d.Q6J("actors",x.__actorShapes)("lines",x.__lineShapes)("courtMode",x.courtMode)}},directives:[Wt.TM,Wt.JX,xe.KE,z.JL,z.sg,Ue.gD,z.JJ,z.u,Ve.sg,Ae.ey,Ie.lW,Jt.Hw,y.rH,Wt.Rh,G.v],pipes:[F.X$],styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}.toggled[_ngcontent-%COMP%]{color:#0a64ae}mat-sidenav-container[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:15rem;padding:1rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:3rem;text-align:left;margin-bottom:.5rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#0a64ae}mat-sidenav[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.toggle_sidenav[_ngcontent-%COMP%]{position:absolute;top:3rem;left:-1rem;z-index:20;transform:rotate(90deg)}.toggle_sidenav.is_opened[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(90deg)}.toggle_sidenav[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-90deg)}"]}),T})()}];let w=(()=>{class T{}return T.\u0275fac=function(b){return new(b||T)},T.\u0275mod=d.oAB({type:T}),T.\u0275inj=d.cJS({imports:[[y.Bz.forChild(q)],y.Bz]}),T})(),L=(()=>{class T{}return T.\u0275fac=function(b){return new(b||T)},T.\u0275mod=d.oAB({type:T}),T.\u0275inj=d.cJS({imports:[[w,v.m,F.aw,ye.Is,z.UX,Ve.ez,We.p9,Wt.SJ]]}),T})()},432:(mn,Qe,M)=>{M.d(Qe,{C:()=>F});var v=M(7517);let F=(()=>{class y extends v.b{constructor(me,ue,z,Re){super(ue),this.actor=me,z?this.fieldPosition=z:this.setPosition(this.fromDiscreteX(4612.5),this.fromDiscreteY(5500)),this.rotationOffset=Re}toDto(){return{f:{x:Number(this.fieldPosition.x.toFixed(0)).valueOf(),y:Number(this.fieldPosition.y.toFixed(0)).valueOf()},ro:this.rotationOffset?this.rotationOffset.value:"NULL"}}draw(){super.draw(),this.drawPosition(),this.drawActorName()}currentPosition(){if(this.rotationOffset)return this.actor.position.rotate(this.rotationOffset)}setPosition(me,ue){this.fieldPosition={x:this.toDiscreteX(me),y:this.toDiscreteY(ue)}}get x(){return this.fromDiscreteX(this.getFieldPosition().x)}get y(){return this.fromDiscreteY(this.getFieldPosition().y)}getFieldPosition(){return this.fieldPosition}setRotationProperties(me){this.rotationOffset=me}sizeCoefficientX(){return this.context.canvas.width/9/y.BASE_SIZE_RESOLUTION_X_1M_IN_PIXEL}sizeCoefficientY(){return this.context.canvas.height/10/y.BASE_SIZE_RESOLUTION_Y_1M_IN_PIXEL}}return y.BASE_SIZE_RESOLUTION_X_1M_IN_PIXEL=40,y.BASE_SIZE_RESOLUTION_Y_1M_IN_PIXEL=76,y.ACTOR_COLOR="#34abcd",y})()},641:(mn,Qe,M)=>{M.d(Qe,{x:()=>F});var v=M(7517);class F extends v.b{constructor(ie,me){super(ie),this.positions=null!=me?me:[]}addPosition(ie,me){this.positions.push({x:this.toDiscreteX(ie),y:this.toDiscreteY(me)})}drawShape(){if(!(this.positions.length<=1)){this.context.beginPath(),this.context.setLineDash([]),this.context.moveTo(this.fromDiscreteX(this.positions[0].x),this.fromDiscreteY(this.positions[0].y));for(let ie=1;ie<this.positions.length;++ie)this.context.lineTo(this.fromDiscreteX(this.positions[ie].x),this.fromDiscreteY(this.positions[ie].y));this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}}isHit(ie,me){const ue=this.toDiscreteX(ie),z=this.toDiscreteY(me);let Pe=this.positions[0];for(let be=1;be<this.positions.length;++be){const ge=this.positions[be];if(Pe.x<ge.x){const re=Pe.x-2<=ue&&ge.x+2>=ue;if(Pe.y<ge.y){if(re&&Pe.y-2<=z&&ge.y+2>=z)return!0}else if(re&&Pe.y+2>=z&&ge.y-2<=z)return!0}else{const re=Pe.x+2>=ue&&ge.x-2<=ue;if(Pe.y<ge.y){if(re&&Pe.y-2<=z&&ge.y+2>=z)return!0}else if(re&&Pe.y+2>=z&&ge.y-2<=z)return!0}Pe=ge}return!1}toDto(){return{f:Object.fromEntries(this.positions.reduce((ie,me)=>(ie.set(ie.size,me),ie),new Map))}}}},7517:(mn,Qe,M)=>{M.d(Qe,{b:()=>v});let v=(()=>{class F{constructor(ie){this.context=ie}draw(){this.drawShape()}fromDiscreteX(ie){return ie*(this.context.canvas.width/F.FIELD_RESOLUTION_X)}fromDiscreteY(ie){return ie*(this.context.canvas.height/F.FIELD_RESOLUTION_Y)}toDiscreteX(ie){return Math.max(0,Math.min(Math.ceil(ie*(F.FIELD_RESOLUTION_X/this.context.canvas.width)),F.FIELD_RESOLUTION_X))}toDiscreteY(ie){return Math.max(0,Math.min(Math.ceil(ie*(F.FIELD_RESOLUTION_Y/this.context.canvas.height)),F.FIELD_RESOLUTION_Y))}}return F.FIELD_RESOLUTION_Y=10225,F.FIELD_RESOLUTION_X=9450,F})()},5216:(mn,Qe,M)=>{M.d(Qe,{T:()=>v});var v=(()=>{return(F=v||(v={}))[F.MOVE_ACTOR=0]="MOVE_ACTOR",F[F.DRAW_LINE=1]="DRAW_LINE",F[F.ERASE_LINE=2]="ERASE_LINE",v;var F})()},7691:(mn,Qe,M)=>{function v(F=5){let y="";for(;y.length<F;)y+=Math.random().toString(36).substring(2,7);return y.substring(0,F)}M.d(Qe,{k:()=>v})},7446:(mn,Qe,M)=>{M.d(Qe,{oG:()=>xe,p9:()=>Ie});var v=M(3191),F=M(5e3),y=M(3075),ie=M(508),me=M(6360),ue=M(8255),z=M(7144);const Re=["input"],Pe=function(J){return{enterDuration:J}},be=["*"],ge=new F.OlP("mat-checkbox-default-options",{providedIn:"root",factory:re});function re(){return{color:"accent",clickAction:"check-indeterminate"}}let Ee=0;const fe=re(),Se={provide:y.JU,useExisting:(0,F.Gpc)(()=>xe),multi:!0};class d{}const ye=(0,ie.sb)((0,ie.pj)((0,ie.Kr)((0,ie.Id)(class{constructor(J){this._elementRef=J}}))));let xe=(()=>{class J extends ye{constructor(X,E,he,ee,Rt,We,Nt){super(X),this._changeDetectorRef=E,this._focusMonitor=he,this._ngZone=ee,this._animationMode=We,this._options=Nt,this.ariaLabel="",this.ariaLabelledby=null,this._uniqueId="mat-checkbox-"+ ++Ee,this.id=this._uniqueId,this.labelPosition="after",this.name=null,this.change=new F.vpe,this.indeterminateChange=new F.vpe,this._onTouched=()=>{},this._currentAnimationClass="",this._currentCheckState=0,this._controlValueAccessorChangeFn=()=>{},this._checked=!1,this._disabled=!1,this._indeterminate=!1,this._options=this._options||fe,this.color=this.defaultColor=this._options.color||fe.color,this.tabIndex=parseInt(Rt)||0}get inputId(){return`${this.id||this._uniqueId}-input`}get required(){return this._required}set required(X){this._required=(0,v.Ig)(X)}ngAfterViewInit(){this._focusMonitor.monitor(this._elementRef,!0).subscribe(X=>{X||Promise.resolve().then(()=>{this._onTouched(),this._changeDetectorRef.markForCheck()})}),this._syncIndeterminate(this._indeterminate)}ngAfterViewChecked(){}ngOnDestroy(){this._focusMonitor.stopMonitoring(this._elementRef)}get checked(){return this._checked}set checked(X){const E=(0,v.Ig)(X);E!=this.checked&&(this._checked=E,this._changeDetectorRef.markForCheck())}get disabled(){return this._disabled}set disabled(X){const E=(0,v.Ig)(X);E!==this.disabled&&(this._disabled=E,this._changeDetectorRef.markForCheck())}get indeterminate(){return this._indeterminate}set indeterminate(X){const E=X!=this._indeterminate;this._indeterminate=(0,v.Ig)(X),E&&(this._transitionCheckState(this._indeterminate?3:this.checked?1:2),this.indeterminateChange.emit(this._indeterminate)),this._syncIndeterminate(this._indeterminate)}_isRippleDisabled(){return this.disableRipple||this.disabled}_onLabelTextChange(){this._changeDetectorRef.detectChanges()}writeValue(X){this.checked=!!X}registerOnChange(X){this._controlValueAccessorChangeFn=X}registerOnTouched(X){this._onTouched=X}setDisabledState(X){this.disabled=X}_getAriaChecked(){return this.checked?"true":this.indeterminate?"mixed":"false"}_transitionCheckState(X){let E=this._currentCheckState,he=this._elementRef.nativeElement;if(E!==X&&(this._currentAnimationClass.length>0&&he.classList.remove(this._currentAnimationClass),this._currentAnimationClass=this._getAnimationClassForCheckStateTransition(E,X),this._currentCheckState=X,this._currentAnimationClass.length>0)){he.classList.add(this._currentAnimationClass);const ee=this._currentAnimationClass;this._ngZone.runOutsideAngular(()=>{setTimeout(()=>{he.classList.remove(ee)},1e3)})}}_emitChangeEvent(){const X=new d;X.source=this,X.checked=this.checked,this._controlValueAccessorChangeFn(this.checked),this.change.emit(X),this._inputElement&&(this._inputElement.nativeElement.checked=this.checked)}toggle(){this.checked=!this.checked,this._controlValueAccessorChangeFn(this.checked)}_onInputClick(X){var E;const he=null===(E=this._options)||void 0===E?void 0:E.clickAction;X.stopPropagation(),this.disabled||"noop"===he?!this.disabled&&"noop"===he&&(this._inputElement.nativeElement.checked=this.checked,this._inputElement.nativeElement.indeterminate=this.indeterminate):(this.indeterminate&&"check"!==he&&Promise.resolve().then(()=>{this._indeterminate=!1,this.indeterminateChange.emit(this._indeterminate)}),this._checked=!this._checked,this._transitionCheckState(this._checked?1:2),this._emitChangeEvent())}focus(X,E){X?this._focusMonitor.focusVia(this._inputElement,X,E):this._inputElement.nativeElement.focus(E)}_onInteractionEvent(X){X.stopPropagation()}_getAnimationClassForCheckStateTransition(X,E){if("NoopAnimations"===this._animationMode)return"";let he="";switch(X){case 0:if(1===E)he="unchecked-checked";else{if(3!=E)return"";he="unchecked-indeterminate"}break;case 2:he=1===E?"unchecked-checked":"unchecked-indeterminate";break;case 1:he=2===E?"checked-unchecked":"checked-indeterminate";break;case 3:he=1===E?"indeterminate-checked":"indeterminate-unchecked"}return`mat-checkbox-anim-${he}`}_syncIndeterminate(X){const E=this._inputElement;E&&(E.nativeElement.indeterminate=X)}}return J.\u0275fac=function(X){return new(X||J)(F.Y36(F.SBq),F.Y36(F.sBO),F.Y36(ue.tE),F.Y36(F.R0b),F.$8M("tabindex"),F.Y36(me.Qb,8),F.Y36(ge,8))},J.\u0275cmp=F.Xpm({type:J,selectors:[["mat-checkbox"]],viewQuery:function(X,E){if(1&X&&(F.Gf(Re,5),F.Gf(ie.wG,5)),2&X){let he;F.iGM(he=F.CRH())&&(E._inputElement=he.first),F.iGM(he=F.CRH())&&(E.ripple=he.first)}},hostAttrs:[1,"mat-checkbox"],hostVars:14,hostBindings:function(X,E){2&X&&(F.Ikx("id",E.id),F.uIk("tabindex",null)("aria-label",null)("aria-labelledby",null),F.ekj("mat-checkbox-indeterminate",E.indeterminate)("mat-checkbox-checked",E.checked)("mat-checkbox-disabled",E.disabled)("mat-checkbox-label-before","before"==E.labelPosition)("_mat-animation-noopable","NoopAnimations"===E._animationMode))},inputs:{disableRipple:"disableRipple",color:"color",tabIndex:"tabIndex",ariaLabel:["aria-label","ariaLabel"],ariaLabelledby:["aria-labelledby","ariaLabelledby"],ariaDescribedby:["aria-describedby","ariaDescribedby"],id:"id",required:"required",labelPosition:"labelPosition",name:"name",value:"value",checked:"checked",disabled:"disabled",indeterminate:"indeterminate"},outputs:{change:"change",indeterminateChange:"indeterminateChange"},exportAs:["matCheckbox"],features:[F._Bn([Se]),F.qOj],ngContentSelectors:be,decls:17,vars:21,consts:[[1,"mat-checkbox-layout"],["label",""],[1,"mat-checkbox-inner-container"],["type","checkbox",1,"mat-checkbox-input","cdk-visually-hidden",3,"id","required","checked","disabled","tabIndex","change","click"],["input",""],["matRipple","",1,"mat-checkbox-ripple","mat-focus-indicator",3,"matRippleTrigger","matRippleDisabled","matRippleRadius","matRippleCentered","matRippleAnimation"],[1,"mat-ripple-element","mat-checkbox-persistent-ripple"],[1,"mat-checkbox-frame"],[1,"mat-checkbox-background"],["version","1.1","focusable","false","viewBox","0 0 24 24","aria-hidden","true",1,"mat-checkbox-checkmark"],["fill","none","stroke","white","d","M4.1,12.7 9,17.6 20.3,6.3",1,"mat-checkbox-checkmark-path"],[1,"mat-checkbox-mixedmark"],[1,"mat-checkbox-label",3,"cdkObserveContent"],["checkboxLabel",""],[2,"display","none"]],template:function(X,E){if(1&X&&(F.F$t(),F.TgZ(0,"label",0,1)(2,"span",2)(3,"input",3,4),F.NdJ("change",function(ee){return E._onInteractionEvent(ee)})("click",function(ee){return E._onInputClick(ee)}),F.qZA(),F.TgZ(5,"span",5),F._UZ(6,"span",6),F.qZA(),F._UZ(7,"span",7),F.TgZ(8,"span",8),F.O4$(),F.TgZ(9,"svg",9),F._UZ(10,"path",10),F.qZA(),F.kcU(),F._UZ(11,"span",11),F.qZA()(),F.TgZ(12,"span",12,13),F.NdJ("cdkObserveContent",function(){return E._onLabelTextChange()}),F.TgZ(14,"span",14),F._uU(15,"\xa0"),F.qZA(),F.Hsn(16),F.qZA()()),2&X){const he=F.MAs(1),ee=F.MAs(13);F.uIk("for",E.inputId),F.xp6(2),F.ekj("mat-checkbox-inner-container-no-side-margin",!ee.textContent||!ee.textContent.trim()),F.xp6(1),F.Q6J("id",E.inputId)("required",E.required)("checked",E.checked)("disabled",E.disabled)("tabIndex",E.tabIndex),F.uIk("value",E.value)("name",E.name)("aria-label",E.ariaLabel||null)("aria-labelledby",E.ariaLabelledby)("aria-checked",E._getAriaChecked())("aria-describedby",E.ariaDescribedby),F.xp6(2),F.Q6J("matRippleTrigger",he)("matRippleDisabled",E._isRippleDisabled())("matRippleRadius",20)("matRippleCentered",!0)("matRippleAnimation",F.VKq(19,Pe,"NoopAnimations"===E._animationMode?0:150))}},directives:[ie.wG,z.wD],styles:["@keyframes mat-checkbox-fade-in-background{0%{opacity:0}50%{opacity:1}}@keyframes mat-checkbox-fade-out-background{0%,50%{opacity:1}100%{opacity:0}}@keyframes mat-checkbox-unchecked-checked-checkmark-path{0%,50%{stroke-dashoffset:22.910259}50%{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1)}100%{stroke-dashoffset:0}}@keyframes mat-checkbox-unchecked-indeterminate-mixedmark{0%,68.2%{transform:scaleX(0)}68.2%{animation-timing-function:cubic-bezier(0, 0, 0, 1)}100%{transform:scaleX(1)}}@keyframes mat-checkbox-checked-unchecked-checkmark-path{from{animation-timing-function:cubic-bezier(0.4, 0, 1, 1);stroke-dashoffset:0}to{stroke-dashoffset:-22.910259}}@keyframes mat-checkbox-checked-indeterminate-checkmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(45deg)}}@keyframes mat-checkbox-indeterminate-checked-checkmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:0;transform:rotate(45deg)}to{opacity:1;transform:rotate(360deg)}}@keyframes mat-checkbox-checked-indeterminate-mixedmark{from{animation-timing-function:cubic-bezier(0, 0, 0.2, 0.1);opacity:0;transform:rotate(-45deg)}to{opacity:1;transform:rotate(0deg)}}@keyframes mat-checkbox-indeterminate-checked-mixedmark{from{animation-timing-function:cubic-bezier(0.14, 0, 0, 1);opacity:1;transform:rotate(0deg)}to{opacity:0;transform:rotate(315deg)}}@keyframes mat-checkbox-indeterminate-unchecked-mixedmark{0%{animation-timing-function:linear;opacity:1;transform:scaleX(1)}32.8%,100%{opacity:0;transform:scaleX(0)}}.mat-checkbox-background,.mat-checkbox-frame{top:0;left:0;right:0;bottom:0;position:absolute;border-radius:2px;box-sizing:border-box;pointer-events:none}.mat-checkbox{display:inline-block;transition:background 400ms cubic-bezier(0.25, 0.8, 0.25, 1),box-shadow 280ms cubic-bezier(0.4, 0, 0.2, 1);cursor:pointer;-webkit-tap-highlight-color:transparent}._mat-animation-noopable.mat-checkbox{transition:none;animation:none}.mat-checkbox .mat-ripple-element:not(.mat-checkbox-persistent-ripple){opacity:.16}.mat-checkbox .mat-checkbox-ripple{position:absolute;left:calc(50% - 20px);top:calc(50% - 20px);height:40px;width:40px;z-index:1;pointer-events:none}.cdk-high-contrast-active .mat-checkbox.cdk-keyboard-focused .mat-checkbox-ripple{outline:solid 3px}.mat-checkbox-layout{-webkit-user-select:none;user-select:none;cursor:inherit;align-items:baseline;vertical-align:middle;display:inline-flex;white-space:nowrap}.mat-checkbox-label{-webkit-user-select:auto;user-select:auto}.mat-checkbox-inner-container{display:inline-block;height:16px;line-height:0;margin:auto;margin-right:8px;order:0;position:relative;vertical-align:middle;white-space:nowrap;width:16px;flex-shrink:0}[dir=rtl] .mat-checkbox-inner-container{margin-left:8px;margin-right:auto}.mat-checkbox-inner-container-no-side-margin{margin-left:0;margin-right:0}.mat-checkbox-frame{background-color:transparent;transition:border-color 90ms cubic-bezier(0, 0, 0.2, 0.1);border-width:2px;border-style:solid}._mat-animation-noopable .mat-checkbox-frame{transition:none}.mat-checkbox-background{align-items:center;display:inline-flex;justify-content:center;transition:background-color 90ms cubic-bezier(0, 0, 0.2, 0.1),opacity 90ms cubic-bezier(0, 0, 0.2, 0.1);-webkit-print-color-adjust:exact;color-adjust:exact}._mat-animation-noopable .mat-checkbox-background{transition:none}.cdk-high-contrast-active .mat-checkbox .mat-checkbox-background{background:none}.mat-checkbox-persistent-ripple{display:block;width:100%;height:100%;transform:none}.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:.04}.mat-checkbox.cdk-keyboard-focused .mat-checkbox-persistent-ripple{opacity:.12}.mat-checkbox-persistent-ripple,.mat-checkbox.mat-checkbox-disabled .mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{opacity:0}@media(hover: none){.mat-checkbox-inner-container:hover .mat-checkbox-persistent-ripple{display:none}}.mat-checkbox-checkmark{top:0;left:0;right:0;bottom:0;position:absolute;width:100%}.mat-checkbox-checkmark-path{stroke-dashoffset:22.910259;stroke-dasharray:22.910259;stroke-width:2.1333333333px}.cdk-high-contrast-black-on-white .mat-checkbox-checkmark-path{stroke:#000 !important}.mat-checkbox-mixedmark{width:calc(100% - 6px);height:2px;opacity:0;transform:scaleX(0) rotate(0deg);border-radius:2px}.cdk-high-contrast-active .mat-checkbox-mixedmark{height:0;border-top:solid 2px;margin-top:2px}.mat-checkbox-label-before .mat-checkbox-inner-container{order:1;margin-left:8px;margin-right:auto}[dir=rtl] .mat-checkbox-label-before .mat-checkbox-inner-container{margin-left:auto;margin-right:8px}.mat-checkbox-checked .mat-checkbox-checkmark{opacity:1}.mat-checkbox-checked .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-checked .mat-checkbox-mixedmark{transform:scaleX(1) rotate(-45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark{opacity:0;transform:rotate(45deg)}.mat-checkbox-indeterminate .mat-checkbox-checkmark-path{stroke-dashoffset:0}.mat-checkbox-indeterminate .mat-checkbox-mixedmark{opacity:1;transform:scaleX(1) rotate(0deg)}.mat-checkbox-unchecked .mat-checkbox-background{background-color:transparent}.mat-checkbox-disabled{cursor:default}.cdk-high-contrast-active .mat-checkbox-disabled{opacity:.5}.mat-checkbox-anim-unchecked-checked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-checked .mat-checkbox-checkmark-path{animation:180ms linear 0ms mat-checkbox-unchecked-checked-checkmark-path}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-in-background}.mat-checkbox-anim-unchecked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-unchecked-indeterminate-mixedmark}.mat-checkbox-anim-checked-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-checked-unchecked .mat-checkbox-checkmark-path{animation:90ms linear 0ms mat-checkbox-checked-unchecked-checkmark-path}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-checkmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-checkmark}.mat-checkbox-anim-checked-indeterminate .mat-checkbox-mixedmark{animation:90ms linear 0ms mat-checkbox-checked-indeterminate-mixedmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-checkmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-checkmark}.mat-checkbox-anim-indeterminate-checked .mat-checkbox-mixedmark{animation:500ms linear 0ms mat-checkbox-indeterminate-checked-mixedmark}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-background{animation:180ms linear 0ms mat-checkbox-fade-out-background}.mat-checkbox-anim-indeterminate-unchecked .mat-checkbox-mixedmark{animation:300ms linear 0ms mat-checkbox-indeterminate-unchecked-mixedmark}.mat-checkbox-input{bottom:0;left:50%}\n"],encapsulation:2,changeDetection:0}),J})(),Ae=(()=>{class J{}return J.\u0275fac=function(X){return new(X||J)},J.\u0275mod=F.oAB({type:J}),J.\u0275inj=F.cJS({}),J})(),Ie=(()=>{class J{}return J.\u0275fac=function(X){return new(X||J)},J.\u0275mod=F.oAB({type:J}),J.\u0275inj=F.cJS({imports:[[ie.si,ie.BQ,z.Q8,Ae],ie.BQ,Ae]}),J})()},8966:(mn,Qe,M)=>{M.d(Qe,{Is:()=>Jt,WI:()=>he,so:()=>X,uh:()=>Je,uw:()=>Zt,xY:()=>Oe});var v=M(9776),F=M(7429),y=M(5e3),ie=M(508),me=M(226),ue=M(7579),z=M(9770),Re=M(9646),Pe=M(9300),be=M(5698),ge=M(8675),re=M(925),Ee=M(9808),fe=M(1777),Se=M(8255),d=M(1159),ye=M(6360);function xe(G,$){}class R{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const Ue={dialogContainer:(0,fe.X$)("dialogContainer",[(0,fe.SB)("void, exit",(0,fe.oB)({opacity:0,transform:"scale(0.7)"})),(0,fe.SB)("enter",(0,fe.oB)({transform:"none"})),(0,fe.eR)("* => enter",(0,fe.ru)([(0,fe.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,fe.oB)({transform:"none",opacity:1})),(0,fe.IO)("@*",(0,fe.pV)(),{optional:!0})])),(0,fe.eR)("* => void, * => exit",(0,fe.ru)([(0,fe.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,fe.oB)({opacity:0})),(0,fe.IO)("@*",(0,fe.pV)(),{optional:!0})]))])};let Ie=(()=>{class G extends F.en{constructor(C,S,q,w,L,T,O,b){super(),this._elementRef=C,this._focusTrapFactory=S,this._changeDetectorRef=q,this._config=L,this._interactivityChecker=T,this._ngZone=O,this._focusMonitor=b,this._animationStateChanged=new y.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=x=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(x)),this._ariaLabelledBy=L.ariaLabelledBy||null,this._document=w}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,re.ht)())}attachComponentPortal(C){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(C)}attachTemplatePortal(C){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(C)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(C,S){this._interactivityChecker.isFocusable(C)||(C.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const q=()=>{C.removeEventListener("blur",q),C.removeEventListener("mousedown",q),C.removeAttribute("tabindex")};C.addEventListener("blur",q),C.addEventListener("mousedown",q)})),C.focus(S)}_focusByCssSelector(C,S){let q=this._elementRef.nativeElement.querySelector(C);q&&this._forceFocus(q,S)}_trapFocus(){const C=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||C.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(S=>{S||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const C=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&C&&"function"==typeof C.focus){const S=(0,re.ht)(),q=this._elementRef.nativeElement;(!S||S===this._document.body||S===q||q.contains(S))&&(this._focusMonitor?(this._focusMonitor.focusVia(C,this._closeInteractionType),this._closeInteractionType=null):C.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const C=this._elementRef.nativeElement,S=(0,re.ht)();return C===S||C.contains(S)}}return G.\u0275fac=function(C){return new(C||G)(y.Y36(y.SBq),y.Y36(Se.qV),y.Y36(y.sBO),y.Y36(Ee.K0,8),y.Y36(R),y.Y36(Se.ic),y.Y36(y.R0b),y.Y36(Se.tE))},G.\u0275dir=y.lG2({type:G,viewQuery:function(C,S){if(1&C&&y.Gf(F.Pl,7),2&C){let q;y.iGM(q=y.CRH())&&(S._portalOutlet=q.first)}},features:[y.qOj]}),G})(),J=(()=>{class G extends Ie{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:C,totalTime:S}){"enter"===C?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:S})):"exit"===C&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:S}))}_onAnimationStart({toState:C,totalTime:S}){"enter"===C?this._animationStateChanged.next({state:"opening",totalTime:S}):("exit"===C||"void"===C)&&this._animationStateChanged.next({state:"closing",totalTime:S})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return G.\u0275fac=function(){let $;return function(S){return($||($=y.n5z(G)))(S||G)}}(),G.\u0275cmp=y.Xpm({type:G,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(C,S){1&C&&y.WFA("@dialogContainer.start",function(w){return S._onAnimationStart(w)})("@dialogContainer.done",function(w){return S._onAnimationDone(w)}),2&C&&(y.Ikx("id",S._id),y.uIk("role",S._config.role)("aria-labelledby",S._config.ariaLabel?null:S._ariaLabelledBy)("aria-label",S._config.ariaLabel)("aria-describedby",S._config.ariaDescribedBy||null),y.d8E("@dialogContainer",S._state))},features:[y.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(C,S){1&C&&y.YNc(0,xe,0,0,"ng-template",0)},directives:[F.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[Ue.dialogContainer]}}),G})(),Ve=0;class X{constructor($,C,S="mat-dialog-"+Ve++){this._overlayRef=$,this._containerInstance=C,this.id=S,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new ue.x,this._afterClosed=new ue.x,this._beforeClosed=new ue.x,this._state=0,C._id=S,C._animationStateChanged.pipe((0,Pe.h)(q=>"opened"===q.state),(0,be.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),C._animationStateChanged.pipe((0,Pe.h)(q=>"closed"===q.state),(0,be.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),$.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),$.keydownEvents().pipe((0,Pe.h)(q=>q.keyCode===d.hY&&!this.disableClose&&!(0,d.Vb)(q))).subscribe(q=>{q.preventDefault(),E(this,"keyboard")}),$.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():E(this,"mouse")})}close($){this._result=$,this._containerInstance._animationStateChanged.pipe((0,Pe.h)(C=>"closing"===C.state),(0,be.q)(1)).subscribe(C=>{this._beforeClosed.next($),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),C.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition($){let C=this._getPositionStrategy();return $&&($.left||$.right)?$.left?C.left($.left):C.right($.right):C.centerHorizontally(),$&&($.top||$.bottom)?$.top?C.top($.top):C.bottom($.bottom):C.centerVertically(),this._overlayRef.updatePosition(),this}updateSize($="",C=""){return this._overlayRef.updateSize({width:$,height:C}),this._overlayRef.updatePosition(),this}addPanelClass($){return this._overlayRef.addPanelClass($),this}removePanelClass($){return this._overlayRef.removePanelClass($),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function E(G,$,C){return void 0!==G._containerInstance&&(G._containerInstance._closeInteractionType=$),G.close(C)}const he=new y.OlP("MatDialogData"),ee=new y.OlP("mat-dialog-default-options"),Rt=new y.OlP("mat-dialog-scroll-strategy"),zn={provide:Rt,deps:[v.aV],useFactory:function Nt(G){return()=>G.scrollStrategies.block()}};let ft=(()=>{class G{constructor(C,S,q,w,L,T,O,b,x,W){this._overlay=C,this._injector=S,this._defaultOptions=q,this._parentDialog=w,this._overlayContainer=L,this._dialogRefConstructor=O,this._dialogContainerType=b,this._dialogDataToken=x,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ue.x,this._afterOpenedAtThisLevel=new ue.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,z.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,ge.O)(void 0))),this._scrollStrategy=T}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const C=this._parentDialog;return C?C._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(C,S){S=function xn(G,$){return Object.assign(Object.assign({},$),G)}(S,this._defaultOptions||new R),S.id&&this.getDialogById(S.id);const q=this._createOverlay(S),w=this._attachDialogContainer(q,S),L=this._attachDialogContent(C,w,q,S);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(L),L.afterClosed().subscribe(()=>this._removeOpenDialog(L)),this.afterOpened.next(L),w._initializeWithAttachedContent(),L}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(C){return this.openDialogs.find(S=>S.id===C)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(C){const S=this._getOverlayConfig(C);return this._overlay.create(S)}_getOverlayConfig(C){const S=new v.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:C.scrollStrategy||this._scrollStrategy(),panelClass:C.panelClass,hasBackdrop:C.hasBackdrop,direction:C.direction,minWidth:C.minWidth,minHeight:C.minHeight,maxWidth:C.maxWidth,maxHeight:C.maxHeight,disposeOnNavigation:C.closeOnNavigation});return C.backdropClass&&(S.backdropClass=C.backdropClass),S}_attachDialogContainer(C,S){const w=y.zs3.create({parent:S&&S.viewContainerRef&&S.viewContainerRef.injector||this._injector,providers:[{provide:R,useValue:S}]}),L=new F.C5(this._dialogContainerType,S.viewContainerRef,w,S.componentFactoryResolver);return C.attach(L).instance}_attachDialogContent(C,S,q,w){const L=new this._dialogRefConstructor(q,S,w.id);if(C instanceof y.Rgc)S.attachTemplatePortal(new F.UE(C,null,{$implicit:w.data,dialogRef:L}));else{const T=this._createInjector(w,L,S),O=S.attachComponentPortal(new F.C5(C,w.viewContainerRef,T,w.componentFactoryResolver));L.componentInstance=O.instance}return L.updateSize(w.width,w.height).updatePosition(w.position),L}_createInjector(C,S,q){const w=C&&C.viewContainerRef&&C.viewContainerRef.injector,L=[{provide:this._dialogContainerType,useValue:q},{provide:this._dialogDataToken,useValue:C.data},{provide:this._dialogRefConstructor,useValue:S}];return C.direction&&(!w||!w.get(me.Is,null,y.XFs.Optional))&&L.push({provide:me.Is,useValue:{value:C.direction,change:(0,Re.of)()}}),y.zs3.create({parent:w||this._injector,providers:L})}_removeOpenDialog(C){const S=this.openDialogs.indexOf(C);S>-1&&(this.openDialogs.splice(S,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((q,w)=>{q?w.setAttribute("aria-hidden",q):w.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const C=this._overlayContainer.getContainerElement();if(C.parentElement){const S=C.parentElement.children;for(let q=S.length-1;q>-1;q--){let w=S[q];w!==C&&"SCRIPT"!==w.nodeName&&"STYLE"!==w.nodeName&&!w.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(w,w.getAttribute("aria-hidden")),w.setAttribute("aria-hidden","true"))}}}_closeDialogs(C){let S=C.length;for(;S--;)C[S].close()}}return G.\u0275fac=function(C){y.$Z()},G.\u0275dir=y.lG2({type:G}),G})(),Zt=(()=>{class G extends ft{constructor(C,S,q,w,L,T,O,b){super(C,S,w,T,O,L,X,J,he,b)}}return G.\u0275fac=function(C){return new(C||G)(y.LFG(v.aV),y.LFG(y.zs3),y.LFG(Ee.Ye,8),y.LFG(ee,8),y.LFG(Rt),y.LFG(G,12),y.LFG(v.Xj),y.LFG(ye.Qb,8))},G.\u0275prov=y.Yz7({token:G,factory:G.\u0275fac}),G})(),jn=0,Je=(()=>{class G{constructor(C,S,q){this._dialogRef=C,this._elementRef=S,this._dialog=q,this.id="mat-dialog-title-"+jn++}ngOnInit(){this._dialogRef||(this._dialogRef=function Wt(G,$){let C=G.nativeElement.parentElement;for(;C&&!C.classList.contains("mat-dialog-container");)C=C.parentElement;return C?$.find(S=>S.id===C.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const C=this._dialogRef._containerInstance;C&&!C._ariaLabelledBy&&(C._ariaLabelledBy=this.id)})}}return G.\u0275fac=function(C){return new(C||G)(y.Y36(X,8),y.Y36(y.SBq),y.Y36(Zt))},G.\u0275dir=y.lG2({type:G,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-dialog-title"],hostVars:1,hostBindings:function(C,S){2&C&&y.Ikx("id",S.id)},inputs:{id:"id"},exportAs:["matDialogTitle"]}),G})(),Oe=(()=>{class G{}return G.\u0275fac=function(C){return new(C||G)},G.\u0275dir=y.lG2({type:G,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-dialog-content"]}),G})(),Jt=(()=>{class G{}return G.\u0275fac=function(C){return new(C||G)},G.\u0275mod=y.oAB({type:G}),G.\u0275inj=y.cJS({providers:[Zt,zn],imports:[[v.U8,F.eL,ie.BQ],ie.BQ]}),G})()},2638:(mn,Qe,M)=>{M.d(Qe,{JX:()=>G,Rh:()=>Jt,SJ:()=>C,TM:()=>$});var v=M(8962),F=M(9808),y=M(5e3),ie=M(508),me=M(3191),ue=M(1159),z=M(7579),Re=M(4968),Pe=M(6451),be=M(9300),ge=M(4004),re=M(9718),Ee=M(2722),fe=M(1884),Se=M(5698),d=M(8675),ye=M(8372),xe=M(1777),R=M(6360),Ue=M(8255),Ae=M(925),Ie=M(226);const J=["*"],Ve=["content"];function X(S,q){if(1&S){const w=y.EpF();y.TgZ(0,"div",2),y.NdJ("click",function(){return y.CHM(w),y.oxw()._onBackdropClicked()}),y.qZA()}if(2&S){const w=y.oxw();y.ekj("mat-drawer-shown",w._isShowingBackdrop())}}function E(S,q){1&S&&(y.TgZ(0,"mat-drawer-content"),y.Hsn(1,2),y.qZA())}const he=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],ee=["mat-drawer","mat-drawer-content","*"];function Rt(S,q){if(1&S){const w=y.EpF();y.TgZ(0,"div",2),y.NdJ("click",function(){return y.CHM(w),y.oxw()._onBackdropClicked()}),y.qZA()}if(2&S){const w=y.oxw();y.ekj("mat-drawer-shown",w._isShowingBackdrop())}}function We(S,q){1&S&&(y.TgZ(0,"mat-sidenav-content"),y.Hsn(1,2),y.qZA())}const Nt=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],zn=["mat-sidenav","mat-sidenav-content","*"],Zt={transformDrawer:(0,xe.X$)("transform",[(0,xe.SB)("open, open-instant",(0,xe.oB)({transform:"none",visibility:"visible"})),(0,xe.SB)("void",(0,xe.oB)({"box-shadow":"none",visibility:"hidden"})),(0,xe.eR)("void => open-instant",(0,xe.jt)("0ms")),(0,xe.eR)("void <=> open, open-instant => void",(0,xe.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},jn=new y.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function Je(){return!1}}),$e=new y.OlP("MAT_DRAWER_CONTAINER");let Oe=(()=>{class S extends v.PQ{constructor(w,L,T,O,b){super(T,O,b),this._changeDetectorRef=w,this._container=L}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return S.\u0275fac=function(w){return new(w||S)(y.Y36(y.sBO),y.Y36((0,y.Gpc)(()=>Wt)),y.Y36(y.SBq),y.Y36(v.mF),y.Y36(y.R0b))},S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(w,L){2&w&&y.Udp("margin-left",L._container._contentMargins.left,"px")("margin-right",L._container._contentMargins.right,"px")},features:[y._Bn([{provide:v.PQ,useExisting:S}]),y.qOj],ngContentSelectors:J,decls:1,vars:0,template:function(w,L){1&w&&(y.F$t(),y.Hsn(0))},encapsulation:2,changeDetection:0}),S})(),Tt=(()=>{class S{constructor(w,L,T,O,b,x,W,te){this._elementRef=w,this._focusTrapFactory=L,this._focusMonitor=T,this._platform=O,this._ngZone=b,this._interactivityChecker=x,this._doc=W,this._container=te,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new z.x,this._animationEnd=new z.x,this._animationState="void",this.openedChange=new y.vpe(!0),this._openedStream=this.openedChange.pipe((0,be.h)(ae=>ae),(0,ge.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,be.h)(ae=>ae.fromState!==ae.toState&&0===ae.toState.indexOf("open")),(0,re.h)(void 0)),this._closedStream=this.openedChange.pipe((0,be.h)(ae=>!ae),(0,ge.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,be.h)(ae=>ae.fromState!==ae.toState&&"void"===ae.toState),(0,re.h)(void 0)),this._destroyed=new z.x,this.onPositionChanged=new y.vpe,this._modeChanged=new z.x,this.openedChange.subscribe(ae=>{ae?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{(0,Re.R)(this._elementRef.nativeElement,"keydown").pipe((0,be.h)(ae=>ae.keyCode===ue.hY&&!this.disableClose&&!(0,ue.Vb)(ae)),(0,Ee.R)(this._destroyed)).subscribe(ae=>this._ngZone.run(()=>{this.close(),ae.stopPropagation(),ae.preventDefault()}))}),this._animationEnd.pipe((0,fe.x)((ae,Mt)=>ae.fromState===Mt.fromState&&ae.toState===Mt.toState)).subscribe(ae=>{const{fromState:Mt,toState:Kn}=ae;(0===Kn.indexOf("open")&&"void"===Mt||"void"===Kn&&0===Mt.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(w){(w="end"===w?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(w),this._position=w,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(w){this._mode=w,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(w){this._disableClose=(0,me.Ig)(w)}get autoFocus(){const w=this._autoFocus;return null==w?"side"===this.mode?"dialog":"first-tabbable":w}set autoFocus(w){("true"===w||"false"===w||null==w)&&(w=(0,me.Ig)(w)),this._autoFocus=w}get opened(){return this._opened}set opened(w){this.toggle((0,me.Ig)(w))}_forceFocus(w,L){this._interactivityChecker.isFocusable(w)||(w.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const T=()=>{w.removeEventListener("blur",T),w.removeEventListener("mousedown",T),w.removeAttribute("tabindex")};w.addEventListener("blur",T),w.addEventListener("mousedown",T)})),w.focus(L)}_focusByCssSelector(w,L){let T=this._elementRef.nativeElement.querySelector(w);T&&this._forceFocus(T,L)}_takeFocus(){if(!this._focusTrap)return;const w=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(L=>{!L&&"function"==typeof this._elementRef.nativeElement.focus&&w.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(w){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,w):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const w=this._doc.activeElement;return!!w&&this._elementRef.nativeElement.contains(w)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var w;this._focusTrap&&this._focusTrap.destroy(),null===(w=this._anchor)||void 0===w||w.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(w){return this.toggle(!0,w)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(w=!this.opened,L){w&&L&&(this._openedVia=L);const T=this._setOpen(w,!w&&this._isFocusWithinDrawer(),this._openedVia||"program");return w||(this._openedVia=null),T}_setOpen(w,L,T){return this._opened=w,w?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",L&&this._restoreFocus(T)),this._updateFocusTrapState(),new Promise(O=>{this.openedChange.pipe((0,Se.q)(1)).subscribe(b=>O(b?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(w){const L=this._elementRef.nativeElement,T=L.parentNode;"end"===w?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),T.insertBefore(this._anchor,L)),T.appendChild(L)):this._anchor&&this._anchor.parentNode.insertBefore(L,this._anchor)}}return S.\u0275fac=function(w){return new(w||S)(y.Y36(y.SBq),y.Y36(Ue.qV),y.Y36(Ue.tE),y.Y36(Ae.t4),y.Y36(y.R0b),y.Y36(Ue.ic),y.Y36(F.K0,8),y.Y36($e,8))},S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-drawer"]],viewQuery:function(w,L){if(1&w&&y.Gf(Ve,5),2&w){let T;y.iGM(T=y.CRH())&&(L._content=T.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(w,L){1&w&&y.WFA("@transform.start",function(O){return L._animationStarted.next(O)})("@transform.done",function(O){return L._animationEnd.next(O)}),2&w&&(y.uIk("align",null),y.d8E("@transform",L._animationState),y.ekj("mat-drawer-end","end"===L.position)("mat-drawer-over","over"===L.mode)("mat-drawer-push","push"===L.mode)("mat-drawer-side","side"===L.mode)("mat-drawer-opened",L.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:J,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(w,L){1&w&&(y.F$t(),y.TgZ(0,"div",0,1),y.Hsn(2),y.qZA())},directives:[v.PQ],encapsulation:2,data:{animation:[Zt.transformDrawer]},changeDetection:0}),S})(),Wt=(()=>{class S{constructor(w,L,T,O,b,x=!1,W){this._dir=w,this._element=L,this._ngZone=T,this._changeDetectorRef=O,this._animationMode=W,this._drawers=new y.n_E,this.backdropClick=new y.vpe,this._destroyed=new z.x,this._doCheckSubject=new z.x,this._contentMargins={left:null,right:null},this._contentMarginChanges=new z.x,w&&w.change.pipe((0,Ee.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),b.change().pipe((0,Ee.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=x}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(w){this._autosize=(0,me.Ig)(w)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(w){this._backdropOverride=null==w?null:(0,me.Ig)(w)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,d.O)(this._allDrawers),(0,Ee.R)(this._destroyed)).subscribe(w=>{this._drawers.reset(w.filter(L=>!L._container||L._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,d.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(w=>{this._watchDrawerToggle(w),this._watchDrawerPosition(w),this._watchDrawerMode(w)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,ye.b)(10),(0,Ee.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(w=>w.open())}close(){this._drawers.forEach(w=>w.close())}updateContentMargins(){let w=0,L=0;if(this._left&&this._left.opened)if("side"==this._left.mode)w+=this._left._getWidth();else if("push"==this._left.mode){const T=this._left._getWidth();w+=T,L-=T}if(this._right&&this._right.opened)if("side"==this._right.mode)L+=this._right._getWidth();else if("push"==this._right.mode){const T=this._right._getWidth();L+=T,w-=T}w=w||null,L=L||null,(w!==this._contentMargins.left||L!==this._contentMargins.right)&&(this._contentMargins={left:w,right:L},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(w){w._animationStarted.pipe((0,be.h)(L=>L.fromState!==L.toState),(0,Ee.R)(this._drawers.changes)).subscribe(L=>{"open-instant"!==L.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==w.mode&&w.openedChange.pipe((0,Ee.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(w.opened))}_watchDrawerPosition(w){!w||w.onPositionChanged.pipe((0,Ee.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,Se.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(w){w&&w._modeChanged.pipe((0,Ee.R)((0,Pe.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(w){const L=this._element.nativeElement.classList,T="mat-drawer-container-has-open";w?L.add(T):L.remove(T)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(w=>{"end"==w.position?this._end=w:this._start=w}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(w=>w&&!w.disableClose&&this._canHaveBackdrop(w)).forEach(w=>w._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(w){return"side"!==w.mode||!!this._backdropOverride}_isDrawerOpen(w){return null!=w&&w.opened}}return S.\u0275fac=function(w){return new(w||S)(y.Y36(Ie.Is,8),y.Y36(y.SBq),y.Y36(y.R0b),y.Y36(y.sBO),y.Y36(v.rL),y.Y36(jn),y.Y36(R.Qb,8))},S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-drawer-container"]],contentQueries:function(w,L,T){if(1&w&&(y.Suo(T,Oe,5),y.Suo(T,Tt,5)),2&w){let O;y.iGM(O=y.CRH())&&(L._content=O.first),y.iGM(O=y.CRH())&&(L._allDrawers=O)}},viewQuery:function(w,L){if(1&w&&y.Gf(Oe,5),2&w){let T;y.iGM(T=y.CRH())&&(L._userContent=T.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(w,L){2&w&&y.ekj("mat-drawer-container-explicit-backdrop",L._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[y._Bn([{provide:$e,useExisting:S}])],ngContentSelectors:ee,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(w,L){1&w&&(y.F$t(he),y.YNc(0,X,1,2,"div",0),y.Hsn(1),y.Hsn(2,1),y.YNc(3,E,2,0,"mat-drawer-content",1)),2&w&&(y.Q6J("ngIf",L.hasBackdrop),y.xp6(3),y.Q6J("ngIf",!L._content))},directives:[Oe,F.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),S})(),Jt=(()=>{class S extends Oe{constructor(w,L,T,O,b){super(w,L,T,O,b)}}return S.\u0275fac=function(w){return new(w||S)(y.Y36(y.sBO),y.Y36((0,y.Gpc)(()=>$)),y.Y36(y.SBq),y.Y36(v.mF),y.Y36(y.R0b))},S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(w,L){2&w&&y.Udp("margin-left",L._container._contentMargins.left,"px")("margin-right",L._container._contentMargins.right,"px")},features:[y._Bn([{provide:v.PQ,useExisting:S}]),y.qOj],ngContentSelectors:J,decls:1,vars:0,template:function(w,L){1&w&&(y.F$t(),y.Hsn(0))},encapsulation:2,changeDetection:0}),S})(),G=(()=>{class S extends Tt{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(w){this._fixedInViewport=(0,me.Ig)(w)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(w){this._fixedTopGap=(0,me.su)(w)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(w){this._fixedBottomGap=(0,me.su)(w)}}return S.\u0275fac=function(){let q;return function(L){return(q||(q=y.n5z(S)))(L||S)}}(),S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(w,L){2&w&&(y.uIk("align",null),y.Udp("top",L.fixedInViewport?L.fixedTopGap:null,"px")("bottom",L.fixedInViewport?L.fixedBottomGap:null,"px"),y.ekj("mat-drawer-end","end"===L.position)("mat-drawer-over","over"===L.mode)("mat-drawer-push","push"===L.mode)("mat-drawer-side","side"===L.mode)("mat-drawer-opened",L.opened)("mat-sidenav-fixed",L.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[y.qOj],ngContentSelectors:J,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(w,L){1&w&&(y.F$t(),y.TgZ(0,"div",0,1),y.Hsn(2),y.qZA())},directives:[v.PQ],encapsulation:2,data:{animation:[Zt.transformDrawer]},changeDetection:0}),S})(),$=(()=>{class S extends Wt{}return S.\u0275fac=function(){let q;return function(L){return(q||(q=y.n5z(S)))(L||S)}}(),S.\u0275cmp=y.Xpm({type:S,selectors:[["mat-sidenav-container"]],contentQueries:function(w,L,T){if(1&w&&(y.Suo(T,Jt,5),y.Suo(T,G,5)),2&w){let O;y.iGM(O=y.CRH())&&(L._content=O.first),y.iGM(O=y.CRH())&&(L._allDrawers=O)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(w,L){2&w&&y.ekj("mat-drawer-container-explicit-backdrop",L._backdropOverride)},exportAs:["matSidenavContainer"],features:[y._Bn([{provide:$e,useExisting:S}]),y.qOj],ngContentSelectors:zn,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(w,L){1&w&&(y.F$t(Nt),y.YNc(0,Rt,1,2,"div",0),y.Hsn(1),y.Hsn(2,1),y.YNc(3,We,2,0,"mat-sidenav-content",1)),2&w&&(y.Q6J("ngIf",L.hasBackdrop),y.xp6(3),y.Q6J("ngIf",!L._content))},directives:[Jt,F.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),S})(),C=(()=>{class S{}return S.\u0275fac=function(w){return new(w||S)},S.\u0275mod=y.oAB({type:S}),S.\u0275inj=y.cJS({imports:[[F.ez,ie.BQ,v.ZD],v.ZD,ie.BQ]}),S})()},9169:(mn,Qe,M)=>{M.r(Qe);var v=M(5861),F=M(3942),y=M(2090),ie=M(9681),me=M(1877),ue=M(655),z=M(4859);const Se=function Ee(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},d=function fe(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ye=new y.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),R=new me.Yd("@firebase/auth");function Ue(c,...o){R.logLevel<=me.in.ERROR&&R.error(`Auth (${ie.SDK_VERSION}): ${c}`,...o)}function Ae(c,...o){throw X(c,...o)}function Ie(c,...o){return X(c,...o)}function J(c,o,a){const l=Object.assign(Object.assign({},d()),{[o]:a});return new y.LL("auth","Firebase",l).create(o,{appName:c.name})}function Ve(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&Ae(c,"argument-error"),J(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function X(c,...o){if("string"!=typeof c){const a=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return ye.create(c,...o)}function E(c,o,...a){if(!c)throw X(o,...a)}function he(c){const o="INTERNAL ASSERTION FAILED: "+c;throw Ue(o),new Error(o)}function ee(c,o){c||he(o)}const Rt=new Map;function We(c){ee(c instanceof Function,"Expected a class definition");let o=Rt.get(c);return o?(ee(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,Rt.set(c,o),o)}function ft(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Zt(){return"http:"===xn()||"https:"===xn()}function xn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class Je{constructor(o,a){this.shortDelay=o,this.longDelay=a,ee(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,y.uI)()||(0,y.b$)()}get(){return function jn(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Zt()||(0,y.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Oe(c,o){ee(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Tt{static initialize(o,a,l){this.fetchImpl=o,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void he("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void he("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void he("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Wt={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Jt=new Je(3e4,6e4);function G(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function $(c,o,a,l){return C.apply(this,arguments)}function C(){return(C=(0,v.Z)(function*(c,o,a,l,p={}){return S(c,p,(0,v.Z)(function*(){let g={},A={};l&&("GET"===o?A=l:g={body:JSON.stringify(l)});const P=(0,y.xO)(Object.assign({key:c.config.apiKey},A)).slice(1),j=yield c._getAdditionalHeaders();return j["Content-Type"]="application/json",c.languageCode&&(j["X-Firebase-Locale"]=c.languageCode),Tt.fetch()(T(c,c.config.apiHost,a,P),Object.assign({method:o,headers:j,referrerPolicy:"no-referrer"},g))}))})).apply(this,arguments)}function S(c,o,a){return q.apply(this,arguments)}function q(){return(q=(0,v.Z)(function*(c,o,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},Wt),o);try{const p=new O(c),g=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const A=yield g.json();if("needConfirmation"in A)throw b(c,"account-exists-with-different-credential",A);if(g.ok&&!("errorMessage"in A))return A;{const P=g.ok?A.errorMessage:A.error.message,[j,ne]=P.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===j)throw b(c,"credential-already-in-use",A);if("EMAIL_EXISTS"===j)throw b(c,"email-already-in-use",A);if("USER_DISABLED"===j)throw b(c,"user-disabled",A);const de=l[j]||j.toLowerCase().replace(/[_\s]+/g,"-");if(ne)throw J(c,de,ne);Ae(c,de)}}catch(p){if(p instanceof y.ZR)throw p;Ae(c,"network-request-failed")}})).apply(this,arguments)}function w(c,o,a,l){return L.apply(this,arguments)}function L(){return(L=(0,v.Z)(function*(c,o,a,l,p={}){const g=yield $(c,o,a,l,p);return"mfaPendingCredential"in g&&Ae(c,"multi-factor-auth-required",{_serverResponse:g}),g})).apply(this,arguments)}function T(c,o,a,l){const p=`${o}${a}?${l}`;return c.config.emulator?Oe(c.config,p):`${c.config.apiScheme}://${p}`}class O{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(Ie(this.auth,"network-request-failed")),Jt.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function b(c,o,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const p=Ie(c,o,l);return p.customData._tokenResponse=a,p}function W(){return(W=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function te(c,o){return ae.apply(this,arguments)}function ae(){return(ae=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Mt(c,o){return Kn.apply(this,arguments)}function Kn(){return(Kn=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function lr(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function hr(){return(hr=(0,v.Z)(function*(c,o=!1){const a=(0,y.m9)(c),l=yield a.getIdToken(o),p=Ii(l);E(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const g="object"==typeof p.firebase?p.firebase:void 0,A=null==g?void 0:g.sign_in_provider;return{claims:p,token:l,authTime:lr(dr(p.auth_time)),issuedAtTime:lr(dr(p.iat)),expirationTime:lr(dr(p.exp)),signInProvider:A||null,signInSecondFactor:(null==g?void 0:g.sign_in_second_factor)||null}})).apply(this,arguments)}function dr(c){return 1e3*Number(c)}function Ii(c){const[o,a,l]=c.split(".");if(void 0===o||void 0===a||void 0===l)return Ue("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,y.tV)(a);return p?JSON.parse(p):(Ue("Failed to decode base64 JWT payload"),null)}catch(p){return Ue("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function gn(c,o){return fr.apply(this,arguments)}function fr(){return(fr=(0,v.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(l){throw l instanceof y.ZR&&Ru(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function Ru({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class Zl{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,v.Z)(function*(){yield a.iteration()}),l)}iteration(){var o=this;return(0,v.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class wi{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=lr(this.lastLoginAt),this.creationTime=lr(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function pr(c){return $n.apply(this,arguments)}function $n(){return($n=(0,v.Z)(function*(c){var o;const a=c.auth,l=yield c.getIdToken(),p=yield gn(c,Mt(a,{idToken:l}));E(null==p?void 0:p.users.length,a,"internal-error");const g=p.users[0];c._notifyReloadListener(g);const A=(null===(o=g.providerUserInfo)||void 0===o?void 0:o.length)?jo(g.providerUserInfo):[],P=gs(c.providerData,A),de=!!c.isAnonymous&&!(c.email&&g.passwordHash||(null==P?void 0:P.length)),le={uid:g.localId,displayName:g.displayName||null,photoURL:g.photoUrl||null,email:g.email||null,emailVerified:g.emailVerified||!1,phoneNumber:g.phoneNumber||null,tenantId:g.tenantId||null,providerData:P,metadata:new wi(g.createdAt,g.lastLoginAt),isAnonymous:de};Object.assign(c,le)})).apply(this,arguments)}function zo(){return(zo=(0,v.Z)(function*(c){const o=(0,y.m9)(c);yield pr(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function gs(c,o){return[...c.filter(l=>!o.some(p=>p.providerId===l.providerId)),...o]}function jo(c){return c.map(o=>{var{providerId:a}=o,l=(0,ue._T)(o,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function _s(){return(_s=(0,v.Z)(function*(c,o){const a=yield S(c,{},(0,v.Z)(function*(){const l=(0,y.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:g}=c.config,A=T(c,p,"/v1/token",`key=${g}`),P=yield c._getAdditionalHeaders();return P["Content-Type"]="application/x-www-form-urlencoded",Tt.fetch()(A,{method:"POST",headers:P,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Ei{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){E(o.idToken,"internal-error"),E(void 0!==o.idToken,"internal-error"),E(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Bl(c){const o=Ii(c);return E(o,"internal-error"),E(void 0!==o.exp,"internal-error"),E(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var l=this;return(0,v.Z)(function*(){return E(!l.accessToken||l.refreshToken,o,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var l=this;return(0,v.Z)(function*(){const{accessToken:p,refreshToken:g,expiresIn:A}=yield function Ou(c,o){return _s.apply(this,arguments)}(o,a);l.updateTokensAndExpiration(p,g,Number(A))})()}updateTokensAndExpiration(o,a,l){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,a){const{refreshToken:l,accessToken:p,expirationTime:g}=a,A=new Ei;return l&&(E("string"==typeof l,"internal-error",{appName:o}),A.refreshToken=l),p&&(E("string"==typeof p,"internal-error",{appName:o}),A.accessToken=p),g&&(E("number"==typeof g,"internal-error",{appName:o}),A.expirationTime=g),A}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Ei,this.toJSON())}_performRefresh(){return he("not implemented")}}function zt(c,o){E("string"==typeof c||void 0===c,"internal-error",{appName:o})}class _n{constructor(o){var{uid:a,auth:l,stsTokenManager:p}=o,g=(0,ue._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Zl(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=g.displayName||null,this.email=g.email||null,this.emailVerified=g.emailVerified||!1,this.phoneNumber=g.phoneNumber||null,this.photoURL=g.photoURL||null,this.isAnonymous=g.isAnonymous||!1,this.tenantId=g.tenantId||null,this.providerData=g.providerData?[...g.providerData]:[],this.metadata=new wi(g.createdAt||void 0,g.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,v.Z)(function*(){const l=yield gn(a,a.stsTokenManager.getToken(a.auth,o));return E(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(o){return function ms(c){return hr.apply(this,arguments)}(this,o)}reload(){return function ql(c){return zo.apply(this,arguments)}(this)}_assign(o){this!==o&&(E(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new _n(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){E(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var l=this;return(0,v.Z)(function*(){let p=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield pr(l)),yield l.auth._persistUserIfCurrent(l),p&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,v.Z)(function*(){const a=yield o.getIdToken();return yield gn(o,function x(c,o){return W.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var l,p,g,A,P,j,ne,de;const le=null!==(l=a.displayName)&&void 0!==l?l:void 0,ot=null!==(p=a.email)&&void 0!==p?p:void 0,Qt=null!==(g=a.phoneNumber)&&void 0!==g?g:void 0,Ao=null!==(A=a.photoURL)&&void 0!==A?A:void 0,Qc=null!==(P=a.tenantId)&&void 0!==P?P:void 0,qn=null!==(j=a._redirectEventId)&&void 0!==j?j:void 0,mi=null!==(ne=a.createdAt)&&void 0!==ne?ne:void 0,iu=null!==(de=a.lastLoginAt)&&void 0!==de?de:void 0,{uid:ru,emailVerified:su,isAnonymous:It,providerData:ou,stsTokenManager:au}=a;E(ru&&au,o,"internal-error");const fn=Ei.fromJSON(this.name,au);E("string"==typeof ru,o,"internal-error"),zt(le,o.name),zt(ot,o.name),E("boolean"==typeof su,o,"internal-error"),E("boolean"==typeof It,o,"internal-error"),zt(Qt,o.name),zt(Ao,o.name),zt(Qc,o.name),zt(qn,o.name),zt(mi,o.name),zt(iu,o.name);const ko=new _n({uid:ru,auth:o,email:ot,emailVerified:su,displayName:le,isAnonymous:It,photoURL:Ao,phoneNumber:Qt,tenantId:Qc,stsTokenManager:fn,createdAt:mi,lastLoginAt:iu});return ou&&Array.isArray(ou)&&(ko.providerData=ou.map(Co=>Object.assign({},Co))),qn&&(ko._redirectEventId=qn),ko}static _fromIdTokenResponse(o,a,l=!1){return(0,v.Z)(function*(){const p=new Ei;p.updateFromServerResponse(a);const g=new _n({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:l});return yield pr(g),g})()}}const An=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,v.Z)(function*(){return!0})()}_set(a,l){var p=this;return(0,v.Z)(function*(){p.storage[a]=l})()}_get(a){var l=this;return(0,v.Z)(function*(){const p=l.storage[a];return void 0===p?null:p})()}_remove(a){var l=this;return(0,v.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function yn(c,o,a){return`firebase:${c}:${o}:${a}`}class Hn{constructor(o,a,l){this.persistence=o,this.auth=a,this.userKey=l;const{config:p,name:g}=this.auth;this.fullUserKey=yn(this.userKey,p.apiKey,g),this.fullPersistenceKey=yn("persistence",p.apiKey,g),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,v.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?_n._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,v.Z)(function*(){if(a.persistence===o)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,l="authUser"){return(0,v.Z)(function*(){if(!a.length)return new Hn(We(An),o,l);const p=(yield Promise.all(a.map(function(){var ne=(0,v.Z)(function*(de){if(yield de._isAvailable())return de});return function(de){return ne.apply(this,arguments)}}()))).filter(ne=>ne);let g=p[0]||We(An);const A=yn(l,o.config.apiKey,o.name);let P=null;for(const ne of a)try{const de=yield ne._get(A);if(de){const le=_n._fromJSON(o,de);ne!==g&&(P=le),g=ne;break}}catch(de){}const j=p.filter(ne=>ne._shouldAllowMigration);return g._shouldAllowMigration&&j.length?(g=j[0],P&&(yield g._set(A,P.toJSON())),yield Promise.all(a.map(function(){var ne=(0,v.Z)(function*(de){if(de!==g)try{yield de._remove(A)}catch(le){}});return function(de){return ne.apply(this,arguments)}}())),new Hn(g,o,l)):new Hn(g,o,l)})()}}function Ko(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(vs(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Mu(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(Pu(o))return"Blackberry";if(Is(o))return"Webos";if(ys(o))return"Safari";if((o.includes("chrome/")||$o(o))&&!o.includes("edge/"))return"Chrome";if(Ti(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function Mu(c=(0,y.z$)()){return/firefox\//i.test(c)}function ys(c=(0,y.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function $o(c=(0,y.z$)()){return/crios\//i.test(c)}function vs(c=(0,y.z$)()){return/iemobile/i.test(c)}function Ti(c=(0,y.z$)()){return/android/i.test(c)}function Pu(c=(0,y.z$)()){return/blackberry/i.test(c)}function Is(c=(0,y.z$)()){return/webos/i.test(c)}function kn(c=(0,y.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function mr(c=(0,y.z$)()){return kn(c)||Ti(c)||Is(c)||Pu(c)||/windows phone/i.test(c)||vs(c)}function Lu(c,o=[]){let a;switch(c){case"Browser":a=Ko((0,y.z$)());break;case"Worker":a=`${Ko((0,y.z$)())}-${c}`;break;default:a=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${ie.SDK_VERSION}/${l}`}class Gl{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const l=g=>new Promise((A,P)=>{try{A(o(g))}catch(j){P(j)}});l.onAbort=a,this.queue.push(l);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,v.Z)(function*(){if(a.auth.currentUser===o)return;const l=[];try{for(const p of a.queue)yield p(o),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const g of l)try{g()}catch(A){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}class Fu{constructor(o,a,l){this.app=o,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Uu(this),this.idTokenSubscription=new Uu(this),this.beforeStateQueue=new Gl(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ye,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(o,a){var l=this;return a&&(this._popupRedirectResolver=We(a)),this._initializationPromise=this.queue((0,v.Z)(function*(){var p,g;if(!l._deleted&&(l.persistenceManager=yield Hn.create(l,o),!l._deleted)){if(null===(p=l._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(A){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(g=l.currentUser)||void 0===g?void 0:g.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,v.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,v.Z)(function*(){var l;const p=yield a.assertedPersistence.getCurrentUser();let g=p,A=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const P=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,j=null==g?void 0:g._redirectEventId,ne=yield a.tryRedirectSignIn(o);(!P||P===j)&&(null==ne?void 0:ne.user)&&(g=ne.user,A=!0)}if(!g)return a.directlySetCurrentUser(null);if(!g._redirectEventId){if(A)try{yield a.beforeStateQueue.runMiddleware(g)}catch(P){g=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(P))}return g?a.reloadAndSetCurrentUserOrClear(g):a.directlySetCurrentUser(null)}return E(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===g._redirectEventId?a.directlySetCurrentUser(g):a.reloadAndSetCurrentUserOrClear(g)})()}tryRedirectSignIn(o){var a=this;return(0,v.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,v.Z)(function*(){try{yield pr(o)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function $e(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,v.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,v.Z)(function*(){const l=o?(0,y.m9)(o):null;return l&&E(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(o,a=!1){var l=this;return(0,v.Z)(function*(){if(!l._deleted)return o&&E(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,v.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,v.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,v.Z)(function*(){yield a.assertedPersistence.setPersistence(We(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new y.LL("auth","Firebase",o())}onAuthStateChanged(o,a,l){return this.registerStateListener(this.authStateSubscription,o,a,l)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,l){return this.registerStateListener(this.idTokenSubscription,o,a,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var l=this;return(0,v.Z)(function*(){const p=yield l.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,v.Z)(function*(){if(!a.redirectPersistenceManager){const l=o&&We(o)||a._popupRedirectResolver;E(l,a,"argument-error"),a.redirectPersistenceManager=yield Hn.create(a,[We(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,v.Z)(function*(){var l,p;return a._isInitialized&&(yield a.queue((0,v.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,v.Z)(function*(){if(o===a.currentUser)return a.queue((0,v.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,l,p){if(this._deleted)return()=>{};const g="function"==typeof a?a:a.next.bind(a),A=this._isInitialized?Promise.resolve():this._initializationPromise;return E(A,this,"internal-error"),A.then(()=>g(this.currentUser)),"function"==typeof a?o.addObserver(a,l,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,v.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return E(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Lu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,v.Z)(function*(){var a;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(l["X-Firebase-Client"]=p),l})()}}function lt(c){return(0,y.m9)(c)}class Uu{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,y.ne)(a=>this.observer=a)}get next(){return E(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function ws(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Es(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class bi{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return he("not implemented")}_getIdTokenResponse(o){return he("not implemented")}_linkToIdToken(o,a){return he("not implemented")}_getReauthenticationResolver(o){return he("not implemented")}}function gr(c,o){return _r.apply(this,arguments)}function _r(){return(_r=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:resetPassword",G(c,o))})).apply(this,arguments)}function Ts(c,o){return bs.apply(this,arguments)}function bs(){return(bs=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function zl(c,o){return Yn.apply(this,arguments)}function Yn(){return(Yn=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:update",G(c,o))})).apply(this,arguments)}function xs(){return(xs=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithPassword",G(c,o))})).apply(this,arguments)}function yr(c,o){return xi.apply(this,arguments)}function xi(){return(xi=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:sendOobCode",G(c,o))})).apply(this,arguments)}function jl(c,o){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,v.Z)(function*(c,o){return yr(c,o)})).apply(this,arguments)}function Ai(c,o){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,v.Z)(function*(c,o){return yr(c,o)})).apply(this,arguments)}function Kl(c,o){return vn.apply(this,arguments)}function vn(){return(vn=(0,v.Z)(function*(c,o){return yr(c,o)})).apply(this,arguments)}function Zu(c,o){return ki.apply(this,arguments)}function ki(){return(ki=(0,v.Z)(function*(c,o){return yr(c,o)})).apply(this,arguments)}function Qn(){return(Qn=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithEmailLink",G(c,o))})).apply(this,arguments)}function mt(){return(mt=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithEmailLink",G(c,o))})).apply(this,arguments)}class Ci extends bi{constructor(o,a,l,p=null){super("password",l),this._email=o,this._password=a,this._tenantId=p}static _fromEmailAndPassword(o,a){return new Ci(o,a,"password")}static _fromEmailAndCode(o,a,l=null){return new Ci(o,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,v.Z)(function*(){switch(a.signInMethod){case"password":return function Bu(c,o){return xs.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function qu(c,o){return Qn.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:Ae(o,"internal-error")}})()}_linkToIdToken(o,a){var l=this;return(0,v.Z)(function*(){switch(l.signInMethod){case"password":return Ts(o,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function Gu(c,o){return mt.apply(this,arguments)}(o,{idToken:a,email:l._email,oobCode:l._password});default:Ae(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function Pt(c,o){return Si.apply(this,arguments)}function Si(){return(Si=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithIdp",G(c,o))})).apply(this,arguments)}class qt extends bi{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new qt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):Ae("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p}=a,g=(0,ue._T)(a,["providerId","signInMethod"]);if(!l||!p)return null;const A=new qt(l,p);return A.idToken=g.idToken||void 0,A.accessToken=g.accessToken||void 0,A.secret=g.secret,A.nonce=g.nonce,A.pendingToken=g.pendingToken||null,A}_getIdTokenResponse(o){return Pt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,Pt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Pt(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,y.xO)(a)}return o}}function zu(c,o){return As.apply(this,arguments)}function As(){return(As=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:sendVerificationCode",G(c,o))})).apply(this,arguments)}function Ir(){return(Ir=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithPhoneNumber",G(c,o))})).apply(this,arguments)}function wr(){return(wr=(0,v.Z)(function*(c,o){const a=yield w(c,"POST","/v1/accounts:signInWithPhoneNumber",G(c,o));if(a.temporaryProof)throw b(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const ks={USER_NOT_FOUND:"user-not-found"};function Cs(){return(Cs=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithPhoneNumber",G(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),ks)})).apply(this,arguments)}class Jn extends bi{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Jn({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Jn({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function vr(c,o){return Ir.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function ea(c,o){return wr.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function Er(c,o){return Cs.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:l,verificationCode:p}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:l,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:g}=o;return l||a||p||g?new Jn({verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:g}):null}}class Xn{constructor(o){var a,l,p,g,A,P;const j=(0,y.zd)((0,y.pd)(o)),ne=null!==(a=j.apiKey)&&void 0!==a?a:null,de=null!==(l=j.oobCode)&&void 0!==l?l:null,le=function ta(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=j.mode)&&void 0!==p?p:null);E(ne&&de&&le,"argument-error"),this.apiKey=ne,this.operation=le,this.code=de,this.continueUrl=null!==(g=j.continueUrl)&&void 0!==g?g:null,this.languageCode=null!==(A=j.languageCode)&&void 0!==A?A:null,this.tenantId=null!==(P=j.tenantId)&&void 0!==P?P:null}static parseLink(o){const a=function Ss(c){const o=(0,y.zd)((0,y.pd)(c)).link,a=o?(0,y.zd)((0,y.pd)(o)).deep_link_id:null,l=(0,y.zd)((0,y.pd)(c)).deep_link_id;return(l?(0,y.zd)((0,y.pd)(l)).link:null)||l||a||o||c}(o);try{return new Xn(a)}catch(l){return null}}}let Ds=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return Ci._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const p=Xn.parseLink(l);return E(p,"argument-error"),Ci._fromEmailAndCode(a,p.code,p.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Xt{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Di extends Xt{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class en extends Di{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return E("providerId"in a&&"signInMethod"in a,"argument-error"),qt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return E(o.idToken||o.accessToken,"argument-error"),qt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return en.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return en.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:l,oauthTokenSecret:p,pendingToken:g,nonce:A,providerId:P}=o;if(!l&&!p&&!a&&!g||!P)return null;try{return new en(P)._credential({idToken:a,accessToken:l,nonce:A,pendingToken:g})}catch(j){return null}}}let na=(()=>{class c extends Di{constructor(){super("facebook.com")}static credential(a){return qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),Tr=(()=>{class c extends Di{constructor(){super("google.com"),this.addScope("profile")}static credential(a,l){return qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:l,oauthAccessToken:p}=a;if(!l&&!p)return null;try{return c.credential(l,p)}catch(g){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),Ri=(()=>{class c extends Di{constructor(){super("github.com")}static credential(a){return qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class Cn extends bi{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return Pt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,Pt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Pt(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p,pendingToken:g}=a;return l&&p&&g&&l===p?new Cn(l,g):null}static _create(o,a){return new Cn(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Rs extends Xt{constructor(o){E(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Rs.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Rs.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=Cn.fromJSON(o);return E(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:l}=o;if(!a||!l)return null;try{return Cn._create(l,a)}catch(p){return null}}}let ia=(()=>{class c extends Di{constructor(){super("twitter.com")}static credential(a,l){return qt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=a;if(!l||!p)return null;try{return c.credential(l,p)}catch(g){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function ra(c,o){return sa.apply(this,arguments)}function sa(){return(sa=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signUp",G(c,o))})).apply(this,arguments)}class ht{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,l,p=!1){return(0,v.Z)(function*(){const g=yield _n._fromIdTokenResponse(o,l,p),A=tn(l);return new ht({user:g,providerId:A,_tokenResponse:l,operationType:a})})()}static _forOperation(o,a,l){return(0,v.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const p=tn(l);return new ht({user:o,providerId:p,_tokenResponse:l,operationType:a})})()}}function tn(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function Oi(){return(Oi=(0,v.Z)(function*(c){var o;const a=lt(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new ht({user:a.currentUser,providerId:null,operationType:"signIn"});const l=yield ra(a,{returnSecureToken:!0}),p=yield ht._fromIdTokenResponse(a,"signIn",l,!0);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class br extends y.ZR{constructor(o,a,l,p){var g;super(a.code,a.message),this.operationType=l,this.user=p,Object.setPrototypeOf(this,br.prototype),this.customData={appName:o.name,tenantId:null!==(g=o.tenantId)&&void 0!==g?g:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,a,l,p){return new br(o,a,l,p)}}function qe(c,o,a,l){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(g=>{throw"auth/multi-factor-auth-required"===g.code?br._fromErrorAndOperation(c,g,o,l):g})}function xr(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function ti(){return(ti=(0,v.Z)(function*(c,o){const a=(0,y.m9)(c);yield Ms(!0,a,o);const{providerUserInfo:l}=yield te(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),p=xr(l||[]);return a.providerData=a.providerData.filter(g=>p.has(g.providerId)),p.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function oa(c,o){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,v.Z)(function*(c,o,a=!1){const l=yield gn(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return ht._forOperation(c,"link",l)})).apply(this,arguments)}function Ms(c,o,a){return aa.apply(this,arguments)}function aa(){return(aa=(0,v.Z)(function*(c,o,a){yield pr(o);const p=!1===c?"provider-already-linked":"no-such-provider";E(xr(o.providerData).has(a)===c,o.auth,p)})).apply(this,arguments)}function ju(c,o){return ua.apply(this,arguments)}function ua(){return(ua=(0,v.Z)(function*(c,o,a=!1){const{auth:l}=c,p="reauthenticate";try{const g=yield gn(c,qe(l,p,o,c),a);E(g.idToken,l,"internal-error");const A=Ii(g.idToken);E(A,l,"internal-error");const{sub:P}=A;return E(c.uid===P,l,"user-mismatch"),ht._forOperation(c,p,g)}catch(g){throw"auth/user-not-found"===(null==g?void 0:g.code)&&Ae(l,"user-mismatch"),g}})).apply(this,arguments)}function Ni(c,o){return nn.apply(this,arguments)}function nn(){return(nn=(0,v.Z)(function*(c,o,a=!1){const l="signIn",p=yield qe(c,l,o),g=yield ht._fromIdTokenResponse(c,l,p);return a||(yield c._updateCurrentUser(g.user)),g})).apply(this,arguments)}function kr(c,o){return Ps.apply(this,arguments)}function Ps(){return(Ps=(0,v.Z)(function*(c,o){return Ni(lt(c),o)})).apply(this,arguments)}function ca(c,o){return Sn.apply(this,arguments)}function Sn(){return(Sn=(0,v.Z)(function*(c,o){const a=(0,y.m9)(c);return yield Ms(!1,a,o.providerId),oa(a,o)})).apply(this,arguments)}function Ku(c,o){return la.apply(this,arguments)}function la(){return(la=(0,v.Z)(function*(c,o){return ju((0,y.m9)(c),o)})).apply(this,arguments)}function $u(c,o){return ha.apply(this,arguments)}function ha(){return(ha=(0,v.Z)(function*(c,o){return w(c,"POST","/v1/accounts:signInWithCustomToken",G(c,o))})).apply(this,arguments)}function Ls(){return(Ls=(0,v.Z)(function*(c,o){const a=lt(c),l=yield $u(a,{token:o,returnSecureToken:!0}),p=yield ht._fromIdTokenResponse(a,"signIn",l);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class Mi{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?Cr._fromServerResponse(o,a):Ae(o,"internal-error")}}class Cr extends Mi{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new Cr(a)}}function Sr(c,o,a){var l;E((null===(l=a.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),E(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(E(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(E(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function Dr(){return(Dr=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c),p={requestType:"PASSWORD_RESET",email:o};a&&Sr(l,p,a),yield Ai(l,p)})).apply(this,arguments)}function da(){return(da=(0,v.Z)(function*(c,o,a){yield gr((0,y.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function Pi(){return(Pi=(0,v.Z)(function*(c,o){yield zl((0,y.m9)(c),{oobCode:o})})).apply(this,arguments)}function Li(c,o){return Fi.apply(this,arguments)}function Fi(){return(Fi=(0,v.Z)(function*(c,o){const a=(0,y.m9)(c),l=yield gr(a,{oobCode:o}),p=l.requestType;switch(E(p,a,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":E(l.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":E(l.mfaInfo,a,"internal-error");default:E(l.email,a,"internal-error")}let g=null;return l.mfaInfo&&(g=Mi._fromServerResponse(lt(a),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:g},operation:p}})).apply(this,arguments)}function Fs(){return(Fs=(0,v.Z)(function*(c,o){const{data:a}=yield Li((0,y.m9)(c),o);return a.email})).apply(this,arguments)}function ni(){return(ni=(0,v.Z)(function*(c,o,a){const l=lt(c),p=yield ra(l,{returnSecureToken:!0,email:o,password:a}),g=yield ht._fromIdTokenResponse(l,"signIn",p);return yield l._updateCurrentUser(g.user),g})).apply(this,arguments)}function Us(){return(Us=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c),p={requestType:"EMAIL_SIGNIN",email:o};E(a.handleCodeInApp,l,"argument-error"),a&&Sr(l,p,a),yield Kl(l,p)})).apply(this,arguments)}function pa(){return(pa=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c),p=Ds.credentialWithLink(o,a||ft());return E(p._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),kr(l,p)})).apply(this,arguments)}function Qu(c,o){return Vs.apply(this,arguments)}function Vs(){return(Vs=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:createAuthUri",G(c,o))})).apply(this,arguments)}function Ui(){return(Ui=(0,v.Z)(function*(c,o){const l={identifier:o,continueUri:Zt()?ft():"http://localhost"},{signinMethods:p}=yield Qu((0,y.m9)(c),l);return p||[]})).apply(this,arguments)}function jt(){return(jt=(0,v.Z)(function*(c,o){const a=(0,y.m9)(c),p={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&Sr(a.auth,p,o);const{email:g}=yield jl(a.auth,p);g!==c.email&&(yield c.reload())})).apply(this,arguments)}function Bs(){return(Bs=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c),g={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&Sr(l.auth,g,a);const{email:A}=yield Zu(l.auth,g);A!==c.email&&(yield c.reload())})).apply(this,arguments)}function ma(c,o){return ii.apply(this,arguments)}function ii(){return(ii=(0,v.Z)(function*(c,o){return $(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Or(){return(Or=(0,v.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const l=(0,y.m9)(c),g={idToken:yield l.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},A=yield gn(l,ma(l.auth,g));l.displayName=A.displayName||null,l.photoURL=A.photoUrl||null;const P=l.providerData.find(({providerId:j})=>"password"===j);P&&(P.displayName=l.displayName,P.photoURL=l.photoURL),yield l._updateTokensIfNecessary(A)})).apply(this,arguments)}function Nr(c,o,a){return ga.apply(this,arguments)}function ga(){return(ga=(0,v.Z)(function*(c,o,a){const{auth:l}=c,g={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(g.email=o),a&&(g.password=a);const A=yield gn(c,Ts(l,g));yield c._updateTokensIfNecessary(A,!0)})).apply(this,arguments)}class rn{constructor(o,a,l={}){this.isNewUser=o,this.providerId=a,this.profile=l}}class _a extends rn{constructor(o,a,l,p){super(o,a,l),this.username=p}}class rc extends rn{constructor(o,a){super(o,"facebook.com",a)}}class ya extends _a{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class va extends rn{constructor(o,a){super(o,"google.com",a)}}class sc extends _a{constructor(o,a,l){super(o,"twitter.com",a,l)}}function qs(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function ic(c){var o,a;if(!c)return null;const{providerId:l}=c,p=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},g=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&(null==c?void 0:c.idToken)){const A=null===(a=null===(o=Ii(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(A)return new rn(g,"anonymous"!==A&&"custom"!==A?A:null)}if(!l)return null;switch(l){case"facebook.com":return new rc(g,p);case"github.com":return new ya(g,p);case"google.com":return new va(g,p);case"twitter.com":return new sc(g,p,c.screenName||null);case"custom":case"anonymous":return new rn(g,null);default:return new rn(g,l,p)}}(a)}class Dn{constructor(o,a,l){this.type=o,this.credential=a,this.auth=l}static _fromIdtoken(o,a){return new Dn("enroll",o,a)}static _fromMfaPendingCredential(o){return new Dn("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,l;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return Dn._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(l=o.multiFactorSession)||void 0===l?void 0:l.idToken)return Dn._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Gs{constructor(o,a,l){this.session=o,this.hints=a,this.signInResolver=l}static _fromError(o,a){const l=lt(o),p=a.customData._serverResponse,g=(p.mfaInfo||[]).map(P=>Mi._fromServerResponse(l,P));E(p.mfaPendingCredential,l,"internal-error");const A=Dn._fromMfaPendingCredential(p.mfaPendingCredential);return new Gs(A,g,function(){var P=(0,v.Z)(function*(j){const ne=yield j._process(l,A);delete p.mfaInfo,delete p.mfaPendingCredential;const de=Object.assign(Object.assign({},p),{idToken:ne.idToken,refreshToken:ne.refreshToken});switch(a.operationType){case"signIn":const le=yield ht._fromIdTokenResponse(l,a.operationType,de);return yield l._updateCurrentUser(le.user),le;case"reauthenticate":return E(a.user,l,"internal-error"),ht._forOperation(a.user,a.operationType,de);default:Ae(l,"internal-error")}});return function(j){return P.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,v.Z)(function*(){return a.signInResolver(o)})()}}function oh(c,o){return $(c,"POST","/v2/accounts/mfaEnrollment:start",G(c,o))}class Ea{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(l=>Mi._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new Ea(o)}getSession(){var o=this;return(0,v.Z)(function*(){return Dn._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var l=this;return(0,v.Z)(function*(){const p=o,g=yield l.getSession(),A=yield gn(l.user,p._process(l.user.auth,g,a));return yield l.user._updateTokensIfNecessary(A),l.user.reload()})()}unenroll(o){var a=this;return(0,v.Z)(function*(){const l="string"==typeof o?o:o.uid,p=yield a.user.getIdToken(),g=yield gn(a.user,function wa(c,o){return $(c,"POST","/v2/accounts/mfaEnrollment:withdraw",G(c,o))}(a.user.auth,{idToken:p,mfaEnrollmentId:l}));a.enrolledFactors=a.enrolledFactors.filter(({uid:A})=>A!==l),yield a.user._updateTokensIfNecessary(g);try{yield a.user.reload()}catch(A){if("auth/user-token-expired"!==(null==A?void 0:A.code))throw A}})()}}const Ta=new WeakMap,Ws="__sak";class Mr{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Ws,"1"),this.storage.removeItem(Ws),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Kt=(()=>{class c extends Mr{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function uh(){const c=(0,y.z$)();return ys(c)||kn(c)}()&&function Yo(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=mr(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),g=this.localCache[l];p!==g&&a(l,g,p)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((P,j,ne)=>{this.notifyListeners(P,ne)});const p=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const P=this.storage.getItem(p);if(a.newValue!==P)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!l)return}const g=()=>{const P=this.storage.getItem(p);!l&&this.localCache[p]===P||this.notifyListeners(p,P)},A=this.storage.getItem(p);!function pt(){return(0,y.w1)()&&10===document.documentMode}()||A===a.newValue||a.newValue===a.oldValue?g():setTimeout(g,10)}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const g of Array.from(p))g(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var p=()=>super._set,g=this;return(0,v.Z)(function*(){yield p().call(g,a,l),g.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,p=this;return(0,v.Z)(function*(){const g=yield l().call(p,a);return p.localCache[a]=JSON.stringify(g),g})()}_remove(a){var l=()=>super._remove,p=this;return(0,v.Z)(function*(){yield l().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),Rn=(()=>{class c extends Mr{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let it=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(g=>g.isListeningto(a));if(l)return l;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,v.Z)(function*(){const p=a,{eventId:g,eventType:A,data:P}=p.data,j=l.handlersMap[A];if(!(null==j?void 0:j.size))return;p.ports[0].postMessage({status:"ack",eventId:g,eventType:A});const ne=Array.from(j).map(function(){var le=(0,v.Z)(function*(ot){return ot(p.origin,P)});return function(ot){return le.apply(this,arguments)}}()),de=yield function Z(c){return Promise.all(c.map(function(){var o=(0,v.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return o.apply(this,arguments)}}()))}(ne);p.ports[0].postMessage({status:"done",eventId:g,eventType:A,response:de})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function $t(c="",o=10){let a="";for(let l=0;l<o;l++)a+=Math.floor(10*Math.random());return c+a}class ba{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,l=50){var p=this;return(0,v.Z)(function*(){const g="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!g)throw new Error("connection_unavailable");let A,P;return new Promise((j,ne)=>{const de=$t("",20);g.port1.start();const le=setTimeout(()=>{ne(new Error("unsupported_event"))},l);P={messageChannel:g,onMessage(ot){const Qt=ot;if(Qt.data.eventId===de)switch(Qt.data.status){case"ack":clearTimeout(le),A=setTimeout(()=>{ne(new Error("timeout"))},3e3);break;case"done":clearTimeout(A),j(Qt.data.response);break;default:clearTimeout(le),clearTimeout(A),ne(new Error("invalid_response"))}}},p.handlers.add(P),g.port1.addEventListener("message",P.onMessage),p.target.postMessage({eventType:o,eventId:de,data:a},[g.port2])}).finally(()=>{P&&p.removeMessageHandler(P)})})()}}function K(){return window}function xa(){return void 0!==K().WorkerGlobalScope&&"function"==typeof K().importScripts}function N(){return(N=(0,v.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const Aa="firebaseLocalStorageDb",zs="firebaseLocalStorage",lc="fbase_key";class Lr{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function js(c,o){return c.transaction([zs],o?"readwrite":"readonly").objectStore(zs)}function ka(){const c=indexedDB.open(Aa,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(zs,{keyPath:lc})}catch(p){a(p)}}),c.addEventListener("success",(0,v.Z)(function*(){const l=c.result;l.objectStoreNames.contains(zs)?o(l):(l.close(),yield function hc(){const c=indexedDB.deleteDatabase(Aa);return new Lr(c).toPromise()}(),o(yield ka()))}))})}function lh(c,o,a){return Ca.apply(this,arguments)}function Ca(){return(Ca=(0,v.Z)(function*(c,o,a){const l=js(c,!0).put({[lc]:o,value:a});return new Lr(l).toPromise()})).apply(this,arguments)}function pe(){return(pe=(0,v.Z)(function*(c,o){const a=js(c,!1).get(o),l=yield new Lr(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function si(c,o){const a=js(c,!0).delete(o);return new Lr(a).toPromise()}const sn=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,v.Z)(function*(){return a.db||(a.db=yield ka()),a.db})()}_withRetries(a){var l=this;return(0,v.Z)(function*(){let p=0;for(;;)try{const g=yield l._openDb();return yield a(g)}catch(g){if(p++>3)throw g;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,v.Z)(function*(){return xa()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,v.Z)(function*(){a.receiver=it._getInstance(function at(){return xa()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,v.Z)(function*(p,g){return{keyProcessed:(yield a._poll()).includes(g.key)}});return function(p,g){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,v.Z)(function*(p,g){return["keyChanged"]});return function(p,g){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,v.Z)(function*(){var l,p;if(a.activeServiceWorker=yield function Q(){return N.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new ba(a.activeServiceWorker);const g=yield a.sender._send("ping",{},800);!g||(null===(l=g[0])||void 0===l?void 0:l.fulfilled)&&(null===(p=g[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,v.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function V(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,v.Z)(function*(){try{if(!indexedDB)return!1;const a=yield ka();return yield lh(a,Ws,"1"),yield si(a,Ws),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,v.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var p=this;return(0,v.Z)(function*(){return p._withPendingWrite((0,v.Z)(function*(){return yield p._withRetries(g=>lh(g,a,l)),p.localCache[a]=l,p.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,v.Z)(function*(){const p=yield l._withRetries(g=>function dc(c,o){return pe.apply(this,arguments)}(g,a));return l.localCache[a]=p,p})()}_remove(a){var l=this;return(0,v.Z)(function*(){return l._withPendingWrite((0,v.Z)(function*(){return yield l._withRetries(p=>si(p,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,v.Z)(function*(){const l=yield a._withRetries(A=>{const P=js(A,!1).getAll();return new Lr(P).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const p=[],g=new Set;for(const{fbase_key:A,value:P}of l)g.add(A),JSON.stringify(a.localCache[A])!==JSON.stringify(P)&&(a.notifyListeners(A,P),p.push(A));for(const A of Object.keys(a.localCache))a.localCache[A]&&!g.has(A)&&(a.notifyListeners(A,null),p.push(A));return p})()}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const g of Array.from(p))g(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,v.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Ne(c,o){return $(c,"POST","/v2/accounts/mfaSignIn:start",G(c,o))}function H(){return(H=(0,v.Z)(function*(c){return(yield $(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function $s(c){return new Promise((o,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=p=>{const g=Ie("internal-error");g.customData=p,a(g)},l.type="text/javascript",l.charset="UTF-8",function Ks(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function On(c){return`__${c}${Math.floor(1e6*Math.random())}`}const Ys=1e12;class Fr{constructor(o){this.auth=o,this.counter=Ys,this._widgets=new Map}render(o,a){const l=this.counter;return this._widgets.set(l,new pc(o,this.auth.name,a||{})),this.counter++,l}reset(o){var a;const l=o||Ys;null===(a=this._widgets.get(l))||void 0===a||a.delete(),this._widgets.delete(l)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Ys))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,v.Z)(function*(){var l;return null===(l=a._widgets.get(o||Ys))||void 0===l||l.execute(),""})()}}class pc{constructor(o,a,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;E(p,"argument-error",{appName:a}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function mc(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(l){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(l){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const xt=On("rcb"),Sa=new Je(3e4,6e4);class _c{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=K().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return E(function Nn(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(K().grecaptcha):new Promise((l,p)=>{const g=K().setTimeout(()=>{p(Ie(o,"network-request-failed"))},Sa.get());K()[xt]=()=>{K().clearTimeout(g),delete K()[xt];const P=K().grecaptcha;if(!P)return void p(Ie(o,"internal-error"));const j=P.render;P.render=(ne,de)=>{const le=j(ne,de);return this.counter++,le},this.hostLanguage=a,l(P)},$s(`https://www.google.com/recaptcha/api.js??${(0,y.xO)({onload:xt,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(g),p(Ie(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=K().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Da{load(o){return(0,v.Z)(function*(){return new Fr(o)})()}clearedOneInstance(){}}const D="recaptcha",Qs={theme:"light",type:"image"};class Ht{constructor(o,a=Object.assign({},Qs),l){this.parameters=a,this.type=D,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=lt(l),this.isInvisible="invisible"===this.parameters.size,E("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;E(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Da:new _c,this.validateStartingState()}verify(){var o=this;return(0,v.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(a)||new Promise(g=>{const A=P=>{!P||(o.tokenChangeListeners.delete(A),g(P))};o.tokenChangeListeners.add(A),o.isInvisible&&l.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){E(!this.parameters.sitekey,this.auth,"argument-error"),E(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),E("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(l=>l(a)),"function"==typeof o)o(a);else if("string"==typeof o){const l=K()[o];"function"==typeof l&&l(a)}}}assertNotDestroyed(){E(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,v.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const l=document.createElement("div");a.appendChild(l),a=l}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,v.Z)(function*(){E(Zt()&&!xa(),o.auth,"internal-error"),yield function fh(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function et(c){return H.apply(this,arguments)}(o.auth);E(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return E(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class oi{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Jn._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Ra(){return(Ra=(0,v.Z)(function*(c,o,a){const l=lt(c),p=yield Xs(l,o,(0,y.m9)(a));return new oi(p,g=>kr(l,g))})).apply(this,arguments)}function Js(){return(Js=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c);yield Ms(!1,l,"phone");const p=yield Xs(l.auth,o,(0,y.m9)(a));return new oi(p,g=>ca(l,g))})).apply(this,arguments)}function Na(){return(Na=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c),p=yield Xs(l.auth,o,(0,y.m9)(a));return new oi(p,g=>Ku(l,g))})).apply(this,arguments)}function Xs(c,o,a){return At.apply(this,arguments)}function At(){return(At=(0,v.Z)(function*(c,o,a){var l;const p=yield a.verify();try{let g;if(E("string"==typeof p,c,"argument-error"),E(a.type===D,c,"argument-error"),g="string"==typeof o?{phoneNumber:o}:o,"session"in g){const A=g.session;if("phoneNumber"in g)return E("enroll"===A.type,c,"internal-error"),(yield oh(c,{idToken:A.credential,phoneEnrollmentInfo:{phoneNumber:g.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{E("signin"===A.type,c,"internal-error");const P=(null===(l=g.multiFactorHint)||void 0===l?void 0:l.uid)||g.multiFactorUid;return E(P,c,"missing-multi-factor-info"),(yield Ne(c,{mfaPendingCredential:A.credential,mfaEnrollmentId:P,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:A}=yield zu(c,{phoneNumber:g.phoneNumber,recaptchaToken:p});return A}}finally{a._reset()}})).apply(this,arguments)}function on(){return(on=(0,v.Z)(function*(c,o){yield oa((0,y.m9)(c),o)})).apply(this,arguments)}let Bi=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=lt(a)}verifyPhoneNumber(a,l){return Xs(this.auth,a,(0,y.m9)(l))}static credential(a,l){return Jn._fromVerification(a,l)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:l,temporaryProof:p}=a;return l&&p?Jn._fromTokenResponse(l,p):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function Lt(c,o){return o?We(o):(E(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class eo extends bi{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return Pt(o,this._buildIdpRequest())}_linkToIdToken(o,a){return Pt(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return Pt(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Ur(c){return Ni(c.auth,new eo(c),c.bypassAuthState)}function Vr(c){const{auth:o,user:a}=c;return E(a,o,"internal-error"),ju(a,new eo(c),c.bypassAuthState)}function yc(c){return Ma.apply(this,arguments)}function Ma(){return(Ma=(0,v.Z)(function*(c){const{auth:o,user:a}=c;return E(a,o,"internal-error"),oa(a,new eo(c),c.bypassAuthState)})).apply(this,arguments)}class rt{constructor(o,a,l,p,g=!1){this.auth=o,this.resolver=l,this.user=p,this.bypassAuthState=g,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,v.Z)(function*(l,p){o.pendingPromise={resolve:l,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(g){o.reject(g)}});return function(l,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,v.Z)(function*(){const{urlResponse:l,sessionId:p,postBody:g,tenantId:A,error:P,type:j}=o;if(P)return void a.reject(P);const ne={auth:a.auth,requestUri:l,sessionId:p,tenantId:A||void 0,postBody:g||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(j)(ne))}catch(de){a.reject(de)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Ur;case"linkViaPopup":case"linkViaRedirect":return yc;case"reauthViaPopup":case"reauthViaRedirect":return Vr;default:Ae(this.auth,"internal-error")}}resolve(o){ee(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){ee(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const mh=new Je(2e3,1e4);function je(){return(je=(0,v.Z)(function*(c,o,a){const l=lt(c);Ve(c,o,Xt);const p=Lt(l,a);return new an(l,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function Br(){return(Br=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c);Ve(l.auth,o,Xt);const p=Lt(l.auth,a);return new an(l.auth,"reauthViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}function ci(){return(ci=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c);Ve(l.auth,o,Xt);const p=Lt(l.auth,a);return new an(l.auth,"linkViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}let an=(()=>{class c extends rt{constructor(a,l,p,g,A){super(a,l,g,A),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,v.Z)(function*(){const l=yield a.execute();return E(l,a.auth,"internal-error"),l})()}onExecution(){var a=this;return(0,v.Z)(function*(){ee(1===a.filter.length,"Popup operations only handle one event");const l=$t();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],l),a.authWindow.associatedEvent=l,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(Ie(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Ie(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var l,p;this.pollId=(null===(p=null===(l=this.authWindow)||void 0===l?void 0:l.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(Ie(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,mh.get())};a()}}return c.currentPopupAction=null,c})();const Yt=new Map;class un extends rt{constructor(o,a,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,v.Z)(function*(){let l=Yt.get(a.auth._key());if(!l){try{const g=(yield function Zr(c,o){return cn.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;l=()=>Promise.resolve(g)}catch(p){l=()=>Promise.reject(p)}Yt.set(a.auth._key(),l)}return a.bypassAuthState||Yt.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,l=this;return(0,v.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(l,o);if("unknown"!==o.type){if(o.eventId){const p=yield l.auth._redirectUserForId(o.eventId);if(p)return l.user=p,a().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,v.Z)(function*(){})()}cleanUp(){}}function cn(){return(cn=(0,v.Z)(function*(c,o){const a=Zi(o),l=io(c);if(!(yield l._isAvailable()))return!1;const p="true"===(yield l._get(a));return yield l._remove(a),p})).apply(this,arguments)}function no(c,o){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,v.Z)(function*(c,o){return io(c)._set(Zi(o),"true")})).apply(this,arguments)}function In(c,o){Yt.set(c._key(),o)}function io(c){return We(c._redirectPersistence)}function Zi(c){return yn("pendingRedirect",c.config.apiKey,c.name)}function qi(){return(qi=(0,v.Z)(function*(c,o,a){const l=lt(c);Ve(c,o,Xt);const p=Lt(l,a);return yield no(p,l),p._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function La(){return(La=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c);Ve(l.auth,o,Xt);const p=Lt(l.auth,a);yield no(p,l.auth);const g=yield ke(l);return p._openRedirect(l.auth,o,"reauthViaRedirect",g)})).apply(this,arguments)}function ro(){return(ro=(0,v.Z)(function*(c,o,a){const l=(0,y.m9)(c);Ve(l.auth,o,Xt);const p=Lt(l.auth,a);yield Ms(!1,l,o.providerId),yield no(p,l.auth);const g=yield ke(l);return p._openRedirect(l.auth,o,"linkViaRedirect",g)})).apply(this,arguments)}function so(){return(so=(0,v.Z)(function*(c,o){return yield lt(c)._initializationPromise,Gr(c,o,!1)})).apply(this,arguments)}function Gr(c,o){return oo.apply(this,arguments)}function oo(){return(oo=(0,v.Z)(function*(c,o,a=!1){const l=lt(c),p=Lt(l,o),A=yield new un(l,p,a).execute();return A&&!a&&(delete A.user._redirectEventId,yield l._persistUserIfCurrent(A.user),yield l._setRedirectUser(null,o)),A})).apply(this,arguments)}function ke(c){return Le.apply(this,arguments)}function Le(){return(Le=(0,v.Z)(function*(c){const o=$t(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class ao{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(a=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function bc(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Ua(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var l;if(o.error&&!Ua(o)){const p=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(Ie(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const l=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Fa(o))}saveEventToCache(o){this.cachedEventUids.add(Fa(o)),this.lastProcessedEventTime=Date.now()}}function Fa(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function Ua({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Va(c){return uo.apply(this,arguments)}function uo(){return(uo=(0,v.Z)(function*(c,o={}){return $(c,"GET","/v1/projects",o)})).apply(this,arguments)}const xc=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_h=/^https?/;function Ba(){return(Ba=(0,v.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Va(c);for(const a of o)try{if(Ac(a))return}catch(l){}Ae(c,"unauthorized-domain")})).apply(this,arguments)}function Ac(c){const o=ft(),{protocol:a,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const A=new URL(c);return""===A.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&A.hostname===l}if(!_h.test(a))return!1;if(xc.test(c))return l===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(l)}const vh=new Je(3e4,6e4);function Za(){const c=K().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let co=null;function Wi(c){return co=co||function Ih(c){return new Promise((o,a)=>{var l,p,g;function A(){Za(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{Za(),a(Ie(c,"network-request-failed"))},timeout:vh.get()})}if(null===(p=null===(l=K().gapi)||void 0===l?void 0:l.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(g=K().gapi)||void 0===g?void 0:g.load)){const P=On("iframefcb");return K()[P]=()=>{gapi.load?A():a(Ie(c,"network-request-failed"))},$s(`https://apis.google.com/js/api.js?onload=${P}`).catch(j=>a(j))}A()}}).catch(o=>{throw co=null,o})}(c),co}const wh=new Je(5e3,15e3),gt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Be=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function kc(c){const o=c.config;E(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Oe(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:o.apiKey,appName:c.name,v:ie.SDK_VERSION},p=Be.get(c.config.apiHost);p&&(l.eid=p);const g=c._getFrameworks();return g.length&&(l.fw=g.join(",")),`${a}?${(0,y.xO)(l).slice(1)}`}function kt(){return kt=(0,v.Z)(function*(c){const o=yield Wi(c),a=K().gapi;return E(a,c,"internal-error"),o.open({where:document.body,url:kc(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:gt,dontclear:!0},l=>new Promise(function(){var p=(0,v.Z)(function*(g,A){yield l.restyle({setHideOnLeave:!1});const P=Ie(c,"network-request-failed"),j=K().setTimeout(()=>{A(P)},wh.get());function ne(){K().clearTimeout(j),g(l)}l.ping(ne).then(ne,()=>{A(P)})});return function(g,A){return p.apply(this,arguments)}}()))}),kt.apply(this,arguments)}const _t={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Un{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function po(c,o,a,l,p,g){E(c.config.authDomain,c,"auth-domain-config-required"),E(c.config.apiKey,c,"invalid-api-key");const A={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:ie.SDK_VERSION,eventId:p};if(o instanceof Xt){o.setDefaultLanguage(c.languageCode),A.providerId=o.providerId||"",(0,y.xb)(o.getCustomParameters())||(A.customParameters=JSON.stringify(o.getCustomParameters()));for(const[j,ne]of Object.entries(g||{}))A[j]=ne}if(o instanceof Di){const j=o.getScopes().filter(ne=>""!==ne);j.length>0&&(A.scopes=j.join(","))}c.tenantId&&(A.tid=c.tenantId);const P=A;for(const j of Object.keys(P))void 0===P[j]&&delete P[j];return`${function wn({config:c}){return c.emulator?Oe(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,y.xO)(P).slice(1)}`}const mo="webStorageSupport";class Ki extends class Wa{constructor(o){this.factorId=o}_process(o,a,l){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,l);case"signin":return this._finalizeSignIn(o,a.credential);default:return he("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new Ki(o)}_finalizeEnroll(o,a,l){return function ah(c,o){return $(c,"POST","/v2/accounts/mfaEnrollment:finalize",G(c,o))}(o,{idToken:a,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function hh(c,o){return $(c,"POST","/v2/accounts/mfaSignIn:finalize",G(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let za=(()=>{class c{constructor(){}static assertion(a){return Ki._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var Vn="@firebase/auth";class ja{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,v.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(l=>{o((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){E(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function li(){return window}function yo(){return(yo=(0,v.Z)(function*(c,o,a){var l;const{BuildInfo:p}=li();ee(o.sessionId,"AuthEvent did not contain a session ID");const g=yield Pc(o.sessionId),A={};return kn()?A.ibi=p.packageName:Ti()?A.apn=p.packageName:Ae(c,"operation-not-supported-in-this-environment"),p.displayName&&(A.appDisplayName=p.displayName),A.sessionId=g,po(c,a,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,A)})).apply(this,arguments)}function $a(){return($a=(0,v.Z)(function*(c){const{BuildInfo:o}=li(),a={};kn()?a.iosBundleId=o.packageName:Ti()?a.androidPackageName=o.packageName:Ae(c,"operation-not-supported-in-this-environment"),yield Va(c,a)})).apply(this,arguments)}function Bn(){return(Bn=(0,v.Z)(function*(c,o,a){const{cordova:l}=li();let p=()=>{};try{yield new Promise((g,A)=>{let P=null;function j(){var le;g();const ot=null===(le=l.plugins.browsertab)||void 0===le?void 0:le.close;"function"==typeof ot&&ot(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function ne(){P||(P=window.setTimeout(()=>{A(Ie(c,"redirect-cancelled-by-user"))},2e3))}function de(){"visible"===(null==document?void 0:document.visibilityState)&&ne()}o.addPassiveListener(j),document.addEventListener("resume",ne,!1),Ti()&&document.addEventListener("visibilitychange",de,!1),p=()=>{o.removePassiveListener(j),document.removeEventListener("resume",ne,!1),document.removeEventListener("visibilitychange",de,!1),P&&window.clearTimeout(P)}})}finally{p()}})).apply(this,arguments)}function Pc(c){return En.apply(this,arguments)}function En(){return(En=(0,v.Z)(function*(c){const o=Lc(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function Lc(c){if(ee(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let l=0;l<c.length;l++)a[l]=c.charCodeAt(l);return a}(0,y.Pz)("authIdTokenMaxAge"),function zr(c){(0,ie._registerComponent)(new z.wA("auth",(o,{options:a})=>{const l=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:g,authDomain:A}=l.options;return((P,j)=>{E(g&&!g.includes(":"),"invalid-api-key",{appName:P.name}),E(!(null==A?void 0:A.includes(":")),"argument-error",{appName:P.name});const ne={apiKey:g,authDomain:A,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Lu(c)},de=new Fu(P,j,ne);return function zn(c,o){const a=(null==o?void 0:o.persistence)||[],l=(Array.isArray(a)?a:[a]).map(We);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}(de,a),de})(l,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,l)=>{o.getProvider("auth-internal").initialize()})),(0,ie._registerComponent)(new z.wA("auth-internal",o=>{const a=lt(o.getProvider("auth").getImmediate());return new ja(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,ie.registerVersion)(Vn,"0.21.0",function go(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,ie.registerVersion)(Vn,"0.21.0","esm2017")}("Browser");class Fc extends ao{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,v.Z)(function*(){yield o.initPromise})()}}function Vc(c){return Ha.apply(this,arguments)}function Ha(){return(Ha=(0,v.Z)(function*(c){const o=yield Hi()._get(wo(c));return o&&(yield Hi()._remove(wo(c))),o})).apply(this,arguments)}function Io(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const l=Math.floor(Math.random()*o.length);c.push(o.charAt(l))}return c.join("")}function Hi(){return We(Kt)}function wo(c){return yn("authEvent",c.config.apiKey,c.name)}function Eo(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,y.zd)(a.join("?"))}function Ya(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ie("no-auth-event")}}function $r(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function De(c=(0,y.z$)()){return!("file:"!==$r()&&"ionic:"!==$r()&&"capacitor:"!==$r()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function Ct(){try{const c=self.localStorage,o=$t();if(c)return c.setItem(o,"1"),c.removeItem(o),!function Ah(c=(0,y.z$)()){return function Wc(){return(0,y.w1)()&&11===(null==document?void 0:document.documentMode)}()||function Zn(c=(0,y.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,y.hl)()}catch(c){return To()&&(0,y.hl)()}return!1}function To(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function di(){return(function st(){return"http:"===$r()||"https:"===$r()}()||(0,y.ru)()||De())&&!function Gc(){return(0,y.b$)()||(0,y.UG)()}()&&Ct()&&!To()}function Ja(){return De()&&"undefined"!=typeof document}function bo(){return(bo=(0,v.Z)(function*(){return!!Ja()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const Ft={LOCAL:"local",NONE:"none",SESSION:"session"},Yr=E,_e="persistence";function Ji(c){return fi.apply(this,arguments)}function fi(){return(fi=(0,v.Z)(function*(c){yield c._initializationPromise;const o=Jr(),a=yn(_e,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function Jr(){var c;try{return(null===(c=function Hr(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const zc=E;class bn{constructor(){this.browserResolver=We(class ji{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Rn,this._completeRedirectFn=Gr,this._overrideRedirectResult=In}_openPopup(o,a,l,p){var g=this;return(0,v.Z)(function*(){var A;ee(null===(A=g.eventManagers[o._key()])||void 0===A?void 0:A.manager,"_initialize() not called before _openPopup()");const P=po(o,a,l,ft(),p);return function Wr(c,o,a,l=500,p=600){const g=Math.max((window.screen.availHeight-p)/2,0).toString(),A=Math.max((window.screen.availWidth-l)/2,0).toString();let P="";const j=Object.assign(Object.assign({},_t),{width:l.toString(),height:p.toString(),top:g,left:A}),ne=(0,y.z$)().toLowerCase();a&&(P=$o(ne)?"_blank":a),Mu(ne)&&(o=o||"http://localhost",j.scrollbars="yes");const de=Object.entries(j).reduce((ot,[Qt,Ao])=>`${ot}${Qt}=${Ao},`,"");if(function ct(c=(0,y.z$)()){var o;return kn(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(ne)&&"_self"!==P)return function ho(c,o){const a=document.createElement("a");a.href=c,a.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(o||"",P),new Un(null);const le=window.open(o||"",P,de);E(le,c,"popup-blocked");try{le.focus()}catch(ot){}return new Un(le)}(o,P,$t())})()}_openRedirect(o,a,l,p){var g=this;return(0,v.Z)(function*(){return yield g._originValidation(o),function oe(c){K().location.href=c}(po(o,a,l,ft(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:g}=this.eventManagers[a];return p?Promise.resolve(p):(ee(g,"If manager is not set, promise should be"),g)}const l=this.initAndGetManager(o);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(o){var a=this;return(0,v.Z)(function*(){const l=yield function zi(c){return kt.apply(this,arguments)}(o),p=new ao(o);return l.register("authEvent",g=>(E(null==g?void 0:g.authEvent,o,"invalid-auth-event"),{status:p.onEvent(g.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=l,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(mo,{type:mo},p=>{var g;const A=null===(g=null==p?void 0:p[0])||void 0===g?void 0:g[mo];void 0!==A&&a(!!A),Ae(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function yh(c){return Ba.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return mr()||ys()||kn()}}),this.cordovaResolver=We(class Yi{constructor(){this._redirectPersistence=Rn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Gr,this._overrideRedirectResult=In}_initialize(o){var a=this;return(0,v.Z)(function*(){const l=o._key();let p=a.eventManagers.get(l);return p||(p=new Fc(o),a.eventManagers.set(l,p),a.attachCallbackListeners(o,p)),p})()}_openPopup(o){Ae(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,l,p){var g=this;return(0,v.Z)(function*(){!function hi(c){var o,a,l,p,g,A,P,j,ne,de;const le=li();E("function"==typeof(null===(o=null==le?void 0:le.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),E(void 0!==(null===(a=null==le?void 0:le.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),E("function"==typeof(null===(g=null===(p=null===(l=null==le?void 0:le.cordova)||void 0===l?void 0:l.plugins)||void 0===p?void 0:p.browsertab)||void 0===g?void 0:g.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),E("function"==typeof(null===(j=null===(P=null===(A=null==le?void 0:le.cordova)||void 0===A?void 0:A.plugins)||void 0===P?void 0:P.browsertab)||void 0===j?void 0:j.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),E("function"==typeof(null===(de=null===(ne=null==le?void 0:le.cordova)||void 0===ne?void 0:ne.InAppBrowser)||void 0===de?void 0:de.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const A=yield g._initialize(o);yield A.initialized(),A.resetRedirect(),function Pa(){Yt.clear()}(),yield g._originValidation(o);const P=function Uc(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Io(),postBody:null,tenantId:c.tenantId,error:Ie(c,"no-auth-event")}}(o,l,p);yield function jr(c,o){return Hi()._set(wo(c),o)}(o,P);const j=yield function Nc(c,o,a){return yo.apply(this,arguments)}(o,P,a),ne=yield function bh(c){const{cordova:o}=li();return new Promise(a=>{o.plugins.browsertab.isAvailable(l=>{let p=null;l?o.plugins.browsertab.openUrl(c):p=o.InAppBrowser.open(c,function Ho(c=(0,y.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(p)})})}(j);return function Mc(c,o,a){return Bn.apply(this,arguments)}(o,A,ne)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function vo(c){return $a.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:l,handleOpenURL:p,BuildInfo:g}=li(),A=setTimeout((0,v.Z)(function*(){yield Vc(o),a.onEvent(Ya())}),500),P=function(){var de=(0,v.Z)(function*(le){clearTimeout(A);const ot=yield Vc(o);let Qt=null;ot&&(null==le?void 0:le.url)&&(Qt=function Ke(c,o){var a,l;const p=function Kr(c){const o=Eo(c),a=o.link?decodeURIComponent(o.link):void 0,l=Eo(a).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return Eo(p).link||p||l||a||c}(o);if(p.includes("/__/auth/callback")){const g=Eo(p),A=g.firebaseError?function xh(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(g.firebaseError)):null,P=null===(l=null===(a=null==A?void 0:A.code)||void 0===a?void 0:a.split("auth/"))||void 0===l?void 0:l[1],j=P?Ie(P):null;return j?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:j,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:p,postBody:null}}return null}(ot,le.url)),a.onEvent(Qt||Ya())});return function(ot){return de.apply(this,arguments)}}();void 0!==l&&"function"==typeof l.subscribe&&l.subscribe(null,P);const j=p,ne=`${g.packageName.toLowerCase()}://`;li().handleOpenURL=function(){var de=(0,v.Z)(function*(le){if(le.toLowerCase().startsWith(ne)&&P({url:le}),"function"==typeof j)try{j(le)}catch(ot){console.error(ot)}});return function(le){return de.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=Rn,this._completeRedirectFn=Gr,this._overrideRedirectResult=In}_initialize(o){var a=this;return(0,v.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,l,p){var g=this;return(0,v.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openPopup(o,a,l,p)})()}_openRedirect(o,a,l,p){var g=this;return(0,v.Z)(function*(){return yield g.selectUnderlyingResolver(),g.assertedUnderlyingResolver._openRedirect(o,a,l,p)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return Ja()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return zc(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,v.Z)(function*(){if(o.underlyingResolver)return;const a=yield function ln(){return bo.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function Xa(c){return c.unwrap()}function jc(c){return $c(c)}function $c(c){const{_tokenResponse:o}=c instanceof y.ZR?c.customData:c;if(!o)return null;if(!(c instanceof y.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Bi.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let l;switch(a){case"google.com":l=Tr;break;case"facebook.com":l=na;break;case"github.com":l=Ri;break;case"twitter.com":l=ia;break;default:const{oauthIdToken:p,oauthAccessToken:g,oauthTokenSecret:A,pendingToken:P,nonce:j}=o;return g||A||p||P?P?a.startsWith("saml.")?Cn._create(a,P):qt._fromParams({providerId:a,signInMethod:a,pendingToken:P,idToken:p,accessToken:g}):new en(a).credential({idToken:p,accessToken:g,rawNonce:j}):null}return c instanceof y.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function Ot(c,o){return o.catch(a=>{throw a instanceof y.ZR&&function Kc(c,o){var a;const l=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new Xi(c,function Vi(c,o){var a;const l=(0,y.m9)(c),p=o;return E(o.customData.operationType,l,"argument-error"),E(null===(a=p.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,l,"argument-error"),Gs._fromError(l,p)}(c,o));else if(l){const p=$c(o),g=o;p&&(g.credential=p,g.tenantId=l.tenantId||void 0,g.email=l.email||void 0,g.phoneNumber=l.phoneNumber||void 0)}}(c,a),a}).then(a=>{const p=a.user;return{operationType:a.operationType,credential:jc(a),additionalUserInfo:qs(a),user:hn.getOrCreate(p)}})}function eu(c,o){return tu.apply(this,arguments)}function tu(){return(tu=(0,v.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:l=>Ot(c,a.confirm(l))}})).apply(this,arguments)}class Xi{constructor(o,a){this.resolver=a,this.auth=function Ch(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Ot(Xa(this.auth),this.resolver.resolveSignIn(o))}}class hn{constructor(o){this._delegate=o,this.multiFactor=function ac(c){const o=(0,y.m9)(c);return Ta.has(o)||Ta.set(o,Ea._fromUser(o)),Ta.get(o)}(o)}static getOrCreate(o){return hn.USER_MAP.has(o)||hn.USER_MAP.set(o,new hn(o)),hn.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,v.Z)(function*(){return Ot(a.auth,ca(a._delegate,o))})()}linkWithPhoneNumber(o,a){var l=this;return(0,v.Z)(function*(){return eu(l.auth,function ai(c,o,a){return Js.apply(this,arguments)}(l._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,v.Z)(function*(){return Ot(a.auth,function vc(c,o,a){return ci.apply(this,arguments)}(a._delegate,o,bn))})()}linkWithRedirect(o){var a=this;return(0,v.Z)(function*(){return yield Ji(lt(a.auth)),function gh(c,o,a){return function Tc(c,o,a){return ro.apply(this,arguments)}(c,o,a)}(a._delegate,o,bn)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,v.Z)(function*(){return Ot(a.auth,Ku(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return eu(this.auth,function Oa(c,o,a){return Na.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return Ot(this.auth,function ui(c,o,a){return Br.apply(this,arguments)}(this._delegate,o,bn))}reauthenticateWithRedirect(o){var a=this;return(0,v.Z)(function*(){return yield Ji(lt(a.auth)),function qr(c,o,a){return function Ec(c,o,a){return La.apply(this,arguments)}(c,o,a)}(a._delegate,o,bn)})()}sendEmailVerification(o){return function Xu(c,o){return jt.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,v.Z)(function*(){return yield function Ar(c,o){return ti.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function Zs(c,o){return Nr((0,y.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function nc(c,o){return Nr((0,y.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function ph(c,o){return on.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function tc(c,o){return Or.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function ec(c,o,a){return Bs.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}hn.USER_MAP=new WeakMap;const Xr=E;let nt=(()=>{class c{constructor(a,l){if(this.app=a,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=a.options;Xr(p,"invalid-api-key",{appName:a.name}),Xr(p,"invalid-api-key",{appName:a.name});const g="undefined"!=typeof window?bn:void 0;this._delegate=l.initialize({options:{persistence:Hc(p,a.name),popupRedirectResolver:g}}),this._delegate._updateErrorMap(Se),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?hn.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,l){!function Qo(c,o,a){const l=lt(c);E(l._canInitEmulator,l,"emulator-config-failed"),E(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),g=ws(o),{host:A,port:P}=function Wl(c){const o=ws(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(l);if(p){const g=p[1];return{host:g,port:Es(l.substr(g.length+1))}}{const[g,A]=l.split(":");return{host:g,port:Es(A)}}}(o);l.config.emulator={url:`${g}//${A}${null===P?"":`:${P}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:A,port:P,protocol:g.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function Vu(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,l)}applyActionCode(a){return function Ql(c,o){return Pi.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return Li(this._delegate,a)}confirmPasswordReset(a,l){return function Yl(c,o,a){return da.apply(this,arguments)}(this._delegate,a,l)}createUserWithEmailAndPassword(a,l){var p=this;return(0,v.Z)(function*(){return Ot(p._delegate,function Rr(c,o,a){return ni.apply(this,arguments)}(p._delegate,a,l))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function Ju(c,o){return Ui.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function Xl(c,o){const a=Xn.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,v.Z)(function*(){Xr(di(),a._delegate,"operation-not-supported-in-this-environment");const l=yield function Fn(c,o){return so.apply(this,arguments)}(a._delegate,bn);return l?Ot(a._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function Zc(c,o){lt(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,l,p){const{next:g,error:A,complete:P}=xo(a,l,p);return this._delegate.onAuthStateChanged(g,A,P)}onIdTokenChanged(a,l,p){const{next:g,error:A,complete:P}=xo(a,l,p);return this._delegate.onIdTokenChanged(g,A,P)}sendSignInLinkToEmail(a,l){return function Xe(c,o,a){return Us.apply(this,arguments)}(this._delegate,a,l)}sendPasswordResetEmail(a,l){return function Yu(c,o,a){return Dr.apply(this,arguments)}(this._delegate,a,l||void 0)}setPersistence(a){var l=this;return(0,v.Z)(function*(){let p;switch(function kh(c,o){Yr(Object.values(Ft).includes(o),c,"invalid-persistence-type"),(0,y.b$)()?Yr(o!==Ft.SESSION,c,"unsupported-persistence-type"):(0,y.UG)()?Yr(o===Ft.NONE,c,"unsupported-persistence-type"):To()?Yr(o===Ft.NONE||o===Ft.LOCAL&&(0,y.hl)(),c,"unsupported-persistence-type"):Yr(o===Ft.NONE||Ct(),c,"unsupported-persistence-type")}(l._delegate,a),a){case Ft.SESSION:p=Rn;break;case Ft.LOCAL:p=(yield We(sn)._isAvailable())?sn:Kt;break;case Ft.NONE:p=An;break;default:return Ae("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return Ot(this._delegate,function Os(c){return Oi.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return Ot(this._delegate,kr(this._delegate,a))}signInWithCustomToken(a){return Ot(this._delegate,function Hu(c,o){return Ls.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,l){return Ot(this._delegate,function Jl(c,o,a){return kr((0,y.m9)(c),Ds.credential(o,a))}(this._delegate,a,l))}signInWithEmailLink(a,l){return Ot(this._delegate,function eh(c,o,a){return pa.apply(this,arguments)}(this._delegate,a,l))}signInWithPhoneNumber(a,l){return eu(this._delegate,function Mn(c,o,a){return Ra.apply(this,arguments)}(this._delegate,a,l))}signInWithPopup(a){var l=this;return(0,v.Z)(function*(){return Xr(di(),l._delegate,"operation-not-supported-in-this-environment"),Ot(l._delegate,function Pn(c,o,a){return je.apply(this,arguments)}(l._delegate,a,bn))})()}signInWithRedirect(a){var l=this;return(0,v.Z)(function*(){return Xr(di(),l._delegate,"operation-not-supported-in-this-environment"),yield Ji(l._delegate),function Ic(c,o,a){return function wc(c,o,a){return qi.apply(this,arguments)}(c,o,a)}(l._delegate,a,bn)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function fa(c,o){return Fs.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=Ft,c})();function xo(c,o,a){let l=c;"function"!=typeof c&&({next:l,error:o,complete:a}=c);const p=l;return{next:A=>p(A&&hn.getOrCreate(A)),error:o,complete:a}}function Hc(c,o){const a=function Qr(c,o){const a=Jr();if(!a)return[];const l=yn(_e,c,o);switch(a.getItem(l)){case Ft.NONE:return[An];case Ft.LOCAL:return[sn,Rn];case Ft.SESSION:return[Rn];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(sn)&&a.push(sn),"undefined"!=typeof window)for(const l of[Kt,Rn])a.includes(l)||a.push(l);return a.includes(An)||a.push(An),a}class pi{constructor(){this.providerId="phone",this._delegate=new Bi(Xa(F.Z.auth()))}static credential(o,a){return Bi.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}pi.PHONE_SIGN_IN_METHOD=Bi.PHONE_SIGN_IN_METHOD,pi.PROVIDER_ID=Bi.PROVIDER_ID;const dn=E;class nu{constructor(o,a,l=F.Z.app()){var p;dn(null===(p=l.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new Ht(o,a,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function es(c){c.INTERNAL.registerComponent(new z.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new nt(a,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:Ds,FacebookAuthProvider:na,GithubAuthProvider:Ri,GoogleAuthProvider:Tr,OAuthProvider:en,SAMLAuthProvider:Rs,PhoneAuthProvider:pi,PhoneMultiFactorGenerator:za,RecaptchaVerifier:nu,TwitterAuthProvider:ia,Auth:nt,AuthCredential:bi,Error:y.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.3.0")}(F.Z)}}]);