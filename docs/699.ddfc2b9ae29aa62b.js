"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[699],{4699:($y,zu,F)=>{F.r(zu),F.d(zu,{FieldModule:()=>Xw});var I=F(9298),wt=F(1062),R=F(2705),T=F(5861);let Po=(()=>{class n{constructor(t){this.context=t}draw(){this.drawShape()}fromDiscreteX(t){return t*(this.context.canvas.width/n.FIELD_RESOLUTION)}fromDiscreteY(t){return t*(this.context.canvas.height/n.FIELD_RESOLUTION)}toDiscreteX(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.width)),n.FIELD_RESOLUTION))}toDiscreteY(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.height)),n.FIELD_RESOLUTION))}}return n.FIELD_RESOLUTION=9e3,n})();class Xn extends Po{constructor(e,t,i){super(t),this.actor=e,this.fieldPositions=i||new Map}toDto(){return{f:[...this.fieldPositions.entries()].map(([e,t])=>({x:Number(t.x.toFixed(0)).valueOf(),y:Number(t.y.toFixed(0)).valueOf(),u:e}))}}draw(){super.draw(),this.drawPosition(),this.drawActorName()}currentPosition(){return this.actor.position.rotate(this.rotationOffset)}setPosition(e,t){this.fieldPositions.set(this._rotationUUID,{x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}get x(){return this.fromDiscreteX(this.getFieldPosition().x)}get y(){return this.fromDiscreteY(this.getFieldPosition().y)}getFieldPosition(){return this.fieldPositions.get(this._rotationUUID)}setRotationProperties(e,t){const i=this._rotationUUID;if(this._rotationUUID=e,this.rotationOffset=t,0===this.fieldPositions.size)this.setPosition(this.context.canvas.width/2,this.context.canvas.height/2);else if(!this.fieldPositions.has(e)){const r=this.fieldPositions.get(i);this.setPosition(this.context.canvas.width*r.x,this.context.canvas.height*r.y)}}removeRotation(e){this.fieldPositions.delete(e)}}let ei=(()=>{class n extends Xn{constructor(t,i,r,s){super(t,i,s),this.dashed=r}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.fillStyle="red",this.context.fill(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+12)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.5*this.radius))}isHit(t,i){return t>=this.x-this.radius&&t<=this.x+this.radius&&i>=this.y-this.radius&&i<=this.y+this.radius}}return n.RELATIVE_RADIUS=.048,n.RADIUS_MAX=40,n})();var We=(()=>{return(n=We||(We={})).Setter="Setter",n.MiddleBlocker="Middle blocker",n.Libero="Libero",n.OutsideHitter="Outside hitter",n.OppositeHitter="Opposite hitter",n.DefensiveSpecialist="Defensive specialist",We;var n})(),q=F(3075);class Tn{constructor(e){if(e<1||e>6)throw new Error("Player position must be between 1 and 6.");this._position=e}get value(){return this._position}rotate(e){let i=this._position+(e._position-1);return i>6&&(i-=6),new Tn(i)}}function $u(n=5){let e="";for(;e.length<n;)e+=Math.random().toString(36).substring(2,7);return e.substring(0,n)}let xn=(()=>{class n extends Xn{constructor(t,i,r){super(t,i,r)}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.setLineDash([]),this.context.closePath(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y-10)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+this.radius/2))}isHit(t,i){return t>=this.x-this.radius&&t<=this.x+this.radius&&i>=this.y-this.radius&&i<=this.y}}return n.RELATIVE_RADIUS=.0576,n.RADIUS_MAX=50,n})(),rs=(()=>{class n extends Xn{constructor(t,i,r,s){super(t,i,s),this.dashed=r}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x-2,this.y+25)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle="red",this.context.fill()}isHit(t,i){return t>=this.x-this.size&&t<=this.x+this.size&&i>=this.y-this.size&&i<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class Lo extends Po{constructor(e,t){super(e),this.positions=null!=t?t:[]}addPosition(e,t){this.positions.push({x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}drawShape(){if(!(this.positions.length<=1)){this.context.beginPath(),this.context.moveTo(this.fromDiscreteX(this.positions[0].x),this.fromDiscreteY(this.positions[0].y));for(let e=1;e<this.positions.length;++e)this.context.lineTo(this.fromDiscreteX(this.positions[e].x),this.fromDiscreteY(this.positions[e].y));this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}}isHit(e,t){const i=this.toDiscreteX(e),r=this.toDiscreteY(t);let u=this.positions[0];for(let d=1;d<this.positions.length;++d){const f=this.positions[d];if(u.x<f.x){const m=u.x-2<=i&&f.x+2>=i;if(u.y<f.y){if(m&&u.y-2<=r&&f.y+2>=r)return!0}else if(m&&u.y+2>=r&&f.y-2<=r)return!0}else{const m=u.x+2>=i&&f.x-2<=i;if(u.y<f.y){if(m&&u.y-2<=r&&f.y+2>=r)return!0}else if(m&&u.y+2>=r&&f.y-2<=r)return!0}u=f}return!1}toDto(){return{f:Object.fromEntries(this.positions.reduce((e,t)=>(e.set(e.size,t),e),new Map))}}}let ju=(()=>{class n extends Xn{constructor(t,i,r){super(t,i,r)}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+this.size/2-2)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash([]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y-this.size),this.context.lineTo(this.x-this.size,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle="red",this.context.fill()}isHit(t,i){return t>=this.x-this.size&&t<=this.x+this.size&&i>=this.y-this.size&&i<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class Wu{static fromActorDto(e,t,i){const r=new Map(t.f.map(s=>[s.u,{x:s.x,y:s.y}]));switch(e.player_role){case We.Setter:return new xn(e,i,r);case We.MiddleBlocker:case We.Libero:return new rs(e,i,!1,r);case We.DefensiveSpecialist:return new ju(e,i,r);case We.OutsideHitter:return new ei(e,i,!1,r);case We.OppositeHitter:return new ei(e,i,!0,r)}}static fromLineDto(e,t){const i=Math.max(...Object.keys(e.f).map(s=>Number(s))),r=[];for(let s=0;s<=i;++s)r.push({x:Number(e.f[s.toString()].x),y:Number(e.f[s.toString()].y)});return new Lo(t,r)}}class ti{constructor(e,t,i,r,s){this.position=e,this.player_role=t,this.player_name=i,this._UUID=r||$u(),s&&(this._shape=s)}get UUID(){return this._UUID}get shape(){return this._shape}static fromDto(e,t){const i=new ti(new Tn(e.p),e.pr,"NULL"===e.pn?void 0:e.pn,e.u),r=Wu.fromActorDto(i,e.s,t);return i.setShape(r),i}toDto(){var e;return{pn:null!==(e=this.player_name)&&void 0!==e?e:"NULL",pr:this.player_role,p:this.position.value,u:this.UUID,s:this.shape.toDto()}}setShape(e){this._shape=e}draw(){this.shape.draw()}toString(){return this.player_name?`${this.player_name} (${this.position.value}) - ${this.player_role.toString()}`:`Unnamed actor (${this.position.value}) - ${this.player_role.toString()}`}}var h=F(5e3),ni=F(9776),bt=F(7429),ne=F(508),Re=F(226),Xe=F(7579),ii=F(9770),Ft=F(9646),D=F(9300),et=F(5698),Ze=F(8675),ji=F(925),fe=F(9808),ce=F(1777),kn=F(8255),rn=F(1159),Wi=F(6360);function Ku(n,e){}class Fo{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const ih={dialogContainer:(0,ce.X$)("dialogContainer",[(0,ce.SB)("void, exit",(0,ce.oB)({opacity:0,transform:"scale(0.7)"})),(0,ce.SB)("enter",(0,ce.oB)({transform:"none"})),(0,ce.eR)("* => enter",(0,ce.ru)([(0,ce.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,ce.oB)({transform:"none",opacity:1})),(0,ce.IO)("@*",(0,ce.pV)(),{optional:!0})])),(0,ce.eR)("* => void, * => exit",(0,ce.ru)([(0,ce.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,ce.oB)({opacity:0})),(0,ce.IO)("@*",(0,ce.pV)(),{optional:!0})]))])};let Uo=(()=>{class n extends bt.en{constructor(t,i,r,s,u,d,f,m){super(),this._elementRef=t,this._focusTrapFactory=i,this._changeDetectorRef=r,this._config=u,this._interactivityChecker=d,this._ngZone=f,this._focusMonitor=m,this._animationStateChanged=new h.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=g=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(g)),this._ariaLabelledBy=u.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,ji.ht)())}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{t.removeEventListener("blur",r),t.removeEventListener("mousedown",r),t.removeAttribute("tabindex")};t.addEventListener("blur",r),t.addEventListener("mousedown",r)})),t.focus(i)}_focusByCssSelector(t,i){let r=this._elementRef.nativeElement.querySelector(t);r&&this._forceFocus(r,i)}_trapFocus(){const t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const i=(0,ji.ht)(),r=this._elementRef.nativeElement;(!i||i===this._document.body||i===r||r.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,i=(0,ji.ht)();return t===i||t.contains(i)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.SBq),h.Y36(kn.qV),h.Y36(h.sBO),h.Y36(fe.K0,8),h.Y36(Fo),h.Y36(kn.ic),h.Y36(h.R0b),h.Y36(kn.tE))},n.\u0275dir=h.lG2({type:n,viewQuery:function(t,i){if(1&t&&h.Gf(bt.Pl,7),2&t){let r;h.iGM(r=h.CRH())&&(i._portalOutlet=r.first)}},features:[h.qOj]}),n})(),Hu=(()=>{class n extends Uo{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:i}){"enter"===t?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:i}))}_onAnimationStart({toState:t,totalTime:i}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=h.n5z(n)))(i||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,i){1&t&&h.WFA("@dialogContainer.start",function(s){return i._onAnimationStart(s)})("@dialogContainer.done",function(s){return i._onAnimationDone(s)}),2&t&&(h.Ikx("id",i._id),h.uIk("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),h.d8E("@dialogContainer",i._state))},features:[h.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,i){1&t&&h.YNc(0,Ku,0,0,"ng-template",0)},directives:[bt.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[ih.dialogContainer]}}),n})(),rh=0;class sn{constructor(e,t,i="mat-dialog-"+rh++){this._overlayRef=e,this._containerInstance=t,this.id=i,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new Xe.x,this._afterClosed=new Xe.x,this._beforeClosed=new Xe.x,this._state=0,t._id=i,t._animationStateChanged.pipe((0,D.h)(r=>"opened"===r.state),(0,et.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,D.h)(r=>"closed"===r.state),(0,et.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),e.keydownEvents().pipe((0,D.h)(r=>r.keyCode===rn.hY&&!this.disableClose&&!(0,rn.Vb)(r))).subscribe(r=>{r.preventDefault(),Se(this,"keyboard")}),e.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Se(this,"mouse")})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe((0,D.h)(t=>"closing"===t.state),(0,et.q)(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(e){let t=this._getPositionStrategy();return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(e="",t=""){return this._overlayRef.updateSize({width:e,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(e){return this._overlayRef.addPanelClass(e),this}removePanelClass(e){return this._overlayRef.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Se(n,e,t){return void 0!==n._containerInstance&&(n._containerInstance._closeInteractionType=e),n.close(t)}const Te=new h.OlP("MatDialogData"),Vo=new h.OlP("mat-dialog-default-options"),qo=new h.OlP("mat-dialog-scroll-strategy"),Bo={provide:qo,deps:[ni.aV],useFactory:function Ut(n){return()=>n.scrollStrategies.block()}};let Yu=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,_){this._overlay=t,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=u,this._dialogRefConstructor=f,this._dialogContainerType=m,this._dialogDataToken=g,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new Xe.x,this._afterOpenedAtThisLevel=new Xe.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,ii.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,Ze.O)(void 0))),this._scrollStrategy=d}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,i){i=function Ki(n,e){return Object.assign(Object.assign({},e),n)}(i,this._defaultOptions||new Fo),i.id&&this.getDialogById(i.id);const r=this._createOverlay(i),s=this._attachDialogContainer(r,i),u=this._attachDialogContent(t,s,r,i);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(u),u.afterClosed().subscribe(()=>this._removeOpenDialog(u)),this.afterOpened.next(u),s._initializeWithAttachedContent(),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const i=this._getOverlayConfig(t);return this._overlay.create(i)}_getOverlayConfig(t){const i=new ni.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(i.backdropClass=t.backdropClass),i}_attachDialogContainer(t,i){const s=h.zs3.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:Fo,useValue:i}]}),u=new bt.C5(this._dialogContainerType,i.viewContainerRef,s,i.componentFactoryResolver);return t.attach(u).instance}_attachDialogContent(t,i,r,s){const u=new this._dialogRefConstructor(r,i,s.id);if(t instanceof h.Rgc)i.attachTemplatePortal(new bt.UE(t,null,{$implicit:s.data,dialogRef:u}));else{const d=this._createInjector(s,u,i),f=i.attachComponentPortal(new bt.C5(t,s.viewContainerRef,d,s.componentFactoryResolver));u.componentInstance=f.instance}return u.updateSize(s.width,s.height).updatePosition(s.position),u}_createInjector(t,i,r){const s=t&&t.viewContainerRef&&t.viewContainerRef.injector,u=[{provide:this._dialogContainerType,useValue:r},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:i}];return t.direction&&(!s||!s.get(Re.Is,null,h.XFs.Optional))&&u.push({provide:Re.Is,useValue:{value:t.direction,change:(0,Ft.of)()}}),h.zs3.create({parent:s||this._injector,providers:u})}_removeOpenDialog(t){const i=this.openDialogs.indexOf(t);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((r,s)=>{r?s.setAttribute("aria-hidden",r):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const i=t.parentElement.children;for(let r=i.length-1;r>-1;r--){let s=i[r];s!==t&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let i=t.length;for(;i--;)t[i].close()}}return n.\u0275fac=function(t){h.$Z()},n.\u0275dir=h.lG2({type:n}),n})(),Zo=(()=>{class n extends Yu{constructor(t,i,r,s,u,d,f,m){super(t,i,s,d,f,u,sn,Hu,Te,m)}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(ni.aV),h.LFG(h.zs3),h.LFG(fe.Ye,8),h.LFG(Vo,8),h.LFG(qo),h.LFG(n,12),h.LFG(ni.Xj),h.LFG(Wi.Qb,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac}),n})(),sh=0,ri=(()=>{class n{constructor(t,i,r){this._dialogRef=t,this._elementRef=i,this._dialog=r,this.id="mat-dialog-title-"+sh++}ngOnInit(){this._dialogRef||(this._dialogRef=function Go(n,e){let t=n.nativeElement.parentElement;for(;t&&!t.classList.contains("mat-dialog-container");)t=t.parentElement;return t?e.find(i=>i.id===t.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef._containerInstance;t&&!t._ariaLabelledBy&&(t._ariaLabelledBy=this.id)})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(sn,8),h.Y36(h.SBq),h.Y36(Zo))},n.\u0275dir=h.lG2({type:n,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-dialog-title"],hostVars:1,hostBindings:function(t,i){2&t&&h.Ikx("id",i.id)},inputs:{id:"id"},exportAs:["matDialogTitle"]}),n})(),on=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=h.lG2({type:n,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-dialog-content"]}),n})(),Hi=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({providers:[Zo,Bo],imports:[[ni.U8,bt.eL,ne.BQ],ne.BQ]}),n})();var pt=F(7322),os=F(7531),An=F(4107),Vt=F(7423);let as=(()=>{class n{constructor(t,i){this.fb=t,this.dialogRef=i,this.PlayerRole=We}onSubmit(){this.dialogRef.close(new ti(new Tn(this.formGroup.value.position),this.formGroup.value.player_role,this.formGroup.value.player_name))}ngOnInit(){this.formGroup=this.fb.group({player_name:[null],position:[null,q.kI.required],player_role:[null,q.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-add-actor-dialog"]],decls:53,vars:47,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","player_name"],["appearance","fill"],["formControlName","position"],[3,"value"],["formControlName","player_role"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"mat-form-field",4)(11,"mat-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"mat-select",5)(15,"mat-option",6),h._uU(16,"1"),h.qZA(),h.TgZ(17,"mat-option",6),h._uU(18,"2"),h.qZA(),h.TgZ(19,"mat-option",6),h._uU(20,"3"),h.qZA(),h.TgZ(21,"mat-option",6),h._uU(22,"4"),h.qZA(),h.TgZ(23,"mat-option",6),h._uU(24,"5"),h.qZA(),h.TgZ(25,"mat-option",6),h._uU(26,"6"),h.qZA()()(),h.TgZ(27,"mat-form-field",4)(28,"mat-label"),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"mat-select",7)(32,"mat-option",6),h._uU(33),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"mat-option",6),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.TgZ(38,"mat-option",6),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"mat-option",6),h._uU(42),h.ALo(43,"translate"),h.qZA(),h.TgZ(44,"mat-option",6),h._uU(45),h.ALo(46,"translate"),h.qZA(),h.TgZ(47,"mat-option",6),h._uU(48),h.ALo(49,"translate"),h.qZA()()(),h.TgZ(50,"button",8),h._uU(51),h.ALo(52,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,25,"add_actor_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,27,"add_actor_dialog.placeholder.player_name")),h.xp6(5),h.Oqu(h.lcZ(13,29,"add_actor_dialog.placeholder.position")),h.xp6(3),h.Q6J("value",1),h.xp6(2),h.Q6J("value",2),h.xp6(2),h.Q6J("value",3),h.xp6(2),h.Q6J("value",4),h.xp6(2),h.Q6J("value",5),h.xp6(2),h.Q6J("value",6),h.xp6(4),h.Oqu(h.lcZ(30,31,"add_actor_dialog.placeholder.player_role")),h.xp6(3),h.Q6J("value",i.PlayerRole.Setter),h.xp6(1),h.Oqu(h.lcZ(34,33,"add_actor_dialog.player_roles.setter")),h.xp6(2),h.Q6J("value",i.PlayerRole.MiddleBlocker),h.xp6(1),h.Oqu(h.lcZ(37,35,"add_actor_dialog.player_roles.middle_blocker")),h.xp6(2),h.Q6J("value",i.PlayerRole.Libero),h.xp6(1),h.Oqu(h.lcZ(40,37,"add_actor_dialog.player_roles.libero")),h.xp6(2),h.Q6J("value",i.PlayerRole.DefensiveSpecialist),h.xp6(1),h.Oqu(h.lcZ(43,39,"add_actor_dialog.player_roles.defensive_specialist")),h.xp6(2),h.Q6J("value",i.PlayerRole.OutsideHitter),h.xp6(1),h.Oqu(h.lcZ(46,41,"add_actor_dialog.player_roles.outside_hitter")),h.xp6(2),h.Q6J("value",i.PlayerRole.OppositeHitter),h.xp6(1),h.Oqu(h.lcZ(49,43,"add_actor_dialog.player_roles.opposite_hitter")),h.xp6(2),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(52,45,"add_actor_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,os.Nt,q.Fj,q.JJ,q.u,An.gD,ne.ey,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();function oh(n,e){if(1&n&&(h.TgZ(0,"mat-option",6),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}let qt=(()=>{class n{constructor(t,i,r){this.fb=t,this.dialogRef=i,this.data=r}onSubmit(){this.dialogRef.close(this.formGroup.value.actor)}ngOnInit(){this.formGroup=this.fb.group({actor:[null,q.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn),h.Y36(Te))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-delete-actor-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","actor"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"mat-select",3),h.YNc(10,oh,2,2,"mat-option",4),h.qZA()(),h.TgZ(11,"button",5),h._uU(12),h.ALo(13,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,6,"delete_actor_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,8,"delete_actor_dialog.placeholder.actor")),h.xp6(3),h.Q6J("ngForOf",i.data.actors),h.xp6(1),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(13,10,"delete_actor_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,An.gD,q.JJ,q.u,fe.sg,ne.ey,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Bt{constructor(e,t,i,r){this.rotation=e,this.name=t,this._UUID=null!=i?i:$u(),this._lines=null!=r?r:[]}get UUID(){return this._UUID}static fromDto(e,t){const i=new Tn(e.r),r=e.l.map(s=>Wu.fromLineDto(s,t));return new Bt(i,"NULL"===e.n?void 0:e.n,e.u,r)}toDto(){var e;return{n:null!==(e=this.name)&&void 0!==e?e:"NULL",r:this.rotation.value,u:this.UUID,l:this._lines.map(t=>t.toDto())}}toString(){return this.name?`${this.name} (${this.rotation.value})`:`Unknown rotation (${this.rotation.value})`}addLine(e){this._lines.push(e)}draw(){this._lines.forEach(e=>e.draw())}removeIfHitLine(e,t){const i=this._lines.findIndex(r=>r.isHit(e,t));i<0||this._lines.splice(i,1)}}function ah(n,e){if(1&n&&(h.TgZ(0,"mat-option",6),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}let uh=(()=>{class n{constructor(t,i,r){this.fb=t,this.dialogRef=i,this.data=r}onSubmit(){this.dialogRef.close(this.formGroup.value.rotation)}ngOnInit(){this.formGroup=this.fb.group({rotation:[null,q.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn),h.Y36(Te))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-delete-rotation-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"mat-select",3),h.YNc(10,ah,2,2,"mat-option",4),h.qZA()(),h.TgZ(11,"button",5),h._uU(12),h.ALo(13,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,6,"delete_rotation_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,8,"delete_rotation_dialog.placeholder.rotation")),h.xp6(3),h.Q6J("ngForOf",i.data.rotations),h.xp6(1),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(13,10,"delete_rotation_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,An.gD,q.JJ,q.u,fe.sg,ne.ey,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),Xu=(()=>{class n{constructor(t,i){this.fb=t,this.dialogRef=i}onSubmit(){this.dialogRef.close(new Bt(new Tn(this.formGroup.value.current_rotation),this.formGroup.value.rotation_name))}ngOnInit(){this.formGroup=this.fb.group({rotation_name:null,current_rotation:[1,q.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-add-rotation-dialog"]],decls:30,vars:20,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","rotation_name"],["appearance","fill"],["formControlName","current_rotation"],[3,"value"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"mat-form-field",4)(11,"mat-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"mat-select",5)(15,"mat-option",6),h._uU(16,"1"),h.qZA(),h.TgZ(17,"mat-option",6),h._uU(18,"2"),h.qZA(),h.TgZ(19,"mat-option",6),h._uU(20,"3"),h.qZA(),h.TgZ(21,"mat-option",6),h._uU(22,"4"),h.qZA(),h.TgZ(23,"mat-option",6),h._uU(24,"5"),h.qZA(),h.TgZ(25,"mat-option",6),h._uU(26,"6"),h.qZA()()(),h.TgZ(27,"button",7),h._uU(28),h.ALo(29,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,12,"add_rotation_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,14,"add_rotation_dialog.placeholder.rotation_name")),h.xp6(5),h.Oqu(h.lcZ(13,16,"add_rotation_dialog.placeholder.current_rotation")),h.xp6(3),h.Q6J("value",1),h.xp6(2),h.Q6J("value",2),h.xp6(2),h.Q6J("value",3),h.xp6(2),h.Q6J("value",4),h.xp6(2),h.Q6J("value",5),h.xp6(2),h.Q6J("value",6),h.xp6(2),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(29,18,"add_rotation_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,os.Nt,q.Fj,q.JJ,q.u,An.gD,ne.ey,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Et{static store(e,t){const i=JSON.stringify(t);window.localStorage.setItem(e,i)}static retrieve(e){const t=window.localStorage.getItem(e);if(t)return JSON.parse(t)}static remove(e){window.localStorage.removeItem(e)}}var us=F(4968),Sn=F(8996),zo=F(4986),$o=F(8306),Ge=F(2122),ch=F(4482),jo=F(5403);function Cn(){return(0,ch.e)((n,e)=>{let t,i=!1;n.subscribe((0,jo.x)(e,r=>{const s=t;t=r,i&&e.next([s,r]),i=!0}))})}var B,ye=F(4004),Zt=F(5026),lh=F(1884),Ke=F(2011),oi=(F(9169),F(3942)),an=F(9681),Qi=F(4859),Tt=F(1877),re=F(2090),ec="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},st={},cs=cs||{},j=ec||self;function ls(){}function hs(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Yi(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Wo="closure_uid_"+(1e9*Math.random()>>>0),nc=0;function hh(n,e,t){return n.call.apply(n.bind,arguments)}function dh(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function se(n,e,t){return(se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?hh:dh).apply(null,arguments)}function Ji(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Le(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,r,s){for(var u=Array(arguments.length-2),d=2;d<arguments.length;d++)u[d-2]=arguments[d];return e.prototype[r].apply(i,u)}}function Gt(){this.s=this.s,this.o=this.o}Gt.prototype.s=!1,Gt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function tc(n){Object.prototype.hasOwnProperty.call(n,Wo)&&n[Wo]||(n[Wo]=++nc)}(this)},Gt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Ko=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function Ho(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function Dn(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(hs(i)){const r=n.length||0,s=i.length||0;n.length=r+s;for(let u=0;u<s;u++)n[r+u]=i[u]}else n.push(i)}}function Ue(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ue.prototype.h=function(){this.defaultPrevented=!0};var Qo=function(){if(!j.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{j.addEventListener("test",ls,e),j.removeEventListener("test",ls,e)}catch(t){}return n}();function Xi(n){return/^[\s\xa0]*$/.test(n)}var ds=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Yo(n,e){return n<e?-1:n>e?1:0}function ai(){var n=j.navigator;return n&&(n=n.userAgent)?n:""}function xt(n){return-1!=ai().indexOf(n)}function er(n){return er[" "](n),n}er[" "]=ls;var ys,n,Jo=xt("Opera"),ui=xt("Trident")||xt("MSIE"),ps=xt("Edge"),Xo=ps||ui,ms=xt("Gecko")&&!(-1!=ai().toLowerCase().indexOf("webkit")&&!xt("Edge"))&&!(xt("Trident")||xt("MSIE"))&&!xt("Edge"),ph=-1!=ai().toLowerCase().indexOf("webkit")&&!xt("Edge");function gs(){var n=j.document;return n?n.documentMode:void 0}e:{var tr="",ea=(n=ai(),ms?/rv:([^\);]+)(\)|;)/.exec(n):ps?/Edge\/([\d\.]+)/.exec(n):ui?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):ph?/WebKit\/(\S+)/.exec(n):Jo?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ea&&(tr=ea?ea[1]:""),ui){var nr=gs();if(null!=nr&&nr>parseFloat(tr)){ys=String(nr);break e}}ys=tr}var mh={};var na=j.document&&ui&&(gs()||parseInt(ys,10))||void 0;function ir(n,e){if(Ue.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ms){e:{try{er(e.nodeName);var r=!0;break e}catch(s){}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:At[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ir.X.h.call(this)}}Le(ir,Ue);var At={2:"touch",3:"pen",4:"mouse"};ir.prototype.h=function(){ir.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var rr="closure_listenable_"+(1e6*Math.random()|0),ia=0;function gh(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=r,this.key=++ia,this.ba=this.ea=!1}function ci(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function ra(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function _s(n){const e={};for(const t in n)e[t]=n[t];return e}const ic="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rc(n,e){let t,i;for(let r=1;r<arguments.length;r++){for(t in i=arguments[r],i)n[t]=i[t];for(let s=0;s<ic.length;s++)t=ic[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function li(n){this.src=n,this.g={},this.h=0}function zt(n,e){var t=e.type;if(t in n.g){var s,i=n.g[t],r=Ko(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(ci(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function sa(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==i)return r}return-1}li.prototype.add=function(n,e,t,i,r){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=sa(n,e,i,r);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new gh(e,this.src,s,!!i,r)).ea=t,n.push(e)),e};var oa="closure_lm_"+(1e6*Math.random()|0),Nn={};function yh(n,e,t,i,r){if(i&&i.once)return On(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)yh(n,e[s],t,i,r);return null}return t=ca(t),n&&n[rr]?n.N(e,t,Yi(i)?!!i.capture:!!i,r):vs(n,e,t,!1,i,r)}function vs(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var u=Yi(r)?!!r.capture:!!r,d=ua(n);if(d||(n[oa]=d=new li(n)),(t=d.add(e,t,i,u,s)).proxy)return t;if(i=function $t(){const e=sc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)Qo||(r=u),void 0===r&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(aa(e.toString()),i);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(i)}return t}function On(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)On(n,e[s],t,i,r);return null}return t=ca(t),n&&n[rr]?n.O(e,t,Yi(i)?!!i.capture:!!i,r):vs(n,e,t,!0,i,r)}function Mn(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)Mn(n,e[s],t,i,r);else i=Yi(i)?!!i.capture:!!i,t=ca(t),n&&n[rr]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=sa(s=n.g[e],t,i,r))&&(ci(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=ua(n))&&(e=n.g[e.toString()],n=-1,e&&(n=sa(e,t,i,r)),(t=-1<n?e[n]:null)&&Is(t))}function Is(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[rr])zt(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(aa(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=ua(e))?(zt(t,n),0==t.h&&(t.src=null,e[oa]=null)):ci(n)}}}function aa(n){return n in Nn?Nn[n]:Nn[n]="on"+n}function sc(n,e){if(n.ba)n=!0;else{e=new ir(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&Is(n),n=t.call(i,e)}return n}function ua(n){return(n=n[oa])instanceof li?n:null}var un="__closure_events_fn_"+(1e9*Math.random()>>>0);function ca(n){return"function"==typeof n?n:(n[un]||(n[un]=function(e){return n.handleEvent(e)}),n[un])}function xe(){Gt.call(this),this.i=new li(this),this.P=this,this.I=null}function Fe(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,"string"==typeof e)e=new Ue(e,n);else if(e instanceof Ue)e.target=e.target||n;else{var r=e;rc(e=new Ue(i,n),r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];r=sr(u,i,!0,e)&&r}if(r=sr(u=e.g=n,i,!0,e)&&r,r=sr(u,i,!1,e)&&r,t)for(s=0;s<t.length;s++)r=sr(u=e.g=t[s],i,!1,e)&&r}function sr(n,e,t,i){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var d=u.listener,f=u.ha||u.src;u.ea&&zt(n.i,u),r=!1!==d.call(f,i)&&r}}return r&&!i.defaultPrevented}Le(xe,Gt),xe.prototype[rr]=!0,xe.prototype.removeEventListener=function(n,e,t,i){Mn(this,n,e,t,i)},xe.prototype.M=function(){if(xe.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)ci(t[i]);delete n.g[e],n.h--}}this.I=null},xe.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)},xe.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};var or=j.JSON.stringify;function mt(){var n=Es;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var bs,ac=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new la,n=>n.reset());class la{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ws(n){j.setTimeout(()=>{throw n},0)}function ha(n,e){bs||function _h(){var n=j.Promise.resolve(void 0);bs=function(){n.then(da)}}(),ar||(bs(),ar=!0),Es.add(n,e)}var ar=!1,Es=new class oc{constructor(){this.h=this.g=null}add(e,t){const i=ac.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}};function da(){for(var n;n=mt();){try{n.h.call(n.g)}catch(t){ws(t)}var e=ac;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}ar=!1}function Pn(n,e){xe.call(this),this.h=n||1,this.g=e||j,this.j=se(this.lb,this),this.l=Date.now()}function ur(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Ts(n,e,t){if("function"==typeof n)t&&(n=se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=se(n.handleEvent,n)}return 2147483647<Number(e)?-1:j.setTimeout(n,e||0)}function xs(n){n.g=Ts(()=>{n.g=null,n.i&&(n.i=!1,xs(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Le(Pn,xe),(B=Pn.prototype).ca=!1,B.R=null,B.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Fe(this,"tick"),this.ca&&(ur(this),this.start()))}},B.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},B.M=function(){Pn.X.M.call(this),ur(this),delete this.g};class uc extends Gt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xs(this)}M(){super.M(),this.g&&(j.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(n){Gt.call(this),this.h=n,this.g={}}Le(Ln,Gt);var cr=[];function ks(n,e,t,i){Array.isArray(t)||(t&&(cr[0]=t.toString()),t=cr);for(var r=0;r<t.length;r++){var s=yh(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function fa(n){ra(n.g,function(e,t){this.g.hasOwnProperty(t)&&Is(e)},n),n.g={}}function hi(){this.g=!0}function di(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function vh(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<r.length;u++)r[u]=""}}}return or(t)}catch(d){return e}}(n,t)+(i?" "+i:"")})}Ln.prototype.M=function(){Ln.X.M.call(this),fa(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},hi.prototype.Aa=function(){this.g=!1},hi.prototype.info=function(){};var jt={},lr=null;function fi(){return lr=lr||new xe}function hr(n){Ue.call(this,jt.Pa,n)}function dr(n){const e=fi();Fe(e,new hr(e))}function As(n,e){Ue.call(this,jt.STAT_EVENT,n),this.stat=e}function He(n){const e=fi();Fe(e,new As(e,n))}function Ss(n,e){Ue.call(this,jt.Qa,n),this.size=e}function fr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return j.setTimeout(function(){n()},e)}jt.Pa="serverreachability",Le(hr,Ue),jt.STAT_EVENT="statevent",Le(As,Ue),jt.Qa="timingevent",Le(Ss,Ue);var pi={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},ga={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function pr(){}function Cs(){}pr.prototype.h=null;var _a,mr={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function gr(){Ue.call(this,"d")}function ya(){Ue.call(this,"c")}function mi(){}function yr(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new Ln(this),this.O=va,this.T=new Pn(n=Xo?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new hc}function hc(){this.i=null,this.g="",this.h=!1}Le(gr,Ue),Le(ya,Ue),Le(mi,pr),mi.prototype.g=function(){return new XMLHttpRequest},mi.prototype.i=function(){return{}},_a=new mi;var va=45e3,Ia={},gi={};function wa(n,e,t){n.K=1,n.v=Ea(Kt(e)),n.s=t,n.P=!0,Ds(n,null)}function Ds(n,e){n.F=Date.now(),Fn(n),n.A=Kt(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),vc(t.i,"t",i),n.C=0,t=n.l.H,n.h=new hc,n.g=Oc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new uc(se(n.La,n,n.g),n.N)),ks(n.S,n.g,"readystatechange",n.ib),e=n.H?_s(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),dr(),function cc(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var u="",d=s.split("&"),f=0;f<d.length;f++){var m=d[f].split("=");if(1<m.length){var g=m[0];m=m[1];var _=g.split("_");u=2<=_.length&&"type"==_[1]?u+(g+"=")+m+"&":u+(g+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function dc(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Rs(n,e,t){let r,i=!0;for(;!n.I&&n.C<t.length;){if(r=Ih(n,t),r==gi){4==e&&(n.o=4,He(14),i=!1),di(n.j,n.m,null,"[Incomplete Response]");break}if(r==Ia){n.o=4,He(15),di(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}di(n.j,n.m,r,null),ba(n,r)}dc(n)&&r!=gi&&r!=Ia&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,He(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),La(e),e.K=!0,He(11))):(di(n.j,n.m,t,"[Invalid Chunked Response]"),Wt(n),_r(n))}function Ih(n,e){var t=n.C,i=e.indexOf("\n",t);return-1==i?gi:(t=Number(e.substring(t,i)),isNaN(t)?Ia:(i+=1)+t>e.length?gi:(e=e.substr(i,t),n.C=i+t,e))}function Fn(n){n.V=Date.now()+n.O,fc(n,n.O)}function fc(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=fr(se(n.gb,n),e)}function yi(n){n.B&&(j.clearTimeout(n.B),n.B=null)}function _r(n){0==n.l.G||n.I||Cc(n.l,n)}function Wt(n){yi(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,ur(n.T),fa(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function ba(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Sa(t.h,n)))if(!n.J&&Sa(t.h,n)&&3==t.G){try{var i=t.Fa.g.parse(e)}catch(m){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0])e:if(t.u)t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&0==t.A&&!t.v&&(t.v=fr(se(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Zs(t),Ht(t)}Pa(t),He(18)}if(1>=wc(t.h)&&t.ja){try{t.ja()}catch(m){}t.ja=void 0}}else Qt(t,11)}else if((n.J||t.g==n)&&Zs(t),!Xi(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let m=r[e];if(t.T=m[0],m=m[1],2==t.G)if("c"==m[0]){t.I=m[1],t.ka=m[2];const g=m[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const _=m[4];null!=_&&(t.Ca=_,t.j.info("SVER="+t.Ca));const w=m[5];null!=w&&"number"==typeof w&&0<w&&(t.J=i=1.5*w,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const k=n.g;if(k){const C=k.g?k.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(C){var s=i.h;s.g||-1==C.indexOf("spdy")&&-1==C.indexOf("quic")&&-1==C.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ca(s,s.h),s.h=null))}if(i.D){const M=k.g?k.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(i.za=M,pe(i.F,i.D,M))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((i=t).sa=Nc(i,i.H?i.ka:null,i.V),u.J){Eh(i.h,u);var d=u,f=i.J;f&&d.setTimeout(f),d.B&&(yi(d),Fn(d)),i.g=u}else Ma(i);0<t.i.length&&qs(t)}else"stop"!=m[0]&&"close"!=m[0]||Qt(t,7);else 3==t.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?Qt(t,7):Ac(t):"noop"!=m[0]&&t.l&&t.l.wa(m),t.A=0)}dr()}catch(m){}}function Ns(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(hs(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function pc(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(hs(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}(n),i=function wh(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(hs(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}for(i in e=[],t=0,n)e[t++]=n[i];return e}(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}(B=yr.prototype).setTimeout=function(n){this.O=n},B.ib=function(n){n=n.target;const e=this.L;e&&3==vt(n)?e.l():this.La(n)},B.La=function(n){try{if(n==this.g)e:{const g=vt(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>g)&&(3!=g||Xo||this.g&&(this.h.h||this.g.fa()||xc(this.g)))){this.I||4!=g||7==e||dr(),yi(this);var t=this.g.aa();this.Y=t;t:if(dc(this)){var i=xc(this.g);n="";var r=i.length,s=4==vt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Wt(this),_r(this);var u="";break t}this.h.i=new j.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function pa(n,e,t,i,r,s,u){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var d,f=this.g;if((d=f.g?f.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Xi(d)){var m=d;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,He(12),Wt(this),_r(this);break e}di(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,ba(this,t)}this.P?(Rs(this,g,u),Xo&&this.i&&3==g&&(ks(this.S,this.T,"tick",this.hb),this.T.start())):(di(this.j,this.m,u,null),ba(this,u)),4==g&&Wt(this),this.i&&!this.I&&(4==g?Cc(this.l,this):(this.i=!1,Fn(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,He(12)):(this.o=0,He(13)),Wt(this),_r(this)}}}catch(g){}},B.hb=function(){if(this.g){var n=vt(this.g),e=this.g.fa();this.C<e.length&&(yi(this),Rs(this,n,e),this.i&&4!=n&&Fn(this))}},B.cancel=function(){this.I=!0,Wt(this)},B.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function ma(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(dr(),He(17)),Wt(this),this.o=2,_r(this)):fc(this,this.V-n)};var mc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function cn(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof cn){this.h=void 0!==e?e:n.h,Os(this,n.j),this.s=n.s,this.g=n.g,Ms(this,n.m),this.l=n.l,e=n.i;var t=new _t;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),gc(this,t),this.o=n.o}else n&&(t=String(n).match(mc))?(this.h=!!e,Os(this,t[1]||"",!0),this.s=vr(t[2]||""),this.g=vr(t[3]||"",!0),Ms(this,t[4]),this.l=vr(t[5]||"",!0),gc(this,t[6]||"",!0),this.o=vr(t[7]||"")):(this.h=!!e,this.i=new _t(null,this.h))}function Kt(n){return new cn(n)}function Os(n,e,t){n.j=t?vr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ms(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function gc(n,e,t){e instanceof _t?(n.i=e,function xa(n,e){e&&!n.j&&(St(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(yc(this,i),vc(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Ir(e,wp)),n.i=new _t(e,n.h))}function pe(n,e,t){n.i.set(e,t)}function Ea(n){return pe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function vr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ir(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,_p),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function _p(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}cn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ir(e,bh,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Ir(e,bh,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Ir(t,"/"==t.charAt(0)?Ip:vp,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ir(t,Ta)),n.join("")};var bh=/[#\/\?@]/g,vp=/[#\?:]/g,Ip=/[#\?]/g,wp=/[#\?@]/g,Ta=/#/g;function _t(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function St(n){n.g||(n.g=new Map,n.h=0,n.i&&function _i(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function yc(n,e){St(n),e=vi(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function _c(n,e){return St(n),e=vi(n,e),n.g.has(e)}function vc(n,e,t){yc(n,e),0<t.length&&(n.i=null,n.g.set(vi(n,e),Ho(t)),n.h+=t.length)}function vi(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Ic(n){this.l=n||Ps,n=j.PerformanceNavigationTiming?0<(n=j.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(j.g&&j.g.Ga&&j.g.Ga()&&j.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(B=_t.prototype).add=function(n,e){St(this),this.i=null,n=vi(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},B.forEach=function(n,e){St(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)},B.oa=function(){St(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t},B.W=function(n){St(this);let e=[];if("string"==typeof n)_c(this,n)&&(e=e.concat(this.g.get(vi(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},B.set=function(n,e){return St(this),this.i=null,_c(this,n=vi(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},B.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},B.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const s=encodeURIComponent(String(i)),u=this.W(i);for(i=0;i<u.length;i++){var r=s;""!==u[i]&&(r+="="+encodeURIComponent(String(u[i]))),n.push(r)}}return this.i=n.join("&")};var Ps=10;function Aa(n){return!!n.h||!!n.g&&n.g.size>=n.j}function wc(n){return n.h?1:n.g?n.g.size:0}function Sa(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function Ca(n,e){n.g?n.g.add(e):n.h=e}function Eh(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function wr(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return Ho(n.i)}function bc(){}function ln(){this.g=new bc}function Th(n,e,t){const i=t||"";try{Ns(n,function(r,s){let u=r;Yi(r)&&(u=or(r)),e.push(i+s+"="+encodeURIComponent(u))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function hn(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(s){}}function br(n){this.l=n.ac||null,this.j=n.jb||!1}function _e(n,e){xe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Da,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ic.prototype.cancel=function(){if(this.i=wr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},bc.prototype.stringify=function(n){return j.JSON.stringify(n,void 0)},bc.prototype.parse=function(n){return j.JSON.parse(n,void 0)},Le(br,pr),br.prototype.g=function(){return new _e(this.l,this.j)},br.prototype.i=function(n){return function(){return n}}({}),Le(_e,xe);var Da=0;function Ls(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Er(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Un(n)}function Un(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(B=_e.prototype).open=function(n,e){if(this.readyState!=Da)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Un(this)},B.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||j).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},B.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Er(this)),this.readyState=Da},B.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Un(this)),this.g&&(this.readyState=3,Un(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==j.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ls(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},B.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Er(this):Un(this),3==this.readyState&&Ls(this)}},B.Va=function(n){this.g&&(this.response=this.responseText=n,Er(this))},B.Ua=function(n){this.g&&(this.response=n,Er(this))},B.ga=function(){this.g&&Er(this)},B.setRequestHeader=function(n,e){this.v.append(n,e)},B.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},B.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(_e.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var kh=j.JSON.parse;function ve(n){xe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ra,this.K=this.L=!1}Le(ve,xe);var Ra="",Ah=/^https?$/i,Fs=["POST","PUT"];function Ii(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Tr(n),wi(n)}function Tr(n){n.D||(n.D=!0,Fe(n,"complete"),Fe(n,"error"))}function Tc(n){if(n.h&&void 0!==cs&&(!n.C[1]||4!=vt(n)||2!=n.aa()))if(n.v&&4==vt(n))Ts(n.Ha,0,n);else if(Fe(n,"readystatechange"),4==vt(n)){n.h=!1;try{const d=n.aa();e:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=0===d){var r=String(n.H).match(mc)[1]||null;if(!r&&j.self&&j.self.location){var s=j.self.location.protocol;r=s.substr(0,s.length-1)}i=!Ah.test(r?r.toLowerCase():"")}t=i}if(t)Fe(n,"complete"),Fe(n,"success");else{n.m=6;try{var u=2<vt(n)?n.g.statusText:""}catch(f){u=""}n.j=u+" ["+n.aa()+"]",Tr(n)}}finally{wi(n)}}}function wi(n,e){if(n.g){Na(n);const t=n.g,i=n.C[0]?ls:null;n.g=null,n.C=null,e||Fe(n,"ready");try{t.onreadystatechange=i}catch(r){}}}function Na(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(j.clearTimeout(n.A),n.A=null)}function vt(n){return n.g?n.g.readyState:0}function xc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ra:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Us(n){let e="";return ra(n,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function Vs(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=Us(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):pe(n,e,t))}function xr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function kc(n){this.Ca=0,this.i=[],this.j=new hi,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=xr("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=xr("baseRetryDelayMs",5e3,n),this.bb=xr("retryDelaySeedMs",1e4,n),this.$a=xr("forwardChannelMaxRetries",2,n),this.ta=xr("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new Ic(n&&n.concurrentRequestLimit),this.Fa=new ln,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Ac(n){if(Sc(n),3==n.G){var e=n.U++,t=Kt(n.F);pe(t,"SID",n.I),pe(t,"RID",e),pe(t,"TYPE","terminate"),kr(n,t),(e=new yr(n,n.j,e,void 0)).K=2,e.v=Ea(Kt(t)),t=!1,j.navigator&&j.navigator.sendBeacon&&(t=j.navigator.sendBeacon(e.v.toString(),"")),!t&&j.Image&&((new Image).src=e.v,t=!0),t||(e.g=Oc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Fn(e)}Rc(n)}function Ht(n){n.g&&(La(n),n.g.cancel(),n.g=null)}function Sc(n){Ht(n),n.u&&(j.clearTimeout(n.u),n.u=null),Zs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&j.clearTimeout(n.m),n.m=null)}function qs(n){Aa(n.h)||n.m||(n.m=!0,ha(n.Ja,n),n.C=0)}function Bs(n,e){var t;t=e?e.m:n.U++;const i=Kt(n.F);pe(i,"SID",n.I),pe(i,"RID",t),pe(i,"AID",n.T),kr(n,i),n.o&&n.s&&Vs(i,n.o,n.s),t=new yr(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Oa(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),Ca(n.h,t),wa(t,i,e)}function kr(n,e){n.ia&&ra(n.ia,function(t,i){pe(e,i,t)}),n.l&&Ns({},function(t,i){pe(e,i,t)})}function Oa(n,e,t){t=Math.min(n.i.length,t);var i=n.l?se(n.l.Ra,n.l,n):null;e:{var r=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=r[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let d=!0;for(let f=0;f<t;f++){let m=r[f].h;const g=r[f].g;if(m-=s,0>m)s=Math.max(0,r[f].h-100),d=!1;else try{Th(g,u,"req"+m+"_")}catch(_){i&&i(g)}}if(d){i=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function Ma(n){n.g||n.u||(n.Z=1,ha(n.Ia,n),n.A=0)}function Pa(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=fr(se(n.Ia,n),Dc(n,n.A)),n.A++,0))}function La(n){null!=n.B&&(j.clearTimeout(n.B),n.B=null)}function Ar(n){n.g=new yr(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=Kt(n.sa);pe(e,"RID","rpc"),pe(e,"SID",n.I),pe(e,"CI",n.L?"0":"1"),pe(e,"AID",n.T),pe(e,"TYPE","xmlhttp"),kr(n,e),n.o&&n.s&&Vs(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Ea(Kt(e)),t.s=null,t.P=!0,Ds(t,n)}function Zs(n){null!=n.v&&(j.clearTimeout(n.v),n.v=null)}function Cc(n,e){var t=null;if(n.g==e){Zs(n),La(n),n.g=null;var i=2}else{if(!Sa(n.h,e))return;t=e.D,Eh(n.h,e),i=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==i){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;Fe(i=fi(),new Ss(i,t)),qs(n)}else Ma(n);else if(3==(r=e.o)||0==r&&0<n.pa||!(1==i&&function Sh(n,e){return!(wc(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=fr(se(n.Ja,n,e),Dc(n,n.C)),n.C++,0)))}(n,e)||2==i&&Pa(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:Qt(n,5);break;case 4:Qt(n,10);break;case 3:Qt(n,6);break;default:Qt(n,2)}}function Dc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function Qt(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var i=se(n.kb,n);t||(t=new cn("//www.google.com/images/cleardot.gif"),j.location&&"http"==j.location.protocol||Os(t,"https"),Ea(t)),function xh(n,e){const t=new hi;if(j.Image){const i=new Image;i.onload=Ji(hn,t,i,"TestLoadImage: loaded",!0,e),i.onerror=Ji(hn,t,i,"TestLoadImage: error",!1,e),i.onabort=Ji(hn,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=Ji(hn,t,i,"TestLoadImage: timeout",!1,e),j.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}(t.toString(),i)}else He(2);n.G=0,n.l&&n.l.va(e),Rc(n),Sc(n)}function Rc(n){if(n.G=0,n.la=[],n.l){const e=wr(n.h);(0!=e.length||0!=n.i.length)&&(Dn(n.la,e),Dn(n.la,n.i),n.h.i.length=0,Ho(n.i),n.i.length=0),n.l.ua()}}function Nc(n,e,t){var i=t instanceof cn?Kt(t):new cn(t,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),Ms(i,i.m);else{var r=j.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new cn(null,void 0);i&&Os(s,i),e&&(s.g=e),r&&Ms(s,r),t&&(s.l=t),i=s}return e=n.za,(t=n.D)&&e&&pe(i,t,e),pe(i,"VER",n.ma),kr(n,i),i}function Oc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ve(t&&n.Da&&!n.ra?new br({jb:!0}):n.ra)).Ka(n.H),e}function Mc(){}function Gs(){if(ui&&!(10<=Number(na)))throw Error("Environmental error: no available transport.")}function tt(n,e){xe.call(this),this.g=new kc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Xi(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Xi(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new bi(this)}function Pc(n){gr.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Lc(){ya.call(this),this.status=1}function bi(n){this.g=n}(B=ve.prototype).Ka=function(n){this.L=n},B.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():_a.g(),this.C=function lc(n){return n.h||(n.h=n.i())}(this.u?this.u:_a),this.g.onreadystatechange=se(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Ii(this,s)}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const s of i.keys())t.set(s,i.get(s))}i=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),r=j.FormData&&n instanceof j.FormData,!(0<=Ko(Fs,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Na(this),0<this.B&&((this.K=function Ec(n){return ui&&function ta(){return function fs(n){var e=mh;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=ds(String(ys)).split("."),t=ds("9").split("."),i=Math.max(e.length,t.length);for(let u=0;0==n&&u<i;u++){var r=e[u]||"",s=t[u]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;n=Yo(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||Yo(0==r[2].length,0==s[2].length)||Yo(r[2],s[2]),r=r[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=se(this.qa,this)):this.A=Ts(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Ii(this,s)}},B.qa=function(){void 0!==cs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Fe(this,"timeout"),this.abort(8))},B.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Fe(this,"complete"),Fe(this,"abort"),wi(this))},B.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),wi(this,!0)),ve.X.M.call(this)},B.Ha=function(){this.s||(this.F||this.v||this.l?Tc(this):this.fb())},B.fb=function(){Tc(this)},B.aa=function(){try{return 2<vt(this)?this.g.status:-1}catch(n){return-1}},B.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},B.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),kh(e)}},B.Ea=function(){return this.m},B.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(B=kc.prototype).ma=8,B.G=1,B.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new yr(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=_s(s),rc(s,this.S)):s=this.S),null!==this.o||this.N||(r.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var i=this.i[t];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Oa(this,r,e),pe(t=Kt(this.F),"RID",n),pe(t,"CVER",22),this.D&&pe(t,"X-HTTP-Session-Id",this.D),kr(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(Us(s)))+"&"+e:this.o&&Vs(t,this.o,s)),Ca(this.h,r),this.Ya&&pe(t,"TYPE","init"),this.O?(pe(t,"$req",e),pe(t,"SID","null"),r.Z=!0,wa(r,t,null)):wa(r,t,e),this.G=2}}else 3==this.G&&(n?Bs(this,n):0==this.i.length||Aa(this.h)||Bs(this))},B.Ia=function(){if(this.u=null,Ar(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=fr(se(this.eb,this),n)}},B.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,He(10),Ht(this),Ar(this))},B.cb=function(){null!=this.v&&(this.v=null,Ht(this),Pa(this),He(19))},B.kb=function(n){n?(this.j.info("Successfully pinged google.com"),He(2)):(this.j.info("Failed to ping google.com"),He(1))},(B=Mc.prototype).xa=function(){},B.wa=function(){},B.va=function(){},B.ua=function(){},B.Ra=function(){},Gs.prototype.g=function(n,e){return new tt(n,e)},Le(tt,xe),tt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;He(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Nc(n,null,n.V),qs(n)},tt.prototype.close=function(){Ac(this.g)},tt.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=or(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&qs(e)},tt.prototype.M=function(){this.g.l=null,delete this.j,Ac(this.g),delete this.g,tt.X.M.call(this)},Le(Pc,gr),Le(Lc,ya),Le(bi,Mc),bi.prototype.xa=function(){Fe(this.g,"a")},bi.prototype.wa=function(n){Fe(this.g,new Pc(n))},bi.prototype.va=function(n){Fe(this.g,new Lc)},bi.prototype.ua=function(){Fe(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,tt.prototype.send=tt.prototype.u,tt.prototype.open=tt.prototype.m,tt.prototype.close=tt.prototype.close,pi.NO_ERROR=0,pi.TIMEOUT=8,pi.HTTP_ERROR=6,ga.COMPLETE="complete",Cs.EventType=mr,mr.OPEN="a",mr.CLOSE="b",mr.ERROR="c",mr.MESSAGE="d",xe.prototype.listen=xe.prototype.N,ve.prototype.listenOnce=ve.prototype.O,ve.prototype.getLastError=ve.prototype.Oa,ve.prototype.getLastErrorCode=ve.prototype.Ea,ve.prototype.getStatus=ve.prototype.aa,ve.prototype.getResponseJson=ve.prototype.Sa,ve.prototype.getResponseText=ve.prototype.fa,ve.prototype.send=ve.prototype.da,ve.prototype.setWithCredentials=ve.prototype.Ka;var Fa=st.createWebChannelTransport=function(){return new Gs},Ch=st.getStatEventTarget=function(){return fi()},Sr=st.ErrorCode=pi,Dh=st.EventType=ga,Ua=st.Event=jt,Fc=st.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Va=st.FetchXmlHttpFactory=br,Vn=st.WebChannel=Cs,qa=st.XhrIo=ve;const Uc="@firebase/firestore";class Ce{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");let Ct="9.15.0";const nt=new Tt.Yd("@firebase/firestore");function Cr(){return nt.logLevel}function N(n,...e){if(nt.logLevel<=Tt.in.DEBUG){const t=e.map(zs);nt.debug(`Firestore (${Ct}): ${n}`,...t)}}function ke(n,...e){if(nt.logLevel<=Tt.in.ERROR){const t=e.map(zs);nt.error(`Firestore (${Ct}): ${n}`,...t)}}function Yt(n,...e){if(nt.logLevel<=Tt.in.WARN){const t=e.map(zs);nt.warn(`Firestore (${Ct}): ${n}`,...t)}}function zs(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function U(n="Unexpected state"){const e=`FIRESTORE (${Ct}) INTERNAL ASSERTION FAILED: `+n;throw ke(e),new Error(e)}function Z(n,e){n||U()}function P(n,e){return n}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class S extends re.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ae{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $s{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Nh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}}class Dr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Oh{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var i=this;let r=this.i;const s=m=>this.i!==r?(r=this.i,t(m)):Promise.resolve();let u=new Ae;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Ae,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const m=u;e.enqueueRetryable((0,T.Z)(function*(){yield m.promise,yield s(i.currentUser)}))},f=m=>{N("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(N("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Ae)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(N("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(Z("string"==typeof i.accessToken),new $s(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Z(null===e||"string"==typeof e),new Ce(e)}}class Mh{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Z(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Za{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r}getToken(){return Promise.resolve(new Mh(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class js{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ga{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=s=>{null!=s.error&&N("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,N("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{N("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?r(s):N("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Z("string"==typeof t.token),this.A=t.token,new js(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function za(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class $a{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const r=za(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}}function W(n,e){return n<e?-1:n>e?1:0}function Ei(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function Vc(n){return n+"\0"}class le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new S(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new S(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new S(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new S(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new le(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new le(0,0))}static max(){return new G(new le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Rr{constructor(e,t,i){void 0===t?t=0:t>e.length&&U(),void 0===i?i=e.length-t:i>e.length-t&&U(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return 0===Rr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Rr?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),u=t.get(r);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class X extends Rr{construct(e,t,i){return new X(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new S(E.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new X(t)}static emptyPath(){return new X([])}}const Ph=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Ie extends Rr{construct(e,t,i){return new Ie(e,t,i)}static isValidIdentifier(e){return Ph.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Ie.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new Ie(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(0===i.length)throw new S(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let u=!1;for(;r<e.length;){const d=e[r];if("\\"===d){if(r+1===e.length)throw new S(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[r+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new S(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,r+=2}else"`"===d?(u=!u,r++):"."!==d||u?(i+=d,r++):(s(),r++)}if(s(),u)throw new S(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new Ie(t)}static emptyPath(){return new Ie([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(X.fromString(e))}static fromName(e){return new O(X.fromString(e).popFirst(5))}static empty(){return new O(X.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===X.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return X.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new X(e.slice()))}}class Ws{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function Nr(n){return n.fields.find(e=>2===e.kind)}function Dt(n){return n.fields.filter(e=>2!==e.kind)}Ws.UNKNOWN_ID=-1;class Or{constructor(e,t){this.fieldPath=e,this.kind=t}}class Mr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Mr(0,it.min())}}function Ka(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=G.fromTimestamp(1e9===i?new le(t+1,0):new le(t,i));return new it(r,O.empty(),e)}function Ha(n){return new it(n.readTime,n.key,-1)}class it{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new it(G.min(),O.empty(),-1)}static max(){return new it(G.max(),O.empty(),-1)}}function Qa(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(n.documentKey,e.documentKey),0!==t?t:W(n.largestBatchId,e.largestBatchId))}const Ya="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ks{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function dn(n){return Ja.apply(this,arguments)}function Ja(){return Ja=(0,T.Z)(function*(n){if(n.code!==E.FAILED_PRECONDITION||n.message!==Ya)throw n;N("LocalStore","Unexpectedly lost primary lease")}),Ja.apply(this,arguments)}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,i)=>{t(e)})}static reject(e){return new b((t,i)=>{i(e)})}static waitFor(e){return new b((t,i)=>{let r=0,s=0,u=!1;e.forEach(d=>{++r,d.next(()=>{++s,u&&s===r&&t()},f=>i(f))}),u=!0,s===r&&t()})}static or(e){let t=b.resolve(!1);for(const i of e)t=t.next(r=>r?b.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new b((i,r)=>{const s=e.length,u=new Array(s);let d=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(g=>{u[m]=g,++d,d===s&&i(u)},g=>r(g))}})}static doWhile(e,t){return new b((i,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):i()};s()})}}class Ti{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Ae,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new xi(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const r=Xa(i.target.error);this.P.reject(new xi(e,r))}}static open(e,t,i,r){try{return new Ti(t,e.transaction(r,i))}catch(s){throw new xi(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(N("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Hs(t)}}class It{constructor(e,t,i){this.name=e,this.version=t,this.S=i,12.2===It.D((0,re.z$)())&&ke("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return N("SimpleDb","Removing database:",e),qn(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,re.hl)())return!1;if(It.N())return!0;const e=(0,re.z$)(),t=It.D(e),i=0<t&&t<10,r=It.k(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}F(e){var t=this;return(0,T.Z)(function*(){return t.db||(N("SimpleDb","Opening database:",t.name),t.db=yield new Promise((i,r)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{i(u.target.result)},s.onblocked=()=>{r(new xi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const d=u.target.error;r("VersionError"===d.name?new S(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new S(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new xi(e,d))},s.onupgradeneeded=u=>{N("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{N("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=i=>t.B(i)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){var s=this;return(0,T.Z)(function*(){const u="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.F(e);const f=Ti.open(s.db,e,u?"readonly":"readwrite",i),m=r(f).next(g=>(f.V(),g)).catch(g=>(f.abort(g),b.reject(g))).toPromise();return m.catch(()=>{}),yield f.v,m}catch(f){const m=f,g="FirebaseError"!==m.name&&d<3;if(N("SimpleDb","Transaction failed with error:",m.message,"Retrying:",g),s.close(),!g)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Lh{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return qn(this.q.delete())}}class xi extends S{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function fn(n){return"IndexedDbTransactionError"===n.name}class Hs{constructor(e){this.store=e}put(e,t){let i;return void 0!==t?(N("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(N("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),qn(i)}add(e){return N("SimpleDb","ADD",this.store.name,e,e),qn(this.store.add(e))}get(e){return qn(this.store.get(e)).next(t=>(void 0===t&&(t=null),N("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return N("SimpleDb","DELETE",this.store.name,e),qn(this.store.delete(e))}count(){return N("SimpleDb","COUNT",this.store.name),qn(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||"function"!=typeof this.store.getAll){const r=this.cursor(i),s=[];return this.H(r,(u,d)=>{s.push(d)}).next(()=>s)}{const r=this.store.getAll(i.range);return new b((s,u)=>{r.onerror=d=>{u(d.target.error)},r.onsuccess=d=>{s(d.target.result)}})}}J(e,t){const i=this.store.getAll(e,null===t?void 0:t);return new b((r,s)=>{i.onerror=u=>{s(u.target.error)},i.onsuccess=u=>{r(u.target.result)}})}Y(e,t){N("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const r=this.cursor(i);return this.H(r,(s,u,d)=>d.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.H(r,t)}tt(e){const t=this.cursor({});return new b((i,r)=>{t.onerror=s=>{const u=Xa(s.target.error);r(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(d=>{d?u.continue():i()}):i()}})}H(e,t){const i=[];return new b((r,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const d=u.target.result;if(!d)return void r();const f=new Lh(d),m=t(d.primaryKey,d.value,f);if(m instanceof b){const g=m.catch(_=>(f.done(),b.reject(_)));i.push(g)}f.isDone?r():null===f.G?d.continue():d.continue(f.G)}}).next(()=>b.waitFor(i))}options(e,t){let i;return void 0!==e&&("string"==typeof e?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function qn(n){return new b((e,t)=>{n.onsuccess=i=>{e(i.target.result)},n.onerror=i=>{const r=Xa(i.target.error);t(r)}})}let qc=!1;function Xa(n){const e=It.D((0,re.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new S("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return qc||(qc=!0,setTimeout(()=>{throw i},0)),i}}return n}class Fh{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;N("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,T.Z)(function*(){t.task=null;try{N("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(i){fn(i)?N("IndexBackiller","Ignoring IndexedDB error during index backfill: ",i):yield dn(i)}yield t.nt(6e4)}))}}class Uh{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,T.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",i=>t.it(i,e))})()}it(e,t){const i=new Set;let r=t,s=!0;return b.doWhile(()=>!0===s&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!i.has(u))return N("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,r).next(d=>{r-=d,i.add(u)});s=!1})).next(()=>t-r)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(r,s)).next(d=>(N("IndexBackiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>u.size)}))}ot(e,t){let i=e;return t.changes.forEach((r,s)=>{const u=Ha(s);Qa(u,i)>0&&(i=u)}),new it(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ot=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>i.writeSequenceNumber(r))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Vh{constructor(e,t,i,r,s,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=d,this.useFetchStreams=f}}class pn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new pn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof pn&&e.projectId===this.projectId&&e.database===this.database}}function Qs(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Bn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Bc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Pr(n){return null==n}function Lr(n){return 0===n&&1/n==-1/0}function Zc(n){return"number"==typeof n&&Number.isInteger(n)&&!Lr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class Ne{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Ne(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new Ne(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Ne.EMPTY_BYTE_STRING=new Ne("");const qh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(n){if(Z(!!n),"string"==typeof n){let e=0;const t=qh.exec(n);if(Z(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Jt(n){return"string"==typeof n?Ne.fromBase64String(n):Ne.fromUint8Array(n)}function eu(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ys(n){const e=n.mapValue.fields.__previous_value__;return eu(e)?Ys(e):e}function Fr(n){const e=mn(n.mapValue.fields.__local_write_time__.timestampValue);return new le(e.seconds,e.nanos)}const Xt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Js={nullValue:"NULL_VALUE"};function en(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?eu(n)?4:jc(n)?9007199254740991:10:U()}function Rt(n,e){if(n===e)return!0;const t=en(n);if(t!==en(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Fr(n).isEqual(Fr(e));case 3:return function(i,r){if("string"==typeof i.timestampValue&&"string"==typeof r.timestampValue&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=mn(i.timestampValue),u=mn(r.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,Jt(n.bytesValue).isEqual(Jt(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return we(i.geoPointValue.latitude)===we(r.geoPointValue.latitude)&&we(i.geoPointValue.longitude)===we(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return we(i.integerValue)===we(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=we(i.doubleValue),u=we(r.doubleValue);return s===u?Lr(s)===Lr(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Ei(n.arrayValue.values||[],e.arrayValue.values||[],Rt);case 10:return function(i,r){const s=i.mapValue.fields||{},u=r.mapValue.fields||{};if(Qs(s)!==Qs(u))return!1;for(const d in s)if(s.hasOwnProperty(d)&&(void 0===u[d]||!Rt(s[d],u[d])))return!1;return!0}(n,e);default:return U()}var r}function ki(n,e){return void 0!==(n.values||[]).find(t=>Rt(t,e))}function tn(n,e){if(n===e)return 0;const t=en(n),i=en(e);if(t!==i)return W(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return function(r,s){const u=we(r.integerValue||r.doubleValue),d=we(s.integerValue||s.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1}(n,e);case 3:return zc(n.timestampValue,e.timestampValue);case 4:return zc(Fr(n),Fr(e));case 5:return W(n.stringValue,e.stringValue);case 6:return function(r,s){const u=Jt(r),d=Jt(s);return u.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const u=r.split("/"),d=s.split("/");for(let f=0;f<u.length&&f<d.length;f++){const m=W(u[f],d[f]);if(0!==m)return m}return W(u.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const u=W(we(r.latitude),we(s.latitude));return 0!==u?u:W(we(r.longitude),we(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const u=r.values||[],d=s.values||[];for(let f=0;f<u.length&&f<d.length;++f){const m=tn(u[f],d[f]);if(m)return m}return W(u.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){if(r===Xt.mapValue&&s===Xt.mapValue)return 0;if(r===Xt.mapValue)return 1;if(s===Xt.mapValue)return-1;const u=r.fields||{},d=Object.keys(u),f=s.fields||{},m=Object.keys(f);d.sort(),m.sort();for(let g=0;g<d.length&&g<m.length;++g){const _=W(d[g],m[g]);if(0!==_)return _;const w=tn(u[d[g]],f[m[g]]);if(0!==w)return w}return W(d.length,m.length)}(n.mapValue,e.mapValue);default:throw U()}}function zc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return W(n,e);const t=mn(n),i=mn(e),r=W(t.seconds,i.seconds);return 0!==r?r:W(t.nanos,i.nanos)}function Ai(n){return tu(n)}function tu(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=mn(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Jt(n.bytesValue).toBase64():"referenceValue"in n?O.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const u of i.values||[])s?s=!1:r+=",",r+=tu(u);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",u=!0;for(const d of r)u?u=!1:s+=",",s+=`${d}:${tu(i.fields[d])}`;return s+"}"}(n.mapValue):U();var e}function Zn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function nu(n){return!!n&&"integerValue"in n}function Si(n){return!!n&&"arrayValue"in n}function $c(n){return!!n&&"nullValue"in n}function Bh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Nt(n){return!!n&&"mapValue"in n}function Ur(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Bn(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Ur(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Ur(n.arrayValue.values[t]);return e}return Object.assign({},n)}function jc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function iu(n){return"nullValue"in n?Js:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Zn(pn.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:U()}function Zh(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Zn(pn.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Xt:U()}function Xs(n,e){const t=tn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Wc(n,e){const t=tn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class gn{constructor(e,t){this.position=e,this.inclusive=t}}function eo(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],u=n.position[r];if(i=s.field.isKeyField()?O.comparator(O.fromName(u.referenceValue),t.key):tn(u,t.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function Kc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Rt(n.position[t],e.position[t]))return!1;return!0}class Hc{}class Y extends Hc{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,i):new ou(e,t,i):"array-contains"===t?new no(e,i):"in"===t?new tl(e,i):"not-in"===t?new zh(e,i):"array-contains-any"===t?new $h(e,i):new Y(e,t,i)}static createKeyFieldInFilter(e,t,i){return"in"===t?new au(e,i):new Gh(e,i)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(tn(t,this.value)):null!==t&&en(this.value)===en(t)&&this.matchesComparison(tn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ue extends Hc{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ue(e,t)}matches(e){return Ci(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Ci(n){return"and"===n.op}function ru(n){return"or"===n.op}function Qc(n){return Yc(n)&&Ci(n)}function Yc(n){for(const e of n.filters)if(e instanceof ue)return!1;return!0}function su(n){if(n instanceof Y)return n.field.canonicalString()+n.op.toString()+Ai(n.value);{const e=n.filters.map(t=>su(t)).join(",");return`${n.op}(${e})`}}function to(n,e){return n instanceof Y?(t=n,(i=e)instanceof Y&&t.op===i.op&&t.field.isEqual(i.field)&&Rt(t.value,i.value)):n instanceof ue?function(t,i){return i instanceof ue&&t.op===i.op&&t.filters.length===i.filters.length&&t.filters.reduce((r,s,u)=>r&&to(s,i.filters[u]),!0)}(n,e):void U();var t,i}function Jc(n,e){const t=n.filters.concat(e);return ue.create(t,n.op)}function Xc(n){return n instanceof Y?`${(e=n).field.canonicalString()} ${e.op} ${Ai(e.value)}`:n instanceof ue?function(e){return e.op.toString()+" {"+e.getFilters().map(Xc).join(" ,")+"}"}(n):"Filter";var e}class ou extends Y{constructor(e,t,i){super(e,t,i),this.key=O.fromName(i.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class au extends Y{constructor(e,t){super(e,"in",t),this.keys=el(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Gh extends Y{constructor(e,t){super(e,"not-in",t),this.keys=el(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function el(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(i=>O.fromName(i.referenceValue))}class no extends Y{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Si(t)&&ki(t.arrayValue,this.value)}}class tl extends Y{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&ki(this.value.arrayValue,t)}}class zh extends Y{constructor(e,t){super(e,"not-in",t)}matches(e){if(ki(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!ki(this.value.arrayValue,t)}}class $h extends Y{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Si(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>ki(this.value.arrayValue,i))}}class Gn{constructor(e,t="asc"){this.field=e,this.dir=t}}function jh(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class be{constructor(e,t){this.comparator=e,this.root=t||Ve.EMPTY}insert(e,t){return new be(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Ve.BLACK,null,null))}remove(e){return new be(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Ve.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(0===i)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(0===r)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new io(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new io(this.root,e,this.comparator,!1)}getReverseIterator(){return new io(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new io(this.root,e,this.comparator,!0)}}class io{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Ve{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=null!=i?i:Ve.RED,this.left=null!=r?r:Ve.EMPTY,this.right=null!=s?s:Ve.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Ve(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ve.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Ve.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Ve.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Ve.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();const e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}}Ve.EMPTY=null,Ve.RED=!0,Ve.BLACK=!1,Ve.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(n,e,t,i,r){return this}insert(n,e,t){return new Ve(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class oe{constructor(e){this.comparator=e,this.data=new be(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new nl(this.data.getIterator())}getIteratorFrom(e){return new nl(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof oe)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(0!==this.comparator(r,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new oe(this.comparator);return t.data=e,t}}class nl{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function zn(n){return n.hasNext()?n.getNext():void 0}class at{constructor(e){this.fields=e,e.sort(Ie.comparator)}static empty(){return new at([])}unionWith(e){let t=new oe(Ie.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new at(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ei(this.fields,e.fields,(t,i)=>t.isEqual(i))}}class qe{constructor(e){this.value=e}static empty(){return new qe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Nt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Ur(t)}setAll(e){let t=Ie.emptyPath(),i={},r=[];e.forEach((u,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,i,r),i={},r=[],t=d.popLast()}u?i[d.lastSegment()]=Ur(u):r.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Nt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Nt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Bn(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new qe(Ur(this.value))}}function il(n){const e=[];return Bn(n.fields,(t,i)=>{const r=new Ie([t]);if(Nt(i)){const s=il(i.mapValue).fields;if(0===s.length)e.push(r);else for(const u of s)e.push(r.child(u))}else e.push(r)}),new at(e)}class de{constructor(e,t,i,r,s,u,d){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=u,this.documentState=d}static newInvalidDocument(e){return new de(e,0,G.min(),G.min(),G.min(),qe.empty(),0)}static newFoundDocument(e,t,i,r){return new de(e,1,t,G.min(),i,r,0)}static newNoDocument(e,t){return new de(e,2,t,G.min(),G.min(),qe.empty(),0)}static newUnknownDocument(e,t){return new de(e,3,t,G.min(),G.min(),qe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=qe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=qe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof de&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new de(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class rl{constructor(e,t=null,i=[],r=[],s=null,u=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=u,this.endAt=d,this.ft=null}}function Vr(n,e=null,t=[],i=[],r=null,s=null,u=null){return new rl(n,e,t,i,r,s,u)}function nn(n){const e=P(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>su(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>{return(r=i).field.canonicalString()+r.dir;var r}).join(","),Pr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ai(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ai(i)).join(",")),e.ft=t}return e.ft}function Di(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!jh(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!to(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!Kc(n.startAt,e.startAt)&&Kc(n.endAt,e.endAt)}function ro(n){return O.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Ri(n,e){return n.filters.filter(t=>t instanceof Y&&t.field.isEqual(e))}function sl(n,e,t){let i=Js,r=!0;for(const s of Ri(n,e)){let u=Js,d=!0;switch(s.op){case"<":case"<=":u=iu(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,d=!1;break;case"!=":case"not-in":u=Js}Xs({value:i,inclusive:r},{value:u,inclusive:d})<0&&(i=u,r=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Xs({value:i,inclusive:r},{value:u,inclusive:t.inclusive})<0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}function rt(n,e,t){let i=Xt,r=!0;for(const s of Ri(n,e)){let u=Xt,d=!0;switch(s.op){case">=":case">":u=Zh(s.value),d=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,d=!1;break;case"!=":case"not-in":u=Xt}Wc({value:i,inclusive:r},{value:u,inclusive:d})>0&&(i=u,r=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Wc({value:i,inclusive:r},{value:u,inclusive:t.inclusive})>0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}class ut{constructor(e,t=null,i=[],r=[],s=null,u="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=u,this.startAt=d,this.endAt=f,this.dt=null,this._t=null}}function uu(n,e,t,i,r,s,u,d){return new ut(n,e,t,i,r,s,u,d)}function Ni(n){return new ut(n)}function so(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function qr(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function oo(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function ao(n){return null!==n.collectionGroup}function $n(n){const e=P(n);if(null===e.dt){e.dt=[];const t=oo(e),i=qr(e);if(null!==t&&null===i)t.isKeyField()||e.dt.push(new Gn(t)),e.dt.push(new Gn(Ie.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Gn(Ie.keyField(),s))}}}return e.dt}function Ee(n){const e=P(n);if(!e._t)if("F"===e.limitType)e._t=Vr(e.path,e.collectionGroup,$n(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of $n(e))t.push(new Gn(s.field,"desc"===s.dir?"asc":"desc"));const i=e.endAt?new gn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new gn(e.startAt.position,e.startAt.inclusive):null;e._t=Vr(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e._t}function uo(n,e){e.getFirstInequalityField(),oo(n);const t=n.filters.concat([e]);return new ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function co(n,e,t){return new ut(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Br(n,e){return Di(Ee(n),Ee(e))&&n.limitType===e.limitType}function ol(n){return`${nn(Ee(n))}|lt:${n.limitType}`}function lo(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>Xc(i)).join(", ")}]`),Pr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>{return`${(r=i).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ai(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ai(i)).join(",")),`Target(${t})`}(Ee(n))}; limitType=${n.limitType})`}function ze(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return null!==t.collectionGroup?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):O.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of $n(t))if(!r.field.isKeyField()&&null===i.data.field(r.field))return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&(i=e,!((t=n).startAt&&!function(r,s,u){const d=eo(r,s,u);return r.inclusive?d<=0:d<0}(t.startAt,$n(t),i)||t.endAt&&!function(r,s,u){const d=eo(r,s,u);return r.inclusive?d>=0:d>0}(t.endAt,$n(t),i)));var t,i}function ho(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fo(n){return(e,t)=>{let i=!1;for(const r of $n(n)){const s=Wh(r,e,t);if(0!==s)return s;i=i||r.field.isKeyField()}return 0}}function Wh(n,e,t){const i=n.field.isKeyField()?O.comparator(e.key,t.key):function(r,s,u){const d=s.data.field(r),f=u.data.field(r);return null!==d&&null!==f?tn(d,f):U()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return U()}}function Ot(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Lr(e)?"-0":e}}function Oi(n){return{integerValue:""+n}}function cu(n,e){return Zc(e)?Oi(e):Ot(n,e)}class Zr{constructor(){this._=void 0}}function Kh(n,e,t){return n instanceof Mi?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof jn?ul(n,e):n instanceof c?o(n,e):function(i,r){const s=al(i,r),u=l(s)+l(i.gt);return nu(s)&&nu(i.gt)?Oi(u):Ot(i.yt,u)}(n,e)}function lu(n,e,t){return n instanceof jn?ul(n,e):n instanceof c?o(n,e):t}function al(n,e){return n instanceof a?nu(t=e)||(i=t)&&"doubleValue"in i?e:{integerValue:0}:null;var i,t}class Mi extends Zr{}class jn extends Zr{constructor(e){super(),this.elements=e}}function ul(n,e){const t=p(e);for(const i of n.elements)t.some(r=>Rt(r,i))||t.push(i);return{arrayValue:{values:t}}}class c extends Zr{constructor(e){super(),this.elements=e}}function o(n,e){let t=p(e);for(const i of n.elements)t=t.filter(r=>!Rt(r,i));return{arrayValue:{values:t}}}class a extends Zr{constructor(e,t){super(),this.yt=e,this.gt=t}}function l(n){return we(n.integerValue||n.doubleValue)}function p(n){return Si(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class y{constructor(e,t){this.field=e,this.transform=t}}class x{constructor(e,t){this.version=e,this.transformResults=t}}class A{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new A}static exists(e){return new A(void 0,e)}static updateTime(e){return new A(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function L(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ${}function z(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Wn(n.key,A.none()):new yn(n.key,n.data,A.none());{const t=n.data,i=qe.empty();let r=new oe(Ie.comparator);for(let s of e.fields)if(!r.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?i.delete(s):i.set(s,u),r=r.add(s)}return new Mt(n.key,i,new at(r.toArray()),A.none())}}function Oe(n,e,t){n instanceof yn?function(i,r,s){const u=i.value.clone(),d=mo(i.fieldTransforms,r,s.transformResults);u.setAll(d),r.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Mt?function(i,r,s){if(!L(i.precondition,r))return void r.convertToUnknownDocument(s.version);const u=mo(i.fieldTransforms,r,s.transformResults),d=r.data;d.setAll(du(i)),d.setAll(u),r.convertToFoundDocument(s.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Qe(n,e,t,i){return n instanceof yn?function(r,s,u,d){if(!L(r.precondition,s))return u;const f=r.value.clone(),m=fu(r.fieldTransforms,d,s);return f.setAll(m),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,i):n instanceof Mt?function(r,s,u,d){if(!L(r.precondition,s))return u;const f=fu(r.fieldTransforms,d,s),m=s.data;return m.setAll(du(r)),m.setAll(f),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===u?null:u.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(g=>g.field))}(n,e,t,i):(u=t,L(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function po(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=al(i.transform,r||null);null!=s&&(null===t&&(t=qe.empty()),t.set(i.field,s))}return t||null}function hu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===i||t&&i&&Ei(t,i,(r,s)=>function v(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(t=n.transform)instanceof jn&&i instanceof jn||t instanceof c&&i instanceof c?Ei(t.elements,i.elements,Rt):t instanceof a&&i instanceof a?Rt(t.gt,i.gt):t instanceof Mi&&i instanceof Mi);var t,i}(r,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,i}class yn extends ${constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Mt extends ${constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function du(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function mo(n,e,t){const i=new Map;Z(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],u=s.transform,d=e.data.field(s.field);i.set(s.field,lu(u,d,t[r]))}return i}function fu(n,e,t){const i=new Map;for(const r of n){const s=r.transform,u=t.data.field(r.field);i.set(r.field,Kh(s,u,e))}return i}class Wn extends ${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Gr extends ${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class cl{constructor(e){this.count=e}}var De,ee;function ll(n){switch(n){default:return U();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function Ep(n){if(void 0===n)return ke("GRPC error has no .code"),E.UNKNOWN;switch(n){case De.OK:return E.OK;case De.CANCELLED:return E.CANCELLED;case De.UNKNOWN:return E.UNKNOWN;case De.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case De.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case De.INTERNAL:return E.INTERNAL;case De.UNAVAILABLE:return E.UNAVAILABLE;case De.UNAUTHENTICATED:return E.UNAUTHENTICATED;case De.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case De.NOT_FOUND:return E.NOT_FOUND;case De.ALREADY_EXISTS:return E.ALREADY_EXISTS;case De.PERMISSION_DENIED:return E.PERMISSION_DENIED;case De.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case De.ABORTED:return E.ABORTED;case De.OUT_OF_RANGE:return E.OUT_OF_RANGE;case De.UNIMPLEMENTED:return E.UNIMPLEMENTED;case De.DATA_LOSS:return E.DATA_LOSS;default:return U()}}(ee=De||(De={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";class Pi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0!==i)for(const[r,s]of i)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(void 0===r)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return 1===i.length?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Bn(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return Bc(this.inner)}size(){return this.innerSize}}const jy=new be(O.comparator);function gt(){return jy}const Tp=new be(O.comparator);function pu(...n){let e=Tp;for(const t of n)e=e.insert(t.key,t);return e}function xp(n){let e=Tp;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function _n(){return mu()}function kp(){return mu()}function mu(){return new Pi(n=>n.toString(),(n,e)=>n.isEqual(e))}const Wy=new be(O.comparator),Ky=new oe(O.comparator);function H(...n){let e=Ky;for(const t of n)e=e.add(t);return e}const Hy=new oe(W);function hl(){return Hy}class gu{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,yu.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new gu(G.min(),r,hl(),gt(),H())}}class yu{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new yu(i,t,H(),H(),H())}}class dl{constructor(e,t,i,r){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=r}}class Ap{constructor(e,t){this.targetId=e,this.Et=t}}class Sp{constructor(e,t,i=Ne.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class Cp{constructor(){this.At=0,this.Rt=Rp(),this.bt=Ne.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=H(),t=H(),i=H();return this.Rt.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:U()}}),new yu(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=Rp()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Qy{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=gt(),this.qt=Dp(),this.Ut=new oe(W)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,r)=>{this.zt(r)&&t(r)})}Jt(e){const t=e.targetId,i=e.Et.count,r=this.Yt(t);if(r){const s=r.target;if(ro(s))if(0===i){const u=new O(s.path);this.Qt(t,u,de.newNoDocument(u,G.min()))}else Z(1===i);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,u)=>{const d=this.Yt(u);if(d){if(s.current&&ro(d.target)){const f=new O(d.target.path);null!==this.Lt.get(f)||this.te(u,f)||this.Qt(u,f,de.newNoDocument(f,e))}s.St&&(t.set(u,s.Ct()),s.xt())}});let i=H();this.qt.forEach((s,u)=>{let d=!0;u.forEachWhile(f=>{const m=this.Yt(f);return!m||2===m.purpose||(d=!1,!1)}),d&&(i=i.add(s))}),this.Lt.forEach((s,u)=>u.setReadTime(e));const r=new gu(e,t,this.Ut,this.Lt,i);return this.Lt=gt(),this.qt=Dp(),this.Ut=new oe(W),r}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Cp,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new oe(W),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||N("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Cp),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Dp(){return new be(O.comparator)}function Rp(){return new be(O.comparator)}const Yy={asc:"ASCENDING",desc:"DESCENDING"},Jy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Xy={and:"AND",or:"OR"};class e_{constructor(e,t){this.databaseId=e,this.wt=t}}function go(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Np(n,e){return n.wt?e.toBase64():e.toUint8Array()}function t_(n,e){return go(n,e.toTimestamp())}function Me(n){return Z(!!n),G.fromTimestamp(function(e){const t=mn(e);return new le(t.seconds,t.nanos)}(n))}function Hh(n,e){return(t=n,new X(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Op(n){const e=X.fromString(n);return Z(Zp(e)),e}function _u(n,e){return Hh(n.databaseId,e.path)}function vn(n,e){const t=Op(e);if(t.get(1)!==n.databaseId.projectId)throw new S(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new S(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(Pp(t))}function Qh(n,e){return Hh(n.databaseId,e)}function Mp(n){const e=Op(n);return 4===e.length?X.emptyPath():Pp(e)}function vu(n){return new X(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Pp(n){return Z(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Lp(n,e,t){return{name:_u(n,e),fields:t.value.mapValue.fields}}function Fp(n,e,t){const i=vn(n,e.name),r=Me(e.updateTime),s=e.createTime?Me(e.createTime):G.min(),u=new qe({mapValue:{fields:e.fields}}),d=de.newFoundDocument(i,r,s,u);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function Iu(n,e){let t;if(e instanceof yn)t={update:Lp(n,e.key,e.value)};else if(e instanceof Wn)t={delete:_u(n,e.key)};else if(e instanceof Mt)t={update:Lp(n,e.key,e.data),updateMask:c_(e.fieldMask)};else{if(!(e instanceof Gr))return U();t={verify:_u(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const u=s.transform;if(u instanceof Mi)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof jn)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof c)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof a)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw U()}(0,i))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:t_(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:U()),t;var r}function Yh(n,e){const t=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?A.updateTime(Me(r.updateTime)):void 0!==r.exists?A.exists(r.exists):A.none():A.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,u){let d=null;"setToServerValue"in u?(Z("REQUEST_TIME"===u.setToServerValue),d=new Mi):"appendMissingElements"in u?d=new jn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?d=new c(u.removeAllFromArray.values||[]):"increment"in u?d=new a(s,u.increment):U();const f=Ie.fromServerFormat(u.fieldPath);return new y(f,d)}(n,r)):[];var r;if(e.update){const r=vn(n,e.update.name),s=new qe({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new at((e.updateMask.fieldPaths||[]).map(m=>Ie.fromServerFormat(m)));return new Mt(r,s,u,t,i)}return new yn(r,s,t,i)}if(e.delete){const r=vn(n,e.delete);return new Wn(r,t)}if(e.verify){const r=vn(n,e.verify);return new Gr(r,t)}return U()}function Up(n,e){return{documents:[Qh(n,e.path)]}}function Jh(n,e){const t={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(t.parent=Qh(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Qh(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(f){if(0!==f.length)return Bp(ue.create(f,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(f){if(0!==f.length)return f.map(m=>{return{field:yo((g=m).field),direction:o_(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(m=e.limit,n.wt||Pr(m)?m:{value:m});var m,d,f;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt={before:!(f=e.endAt).inclusive,values:f.position}),t}function Vp(n){let e=Mp(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){Z(1===i);const g=t.from[0];g.allDescendants?r=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(g){const _=qp(g);return _ instanceof ue&&Qc(_)?_.getFilters():[_]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new Gn(_o((_=g).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let d=null;t.limit&&(d=function(g){let _;return _="object"==typeof g?g.value:g,Pr(_)?null:_}(t.limit));let f=null;var g;t.startAt&&(f=new gn((g=t.startAt).values||[],!!g.before));let m=null;return t.endAt&&(m=function(g){return new gn(g.values||[],!g.before)}(t.endAt)),uu(e,r,u,s,d,"F",f,m)}function qp(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=_o(e.unaryFilter.field);return Y.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=_o(e.unaryFilter.field);return Y.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=_o(e.unaryFilter.field);return Y.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=_o(e.unaryFilter.field);return Y.create(s,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):void 0!==n.fieldFilter?Y.create(_o((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return ue.create(e.compositeFilter.filters.map(t=>qp(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return U()}}(e.compositeFilter.op))}(n):U();var e}function o_(n){return Yy[n]}function a_(n){return Jy[n]}function u_(n){return Xy[n]}function yo(n){return{fieldPath:n.canonicalString()}}function _o(n){return Ie.fromServerFormat(n.fieldPath)}function Bp(n){return n instanceof Y?function(e){if("=="===e.op){if(Bh(e.value))return{unaryFilter:{field:yo(e.field),op:"IS_NAN"}};if($c(e.value))return{unaryFilter:{field:yo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Bh(e.value))return{unaryFilter:{field:yo(e.field),op:"IS_NOT_NAN"}};if($c(e.value))return{unaryFilter:{field:yo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:yo(e.field),op:a_(e.op),value:e.value}}}(n):n instanceof ue?function(e){const t=e.getFilters().map(i=>Bp(i));return 1===t.length?t[0]:{compositeFilter:{op:u_(e.op),filters:t}}}(n):U()}function c_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Zp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function ct(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Gp(e)),e=l_(n.get(t),e);return Gp(e)}function l_(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Gp(n){return n+"\x01\x01"}function In(n){const e=n.length;if(Z(e>=2),2===e)return Z("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),X.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&U(),n.charAt(u+1)){case"\x01":const d=n.substring(s,u);let f;0===r.length?f=d:(r+=d,f=r,r=""),i.push(f);break;case"\x10":r+=n.substring(s,u),r+="\0";break;case"\x11":r+=n.substring(s,u+1);break;default:U()}s=u+2}return new X(i)}const zp=["userId","batchId"];function fl(n,e){return[n,ct(e)]}function $p(n,e,t){return[n,ct(e),t]}const h_={},d_=["prefixPath","collectionGroup","readTime","documentId"],f_=["prefixPath","collectionGroup","documentId"],p_=["collectionGroup","readTime","prefixPath","documentId"],m_=["canonicalId","targetId"],g_=["targetId","path"],y_=["path","targetId"],__=["collectionId","parent"],v_=["indexId","uid"],I_=["uid","sequenceNumber"],w_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],b_=["indexId","uid","orderedDocumentKey"],E_=["userId","collectionPath","documentId"],T_=["userId","collectionPath","largestBatchId"],x_=["userId","collectionGroup","largestBatchId"],jp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],k_=[...jp,"documentOverlays"],Wp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Kp=Wp,A_=[...Kp,"indexConfiguration","indexState","indexEntries"];class Xh extends Ks{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function $e(n,e){const t=P(n);return It.M(t.se,e)}class ed{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&Oe(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Qe(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Qe(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=kp();return this.mutations.forEach(r=>{const s=e.get(r.key),u=s.overlayedDocument;let d=this.applyToLocalView(u,s.mutatedFields);d=t.has(r.key)?null:d;const f=z(u,d);null!==f&&i.set(r.key,f),u.isValidDocument()||u.convertToNoDocument(G.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&Ei(this.mutations,e.mutations,(t,i)=>hu(t,i))&&Ei(this.baseMutations,e.baseMutations,(t,i)=>hu(t,i))}}class td{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){Z(e.mutations.length===i.length);let r=Wy;const s=e.mutations;for(let u=0;u<s.length;u++)r=r.insert(s[u].key,i[u].version);return new td(e,t,i,r)}}class nd{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Li{constructor(e,t,i,r,s=G.min(),u=G.min(),d=Ne.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=d}withSequenceNumber(e){return new Li(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Li(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Li(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Hp{constructor(e){this.ie=e}}function Qp(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:pl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document={name:_u(r=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:go(r,s.version.toTimestamp()),createTime:go(r,s.createTime.toTimestamp())};else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:zr(e.version)};else{if(!e.isUnknownDocument())return U();i.unknownDocument={path:t.path.toArray(),version:zr(e.version)}}var r,s;return i}function pl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function zr(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function $r(n){const e=new le(n.seconds,n.nanoseconds);return G.fromTimestamp(e)}function jr(n,e){const t=(e.baseMutations||[]).map(s=>Yh(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const i=e.mutations.map(s=>Yh(n.ie,s)),r=le.fromMillis(e.localWriteTimeMs);return new ed(e.batchId,r,t,i)}function wu(n){const e=$r(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?$r(n.lastLimboFreeSnapshotVersion):G.min();let i;var r;return void 0!==n.query.documents?(Z(1===(r=n.query).documents.length),i=Ee(Ni(Mp(r.documents[0])))):i=Ee(Vp(n.query)),new Li(i,n.targetId,0,n.lastListenSequenceNumber,e,t,Ne.fromBase64String(n.resumeToken))}function Yp(n,e){const t=zr(e.snapshotVersion),i=zr(e.lastLimboFreeSnapshotVersion);let r;r=ro(e.target)?Up(n.ie,e.target):Jh(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:nn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function id(n){const e=Vp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?co(e,e.limit,"L"):e}function rd(n,e){return new nd(e.largestBatchId,Yh(n.ie,e.overlayMutation))}function Jp(n,e){const t=e.path.lastSegment();return[n,ct(e.path.popLast()),t]}function Xp(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:zr(i.readTime),documentKey:ct(i.documentKey.path),largestBatchId:i.largestBatchId}}class C_{getBundleMetadata(e,t){return em(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:$r(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return em(e).put({bundleId:(i=t).id,createTime:zr(Me(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return tm(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:id(r.bundledQuery),readTime:$r(r.readTime)};var r})}saveNamedQuery(e,t){return tm(e).put({name:(i=t).name,readTime:zr(Me(i.readTime)),bundledQuery:i.bundledQuery});var i}}function em(n){return $e(n,"bundles")}function tm(n){return $e(n,"namedQueries")}class ml{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new ml(e,t.uid||"")}getOverlay(e,t){return bu(e).get(Jp(this.userId,t)).next(i=>i?rd(this.yt,i):null)}getOverlays(e,t){const i=_n();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,u)=>{const d=new nd(t,u);r.push(this.oe(e,d))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(u=>r.add(ct(u.getCollectionPath())));const s=[];return r.forEach(u=>{const d=IDBKeyRange.bound([this.userId,u,i],[this.userId,u,i+1],!1,!0);s.push(bu(e).Y("collectionPathOverlayIndex",d))}),b.waitFor(s)}getOverlaysForCollection(e,t,i){const r=_n(),s=ct(t),u=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return bu(e).W("collectionPathOverlayIndex",u).next(d=>{for(const f of d){const m=rd(this.yt,f);r.set(m.getKey(),m)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=_n();let u;const d=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return bu(e).Z({index:"collectionGroupOverlayIndex",range:d},(f,m,g)=>{const _=rd(this.yt,m);s.size()<r||_.largestBatchId===u?(s.set(_.getKey(),_),u=_.largestBatchId):g.done()}).next(()=>s)}oe(e,t){return bu(e).put(function(i,r,s){const[u,d,f]=Jp(r,s.mutation.key);return{userId:r,collectionPath:d,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:Iu(i.ie,s.mutation)}}(this.yt,this.userId,t))}}function bu(n){return $e(n,"documentOverlays")}class Wr{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(we(e.integerValue));else if("doubleValue"in e){const i=we(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),Lr(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),"string"==typeof i?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Jt(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?jc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):U()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const r of Object.keys(i))this.de(r,t),this.ce(i[r],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const r of i)this.ce(r,t)}me(e,t){this.he(t,37),O.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function D_(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function nm(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=D_(255&t[r]);if(i+=s,8!==s)break}return i}(n);return Math.ceil(e/8)}Wr.Ie=new Wr;class R_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const r=t.codePointAt(0);this.Ee(240|r>>>18),this.Ee(128|63&r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const r=t.codePointAt(0);this.be(240|r>>>18),this.be(128|63&r>>>12),this.be(128|63&r>>>6),this.be(128|63&r)}}this.Pe()}Se(e){const t=this.De(e),i=nm(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){const t=this.De(e),i=nm(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=0!=(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class N_{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class O_{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Eu{constructor(){this.$e=new R_,this.Be=new N_(this.$e),this.Le=new O_(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Kr{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new Kr(this.indexId,this.documentKey,this.arrayValue,i)}}function Fi(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=im(n.arrayValue,e.arrayValue),0!==t?t:(t=im(n.directionalValue,e.directionalValue),0!==t?t:O.comparator(n.documentKey,e.documentKey)))}function im(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(0!==i)return i}return n.length-e.length}class M_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){Z(e.collectionGroup===this.collectionId);const t=Nr(e);if(void 0!==t&&!this.We(t))return!1;const i=Dt(e);let r=0,s=0;for(;r<i.length&&this.We(i[r]);++r);if(r===i.length)return!0;if(void 0!==this.Qe){const u=i[r];if(!this.ze(this.Qe,u)||!this.He(this.Ke[s++],u))return!1;++r}for(;r<i.length;++r){const u=i[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rm(n){var e,t;if(Z(n instanceof Y||n instanceof ue),n instanceof Y){if(n instanceof tl){const r=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>Y.create(n.field,"==",s)))||[];return ue.create(r,"or")}return n}const i=n.filters.map(r=>rm(r));return ue.create(i,n.op)}function P_(n){if(0===n.getFilters().length)return[];const e=ad(rm(n));return Z(sm(e)),sd(e)||od(e)?[e]:e.getFilters()}function sd(n){return n instanceof Y}function od(n){return n instanceof ue&&Qc(n)}function sm(n){return sd(n)||od(n)||function(e){if(e instanceof ue&&ru(e)){for(const t of e.getFilters())if(!sd(t)&&!od(t))return!1;return!0}return!1}(n)}function ad(n){if(Z(n instanceof Y||n instanceof ue),n instanceof Y)return n;if(1===n.filters.length)return ad(n.filters[0]);const e=n.filters.map(i=>ad(i));let t=ue.create(e,n.op);return t=gl(t),sm(t)?t:(Z(t instanceof ue),Z(Ci(t)),Z(t.filters.length>1),t.filters.reduce((i,r)=>ud(i,r)))}function ud(n,e){let t;return Z(n instanceof Y||n instanceof ue),Z(e instanceof Y||e instanceof ue),t=n instanceof Y?e instanceof Y?ue.create([n,e],"and"):om(n,e):e instanceof Y?om(e,n):function(i,r){if(Z(i.filters.length>0&&r.filters.length>0),Ci(i)&&Ci(r))return Jc(i,r.getFilters());const s=ru(i)?i:r,u=ru(i)?r:i,d=s.filters.map(f=>ud(f,u));return ue.create(d,"or")}(n,e),gl(t)}function om(n,e){if(Ci(e))return Jc(e,n.getFilters());{const t=e.filters.map(i=>ud(n,i));return ue.create(t,"or")}}function gl(n){if(Z(n instanceof Y||n instanceof ue),n instanceof Y)return n;const e=n.getFilters();if(1===e.length)return gl(e[0]);if(Yc(n))return n;const t=e.map(r=>gl(r)),i=[];return t.forEach(r=>{r instanceof Y?i.push(r):r instanceof ue&&(r.op===n.op?i.push(...r.filters):i.push(r))}),1===i.length?i[0]:ue.create(i,n.op)}class L_{constructor(){this.Je=new cd}addToCollectionParentIndex(e,t){return this.Je.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(it.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(it.min())}updateCollectionGroup(e,t,i){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class cd{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new oe(X.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new oe(X.comparator)).toArray()}}const yl=new Uint8Array(0);class F_{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new cd,this.Xe=new Pi(i=>nn(i),(i,r)=>Di(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:i,parent:ct(r)};return am(e).put(s)}return b.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[Vc(t),""],!1,!0);return am(e).W(r).next(s=>{for(const u of s){if(u.collectionId!==t)break;i.push(In(u.parent))}return i})}addFieldIndex(e,t){const i=_l(e),r={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var u;delete r.indexId;const s=i.add(r);if(t.indexState){const u=xu(e);return s.next(d=>{u.put(Xp(d,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=_l(e),r=xu(e),s=Tu(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=Tu(e);let r=!0;const s=new Map;return b.forEach(this.Ze(t),u=>this.tn(e,u).next(d=>{r&&(r=!!d),s.set(u,d)})).next(()=>{if(r){let u=H();const d=[];return b.forEach(s,(f,m)=>{var g;N("IndexedDbIndexManager",`Using index ${g=f,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(te=>`${te.fieldPath}:${te.kind}`).join(",")}`} to execute ${nn(t)}`);const _=function(te,Q){const K=Nr(Q);if(void 0===K)return null;for(const J of Ri(te,K.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null}(m,f),w=function(te,Q){const K=new Map;for(const J of Dt(Q))for(const Be of Ri(te,J.fieldPath))switch(Be.op){case"==":case"in":K.set(J.fieldPath.canonicalString(),Be.value);break;case"not-in":case"!=":return K.set(J.fieldPath.canonicalString(),Be.value),Array.from(K.values())}return null}(m,f),k=function(te,Q){const K=[];let J=!0;for(const Be of Dt(Q)){const Gu=0===Be.kind?sl(te,Be.fieldPath,te.startAt):rt(te,Be.fieldPath,te.startAt);K.push(Gu.value),J&&(J=Gu.inclusive)}return new gn(K,J)}(m,f),C=function(te,Q){const K=[];let J=!0;for(const Be of Dt(Q)){const Gu=0===Be.kind?rt(te,Be.fieldPath,te.endAt):sl(te,Be.fieldPath,te.endAt);K.push(Gu.value),J&&(J=Gu.inclusive)}return new gn(K,J)}(m,f),M=this.en(f,m,k),V=this.en(f,m,C),ae=this.nn(f,m,w),he=this.sn(f.indexId,_,M,k.inclusive,V,C.inclusive,ae);return b.forEach(he,te=>i.J(te,t.limit).next(Q=>{Q.forEach(K=>{const J=O.fromSegments(K.documentKey);u.has(J)||(u=u.add(J),d.push(J))})}))}).next(()=>d)}return b.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:P_(ue.create(e.filters,"and")).map(i=>Vr(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,r,s,u,d){const f=(null!=t?t.length:1)*Math.max(i.length,s.length),m=f/(null!=t?t.length:1),g=[];for(let _=0;_<f;++_){const w=t?this.rn(t[_/m]):yl,k=this.on(e,w,i[_%m],r),C=this.un(e,w,s[_%m],u),M=d.map(V=>this.on(e,w,V,!0));g.push(...this.createRange(k,C,M))}return g}on(e,t,i,r){const s=new Kr(e,O.empty(),t,i);return r?s:s.Ue()}un(e,t,i,r){const s=new Kr(e,O.empty(),t,i);return r?s.Ue():s}tn(e,t){const i=new M_(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let u=null;for(const d of s)i.je(d)&&(!u||d.fields.length>u.fields.length)&&(u=d);return u})}getIndexType(e,t){let i=2;const r=this.Ze(t);return b.forEach(r,s=>this.tn(e,s).next(u=>{u?0!==i&&u.fields.length<function(d){let f=new oe(Ie.comparator),m=!1;for(const g of d.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?m=!0:f=f.add(_.field));for(const g of d.orderBy)g.field.isKeyField()||(f=f.add(g.field));return f.size+(m?1:0)}(s)&&(i=1):i=0})).next(()=>null!==t.limit&&r.length>1&&2===i?1:i)}cn(e,t){const i=new Eu;for(const r of Dt(e)){const s=t.data.field(r.fieldPath);if(null==s)return null;const u=i.qe(r.kind);Wr.Ie.ue(s,u)}return i.Fe()}rn(e){const t=new Eu;return Wr.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new Eu;return Wr.Ie.ue(Zn(this.databaseId,t),i.qe(function(r){const s=Dt(r);return 0===s.length?0:s[s.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(null===i)return[];let r=[];r.push(new Eu);let s=0;for(const u of Dt(e)){const d=i[s++];for(const f of r)if(this.hn(t,u.fieldPath)&&Si(d))r=this.ln(r,u,d);else{const m=f.qe(u.kind);Wr.Ie.ue(d,m)}}return this.fn(r)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const r=[...e],s=[];for(const u of i.arrayValue.values||[])for(const d of r){const f=new Eu;f.seed(d.Fe()),Wr.Ie.ue(u,f.qe(t.kind)),s.push(f)}return s}hn(e,t){return!!e.filters.find(i=>i instanceof Y&&i.field.isEqual(t)&&("in"===i.op||"not-in"===i.op))}getFieldIndexes(e,t){const i=_l(e),r=xu(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(s=>{const u=[];return b.forEach(s,d=>r.get([d.indexId,this.uid]).next(f=>{u.push(function(m,g){const _=g?new Mr(g.sequenceNumber,new it($r(g.readTime),new O(In(g.documentKey)),g.largestBatchId)):Mr.empty(),w=m.fields.map(([k,C])=>new Or(Ie.fromServerFormat(k),C));return new Ws(m.indexId,m.collectionGroup,w,_)}(d,f))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return 0!==s?s:W(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=_l(e),s=xu(e);return this.dn(e).next(u=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>b.forEach(d,f=>s.put(Xp(f.indexId,this.user,u,i)))))}updateIndexEntries(e,t){const i=new Map;return b.forEach(t,(r,s)=>{const u=i.get(r.collectionGroup);return(u?b.resolve(u):this.getFieldIndexes(e,r.collectionGroup)).next(d=>(i.set(r.collectionGroup,d),b.forEach(d,f=>this._n(e,r,f).next(m=>{const g=this.wn(s,f);return m.isEqual(g)?b.resolve():this.mn(e,s,f,m,g)}))))})}gn(e,t,i,r){return Tu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,r){return Tu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const r=Tu(e);let s=new oe(Fi);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(u,d)=>{s=s.add(new Kr(i.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}wn(e,t){let i=new oe(Fi);const r=this.cn(t,e);if(null==r)return i;const s=Nr(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Si(u))for(const d of u.arrayValue.values||[])i=i.add(new Kr(t.indexId,e.key,this.rn(d),r))}else i=i.add(new Kr(t.indexId,e.key,yl,r));return i}mn(e,t,i,r,s){N("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(d,f,m,g,_){const w=d.getIterator(),k=f.getIterator();let C=zn(w),M=zn(k);for(;C||M;){let V=!1,ae=!1;if(C&&M){const he=m(C,M);he<0?ae=!0:he>0&&(V=!0)}else null!=C?ae=!0:V=!0;V?(g(M),M=zn(k)):ae?(_(C),C=zn(w)):(C=zn(w),M=zn(k))}}(r,s,Fi,d=>{u.push(this.gn(e,t,i,d))},d=>{u.push(this.yn(e,t,i,d))}),b.waitFor(u)}dn(e){let t=1;return xu(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((u,d)=>Fi(u,d)).filter((u,d,f)=>!d||0!==Fi(u,f[d-1]));const r=[];r.push(e);for(const u of i){const d=Fi(u,e),f=Fi(u,t);if(0===d)r[0]=e.Ue();else if(d>0&&f<0)r.push(u),r.push(u.Ue());else if(f>0)break}r.push(t);const s=[];for(let u=0;u<r.length;u+=2){if(this.pn(r[u],r[u+1]))return[];s.push(IDBKeyRange.bound([r[u].indexId,this.uid,r[u].arrayValue,r[u].directionalValue,yl,[]],[r[u+1].indexId,this.uid,r[u+1].arrayValue,r[u+1].directionalValue,yl,[]]))}return s}pn(e,t){return Fi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(um)}getMinOffset(e,t){return b.mapArray(this.Ze(t),i=>this.tn(e,i).next(r=>r||U())).next(um)}}function am(n){return $e(n,"collectionParents")}function Tu(n){return $e(n,"indexEntries")}function _l(n){return $e(n,"indexConfiguration")}function xu(n){return $e(n,"indexState")}function um(n){Z(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Qa(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new it(e.readTime,e.documentKey,t)}const cm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class yt{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new yt(e,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function lm(n,e,t){const i=n.store("mutations"),r=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let d=0;const f=i.Z({range:u},(g,_,w)=>(d++,w.delete()));s.push(f.next(()=>{Z(1===d)}));const m=[];for(const g of t.mutations){const _=$p(e,g.key.path,t.batchId);s.push(r.delete(_)),m.push(g.key)}return b.waitFor(s).next(()=>m)}function vl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}yt.DEFAULT_COLLECTION_PERCENTILE=10,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,yt.DEFAULT=new yt(41943040,yt.DEFAULT_COLLECTION_PERCENTILE,yt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),yt.DISABLED=new yt(-1,0,0);class Il{constructor(e,t,i,r){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=r,this.In={}}static re(e,t,i,r){Z(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new Il(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Ui(e).Z({index:"userMutationsIndex",range:i},(r,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=vo(e),u=Ui(e);return u.add({}).next(d=>{Z("number"==typeof d);const f=new ed(d,t,i,r),m=function(w,k,C){const M=C.baseMutations.map(ae=>Iu(w.ie,ae)),V=C.mutations.map(ae=>Iu(w.ie,ae));return{userId:k,batchId:C.batchId,localWriteTimeMs:C.localWriteTime.toMillis(),baseMutations:M,mutations:V}}(this.yt,this.userId,f),g=[];let _=new oe((w,k)=>W(w.canonicalString(),k.canonicalString()));for(const w of r){const k=$p(this.userId,w.key.path,d);_=_.add(w.key.path.popLast()),g.push(u.put(m)),g.push(s.put(k,h_))}return _.forEach(w=>{g.push(this.indexManager.addToCollectionParentIndex(e,w))}),e.addOnCommittedListener(()=>{this.In[d]=f.keys()}),b.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return Ui(e).get(t).next(i=>i?(Z(i.userId===this.userId),jr(this.yt,i)):null)}Tn(e,t){return this.In[t]?b.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.In[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return Ui(e).Z({index:"userMutationsIndex",range:r},(u,d,f)=>{d.userId===this.userId&&(Z(d.batchId>=i),s=jr(this.yt,d)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return Ui(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(r,s,u)=>{i=s.batchId,u.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Ui(e).W("userMutationsIndex",t).next(i=>i.map(r=>jr(this.yt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=fl(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return vo(e).Z({range:r},(u,d,f)=>{const[m,g,_]=u,w=In(g);if(m===this.userId&&t.path.isEqual(w))return Ui(e).get(_).next(k=>{if(!k)throw U();Z(k.userId===this.userId),s.push(jr(this.yt,k))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new oe(W);const r=[];return t.forEach(s=>{const u=fl(this.userId,s.path),d=IDBKeyRange.lowerBound(u),f=vo(e).Z({range:d},(m,g,_)=>{const[w,k,C]=m,M=In(k);w===this.userId&&s.path.isEqual(M)?i=i.add(C):_.done()});r.push(f)}),b.waitFor(r).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=fl(this.userId,i),u=IDBKeyRange.lowerBound(s);let d=new oe(W);return vo(e).Z({range:u},(f,m,g)=>{const[_,w,k]=f,C=In(w);_===this.userId&&i.isPrefixOf(C)?C.length===r&&(d=d.add(k)):g.done()}).next(()=>this.En(e,d))}En(e,t){const i=[],r=[];return t.forEach(s=>{r.push(Ui(e).get(s).next(u=>{if(null===u)throw U();Z(u.userId===this.userId),i.push(jr(this.yt,u))}))}),b.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return lm(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),b.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();const i=IDBKeyRange.lowerBound([this.userId]),r=[];return vo(e).Z({range:i},(s,u,d)=>{if(s[0]===this.userId){const f=In(s[1]);r.push(f)}else d.done()}).next(()=>{Z(0===r.length)})})}containsKey(e,t){return hm(e,this.userId,t)}Rn(e){return dm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hm(n,e,t){const i=fl(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let u=!1;return vo(n).Z({range:s,X:!0},(d,f,m)=>{const[g,_,w]=d;g===e&&_===r&&(u=!0),m.done()}).next(()=>u)}function Ui(n){return $e(n,"mutations")}function vo(n){return $e(n,"documentMutations")}function dm(n){return $e(n,"mutationQueues")}class Hr{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Hr(0)}static vn(){return new Hr(-1)}}class U_{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new Hr(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>G.fromTimestamp(new le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Io(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(Z(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Io(e).Z((u,d)=>{const f=wu(d);f.sequenceNumber<=t&&null===i.get(f.targetId)&&(r++,s.push(this.removeTargetData(e,f)))}).next(()=>b.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Io(e).Z((i,r)=>{const s=wu(r);t(s)})}Vn(e){return fm(e).get("targetGlobalKey").next(t=>(Z(null!==t),t))}Sn(e,t){return fm(e).put("targetGlobalKey",t)}Dn(e,t){return Io(e).put(Yp(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=nn(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Io(e).Z({range:r,index:"queryTargetsIndex"},(u,d,f)=>{const m=wu(d);Di(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=Vi(e);return t.forEach(u=>{const d=ct(u.path);r.push(s.put({targetId:i,path:d})),r.push(this.referenceDelegate.addReference(e,i,u))}),b.waitFor(r)}removeMatchingKeys(e,t,i){const r=Vi(e);return b.forEach(t,s=>{const u=ct(s.path);return b.waitFor([r.delete([i,u]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=Vi(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Vi(e);let s=H();return r.Z({range:i,X:!0},(u,d,f)=>{const m=In(u[1]),g=new O(m);s=s.add(g)}).next(()=>s)}containsKey(e,t){const i=ct(t.path),r=IDBKeyRange.bound([i],[Vc(i)],!1,!0);let s=0;return Vi(e).Z({index:"documentTargetsIndex",X:!0,range:r},([u,d],f,m)=>{0!==u&&(s++,m.done())}).next(()=>s>0)}ne(e,t){return Io(e).get(t).next(i=>i?wu(i):null)}}function Io(n){return $e(n,"targets")}function fm(n){return $e(n,"targetGlobal")}function Vi(n){return $e(n,"targetDocuments")}function pm([n,e],[t,i]){const r=W(n,t);return 0===r?W(e,i):r}class V_{constructor(e){this.xn=e,this.buffer=new oe(pm),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();pm(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class q_{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;N("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,T.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(i){fn(i)?N("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):yield dn(i)}yield t.Fn(3e5)}))}}class B_{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(0===t)return b.resolve(ot.at);const i=new V_(t);return this.$n.forEachTarget(e,r=>i.On(r.sequenceNumber)).next(()=>this.$n.Ln(e,r=>i.On(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(cm)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(N("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cm):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,r,s,u,d,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(N("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),r=this.params.maximumSequenceNumbersToCollect):r=_,u=Date.now(),this.nthSequenceNumber(e,r))).next(_=>(i=_,d=Date.now(),this.removeTargets(e,i,t))).next(_=>(s=_,f=Date.now(),this.removeOrphanedDocuments(e,i))).next(_=>(m=Date.now(),Cr()<=Tt.in.DEBUG&&N("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${r} in `+(d-u)+`ms\n\tRemoved ${s} targets in `+(f-d)+`ms\n\tRemoved ${_} documents in `+(m-f)+`ms\nTotal Duration: ${m-g}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:_})))}}class Z_{constructor(e,t){this.db=e,this.garbageCollector=new B_(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,r)=>t(r))}addReference(e,t,i){return wl(e,i)}removeReference(e,t,i){return wl(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return wl(e,t)}Gn(e,t){return function(i,r){let s=!1;return dm(i).tt(u=>hm(i,u,r).next(d=>(d&&(s=!0),b.resolve(!d)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(e,(u,d)=>{if(d<=t){const f=this.Gn(e,u).next(m=>{if(!m)return s++,i.getEntry(e,u).next(()=>(i.removeEntry(u,G.min()),Vi(e).delete([0,ct(u.path)])))});r.push(f)}}).next(()=>b.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return wl(e,t)}Kn(e,t){const i=Vi(e);let r,s=ot.at;return i.Z({index:"documentTargetsIndex"},([u,d],{path:f,sequenceNumber:m})=>{0===u?(s!==ot.at&&t(new O(In(r)),s),s=m,r=f):s=ot.at}).next(()=>{s!==ot.at&&t(new O(In(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function wl(n,e){return Vi(n).put((i=n.currentSequenceNumber,{targetId:0,path:ct(e.path),sequenceNumber:i}));var i}class mm{constructor(){this.changes=new Pi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,de.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return void 0!==i?b.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class G_{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Qr(e).put(i)}removeEntry(e,t,i){return Qr(e).delete(function(r,s){const u=r.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],pl(s),u[u.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=de.newInvalidDocument(t);return Qr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(r,s)=>{i=this.jn(t,s)}).next(()=>i)}Wn(e,t){let i={size:0,document:de.newInvalidDocument(t)};return Qr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(ku(t))},(r,s)=>{i={document:this.jn(t,s),size:vl(s)}}).next(()=>i)}getEntries(e,t){let i=gt();return this.zn(e,t,(r,s)=>{const u=this.jn(r,s);i=i.insert(r,u)}).next(()=>i)}Hn(e,t){let i=gt(),r=new be(O.comparator);return this.zn(e,t,(s,u)=>{const d=this.jn(s,u);i=i.insert(s,d),r=r.insert(s,vl(u))}).next(()=>({documents:i,Jn:r}))}zn(e,t,i){if(t.isEmpty())return b.resolve();let r=new oe(vm);t.forEach(f=>r=r.add(f));const s=IDBKeyRange.bound(ku(r.first()),ku(r.last())),u=r.getIterator();let d=u.getNext();return Qr(e).Z({index:"documentKeyIndex",range:s},(f,m,g)=>{const _=O.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;d&&vm(d,_)<0;)i(d,null),d=u.getNext();d&&d.isEqual(_)&&(i(d,m),d=u.hasNext()?u.getNext():null),d?g.j(ku(d)):g.done()}).next(()=>{for(;d;)i(d,null),d=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,i){const r=[t.popLast().toArray(),t.lastSegment(),pl(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qr(e).W(IDBKeyRange.bound(r,s,!0)).next(u=>{let d=gt();for(const f of u){const m=this.jn(O.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);d=d.insert(m.key,m)}return d})}getAllFromCollectionGroup(e,t,i,r){let s=gt();const u=_m(t,i),d=_m(t,it.max());return Qr(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,d,!0)},(f,m,g)=>{const _=this.jn(O.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(_.key,_),s.size===r&&g.done()}).next(()=>s)}newChangeBuffer(e){return new z_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return ym(e).get("remoteDocumentGlobalKey").next(t=>(Z(!!t),t))}Qn(e,t){return ym(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=function S_(n,e){let t;if(e.document)t=Fp(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=O.fromSegments(e.noDocument.path),r=$r(e.noDocument.readTime);t=de.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{const i=O.fromSegments(e.unknownDocument.path),r=$r(e.unknownDocument.version);t=de.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(i){const r=new le(i[0],i[1]);return G.fromTimestamp(r)}(e.readTime)),t}(this.yt,t);if(!i.isNoDocument()||!i.version.isEqual(G.min()))return i}return de.newInvalidDocument(e)}}function gm(n){return new G_(n)}class z_ extends mm{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Pi(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new oe((s,u)=>W(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const d=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,d.readTime)),u.isValidDocument()){const f=Qp(this.Yn.yt,u);r=r.add(s.path.popLast()),i+=vl(f)-d.size,t.push(this.Yn.addEntry(e,s,f))}else if(i-=d.size,this.trackRemovals){const f=Qp(this.Yn.yt,u.convertToNoDocument(G.min()));t.push(this.Yn.addEntry(e,s,f))}}),r.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,i)),b.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:r})=>(r.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:i.get(s).readTime})}),i))}}function ym(n){return $e(n,"remoteDocumentGlobal")}function Qr(n){return $e(n,"remoteDocumentsV14")}function ku(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function _m(n,e){const t=e.documentKey.path.toArray();return[n,pl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vm(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=W(t[s],i[s]),r)return r;return r=W(t.length,i.length),r||(r=W(t[t.length-2],i[i.length-2]),r||W(t[t.length-1],i[i.length-1]))}class $_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Im{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==i&&Qe(i.mutation,r,at.empty(),le.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,H()).next(()=>i))}getLocalViewOfDocuments(e,t,i=H()){const r=_n();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let u=pu();return s.forEach((d,f)=>{u=u.insert(d,f.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const i=_n();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,H()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((u,d)=>{t.set(u,d)})})}computeViews(e,t,i,r){let s=gt();const u=mu(),d=mu();return t.forEach((f,m)=>{const g=i.get(m.key);r.has(m.key)&&(void 0===g||g.mutation instanceof Mt)?s=s.insert(m.key,m):void 0!==g&&(u.set(m.key,g.mutation.getFieldMask()),Qe(g.mutation,m,g.mutation.getFieldMask(),le.now()))}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,g)=>u.set(m,g)),t.forEach((m,g)=>{var _;return d.set(m,new $_(g,null!==(_=u.get(m))&&void 0!==_?_:null))}),d))}recalculateAndSaveOverlays(e,t){const i=mu();let r=new be((u,d)=>u-d),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const d of u)d.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let g=i.get(f)||at.empty();g=d.applyToLocalView(m,g),i.set(f,g);const _=(r.get(d.batchId)||H()).add(f);r=r.insert(d.batchId,_)})}).next(()=>{const u=[],d=r.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,g=f.value,_=kp();g.forEach(w=>{if(!s.has(w)){const k=z(t.get(w),i.get(w));null!==k&&_.set(w,k),s=s.add(w)}}),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return b.waitFor(u)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return O.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ao(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i);var r}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const u=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):b.resolve(_n());let d=-1,f=s;return u.next(m=>b.forEach(m,(g,_)=>(d<_.largestBatchId&&(d=_.largestBatchId),s.get(g)?b.resolve():this.remoteDocumentCache.getEntry(e,g).next(w=>{f=f.insert(g,w)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,H())).next(g=>({batchId:d,changes:xp(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(i=>{let r=pu();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const r=t.collectionGroup;let s=pu();return this.indexManager.getCollectionParents(e,r).next(u=>b.forEach(u,d=>{const f=(m=t,g=d.child(r),new ut(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,g;return this.getDocumentsMatchingCollectionQuery(e,f,i).next(m=>{m.forEach((g,_)=>{s=s.insert(g,_)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,i).next(s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId))).next(s=>{s.forEach((d,f)=>{const m=f.getKey();null===r.get(m)&&(r=r.insert(m,de.newInvalidDocument(m)))});let u=pu();return r.forEach((d,f)=>{const m=s.get(d);void 0!==m&&Qe(m.mutation,f,at.empty(),le.now()),ze(t,f)&&(u=u.insert(d,f))}),u})}}class j_{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return b.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:Me(i.createTime)}),b.resolve()}getNamedQuery(e,t){return b.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(i=t).name,query:id(i.bundledQuery),readTime:Me(i.readTime)}),b.resolve();var i}}class W_{constructor(){this.overlays=new be(O.comparator),this.es=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const i=_n();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.oe(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.es.get(i);return void 0!==r&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(i)),b.resolve()}getOverlaysForCollection(e,t,i){const r=_n(),s=t.length+1,u=new O(t.child("")),d=this.overlays.getIteratorFrom(u);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>i&&r.set(f.getKey(),f)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new be((m,g)=>m-g);const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>i){let g=s.get(m.largestBatchId);null===g&&(g=_n(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const d=_n(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,g)=>d.set(m,g)),!(d.size()>=r)););return b.resolve(d)}oe(e,t,i){const r=this.overlays.get(i.key);if(null!==r){const u=this.es.get(r.largestBatchId).delete(i.key);this.es.set(r.largestBatchId,u)}this.overlays=this.overlays.insert(i.key,new nd(t,i));let s=this.es.get(t);void 0===s&&(s=H(),this.es.set(t,s)),this.es.set(t,s.add(i.key))}}class ld{constructor(){this.ns=new oe(je.ss),this.rs=new oe(je.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new je(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new je(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new O(new X([])),i=new je(t,e),r=new je(t,e+1),s=[];return this.rs.forEachInRange([i,r],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new O(new X([])),i=new je(t,e),r=new je(t,e+1);let s=H();return this.rs.forEachInRange([i,r],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new je(e,0),i=this.ns.firstAfterOrEqual(t);return null!==i&&e.isEqual(i.key)}}class je{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return O.comparator(e.key,t.key)||W(e._s,t._s)}static os(e,t){return W(e._s,t._s)||O.comparator(e.key,t.key)}}class K_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new oe(je.ss)}checkEmpty(e){return b.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,i,r){const s=this.ws;this.ws++;const u=new ed(s,t,i,r);this.mutationQueue.push(u);for(const d of r)this.gs=this.gs.add(new je(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return b.resolve(u)}lookupMutationBatch(e,t){return b.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.ps(t+1),s=r<0?0:r;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new je(t,0),r=new je(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([i,r],u=>{const d=this.ys(u._s);s.push(d)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new oe(W);return t.forEach(r=>{const s=new je(r,0),u=new je(r,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],d=>{i=i.add(d._s)})}),b.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;O.isDocumentKey(s)||(s=s.child(""));const u=new je(new O(s),0);let d=new oe(W);return this.gs.forEachWhile(f=>{const m=f.key.path;return!!i.isPrefixOf(m)&&(m.length===r&&(d=d.add(f._s)),!0)},u),b.resolve(this.Is(d))}Is(e){const t=[];return e.forEach(i=>{const r=this.ys(i);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){Z(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return b.forEach(t.mutations,r=>{const s=new je(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new je(t,0),r=this.gs.firstAfterOrEqual(i);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return b.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class H_{constructor(e){this.Es=e,this.docs=new be(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,u=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return b.resolve(i?i.document.mutableCopy():de.newInvalidDocument(t))}getEntries(e,t){let i=gt();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():de.newInvalidDocument(r))}),b.resolve(i)}getAllFromCollection(e,t,i){let r=gt();const s=new O(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!t.isPrefixOf(d.path))break;d.path.length>t.length+1||Qa(Ha(f),i)<=0||(r=r.insert(f.key,f.mutableCopy()))}return b.resolve(r)}getAllFromCollectionGroup(e,t,i,r){U()}As(e,t){return b.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Q_(this)}getSize(e){return b.resolve(this.size)}}class Q_ extends mm{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(i)}),b.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Y_{constructor(e){this.persistence=e,this.Rs=new Pi(t=>nn(t),Di),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.bs=0,this.Ps=new ld,this.targetCount=0,this.vs=Hr.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),b.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Hr(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Dn(t),b.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.Rs.forEach((u,d)=>{d.sequenceNumber<=t&&null===i.get(d.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),r++)}),b.waitFor(s).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return b.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),b.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(u=>{s.push(r.markPotentiallyOrphaned(e,u))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),b.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return b.resolve(i)}containsKey(e,t){return b.resolve(this.Ps.containsKey(t))}}class wm{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ot(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Y_(this),this.indexManager=new L_,this.remoteDocumentCache=new H_(i=>this.referenceDelegate.xs(i)),this.yt=new Hp(t),this.Ns=new j_(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new W_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new K_(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){N("MemoryPersistence","Starting transaction:",e);const r=new J_(this.Ss.next());return this.referenceDelegate.ks(),i(r).next(s=>this.referenceDelegate.Os(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ms(e,t){return b.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class J_ extends Ks{constructor(e){super(),this.currentSequenceNumber=e}}class bl{constructor(e){this.persistence=e,this.Fs=new ld,this.$s=null}static Bs(e){return new bl(e)}get Ls(){if(this.$s)return this.$s;throw U()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),b.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),b.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(r=>this.Ls.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Ls.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Ls,i=>{const r=O.fromPath(i);return this.qs(e,r).next(s=>{s||t.removeEntry(r,G.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return b.or([()=>b.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class X_{constructor(e){this.yt=e}$(e,t,i,r){const s=new Ti("createOrUpgrade",t);var d;i<1&&r>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zp,{unique:!0}),d.createObjectStore("documentMutations"),bm(e),function(d){d.createObjectStore("remoteDocuments")}(e));let u=b.resolve();return i<3&&r>=3&&(0!==i&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),bm(e)),u=u.next(()=>function(d){const f=d.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),i<4&&r>=4&&(0!==i&&(u=u.next(()=>function(d,f){return f.store("mutations").W().next(m=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zp,{unique:!0});const g=f.store("mutations"),_=m.map(w=>g.put(w));return b.waitFor(_)})}(e,s))),u=u.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),i<5&&r>=5&&(u=u.next(()=>this.Us(s))),i<6&&r>=6&&(u=u.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),i<7&&r>=7&&(u=u.next(()=>this.Gs(s))),i<8&&r>=8&&(u=u.next(()=>this.Qs(e,s))),i<9&&r>=9&&(u=u.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),i<10&&r>=10&&(u=u.next(()=>this.js(s))),i<11&&r>=11&&(u=u.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(u=u.next(()=>{!function(d){const f=d.createObjectStore("documentOverlays",{keyPath:E_});f.createIndex("collectionPathOverlayIndex",T_,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",x_,{unique:!1})}(e)})),i<13&&r>=13&&(u=u.next(()=>function(d){const f=d.createObjectStore("remoteDocumentsV14",{keyPath:d_});f.createIndex("documentKeyIndex",f_),f.createIndex("collectionGroupIndex",p_)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(u=u.next(()=>this.zs(e,s))),i<15&&r>=15&&(u=u.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:v_}).createIndex("sequenceNumberIndex",I_,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:w_}).createIndex("documentKeyIndex",b_,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,r)=>{t+=vl(r)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(r=>b.forEach(r,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",u).next(d=>b.forEach(d,f=>{Z(f.userId===s.userId);const m=jr(this.yt,f);return lm(e,s.userId,m).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const s=[];return i.Z((u,d)=>{const f=new X(u),m=[0,ct(f)];s.push(t.get(m).next(g=>g?b.resolve():t.put({targetId:0,path:ct(f),sequenceNumber:r.highestListenSequenceNumber})))}).next(()=>b.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:__});const i=t.store("collectionParents"),r=new cd,s=u=>{if(r.add(u)){const d=u.lastSegment(),f=u.popLast();return i.put({collectionId:d,parent:ct(f)})}};return t.store("remoteDocuments").Z({X:!0},(u,d)=>{const f=new X(u);return s(f.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,d,f],m)=>{const g=In(d);return s(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,r)=>{const s=wu(r),u=Yp(this.yt,s);return t.put(u)})}Ws(e,t){const i=t.store("remoteDocuments"),r=[];return i.Z((s,u)=>{const d=t.store("remoteDocumentsV14"),f=(m=u,m.document?new O(X.fromString(m.document.name).popFirst(5)):m.noDocument?O.fromSegments(m.noDocument.path):m.unknownDocument?O.fromSegments(m.unknownDocument.path):U()).path.toArray();var m;const g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};r.push(d.put(g))}).next(()=>b.waitFor(r))}zs(e,t){const i=t.store("mutations"),r=gm(this.yt),s=new wm(bl.Bs,this.yt.ie);return i.W().next(u=>{const d=new Map;return u.forEach(f=>{var m;let g=null!==(m=d.get(f.userId))&&void 0!==m?m:H();jr(this.yt,f).keys().forEach(_=>g=g.add(_)),d.set(f.userId,g)}),b.forEach(d,(f,m)=>{const g=new Ce(m),_=ml.re(this.yt,g),w=s.getIndexManager(g),k=Il.re(g,this.yt,w,s.referenceDelegate);return new Im(r,k,_,w).recalculateAndSaveOverlaysForDocumentKeys(new Xh(t,ot.at),f).next()})})}}function bm(n){n.createObjectStore("targetDocuments",{keyPath:g_}).createIndex("documentTargetsIndex",y_,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",m_,{unique:!0}),n.createObjectStore("targetGlobal")}const hd="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class dd{constructor(e,t,i,r,s,u,d,f,m,g,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=s,this.window=u,this.document=d,this.Js=m,this.Ys=g,this.Xs=_,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=w=>Promise.resolve(),!dd.C())throw new S(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Z_(this,r),this.ii=t+"main",this.yt=new Hp(f),this.ri=new It(this.ii,this.Xs,new X_(this.yt)),this.Cs=new U_(this.referenceDelegate,this.yt),this.remoteDocumentCache=gm(this.yt),this.Ns=new C_,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&ke("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new S(E.FAILED_PRECONDITION,hd);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ot(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var i=(0,T.Z)(function*(r){if(t.started)return e(r)});return function(r){return i.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,T.Z)(function*(i){null===i.newVersion&&(yield e())});return function(i){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,T.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>El(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(fn(e))return N("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return N("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Au(e).get("owner").next(t=>b.resolve(this.mi(t)))}gi(e){return El(e).delete(this.clientId)}yi(){var e=this;return(0,T.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",i=>{const r=$e(i,"clientMetadata");return r.W().next(s=>{const u=e.Ii(s,18e5),d=s.filter(f=>-1===u.indexOf(f));return b.forEach(d,f=>r.delete(f.clientId)).next(()=>d)})}).catch(()=>[]);if(e.oi)for(const i of t)e.oi.removeItem(e.Ti(i.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?b.resolve(!0):Au(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new S(E.FAILED_PRECONDITION,hd);return!1}}return!(!this.networkEnabled||!this.inForeground)||El(e).W().next(i=>void 0===this.Ii(i,5e3).find(r=>{if(this.clientId!==r.clientId){const u=!this.inForeground&&r.inForeground,d=this.networkEnabled===r.networkEnabled;if(!this.networkEnabled&&r.networkEnabled||u&&d)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&N("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,T.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const i=new Xh(t,ot.at);return e._i(i).next(()=>e.gi(i))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>El(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return Il.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new F_(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return ml.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){N("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?A_:14===u?Kp:13===u?Wp:12===u?k_:11===u?jp:void U();var u;let d;return this.ri.runTransaction(e,r,s,f=>(d=new Xh(f,this.Ss?this.Ss.next():ot.at),"readwrite-primary"===t?this.fi(d).next(m=>!!m||this.di(d)).next(m=>{if(!m)throw ke(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new S(E.FAILED_PRECONDITION,Ya);return i(d)}).next(m=>this.wi(d).next(()=>m)):this.Vi(d).next(()=>i(d)))).then(f=>(d.raiseOnCommittedEvent(),f))}Vi(e){return Au(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new S(E.FAILED_PRECONDITION,hd)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Au(e).put("owner",t)}static C(){return It.C()}_i(e){const t=Au(e);return t.get("owner").next(i=>this.mi(i)?(N("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}pi(e,t){const i=Date.now();return!(e<i-t||e>i&&(ke(`Detected an update time that is in the future: ${e} > ${i}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,re.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return N("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return ke("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){ke("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Au(n){return $e(n,"owner")}function El(n){return $e(n,"clientMetadata")}function fd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class pd{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=r}static Ci(e,t){let i=H(),r=H();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new pd(e,t.fromCache,i,r)}}class Em{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,r){return this.ki(e,t).next(s=>s||this.Oi(e,t,r,i)).next(s=>s||this.Mi(e,t))}ki(e,t){if(so(t))return b.resolve(null);let i=Ee(t);return this.indexManager.getIndexType(e,i).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=co(t,null,"F"),i=Ee(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const u=H(...s);return this.Ni.getDocuments(e,u).next(d=>this.indexManager.getMinOffset(e,i).next(f=>{const m=this.Fi(t,d);return this.$i(t,m,u,f.readTime)?this.ki(e,co(t,null,"F")):this.Bi(e,m,t,f)}))})))}Oi(e,t,i,r){return so(t)||r.isEqual(G.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,i,r)?this.Mi(e,t):(Cr()<=Tt.in.DEBUG&&N("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lo(t)),this.Bi(e,u,t,Ka(r,-1)))})}Fi(e,t){let i=new oe(fo(e));return t.forEach((r,s)=>{ze(e,s)&&(i=i.add(s))}),i}$i(e,t,i,r){if(null===e.limit)return!1;if(i.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(e,t){return Cr()<=Tt.in.DEBUG&&N("QueryEngine","Using full collection scan to execute query:",lo(t)),this.Ni.getDocumentsMatchingQuery(e,t,it.min())}Bi(e,t,i,r){return this.Ni.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class ev{constructor(e,t,i,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new be(W),this.Ui=new Pi(s=>nn(s),Di),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Im(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Tm(n,e,t,i){return new ev(n,e,t,i)}function xm(n,e){return md.apply(this,arguments)}function md(){return md=(0,T.Z)(function*(n,e){const t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const u=[],d=[];let f=H();for(const m of r){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of s){d.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return t.localDocuments.getDocuments(i,f).next(m=>({ji:m,removedBatchIds:u,addedBatchIds:d}))})})}),md.apply(this,arguments)}function tv(n,e){const t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,d,f,m){const g=f.batch,_=g.keys();let w=b.resolve();return _.forEach(k=>{w=w.next(()=>m.getEntry(d,k)).next(C=>{const M=f.docVersions.get(k);Z(null!==M),C.version.compareTo(M)<0&&(g.applyToRemoteDocument(C,f),C.isValidDocument()&&(C.setReadTime(f.commitVersion),m.addEntry(C)))})}),w.next(()=>u.mutationQueue.removeMutationBatch(d,g))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(u){let d=H();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function km(n){const e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function nv(n,e){const t=P(n),i=e.snapshotVersion;let r=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});r=t.qi;const d=[];e.targetChanges.forEach((g,_)=>{const w=r.get(_);if(!w)return;d.push(t.Cs.removeMatchingKeys(s,g.removedDocuments,_).next(()=>t.Cs.addMatchingKeys(s,g.addedDocuments,_)));let k=w.withSequenceNumber(s.currentSequenceNumber);var C,M,V;e.targetMismatches.has(_)?k=k.withResumeToken(Ne.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):g.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(g.resumeToken,i)),r=r.insert(_,k),M=k,V=g,(0===(C=w).resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-C.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&d.push(t.Cs.updateTargetData(s,k))});let f=gt(),m=H();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),d.push(Am(s,u,e.documentUpdates).next(g=>{f=g.Wi,m=g.zi})),!i.isEqual(G.min())){const g=t.Cs.getLastRemoteSnapshotVersion(s).next(_=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,i));d.push(g)}return b.waitFor(d).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.qi=r,s))}function Am(n,e,t){let i=H(),r=H();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let u=gt();return t.forEach((d,f)=>{const m=s.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(d)),f.isNoDocument()&&f.version.isEqual(G.min())?(e.removeEntry(d,f.readTime),u=u.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(d,f)):N("LocalStore","Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)}),{Wi:u,zi:r}})}function iv(n,e){const t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function wo(n,e){const t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Cs.getTargetData(i,e).next(s=>s?(r=s,b.resolve(r)):t.Cs.allocateTargetId(i).next(u=>(r=new Li(e,u,0,i.currentSequenceNumber),t.Cs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.qi.get(i.targetId);return(null===r||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}function bo(n,e,t){return gd.apply(this,arguments)}function gd(){return gd=(0,T.Z)(function*(n,e,t){const i=P(n),r=i.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,u=>i.persistence.referenceDelegate.removeTarget(u,r)))}catch(u){if(!fn(u))throw u;N("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}i.qi=i.qi.remove(e),i.Ui.delete(r.target)}),gd.apply(this,arguments)}function Tl(n,e,t){const i=P(n);let r=G.min(),s=H();return i.persistence.runTransaction("Execute query","readonly",u=>function(d,f,m){const g=P(d),_=g.Ui.get(m);return void 0!==_?b.resolve(g.qi.get(_)):g.Cs.getTargetData(f,m)}(i,u,Ee(e)).next(d=>{if(d)return r=d.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(u,d.targetId).next(f=>{s=f})}).next(()=>i.Li.getDocumentsMatchingQuery(u,e,t?r:G.min(),t?s:H())).next(d=>(Dm(i,ho(e),d),{documents:d,Hi:s})))}function Sm(n,e){const t=P(n),i=P(t.Cs),r=t.qi.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ne(s,e).next(u=>u?u.target:null))}function Cm(n,e){const t=P(n),i=t.Ki.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.Gi.getAllFromCollectionGroup(r,e,Ka(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(Dm(t,e,r),r))}function Dm(n,e,t){let i=n.Ki.get(e)||G.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ki.set(e,i)}function yd(){return yd=(0,T.Z)(function*(n,e,t,i){const r=P(n);let s=H(),u=gt();for(const m of t){const g=e.Ji(m.metadata.name);m.document&&(s=s.add(g));const _=e.Yi(m);_.setReadTime(e.Xi(m.metadata.readTime)),u=u.insert(g,_)}const d=r.Gi.newChangeBuffer({trackRemovals:!0}),f=yield wo(r,(m=i,Ee(Ni(X.fromString(`__bundle__/docs/${m}`)))));var m;return r.persistence.runTransaction("Apply bundle documents","readwrite",m=>Am(m,d,u).next(g=>(d.apply(m),g)).next(g=>r.Cs.removeMatchingKeysForTargetId(m,f.targetId).next(()=>r.Cs.addMatchingKeys(m,s,f.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(m,g.Wi,g.zi)).next(()=>g.Wi)))}),yd.apply(this,arguments)}function sv(n,e){return _d.apply(this,arguments)}function _d(){return _d=(0,T.Z)(function*(n,e,t=H()){const i=yield wo(n,Ee(id(e.bundledQuery))),r=P(n);return r.persistence.runTransaction("Save named query","readwrite",s=>{const u=Me(e.readTime);if(i.snapshotVersion.compareTo(u)>=0)return r.Ns.saveNamedQuery(s,e);const d=i.withResumeToken(Ne.EMPTY_BYTE_STRING,u);return r.qi=r.qi.insert(d.targetId,d),r.Cs.updateTargetData(s,d).next(()=>r.Cs.removeMatchingKeysForTargetId(s,i.targetId)).next(()=>r.Cs.addMatchingKeys(s,t,i.targetId)).next(()=>r.Ns.saveNamedQuery(s,e))})}),_d.apply(this,arguments)}function Rm(n,e){return`firestore_clients_${n}_${e}`}function Nm(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function vd(n,e){return`firestore_targets_${n}_${e}`}class xl{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Zi(e,t,i){const r=JSON.parse(i);let s,u="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return u&&r.error&&(u="string"==typeof r.error.message&&"string"==typeof r.error.code,u&&(s=new S(r.error.code,r.error.message))),u?new xl(e,t,r.state,s):(ke("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Su{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Zi(e,t){const i=JSON.parse(t);let r,s="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code,s&&(r=new S(i.error.code,i.error.message))),s?new Su(e,i.state,r):(ke("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class kl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const i=JSON.parse(t);let r="object"==typeof i&&i.activeTargetIds instanceof Array,s=hl();for(let u=0;r&&u<i.activeTargetIds.length;++u)r=Zc(i.activeTargetIds[u]),s=s.add(i.activeTargetIds[u]);return r?new kl(e,s):(ke("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class Id{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new Id(t.clientId,t.onlineState):(ke("SharedClientState",`Failed to parse online state: ${e}`),null)}}class wd{constructor(){this.activeTargetIds=hl()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class bd{constructor(e,t,i,r,s){this.window=e,this.Hs=t,this.persistenceKey=i,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new be(W),this.started=!1,this.cr=[];const u=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Rm(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new wd),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,T.Z)(function*(){const t=yield e.syncEngine.vi();for(const r of t){if(r===e.sr)continue;const s=e.getItem(Rm(e.persistenceKey,r));if(s){const u=kl.Zi(r,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const i=e.storage.getItem(e.wr);if(i){const r=e.yr(i);r&&e.pr(r)}for(const r of e.cr)e.rr(r);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,i){this.Tr(e,t,i),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(vd(this.persistenceKey,e));if(i){const r=Su.Zi(e,i);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(vd(this.persistenceKey,e))}updateQueryState(e,t,i){this.Rr(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Er(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return N("SharedClientState","READ",e,t),t}setItem(e,t){N("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){N("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const i=e;if(i.storageArea===this.storage){if(N("SharedClientState","EVENT",i.key,i.newValue),i.key===this.ar)return void ke("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,T.Z)(function*(){if(t.started){if(null!==i.key)if(t.lr.test(i.key)){if(null==i.newValue){const r=t.vr(i.key);return t.Vr(r,null)}{const r=t.Sr(i.key,i.newValue);if(r)return t.Vr(r.clientId,r)}}else if(t.dr.test(i.key)){if(null!==i.newValue){const r=t.Dr(i.key,i.newValue);if(r)return t.Cr(r)}}else if(t._r.test(i.key)){if(null!==i.newValue){const r=t.Nr(i.key,i.newValue);if(r)return t.kr(r)}}else if(i.key===t.wr){if(null!==i.newValue){const r=t.yr(i.newValue);if(r)return t.pr(r)}}else if(i.key===t.hr){const r=function(s){let u=ot.at;if(null!=s)try{const d=JSON.parse(s);Z("number"==typeof d),u=d}catch(d){ke("SharedClientState","Failed to read sequence number from WebStorage",d)}return u}(i.newValue);r!==ot.at&&t.sequenceNumberHandler(r)}else if(i.key===t.mr){const r=t.Or(i.newValue);yield Promise.all(r.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(i)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,i){const r=new xl(this.currentUser,e,t,i),s=Nm(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){const t=Nm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,i){const r=vd(this.persistenceKey,e),s=new Su(e,t,i);this.setItem(r,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const i=this.vr(e);return kl.Zi(i,t)}Dr(e,t){const i=this.dr.exec(e),r=Number(i[1]);return xl.Zi(new Ce(void 0!==i[2]?i[2]:null),r,t)}Nr(e,t){const i=this._r.exec(e),r=Number(i[1]);return Su.Zi(r,t)}yr(e){return Id.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,T.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);N("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const i=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(i),u=[],d=[];return s.forEach(f=>{r.has(f)||u.push(f)}),r.forEach(f=>{s.has(f)||d.push(f)}),this.syncEngine.Br(u,d).then(()=>{this.ur=i})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=hl();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class Om{constructor(){this.Lr=new wd,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new wd,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class ov{Ur(e){}shutdown(){}}class Mm{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){N("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){N("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const av={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class uv{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class cv extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,r,s){const u=this.ho(e,t);N("RestConnection","Sending: ",u,i);const d={};return this.lo(d,r,s),this.fo(e,u,d,i).then(f=>(N("RestConnection","Received: ",f),f),f=>{throw Yt("RestConnection",`${e} failed with error: `,f,"url: ",u,"request:",i),f})}_o(e,t,i,r,s,u){return this.ao(e,t,i,r,s)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ct,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}ho(e,t){return`${this.oo}/v1/${t}:${av[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,r){return new Promise((s,u)=>{const d=new qa;d.setWithCredentials(!0),d.listenOnce(Dh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Sr.NO_ERROR:const m=d.getResponseJson();N("Connection","XHR received:",JSON.stringify(m)),s(m);break;case Sr.TIMEOUT:N("Connection",'RPC "'+e+'" timed out'),u(new S(E.DEADLINE_EXCEEDED,"Request time out"));break;case Sr.HTTP_ERROR:const g=d.getStatus();if(N("Connection",'RPC "'+e+'" failed with status:',g,"response text:",d.getResponseText()),g>0){let _=d.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=null==_?void 0:_.error;if(w&&w.status&&w.message){const k=function(C){const M=C.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(M)>=0?M:E.UNKNOWN}(w.status);u(new S(k,w.message))}else u(new S(E.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new S(E.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{N("Connection",'RPC "'+e+'" completed.')}});const f=JSON.stringify(r);d.send(t,"POST",f,i,15)})}wo(e,t,i){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Fa(),u=Ch(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(d.xmlHttpFactory=new Va({})),this.lo(d.initMessageHeaders,t,i),d.encodeInitMessageHeaders=!0;const f=r.join("");N("Connection","Creating WebChannel: "+f,d);const m=s.createWebChannel(f,d);let g=!1,_=!1;const w=new uv({Hr:C=>{_?N("Connection","Not sending because WebChannel is closed:",C):(g||(N("Connection","Opening WebChannel transport."),m.open(),g=!0),N("Connection","WebChannel sending:",C),m.send(C))},Jr:()=>m.close()}),k=(C,M,V)=>{C.listen(M,ae=>{try{V(ae)}catch(he){setTimeout(()=>{throw he},0)}})};return k(m,Vn.EventType.OPEN,()=>{_||N("Connection","WebChannel transport opened.")}),k(m,Vn.EventType.CLOSE,()=>{_||(_=!0,N("Connection","WebChannel transport closed"),w.io())}),k(m,Vn.EventType.ERROR,C=>{_||(_=!0,Yt("Connection","WebChannel transport errored:",C),w.io(new S(E.UNAVAILABLE,"The operation could not be completed")))}),k(m,Vn.EventType.MESSAGE,C=>{var M;if(!_){const V=C.data[0];Z(!!V);const ae=V,he=ae.error||(null===(M=ae[0])||void 0===M?void 0:M.error);if(he){N("Connection","WebChannel received error:",he);const te=he.status;let Q=function(J){const Be=De[J];if(void 0!==Be)return Ep(Be)}(te),K=he.message;void 0===Q&&(Q=E.INTERNAL,K="Unknown error status: "+te+" with message "+he.message),_=!0,w.io(new S(Q,K)),m.close()}else N("Connection","WebChannel received:",V),w.ro(V)}}),k(u,Ua.STAT_EVENT,C=>{C.stat===Fc.PROXY?N("Connection","Detected buffering proxy"):C.stat===Fc.NOPROXY&&N("Connection","Detected no buffering proxy")}),setTimeout(()=>{w.so()},0),w}}function Pm(){return"undefined"!=typeof window?window:null}function Al(){return"undefined"!=typeof document?document:null}function Cu(n){return new e_(n,!0)}class Ed{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-i);r>0&&N("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Lm{constructor(e,t,i,r,s,u,d,f){this.Hs=e,this.vo=i,this.Vo=r,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Ed(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,T.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,T.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var i=this;return(0,T.Z)(function*(){i.Lo(),i.qo(),i.xo.cancel(),i.So++,4!==e?i.xo.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(ke(t.toString()),ke("Using maximum backoff delay to prevent overloading the backend."),i.xo.Ao()):t&&t.code===E.UNAUTHENTICATED&&3!==i.state&&(i.authCredentialsProvider.invalidateToken(),i.appCheckCredentialsProvider.invalidateToken()),null!==i.stream&&(i.Uo(),i.stream.close(),i.stream=null),i.state=e,yield i.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.So===t&&this.Go(i,r)},i=>{e(()=>{const r=new S(E.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(r)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(r=>{i(()=>this.Qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,T.Z)(function*(){e.state=0,e.start()}))}Qo(e){return N("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(N("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class lv extends Lm{constructor(e,t,i,r,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,u),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function i_(n,e){let t;if("targetChange"in e){const i="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:U(),r=e.targetChange.targetIds||[],s=function(f,m){return f.wt?(Z(void 0===m||"string"==typeof m),Ne.fromBase64String(m||"")):(Z(void 0===m||m instanceof Uint8Array),Ne.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,d=u&&function(f){const m=void 0===f.code?E.UNKNOWN:Ep(f.code);return new S(m,f.message||"")}(u);t=new Sp(i,r,s,d||null)}else if("documentChange"in e){const i=e.documentChange,r=vn(n,i.document.name),s=Me(i.document.updateTime),u=i.document.createTime?Me(i.document.createTime):G.min(),d=new qe({mapValue:{fields:i.document.fields}}),f=de.newFoundDocument(r,s,u,d);t=new dl(i.targetIds||[],i.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const i=e.documentDelete,r=vn(n,i.document),s=i.readTime?Me(i.readTime):G.min(),u=de.newNoDocument(r,s);t=new dl([],i.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const i=e.documentRemove,r=vn(n,i.document);t=new dl([],i.removedTargetIds||[],r,null)}else{if(!("filter"in e))return U();{const i=e.filter,s=new cl(i.count||0);t=new Ap(i.targetId,s)}}var f;return t}(this.yt,e),i=function(r){if(!("targetChange"in r))return G.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?G.min():s.readTime?Me(s.readTime):G.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=vu(this.yt),t.addTarget=function(r,s){let u;const d=s.target;return u=ro(d)?{documents:Up(r,d)}:{query:Jh(r,d)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Np(r,s.resumeToken):s.snapshotVersion.compareTo(G.min())>0&&(u.readTime=go(r,s.snapshotVersion.toTimestamp())),u}(this.yt,e);const i=function s_(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return U()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=vu(this.yt),t.removeTarget=e,this.Bo(t)}}class hv extends Lm{constructor(e,t,i,r,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,u),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(Z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function r_(n,e){return n&&n.length>0?(Z(void 0!==e),n.map(t=>function(i,r){let s=Me(i.updateTime?i.updateTime:r);return s.isEqual(G.min())&&(s=Me(r)),new x(s,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),i=Me(e.commitTime);return this.listener.Zo(i,t)}return Z(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=vu(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>Iu(this.yt,i))};this.Bo(t)}}class dv extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=r,this.nu=!1}su(){if(this.nu)throw new S(E.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.ao(e,t,i,r,s)).catch(r=>{throw"FirebaseError"===r.name?(r.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new S(E.UNKNOWN,r.toString())})}_o(e,t,i,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection._o(e,t,i,s,u,r)).catch(s=>{throw"FirebaseError"===s.name?(s.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new S(E.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class pv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(ke(t),this.ou=!1):N("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class mv{constructor(e,t,i,r,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(d=>{i.enqueueAndForget((0,T.Z)(function*(){var f;Kn(u)&&(N("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,T.Z)(function*(m){const g=P(m);g._u.add(4),yield Eo(g),g.gu.set("Unknown"),g._u.delete(4),yield Du(g)}),function(m){return f.apply(this,arguments)})(u))}))}),this.gu=new pv(i,r)}}function Du(n){return xd.apply(this,arguments)}function xd(){return xd=(0,T.Z)(function*(n){if(Kn(n))for(const e of n.wu)yield e(!0)}),xd.apply(this,arguments)}function Eo(n){return kd.apply(this,arguments)}function kd(){return kd=(0,T.Z)(function*(n){for(const e of n.wu)yield e(!1)}),kd.apply(this,arguments)}function Sl(n,e){const t=P(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Cd(t)?Sd(t):xo(t).ko()&&Ad(t,e))}function Ru(n,e){const t=P(n),i=xo(t);t.du.delete(e),i.ko()&&Fm(t,e),0===t.du.size&&(i.ko()?i.Fo():Kn(t)&&t.gu.set("Unknown"))}function Ad(n,e){n.yu.Ot(e.targetId),xo(n).zo(e)}function Fm(n,e){n.yu.Ot(e),xo(n).Ho(e)}function Sd(n){n.yu=new Qy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),xo(n).start(),n.gu.uu()}function Cd(n){return Kn(n)&&!xo(n).No()&&n.du.size>0}function Kn(n){return 0===P(n)._u.size}function Um(n){n.yu=void 0}function gv(n){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,T.Z)(function*(n){n.du.forEach((e,t)=>{Ad(n,e)})}),Dd.apply(this,arguments)}function yv(n,e){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,T.Z)(function*(n,e){Um(n),Cd(n)?(n.gu.hu(e),Sd(n)):n.gu.set("Unknown")}),Rd.apply(this,arguments)}function _v(n,e,t){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,T.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof Sp&&2===e.state&&e.cause)try{yield(i=(0,T.Z)(function*(r,s){const u=s.cause;for(const d of s.targetIds)r.du.has(d)&&(yield r.remoteSyncer.rejectListen(d,u),r.du.delete(d),r.yu.removeTarget(d))}),function(r,s){return i.apply(this,arguments)})(n,e)}catch(i){N("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield Cl(n,i)}else if(e instanceof dl?n.yu.Kt(e):e instanceof Ap?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(G.min()))try{const i=yield km(n.localStore);t.compareTo(i)>=0&&(yield function(r,s){const u=r.yu.Zt(s);return u.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const m=r.du.get(f);m&&r.du.set(f,m.withResumeToken(d.resumeToken,s))}}),u.targetMismatches.forEach(d=>{const f=r.du.get(d);if(!f)return;r.du.set(d,f.withResumeToken(Ne.EMPTY_BYTE_STRING,f.snapshotVersion)),Fm(r,d);const m=new Li(f.target,d,1,f.sequenceNumber);Ad(r,m)}),r.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(i){N("RemoteStore","Failed to raise snapshot:",i),yield Cl(n,i)}var i}),Nd.apply(this,arguments)}function Cl(n,e,t){return Od.apply(this,arguments)}function Od(){return Od=(0,T.Z)(function*(n,e,t){if(!fn(e))throw e;n._u.add(1),yield Eo(n),n.gu.set("Offline"),t||(t=()=>km(n.localStore)),n.asyncQueue.enqueueRetryable((0,T.Z)(function*(){N("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Du(n)}))}),Od.apply(this,arguments)}function Vm(n,e){return e().catch(t=>Cl(n,t,e))}function To(n){return Md.apply(this,arguments)}function Md(){return Md=(0,T.Z)(function*(n){const e=P(n),t=qi(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;vv(e);)try{const r=yield iv(e.localStore,i);if(null===r){0===e.fu.length&&t.Fo();break}i=r.batchId,Iv(e,r)}catch(r){yield Cl(e,r)}qm(e)&&Bm(e)}),Md.apply(this,arguments)}function vv(n){return Kn(n)&&n.fu.length<10}function Iv(n,e){n.fu.push(e);const t=qi(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function qm(n){return Kn(n)&&!qi(n).No()&&n.fu.length>0}function Bm(n){qi(n).start()}function wv(n){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,T.Z)(function*(n){qi(n).eu()}),Pd.apply(this,arguments)}function bv(n){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,T.Z)(function*(n){const e=qi(n);for(const t of n.fu)e.Xo(t.mutations)}),Ld.apply(this,arguments)}function Ev(n,e,t){return Fd.apply(this,arguments)}function Fd(){return Fd=(0,T.Z)(function*(n,e,t){const i=n.fu.shift(),r=td.from(i,e,t);yield Vm(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield To(n)}),Fd.apply(this,arguments)}function Tv(n,e){return Ud.apply(this,arguments)}function Ud(){return Ud=(0,T.Z)(function*(n,e){var t;e&&qi(n).Yo&&(yield(t=(0,T.Z)(function*(i,r){if(ll(s=r.code)&&s!==E.ABORTED){const u=i.fu.shift();qi(i).Mo(),yield Vm(i,()=>i.remoteSyncer.rejectFailedWrite(u.batchId,r)),yield To(i)}var s}),function(i,r){return t.apply(this,arguments)})(n,e)),qm(n)&&Bm(n)}),Ud.apply(this,arguments)}function Zm(n,e){return Vd.apply(this,arguments)}function Vd(){return Vd=(0,T.Z)(function*(n,e){const t=P(n);t.asyncQueue.verifyOperationInProgress(),N("RemoteStore","RemoteStore received new credentials");const i=Kn(t);t._u.add(3),yield Eo(t),i&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Du(t)}),Vd.apply(this,arguments)}function qd(n,e){return Bd.apply(this,arguments)}function Bd(){return Bd=(0,T.Z)(function*(n,e){const t=P(n);e?(t._u.delete(2),yield Du(t)):e||(t._u.add(2),yield Eo(t),t.gu.set("Unknown"))}),Bd.apply(this,arguments)}function xo(n){return n.pu||(n.pu=function(e,t,i){const r=P(e);return r.su(),new lv(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:gv.bind(null,n),Zr:yv.bind(null,n),Wo:_v.bind(null,n)}),n.wu.push(function(){var e=(0,T.Z)(function*(t){t?(n.pu.Mo(),Cd(n)?Sd(n):n.gu.set("Unknown")):(yield n.pu.stop(),Um(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function qi(n){return n.Iu||(n.Iu=function(e,t,i){const r=P(e);return r.su(),new hv(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:wv.bind(null,n),Zr:Tv.bind(null,n),tu:bv.bind(null,n),Zo:Ev.bind(null,n)}),n.wu.push(function(){var e=(0,T.Z)(function*(t){t?(n.Iu.Mo(),yield To(n)):(yield n.Iu.stop(),n.fu.length>0&&(N("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class Zd{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new Ae,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,i,r,s){const u=Date.now()+i,d=new Zd(e,t,u,r,s);return d.start(i),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new S(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ko(n,e){if(ke("AsyncQueue",`${e}: ${n}`),fn(n))return new S(E.UNAVAILABLE,`${e}: ${n}`);throw n}class Ao{constructor(e){this.comparator=e?(t,i)=>e(t,i)||O.comparator(t.key,i.key):(t,i)=>O.comparator(t.key,i.key),this.keyedMap=pu(),this.sortedSet=new be(this.comparator)}static emptySet(e){return new Ao(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ao)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const i=new Ao;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Gm{constructor(){this.Tu=new be(O.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?0!==e.type&&3===i.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==i.type?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):2===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===i.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===i.type?this.Tu=this.Tu.remove(t):1===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):0===e.type&&1===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):U():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class So{constructor(e,t,i,r,s,u,d,f,m){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,i,r,s){const u=[];return t.forEach(d=>{u.push({type:0,doc:d})}),new So(e,t,Ao.emptySet(t),u,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Br(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}class xv{constructor(){this.Au=void 0,this.listeners=[]}}class kv{constructor(){this.queries=new Pi(e=>ol(e),Br),this.onlineState="Unknown",this.Ru=new Set}}function Gd(n,e){return zd.apply(this,arguments)}function zd(){return zd=(0,T.Z)(function*(n,e){const t=P(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new xv),r)try{s.Au=yield t.onListen(i)}catch(u){const d=ko(u,`Initialization of query '${lo(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&Wd(t)}),zd.apply(this,arguments)}function $d(n,e){return jd.apply(this,arguments)}function jd(){return jd=(0,T.Z)(function*(n,e){const t=P(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),r=0===s.listeners.length)}if(r)return t.queries.delete(i),t.onUnlisten(i)}),jd.apply(this,arguments)}function Av(n,e){const t=P(n);let i=!1;for(const r of e){const u=t.queries.get(r.query);if(u){for(const d of u.listeners)d.Pu(r)&&(i=!0);u.Au=r}}i&&Wd(t)}function Sv(n,e,t){const i=P(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function Wd(n){n.Ru.forEach(e=>{e.next()})}class Kd{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)3!==r.type&&i.push(r);e=new So(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=So.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Cv{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class zm{constructor(e){this.yt=e}Ji(e){return vn(this.yt,e)}Yi(e){return e.metadata.exists?Fp(this.yt,e.document,!1):de.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Me(e)}}class Dv{constructor(e,t,i){this.Mu=e,this.localStore=t,this.yt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$m(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const i=X.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,i=new zm(this.yt);for(const r of e)if(r.metadata.queries){const s=i.Ji(r.metadata.name);for(const u of r.metadata.queries){const d=(t.get(u)||H()).add(s);t.set(u,d)}}return t}complete(){var e=this;return(0,T.Z)(function*(){const t=yield function rv(n,e,t,i){return yd.apply(this,arguments)}(e.localStore,new zm(e.yt),e.documents,e.Mu.id),i=e.$u(e.documents);for(const r of e.queries)yield sv(e.localStore,r,i.get(r.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function $m(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class jm{constructor(e){this.key=e}}class Wm{constructor(e){this.key=e}}class Km{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=H(),this.mutatedKeys=H(),this.Gu=fo(e),this.Qu=new Ao(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new Gm,r=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=r,d=!1;const f="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,m="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((g,_)=>{const w=r.get(g),k=ze(this.query,_)?_:null,C=!!w&&this.mutatedKeys.has(w.key),M=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let V=!1;w&&k?w.data.isEqual(k.data)?C!==M&&(i.track({type:3,doc:k}),V=!0):this.Hu(w,k)||(i.track({type:2,doc:k}),V=!0,(f&&this.Gu(k,f)>0||m&&this.Gu(k,m)<0)&&(d=!0)):!w&&k?(i.track({type:0,doc:k}),V=!0):w&&!k&&(i.track({type:1,doc:w}),V=!0,(f||m)&&(d=!0)),V&&(k?(u=u.add(k),s=M?s.add(g):s.delete(g)):(u=u.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),s=s.delete(g.key),i.track({type:1,doc:g})}return{Qu:u,zu:i,$i:d,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((m,g)=>function(_,w){const k=C=>{switch(C){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return k(_)-k(w)}(m.type,g.type)||this.Gu(m.doc,g.doc)),this.Ju(i);const u=t?this.Yu():[],d=0===this.Ku.size&&this.current?1:0,f=d!==this.Uu;return this.Uu=d,0!==s.length||f?{snapshot:new So(this.query,e.Qu,r,s,e.mutatedKeys,0===d,f,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Gm,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=H(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new Wm(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new jm(i))}),t}tc(e){this.qu=e.Hi,this.Ku=H();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return So.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Rv{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class Nv{constructor(e){this.key=e,this.nc=!1}}class Ov{constructor(e,t,i,r,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new Pi(d=>ol(d),Br),this.rc=new Map,this.oc=new Set,this.uc=new be(O.comparator),this.cc=new Map,this.ac=new ld,this.hc={},this.lc=new Map,this.fc=Hr.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Mv(n,e){return Hd.apply(this,arguments)}function Hd(){return Hd=(0,T.Z)(function*(n,e){const t=vf(n);let i,r;const s=t.ic.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.ec();else{const u=yield wo(t.localStore,Ee(e));t.isPrimaryClient&&Sl(t.remoteStore,u);const d=t.sharedClientState.addLocalQueryTarget(u.targetId);i=u.targetId,r=yield Qd(t,e,i,"current"===d,u.resumeToken)}return r}),Hd.apply(this,arguments)}function Qd(n,e,t,i,r){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,T.Z)(function*(n,e,t,i,r){n._c=(_,w,k)=>{return(C=(0,T.Z)(function*(M,V,ae,he){let te=V.view.Wu(ae);te.$i&&(te=yield Tl(M.localStore,V.query,!1).then(({documents:J})=>V.view.Wu(J,te)));const Q=he&&he.targetChanges.get(V.targetId),K=V.view.applyChanges(te,M.isPrimaryClient,Q);return uf(M,V.targetId,K.Xu),K.snapshot}),function(M,V,ae,he){return C.apply(this,arguments)})(n,_,w,k);var C};const s=yield Tl(n.localStore,e,!0),u=new Km(e,s.Hi),d=u.Wu(s.documents),f=yu.createSynthesizedTargetChangeForCurrentChange(t,i&&"Offline"!==n.onlineState,r),m=u.applyChanges(d,n.isPrimaryClient,f);uf(n,t,m.Xu);const g=new Rv(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),m.snapshot}),Yd.apply(this,arguments)}function Pv(n,e){return Jd.apply(this,arguments)}function Jd(){return Jd=(0,T.Z)(function*(n,e){const t=P(n),i=t.ic.get(e),r=t.rc.get(i.targetId);if(r.length>1)return t.rc.set(i.targetId,r.filter(s=>!Br(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||(yield bo(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Ru(t.remoteStore,i.targetId),Co(t,i.targetId)}).catch(dn))):(Co(t,i.targetId),yield bo(t.localStore,i.targetId,!0))}),Jd.apply(this,arguments)}function Xd(){return Xd=(0,T.Z)(function*(n,e,t){const i=If(n);try{const r=yield function(s,u){const d=P(s),f=le.now(),m=u.reduce((w,k)=>w.add(k.key),H());let g,_;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=gt(),C=H();return d.Gi.getEntries(w,m).next(M=>{k=M,k.forEach((V,ae)=>{ae.isValidDocument()||(C=C.add(V))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,k)).next(M=>{g=M;const V=[];for(const ae of u){const he=po(ae,g.get(ae.key).overlayedDocument);null!=he&&V.push(new Mt(ae.key,he,il(he.value.mapValue),A.exists(!0)))}return d.mutationQueue.addMutationBatch(w,f,V,u)}).next(M=>{_=M;const V=M.applyToLocalDocumentSet(g,C);return d.documentOverlayCache.saveOverlays(w,M.batchId,V)})}).then(()=>({batchId:_.batchId,changes:xp(g)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,u,d){let f=s.hc[s.currentUser.toKey()];f||(f=new be(W)),f=f.insert(u,d),s.hc[s.currentUser.toKey()]=f}(i,r.batchId,t),yield Hn(i,r.changes),yield To(i.remoteStore)}catch(r){const s=ko(r,"Failed to persist write");t.reject(s)}}),Xd.apply(this,arguments)}function Hm(n,e){return ef.apply(this,arguments)}function ef(){return ef=(0,T.Z)(function*(n,e){const t=P(n);try{const i=yield nv(t.localStore,e);e.targetChanges.forEach((r,s)=>{const u=t.cc.get(s);u&&(Z(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?u.nc=!0:r.modifiedDocuments.size>0?Z(u.nc):r.removedDocuments.size>0&&(Z(u.nc),u.nc=!1))}),yield Hn(t,i,e)}catch(i){yield dn(i)}}),ef.apply(this,arguments)}function Qm(n,e,t){const i=P(n);if(i.isPrimaryClient&&0===t||!i.isPrimaryClient&&1===t){const r=[];i.ic.forEach((s,u)=>{const d=u.view.bu(e);d.snapshot&&r.push(d.snapshot)}),function(s,u){const d=P(s);d.onlineState=u;let f=!1;d.queries.forEach((m,g)=>{for(const _ of g.listeners)_.bu(u)&&(f=!0)}),f&&Wd(d)}(i.eventManager,e),r.length&&i.sc.Wo(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function Fv(n,e,t){return tf.apply(this,arguments)}function tf(){return tf=(0,T.Z)(function*(n,e,t){const i=P(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.cc.get(e),s=r&&r.key;if(s){let u=new be(O.comparator);u=u.insert(s,de.newNoDocument(s,G.min()));const d=H().add(s),f=new gu(G.min(),new Map,new oe(W),u,d);yield Hm(i,f),i.uc=i.uc.remove(s),i.cc.delete(e),cf(i)}else yield bo(i.localStore,e,!1).then(()=>Co(i,e,t)).catch(dn)}),tf.apply(this,arguments)}function Uv(n,e){return nf.apply(this,arguments)}function nf(){return nf=(0,T.Z)(function*(n,e){const t=P(n),i=e.batch.batchId;try{const r=yield tv(t.localStore,e);af(t,i,null),of(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Hn(t,r)}catch(r){yield dn(r)}}),nf.apply(this,arguments)}function Vv(n,e,t){return rf.apply(this,arguments)}function rf(){return rf=(0,T.Z)(function*(n,e,t){const i=P(n);try{const r=yield function(s,u){const d=P(s);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return d.mutationQueue.lookupMutationBatch(f,u).next(g=>(Z(null!==g),m=g.keys(),d.mutationQueue.removeMutationBatch(f,g))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>d.localDocuments.getDocuments(f,m))})}(i.localStore,e);af(i,e,t),of(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Hn(i,r)}catch(r){yield dn(r)}}),rf.apply(this,arguments)}function sf(){return sf=(0,T.Z)(function*(n,e){const t=P(n);Kn(t.remoteStore)||N("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=yield function(s){const u=P(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>u.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===i)return void e.resolve();const r=t.lc.get(i)||[];r.push(e),t.lc.set(i,r)}catch(i){const r=ko(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}),sf.apply(this,arguments)}function of(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function af(n,e,t){const i=P(n);let r=i.hc[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.hc[i.currentUser.toKey()]=r}}function Co(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||Ym(n,i)})}function Ym(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Ru(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),cf(n))}function uf(n,e,t){for(const i of t)i instanceof jm?(n.ac.addReference(i.key,e),Bv(n,i)):i instanceof Wm?(N("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||Ym(n,i.key)):U()}function Bv(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(N("SyncEngine","New document in limbo: "+t),n.oc.add(i),cf(n))}function cf(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new O(X.fromString(e)),i=n.fc.next();n.cc.set(i,new Nv(t)),n.uc=n.uc.insert(t,i),Sl(n.remoteStore,new Li(Ee(Ni(t.path)),i,2,ot.at))}}function Hn(n,e,t){return lf.apply(this,arguments)}function lf(){return lf=(0,T.Z)(function*(n,e,t){const i=P(n),r=[],s=[],u=[];var d;i.ic.isEmpty()||(i.ic.forEach((d,f)=>{u.push(i._c(f,e,t).then(m=>{if((m||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(f.targetId,(null==m?void 0:m.fromCache)?"not-current":"current"),m){r.push(m);const g=pd.Ci(f.targetId,m);s.push(g)}}))}),yield Promise.all(u),i.sc.Wo(r),yield(d=(0,T.Z)(function*(f,m){const g=P(f);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>b.forEach(m,w=>b.forEach(w.Si,k=>g.persistence.referenceDelegate.addReference(_,w.targetId,k)).next(()=>b.forEach(w.Di,k=>g.persistence.referenceDelegate.removeReference(_,w.targetId,k)))))}catch(_){if(!fn(_))throw _;N("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const w=_.targetId;if(!_.fromCache){const k=g.qi.get(w),M=k.withLastLimboFreeSnapshotVersion(k.snapshotVersion);g.qi=g.qi.insert(w,M)}}}),function(f,m){return d.apply(this,arguments)})(i.localStore,s))}),lf.apply(this,arguments)}function Zv(n,e){return hf.apply(this,arguments)}function hf(){return hf=(0,T.Z)(function*(n,e){const t=P(n);if(!t.currentUser.isEqual(e)){N("SyncEngine","User change. New user:",e.toKey());const i=yield xm(t.localStore,e);t.currentUser=e,(r=t).lc.forEach(u=>{u.forEach(d=>{d.reject(new S(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.lc.clear(),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Hn(t,i.ji)}var r}),hf.apply(this,arguments)}function Gv(n,e){const t=P(n),i=t.cc.get(e);if(i&&i.nc)return H().add(i.key);{let r=H();const s=t.rc.get(e);if(!s)return r;for(const u of s){const d=t.ic.get(u);r=r.unionWith(d.view.ju)}return r}}function zv(n,e){return df.apply(this,arguments)}function df(){return df=(0,T.Z)(function*(n,e){const t=P(n),i=yield Tl(t.localStore,e.query,!0),r=e.view.tc(i);return t.isPrimaryClient&&uf(t,e.targetId,r.Xu),r}),df.apply(this,arguments)}function $v(n,e){return ff.apply(this,arguments)}function ff(){return ff=(0,T.Z)(function*(n,e){const t=P(n);return Cm(t.localStore,e).then(i=>Hn(t,i))}),ff.apply(this,arguments)}function jv(n,e,t,i){return pf.apply(this,arguments)}function pf(){return pf=(0,T.Z)(function*(n,e,t,i){const r=P(n),s=yield function(u,d){const f=P(u),m=P(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",g=>m.Tn(g,d).next(_=>_?f.localDocuments.getDocuments(g,_):b.resolve(null)))}(r.localStore,e);var d;null!==s?("pending"===t?yield To(r.remoteStore):"acknowledged"===t||"rejected"===t?(af(r,e,i||null),of(r,e),d=e,P(P(r.localStore).mutationQueue).An(d)):U(),yield Hn(r,s)):N("SyncEngine","Cannot apply mutation batch with id: "+e)}),pf.apply(this,arguments)}function mf(){return mf=(0,T.Z)(function*(n,e){const t=P(n);if(vf(t),If(t),!0===e&&!0!==t.dc){const i=t.sharedClientState.getAllActiveQueryTargets(),r=yield Jm(t,i.toArray());t.dc=!0,yield qd(t.remoteStore,!0);for(const s of r)Sl(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const i=[];let r=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?i.push(u):r=r.then(()=>(Co(t,u),bo(t.localStore,u,!0))),Ru(t.remoteStore,u)}),yield r,yield Jm(t,i),function(s){const u=P(s);u.cc.forEach((d,f)=>{Ru(u.remoteStore,f)}),u.ac.fs(),u.cc=new Map,u.uc=new be(O.comparator)}(t),t.dc=!1,yield qd(t.remoteStore,!1)}}),mf.apply(this,arguments)}function Jm(n,e,t){return gf.apply(this,arguments)}function gf(){return gf=(0,T.Z)(function*(n,e,t){const i=P(n),r=[],s=[];for(const u of e){let d;const f=i.rc.get(u);if(f&&0!==f.length){d=yield wo(i.localStore,Ee(f[0]));for(const m of f){const g=i.ic.get(m),_=yield zv(i,g);_.snapshot&&s.push(_.snapshot)}}else{const m=yield Sm(i.localStore,u);d=yield wo(i.localStore,m),yield Qd(i,Xm(m),u,!1,d.resumeToken)}r.push(d)}return i.sc.Wo(s),r}),gf.apply(this,arguments)}function Xm(n){return uu(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Kv(n){const e=P(n);return P(P(e.localStore).persistence).vi()}function Hv(n,e,t,i){return yf.apply(this,arguments)}function yf(){return yf=(0,T.Z)(function*(n,e,t,i){const r=P(n);if(r.dc)return void N("SyncEngine","Ignoring unexpected query state notification.");const s=r.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield Cm(r.localStore,ho(s[0])),d=gu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Ne.EMPTY_BYTE_STRING);yield Hn(r,u,d);break}case"rejected":yield bo(r.localStore,e,!0),Co(r,e,i);break;default:U()}}),yf.apply(this,arguments)}function Qv(n,e,t){return _f.apply(this,arguments)}function _f(){return _f=(0,T.Z)(function*(n,e,t){const i=vf(n);if(i.dc){for(const r of e){if(i.rc.has(r)){N("SyncEngine","Adding an already active target "+r);continue}const s=yield Sm(i.localStore,r),u=yield wo(i.localStore,s);yield Qd(i,Xm(s),u.targetId,!1,u.resumeToken),Sl(i.remoteStore,u)}for(const r of t)i.rc.has(r)&&(yield bo(i.localStore,r,!1).then(()=>{Ru(i.remoteStore,r),Co(i,r)}).catch(dn))}}),_f.apply(this,arguments)}function vf(n){const e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Hm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Fv.bind(null,e),e.sc.Wo=Av.bind(null,e.eventManager),e.sc.wc=Sv.bind(null,e.eventManager),e}function If(n){const e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Uv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vv.bind(null,e),e}class eg{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,T.Z)(function*(){t.yt=Cu(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Tm(this.persistence,new Em,e.initialUser,this.yt)}yc(e){return new wm(bl.Bs,this.yt)}gc(e){return new Om}terminate(){var e=this;return(0,T.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class tg extends eg{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,i=this;return(0,T.Z)(function*(){yield t().call(i,e),yield i.Ac.initialize(i,e),yield If(i.Ac.syncEngine),yield To(i.Ac.remoteStore),yield i.persistence.li(()=>(i.gcScheduler&&!i.gcScheduler.started&&i.gcScheduler.start(),i.indexBackfillerScheduler&&!i.indexBackfillerScheduler.started&&i.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Tm(this.persistence,new Em,e.initialUser,this.yt)}Tc(e,t){return new q_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const i=new Uh(t,this.persistence);return new Fh(e.asyncQueue,i)}yc(e){const t=fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=void 0!==this.cacheSizeBytes?yt.withCacheSize(this.cacheSizeBytes):yt.DEFAULT;return new dd(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Pm(),Al(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Om}}class Jv extends tg{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,i=this;return(0,T.Z)(function*(){yield t().call(i,e);const r=i.Ac.syncEngine;i.sharedClientState instanceof bd&&(i.sharedClientState.syncEngine={Fr:jv.bind(null,r),$r:Hv.bind(null,r),Br:Qv.bind(null,r),vi:Kv.bind(null,r),Mr:$v.bind(null,r)},yield i.sharedClientState.start()),yield i.persistence.li(function(){var s=(0,T.Z)(function*(u){yield function Wv(n,e){return mf.apply(this,arguments)}(i.Ac.syncEngine,u),i.gcScheduler&&(u&&!i.gcScheduler.started?i.gcScheduler.start():u||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(u&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():u||i.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Pm();if(!bd.C(t))throw new S(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=fd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new bd(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class wf{initialize(e,t){var i=this;return(0,T.Z)(function*(){i.localStore||(i.localStore=e.localStore,i.sharedClientState=e.sharedClientState,i.datastore=i.createDatastore(t),i.remoteStore=i.createRemoteStore(t),i.eventManager=i.createEventManager(t),i.syncEngine=i.createSyncEngine(t,!e.synchronizeTabs),i.sharedClientState.onlineStateHandler=r=>Qm(i.syncEngine,r,1),i.remoteStore.remoteSyncer.handleCredentialChange=Zv.bind(null,i.syncEngine),yield qd(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(e){return new kv}createDatastore(e){const t=Cu(e.databaseInfo.databaseId),i=new cv(e.databaseInfo);return new dv(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=d=>Qm(this.syncEngine,d,0),u=Mm.C()?new Mm:new ov,new mv(t,i,r,s,u);var t,i,r,s,u}createSyncEngine(e,t){return function(i,r,s,u,d,f,m){const g=new Ov(i,r,s,u,d,f);return m&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,T.Z)(function*(t){const i=P(t);N("RemoteStore","RemoteStore shutting down."),i._u.add(5),yield Eo(i),i.mu.shutdown(),i.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function bf(n,e,t){if(!t)throw new S(E.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ng(n,e,t,i){if(!0===e&&!0===i)throw new S(E.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ig(n){if(!O.isDocumentKey(n))throw new S(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rg(n){if(O.isDocumentKey(n))throw new S(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Dl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":U()}function ie(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new S(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Dl(n);throw new S(E.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sg(n,e){if(e<=0)throw new S(E.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const og=new Map;class ag{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new S(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new S(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ng("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Nu{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ag({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new S(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new S(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ag(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Nh;switch(t.type){case"gapi":return new Za(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new S(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=og.get(e);t&&(N("ComponentProvider","Removing Datastore"),og.delete(e),t.terminate())}(this),Promise.resolve()}}class me{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new wn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new me(this.firestore,e,this._key)}}class Ye{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Ye(this.firestore,e,this._query)}}class wn extends Ye{constructor(e,t,i){super(e,t,Ni(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new me(this.firestore,null,new O(e))}withConverter(e){return new wn(this.firestore,e,this._path)}}function cg(n,e,...t){if(n=(0,re.m9)(n),bf("collection","path",e),n instanceof Nu){const i=X.fromString(e,...t);return rg(i),new wn(n,null,i)}{if(!(n instanceof me||n instanceof wn))throw new S(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(X.fromString(e,...t));return rg(i),new wn(n.firestore,null,i)}}function Rl(n,e,...t){if(n=(0,re.m9)(n),1===arguments.length&&(e=$a.R()),bf("doc","path",e),n instanceof Nu){const i=X.fromString(e,...t);return ig(i),new me(n,null,new O(i))}{if(!(n instanceof me||n instanceof wn))throw new S(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(X.fromString(e,...t));return ig(i),new me(n.firestore,n instanceof wn?n.converter:null,new O(i))}}function lg(n,e){return n=(0,re.m9)(n),e=(0,re.m9)(e),(n instanceof me||n instanceof wn)&&(e instanceof me||e instanceof wn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function Ef(n,e){return n=(0,re.m9)(n),e=(0,re.m9)(e),n instanceof Ye&&e instanceof Ye&&n.firestore===e.firestore&&Br(n._query,e._query)&&n.converter===e.converter}function hg(n,e=10240){let t=0;return{read:()=>(0,T.Z)(function*(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})(),cancel:()=>(0,T.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Nl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):ke("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class e0{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Ae,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(i=>{i&&i.Ou()?this.metadata.resolve(i.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==i?void 0:i.ku)}`))},i=>this.metadata.reject(i))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,T.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,T.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,T.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const i=e.vc.decode(t),r=Number(i);isNaN(r)&&e.Dc(`length string (${i}) is not valid number`);const s=yield e.Cc(r);return new Cv(JSON.parse(s),t.length+r)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,T.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const i=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),i})()}Cc(e){var t=this;return(0,T.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const i=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),i})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,T.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const i=new Uint8Array(e.buffer.length+t.value.length);i.set(e.buffer),i.set(t.value,e.buffer.length),e.buffer=i}return t.done})()}}class r0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,T.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new S(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield(r=(0,T.Z)(function*(s,u){const d=P(s),f=vu(d.yt)+"/documents",m={documents:u.map(k=>_u(d.yt,k))},g=yield d._o("BatchGetDocuments",f,m,u.length),_=new Map;g.forEach(k=>{const C=function n_(n,e){return"found"in e?function(t,i){Z(!!i.found);const r=vn(t,i.found.name),s=Me(i.found.updateTime),u=i.found.createTime?Me(i.found.createTime):G.min(),d=new qe({mapValue:{fields:i.found.fields}});return de.newFoundDocument(r,s,u,d)}(n,e):"missing"in e?function(t,i){Z(!!i.missing),Z(!!i.readTime);const r=vn(t,i.missing),s=Me(i.readTime);return de.newNoDocument(r,s)}(n,e):U()}(d.yt,k);_.set(C.key.toString(),C)});const w=[];return u.forEach(k=>{const C=_.get(k.toString());Z(!!C),w.push(C)}),w}),function(s,u){return r.apply(this,arguments)})(t.datastore,e);var r;return i.forEach(r=>t.recordVersion(r)),i})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Wn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,T.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var i;e.mutations.forEach(i=>{t.delete(i.key.toString())}),t.forEach((i,r)=>{const s=O.fromPath(r);e.mutations.push(new Gr(s,e.precondition(s)))}),yield(i=(0,T.Z)(function*(r,s){const u=P(r),d=vu(u.yt)+"/documents",f={writes:s.map(m=>Iu(u.yt,m))};yield u.ao("Commit",d,f)}),function(r,s){return i.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=G.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new S(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?A.exists(!1):A.updateTime(t):A.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new S(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return A.updateTime(t)}return A.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class s0{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.kc=i.maxAttempts,this.xo=new Ed(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,T.Z)(function*(){const t=new r0(e.datastore),i=e.Mc(t);i&&i.then(r=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(r)}).catch(s=>{e.Fc(s)}))}).catch(r=>{e.Fc(r)})}))}Mc(e){try{const t=this.updateFunction(e);return!Pr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ll(t)}return!1}}class o0{constructor(e,t,i,r){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Ce.UNAUTHENTICATED,this.clientId=$a.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,function(){var u=(0,T.Z)(function*(d){N("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(i,u=>(N("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,T.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new S(E.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ae;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,T.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(i){const r=ko(i,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function dg(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,T.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),N("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,T.Z)(function*(s){i.isEqual(s)||(yield xm(e.localStore,s),i=s)});return function(s){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Tf.apply(this,arguments)}function fg(n,e){return xf.apply(this,arguments)}function xf(){return xf=(0,T.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield kf(n);N("FirestoreClient","Initializing OnlineComponentProvider");const i=yield n.getConfiguration();yield e.initialize(t,i),n.setCredentialChangeListener(r=>Zm(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Zm(e.remoteStore,s)),n.onlineComponents=e}),xf.apply(this,arguments)}function kf(n){return Af.apply(this,arguments)}function Af(){return Af=(0,T.Z)(function*(n){return n.offlineComponents||(N("FirestoreClient","Using default OfflineComponentProvider"),yield dg(n,new eg)),n.offlineComponents}),Af.apply(this,arguments)}function Ol(n){return Sf.apply(this,arguments)}function Sf(){return Sf=(0,T.Z)(function*(n){return n.onlineComponents||(N("FirestoreClient","Using default OnlineComponentProvider"),yield fg(n,new wf)),n.onlineComponents}),Sf.apply(this,arguments)}function pg(n){return kf(n).then(e=>e.persistence)}function Ml(n){return kf(n).then(e=>e.localStore)}function Cf(n){return Ol(n).then(e=>e.remoteStore)}function Df(n){return Ol(n).then(e=>e.syncEngine)}function Do(n){return Rf.apply(this,arguments)}function Rf(){return Rf=(0,T.Z)(function*(n){const e=yield Ol(n),t=e.eventManager;return t.onListen=Mv.bind(null,e.syncEngine),t.onUnlisten=Pv.bind(null,e.syncEngine),t}),Rf.apply(this,arguments)}function gg(n,e,t={}){const i=new Ae;return n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return function(r,s,u,d,f){const m=new Nl({next:_=>{s.enqueueAndForget(()=>$d(r,g));const w=_.docs.has(u);!w&&_.fromCache?f.reject(new S(E.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&_.fromCache&&d&&"server"===d.source?f.reject(new S(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new Kd(Ni(u.path),m,{includeMetadataChanges:!0,Nu:!0});return Gd(r,g)}(yield Do(n),n.asyncQueue,e,t,i)})),i.promise}function yg(n,e,t={}){const i=new Ae;return n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return function(r,s,u,d,f){const m=new Nl({next:_=>{s.enqueueAndForget(()=>$d(r,g)),_.fromCache&&"server"===d.source?f.reject(new S(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new Kd(u,m,{includeMetadataChanges:!0,Nu:!0});return Gd(r,g)}(yield Do(n),n.asyncQueue,e,t,i)})),i.promise}class p0{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new Ed(this,"async_queue_retry"),this.Wc=()=>{const t=Al();t&&N("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=Al();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=Al();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Ae;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,T.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!fn(t))throw t;N("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{throw this.Kc=i,this.Gc=!1,ke("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(i)),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=Zd.createAndSchedule(this,e,t,i,s=>this.Yc(s));return this.Uc.push(r),r}zc(){this.Kc&&U()}verifyOperationInProgress(){}Xc(){var e=this;return(0,T.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Nf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const i=e;for(const r of["next","error","complete"])if(r in i&&"function"==typeof i[r])return!0;return!1}(n)}class m0{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ae,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ge extends Nu{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new p0,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||_g(this),this._firestoreClient.terminate()}}function Pe(n){return n._firestoreClient||_g(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function _g(n){var e;const t=n._freezeSettings(),i=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Vh(n._databaseId,s,n._persistenceKey,(d=t).host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,d.useFetchStreams));var s,d;n._firestoreClient=new o0(n._authCredentials,n._appCheckCredentials,n._queue,i)}function vg(n,e,t){const i=new Ae;return n.asyncQueue.enqueue((0,T.Z)(function*(){try{yield dg(n,t),yield fg(n,e),i.resolve()}catch(r){const s=r;if(!("FirebaseError"===(u=s).name?u.code===E.FAILED_PRECONDITION||u.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;Yt("Error enabling offline persistence. Falling back to persistence disabled: "+s),i.reject(s)}var u})).then(()=>i.promise)}function Ig(n){if(n._initialized||n._terminated)throw new S(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class bn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new bn(Ne.fromBase64String(e))}catch(t){throw new S(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new bn(Ne.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Qn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new S(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Ie(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yr{constructor(e){this._methodName=e}}class Pl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new S(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new S(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}const x0=/^__.*__$/;class k0{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return null!==this.fieldMask?new Mt(e,this.data,this.fieldMask,t,this.fieldTransforms):new yn(e,this.data,t,this.fieldTransforms)}}class wg{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Mt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function bg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}class Ll{constructor(e,t,i,r,s,u){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Ll(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.ua(e),r}ca(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Vl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(bg(this.sa)&&x0.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class A0{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||Cu(e)}da(e,t,i,r=!1){return new Ll({sa:e,methodName:t,fa:i,path:Ie.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Jr(n){const e=n._freezeSettings(),t=Cu(n._databaseId);return new A0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Fl(n,e,t,i,r,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,r);Lf("Data must be an object, but it was:",u,i);const d=xg(i,u);let f,m;if(s.merge)f=new at(u.fieldMask),m=u.fieldTransforms;else if(s.mergeFields){const g=[];for(const _ of s.mergeFields){const w=Ff(e,_,t);if(!u.contains(w))throw new S(E.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Ag(g,w)||g.push(w)}f=new at(g),m=u.fieldTransforms.filter(_=>f.covers(_.field))}else f=null,m=u.fieldTransforms;return new k0(new qe(d),f,m)}class Ou extends Yr{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ou}}function Eg(n,e,t){return new Ll({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class Of extends Yr{_toFieldTransform(e){return new y(e.path,new Mi)}isEqual(e){return e instanceof Of}}class S0 extends Yr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Eg(this,e,!0),i=this._a.map(s=>Xr(s,t)),r=new jn(i);return new y(e.path,r)}isEqual(e){return this===e}}class C0 extends Yr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Eg(this,e,!0),i=this._a.map(s=>Xr(s,t)),r=new c(i);return new y(e.path,r)}isEqual(e){return this===e}}class D0 extends Yr{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new a(e.yt,cu(e.yt,this.wa));return new y(e.path,t)}isEqual(e){return this===e}}function Mf(n,e,t,i){const r=n.da(1,e,t);Lf("Data must be an object, but it was:",r,i);const s=[],u=qe.empty();Bn(i,(f,m)=>{const g=Ul(e,f,t);m=(0,re.m9)(m);const _=r.ca(g);if(m instanceof Ou)s.push(g);else{const w=Xr(m,_);null!=w&&(s.push(g),u.set(g,w))}});const d=new at(s);return new wg(u,d,r.fieldTransforms)}function Pf(n,e,t,i,r,s){const u=n.da(1,e,t),d=[Ff(e,i,t)],f=[r];if(s.length%2!=0)throw new S(E.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)d.push(Ff(e,s[w])),f.push(s[w+1]);const m=[],g=qe.empty();for(let w=d.length-1;w>=0;--w)if(!Ag(m,d[w])){const k=d[w];let C=f[w];C=(0,re.m9)(C);const M=u.ca(k);if(C instanceof Ou)m.push(k);else{const V=Xr(C,M);null!=V&&(m.push(k),g.set(k,V))}}const _=new at(m);return new wg(g,_,u.fieldTransforms)}function Tg(n,e,t,i=!1){return Xr(t,n.da(i?4:3,e))}function Xr(n,e){if(kg(n=(0,re.m9)(n)))return Lf("Unsupported field value:",e,n),xg(n,e);if(n instanceof Yr)return function(t,i){if(!bg(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const u of t){let d=Xr(u,i.aa(s));null==d&&(d={nullValue:"NULL_VALUE"}),r.push(d),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if(null===(t=(0,re.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return cu(i.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=le.fromDate(t);return{timestampValue:go(i.yt,r)}}if(t instanceof le){const r=new le(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:go(i.yt,r)}}if(t instanceof Pl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof bn)return{bytesValue:Np(i.yt,t._byteString)};if(t instanceof me){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Hh(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${Dl(t)}`)}(n,e)}function xg(n,e){const t={};return Bc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Bn(n,(i,r)=>{const s=Xr(r,e.ra(i));null!=s&&(t[i]=s)}),{mapValue:{fields:t}}}function kg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof le||n instanceof Pl||n instanceof bn||n instanceof me||n instanceof Yr)}function Lf(n,e,t){if(!kg(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=Dl(t);throw e.ha("an object"===i?n+" a custom object":n+" "+i)}var i}function Ff(n,e,t){if((e=(0,re.m9)(e))instanceof Qn)return e._internalPath;if("string"==typeof e)return Ul(n,e);throw Vl("Field path arguments must be of type string or ",n,!1,void 0,t)}const R0=new RegExp("[~\\*/\\[\\]]");function Ul(n,e,t){if(e.search(R0)>=0)throw Vl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Qn(...e.split("."))._internalPath}catch(i){throw Vl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Vl(n,e,t,i,r){const s=i&&!i.isEmpty(),u=void 0!==r;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(s||u)&&(f+=" (found",s&&(f+=` in field ${i}`),u&&(f+=` in document ${r}`),f+=")"),new S(E.INVALID_ARGUMENT,d+n+f)}function Ag(n,e){return n.some(t=>t.isEqual(e))}class Mu{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new me(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new N0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(ql("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class N0 extends Mu{data(){return super.data()}}function ql(n,e){return"string"==typeof e?Ul(n,e):e instanceof Qn?e._internalPath:e._delegate._internalPath}function Sg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new S(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Uf{}class Pu extends Uf{}function Bi(n,e,...t){let i=[];e instanceof Uf&&i.push(e),i=i.concat(t),function(r){const s=r.filter(d=>d instanceof Ro).length,u=r.filter(d=>d instanceof Lu).length;if(s>1||s>0&&u>0)throw new S(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Lu extends Pu{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Lu(e,t,i)}_apply(e){const t=this._parse(e);return Ng(e._query,t),new Ye(e.firestore,e.converter,uo(e._query,t))}_parse(e){const t=Jr(e.firestore);return function(r,s,u,d,f,m,g){let _;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new S(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Rg(g,m);const w=[];for(const k of g)w.push(Dg(d,r,k));_={arrayValue:{values:w}}}else _=Dg(d,r,g)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Rg(g,m),_=Tg(u,"where",g,"in"===m||"not-in"===m);return Y.create(f,m,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ro extends Uf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ro(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return 1===t.length?t[0]:ue.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,r){let s=i;const u=r.getFlattenedFilters();for(const d of u)Ng(s,d),s=uo(s,d)}(e._query,t),new Ye(e.firestore,e.converter,uo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Vf extends Pu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Vf(e,t)}_apply(e){const t=function(i,r,s){if(null!==i.startAt)throw new S(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new S(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new Gn(r,s);return function(d,f){if(null===qr(d)){const m=oo(d);null!==m&&Og(0,m,f.field)}}(i,u),u}(e._query,this._field,this._direction);return new Ye(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new ut(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Bl extends Pu{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Bl(e,t,i)}_apply(e){return new Ye(e.firestore,e.converter,co(e._query,this._limit,this._limitType))}}class Zl extends Pu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Zl(e,t,i)}_apply(e){const t=Cg(e,this.type,this._docOrFields,this._inclusive);return new Ye(e.firestore,e.converter,(r=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)));var i,r}}class Gl extends Pu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Gl(e,t,i)}_apply(e){const t=Cg(e,this.type,this._docOrFields,this._inclusive);return new Ye(e.firestore,e.converter,(r=t,new ut((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)));var i,r}}function Cg(n,e,t,i){if(t[0]=(0,re.m9)(t[0]),t[0]instanceof Mu)return function(r,s,u,d,f){if(!d)throw new S(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of $n(r))if(g.field.isKeyField())m.push(Zn(s,d.key));else{const _=d.data.field(g.field);if(eu(_))throw new S(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const w=g.field.canonicalString();throw new S(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}m.push(_)}return new gn(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=Jr(n.firestore);return function(s,u,d,f,m,g){const _=s.explicitOrderBy;if(m.length>_.length)throw new S(E.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let k=0;k<m.length;k++){const C=m[k];if(_[k].field.isKeyField()){if("string"!=typeof C)throw new S(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof C}`);if(!ao(s)&&-1!==C.indexOf("/"))throw new S(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${C}' contains a slash.`);const M=s.path.child(X.fromString(C));if(!O.isDocumentKey(M))throw new S(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const V=new O(M);w.push(Zn(u,V))}else{const M=Tg(d,f,C);w.push(M)}}return new gn(w,g)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Dg(n,e,t){if("string"==typeof(t=(0,re.m9)(t))){if(""===t)throw new S(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ao(e)&&-1!==t.indexOf("/"))throw new S(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(X.fromString(t));if(!O.isDocumentKey(i))throw new S(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Zn(n,new O(i))}if(t instanceof me)return Zn(n,t._key);throw new S(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Dl(t)}.`)}function Rg(n,e){if(!Array.isArray(n)||0===n.length)throw new S(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new S(E.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ng(n,e){if(e.isInequality()){const i=oo(n),r=e.field;if(null!==i&&!i.isEqual(r))throw new S(E.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${r.toString()}'`);const s=qr(n);null!==s&&Og(0,r,s)}const t=function(i,r){for(const s of i)for(const u of s.getFlattenedFilters())if(r.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new S(E.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Og(n,e,t){if(!t.isEqual(e))throw new S(E.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class qf{convertValue(e,t="none"){switch(en(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Jt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U()}}convertObject(e,t){const i={};return Bn(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new Pl(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Ys(e);return null==i?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Fr(e));default:return null}}convertTimestamp(e){const t=mn(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=X.fromString(e);Z(Zp(i));const r=new pn(i.get(1),i.get(3)),s=new O(i.popFirst(5));return r.isEqual(t)||ke(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function zl(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class B0 extends qf{constructor(e){super(),this.firestore=e}convertBytes(e){return new bn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}}class es{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Yn extends Mu{constructor(e,t,i,r,s,u){super(e,t,i,r,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Fu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(ql("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Fu extends Yn{data(e={}){return super.data(e)}}class Zi{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new es(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Fu(this._firestore,this._userDataWriter,i.key,i,new es(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new S(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Fu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new es(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:s++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>r||3!==u.type).map(u=>{const d=new Fu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new es(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,m=-1;return 0!==u.type&&(f=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),m=s.indexOf(u.doc.key)),{type:Z0(u.type),doc:d,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function Z0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Pg(n,e){return n instanceof Yn&&e instanceof Yn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Zi&&e instanceof Zi&&n._firestore===e._firestore&&Ef(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Gi extends qf{constructor(e){super(),this.firestore=e}convertBytes(e){return new bn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}}function Lg(n,e,t){n=ie(n,me);const i=ie(n.firestore,ge),r=zl(n.converter,e,t);return No(i,[Fl(Jr(i),"setDoc",n._key,r,null!==n.converter,t).toMutation(n._key,A.none())])}function Fg(n,e,t,...i){n=ie(n,me);const r=ie(n.firestore,ge),s=Jr(r);let u;return u="string"==typeof(e=(0,re.m9)(e))||e instanceof Qn?Pf(s,"updateDoc",n._key,e,t,i):Mf(s,"updateDoc",n._key,e),No(r,[u.toMutation(n._key,A.exists(!0))])}function Ug(n,...e){var t,i,r;n=(0,re.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Nf(e[u])||(s=e[u],u++);const d={includeMetadataChanges:s.includeMetadataChanges};if(Nf(e[u])){const _=e[u];e[u]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[u+1]=null===(i=_.error)||void 0===i?void 0:i.bind(_),e[u+2]=null===(r=_.complete)||void 0===r?void 0:r.bind(_)}let f,m,g;if(n instanceof me)m=ie(n.firestore,ge),g=Ni(n._key.path),f={next:_=>{e[u]&&e[u](Bf(m,n,_))},error:e[u+1],complete:e[u+2]};else{const _=ie(n,Ye);m=ie(_.firestore,ge),g=_._query;const w=new Gi(m);f={next:k=>{e[u]&&e[u](new Zi(m,w,_,k))},error:e[u+1],complete:e[u+2]},Sg(n._query)}return function(_,w,k,C){const M=new Nl(C),V=new Kd(w,M,k);return _.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return Gd(yield Do(_),V)})),()=>{M.bc(),_.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return $d(yield Do(_),V)}))}}(Pe(m),g,d,f)}function No(n,e){return function(t,i){const r=new Ae;return t.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return function Lv(n,e,t){return Xd.apply(this,arguments)}(yield Df(t),i,r)})),r.promise}(Pe(n),e)}function Bf(n,e,t){const i=t.docs.get(e._key),r=new Gi(n);return new Yn(n,r,e._key,i,new es(t.hasPendingWrites,t.fromCache),e.converter)}const J0={maxAttempts:5};class Vg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Jr(e)}set(e,t,i){this._verifyNotCommitted();const r=zi(e,this._firestore),s=zl(r.converter,t,i),u=Fl(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,i);return this._mutations.push(u.toMutation(r._key,A.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=zi(e,this._firestore);let u;return u="string"==typeof(t=(0,re.m9)(t))||t instanceof Qn?Pf(this._dataReader,"WriteBatch.update",s._key,t,i,r):Mf(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,A.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zi(e,this._firestore);return this._mutations=this._mutations.concat(new Wn(t._key,A.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new S(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zi(n,e){if((n=(0,re.m9)(n)).firestore!==e)throw new S(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class X0 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Jr(e)}get(e){const t=zi(e,this._firestore),i=new B0(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||1!==r.length)return U();const s=r[0];if(s.isFoundDocument())return new Mu(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new Mu(this._firestore,i,t._key,null,t.converter);throw U()})}set(e,t,i){const r=zi(e,this._firestore),s=zl(r.converter,t,i),u=Fl(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,i);return this._transaction.set(r._key,u),this}update(e,t,i,...r){const s=zi(e,this._firestore);let u;return u="string"==typeof(t=(0,re.m9)(t))||t instanceof Qn?Pf(this._dataReader,"Transaction.update",s._key,t,i,r):Mf(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=zi(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zi(e,this._firestore),i=new Gi(this._firestore);return super.get(e).then(r=>new Yn(this._firestore,i,t._key,r._document,new es(!1,!1),t.converter))}}function Zf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new S("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Bg(){if("undefined"==typeof Uint8Array)throw new S("unimplemented","Uint8Arrays are not available in this environment.")}function Zg(){if(!function Gc(){return"undefined"!=typeof atob}())throw new S("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Ct=an.SDK_VERSION,(0,an._registerComponent)(new Qi.wA("firestore",(t,{instanceIdentifier:i,options:r})=>{const s=t.getProvider("app").getImmediate(),u=new ge(new Oh(t.getProvider("auth-internal")),new Ga(t.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new S(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pn(d.options.projectId,f)}(s,i),s);return r=Object.assign({useFetchStreams:e},r),u._setSettings(r),u},"PUBLIC").setMultipleInstances(!0)),(0,an.registerVersion)(Uc,"3.8.0",n),(0,an.registerVersion)(Uc,"3.8.0","esm2017")}();class Uu{constructor(e){this._delegate=e}static fromBase64String(e){return Zg(),new Uu(bn.fromBase64String(e))}static fromUint8Array(e){return Bg(),new Uu(bn.fromUint8Array(e))}toBase64(){return Zg(),this._delegate.toBase64()}toUint8Array(){return Bg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Gf(n){return function uI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const i of e)if(i in t&&"function"==typeof t[i])return!0;return!1}(n,["next","error","complete"])}class cI{enableIndexedDbPersistence(e,t){return function y0(n,e){Ig(n=ie(n,ge));const t=Pe(n),i=n._freezeSettings(),r=new wf;return vg(t,r,new tg(r,i.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function _0(n){Ig(n=ie(n,ge));const e=Pe(n),t=n._freezeSettings(),i=new wf;return vg(e,i,new Jv(i,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function v0(n){if(n._initialized&&!n._terminated)throw new S(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ae;return n._queue.enqueueAndForgetEvenWhileRestricted((0,T.Z)(function*(){try{yield(t=(0,T.Z)(function*(i){if(!It.C())return Promise.resolve();const r=i+"main";yield It.delete(r)}),function(i){return t.apply(this,arguments)})(fd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Gg{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof pn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Yt("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,i={}){!function ug(n,e,t,i={}){var r;const s=(n=ie(n,Nu))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Yt("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let u,d;if("string"==typeof i.mockUserToken)u=i.mockUserToken,d=Ce.MOCK_USER;else{u=(0,re.Sg)(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new S(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ce(f)}n._authCredentials=new Dr(new $s(u,d))}}(this._delegate,e,t,i)}enableNetwork(){return function w0(n){return function a0(n){return n.asyncQueue.enqueue((0,T.Z)(function*(){const e=yield pg(n),t=yield Cf(n);return e.setNetworkEnabled(!0),function(i){const r=P(i);return r._u.delete(0),Du(r)}(t)}))}(Pe(n=ie(n,ge)))}(this._delegate)}disableNetwork(){return function b0(n){return function u0(n){return n.asyncQueue.enqueue((0,T.Z)(function*(){const e=yield pg(n),t=yield Cf(n);return e.setNetworkEnabled(!1),(i=(0,T.Z)(function*(r){const s=P(r);s._u.add(0),yield Eo(s),s.gu.set("Offline")}),function(r){return i.apply(this,arguments)})(t);var i}))}(Pe(n=ie(n,ge)))}(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,ng("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function I0(n){return function(e){const t=new Ae;return e.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return function qv(n,e){return sf.apply(this,arguments)}(yield Df(e),t)})),t.promise}(Pe(n=ie(n,ge)))}(this._delegate)}onSnapshotsInSync(e){return function Y0(n,e){return function h0(n,e){const t=new Nl(e);return n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return i=yield Do(n),r=t,P(i).Ru.add(r),void r.next();var i,r})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return i=yield Do(n),r=t,void P(i).Ru.delete(r);var i,r}))}}(Pe(n=ie(n,ge)),Nf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new S("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Oo(this,cg(this._delegate,e))}catch(t){throw lt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Pt(this,Rl(this._delegate,e))}catch(t){throw lt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ht(this,function Xv(n,e){if(n=ie(n,Nu),bf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new S(E.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Ye(n,null,(t=e,new ut(X.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw lt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function eI(n,e,t){n=ie(n,ge);const i=Object.assign(Object.assign({},J0),t);return function(r){if(r.maxAttempts<1)throw new S(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(r,s,u){const d=new Ae;return r.asyncQueue.enqueueAndForget((0,T.Z)(function*(){const f=yield function mg(n){return Ol(n).then(e=>e.datastore)}(r);new s0(r.asyncQueue,f,u,s,d).run()})),d.promise}(Pe(n),r=>e(new X0(n,r)),i)}(this._delegate,t=>e(new zg(this,t)))}batch(){return Pe(this._delegate),new $g(new Vg(this._delegate,e=>No(this._delegate,e)))}loadBundle(e){return function E0(n,e){const t=Pe(n=ie(n,ge)),i=new m0;return function d0(n,e,t,i){const r=function(s,u){let d;return d="string"==typeof s?(new TextEncoder).encode(s):s,f=function(f,m){if(f instanceof Uint8Array)return hg(f,m);if(f instanceof ArrayBuffer)return hg(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new e0(f,u);var f}(t,Cu(e));n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){!function Yv(n,e,t){const i=P(n);var r;(r=(0,T.Z)(function*(s,u,d){try{const f=yield u.getMetadata();if(yield function(w,k){const C=P(w),M=Me(k.createTime);return C.persistence.runTransaction("hasNewerBundle","readonly",V=>C.Ns.getBundleMetadata(V,k.id)).then(V=>!!V&&V.createTime.compareTo(M)>=0)}(s.localStore,f))return yield u.close(),d._completeWith({taskState:"Success",documentsLoaded:(w=f).totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}),Promise.resolve(new Set);d._updateProgress($m(f));const m=new Dv(f,s.localStore,u.yt);let g=yield u.mc();for(;g;){const w=yield m.Fu(g);w&&d._updateProgress(w),g=yield u.mc()}const _=yield m.complete();return yield Hn(s,_.Lu,void 0),yield function(w,k){const C=P(w);return C.persistence.runTransaction("Save bundle","readwrite",M=>C.Ns.saveBundleMetadata(M,k))}(s.localStore,f),d._completeWith(_.progress),Promise.resolve(_.Bu)}catch(f){return Yt("SyncEngine",`Loading bundle failed with ${f}`),d._failWith(f),Promise.resolve(new Set)}var w}),function(s,u,d){return r.apply(this,arguments)})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}(yield Df(n),r,i)}))}(t,n._databaseId,e,i),i}(this._delegate,e)}namedQuery(e){return function T0(n,e){return function f0(n,e){return n.asyncQueue.enqueue((0,T.Z)(function*(){return function(t,i){const r=P(t);return r.persistence.runTransaction("Get named query","readonly",s=>r.Ns.getNamedQuery(s,i))}(yield Ml(n),e)}))}(Pe(n=ie(n,ge)),e).then(t=>t?new Ye(n,null,t.query):null)}(this._delegate,e).then(t=>t?new ht(this,t):null)}}class $l extends qf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Uu(new bn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Pt.forKey(t,this.firestore,null)}}class zg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new $l(e)}get(e){const t=ns(e);return this._delegate.get(t).then(i=>new Vu(this._firestore,new Yn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const r=ns(e);return i?(Zf("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=ns(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=ns(e);return this._delegate.delete(t),this}}class $g{constructor(e){this._delegate=e}set(e,t,i){const r=ns(e);return i?(Zf("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=ns(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=ns(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ts{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new Fu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qu(this._firestore,i),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=ts.INSTANCES;let r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new ts(e,new $l(e),t),r.set(t,s)),s}}ts.INSTANCES=new WeakMap;class Pt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new $l(e)}static forPath(e,t,i){if(e.length%2!=0)throw new S("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Pt(t,new me(t._delegate,i,new O(e)))}static forKey(e,t,i){return new Pt(t,new me(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Oo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Oo(this.firestore,cg(this._delegate,e))}catch(t){throw lt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,re.m9)(e))instanceof me&&lg(this._delegate,e)}set(e,t){t=Zf("DocumentReference.set",t);try{return t?Lg(this._delegate,e,t):Lg(this._delegate,e)}catch(i){throw lt(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return 1===arguments.length?Fg(this._delegate,e):Fg(this._delegate,e,t,...i)}catch(r){throw lt(r,"updateDoc()","DocumentReference.update()")}}delete(){return function H0(n){return No(ie(n.firestore,ge),[new Wn(n._key,A.none())])}(this._delegate)}onSnapshot(...e){const t=jg(e),i=Wg(e,r=>new Vu(this.firestore,new Yn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Ug(this._delegate,t,i)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function z0(n){n=ie(n,me);const e=ie(n.firestore,ge),t=Pe(e),i=new Gi(e);return function c0(n,e){const t=new Ae;return n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return(i=(0,T.Z)(function*(r,s,u){try{const d=yield function(f,m){const g=P(f);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,m))}(r,s);d.isFoundDocument()?u.resolve(d):d.isNoDocument()?u.resolve(null):u.reject(new S(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const f=ko(d,`Failed to get document '${s} from cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield Ml(n),e,t);var i})),t.promise}(t,n._key).then(r=>new Yn(e,i,n._key,r,new es(null!==r&&r.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function $0(n){n=ie(n,me);const e=ie(n.firestore,ge);return gg(Pe(e),n._key,{source:"server"}).then(t=>Bf(e,n,t))}(this._delegate):function G0(n){n=ie(n,me);const e=ie(n.firestore,ge);return gg(Pe(e),n._key).then(t=>Bf(e,n,t))}(this._delegate),t.then(i=>new Vu(this.firestore,new Yn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new Pt(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}function lt(n,e,t){return n.message=n.message.replace(e,t),n}function jg(n){for(const e of n)if("object"==typeof e&&!Gf(e))return e;return{}}function Wg(n,e){var t,i;let r;return r=Gf(n[0])?n[0]:Gf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:null===(t=r.error)||void 0===t?void 0:t.bind(r),complete:null===(i=r.complete)||void 0===i?void 0:i.bind(r)}}class Vu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Pt(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Pg(this._delegate,e._delegate)}}class qu extends Vu{data(e){const t=this._delegate.data(e);return function Ba(n,e){n||U()}(void 0!==t),t}}class ht{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new $l(e)}where(e,t,i){try{return new ht(this.firestore,Bi(this._delegate,function O0(n,e,t){const i=e,r=ql("where",n);return Lu._create(r,i,t)}(e,t,i)))}catch(r){throw lt(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ht(this.firestore,Bi(this._delegate,function M0(n,e="asc"){const t=e,i=ql("orderBy",n);return Vf._create(i,t)}(e,t)))}catch(i){throw lt(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ht(this.firestore,Bi(this._delegate,function P0(n){return sg("limit",n),Bl._create("limit",n,"F")}(e)))}catch(t){throw lt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ht(this.firestore,Bi(this._delegate,function L0(n){return sg("limitToLast",n),Bl._create("limitToLast",n,"L")}(e)))}catch(t){throw lt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ht(this.firestore,Bi(this._delegate,function F0(...n){return Zl._create("startAt",n,!0)}(...e)))}catch(t){throw lt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ht(this.firestore,Bi(this._delegate,function U0(...n){return Zl._create("startAfter",n,!1)}(...e)))}catch(t){throw lt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ht(this.firestore,Bi(this._delegate,function V0(...n){return Gl._create("endBefore",n,!1)}(...e)))}catch(t){throw lt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ht(this.firestore,Bi(this._delegate,function q0(...n){return Gl._create("endAt",n,!0)}(...e)))}catch(t){throw lt(t,"endAt()","Query.endAt()")}}isEqual(e){return Ef(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function W0(n){n=ie(n,Ye);const e=ie(n.firestore,ge),t=Pe(e),i=new Gi(e);return function l0(n,e){const t=new Ae;return n.asyncQueue.enqueueAndForget((0,T.Z)(function*(){return(i=(0,T.Z)(function*(r,s,u){try{const d=yield Tl(r,s,!0),f=new Km(s,d.Hi),m=f.Wu(d.documents),g=f.applyChanges(m,!1);u.resolve(g.snapshot)}catch(d){const f=ko(d,`Failed to execute query '${s} against cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield Ml(n),e,t);var i})),t.promise}(t,n._query).then(r=>new Zi(e,i,n,r))}(this._delegate):"server"===(null==e?void 0:e.source)?function K0(n){n=ie(n,Ye);const e=ie(n.firestore,ge),t=Pe(e),i=new Gi(e);return yg(t,n._query,{source:"server"}).then(r=>new Zi(e,i,n,r))}(this._delegate):function j0(n){n=ie(n,Ye);const e=ie(n.firestore,ge),t=Pe(e),i=new Gi(e);return Sg(n._query),yg(t,n._query).then(r=>new Zi(e,i,n,r))}(this._delegate),t.then(i=>new zf(this.firestore,new Zi(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=jg(e),i=Wg(e,r=>new zf(this.firestore,new Zi(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Ug(this._delegate,t,i)}withConverter(e){return new ht(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}class hI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class zf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ht(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new hI(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new qu(this._firestore,i))})}isEqual(e){return Pg(this._delegate,e._delegate)}}class Oo extends ht{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Pt(this.firestore,e):null}doc(e){try{return new Pt(this.firestore,void 0===e?Rl(this._delegate):Rl(this._delegate,e))}catch(t){throw lt(t,"doc()","CollectionReference.doc()")}}add(e){return function Q0(n,e){const t=ie(n.firestore,ge),i=Rl(n),r=zl(n.converter,e);return No(t,[Fl(Jr(n.firestore),"addDoc",i._key,r,null!==n.converter,{}).toMutation(i._key,A.exists(!1))]).then(()=>i)}(this._delegate,e).then(t=>new Pt(this.firestore,t))}isEqual(e){return lg(this._delegate,e._delegate)}withConverter(e){return new Oo(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}function ns(n){return ie(n,me)}class $f{constructor(...e){this._delegate=new Qn(...e)}static documentId(){return new $f(Ie.keyField().canonicalString())}isEqual(e){return(e=(0,re.m9)(e))instanceof Qn&&this._delegate._internalPath.isEqual(e._internalPath)}}class is{constructor(e){this._delegate=e}static serverTimestamp(){const e=function nI(){return new Of("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new is(e)}static delete(){const e=function tI(){return new Ou("deleteField")}();return e._methodName="FieldValue.delete",new is(e)}static arrayUnion(...e){const t=function iI(...n){return new S0("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new is(t)}static arrayRemove(...e){const t=function rI(...n){return new C0("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new is(t)}static increment(e){const t=function sI(n){return new D0("increment",n)}(e);return t._methodName="FieldValue.increment",new is(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const dI={Firestore:Gg,GeoPoint:Pl,Timestamp:le,Blob:Uu,Transaction:zg,WriteBatch:$g,DocumentReference:Pt,DocumentSnapshot:Vu,Query:ht,QueryDocumentSnapshot:qu,QuerySnapshot:zf,CollectionReference:Oo,FieldPath:$f,FieldValue:is,setLogLevel:function lI(n){!function Rh(n){nt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function pI(n){(function fI(n,e){n.INTERNAL.registerComponent(new Qi.wA("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},dI)))})(n,(e,t)=>new Gg(e,t,new cI)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(oi.Z);var Kg=F(6451),jl=F(5363),$i=F(3900),Hg=F(3151),mI=F(590),gI=F(576);function Qg(n,e){return(0,gI.m)(e)?(0,$i.w)(()=>n,e):(0,$i.w)(()=>n)}var jf=F(9468);F(259);const Kf=new Map,Jg={activated:!1,tokenObservers:[]},wI={initialized:!1,enabled:!1};function Je(n){return Kf.get(n)||Object.assign({},Jg)}function Kl(){return wI}class AI{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,T.Z)(function*(){t.stop();try{t.pending=new re.BH,yield function SI(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new re.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(i){t.retryPolicy(i)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const dt=new re.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function ey(n){if(!Je(n).activated)throw dt.create("use-before-activation",{appName:n.name})}function Yf(n,e){return Jf.apply(this,arguments)}function Jf(){return Jf=(0,T.Z)(function*({url:n,body:e},t){const i={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});if(r){const _=yield r.getHeartbeatsHeader();_&&(i["X-Firebase-Client"]=_)}const s={method:"POST",body:JSON.stringify(e),headers:i};let u,d;try{u=yield fetch(n,s)}catch(_){throw dt.create("fetch-network-error",{originalErrorMessage:null==_?void 0:_.message})}if(200!==u.status)throw dt.create("fetch-status-error",{httpStatus:u.status});try{d=yield u.json()}catch(_){throw dt.create("fetch-parse-error",{originalErrorMessage:null==_?void 0:_.message})}const f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw dt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});const m=1e3*Number(f[1]),g=Date.now();return{token:d.token,expireTimeMillis:g+m,issuedAtTimeMillis:g}}),Jf.apply(this,arguments)}function NI(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${i}:exchangeDebugToken?key=${r}`,body:{debug_token:e}}}const Bu="firebase-app-check-store";let Yl=null;function ny(){return Yl||(Yl=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(dt.create("storage-open",{originalErrorMessage:null===(r=i.target.error)||void 0===r?void 0:r.message}))},t.onupgradeneeded=i=>{0===i.oldVersion&&i.target.result.createObjectStore(Bu,{keyPath:"compositeKey"})}}catch(t){e(dt.create("storage-open",{originalErrorMessage:null==t?void 0:t.message}))}}),Yl)}function Xf(){return Xf=(0,T.Z)(function*(n,e){const i=(yield ny()).transaction(Bu,"readwrite"),s=i.objectStore(Bu).put({compositeKey:n,value:e});return new Promise((u,d)=>{s.onsuccess=f=>{u()},i.onerror=f=>{var m;d(dt.create("storage-set",{originalErrorMessage:null===(m=f.target.error)||void 0===m?void 0:m.message}))}})}),Xf.apply(this,arguments)}const Zu=new Tt.Yd("@firebase/app-check");function np(n,e){return(0,re.hl)()?function LI(n,e){return function iy(n,e){return Xf.apply(this,arguments)}(function sy(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Zu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function oy(){return Kl().enabled}function ay(){return rp.apply(this,arguments)}function rp(){return rp=(0,T.Z)(function*(){const n=Kl();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),rp.apply(this,arguments)}const ZI={error:"UNKNOWN_ERROR"};function GI(n){return re.US.encodeString(JSON.stringify(n),!1)}function Jl(n){return sp.apply(this,arguments)}function sp(){return sp=(0,T.Z)(function*(n,e=!1){const t=n.app;ey(t);const i=Je(t);let s,r=i.token;if(r&&!Mo(r)&&(i.token=void 0,r=void 0),!r){const f=yield i.cachedTokenPromise;f&&(Mo(f)?r=f:yield np(t,void 0))}if(!e&&r&&Mo(r))return{token:r.token};let d,u=!1;if(oy()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Yf(NI(t,yield ay()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);const f=yield i.exchangeTokenPromise;return yield np(t,f),i.token=f,{token:f.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),r=yield Je(t).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?Zu.warn(f.message):Zu.error(f),s=f}return r?s?d=Mo(r)?{token:r.token,internalError:s}:ly(s):(d={token:r.token},i.token=r,yield np(t,r)):d=ly(s),u&&cy(t,d),d}),sp.apply(this,arguments)}function ap(n,e){const t=Je(n),i=t.tokenObservers.filter(r=>r.next!==e);0===i.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function uy(n){const{app:e}=n,t=Je(e);let i=t.tokenRefresher;i||(i=function zI(n){const{app:e}=n;return new AI((0,T.Z)(function*(){let i;if(i=Je(e).token?yield Jl(n,!0):yield Jl(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{const t=Je(e);if(t.token){let i=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return i=Math.min(i,t.token.expireTimeMillis-3e5),Math.max(0,i-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function cy(n,e){const t=Je(n).tokenObservers;for(const i of t)try{"EXTERNAL"===i.type&&null!=e.error?i.error(e.error):i.next(e)}catch(r){}}function Mo(n){return n.expireTimeMillis-Date.now()>0}function ly(n){return{token:GI(ZI),error:n}}class $I{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Je(this.app);for(const t of e)ap(this.app,t.next);return Promise.resolve()}}const _y="app-check-internal";!function sw(){(0,an._registerComponent)(new Qi.wA("app-check",n=>function jI(n,e){return new $I(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(_y).initialize()})),(0,an._registerComponent)(new Qi.wA(_y,n=>function WI(n){return{getToken:e=>Jl(n,e),addTokenListener:e=>function op(n,e,t,i){const{app:r}=n,s=Je(r);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:i,type:e}],s.token&&Mo(s.token)){const d=s.token;Promise.resolve().then(()=>{t({token:d.token}),uy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>uy(n))}(n,"INTERNAL",e),removeTokenListener:e=>ap(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,an.registerVersion)("@firebase/app-check","0.6.0")}();class hp{constructor(){return(0,Ge.vb)("app-check")}}"undefined"!=typeof window&&window,F(9260);const Iy=new h.OlP("angularfire2.auth.use-emulator"),wy=new h.OlP("angularfire2.auth.settings"),by=new h.OlP("angularfire2.auth.tenant-id"),Ey=new h.OlP("angularfire2.auth.langugage-code"),Ty=new h.OlP("angularfire2.auth.use-device-language"),xy=new h.OlP("angularfire.auth.persistence"),ky=(n,e,t,i,r,s,u,d)=>(0,Ke.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const f=e.runOutsideAngular(()=>n.auth());if(t&&f.useEmulator(...t),i&&(f.tenantId=i),f.languageCode=r,s&&f.useDeviceLanguage(),u)for(const[m,g]of Object.entries(u))f.settings[m]=g;return d&&f.setPersistence(d),f},[t,i,r,s,u,d]);let Ay=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,_,w,k){const C=new Xe.x,M=(0,Ft.of)(void 0).pipe((0,jl.Q)(u.outsideAngular),(0,$i.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(F.bind(F,9169)))),(0,ye.U)(()=>(0,Ke.on)(t,s,i)),(0,ye.U)(V=>ky(V,s,d,m,g,_,f,w)),(0,Hg.d)({bufferSize:1,refCount:!1}));if((0,fe.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,Ft.of)(null);else{M.pipe((0,mI.P)()).subscribe();const ae=M.pipe((0,$i.w)(Q=>Q.getRedirectResult().then(K=>K,()=>null)),Ge.iC,(0,Hg.d)({bufferSize:1,refCount:!1})),he=M.pipe((0,$i.w)(Q=>new $o.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onAuthStateChanged(J=>K.next(J),J=>K.error(J),()=>K.complete()))})))),te=M.pipe((0,$i.w)(Q=>new $o.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onIdTokenChanged(J=>K.next(J),J=>K.error(J),()=>K.complete()))}))));this.authState=ae.pipe(Qg(he),(0,jf.R)(u.outsideAngular),(0,jl.Q)(u.insideAngular)),this.user=ae.pipe(Qg(te),(0,jf.R)(u.outsideAngular),(0,jl.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,$i.w)(Q=>Q?(0,Sn.D)(Q.getIdToken()):(0,Ft.of)(null))),this.idTokenResult=this.user.pipe((0,$i.w)(Q=>Q?(0,Sn.D)(Q.getIdTokenResult()):(0,Ft.of)(null))),this.credential=(0,Kg.T)(ae,C,this.authState.pipe((0,D.h)(Q=>!Q))).pipe((0,ye.U)(Q=>(null==Q?void 0:Q.user)?Q:null),(0,jf.R)(u.outsideAngular),(0,jl.Q)(u.insideAngular))}return(0,Ke.pX)(this,M,s,{spy:{apply:(V,ae,he)=>{(V.startsWith("signIn")||V.startsWith("createUser"))&&he.then(te=>C.next(te))}}})}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(Ke.Dh),h.LFG(Ke.xv,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG(Ge.HU),h.LFG(Iy,8),h.LFG(wy,8),h.LFG(by,8),h.LFG(Ey,8),h.LFG(Ty,8),h.LFG(xy,8),h.LFG(hp,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function Sy(n,e){return function hw(n,e=zo.z){return new $o.y(t=>{let i;return null!=e?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=i&&i()}})}(n,e)}function fp(n,e){return Sy(n,e).pipe((0,ye.U)(t=>({payload:t,type:"query"})))}function eh(n,e){return fp(n,e).pipe((0,Ze.O)(void 0),Cn(),(0,ye.U)(([t,i])=>{const r=i.payload.docChanges(),s=r.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,d)=>{const f=r.find(g=>g.doc.ref.isEqual(u.ref)),m=null==t?void 0:t.payload.docs.find(g=>g.ref.isEqual(u.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(u.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:u}})}),s}))}function Cy(n,e,t){return eh(n,t).pipe((0,Zt.R)((i,r)=>function fw(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=function pw(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return pp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return pp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return pp(n,e.oldIndex,1)}return n}(n,i))}),n}(i,r.map(s=>s.payload),e),[]),(0,lh.x)(),(0,ye.U)(i=>i.map(r=>({type:r.type,payload:r}))))}function pp(n,e,t,...i){const r=n.slice();return r.splice(e,t,...i),r}function Dy(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Ry{constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=eh(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,ye.U)(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe((0,Ze.O)(void 0),Cn(),(0,D.h)(([i,r])=>r.length>0||!i),(0,ye.U)(([i,r])=>r),Ge.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Zt.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=Dy(e);return Cy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ge.iC)}valueChanges(e={}){return fp(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(t=>t.payload.docs.map(i=>e.idField?Object.assign(Object.assign({},i.data()),{[e.idField]:i.id}):i.data())),Ge.iC)}get(e){return(0,Sn.D)(this.query.get(e)).pipe(Ge.iC)}add(e){return this.ref.add(e)}doc(e){return new Ny(this.ref.doc(e),this.afs)}}class Ny{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const i=this.ref.collection(e),{ref:r,query:s}=Oy(i,t);return new Ry(r,s,this.afs)}snapshotChanges(){return function dw(n,e){return Sy(n,e).pipe((0,Ze.O)(void 0),Cn(),(0,ye.U)(([t,i])=>i.exists?(null==t?void 0:t.exists)?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Ge.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,ye.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Sn.D)(this.ref.get(e)).pipe(Ge.iC)}}class mw{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?eh(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(t=>t.filter(i=>e.indexOf(i.type)>-1)),(0,D.h)(t=>t.length>0),Ge.iC):eh(this.query,this.afs.schedulers.outsideAngular).pipe(Ge.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Zt.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=Dy(e);return Cy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Ge.iC)}valueChanges(e={}){return fp(this.query,this.afs.schedulers.outsideAngular).pipe((0,ye.U)(i=>i.payload.docs.map(r=>e.idField?Object.assign({[e.idField]:r.id},r.data()):r.data())),Ge.iC)}get(e){return(0,Sn.D)(this.query.get(e)).pipe(Ge.iC)}}const gw=new h.OlP("angularfire2.enableFirestorePersistence"),yw=new h.OlP("angularfire2.firestore.persistenceSettings"),_w=new h.OlP("angularfire2.firestore.settings"),vw=new h.OlP("angularfire2.firestore.use-emulator");function Oy(n,e=(t=>t)){return{query:e(n),ref:n}}let My=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,_,w,k,C,M,V,ae,he){this.schedulers=f;const te=(0,Ke.on)(t,d,i),Q=g;_&&ky(te,d,w,C,M,V,k,ae),[this.firestore,this.persistenceEnabled$]=(0,Ke.cc)(`${te.name}.firestore`,"AngularFirestore",te.name,()=>{const K=d.runOutsideAngular(()=>te.firestore());if(s&&K.settings(s),Q&&K.useEmulator(...Q),r&&!(0,fe.PM)(u)){const J=()=>{try{return(0,Sn.D)(K.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(Be){return"undefined"!=typeof console&&console.warn(Be),(0,Ft.of)(!1)}};return[K,d.runOutsideAngular(J)]}return[K,(0,Ft.of)(!1)]},[s,Q,r])}collection(t,i){let r;r="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=Oy(r,i),d=this.schedulers.ngZone.run(()=>s);return new Ry(d,u,this)}collectionGroup(t,i){const r=i||(u=>u),s=this.firestore.collectionGroup(t);return new mw(r(s),this)}doc(t){let i;i="string"==typeof t?this.firestore.doc(t):t;const r=this.schedulers.ngZone.run(()=>i);return new Ny(r,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(Ke.Dh),h.LFG(Ke.xv,8),h.LFG(gw,8),h.LFG(_w,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG(Ge.HU),h.LFG(yw,8),h.LFG(vw,8),h.LFG(Ay,8),h.LFG(Iy,8),h.LFG(wy,8),h.LFG(by,8),h.LFG(Ey,8),h.LFG(Ty,8),h.LFG(xy,8),h.LFG(hp,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),Iw=(()=>{class n{constructor(t,i,r,s){this.fb=t,this.dialogRef=i,this.data=r,this.store=s}onSubmit(){this.dialogRef.close(),window.navigator.clipboard.writeText(this.formGroup.value.copy_link)}ngOnInit(){this.formGroup=this.fb.group({copy_link:[{value:null,disabled:!1},q.kI.required]});const t=$u(30);(0,Sn.D)(this.store.collection(t).add({actors:this.data.actors.map(i=>i.toDto()),rotations:this.data.rotations.map(i=>i.toDto()),current_rotation:this.data.current_rotation})).subscribe(()=>{this.formGroup.patchValue({copy_link:`${window.location.href}?store=${t}`})})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn),h.Y36(Te),h.Y36(My))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-export-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","copy_link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"button",4),h._uU(11),h.ALo(12,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,5,"export_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,7,"export_dialog.placeholder.copy_link")),h.xp6(3),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(12,9,"export_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,os.Nt,q.Fj,q.JJ,q.u,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),ww=(()=>{class n{constructor(t,i){this.fb=t,this.dialogRef=i}onSubmit(){const t=this.formGroup.value.link.split("?store=");t.length<2||this.dialogRef.close(t[t.length-1])}ngOnInit(){this.formGroup=this.fb.group({link:[null,q.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(sn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-import-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return i.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"button",4),h._uU(11),h.ALo(12,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,5,"import_dialog.title")),h.xp6(2),h.Q6J("formGroup",i.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,7,"import_dialog.placeholder.link")),h.xp6(3),h.Q6J("disabled",i.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(12,9,"import_dialog.submit")," "))},directives:[ri,on,q.JL,q.sg,q._Y,pt.KE,pt.hX,os.Nt,q.Fj,q.JJ,q.u,Vt.lW],pipes:[wt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();var ft=(()=>(function(n){n[n.MOVE_ACTOR=0]="MOVE_ACTOR",n[n.DRAW_LINE=1]="DRAW_LINE",n[n.ERASE_LINE=2]="ERASE_LINE"}(ft||(ft={})),ft))(),En=F(8962),Lt=F(3191),Py=F(9718),Jn=F(2722),bw=F(8372);const th=["*"],Ew=["content"];function Tw(n,e){if(1&n){const t=h.EpF();h.TgZ(0,"div",2),h.NdJ("click",function(){return h.CHM(t),h.oxw()._onBackdropClicked()}),h.qZA()}if(2&n){const t=h.oxw();h.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function xw(n,e){1&n&&(h.TgZ(0,"mat-drawer-content"),h.Hsn(1,2),h.qZA())}const kw=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],Aw=["mat-drawer","mat-drawer-content","*"];function Sw(n,e){if(1&n){const t=h.EpF();h.TgZ(0,"div",2),h.NdJ("click",function(){return h.CHM(t),h.oxw()._onBackdropClicked()}),h.qZA()}if(2&n){const t=h.oxw();h.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Cw(n,e){1&n&&(h.TgZ(0,"mat-sidenav-content"),h.Hsn(1,2),h.qZA())}const Dw=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Rw=["mat-sidenav","mat-sidenav-content","*"],Ly={transformDrawer:(0,ce.X$)("transform",[(0,ce.SB)("open, open-instant",(0,ce.oB)({transform:"none",visibility:"visible"})),(0,ce.SB)("void",(0,ce.oB)({"box-shadow":"none",visibility:"hidden"})),(0,ce.eR)("void => open-instant",(0,ce.jt)("0ms")),(0,ce.eR)("void <=> open, open-instant => void",(0,ce.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},Ow=new h.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function Mw(){return!1}}),mp=new h.OlP("MAT_DRAWER_CONTAINER");let nh=(()=>{class n extends En.PQ{constructor(t,i,r,s,u){super(r,s,u),this._changeDetectorRef=t,this._container=i}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.sBO),h.Y36((0,h.Gpc)(()=>Uy)),h.Y36(h.SBq),h.Y36(En.mF),h.Y36(h.R0b))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(t,i){2&t&&h.Udp("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[h._Bn([{provide:En.PQ,useExisting:n}]),h.qOj],ngContentSelectors:th,decls:1,vars:0,template:function(t,i){1&t&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),Fy=(()=>{class n{constructor(t,i,r,s,u,d,f,m){this._elementRef=t,this._focusTrapFactory=i,this._focusMonitor=r,this._platform=s,this._ngZone=u,this._interactivityChecker=d,this._doc=f,this._container=m,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new Xe.x,this._animationEnd=new Xe.x,this._animationState="void",this.openedChange=new h.vpe(!0),this._openedStream=this.openedChange.pipe((0,D.h)(g=>g),(0,ye.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,D.h)(g=>g.fromState!==g.toState&&0===g.toState.indexOf("open")),(0,Py.h)(void 0)),this._closedStream=this.openedChange.pipe((0,D.h)(g=>!g),(0,ye.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,D.h)(g=>g.fromState!==g.toState&&"void"===g.toState),(0,Py.h)(void 0)),this._destroyed=new Xe.x,this.onPositionChanged=new h.vpe,this._modeChanged=new Xe.x,this.openedChange.subscribe(g=>{g?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{(0,us.R)(this._elementRef.nativeElement,"keydown").pipe((0,D.h)(g=>g.keyCode===rn.hY&&!this.disableClose&&!(0,rn.Vb)(g)),(0,Jn.R)(this._destroyed)).subscribe(g=>this._ngZone.run(()=>{this.close(),g.stopPropagation(),g.preventDefault()}))}),this._animationEnd.pipe((0,lh.x)((g,_)=>g.fromState===_.fromState&&g.toState===_.toState)).subscribe(g=>{const{fromState:_,toState:w}=g;(0===w.indexOf("open")&&"void"===_||"void"===w&&0===_.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t="end"===t?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(t),this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=(0,Lt.Ig)(t)}get autoFocus(){const t=this._autoFocus;return null==t?"side"===this.mode?"dialog":"first-tabbable":t}set autoFocus(t){("true"===t||"false"===t||null==t)&&(t=(0,Lt.Ig)(t)),this._autoFocus=t}get opened(){return this._opened}set opened(t){this.toggle((0,Lt.Ig)(t))}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{t.removeEventListener("blur",r),t.removeEventListener("mousedown",r),t.removeAttribute("tabindex")};t.addEventListener("blur",r),t.addEventListener("mousedown",r)})),t.focus(i)}_focusByCssSelector(t,i){let r=this._elementRef.nativeElement.querySelector(t);r&&this._forceFocus(r,i)}_takeFocus(){if(!this._focusTrap)return;const t=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{!i&&"function"==typeof this._elementRef.nativeElement.focus&&t.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(t){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,t):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const t=this._doc.activeElement;return!!t&&this._elementRef.nativeElement.contains(t)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var t;this._focusTrap&&this._focusTrap.destroy(),null===(t=this._anchor)||void 0===t||t.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(t=!this.opened,i){t&&i&&(this._openedVia=i);const r=this._setOpen(t,!t&&this._isFocusWithinDrawer(),this._openedVia||"program");return t||(this._openedVia=null),r}_setOpen(t,i,r){return this._opened=t,t?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",i&&this._restoreFocus(r)),this._updateFocusTrapState(),new Promise(s=>{this.openedChange.pipe((0,et.q)(1)).subscribe(u=>s(u?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(t){const i=this._elementRef.nativeElement,r=i.parentNode;"end"===t?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),r.insertBefore(this._anchor,i)),r.appendChild(i)):this._anchor&&this._anchor.parentNode.insertBefore(i,this._anchor)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.SBq),h.Y36(kn.qV),h.Y36(kn.tE),h.Y36(ji.t4),h.Y36(h.R0b),h.Y36(kn.ic),h.Y36(fe.K0,8),h.Y36(mp,8))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer"]],viewQuery:function(t,i){if(1&t&&h.Gf(Ew,5),2&t){let r;h.iGM(r=h.CRH())&&(i._content=r.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(t,i){1&t&&h.WFA("@transform.start",function(s){return i._animationStarted.next(s)})("@transform.done",function(s){return i._animationEnd.next(s)}),2&t&&(h.uIk("align",null),h.d8E("@transform",i._animationState),h.ekj("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:th,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,i){1&t&&(h.F$t(),h.TgZ(0,"div",0,1),h.Hsn(2),h.qZA())},directives:[En.PQ],encapsulation:2,data:{animation:[Ly.transformDrawer]},changeDetection:0}),n})(),Uy=(()=>{class n{constructor(t,i,r,s,u,d=!1,f){this._dir=t,this._element=i,this._ngZone=r,this._changeDetectorRef=s,this._animationMode=f,this._drawers=new h.n_E,this.backdropClick=new h.vpe,this._destroyed=new Xe.x,this._doCheckSubject=new Xe.x,this._contentMargins={left:null,right:null},this._contentMarginChanges=new Xe.x,t&&t.change.pipe((0,Jn.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),u.change().pipe((0,Jn.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=d}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=(0,Lt.Ig)(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:(0,Lt.Ig)(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,Ze.O)(this._allDrawers),(0,Jn.R)(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(i=>!i._container||i._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,Ze.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,bw.b)(10),(0,Jn.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,i=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._getWidth();else if("push"==this._left.mode){const r=this._left._getWidth();t+=r,i-=r}if(this._right&&this._right.opened)if("side"==this._right.mode)i+=this._right._getWidth();else if("push"==this._right.mode){const r=this._right._getWidth();i+=r,t-=r}t=t||null,i=i||null,(t!==this._contentMargins.left||i!==this._contentMargins.right)&&(this._contentMargins={left:t,right:i},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe((0,D.h)(i=>i.fromState!==i.toState),(0,Jn.R)(this._drawers.changes)).subscribe(i=>{"open-instant"!==i.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==t.mode&&t.openedChange.pipe((0,Jn.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe((0,Jn.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,et.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe((0,Jn.R)((0,Kg.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const i=this._element.nativeElement.classList,r="mat-drawer-container-has-open";t?i.add(r):i.remove(r)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{"end"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return"side"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(Re.Is,8),h.Y36(h.SBq),h.Y36(h.R0b),h.Y36(h.sBO),h.Y36(En.rL),h.Y36(Ow),h.Y36(Wi.Qb,8))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer-container"]],contentQueries:function(t,i,r){if(1&t&&(h.Suo(r,nh,5),h.Suo(r,Fy,5)),2&t){let s;h.iGM(s=h.CRH())&&(i._content=s.first),h.iGM(s=h.CRH())&&(i._allDrawers=s)}},viewQuery:function(t,i){if(1&t&&h.Gf(nh,5),2&t){let r;h.iGM(r=h.CRH())&&(i._userContent=r.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(t,i){2&t&&h.ekj("mat-drawer-container-explicit-backdrop",i._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[h._Bn([{provide:mp,useExisting:n}])],ngContentSelectors:Aw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,i){1&t&&(h.F$t(kw),h.YNc(0,Tw,1,2,"div",0),h.Hsn(1),h.Hsn(2,1),h.YNc(3,xw,2,0,"mat-drawer-content",1)),2&t&&(h.Q6J("ngIf",i.hasBackdrop),h.xp6(3),h.Q6J("ngIf",!i._content))},directives:[nh,fe.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),gp=(()=>{class n extends nh{constructor(t,i,r,s,u){super(t,i,r,s,u)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.sBO),h.Y36((0,h.Gpc)(()=>qy)),h.Y36(h.SBq),h.Y36(En.mF),h.Y36(h.R0b))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(t,i){2&t&&h.Udp("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[h._Bn([{provide:En.PQ,useExisting:n}]),h.qOj],ngContentSelectors:th,decls:1,vars:0,template:function(t,i){1&t&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),Vy=(()=>{class n extends Fy{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=(0,Lt.Ig)(t)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=(0,Lt.su)(t)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=(0,Lt.su)(t)}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=h.n5z(n)))(i||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(t,i){2&t&&(h.uIk("align",null),h.Udp("top",i.fixedInViewport?i.fixedTopGap:null,"px")("bottom",i.fixedInViewport?i.fixedBottomGap:null,"px"),h.ekj("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened)("mat-sidenav-fixed",i.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[h.qOj],ngContentSelectors:th,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,i){1&t&&(h.F$t(),h.TgZ(0,"div",0,1),h.Hsn(2),h.qZA())},directives:[En.PQ],encapsulation:2,data:{animation:[Ly.transformDrawer]},changeDetection:0}),n})(),qy=(()=>{class n extends Uy{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=h.n5z(n)))(i||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav-container"]],contentQueries:function(t,i,r){if(1&t&&(h.Suo(r,gp,5),h.Suo(r,Vy,5)),2&t){let s;h.iGM(s=h.CRH())&&(i._content=s.first),h.iGM(s=h.CRH())&&(i._allDrawers=s)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(t,i){2&t&&h.ekj("mat-drawer-container-explicit-backdrop",i._backdropOverride)},exportAs:["matSidenavContainer"],features:[h._Bn([{provide:mp,useExisting:n}]),h.qOj],ngContentSelectors:Rw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,i){1&t&&(h.F$t(Dw),h.YNc(0,Sw,1,2,"div",0),h.Hsn(1),h.Hsn(2,1),h.YNc(3,Cw,2,0,"mat-sidenav-content",1)),2&t&&(h.Q6J("ngIf",i.hasBackdrop),h.xp6(3),h.Q6J("ngIf",!i._content))},directives:[gp,fe.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),Pw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[fe.ez,ne.BQ,En.ZD],En.ZD,ne.BQ]}),n})();var Lw=F(5245);const Fw=["field"];function Uw(n,e){if(1&n&&(h.TgZ(0,"mat-option",10),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}const Vw=[{path:"",component:(()=>{class n{constructor(t,i,r,s){this.formBuilder=t,this.matDialog=i,this.store=r,this.router=s,this.mouseDown=!1,this.actors=[],this.rotations=[],this.currentRotationIndex=0,this.FieldMode=ft,this.fieldMode=ft.MOVE_ACTOR,this.formGroup=this.formBuilder.group({current_rotation:[null,q.kI.required]})}get rotation(){return this.rotations[this.currentRotationIndex]}ngAfterViewInit(){var t=this;this.context=this.fieldElement.nativeElement.getContext("2d"),this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height;for(const i of[["touchstart","mousedown"],["touchmove","mousemove"]])this.context.canvas.addEventListener(i[0],r=>{const s=r.touches[0];this.fieldElement.nativeElement.dispatchEvent(new MouseEvent(i[1],{clientX:s.clientX,clientY:s.clientY}))});this.context.canvas.addEventListener("touchend",()=>this.onMouseUp()),this.context.canvas.addEventListener("touchcancel",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousedown",i=>this.onMouseDown(i)),this.fieldElement.nativeElement.addEventListener("mouseup",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mouseleave",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousemove",i=>this.onMouseMove(i)),setTimeout((0,T.Z)(function*(){const i=new URLSearchParams(window.location.search);if(i&&i.get("store")&&30===i.get("store").length)yield t.importLink(i.get("store")),t.router.navigate(["/"]);else{const r=Et.retrieve(n.LOCAL_STORAGE_KEY_ROTATIONS),s=Et.retrieve(n.LOCAL_STORAGE_KEY_ACTORS),u=Et.retrieve(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION);r&&s&&u?(t.actors=s.map(d=>ti.fromDto(d,t.context)),t.rotations=r.map(d=>Bt.fromDto(d,t.context)),t.currentRotationIndex=t.rotations.findIndex(d=>d.UUID===u),t.actors.forEach(d=>d.shape.setRotationProperties(t.rotation.UUID,t.rotation.rotation))):t.rotations=[new Bt(new Tn(1),"Default rotation")],t.formGroup.patchValue({current_rotation:t.rotation.UUID})}t.formGroup.valueChanges.subscribe(r=>t.onRotationChanged(r.current_rotation)),t.render()}),100),(0,us.R)(window,"resize").subscribe(()=>this.fixRenderDimensions())}fixRenderDimensions(){this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height,this.render()}onRotationChanged(t){this.currentRotationIndex=this.rotations.findIndex(i=>i.UUID===t),this.actors.forEach(i=>i.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.render()}onMouseDown(t){const i=t.clientX,r=t.clientY;if(this.mouseDown=!0,this.fieldMode===ft.MOVE_ACTOR)for(let s=this.actors.length-1;s>=0;--s){const u=this.actors[s].shape;if(u.isHit(i,r))return void(this.draggedShape=u)}else this.fieldMode===ft.DRAW_LINE&&(this.drawnLine=new Lo(this.context),this.drawnLine.addPosition(i,r),this.rotation.addLine(this.drawnLine))}onMouseUp(){this.draggedShape=void 0,this.drawnLine=void 0,this.mouseDown=!1}onMouseMove(t){const i=t.clientX,r=t.clientY;if(this.fieldMode===ft.ERASE_LINE)this.mouseDown&&this.rotation.removeIfHitLine(i,r);else if(this.draggedShape)this.draggedShape.setPosition(i,r);else{if(!this.drawnLine)return;this.drawnLine.addPosition(i,r)}this.render()}onAddActorClicked(){this.matDialog.open(as,{autoFocus:!1}).afterClosed().subscribe(i=>{if(i){switch(i.player_role){case We.Setter:this.addShape(i,new xn(i,this.context));break;case We.MiddleBlocker:this.addShape(i,new rs(i,this.context,!1));break;case We.Libero:this.addShape(i,new rs(i,this.context,!0));break;case We.DefensiveSpecialist:this.addShape(i,new ju(i,this.context));break;case We.OutsideHitter:this.addShape(i,new ei(i,this.context,!1));break;case We.OppositeHitter:this.addShape(i,new ei(i,this.context,!0))}this.render()}})}addShape(t,i){i.setRotationProperties(this.rotation.UUID,this.rotation.rotation),t.setShape(i),this.actors.push(t)}onDeleteActorClicked(){this.matDialog.open(qt,{data:{actors:this.actors},autoFocus:!1}).afterClosed().subscribe(i=>{if(!i)return;const r=this.actors.findIndex(s=>s.UUID===i);this.actors.splice(r,1),this.render()})}onDeleteRotationClicked(){this.matDialog.open(uh,{data:{rotations:this.rotations},autoFocus:!1}).afterClosed().subscribe(i=>{if(!i)return;const r=this.rotation.UUID,s=this.rotations.findIndex(u=>u.UUID===i);this.rotations.splice(s,1),this.actors.forEach(u=>u.shape.removeRotation(i)),r===i&&(0===this.rotations.length&&this.rotations.push(new Bt(new Tn(1),"Default rotation")),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.actors.forEach(u=>u.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation))),this.currentRotationIndex=this.rotations.findIndex(u=>u.UUID===r),this.render()})}onAddRotationClicked(){this.matDialog.open(Xu,{autoFocus:!1}).afterClosed().subscribe(i=>{!i||(this.actors.forEach(r=>r.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.rotations.push(i),this.currentRotationIndex=this.rotations.length-1,this.formGroup.patchValue({current_rotation:i.UUID}),this.render())})}onExportClicked(){this.matDialog.open(Iw,{autoFocus:!1,data:{actors:this.actors,rotations:this.rotations,current_rotation:this.rotation.UUID}})}onImportClicked(){this.matDialog.open(ww,{autoFocus:!1}).afterClosed().subscribe(i=>this.importLink(i))}importLink(t){var i=this;return(0,T.Z)(function*(){!t||30!==t.length||(yield i.store.collection(t).get().toPromise().then(r=>{const s=r.docs[0].data();i.actors=s.actors.map(d=>ti.fromDto(d,i.context)),i.rotations=s.rotations.map(d=>Bt.fromDto(d,i.context));const u=s.current_rotation;i.currentRotationIndex=i.rotations.findIndex(d=>d.UUID===u),i.formGroup.patchValue({current_rotation:i.rotation.UUID}),i.actors.forEach(d=>d.shape.setRotationProperties(i.rotation.UUID,i.rotation.rotation)),i.render()}))})()}setMoveActorMode(){this.fieldMode=ft.MOVE_ACTOR}onToggleDrawMode(){this.fieldMode=this.fieldMode===ft.DRAW_LINE?ft.MOVE_ACTOR:ft.DRAW_LINE}onToggleEraseMode(){this.fieldMode=this.fieldMode===ft.ERASE_LINE?ft.MOVE_ACTOR:ft.ERASE_LINE}render(){this.initCourt(),this.actors.forEach(t=>t.draw()),this.rotation.draw(),Et.store(n.LOCAL_STORAGE_KEY_ROTATIONS,this.rotations.map(t=>t.toDto())),Et.store(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION,this.rotation.UUID),Et.store(n.LOCAL_STORAGE_KEY_ACTORS,this.actors.map(t=>t.toDto()))}initCourt(){const t=this.context.canvas.getBoundingClientRect().width,i=this.context.canvas.getBoundingClientRect().height;this.context.clearRect(0,0,t,i),this.context.fillStyle=n.OUTER_COLOR,this.context.fillRect(0,0,t,i);const r=.025*t,u=(i-.025*i)/10,d=(t-2*r)/9,f=r,m=t-2*r;this.context.fillStyle=n.FRONT_FIELD_COLOR,this.context.fillRect(f,0,m,4*u),this.context.fillStyle=n.BACK_FIELD_COLOR,this.context.fillRect(f,4*u,m,6*u);const g=u/20,_=d/20;this.context.fillStyle=n.LINE_COLOR,this.context.fillRect(f,0,_,10*u),this.context.fillRect(m+f-_,0,_,10*u),this.context.fillRect(f,4*u,m,g),this.context.fillRect(f,10*u,m,g),this.context.fillRect(f,1*u-3*g,m,3*g)}}return n.OUTER_COLOR="#469ABB",n.LINE_COLOR="#FFFFFF",n.FRONT_FIELD_COLOR="#FF5202",n.BACK_FIELD_COLOR="#F8A941",n.LOCAL_STORAGE_KEY_ACTORS="actors_storage",n.LOCAL_STORAGE_KEY_ROTATIONS="rotations_storage",n.LOCAL_STORAGE_KEY_CURRENT_ROTATION="current_rotation_uuid",n.\u0275fac=function(t){return new(t||n)(h.Y36(q.qu),h.Y36(Zo),h.Y36(My),h.Y36(R.F0))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-field"]],viewQuery:function(t,i){if(1&t&&h.Gf(Fw,5),2&t){let r;h.iGM(r=h.CRH())&&(i.fieldElement=r.first)}},decls:63,vars:40,consts:[["mode","over"],["sidenav",""],[3,"formGroup"],["formControlName","current_rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["href","https://github.com/Geigerkind/vb_positions","target","_blank",2,"margin-top","auto"],["mat-stroked-button",""],["mat-flat-button","",1,"toggle_sidenav",3,"click"],["field",""],[3,"value"]],template:function(t,i){if(1&t){const r=h.EpF();h.TgZ(0,"mat-sidenav-container")(1,"mat-sidenav",0,1)(3,"mat-form-field",2)(4,"mat-select",3),h.YNc(5,Uw,2,2,"mat-option",4),h.qZA()(),h.TgZ(6,"button",5),h.NdJ("click",function(){return i.onAddRotationClicked()}),h.TgZ(7,"mat-icon"),h._uU(8,"add"),h.qZA(),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"button",5),h.NdJ("click",function(){return i.onDeleteRotationClicked()}),h.TgZ(12,"mat-icon"),h._uU(13,"delete"),h.qZA(),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.TgZ(16,"button",5),h.NdJ("click",function(){return i.onAddActorClicked()}),h.TgZ(17,"mat-icon"),h._uU(18,"add"),h.qZA(),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.TgZ(21,"button",5),h.NdJ("click",function(){return i.onDeleteActorClicked()}),h.TgZ(22,"mat-icon"),h._uU(23,"delete"),h.qZA(),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"button",5),h.NdJ("click",function(){return i.onExportClicked()}),h.TgZ(27,"mat-icon"),h._uU(28,"share"),h.qZA(),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"button",5),h.NdJ("click",function(){return i.onImportClicked()}),h.TgZ(32,"mat-icon"),h._uU(33,"import_export"),h.qZA(),h._uU(34),h.ALo(35,"translate"),h.qZA(),h.TgZ(36,"button",5),h.NdJ("click",function(){return i.setMoveActorMode()}),h.TgZ(37,"mat-icon"),h._uU(38,"person"),h.qZA(),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"button",5),h.NdJ("click",function(){return i.onToggleDrawMode()}),h.TgZ(42,"mat-icon"),h._uU(43,"mode_edit_outline"),h.qZA(),h._uU(44),h.ALo(45,"translate"),h.qZA(),h.TgZ(46,"button",5),h.NdJ("click",function(){return i.onToggleEraseMode()}),h.TgZ(47,"mat-icon"),h._uU(48,"auto_fix_normal"),h.qZA(),h._uU(49),h.ALo(50,"translate"),h.qZA(),h.TgZ(51,"a",6)(52,"button",7)(53,"mat-icon"),h._uU(54,"code"),h.qZA(),h._uU(55),h.ALo(56,"translate"),h.qZA()()(),h.TgZ(57,"mat-sidenav-content")(58,"button",8),h.NdJ("click",function(){return h.CHM(r),h.MAs(2).toggle()}),h.TgZ(59,"mat-icon"),h._uU(60,"arrow_right"),h.qZA()(),h._UZ(61,"canvas",null,9),h.qZA()()}if(2&t){const r=h.MAs(2);h.xp6(3),h.Q6J("formGroup",i.formGroup),h.xp6(2),h.Q6J("ngForOf",i.rotations),h.xp6(4),h.hij(" ",h.lcZ(10,20,"field.add_rotation")," "),h.xp6(5),h.hij(" ",h.lcZ(15,22,"field.delete_rotation")," "),h.xp6(5),h.hij(" ",h.lcZ(20,24,"field.add_actor")," "),h.xp6(5),h.hij(" ",h.lcZ(25,26,"field.delete_actor")," "),h.xp6(5),h.hij(" ",h.lcZ(30,28,"field.export")," "),h.xp6(5),h.hij(" ",h.lcZ(35,30,"field.import")," "),h.xp6(2),h.ekj("toggled",i.fieldMode===i.FieldMode.MOVE_ACTOR),h.xp6(3),h.hij(" ",h.lcZ(40,32,"field.actor_mode")," "),h.xp6(2),h.ekj("toggled",i.fieldMode===i.FieldMode.DRAW_LINE),h.xp6(3),h.hij(" ",h.lcZ(45,34,"field.draw_mode")," "),h.xp6(2),h.ekj("toggled",i.fieldMode===i.FieldMode.ERASE_LINE),h.xp6(3),h.hij(" ",h.lcZ(50,36,"field.erase_mode")," "),h.xp6(6),h.hij(" ",h.lcZ(56,38,"field.source_code")," "),h.xp6(3),h.ekj("is_opened",r.opened)}},directives:[qy,Vy,pt.KE,q.JL,q.sg,An.gD,q.JJ,q.u,fe.sg,ne.ey,Vt.lW,Lw.Hw,gp],pipes:[wt.X$],styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}.toggled[_ngcontent-%COMP%]{color:#0a64ae}mat-sidenav-container[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:15rem;padding:1rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:3rem;text-align:left;margin-bottom:.5rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#0a64ae}mat-sidenav[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.toggle_sidenav[_ngcontent-%COMP%]{position:absolute;top:3rem;left:-1rem;z-index:20;transform:rotate(90deg)}.toggle_sidenav.is_opened[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(90deg)}.toggle_sidenav[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-90deg)}canvas[_ngcontent-%COMP%]{display:block;height:100%;width:100%;touch-action:none}"]}),n})()}];let qw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[R.Bz.forChild(Vw)],R.Bz]}),n})();var By=F(7144);let zy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({}),n})(),Jw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[ne.si,ne.BQ,By.Q8,zy],ne.BQ,zy]}),n})(),Xw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[qw,I.m,wt.aw,Hi,q.UX,fe.ez,Jw,Pw]]}),n})()},9169:($y,zu,F)=>{F.r(zu);var I=F(5861),wt=F(3942),R=F(2090),T=F(9681),Po=F(1877),Xn=F(655),ei=F(4859);const ju=function rs(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Wu=function Lo(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},ti=new R.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),ni=new Po.Yd("@firebase/auth");function bt(c,...o){ni.logLevel<=Po.in.ERROR&&ni.error(`Auth (${T.SDK_VERSION}): ${c}`,...o)}function ne(c,...o){throw Ft(c,...o)}function Re(c,...o){return Ft(c,...o)}function Xe(c,o,a){const l=Object.assign(Object.assign({},Wu()),{[o]:a});return new R.LL("auth","Firebase",l).create(o,{appName:c.name})}function ii(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&ne(c,"argument-error"),Xe(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ft(c,...o){if("string"!=typeof c){const a=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return ti.create(c,...o)}function D(c,o,...a){if(!c)throw Ft(o,...a)}function et(c){const o="INTERNAL ASSERTION FAILED: "+c;throw bt(o),new Error(o)}function Ze(c,o){c||et(o)}const ji=new Map;function fe(c){Ze(c instanceof Function,"Expected a class definition");let o=ji.get(c);return o?(Ze(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,ji.set(c,o),o)}function rn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Wi(){return"http:"===Ku()||"https:"===Ku()}function Ku(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class ss{constructor(o,a){this.shortDelay=o,this.longDelay=a,Ze(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,R.uI)()||(0,R.b$)()}get(){return function Fo(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Wi()||(0,R.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Uo(c,o){Ze(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Hu{static initialize(o,a,l){this.fetchImpl=o,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void et("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void et("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void et("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const rh={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},sn=new ss(3e4,6e4);function Se(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function Te(c,o,a,l){return Vo.apply(this,arguments)}function Vo(){return(Vo=(0,I.Z)(function*(c,o,a,l,p={}){return qo(c,p,(0,I.Z)(function*(){let y={},v={};l&&("GET"===o?v=l:y={body:JSON.stringify(l)});const x=(0,R.xO)(Object.assign({key:c.config.apiKey},v)).slice(1),A=yield c._getAdditionalHeaders();return A["Content-Type"]="application/json",c.languageCode&&(A["X-Firebase-Locale"]=c.languageCode),Hu.fetch()(Yu(c,c.config.apiHost,a,x),Object.assign({method:o,headers:A,referrerPolicy:"no-referrer"},y))}))})).apply(this,arguments)}function qo(c,o,a){return Qu.apply(this,arguments)}function Qu(){return(Qu=(0,I.Z)(function*(c,o,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},rh),o);try{const p=new Zo(c),y=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const v=yield y.json();if("needConfirmation"in v)throw Ki(c,"account-exists-with-different-credential",v);if(y.ok&&!("errorMessage"in v))return v;{const x=y.ok?v.errorMessage:v.error.message,[A,L]=x.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===A)throw Ki(c,"credential-already-in-use",v);if("EMAIL_EXISTS"===A)throw Ki(c,"email-already-in-use",v);if("USER_DISABLED"===A)throw Ki(c,"user-disabled",v);const $=l[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(L)throw Xe(c,$,L);ne(c,$)}}catch(p){if(p instanceof R.ZR)throw p;ne(c,"network-request-failed")}})).apply(this,arguments)}function Ut(c,o,a,l){return Bo.apply(this,arguments)}function Bo(){return(Bo=(0,I.Z)(function*(c,o,a,l,p={}){const y=yield Te(c,o,a,l,p);return"mfaPendingCredential"in y&&ne(c,"multi-factor-auth-required",{_serverResponse:y}),y})).apply(this,arguments)}function Yu(c,o,a,l){const p=`${o}${a}?${l}`;return c.config.emulator?Uo(c.config,p):`${c.config.apiScheme}://${p}`}class Zo{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(Re(this.auth,"network-request-failed")),sn.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ki(c,o,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const p=Re(c,o,l);return p.customData._tokenResponse=a,p}function Ju(){return(Ju=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function ri(c,o){return on.apply(this,arguments)}function on(){return(on=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function yp(c,o){return Go.apply(this,arguments)}function Go(){return(Go=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Hi(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function An(){return(An=(0,I.Z)(function*(c,o=!1){const a=(0,R.m9)(c),l=yield a.getIdToken(o),p=as(l);D(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const y="object"==typeof p.firebase?p.firebase:void 0,v=null==y?void 0:y.sign_in_provider;return{claims:p,token:l,authTime:Hi(Vt(p.auth_time)),issuedAtTime:Hi(Vt(p.iat)),expirationTime:Hi(Vt(p.exp)),signInProvider:v||null,signInSecondFactor:(null==y?void 0:y.sign_in_second_factor)||null}})).apply(this,arguments)}function Vt(c){return 1e3*Number(c)}function as(c){const[o,a,l]=c.split(".");if(void 0===o||void 0===a||void 0===l)return bt("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,R.tV)(a);return p?JSON.parse(p):(bt("Failed to decode base64 JWT payload"),null)}catch(p){return bt("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function qt(c,o){return Bt.apply(this,arguments)}function Bt(){return(Bt=(0,I.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(l){throw l instanceof R.ZR&&ah(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function ah({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class uh{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),l)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Xu{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Hi(this.lastLoginAt),this.creationTime=Hi(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function Et(c){return us.apply(this,arguments)}function us(){return(us=(0,I.Z)(function*(c){var o;const a=c.auth,l=yield c.getIdToken(),p=yield qt(c,yp(a,{idToken:l}));D(null==p?void 0:p.users.length,a,"internal-error");const y=p.users[0];c._notifyReloadListener(y);const v=(null===(o=y.providerUserInfo)||void 0===o?void 0:o.length)?Ge(y.providerUserInfo):[],x=$o(c.providerData,v),$=!!c.isAnonymous&&!(c.email&&y.passwordHash||(null==x?void 0:x.length)),z={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:x,metadata:new Xu(y.createdAt,y.lastLoginAt),isAnonymous:$};Object.assign(c,z)})).apply(this,arguments)}function zo(){return(zo=(0,I.Z)(function*(c){const o=(0,R.m9)(c);yield Et(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function $o(c,o){return[...c.filter(l=>!o.some(p=>p.providerId===l.providerId)),...o]}function Ge(c){return c.map(o=>{var{providerId:a}=o,l=(0,Xn._T)(o,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function jo(){return(jo=(0,I.Z)(function*(c,o){const a=yield qo(c,{},(0,I.Z)(function*(){const l=(0,R.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:y}=c.config,v=Yu(c,p,"/v1/token",`key=${y}`),x=yield c._getAdditionalHeaders();return x["Content-Type"]="application/x-www-form-urlencoded",Hu.fetch()(v,{method:"POST",headers:x,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Cn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){D(o.idToken,"internal-error"),D(void 0!==o.idToken,"internal-error"),D(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function oh(c){const o=as(c);return D(o,"internal-error"),D(void 0!==o.exp,"internal-error"),D(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var l=this;return(0,I.Z)(function*(){return D(!l.accessToken||l.refreshToken,o,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var l=this;return(0,I.Z)(function*(){const{accessToken:p,refreshToken:y,expiresIn:v}=yield function ch(c,o){return jo.apply(this,arguments)}(o,a);l.updateTokensAndExpiration(p,y,Number(v))})()}updateTokensAndExpiration(o,a,l){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,a){const{refreshToken:l,accessToken:p,expirationTime:y}=a,v=new Cn;return l&&(D("string"==typeof l,"internal-error",{appName:o}),v.refreshToken=l),p&&(D("string"==typeof p,"internal-error",{appName:o}),v.accessToken=p),y&&(D("number"==typeof y,"internal-error",{appName:o}),v.expirationTime=y),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Cn,this.toJSON())}_performRefresh(){return et("not implemented")}}function ye(c,o){D("string"==typeof c||void 0===c,"internal-error",{appName:o})}class Zt{constructor(o){var{uid:a,auth:l,stsTokenManager:p}=o,y=(0,Xn._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new uh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new Xu(y.createdAt||void 0,y.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const l=yield qt(a,a.stsTokenManager.getToken(a.auth,o));return D(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(o){return function os(c){return An.apply(this,arguments)}(this,o)}reload(){return function Sn(c){return zo.apply(this,arguments)}(this)}_assign(o){this!==o&&(D(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new Zt(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){D(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var l=this;return(0,I.Z)(function*(){let p=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield Et(l)),yield l.auth._persistUserIfCurrent(l),p&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield qt(o,function sh(c,o){return Ju.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var l,p,y,v,x,A,L,$;const z=null!==(l=a.displayName)&&void 0!==l?l:void 0,Oe=null!==(p=a.email)&&void 0!==p?p:void 0,Qe=null!==(y=a.phoneNumber)&&void 0!==y?y:void 0,po=null!==(v=a.photoURL)&&void 0!==v?v:void 0,hu=null!==(x=a.tenantId)&&void 0!==x?x:void 0,yn=null!==(A=a._redirectEventId)&&void 0!==A?A:void 0,Mt=null!==(L=a.createdAt)&&void 0!==L?L:void 0,du=null!==($=a.lastLoginAt)&&void 0!==$?$:void 0,{uid:mo,emailVerified:fu,isAnonymous:Wn,providerData:Gr,stsTokenManager:cl}=a;D(mo&&cl,o,"internal-error");const De=Cn.fromJSON(this.name,cl);D("string"==typeof mo,o,"internal-error"),ye(z,o.name),ye(Oe,o.name),D("boolean"==typeof fu,o,"internal-error"),D("boolean"==typeof Wn,o,"internal-error"),ye(Qe,o.name),ye(po,o.name),ye(hu,o.name),ye(yn,o.name),ye(Mt,o.name),ye(du,o.name);const ee=new Zt({uid:mo,auth:o,email:Oe,emailVerified:fu,displayName:z,isAnonymous:Wn,photoURL:po,phoneNumber:Qe,tenantId:hu,stsTokenManager:De,createdAt:Mt,lastLoginAt:du});return Gr&&Array.isArray(Gr)&&(ee.providerData=Gr.map(ll=>Object.assign({},ll))),yn&&(ee._redirectEventId=yn),ee}static _fromIdTokenResponse(o,a,l=!1){return(0,I.Z)(function*(){const p=new Cn;p.updateFromServerResponse(a);const y=new Zt({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:l});return yield Et(y),y})()}}const Ke=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,l){var p=this;return(0,I.Z)(function*(){p.storage[a]=l})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=l.storage[a];return void 0===p?null:p})()}_remove(a){var l=this;return(0,I.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function si(c,o,a){return`firebase:${c}:${o}:${a}`}class oi{constructor(o,a,l){this.persistence=o,this.auth=a,this.userKey=l;const{config:p,name:y}=this.auth;this.fullUserKey=si(this.userKey,p.apiKey,y),this.fullPersistenceKey=si("persistence",p.apiKey,y),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?Zt._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,l="authUser"){return(0,I.Z)(function*(){if(!a.length)return new oi(fe(Ke),o,l);const p=(yield Promise.all(a.map(function(){var L=(0,I.Z)(function*($){if(yield $._isAvailable())return $});return function($){return L.apply(this,arguments)}}()))).filter(L=>L);let y=p[0]||fe(Ke);const v=si(l,o.config.apiKey,o.name);let x=null;for(const L of a)try{const $=yield L._get(v);if($){const z=Zt._fromJSON(o,$);L!==y&&(x=z),y=L;break}}catch($){}const A=p.filter(L=>L._shouldAllowMigration);return y._shouldAllowMigration&&A.length?(y=A[0],x&&(yield y._set(v,x.toJSON())),yield Promise.all(a.map(function(){var L=(0,I.Z)(function*($){if($!==y)try{yield $._remove(v)}catch(z){}});return function($){return L.apply(this,arguments)}}())),new oi(y,o,l)):new oi(y,o,l)})()}}function an(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(ec(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Qi(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(B(o))return"Blackberry";if(cs(o))return"Webos";if(Tt(o))return"Safari";if((o.includes("chrome/")||re(o))&&!o.includes("edge/"))return"Chrome";if(st(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function Qi(c=(0,R.z$)()){return/firefox\//i.test(c)}function Tt(c=(0,R.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function re(c=(0,R.z$)()){return/crios\//i.test(c)}function ec(c=(0,R.z$)()){return/iemobile/i.test(c)}function st(c=(0,R.z$)()){return/android/i.test(c)}function B(c=(0,R.z$)()){return/blackberry/i.test(c)}function cs(c=(0,R.z$)()){return/webos/i.test(c)}function j(c=(0,R.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function tc(c=(0,R.z$)()){return j(c)||st(c)||cs(c)||B(c)||/windows phone/i.test(c)||ec(c)}function nc(c,o=[]){let a;switch(c){case"Browser":a=an((0,R.z$)());break;case"Worker":a=`${an((0,R.z$)())}-${c}`;break;default:a=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${T.SDK_VERSION}/${l}`}class hh{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const l=y=>new Promise((v,x)=>{try{v(o(y))}catch(A){x(A)}});l.onAbort=a,this.queue.push(l);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){if(a.auth.currentUser===o)return;const l=[];try{for(const p of a.queue)yield p(o),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const y of l)try{y()}catch(v){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}class dh{constructor(o,a,l){this.app=o,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Ji(this),this.idTokenSubscription=new Ji(this),this.beforeStateQueue=new hh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ti,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(o,a){var l=this;return a&&(this._popupRedirectResolver=fe(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var p,y;if(!l._deleted&&(l.persistenceManager=yield oi.create(l,o),!l._deleted)){if(null===(p=l._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(v){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(y=l.currentUser)||void 0===y?void 0:y.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var l;const p=yield a.assertedPersistence.getCurrentUser();let y=p,v=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const x=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,A=null==y?void 0:y._redirectEventId,L=yield a.tryRedirectSignIn(o);(!x||x===A)&&(null==L?void 0:L.user)&&(y=L.user,v=!0)}if(!y)return a.directlySetCurrentUser(null);if(!y._redirectEventId){if(v)try{yield a.beforeStateQueue.runMiddleware(y)}catch(x){y=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(x))}return y?a.reloadAndSetCurrentUserOrClear(y):a.directlySetCurrentUser(null)}return D(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===y._redirectEventId?a.directlySetCurrentUser(y):a.reloadAndSetCurrentUserOrClear(y)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){try{yield Et(o)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function ih(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const l=o?(0,R.m9)(o):null;return l&&D(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(o,a=!1){var l=this;return(0,I.Z)(function*(){if(!l._deleted)return o&&D(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,I.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(fe(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new R.LL("auth","Firebase",o())}onAuthStateChanged(o,a,l){return this.registerStateListener(this.authStateSubscription,o,a,l)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,l){return this.registerStateListener(this.idTokenSubscription,o,a,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var l=this;return(0,I.Z)(function*(){const p=yield l.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const l=o&&fe(o)||a._popupRedirectResolver;D(l,a,"argument-error"),a.redirectPersistenceManager=yield oi.create(a,[fe(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var l,p;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,l,p){if(this._deleted)return()=>{};const y="function"==typeof a?a:a.next.bind(a),v=this._isInitialized?Promise.resolve():this._initializationPromise;return D(v,this,"internal-error"),v.then(()=>y(this.currentUser)),"function"==typeof a?o.addObserver(a,l,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return D(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=nc(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(l["X-Firebase-Client"]=p),l})()}}function se(c){return(0,R.m9)(c)}class Ji{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,R.ne)(a=>this.observer=a)}get next(){return D(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Gt(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function Ko(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Dn{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return et("not implemented")}_getIdTokenResponse(o){return et("not implemented")}_linkToIdToken(o,a){return et("not implemented")}_getReauthenticationResolver(o){return et("not implemented")}}function Ue(c,o){return Qo.apply(this,arguments)}function Qo(){return(Qo=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:resetPassword",Se(c,o))})).apply(this,arguments)}function Xi(c,o){return ds.apply(this,arguments)}function ds(){return(ds=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Yo(c,o){return ai.apply(this,arguments)}function ai(){return(ai=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:update",Se(c,o))})).apply(this,arguments)}function er(){return(er=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithPassword",Se(c,o))})).apply(this,arguments)}function fs(c,o){return Jo.apply(this,arguments)}function Jo(){return(Jo=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:sendOobCode",Se(c,o))})).apply(this,arguments)}function ui(c,o){return ps.apply(this,arguments)}function ps(){return(ps=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function Xo(c,o){return ms.apply(this,arguments)}function ms(){return(ms=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function ph(c,o){return gs.apply(this,arguments)}function gs(){return(gs=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function ys(c,o){return tr.apply(this,arguments)}function tr(){return(tr=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function nr(){return(nr=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithEmailLink",Se(c,o))})).apply(this,arguments)}function ta(){return(ta=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithEmailLink",Se(c,o))})).apply(this,arguments)}class Rn extends Dn{constructor(o,a,l,p=null){super("password",l),this._email=o,this._password=a,this._tenantId=p}static _fromEmailAndPassword(o,a){return new Rn(o,a,"password")}static _fromEmailAndCode(o,a,l=null){return new Rn(o,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){switch(a.signInMethod){case"password":return function xt(c,o){return er.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function ea(c,o){return nr.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:ne(o,"internal-error")}})()}_linkToIdToken(o,a){var l=this;return(0,I.Z)(function*(){switch(l.signInMethod){case"password":return Xi(o,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function mh(c,o){return ta.apply(this,arguments)}(o,{idToken:a,email:l._email,oobCode:l._password});default:ne(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function kt(c,o){return na.apply(this,arguments)}function na(){return(na=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithIdp",Se(c,o))})).apply(this,arguments)}class At extends Dn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new At(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):ne("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p}=a,y=(0,Xn._T)(a,["providerId","signInMethod"]);if(!l||!p)return null;const v=new At(l,p);return v.idToken=y.idToken||void 0,v.accessToken=y.accessToken||void 0,v.secret=y.secret,v.nonce=y.nonce,v.pendingToken=y.pendingToken||null,v}_getIdTokenResponse(o){return kt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,kt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,kt(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,R.xO)(a)}return o}}function rr(c,o){return ia.apply(this,arguments)}function ia(){return(ia=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:sendVerificationCode",Se(c,o))})).apply(this,arguments)}function ci(){return(ci=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithPhoneNumber",Se(c,o))})).apply(this,arguments)}function _s(){return(_s=(0,I.Z)(function*(c,o){const a=yield Ut(c,"POST","/v1/accounts:signInWithPhoneNumber",Se(c,o));if(a.temporaryProof)throw Ki(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const ic={USER_NOT_FOUND:"user-not-found"};function li(){return(li=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithPhoneNumber",Se(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),ic)})).apply(this,arguments)}class zt extends Dn{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new zt({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new zt({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function gh(c,o){return ci.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function ra(c,o){return _s.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function rc(c,o){return li.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:l,verificationCode:p}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:l,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}=o;return l||a||p||y?new zt({verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}):null}}class Nn{constructor(o){var a,l,p,y,v,x;const A=(0,R.zd)((0,R.pd)(o)),L=null!==(a=A.apiKey)&&void 0!==a?a:null,$=null!==(l=A.oobCode)&&void 0!==l?l:null,z=function sa(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=A.mode)&&void 0!==p?p:null);D(L&&$&&z,"argument-error"),this.apiKey=L,this.operation=z,this.code=$,this.continueUrl=null!==(y=A.continueUrl)&&void 0!==y?y:null,this.languageCode=null!==(v=A.languageCode)&&void 0!==v?v:null,this.tenantId=null!==(x=A.tenantId)&&void 0!==x?x:null}static parseLink(o){const a=function oa(c){const o=(0,R.zd)((0,R.pd)(c)).link,a=o?(0,R.zd)((0,R.pd)(o)).deep_link_id:null,l=(0,R.zd)((0,R.pd)(c)).deep_link_id;return(l?(0,R.zd)((0,R.pd)(l)).link:null)||l||a||o||c}(o);try{return new Nn(a)}catch(l){return null}}}let vs=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return Rn._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const p=Nn.parseLink(l);return D(p,"argument-error"),Rn._fromEmailAndCode(a,p.code,p.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class $t{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class On extends $t{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Mn extends On{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return D("providerId"in a&&"signInMethod"in a,"argument-error"),At._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return D(o.idToken||o.accessToken,"argument-error"),At._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Mn.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Mn.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:l,oauthTokenSecret:p,pendingToken:y,nonce:v,providerId:x}=o;if(!l&&!p&&!a&&!y||!x)return null;try{return new Mn(x)._credential({idToken:a,accessToken:l,nonce:v,pendingToken:y})}catch(A){return null}}}let Is=(()=>{class c extends On{constructor(){super("facebook.com")}static credential(a){return At._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),aa=(()=>{class c extends On{constructor(){super("google.com"),this.addScope("profile")}static credential(a,l){return At._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:l,oauthAccessToken:p}=a;if(!l&&!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),sc=(()=>{class c extends On{constructor(){super("github.com")}static credential(a){return At._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class un extends Dn{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return kt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,kt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,kt(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p,pendingToken:y}=a;return l&&p&&y&&l===p?new un(l,y):null}static _create(o,a){return new un(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class xe extends $t{constructor(o){D(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return xe.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return xe.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=un.fromJSON(o);return D(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:l}=o;if(!a||!l)return null;try{return un._create(l,a)}catch(p){return null}}}let Fe=(()=>{class c extends On{constructor(){super("twitter.com")}static credential(a,l){return At._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=a;if(!l||!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function sr(c,o){return or.apply(this,arguments)}function or(){return(or=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signUp",Se(c,o))})).apply(this,arguments)}class mt{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,l,p=!1){return(0,I.Z)(function*(){const y=yield Zt._fromIdTokenResponse(o,l,p),v=oc(l);return new mt({user:y,providerId:v,_tokenResponse:l,operationType:a})})()}static _forOperation(o,a,l){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const p=oc(l);return new mt({user:o,providerId:p,_tokenResponse:l,operationType:a})})()}}function oc(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function la(){return(la=(0,I.Z)(function*(c){var o;const a=se(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new mt({user:a.currentUser,providerId:null,operationType:"signIn"});const l=yield sr(a,{returnSecureToken:!0}),p=yield mt._fromIdTokenResponse(a,"signIn",l,!0);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class ws extends R.ZR{constructor(o,a,l,p){var y;super(a.code,a.message),this.operationType=l,this.user=p,Object.setPrototypeOf(this,ws.prototype),this.customData={appName:o.name,tenantId:null!==(y=o.tenantId)&&void 0!==y?y:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,a,l,p){return new ws(o,a,l,p)}}function ha(c,o,a,l){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(y=>{throw"auth/multi-factor-auth-required"===y.code?ws._fromErrorAndOperation(c,y,o,l):y})}function bs(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function ar(){return(ar=(0,I.Z)(function*(c,o){const a=(0,R.m9)(c);yield Pn(!0,a,o);const{providerUserInfo:l}=yield ri(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),p=bs(l||[]);return a.providerData=a.providerData.filter(y=>p.has(y.providerId)),p.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function Es(c,o){return da.apply(this,arguments)}function da(){return(da=(0,I.Z)(function*(c,o,a=!1){const l=yield qt(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return mt._forOperation(c,"link",l)})).apply(this,arguments)}function Pn(c,o,a){return ur.apply(this,arguments)}function ur(){return(ur=(0,I.Z)(function*(c,o,a){yield Et(o);const p=!1===c?"provider-already-linked":"no-such-provider";D(bs(o.providerData).has(a)===c,o.auth,p)})).apply(this,arguments)}function Ts(c,o){return xs.apply(this,arguments)}function xs(){return(xs=(0,I.Z)(function*(c,o,a=!1){const{auth:l}=c,p="reauthenticate";try{const y=yield qt(c,ha(l,p,o,c),a);D(y.idToken,l,"internal-error");const v=as(y.idToken);D(v,l,"internal-error");const{sub:x}=v;return D(c.uid===x,l,"user-mismatch"),mt._forOperation(c,p,y)}catch(y){throw"auth/user-not-found"===(null==y?void 0:y.code)&&ne(l,"user-mismatch"),y}})).apply(this,arguments)}function uc(c,o){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,I.Z)(function*(c,o,a=!1){const l="signIn",p=yield ha(c,l,o),y=yield mt._fromIdTokenResponse(c,l,p);return a||(yield c._updateCurrentUser(y.user)),y})).apply(this,arguments)}function cr(c,o){return ks.apply(this,arguments)}function ks(){return(ks=(0,I.Z)(function*(c,o){return uc(se(c),o)})).apply(this,arguments)}function fa(c,o){return hi.apply(this,arguments)}function hi(){return(hi=(0,I.Z)(function*(c,o){const a=(0,R.m9)(c);return yield Pn(!1,a,o.providerId),Es(a,o)})).apply(this,arguments)}function cc(c,o){return pa.apply(this,arguments)}function pa(){return(pa=(0,I.Z)(function*(c,o){return Ts((0,R.m9)(c),o)})).apply(this,arguments)}function di(c,o){return ma.apply(this,arguments)}function ma(){return(ma=(0,I.Z)(function*(c,o){return Ut(c,"POST","/v1/accounts:signInWithCustomToken",Se(c,o))})).apply(this,arguments)}function jt(){return(jt=(0,I.Z)(function*(c,o){const a=se(c),l=yield di(a,{token:o,returnSecureToken:!0}),p=yield mt._fromIdTokenResponse(a,"signIn",l);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class lr{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?fi._fromServerResponse(o,a):ne(o,"internal-error")}}class fi extends lr{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new fi(a)}}function hr(c,o,a){var l;D((null===(l=a.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),D(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(D(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(D(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function As(){return(As=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c),p={requestType:"PASSWORD_RESET",email:o};a&&hr(l,p,a),yield Xo(l,p)})).apply(this,arguments)}function Ss(){return(Ss=(0,I.Z)(function*(c,o,a){yield Ue((0,R.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function pi(){return(pi=(0,I.Z)(function*(c,o){yield Yo((0,R.m9)(c),{oobCode:o})})).apply(this,arguments)}function ga(c,o){return pr.apply(this,arguments)}function pr(){return(pr=(0,I.Z)(function*(c,o){const a=(0,R.m9)(c),l=yield Ue(a,{oobCode:o}),p=l.requestType;switch(D(p,a,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":D(l.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":D(l.mfaInfo,a,"internal-error");default:D(l.email,a,"internal-error")}let y=null;return l.mfaInfo&&(y=lr._fromServerResponse(se(a),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:y},operation:p}})).apply(this,arguments)}function Cs(){return(Cs=(0,I.Z)(function*(c,o){const{data:a}=yield ga((0,R.m9)(c),o);return a.email})).apply(this,arguments)}function gr(){return(gr=(0,I.Z)(function*(c,o,a){const l=se(c),p=yield sr(l,{returnSecureToken:!0,email:o,password:a}),y=yield mt._fromIdTokenResponse(l,"signIn",p);return yield l._updateCurrentUser(y.user),y})).apply(this,arguments)}function mi(){return(mi=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c),p={requestType:"EMAIL_SIGNIN",email:o};D(a.handleCodeInApp,l,"argument-error"),a&&hr(l,p,a),yield ph(l,p)})).apply(this,arguments)}function va(){return(va=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c),p=vs.credentialWithLink(o,a||rn());return D(p._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),cr(l,p)})).apply(this,arguments)}function Ia(c,o){return gi.apply(this,arguments)}function gi(){return(gi=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:createAuthUri",Se(c,o))})).apply(this,arguments)}function Ds(){return(Ds=(0,I.Z)(function*(c,o){const l={identifier:o,continueUri:Wi()?rn():"http://localhost"},{signinMethods:p}=yield Ia((0,R.m9)(c),l);return p||[]})).apply(this,arguments)}function Rs(){return(Rs=(0,I.Z)(function*(c,o){const a=(0,R.m9)(c),p={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&hr(a.auth,p,o);const{email:y}=yield ui(a.auth,p);y!==c.email&&(yield c.reload())})).apply(this,arguments)}function Fn(){return(Fn=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c),y={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&hr(l.auth,y,a);const{email:v}=yield ys(l.auth,y);v!==c.email&&(yield c.reload())})).apply(this,arguments)}function fc(c,o){return yi.apply(this,arguments)}function yi(){return(yi=(0,I.Z)(function*(c,o){return Te(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Wt(){return(Wt=(0,I.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const l=(0,R.m9)(c),y={idToken:yield l.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},v=yield qt(l,fc(l.auth,y));l.displayName=v.displayName||null,l.photoURL=v.photoUrl||null;const x=l.providerData.find(({providerId:A})=>"password"===A);x&&(x.displayName=l.displayName,x.photoURL=l.photoURL),yield l._updateTokensIfNecessary(v)})).apply(this,arguments)}function pc(c,o,a){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,I.Z)(function*(c,o,a){const{auth:l}=c,y={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(y.email=o),a&&(y.password=a);const v=yield qt(c,Xi(l,y));yield c._updateTokensIfNecessary(v,!0)})).apply(this,arguments)}class _i{constructor(o,a,l={}){this.isNewUser=o,this.providerId=a,this.profile=l}}class cn extends _i{constructor(o,a,l,p){super(o,a,l),this.username=p}}class Kt extends _i{constructor(o,a){super(o,"facebook.com",a)}}class Os extends cn{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class Ms extends _i{constructor(o,a){super(o,"google.com",a)}}class gc extends cn{constructor(o,a,l){super(o,"twitter.com",a,l)}}function pe(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function mc(c){var o,a;if(!c)return null;const{providerId:l}=c,p=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},y=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&(null==c?void 0:c.idToken)){const v=null===(a=null===(o=as(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(v)return new _i(y,"anonymous"!==v&&"custom"!==v?v:null)}if(!l)return null;switch(l){case"facebook.com":return new Kt(y,p);case"github.com":return new Os(y,p);case"google.com":return new Ms(y,p);case"twitter.com":return new gc(y,p,c.screenName||null);case"custom":case"anonymous":return new _i(y,null);default:return new _i(y,l,p)}}(a)}class _t{constructor(o,a,l){this.type=o,this.credential=a,this.auth=l}static _fromIdtoken(o,a){return new _t("enroll",o,a)}static _fromMfaPendingCredential(o){return new _t("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,l;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return _t._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(l=o.multiFactorSession)||void 0===l?void 0:l.idToken)return _t._fromIdtoken(o.multiFactorSession.idToken)}return null}}class St{constructor(o,a,l){this.session=o,this.hints=a,this.signInResolver=l}static _fromError(o,a){const l=se(o),p=a.customData._serverResponse,y=(p.mfaInfo||[]).map(x=>lr._fromServerResponse(l,x));D(p.mfaPendingCredential,l,"internal-error");const v=_t._fromMfaPendingCredential(p.mfaPendingCredential);return new St(v,y,function(){var x=(0,I.Z)(function*(A){const L=yield A._process(l,v);delete p.mfaInfo,delete p.mfaPendingCredential;const $=Object.assign(Object.assign({},p),{idToken:L.idToken,refreshToken:L.refreshToken});switch(a.operationType){case"signIn":const z=yield mt._fromIdTokenResponse(l,a.operationType,$);return yield l._updateCurrentUser(z.user),z;case"reauthenticate":return D(a.user,l,"internal-error"),mt._forOperation(a.user,a.operationType,$);default:ne(l,"internal-error")}});return function(A){return x.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}function _c(c,o){return Te(c,"POST","/v2/accounts/mfaEnrollment:start",Se(c,o))}class xa{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(l=>lr._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new xa(o)}getSession(){var o=this;return(0,I.Z)(function*(){return _t._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var l=this;return(0,I.Z)(function*(){const p=o,y=yield l.getSession(),v=yield qt(l.user,p._process(l.user.auth,y,a));return yield l.user._updateTokensIfNecessary(v),l.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){const l="string"==typeof o?o:o.uid,p=yield a.user.getIdToken(),y=yield qt(a.user,function vi(c,o){return Te(c,"POST","/v2/accounts/mfaEnrollment:withdraw",Se(c,o))}(a.user.auth,{idToken:p,mfaEnrollmentId:l}));a.enrolledFactors=a.enrolledFactors.filter(({uid:v})=>v!==l),yield a.user._updateTokensIfNecessary(y);try{yield a.user.reload()}catch(v){if("auth/user-token-expired"!==(null==v?void 0:v.code))throw v}})()}}const ka=new WeakMap,Ps="__sak";class Aa{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Ps,"1"),this.storage.removeItem(Ps),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const wr=(()=>{class c extends Aa{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function wc(){const c=(0,R.z$)();return Tt(c)||j(c)}()&&function Wo(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=tc(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),y=this.localCache[l];p!==y&&a(l,y,p)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((x,A,L)=>{this.notifyListeners(x,L)});const p=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const x=this.storage.getItem(p);if(a.newValue!==x)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!l)return}const y=()=>{const x=this.storage.getItem(p);!l&&this.localCache[p]===x||this.notifyListeners(p,x)},v=this.storage.getItem(p);!function Yi(){return(0,R.w1)()&&10===document.documentMode}()||v===a.newValue||a.newValue===a.oldValue?y():setTimeout(y,10)}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var p=()=>super._set,y=this;return(0,I.Z)(function*(){yield p().call(y,a,l),y.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,p=this;return(0,I.Z)(function*(){const y=yield l().call(p,a);return p.localCache[a]=JSON.stringify(y),y})()}_remove(a){var l=()=>super._remove,p=this;return(0,I.Z)(function*(){yield l().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),ln=(()=>{class c extends Aa{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let xh=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(y=>y.isListeningto(a));if(l)return l;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,I.Z)(function*(){const p=a,{eventId:y,eventType:v,data:x}=p.data,A=l.handlersMap[v];if(!(null==A?void 0:A.size))return;p.ports[0].postMessage({status:"ack",eventId:y,eventType:v});const L=Array.from(A).map(function(){var z=(0,I.Z)(function*(Oe){return Oe(p.origin,x)});return function(Oe){return z.apply(this,arguments)}}()),$=yield function Th(c){return Promise.all(c.map(function(){var o=(0,I.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return o.apply(this,arguments)}}()))}(L);p.ports[0].postMessage({status:"done",eventId:y,eventType:v,response:$})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function hn(c="",o=10){let a="";for(let l=0;l<o;l++)a+=Math.floor(10*Math.random());return c+a}class br{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,l=50){var p=this;return(0,I.Z)(function*(){const y="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let v,x;return new Promise((A,L)=>{const $=hn("",20);y.port1.start();const z=setTimeout(()=>{L(new Error("unsupported_event"))},l);x={messageChannel:y,onMessage(Oe){const Qe=Oe;if(Qe.data.eventId===$)switch(Qe.data.status){case"ack":clearTimeout(z),v=setTimeout(()=>{L(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),A(Qe.data.response);break;default:clearTimeout(z),clearTimeout(v),L(new Error("invalid_response"))}}},p.handlers.add(x),y.port1.addEventListener("message",x.onMessage),p.target.postMessage({eventType:o,eventId:$,data:a},[y.port2])}).finally(()=>{x&&p.removeMessageHandler(x)})})()}}function _e(){return window}function Ls(){return void 0!==_e().WorkerGlobalScope&&"function"==typeof _e().importScripts}function Un(){return(Un=(0,I.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const Ra="firebaseLocalStorageDb",Fs="firebaseLocalStorage",Ec="fbase_key";class Ii{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Tr(c,o){return c.transaction([Fs],o?"readwrite":"readonly").objectStore(Fs)}function wi(){const c=indexedDB.open(Ra,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(Fs,{keyPath:Ec})}catch(p){a(p)}}),c.addEventListener("success",(0,I.Z)(function*(){const l=c.result;l.objectStoreNames.contains(Fs)?o(l):(l.close(),yield function Tc(){const c=indexedDB.deleteDatabase(Ra);return new Ii(c).toPromise()}(),o(yield wi()))}))})}function Na(c,o,a){return vt.apply(this,arguments)}function vt(){return(vt=(0,I.Z)(function*(c,o,a){const l=Tr(c,!0).put({[Ec]:o,value:a});return new Ii(l).toPromise()})).apply(this,arguments)}function Us(){return(Us=(0,I.Z)(function*(c,o){const a=Tr(c,!1).get(o),l=yield new Ii(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Vs(c,o){const a=Tr(c,!0).delete(o);return new Ii(a).toPromise()}const Ht=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield wi()),a.db})()}_withRetries(a){var l=this;return(0,I.Z)(function*(){let p=0;for(;;)try{const y=yield l._openDb();return yield a(y)}catch(y){if(p++>3)throw y;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Ls()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){a.receiver=xh._getInstance(function ve(){return Ls()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,I.Z)(function*(p,y){return{keyProcessed:(yield a._poll()).includes(y.key)}});return function(p,y){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,I.Z)(function*(p,y){return["keyChanged"]});return function(p,y){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var l,p;if(a.activeServiceWorker=yield function Er(){return Un.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new br(a.activeServiceWorker);const y=yield a.sender._send("ping",{},800);!y||(null===(l=y[0])||void 0===l?void 0:l.fulfilled)&&(null===(p=y[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,I.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function kh(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield wi();return yield Na(a,Ps,"1"),yield Vs(a,Ps),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,I.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var p=this;return(0,I.Z)(function*(){return p._withPendingWrite((0,I.Z)(function*(){return yield p._withRetries(y=>Na(y,a,l)),p.localCache[a]=l,p.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=yield l._withRetries(y=>function xc(c,o){return Us.apply(this,arguments)}(y,a));return l.localCache[a]=p,p})()}_remove(a){var l=this;return(0,I.Z)(function*(){return l._withPendingWrite((0,I.Z)(function*(){return yield l._withRetries(p=>Vs(p,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const l=yield a._withRetries(v=>{const x=Tr(v,!1).getAll();return new Ii(x).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const p=[],y=new Set;for(const{fbase_key:v,value:x}of l)y.add(v),JSON.stringify(a.localCache[v])!==JSON.stringify(x)&&(a.notifyListeners(v,x),p.push(v));for(const v of Object.keys(a.localCache))a.localCache[v]&&!y.has(v)&&(a.notifyListeners(v,null),p.push(v));return p})()}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Sc(c,o){return Te(c,"POST","/v2/accounts/mfaSignIn:start",Se(c,o))}function Bs(){return(Bs=(0,I.Z)(function*(c){return(yield Te(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Oa(c){return new Promise((o,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=p=>{const y=Re("internal-error");y.customData=p,a(y)},l.type="text/javascript",l.charset="UTF-8",function kr(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function Ma(c){return`__${c}${Math.floor(1e6*Math.random())}`}const Ar=1e12;class Zs{constructor(o){this.auth=o,this.counter=Ar,this._widgets=new Map}render(o,a){const l=this.counter;return this._widgets.set(l,new Cc(o,this.auth.name,a||{})),this.counter++,l}reset(o){var a;const l=o||Ar;null===(a=this._widgets.get(l))||void 0===a||a.delete(),this._widgets.delete(l)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Ar))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var l;return null===(l=a._widgets.get(o||Ar))||void 0===l||l.execute(),""})()}}class Cc{constructor(o,a,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;D(p,"argument-error",{appName:a}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Dc(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(l){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(l){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Qt=Ma("rcb"),Rc=new ss(3e4,6e4);class Oc{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=_e().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return D(function Mc(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(_e().grecaptcha):new Promise((l,p)=>{const y=_e().setTimeout(()=>{p(Re(o,"network-request-failed"))},Rc.get());_e()[Qt]=()=>{_e().clearTimeout(y),delete _e()[Qt];const x=_e().grecaptcha;if(!x)return void p(Re(o,"internal-error"));const A=x.render;x.render=(L,$)=>{const z=A(L,$);return this.counter++,z},this.hostLanguage=a,l(x)},Oa(`https://www.google.com/recaptcha/api.js??${(0,R.xO)({onload:Qt,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(y),p(Re(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=_e().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Gs{load(o){return(0,I.Z)(function*(){return new Zs(o)})()}clearedOneInstance(){}}const tt="recaptcha",Pc={theme:"light",type:"image"};class Lc{constructor(o,a=Object.assign({},Pc),l){this.parameters=a,this.type=tt,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=se(l),this.isInvisible="invisible"===this.parameters.size,D("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;D(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Gs:new Oc,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(a)||new Promise(y=>{const v=x=>{!x||(o.tokenChangeListeners.delete(v),y(x))};o.tokenChangeListeners.add(v),o.isInvisible&&l.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){D(!this.parameters.sitekey,this.auth,"argument-error"),D(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),D("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(l=>l(a)),"function"==typeof o)o(a);else if("string"==typeof o){const l=_e()[o];"function"==typeof l&&l(a)}}}assertNotDestroyed(){D(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const l=document.createElement("div");a.appendChild(l),a=l}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){D(Wi()&&!Ls(),o.auth,"internal-error"),yield function bi(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function Sh(c){return Bs.apply(this,arguments)}(o.auth);D(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return D(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Fa{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=zt._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Sr(){return(Sr=(0,I.Z)(function*(c,o,a){const l=se(c),p=yield Vn(l,o,(0,R.m9)(a));return new Fa(p,y=>cr(l,y))})).apply(this,arguments)}function Ua(){return(Ua=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c);yield Pn(!1,l,"phone");const p=yield Vn(l.auth,o,(0,R.m9)(a));return new Fa(p,y=>fa(l,y))})).apply(this,arguments)}function Va(){return(Va=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c),p=yield Vn(l.auth,o,(0,R.m9)(a));return new Fa(p,y=>cc(l,y))})).apply(this,arguments)}function Vn(c,o,a){return qa.apply(this,arguments)}function qa(){return(qa=(0,I.Z)(function*(c,o,a){var l;const p=yield a.verify();try{let y;if(D("string"==typeof p,c,"argument-error"),D(a.type===tt,c,"argument-error"),y="string"==typeof o?{phoneNumber:o}:o,"session"in y){const v=y.session;if("phoneNumber"in y)return D("enroll"===v.type,c,"internal-error"),(yield _c(c,{idToken:v.credential,phoneEnrollmentInfo:{phoneNumber:y.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{D("signin"===v.type,c,"internal-error");const x=(null===(l=y.multiFactorHint)||void 0===l?void 0:l.uid)||y.multiFactorUid;return D(x,c,"missing-multi-factor-info"),(yield Sc(c,{mfaPendingCredential:v.credential,mfaEnrollmentId:x,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:v}=yield rr(c,{phoneNumber:y.phoneNumber,recaptchaToken:p});return v}}finally{a._reset()}})).apply(this,arguments)}function Ce(){return(Ce=(0,I.Z)(function*(c,o){yield Es((0,R.m9)(c),o)})).apply(this,arguments)}let Ct=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=se(a)}verifyPhoneNumber(a,l){return Vn(this.auth,a,(0,R.m9)(l))}static credential(a,l){return zt._fromVerification(a,l)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:l,temporaryProof:p}=a;return l&&p?zt._fromTokenResponse(l,p):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function nt(c,o){return o?fe(o):(D(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class Cr extends Dn{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return kt(o,this._buildIdpRequest())}_linkToIdToken(o,a){return kt(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return kt(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Rh(c){return uc(c.auth,new Cr(c),c.bypassAuthState)}function N(c){const{auth:o,user:a}=c;return D(a,o,"internal-error"),Ts(a,new Cr(c),c.bypassAuthState)}function ke(c){return Yt.apply(this,arguments)}function Yt(){return(Yt=(0,I.Z)(function*(c){const{auth:o,user:a}=c;return D(a,o,"internal-error"),Es(a,new Cr(c),c.bypassAuthState)})).apply(this,arguments)}class zs{constructor(o,a,l,p,y=!1){this.auth=o,this.resolver=l,this.user=p,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,I.Z)(function*(l,p){o.pendingPromise={resolve:l,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(y){o.reject(y)}});return function(l,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:l,sessionId:p,postBody:y,tenantId:v,error:x,type:A}=o;if(x)return void a.reject(x);const L={auth:a.auth,requestUri:l,sessionId:p,tenantId:v||void 0,postBody:y||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(A)(L))}catch($){a.reject($)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Rh;case"linkViaPopup":case"linkViaRedirect":return ke;case"reauthViaPopup":case"reauthViaRedirect":return N;default:ne(this.auth,"internal-error")}}resolve(o){Ze(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){Ze(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const U=new ss(2e3,1e4);function Ba(){return(Ba=(0,I.Z)(function*(c,o,a){const l=se(c);ii(c,o,$t);const p=nt(l,a);return new $s(l,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function E(){return(E=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c);ii(l.auth,o,$t);const p=nt(l.auth,a);return new $s(l.auth,"reauthViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}function Ae(){return(Ae=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c);ii(l.auth,o,$t);const p=nt(l.auth,a);return new $s(l.auth,"linkViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}let $s=(()=>{class c extends zs{constructor(a,l,p,y,v){super(a,l,y,v),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const l=yield a.execute();return D(l,a.auth,"internal-error"),l})()}onExecution(){var a=this;return(0,I.Z)(function*(){Ze(1===a.filter.length,"Popup operations only handle one event");const l=hn();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],l),a.authWindow.associatedEvent=l,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(Re(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Re(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var l,p;this.pollId=(null===(p=null===(l=this.authWindow)||void 0===l?void 0:l.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(Re(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,U.get())};a()}}return c.currentPopupAction=null,c})();const Dr=new Map;class Oh extends zs{constructor(o,a,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let l=Dr.get(a.auth._key());if(!l){try{const y=(yield function Mh(c,o){return Za.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;l=()=>Promise.resolve(y)}catch(p){l=()=>Promise.reject(p)}Dr.set(a.auth._key(),l)}return a.bypassAuthState||Dr.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,l=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(l,o);if("unknown"!==o.type){if(o.eventId){const p=yield l.auth._redirectUserForId(o.eventId);if(p)return l.user=p,a().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function Za(){return(Za=(0,I.Z)(function*(c,o){const a=W(o),l=$a(c);if(!(yield l._isAvailable()))return!1;const p="true"===(yield l._get(a));return yield l._remove(a),p})).apply(this,arguments)}function js(c,o){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,I.Z)(function*(c,o){return $a(c)._set(W(o),"true")})).apply(this,arguments)}function za(c,o){Dr.set(c._key(),o)}function $a(c){return fe(c._redirectPersistence)}function W(c){return si("pendingRedirect",c.config.apiKey,c.name)}function le(){return(le=(0,I.Z)(function*(c,o,a){const l=se(c);ii(c,o,$t);const p=nt(l,a);return yield js(p,l),p._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function X(){return(X=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c);ii(l.auth,o,$t);const p=nt(l.auth,a);yield js(p,l.auth);const y=yield Or(l);return p._openRedirect(l.auth,o,"reauthViaRedirect",y)})).apply(this,arguments)}function O(){return(O=(0,I.Z)(function*(c,o,a){const l=(0,R.m9)(c);ii(l.auth,o,$t);const p=nt(l.auth,a);yield Pn(!1,l,o.providerId),yield js(p,l.auth);const y=yield Or(l);return p._openRedirect(l.auth,o,"linkViaRedirect",y)})).apply(this,arguments)}function Nr(){return(Nr=(0,I.Z)(function*(c,o){return yield se(c)._initializationPromise,Dt(c,o,!1)})).apply(this,arguments)}function Dt(c,o){return ja.apply(this,arguments)}function ja(){return(ja=(0,I.Z)(function*(c,o,a=!1){const l=se(c),p=nt(l,o),v=yield new Oh(l,p,a).execute();return v&&!a&&(delete v.user._redirectEventId,yield l._persistUserIfCurrent(v.user),yield l._setRedirectUser(null,o)),v})).apply(this,arguments)}function Or(c){return Wa.apply(this,arguments)}function Wa(){return(Wa=(0,I.Z)(function*(c){const o=hn(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class Ka{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(a=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Qa(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return it(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var l;if(o.error&&!it(o)){const p=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(Re(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const l=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ha(o))}saveEventToCache(o){this.cachedEventUids.add(Ha(o)),this.lastProcessedEventTime=Date.now()}}function Ha(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function it({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Ya(c){return Ks.apply(this,arguments)}function Ks(){return(Ks=(0,I.Z)(function*(c,o={}){return Te(c,"GET","/v1/projects",o)})).apply(this,arguments)}const dn=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ja=/^https?/;function Ti(){return(Ti=(0,I.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Ya(c);for(const a of o)try{if(It(a))return}catch(l){}ne(c,"unauthorized-domain")})).apply(this,arguments)}function It(c){const o=rn(),{protocol:a,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const v=new URL(c);return""===v.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&v.hostname===l}if(!Ja.test(a))return!1;if(dn.test(c))return l===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(l)}const Lh=new ss(3e4,6e4);function xi(){const c=_e().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let Hs=null;function qn(c){return Hs=Hs||function fn(c){return new Promise((o,a)=>{var l,p,y;function v(){xi(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{xi(),a(Re(c,"network-request-failed"))},timeout:Lh.get()})}if(null===(p=null===(l=_e().gapi)||void 0===l?void 0:l.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(y=_e().gapi)||void 0===y?void 0:y.load)){const x=Ma("iframefcb");return _e()[x]=()=>{gapi.load?v():a(Re(c,"network-request-failed"))},Oa(`https://apis.google.com/js/api.js?onload=${x}`).catch(A=>a(A))}v()}}).catch(o=>{throw Hs=null,o})}(c),Hs}const qc=new ss(5e3,15e3),Uh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ot=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Vh(c){const o=c.config;D(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Uo(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:o.apiKey,appName:c.name,v:T.SDK_VERSION},p=ot.get(c.config.apiHost);p&&(l.eid=p);const y=c._getFrameworks();return y.length&&(l.fw=y.join(",")),`${a}?${(0,R.xO)(l).slice(1)}`}function Qs(){return Qs=(0,I.Z)(function*(c){const o=yield qn(c),a=_e().gapi;return D(a,c,"internal-error"),o.open({where:document.body,url:Vh(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Uh,dontclear:!0},l=>new Promise(function(){var p=(0,I.Z)(function*(y,v){yield l.restyle({setHideOnLeave:!1});const x=Re(c,"network-request-failed"),A=_e().setTimeout(()=>{v(x)},qc.get());function L(){_e().clearTimeout(A),y(l)}l.ping(L).then(L,()=>{v(x)})});return function(y,v){return p.apply(this,arguments)}}()))}),Qs.apply(this,arguments)}const Bn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Gc{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function Jt(c,o,a,l,p,y){D(c.config.authDomain,c,"auth-domain-config-required"),D(c.config.apiKey,c,"invalid-api-key");const v={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:T.SDK_VERSION,eventId:p};if(o instanceof $t){o.setDefaultLanguage(c.languageCode),v.providerId=o.providerId||"",(0,R.xb)(o.getCustomParameters())||(v.customParameters=JSON.stringify(o.getCustomParameters()));for(const[A,L]of Object.entries(y||{}))v[A]=L}if(o instanceof On){const A=o.getScopes().filter(L=>""!==L);A.length>0&&(v.scopes=A.join(","))}c.tenantId&&(v.tid=c.tenantId);const x=v;for(const A of Object.keys(x))void 0===x[A]&&delete x[A];return`${function eu({config:c}){return c.emulator?Uo(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,R.xO)(x).slice(1)}`}const Ys="webStorageSupport";class en extends class Js{constructor(o){this.factorId=o}_process(o,a,l){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,l);case"signin":return this._finalizeSignIn(o,a.credential);default:return et("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new en(o)}_finalizeEnroll(o,a,l){return function vc(c,o){return Te(c,"POST","/v2/accounts/mfaEnrollment:finalize",Se(c,o))}(o,{idToken:a,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function qs(c,o){return Te(c,"POST","/v2/accounts/mfaSignIn:finalize",Se(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Rt=(()=>{class c{constructor(){}static assertion(a){return en._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var ki="@firebase/auth";class zc{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(l=>{o((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){D(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Nt(){return window}function iu(){return(iu=(0,I.Z)(function*(c,o,a){var l;const{BuildInfo:p}=Nt();Ze(o.sessionId,"AuthEvent did not contain a session ID");const y=yield Hc(o.sessionId),v={};return j()?v.ibi=p.packageName:st()?v.apn=p.packageName:ne(c,"operation-not-supported-in-this-environment"),p.displayName&&(v.appDisplayName=p.displayName),v.sessionId=y,Jt(c,a,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,v)})).apply(this,arguments)}function Xs(){return(Xs=(0,I.Z)(function*(c){const{BuildInfo:o}=Nt(),a={};j()?a.iosBundleId=o.packageName:st()?a.androidPackageName=o.packageName:ne(c,"operation-not-supported-in-this-environment"),yield Ya(c,a)})).apply(this,arguments)}function eo(){return(eo=(0,I.Z)(function*(c,o,a){const{cordova:l}=Nt();let p=()=>{};try{yield new Promise((y,v)=>{let x=null;function A(){var z;y();const Oe=null===(z=l.plugins.browsertab)||void 0===z?void 0:z.close;"function"==typeof Oe&&Oe(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function L(){x||(x=window.setTimeout(()=>{v(Re(c,"redirect-cancelled-by-user"))},2e3))}function $(){"visible"===(null==document?void 0:document.visibilityState)&&L()}o.addPassiveListener(A),document.addEventListener("resume",L,!1),st()&&document.addEventListener("visibilitychange",$,!1),p=()=>{o.removePassiveListener(A),document.removeEventListener("resume",L,!1),document.removeEventListener("visibilitychange",$,!1),x&&window.clearTimeout(x)}})}finally{p()}})).apply(this,arguments)}function Hc(c){return Y.apply(this,arguments)}function Y(){return(Y=(0,I.Z)(function*(c){const o=ue(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function ue(c){if(Ze(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let l=0;l<c.length;l++)a[l]=c.charCodeAt(l);return a}(0,R.Pz)("authIdTokenMaxAge"),function tu(c){(0,T._registerComponent)(new ei.wA("auth",(o,{options:a})=>{const l=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:y,authDomain:v}=l.options;return((x,A)=>{D(y&&!y.includes(":"),"invalid-api-key",{appName:x.name}),D(!(null==v?void 0:v.includes(":")),"argument-error",{appName:x.name});const L={apiKey:y,authDomain:v,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:nc(c)},$=new dh(x,A,L);return function kn(c,o){const a=(null==o?void 0:o.persistence)||[],l=(Array.isArray(a)?a:[a]).map(fe);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}($,a),$})(l,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,l)=>{o.getProvider("auth-internal").initialize()})),(0,T._registerComponent)(new ei.wA("auth-internal",o=>{const a=se(o.getProvider("auth").getImmediate());return new zc(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,T.registerVersion)(ki,"0.21.0",function Ai(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,T.registerVersion)(ki,"0.21.0","esm2017")}("Browser");class ru extends Ka{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function su(c){return to.apply(this,arguments)}function to(){return(to=(0,I.Z)(function*(c){const o=yield ou()._get(au(c));return o&&(yield ou()._remove(au(c))),o})).apply(this,arguments)}function Xc(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const l=Math.floor(Math.random()*o.length);c.push(o.charAt(l))}return c.join("")}function ou(){return fe(wr)}function au(c){return si("authEvent",c.config.apiKey,c.name)}function no(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,R.zd)(a.join("?"))}function Gn(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Re("no-auth-event")}}function oe(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function zn(c=(0,R.z$)()){return!("file:"!==oe()&&"ionic:"!==oe()&&"capacitor:"!==oe()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function rl(){try{const c=self.localStorage,o=hn();if(c)return c.setItem(o,"1"),c.removeItem(o),!function de(c=(0,R.z$)()){return function qe(){return(0,R.w1)()&&11===(null==document?void 0:document.documentMode)}()||function il(c=(0,R.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,R.hl)()}catch(c){return Vr()&&(0,R.hl)()}return!1}function Vr(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function nn(){return(function nl(){return"http:"===oe()||"https:"===oe()}()||(0,R.ru)()||zn())&&!function at(){return(0,R.b$)()||(0,R.UG)()}()&&rl()&&!Vr()}function Di(){return zn()&&"undefined"!=typeof document}function Ri(){return(Ri=(0,I.Z)(function*(){return!!Di()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const rt={LOCAL:"local",NONE:"none",SESSION:"session"},ut=D,uu="persistence";function so(c){return qr.apply(this,arguments)}function qr(){return(qr=(0,I.Z)(function*(c){yield c._initializationPromise;const o=ao(),a=si(uu,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function ao(){var c;try{return(null===(c=function sl(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const $n=D;class Ee{constructor(){this.browserResolver=fe(class Fr{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=ln,this._completeRedirectFn=Dt,this._overrideRedirectResult=za}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){var v;Ze(null===(v=y.eventManagers[o._key()])||void 0===v?void 0:v.manager,"_initialize() not called before _openPopup()");const x=Jt(o,a,l,rn(),p);return function Ne(c,o,a,l=500,p=600){const y=Math.max((window.screen.availHeight-p)/2,0).toString(),v=Math.max((window.screen.availWidth-l)/2,0).toString();let x="";const A=Object.assign(Object.assign({},Bn),{width:l.toString(),height:p.toString(),top:y,left:v}),L=(0,R.z$)().toLowerCase();a&&(x=re(L)?"_blank":a),Qi(L)&&(o=o||"http://localhost",A.scrollbars="yes");const $=Object.entries(A).reduce((Oe,[Qe,po])=>`${Oe}${Qe}=${po},`,"");if(function hs(c=(0,R.z$)()){var o;return j(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(L)&&"_self"!==x)return function qh(c,o){const a=document.createElement("a");a.href=c,a.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(o||"",x),new Gc(null);const z=window.open(o||"",x,$);D(z,c,"popup-blocked");try{z.focus()}catch(Oe){}return new Gc(z)}(o,x,hn())})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y._originValidation(o),function Da(c){_e().location.href=c}(Jt(o,a,l,rn(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:y}=this.eventManagers[a];return p?Promise.resolve(p):(Ze(y,"If manager is not set, promise should be"),y)}const l=this.initAndGetManager(o);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const l=yield function pn(c){return Qs.apply(this,arguments)}(o),p=new Ka(o);return l.register("authEvent",y=>(D(null==y?void 0:y.authEvent,o,"invalid-auth-event"),{status:p.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=l,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Ys,{type:Ys},p=>{var y;const v=null===(y=null==p?void 0:p[0])||void 0===y?void 0:y[Ys];void 0!==v&&a(!!v),ne(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function b(c){return Ti.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return tc()||Tt()||j()}}),this.cordovaResolver=fe(class zh{constructor(){this._redirectPersistence=ln,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Dt,this._overrideRedirectResult=za}_initialize(o){var a=this;return(0,I.Z)(function*(){const l=o._key();let p=a.eventManagers.get(l);return p||(p=new ru(o),a.eventManagers.set(l,p),a.attachCallbackListeners(o,p)),p})()}_openPopup(o){ne(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){!function Kc(c){var o,a,l,p,y,v,x,A,L,$;const z=Nt();D("function"==typeof(null===(o=null==z?void 0:z.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),D(void 0!==(null===(a=null==z?void 0:z.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),D("function"==typeof(null===(y=null===(p=null===(l=null==z?void 0:z.cordova)||void 0===l?void 0:l.plugins)||void 0===p?void 0:p.browsertab)||void 0===y?void 0:y.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),D("function"==typeof(null===(A=null===(x=null===(v=null==z?void 0:z.cordova)||void 0===v?void 0:v.plugins)||void 0===x?void 0:x.browsertab)||void 0===A?void 0:A.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),D("function"==typeof(null===($=null===(L=null==z?void 0:z.cordova)||void 0===L?void 0:L.InAppBrowser)||void 0===$?void 0:$.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const v=yield y._initialize(o);yield v.initialized(),v.resetRedirect(),function bp(){Dr.clear()}(),yield y._originValidation(o);const x=function Qc(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Xc(),postBody:null,tenantId:c.tenantId,error:Re(c,"no-auth-event")}}(o,l,p);yield function Yc(c,o){return ou()._set(au(c),o)}(o,x);const A=yield function jc(c,o,a){return iu.apply(this,arguments)}(o,x,a),L=yield function Wc(c){const{cordova:o}=Nt();return new Promise(a=>{o.plugins.browsertab.isAvailable(l=>{let p=null;l?o.plugins.browsertab.openUrl(c):p=o.InAppBrowser.open(c,function ls(c=(0,R.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(p)})})}(A);return function gn(c,o,a){return eo.apply(this,arguments)}(o,v,L)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Zh(c){return Xs.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:l,handleOpenURL:p,BuildInfo:y}=Nt(),v=setTimeout((0,I.Z)(function*(){yield su(o),a.onEvent(Gn())}),500),x=function(){var $=(0,I.Z)(function*(z){clearTimeout(v);const Oe=yield su(o);let Qe=null;Oe&&(null==z?void 0:z.url)&&(Qe=function Jc(c,o){var a,l;const p=function el(c){const o=no(c),a=o.link?decodeURIComponent(o.link):void 0,l=no(a).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return no(p).link||p||l||a||c}(o);if(p.includes("/__/auth/callback")){const y=no(p),v=y.firebaseError?function Gh(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(y.firebaseError)):null,x=null===(l=null===(a=null==v?void 0:v.code)||void 0===a?void 0:a.split("auth/"))||void 0===l?void 0:l[1],A=x?Re(x):null;return A?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:A,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:p,postBody:null}}return null}(Oe,z.url)),a.onEvent(Qe||Gn())});return function(Oe){return $.apply(this,arguments)}}();void 0!==l&&"function"==typeof l.subscribe&&l.subscribe(null,x);const A=p,L=`${y.packageName.toLowerCase()}://`;Nt().handleOpenURL=function(){var $=(0,I.Z)(function*(z){if(z.toLowerCase().startsWith(L)&&x({url:z}),"function"==typeof A)try{A(z)}catch(Oe){console.error(Oe)}});return function(z){return $.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=ln,this._completeRedirectFn=Dt,this._overrideRedirectResult=za}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openPopup(o,a,l,p)})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openRedirect(o,a,l,p)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return Di()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return $n(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function ro(){return Ri.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function uo(c){return c.unwrap()}function Br(c){return lo(c)}function lo(c){const{_tokenResponse:o}=c instanceof R.ZR?c.customData:c;if(!o)return null;if(!(c instanceof R.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Ct.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let l;switch(a){case"google.com":l=aa;break;case"facebook.com":l=Is;break;case"github.com":l=sc;break;case"twitter.com":l=Fe;break;default:const{oauthIdToken:p,oauthAccessToken:y,oauthTokenSecret:v,pendingToken:x,nonce:A}=o;return y||v||p||x?x?a.startsWith("saml.")?un._create(a,x):At._fromParams({providerId:a,signInMethod:a,pendingToken:x,idToken:p,accessToken:y}):new Mn(a).credential({idToken:p,accessToken:y,rawNonce:A}):null}return c instanceof R.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function ze(c,o){return o.catch(a=>{throw a instanceof R.ZR&&function ol(c,o){var a;const l=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new Wh(c,function yc(c,o){var a;const l=(0,R.m9)(c),p=o;return D(o.customData.operationType,l,"argument-error"),D(null===(a=p.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,l,"argument-error"),St._fromError(l,p)}(c,o));else if(l){const p=lo(o),y=o;p&&(y.credential=p,y.tenantId=l.tenantId||void 0,y.email=l.email||void 0,y.phoneNumber=l.phoneNumber||void 0)}}(c,a),a}).then(a=>{const p=a.user;return{operationType:a.operationType,credential:Br(a),additionalUserInfo:pe(a),user:Ot.getOrCreate(p)}})}function ho(c,o){return fo.apply(this,arguments)}function fo(){return(fo=(0,I.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:l=>ze(c,a.confirm(l))}})).apply(this,arguments)}class Wh{constructor(o,a){this.resolver=a,this.auth=function co(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return ze(uo(this.auth),this.resolver.resolveSignIn(o))}}class Ot{constructor(o){this._delegate=o,this.multiFactor=function Ic(c){const o=(0,R.m9)(c);return ka.has(o)||ka.set(o,xa._fromUser(o)),ka.get(o)}(o)}static getOrCreate(o){return Ot.USER_MAP.has(o)||Ot.USER_MAP.set(o,new Ot(o)),Ot.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return ze(a.auth,fa(a._delegate,o))})()}linkWithPhoneNumber(o,a){var l=this;return(0,I.Z)(function*(){return ho(l.auth,function Dh(c,o,a){return Ua.apply(this,arguments)}(l._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return ze(a.auth,function S(c,o,a){return Ae.apply(this,arguments)}(a._delegate,o,Ee))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield so(se(a.auth)),function Ph(c,o,a){return function Ie(c,o,a){return O.apply(this,arguments)}(c,o,a)}(a._delegate,o,Ee)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return ze(a.auth,cc(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return ho(this.auth,function Fc(c,o,a){return Va.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return ze(this.auth,function P(c,o,a){return E.apply(this,arguments)}(this._delegate,o,Ee))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield so(se(a.auth)),function G(c,o,a){return function Rr(c,o,a){return X.apply(this,arguments)}(c,o,a)}(a._delegate,o,Ee)})()}sendEmailVerification(o){return function dc(c,o){return Rs.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function _h(c,o){return ar.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function ba(c,o){return pc((0,R.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function wh(c,o){return pc((0,R.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Uc(c,o){return Ce.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function _r(c,o){return Wt.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function Ih(c,o,a){return Fn.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ot.USER_MAP=new WeakMap;const Oi=D;let cu=(()=>{class c{constructor(a,l){if(this.app=a,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=a.options;Oi(p,"invalid-api-key",{appName:a.name}),Oi(p,"invalid-api-key",{appName:a.name});const y="undefined"!=typeof window?Ee:void 0;this._delegate=l.initialize({options:{persistence:Kh(p,a.name),popupRedirectResolver:y}}),this._delegate._updateErrorMap(ju),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ot.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,l){!function Le(c,o,a){const l=se(c);D(l._canInitEmulator,l,"emulator-config-failed"),D(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),y=Gt(o),{host:v,port:x}=function fh(c){const o=Gt(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(l);if(p){const y=p[1];return{host:y,port:Ko(l.substr(y.length+1))}}{const[y,v]=l.split(":");return{host:y,port:Ko(v)}}}(o);l.config.emulator={url:`${y}//${v}${null===x?"":`:${x}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:v,port:x,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function Ho(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,l)}applyActionCode(a){return function fr(c,o){return pi.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return ga(this._delegate,a)}confirmPasswordReset(a,l){return function He(c,o,a){return Ss.apply(this,arguments)}(this._delegate,a,l)}createUserWithEmailAndPassword(a,l){var p=this;return(0,I.Z)(function*(){return ze(p._delegate,function mr(c,o,a){return gr.apply(this,arguments)}(p._delegate,a,l))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function wa(c,o){return Ds.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function yr(c,o){const a=Nn.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){Oi(nn(),a._delegate,"operation-not-supported-in-this-environment");const l=yield function Ws(c,o){return Nr.apply(this,arguments)}(a._delegate,Ee);return l?ze(a._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function jh(c,o){se(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,l,p){const{next:y,error:v,complete:x}=Zr(a,l,p);return this._delegate.onAuthStateChanged(y,v,x)}onIdTokenChanged(a,l,p){const{next:y,error:v,complete:x}=Zr(a,l,p);return this._delegate.onIdTokenChanged(y,v,x)}sendSignInLinkToEmail(a,l){return function _a(c,o,a){return mi.apply(this,arguments)}(this._delegate,a,l)}sendPasswordResetEmail(a,l){return function dr(c,o,a){return As.apply(this,arguments)}(this._delegate,a,l||void 0)}setPersistence(a){var l=this;return(0,I.Z)(function*(){let p;switch(function Ni(c,o){ut(Object.values(rt).includes(o),c,"invalid-persistence-type"),(0,R.b$)()?ut(o!==rt.SESSION,c,"unsupported-persistence-type"):(0,R.UG)()?ut(o===rt.NONE,c,"unsupported-persistence-type"):Vr()?ut(o===rt.NONE||o===rt.LOCAL&&(0,R.hl)(),c,"unsupported-persistence-type"):ut(o===rt.NONE||rl(),c,"unsupported-persistence-type")}(l._delegate,a),a){case rt.SESSION:p=ln;break;case rt.LOCAL:p=(yield fe(Ht)._isAvailable())?Ht:wr;break;case rt.NONE:p=Ke;break;default:return ne("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return ze(this._delegate,function ac(c){return la.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return ze(this._delegate,cr(this._delegate,a))}signInWithCustomToken(a){return ze(this._delegate,function vh(c,o){return jt.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,l){return ze(this._delegate,function ya(c,o,a){return cr((0,R.m9)(c),vs.credential(o,a))}(this._delegate,a,l))}signInWithEmailLink(a,l){return ze(this._delegate,function hc(c,o,a){return va.apply(this,arguments)}(this._delegate,a,l))}signInWithPhoneNumber(a,l){return ho(this._delegate,function Ch(c,o,a){return Sr.apply(this,arguments)}(this._delegate,a,l))}signInWithPopup(a){var l=this;return(0,I.Z)(function*(){return Oi(nn(),l._delegate,"operation-not-supported-in-this-environment"),ze(l._delegate,function Z(c,o,a){return Ba.apply(this,arguments)}(l._delegate,a,Ee))})()}signInWithRedirect(a){var l=this;return(0,I.Z)(function*(){return Oi(nn(),l._delegate,"operation-not-supported-in-this-environment"),yield so(l._delegate),function Ei(c,o,a){return function Vc(c,o,a){return le.apply(this,arguments)}(c,o,a)}(l._delegate,a,Ee)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function lc(c,o){return Cs.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=rt,c})();function Zr(c,o,a){let l=c;"function"!=typeof c&&({next:l,error:o,complete:a}=c);const p=l;return{next:v=>p(v&&Ot.getOrCreate(v)),error:o,complete:a}}function Kh(c,o){const a=function oo(c,o){const a=ao();if(!a)return[];const l=si(uu,c,o);switch(a.getItem(l)){case rt.NONE:return[Ke];case rt.LOCAL:return[Ht,ln];case rt.SESSION:return[ln];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(Ht)&&a.push(Ht),"undefined"!=typeof window)for(const l of[wr,ln])a.includes(l)||a.push(l);return a.includes(Ke)||a.push(Ke),a}class lu{constructor(){this.providerId="phone",this._delegate=new Ct(uo(wt.Z.auth()))}static credential(o,a){return Ct.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}lu.PHONE_SIGN_IN_METHOD=Ct.PHONE_SIGN_IN_METHOD,lu.PROVIDER_ID=Ct.PROVIDER_ID;const al=D;class Mi{constructor(o,a,l=wt.Z.app()){var p;al(null===(p=l.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new Lc(o,a,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function ul(c){c.INTERNAL.registerComponent(new ei.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new cu(a,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:vs,FacebookAuthProvider:Is,GithubAuthProvider:sc,GoogleAuthProvider:aa,OAuthProvider:Mn,SAMLAuthProvider:xe,PhoneAuthProvider:lu,PhoneMultiFactorGenerator:Rt,RecaptchaVerifier:Mi,TwitterAuthProvider:Fe,Auth:cu,AuthCredential:Dn,Error:R.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.3.0")}(wt.Z)}}]);