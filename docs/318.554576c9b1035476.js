"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[318],{2318:($y,Fu,F)=>{F.r(Fu),F.d(Fu,{FieldModule:()=>Jw});var I=F(9298),St=F(1062),C=F(2705),x=F(5861);let qo=(()=>{class n{constructor(t){this.context=t}draw(){this.drawShape()}fromDiscreteX(t){return t*(this.context.canvas.width/n.FIELD_RESOLUTION)}fromDiscreteY(t){return t*(this.context.canvas.height/n.FIELD_RESOLUTION)}toDiscreteX(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.width)),n.FIELD_RESOLUTION))}toDiscreteY(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.height)),n.FIELD_RESOLUTION))}}return n.FIELD_RESOLUTION=9e3,n})();class Kr extends qo{constructor(e,t,r){super(t),this.actor=e,this.fieldPositions=r||new Map}toDto(){return{f:[...this.fieldPositions.entries()].map(([e,t])=>({x:Number(t.x.toFixed(0)).valueOf(),y:Number(t.y.toFixed(0)).valueOf(),u:e}))}}draw(){super.draw(),this.drawPosition(),this.drawActorName()}currentPosition(){return this.actor.position.rotate(this.rotationOffset)}setPosition(e,t){this.fieldPositions.set(this._rotationUUID,{x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}get x(){return this.fromDiscreteX(this.getFieldPosition().x)}get y(){return this.fromDiscreteY(this.getFieldPosition().y)}getFieldPosition(){return this.fieldPositions.get(this._rotationUUID)}setRotationProperties(e,t){const r=this._rotationUUID;if(this._rotationUUID=e,this.rotationOffset=t,0===this.fieldPositions.size)this.setPosition(this.context.canvas.width/2,this.context.canvas.height/2);else if(!this.fieldPositions.has(e)){const i=this.fieldPositions.get(r);this.setPosition(this.context.canvas.width*i.x,this.context.canvas.height*i.y)}}removeRotation(e){this.fieldPositions.delete(e)}}let lr=(()=>{class n extends Kr{constructor(t,r,i,s){super(t,r,s),this.dashed=i}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.fillStyle="red",this.context.fill(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+12)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.5*this.radius))}isHit(t,r){return t>=this.x-this.radius&&t<=this.x+this.radius&&r>=this.y-this.radius&&r<=this.y+this.radius}}return n.RELATIVE_RADIUS=.048,n.RADIUS_MAX=40,n})();var ot=(()=>{return(n=ot||(ot={})).Setter="Setter",n.MiddleBlocker="Middle blocker",n.Libero="Libero",n.OutsideHitter="Outside hitter",n.OppositeHitter="Opposite hitter",ot;var n})(),B=F(3075);class xn{constructor(e){if(e<1||e>6)throw new Error("Player position must be between 1 and 6.");this._position=e}get value(){return this._position}rotate(e){let r=this._position+(e._position-1);return r>6&&(r-=6),new xn(r)}}function Uu(n=5){let e="";for(;e.length<n;)e+=Math.random().toString(36).substring(2,7);return e.substring(0,n)}let kn=(()=>{class n extends Kr{constructor(t,r,i){super(t,r,i)}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.setLineDash([]),this.context.closePath(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y-10)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+this.radius/2))}isHit(t,r){return t>=this.x-this.radius&&t<=this.x+this.radius&&r>=this.y-this.radius&&r<=this.y}}return n.RELATIVE_RADIUS=.0576,n.RADIUS_MAX=50,n})(),ns=(()=>{class n extends Kr{constructor(t,r,i,s){super(t,r,s),this.dashed=i}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x-2,this.y+25)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle="red",this.context.fill()}isHit(t,r){return t>=this.x-this.size&&t<=this.x+this.size&&r>=this.y-this.size&&r<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class Bo extends qo{constructor(e,t){super(e),this.positions=null!=t?t:[]}addPosition(e,t){this.positions.push({x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}drawShape(){if(!(this.positions.length<=1)){this.context.beginPath(),this.context.moveTo(this.fromDiscreteX(this.positions[0].x),this.fromDiscreteY(this.positions[0].y));for(let e=1;e<this.positions.length;++e)this.context.lineTo(this.fromDiscreteX(this.positions[e].x),this.fromDiscreteY(this.positions[e].y));this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}}isHit(e,t){const r=this.toDiscreteX(e),i=this.toDiscreteY(t);let u=this.positions[0];for(let d=1;d<this.positions.length;++d){const f=this.positions[d];if(u.x<f.x){const m=u.x-2<=r&&f.x+2>=r;if(u.y<f.y){if(m&&u.y-2<=i&&f.y+2>=i)return!0}else if(m&&u.y+2>=i&&f.y-2<=i)return!0}else{const m=u.x+2>=r&&f.x-2<=r;if(u.y<f.y){if(m&&u.y-2<=i&&f.y+2>=i)return!0}else if(m&&u.y+2>=i&&f.y-2<=i)return!0}u=f}return!1}toDto(){return{f:Object.fromEntries(this.positions.reduce((e,t)=>(e.set(e.size,t),e),new Map))}}}class Vu{static fromActorDto(e,t,r){const i=new Map(t.f.map(s=>[s.u,{x:s.x,y:s.y}]));switch(e.player_role){case ot.Setter:return new kn(e,r,i);case ot.MiddleBlocker:case ot.Libero:return new ns(e,r,!1,i);case ot.OutsideHitter:return new lr(e,r,!1,i);case ot.OppositeHitter:return new lr(e,r,!0,i)}}static fromLineDto(e,t){const r=Math.max(...Object.keys(e.f).map(s=>Number(s))),i=[];for(let s=0;s<=r;++s)i.push({x:Number(e.f[s.toString()].x),y:Number(e.f[s.toString()].y)});return new Bo(t,i)}}class Hr{constructor(e,t,r,i,s){this.position=e,this.player_role=t,this.player_name=r,this._UUID=i||Uu(),s&&(this._shape=s)}get UUID(){return this._UUID}get shape(){return this._shape}static fromDto(e,t){const r=new Hr(new xn(e.p),e.pr,"NULL"===e.pn?void 0:e.pn,e.u),i=Vu.fromActorDto(r,e.s,t);return r.setShape(i),r}toDto(){var e;return{pn:null!==(e=this.player_name)&&void 0!==e?e:"NULL",pr:this.player_role,p:this.position.value,u:this.UUID,s:this.shape.toDto()}}setShape(e){this._shape=e}draw(){this.shape.draw()}toString(){return this.player_name?`${this.player_name} (${this.position.value}) - ${this.player_role.toString()}`:`Unnamed actor (${this.position.value}) - ${this.player_role.toString()}`}}var h=F(5e3),rs=F(9776),nn=F(7429),we=F(508),Se=F(226),ae=F(7579),qu=F(9770),gt=F(9646),Ke=F(9300),R=F(5698),He=F(8675),tt=F(925),at=F(9808),Y=F(1777),An=F(8255),is=F(1159),Sn=F(6360);function Zo(n,e){}class ss{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const Hl={dialogContainer:(0,Y.X$)("dialogContainer",[(0,Y.SB)("void, exit",(0,Y.oB)({opacity:0,transform:"scale(0.7)"})),(0,Y.SB)("enter",(0,Y.oB)({transform:"none"})),(0,Y.eR)("* => enter",(0,Y.ru)([(0,Y.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,Y.oB)({transform:"none",opacity:1})),(0,Y.IO)("@*",(0,Y.pV)(),{optional:!0})])),(0,Y.eR)("* => void, * => exit",(0,Y.ru)([(0,Y.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,Y.oB)({opacity:0})),(0,Y.IO)("@*",(0,Y.pV)(),{optional:!0})]))])};let Qr=(()=>{class n extends nn.en{constructor(t,r,i,s,u,d,f,m){super(),this._elementRef=t,this._focusTrapFactory=r,this._changeDetectorRef=i,this._config=u,this._interactivityChecker=d,this._ngZone=f,this._focusMonitor=m,this._animationStateChanged=new h.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=g=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(g)),this._ariaLabelledBy=u.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,tt.ht)())}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,r){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const i=()=>{t.removeEventListener("blur",i),t.removeEventListener("mousedown",i),t.removeAttribute("tabindex")};t.addEventListener("blur",i),t.addEventListener("mousedown",i)})),t.focus(r)}_focusByCssSelector(t,r){let i=this._elementRef.nativeElement.querySelector(t);i&&this._forceFocus(i,r)}_trapFocus(){const t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(r=>{r||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const r=(0,tt.ht)(),i=this._elementRef.nativeElement;(!r||r===this._document.body||r===i||i.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,r=(0,tt.ht)();return t===r||t.contains(r)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.SBq),h.Y36(An.qV),h.Y36(h.sBO),h.Y36(at.K0,8),h.Y36(ss),h.Y36(An.ic),h.Y36(h.R0b),h.Y36(An.tE))},n.\u0275dir=h.lG2({type:n,viewQuery:function(t,r){if(1&t&&h.Gf(nn.Pl,7),2&t){let i;h.iGM(i=h.CRH())&&(r._portalOutlet=i.first)}},features:[h.qOj]}),n})(),Go=(()=>{class n extends Qr{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:r}){"enter"===t?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:r}))}_onAnimationStart({toState:t,totalTime:r}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:r}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:r})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=h.n5z(n)))(r||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,r){1&t&&h.WFA("@dialogContainer.start",function(s){return r._onAnimationStart(s)})("@dialogContainer.done",function(s){return r._onAnimationDone(s)}),2&t&&(h.Ikx("id",r._id),h.uIk("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledBy)("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),h.d8E("@dialogContainer",r._state))},features:[h.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,r){1&t&&h.YNc(0,Zo,0,0,"ng-template",0)},directives:[nn.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[Hl.dialogContainer]}}),n})(),Bu=0;class rn{constructor(e,t,r="mat-dialog-"+Bu++){this._overlayRef=e,this._containerInstance=t,this.id=r,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new ae.x,this._afterClosed=new ae.x,this._beforeClosed=new ae.x,this._state=0,t._id=r,t._animationStateChanged.pipe((0,Ke.h)(i=>"opened"===i.state),(0,R.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,Ke.h)(i=>"closed"===i.state),(0,R.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),e.keydownEvents().pipe((0,Ke.h)(i=>i.keyCode===is.hY&&!this.disableClose&&!(0,is.Vb)(i))).subscribe(i=>{i.preventDefault(),Zu(this,"keyboard")}),e.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Zu(this,"mouse")})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe((0,Ke.h)(t=>"closing"===t.state),(0,R.q)(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(e){let t=this._getPositionStrategy();return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(e="",t=""){return this._overlayRef.updateSize({width:e,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(e){return this._overlayRef.addPanelClass(e),this}removePanelClass(e){return this._overlayRef.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Zu(n,e,t){return void 0!==n._containerInstance&&(n._containerInstance._closeInteractionType=e),n.close(t)}const ge=new h.OlP("MatDialogData"),Pe=new h.OlP("mat-dialog-default-options"),os=new h.OlP("mat-dialog-scroll-strategy"),qt={provide:os,deps:[rs.aV],useFactory:function $o(n){return()=>n.scrollStrategies.block()}};let jo=(()=>{class n{constructor(t,r,i,s,u,d,f,m,g,_){this._overlay=t,this._injector=r,this._defaultOptions=i,this._parentDialog=s,this._overlayContainer=u,this._dialogRefConstructor=f,this._dialogContainerType=m,this._dialogDataToken=g,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ae.x,this._afterOpenedAtThisLevel=new ae.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,qu.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,He.O)(void 0))),this._scrollStrategy=d}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,r){r=function Yl(n,e){return Object.assign(Object.assign({},e),n)}(r,this._defaultOptions||new ss),r.id&&this.getDialogById(r.id);const i=this._createOverlay(r),s=this._attachDialogContainer(i,r),u=this._attachDialogContent(t,s,i,r);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(u),u.afterClosed().subscribe(()=>this._removeOpenDialog(u)),this.afterOpened.next(u),s._initializeWithAttachedContent(),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(r=>r.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const r=this._getOverlayConfig(t);return this._overlay.create(r)}_getOverlayConfig(t){const r=new rs.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(r.backdropClass=t.backdropClass),r}_attachDialogContainer(t,r){const s=h.zs3.create({parent:r&&r.viewContainerRef&&r.viewContainerRef.injector||this._injector,providers:[{provide:ss,useValue:r}]}),u=new nn.C5(this._dialogContainerType,r.viewContainerRef,s,r.componentFactoryResolver);return t.attach(u).instance}_attachDialogContent(t,r,i,s){const u=new this._dialogRefConstructor(i,r,s.id);if(t instanceof h.Rgc)r.attachTemplatePortal(new nn.UE(t,null,{$implicit:s.data,dialogRef:u}));else{const d=this._createInjector(s,u,r),f=r.attachComponentPortal(new nn.C5(t,s.viewContainerRef,d,s.componentFactoryResolver));u.componentInstance=f.instance}return u.updateSize(s.width,s.height).updatePosition(s.position),u}_createInjector(t,r,i){const s=t&&t.viewContainerRef&&t.viewContainerRef.injector,u=[{provide:this._dialogContainerType,useValue:i},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:r}];return t.direction&&(!s||!s.get(Se.Is,null,h.XFs.Optional))&&u.push({provide:Se.Is,useValue:{value:t.direction,change:(0,gt.of)()}}),h.zs3.create({parent:s||this._injector,providers:u})}_removeOpenDialog(t){const r=this.openDialogs.indexOf(t);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((i,s)=>{i?s.setAttribute("aria-hidden",i):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const r=t.parentElement.children;for(let i=r.length-1;i>-1;i--){let s=r[i];s!==t&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let r=t.length;for(;r--;)t[r].close()}}return n.\u0275fac=function(t){h.$Z()},n.\u0275dir=h.lG2({type:n}),n})(),as=(()=>{class n extends jo{constructor(t,r,i,s,u,d,f,m){super(t,r,s,d,f,u,rn,Go,ge,m)}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(rs.aV),h.LFG(h.zs3),h.LFG(at.Ye,8),h.LFG(Pe,8),h.LFG(os),h.LFG(n,12),h.LFG(rs.Xj),h.LFG(Sn.Qb,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac}),n})(),Yr=0,sn=(()=>{class n{constructor(t,r,i){this._dialogRef=t,this._elementRef=r,this._dialog=i,this.id="mat-dialog-title-"+Yr++}ngOnInit(){this._dialogRef||(this._dialogRef=function Jl(n,e){let t=n.nativeElement.parentElement;for(;t&&!t.classList.contains("mat-dialog-container");)t=t.parentElement;return t?e.find(r=>r.id===t.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef._containerInstance;t&&!t._ariaLabelledBy&&(t._ariaLabelledBy=this.id)})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(rn,8),h.Y36(h.SBq),h.Y36(as))},n.\u0275dir=h.lG2({type:n,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-dialog-title"],hostVars:1,hostBindings:function(t,r){2&t&&h.Ikx("id",r.id)},inputs:{id:"id"},exportAs:["matDialogTitle"]}),n})(),hr=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=h.lG2({type:n,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-dialog-content"]}),n})(),zo=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({providers:[as,qt],imports:[[rs.U8,nn.eL,we.BQ],we.BQ]}),n})();var Ve=F(7322),Wo=F(7531),Jr=F(4107),Bt=F(7423);let Ko=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r,this.PlayerRole=ot}onSubmit(){this.dialogRef.close(new Hr(new xn(this.formGroup.value.position),this.formGroup.value.player_role,this.formGroup.value.player_name))}ngOnInit(){this.formGroup=this.fb.group({player_name:[null],position:[null,B.kI.required],player_role:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-add-actor-dialog"]],decls:50,vars:43,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","player_name"],["appearance","fill"],["formControlName","position"],[3,"value"],["formControlName","player_role"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"mat-form-field",4)(11,"mat-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"mat-select",5)(15,"mat-option",6),h._uU(16,"1"),h.qZA(),h.TgZ(17,"mat-option",6),h._uU(18,"2"),h.qZA(),h.TgZ(19,"mat-option",6),h._uU(20,"3"),h.qZA(),h.TgZ(21,"mat-option",6),h._uU(22,"4"),h.qZA(),h.TgZ(23,"mat-option",6),h._uU(24,"5"),h.qZA(),h.TgZ(25,"mat-option",6),h._uU(26,"6"),h.qZA()()(),h.TgZ(27,"mat-form-field",4)(28,"mat-label"),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"mat-select",7)(32,"mat-option",6),h._uU(33),h.ALo(34,"translate"),h.qZA(),h.TgZ(35,"mat-option",6),h._uU(36),h.ALo(37,"translate"),h.qZA(),h.TgZ(38,"mat-option",6),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"mat-option",6),h._uU(42),h.ALo(43,"translate"),h.qZA(),h.TgZ(44,"mat-option",6),h._uU(45),h.ALo(46,"translate"),h.qZA()()(),h.TgZ(47,"button",8),h._uU(48),h.ALo(49,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,23,"add_actor_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,25,"add_actor_dialog.placeholder.player_name")),h.xp6(5),h.Oqu(h.lcZ(13,27,"add_actor_dialog.placeholder.position")),h.xp6(3),h.Q6J("value",1),h.xp6(2),h.Q6J("value",2),h.xp6(2),h.Q6J("value",3),h.xp6(2),h.Q6J("value",4),h.xp6(2),h.Q6J("value",5),h.xp6(2),h.Q6J("value",6),h.xp6(4),h.Oqu(h.lcZ(30,29,"add_actor_dialog.placeholder.player_role")),h.xp6(3),h.Q6J("value",r.PlayerRole.Setter),h.xp6(1),h.Oqu(h.lcZ(34,31,"add_actor_dialog.player_roles.setter")),h.xp6(2),h.Q6J("value",r.PlayerRole.MiddleBlocker),h.xp6(1),h.Oqu(h.lcZ(37,33,"add_actor_dialog.player_roles.middle_blocker")),h.xp6(2),h.Q6J("value",r.PlayerRole.Libero),h.xp6(1),h.Oqu(h.lcZ(40,35,"add_actor_dialog.player_roles.libero")),h.xp6(2),h.Q6J("value",r.PlayerRole.OutsideHitter),h.xp6(1),h.Oqu(h.lcZ(43,37,"add_actor_dialog.player_roles.outside_hitter")),h.xp6(2),h.Q6J("value",r.PlayerRole.OppositeHitter),h.xp6(1),h.Oqu(h.lcZ(46,39,"add_actor_dialog.player_roles.opposite_hitter")),h.xp6(2),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(49,41,"add_actor_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Wo.Nt,B.Fj,B.JJ,B.u,Jr.gD,we.ey,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();function us(n,e){if(1&n&&(h.TgZ(0,"mat-option",6),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}let Xl=(()=>{class n{constructor(t,r,i){this.fb=t,this.dialogRef=r,this.data=i}onSubmit(){this.dialogRef.close(this.formGroup.value.actor)}ngOnInit(){this.formGroup=this.fb.group({actor:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn),h.Y36(ge))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-delete-actor-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","actor"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"mat-select",3),h.YNc(10,us,2,2,"mat-option",4),h.qZA()(),h.TgZ(11,"button",5),h._uU(12),h.ALo(13,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,6,"delete_actor_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,8,"delete_actor_dialog.placeholder.actor")),h.xp6(3),h.Q6J("ngForOf",r.data.actors),h.xp6(1),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(13,10,"delete_actor_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Jr.gD,B.JJ,B.u,at.sg,we.ey,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Qe{constructor(e,t,r,i){this.rotation=e,this.name=t,this._UUID=null!=r?r:Uu(),this._lines=null!=i?i:[]}get UUID(){return this._UUID}static fromDto(e,t){const r=new xn(e.r),i=e.l.map(s=>Vu.fromLineDto(s,t));return new Qe(r,"NULL"===e.n?void 0:e.n,e.u,i)}toDto(){var e;return{n:null!==(e=this.name)&&void 0!==e?e:"NULL",r:this.rotation.value,u:this.UUID,l:this._lines.map(t=>t.toDto())}}toString(){return this.name?`${this.name} (${this.rotation.value})`:`Unknown rotation (${this.rotation.value})`}addLine(e){this._lines.push(e)}draw(){this._lines.forEach(e=>e.draw())}removeIfHitLine(e,t){const r=this._lines.findIndex(i=>i.isHit(e,t));r<0||this._lines.splice(r,1)}}function Ho(n,e){if(1&n&&(h.TgZ(0,"mat-option",6),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}let eh=(()=>{class n{constructor(t,r,i){this.fb=t,this.dialogRef=r,this.data=i}onSubmit(){this.dialogRef.close(this.formGroup.value.rotation)}ngOnInit(){this.formGroup=this.fb.group({rotation:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn),h.Y36(ge))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-delete-rotation-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h.TgZ(9,"mat-select",3),h.YNc(10,Ho,2,2,"mat-option",4),h.qZA()(),h.TgZ(11,"button",5),h._uU(12),h.ALo(13,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,6,"delete_rotation_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,8,"delete_rotation_dialog.placeholder.rotation")),h.xp6(3),h.Q6J("ngForOf",r.data.rotations),h.xp6(1),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(13,10,"delete_rotation_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Jr.gD,B.JJ,B.u,at.sg,we.ey,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),th=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r}onSubmit(){this.dialogRef.close(new Qe(new xn(this.formGroup.value.current_rotation),this.formGroup.value.rotation_name))}ngOnInit(){this.formGroup=this.fb.group({rotation_name:null,current_rotation:[1,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-add-rotation-dialog"]],decls:30,vars:20,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","rotation_name"],["appearance","fill"],["formControlName","current_rotation"],[3,"value"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"mat-form-field",4)(11,"mat-label"),h._uU(12),h.ALo(13,"translate"),h.qZA(),h.TgZ(14,"mat-select",5)(15,"mat-option",6),h._uU(16,"1"),h.qZA(),h.TgZ(17,"mat-option",6),h._uU(18,"2"),h.qZA(),h.TgZ(19,"mat-option",6),h._uU(20,"3"),h.qZA(),h.TgZ(21,"mat-option",6),h._uU(22,"4"),h.qZA(),h.TgZ(23,"mat-option",6),h._uU(24,"5"),h.qZA(),h.TgZ(25,"mat-option",6),h._uU(26,"6"),h.qZA()()(),h.TgZ(27,"button",7),h._uU(28),h.ALo(29,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,12,"add_rotation_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,14,"add_rotation_dialog.placeholder.rotation_name")),h.xp6(5),h.Oqu(h.lcZ(13,16,"add_rotation_dialog.placeholder.current_rotation")),h.xp6(3),h.Q6J("value",1),h.xp6(2),h.Q6J("value",2),h.xp6(2),h.Q6J("value",3),h.xp6(2),h.Q6J("value",4),h.xp6(2),h.Q6J("value",5),h.xp6(2),h.Q6J("value",6),h.xp6(2),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(29,18,"add_rotation_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Wo.Nt,B.Fj,B.JJ,B.u,Jr.gD,we.ey,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Cn{static store(e,t){const r=JSON.stringify(t);window.localStorage.setItem(e,r)}static retrieve(e){const t=window.localStorage.getItem(e);if(t)return JSON.parse(t)}static remove(e){window.localStorage.removeItem(e)}}var dr=F(4968),Zt=F(8996),nh=F(4986),Xr=F(8306),$e=F(2122),rh=F(4482),ih=F(5403);function ei(){return(0,rh.e)((n,e)=>{let t,r=!1;n.subscribe((0,ih.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var V,Re=F(4004),Ct=F(5026),on=F(1884),Gt=F(2011),Dn=(F(9169),F(3942)),yt=F(9681),ni=F(4859),$t=F(1877),te=F(2090),$u="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Dt={},cs=cs||{},z=$u||self;function jt(){}function ls(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function ri(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var hs="closure_uid_"+(1e9*Math.random()>>>0),oh=0;function ju(n,e,t){return n.call.apply(n.bind,arguments)}function ah(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function je(n,e,t){return(je=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?ju:ah).apply(null,arguments)}function be(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function Le(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,i,s){for(var u=Array(arguments.length-2),d=2;d<arguments.length;d++)u[d-2]=arguments[d];return e.prototype[i].apply(r,u)}}function zt(){this.s=this.s,this.o=this.o}zt.prototype.s=!1,zt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function sh(n){Object.prototype.hasOwnProperty.call(n,hs)&&n[hs]||(n[hs]=++oh)}(this)},zt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Wu=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ds(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function Ku(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(ls(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let u=0;u<s;u++)n[i+u]=r[u]}else n.push(r)}}function Ee(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}Ee.prototype.h=function(){this.defaultPrevented=!0};var Hu=function(){if(!z.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{z.addEventListener("test",jt,e),z.removeEventListener("test",jt,e)}catch(t){}return n}();function fr(n){return/^[\s\xa0]*$/.test(n)}var Qo=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ii(n,e){return n<e?-1:n>e?1:0}function fs(){var n=z.navigator;return n&&(n=n.userAgent)?n:""}function _t(n){return-1!=fs().indexOf(n)}function Yo(n){return Yo[" "](n),n}Yo[" "]=jt;var pr,n,ps=_t("Opera"),an=_t("Trident")||_t("MSIE"),Qu=_t("Edge"),si=Qu||an,Yu=_t("Gecko")&&!(-1!=fs().toLowerCase().indexOf("webkit")&&!_t("Edge"))&&!(_t("Trident")||_t("MSIE"))&&!_t("Edge"),Xo=-1!=fs().toLowerCase().indexOf("webkit")&&!_t("Edge");function Ju(){var n=z.document;return n?n.documentMode:void 0}e:{var ea="",oi=(n=fs(),Yu?/rv:([^\);]+)(\)|;)/.exec(n):Qu?/Edge\/([\d\.]+)/.exec(n):an?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):Xo?/WebKit\/(\S+)/.exec(n):ps?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(oi&&(ea=oi?oi[1]:""),an){var ta=Ju();if(null!=ta&&ta>parseFloat(ea)){pr=String(ta);break e}}pr=ea}var na={};var Wt=z.document&&an&&(Ju()||parseInt(pr,10))||void 0;function Rn(n,e){if(Ee.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(Yu){e:{try{Yo(e.nodeName);var i=!0;break e}catch(s){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:ch[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&Rn.X.h.call(this)}}Le(Rn,Ee);var ch={2:"touch",3:"pen",4:"mouse"};Rn.prototype.h=function(){Rn.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var nt="closure_listenable_"+(1e6*Math.random()|0),lh=0;function ra(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=i,this.key=++lh,this.ba=this.ea=!1}function ms(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function ui(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function Xu(n){const e={};for(const t in n)e[t]=n[t];return e}const gs="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ec(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<gs.length;s++)t=gs[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function ys(n){this.src=n,this.g={},this.h=0}function ci(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Wu(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(ms(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function Kt(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==r)return i}return-1}ys.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=Kt(n,e,r,i);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new ra(e,this.src,s,!!r,i)).ea=t,n.push(e)),e};var ia="closure_lm_"+(1e6*Math.random()|0),sa={};function gr(n,e,t,r,i){if(r&&r.once)return Rt(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)gr(n,e[s],t,r,i);return null}return t=cn(t),n&&n[nt]?n.N(e,t,ri(r)?!!r.capture:!!r,i):hh(n,e,t,!1,r,i)}function hh(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var u=ri(i)?!!i.capture:!!i,d=_s(n);if(d||(n[ia]=d=new ys(n)),(t=d.add(e,t,r,u,s)).proxy)return t;if(r=function oa(){const e=tc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Hu||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(aa(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function Rt(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Rt(n,e[s],t,r,i);return null}return t=cn(t),n&&n[nt]?n.O(e,t,ri(r)?!!r.capture:!!r,i):hh(n,e,t,!0,r,i)}function Nn(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)Nn(n,e[s],t,r,i);else r=ri(r)?!!r.capture:!!r,t=cn(t),n&&n[nt]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=Kt(s=n.g[e],t,r,i))&&(ms(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=_s(n))&&(e=n.g[e.toString()],n=-1,e&&(n=Kt(e,t,r,i)),(t=-1<n?e[n]:null)&&un(t))}function un(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[nt])ci(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(aa(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=_s(e))?(ci(t,n),0==t.h&&(t.src=null,e[ia]=null)):ms(n)}}}function aa(n){return n in sa?sa[n]:sa[n]="on"+n}function tc(n,e){if(n.ba)n=!0;else{e=new Rn(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&un(n),n=t.call(r,e)}return n}function _s(n){return(n=n[ia])instanceof ys?n:null}var ua="__closure_events_fn_"+(1e9*Math.random()>>>0);function cn(n){return"function"==typeof n?n:(n[ua]||(n[ua]=function(e){return n.handleEvent(e)}),n[ua])}function Fe(){zt.call(this),this.i=new ys(this),this.P=this,this.I=null}function Ce(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new Ee(e,n);else if(e instanceof Ee)e.target=e.target||n;else{var i=e;ec(e=new Ee(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];i=li(u,r,!0,e)&&i}if(i=li(u=e.g=n,r,!0,e)&&i,i=li(u,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=li(u=e.g=t[s],r,!1,e)&&i}function li(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var d=u.listener,f=u.ha||u.src;u.ea&&ci(n.i,u),i=!1!==d.call(f,r)&&i}}return i&&!r.defaultPrevented}Le(Fe,zt),Fe.prototype[nt]=!0,Fe.prototype.removeEventListener=function(n,e,t,r){Nn(this,n,e,t,r)},Fe.prototype.M=function(){if(Fe.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)ms(t[r]);delete n.g[e],n.h--}}this.I=null},Fe.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},Fe.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var vs=z.JSON.stringify;function ca(){var n=ws;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Is,la=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new dh,n=>n.reset());class dh{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ha(n){z.setTimeout(()=>{throw n},0)}function hi(n,e){Is||function nc(){var n=z.Promise.resolve(void 0);Is=function(){n.then(fa)}}(),da||(Is(),da=!0),ws.add(n,e)}var da=!1,ws=new class vt{constructor(){this.h=this.g=null}add(e,t){const r=la.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function fa(){for(var n;n=ca();){try{n.h.call(n.g)}catch(t){ha(t)}var e=la;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}da=!1}function yr(n,e){Fe.call(this),this.h=n||1,this.g=e||z,this.j=je(this.lb,this),this.l=Date.now()}function _r(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function di(n,e,t){if("function"==typeof n)t&&(n=je(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=je(n.handleEvent,n)}return 2147483647<Number(e)?-1:z.setTimeout(n,e||0)}function pa(n){n.g=di(()=>{n.g=null,n.i&&(n.i=!1,pa(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Le(yr,Fe),(V=yr.prototype).ca=!1,V.R=null,V.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ce(this,"tick"),this.ca&&(_r(this),this.start()))}},V.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},V.M=function(){yr.X.M.call(this),_r(this),delete this.g};class ma extends zt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:pa(this)}M(){super.M(),this.g&&(z.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function vr(n){zt.call(this),this.h=n,this.g={}}Le(vr,zt);var bs=[];function fi(n,e,t,r){Array.isArray(t)||(t&&(bs[0]=t.toString()),t=bs);for(var i=0;i<t.length;i++){var s=gr(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function Es(n){ui(n.g,function(e,t){this.g.hasOwnProperty(t)&&un(e)},n),n.g={}}function pi(){this.g=!0}function ln(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function ya(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<i.length;u++)i[u]=""}}}return vs(t)}catch(d){return e}}(n,t)+(r?" "+r:"")})}vr.prototype.M=function(){vr.X.M.call(this),Es(this)},vr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pi.prototype.Aa=function(){this.g=!1},pi.prototype.info=function(){};var On={},Ts=null;function Mn(){return Ts=Ts||new Fe}function xs(n){Ee.call(this,On.Pa,n)}function hn(n){const e=Mn();Ce(e,new xs(e))}function ic(n,e){Ee.call(this,On.STAT_EVENT,n),this.stat=e}function qe(n){const e=Mn();Ce(e,new ic(e,n))}function sc(n,e){Ee.call(this,On.Qa,n),this.size=e}function Pn(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return z.setTimeout(function(){n()},e)}On.Pa="serverreachability",Le(xs,Ee),On.STAT_EVENT="statevent",Le(ic,Ee),On.Qa="timingevent",Le(sc,Ee);var ks={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},As={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function Ss(){}function oc(){}Ss.prototype.h=null;var va,Ln={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function _a(){Ee.call(this,"d")}function mi(){Ee.call(this,"c")}function Ds(){}function Fn(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new vr(this),this.O=ph,this.T=new yr(n=si?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ac}function ac(){this.i=null,this.g="",this.h=!1}Le(_a,Ee),Le(mi,Ee),Le(Ds,Ss),Ds.prototype.g=function(){return new XMLHttpRequest},Ds.prototype.i=function(){return{}},va=new Ds;var ph=45e3,gi={},Rs={};function yi(n,e,t){n.K=1,n.v=Us(Nt(e)),n.s=t,n.P=!0,uc(n,null)}function uc(n,e){n.F=Date.now(),_i(n),n.A=Nt(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),dc(t.i,"t",r),n.C=0,t=n.l.H,n.h=new ac,n.g=xc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new ma(je(n.La,n,n.g),n.N)),fi(n.S,n.g,"readystatechange",n.ib),e=n.H?Xu(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),hn(),function ga(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var u="",d=s.split("&"),f=0;f<d.length;f++){var m=d[f].split("=");if(1<m.length){var g=m[0];m=m[1];var _=g.split("_");u=2<=_.length&&"type"==_[1]?u+(g+"=")+m+"&":u+(g+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function Ns(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function cc(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=Ia(n,t),i==Rs){4==e&&(n.o=4,qe(14),r=!1),ln(n.j,n.m,null,"[Incomplete Response]");break}if(i==gi){n.o=4,qe(15),ln(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}ln(n.j,n.m,i,null),vi(n,i)}Ns(n)&&i!=Rs&&i!=gi&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,qe(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ra(e),e.K=!0,qe(11))):(ln(n.j,n.m,t,"[Invalid Chunked Response]"),Vn(n),Un(n))}function Ia(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Rs:(t=Number(e.substring(t,r)),isNaN(t)?gi:(r+=1)+t>e.length?Rs:(e=e.substr(r,t),n.C=r+t,e))}function _i(n){n.V=Date.now()+n.O,Os(n,n.O)}function Os(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=Pn(je(n.gb,n),e)}function Ms(n){n.B&&(z.clearTimeout(n.B),n.B=null)}function Un(n){0==n.l.G||n.I||bc(n.l,n)}function Vn(n){Ms(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,_r(n.T),Es(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function vi(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Ta(t.h,n)))if(!n.J&&Ta(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(m){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(t.u)t.Ba=i[1],0<t.Ba-t.T&&37500>i[2]&&t.L&&0==t.A&&!t.v&&(t.v=Pn(je(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;$n(t),Ca(t)}Hs(t),qe(18)}if(1>=Ea(t.h)&&t.ja){try{t.ja()}catch(m){}t.ja=void 0}}else jn(t,11)}else if((n.J||t.g==n)&&$n(t),!fr(e))for(i=t.Fa.g.parse(e),e=0;e<i.length;e++){let m=i[e];if(t.T=m[0],m=m[1],2==t.G)if("c"==m[0]){t.I=m[1],t.ka=m[2];const g=m[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const _=m[4];null!=_&&(t.Ca=_,t.j.info("SVER="+t.Ca));const w=m[5];null!=w&&"number"==typeof w&&0<w&&(t.J=r=1.5*w,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const k=n.g;if(k){const S=k.g?k.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.h;s.g||-1==S.indexOf("spdy")&&-1==S.indexOf("quic")&&-1==S.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(xa(s,s.h),s.h=null))}if(r.D){const P=k.g?k.g.getResponseHeader("X-HTTP-Session-Id"):null;P&&(r.za=P,he(r.F,r.D,P))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((r=t).sa=Tc(r,r.H?r.ka:null,r.V),u.J){fc(r.h,u);var d=u,f=r.J;f&&d.setTimeout(f),d.B&&(Ms(d),_i(d)),r.g=u}else Da(r);0<t.i.length&&Ks(t)}else"stop"!=m[0]&&"close"!=m[0]||jn(t,7);else 3==t.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?jn(t,7):Sa(t):"noop"!=m[0]&&t.l&&t.l.wa(m),t.A=0)}hn()}catch(m){}}function wa(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(ls(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function gh(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(ls(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function mh(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(ls(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(V=Fn.prototype).setTimeout=function(n){this.O=n},V.ib=function(n){n=n.target;const e=this.L;e&&3==Ot(n)?e.l():this.La(n)},V.La=function(n){try{if(n==this.g)e:{const g=Ot(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>g)&&(3!=g||si||this.g&&(this.h.h||this.g.fa()||Ws(this.g)))){this.I||4!=g||7==e||hn(),Ms(this);var t=this.g.aa();this.Y=t;t:if(Ns(this)){var r=Ws(this.g);n="";var i=r.length,s=4==Ot(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Vn(this),Un(this);var u="";break t}this.h.i=new z.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function rc(n,e,t,r,i,s,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var d,f=this.g;if((d=f.g?f.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!fr(d)){var m=d;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,qe(12),Vn(this),Un(this);break e}ln(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,vi(this,t)}this.P?(cc(this,g,u),si&&this.i&&3==g&&(fi(this.S,this.T,"tick",this.hb),this.T.start())):(ln(this.j,this.m,u,null),vi(this,u)),4==g&&Vn(this),this.i&&!this.I&&(4==g?bc(this.l,this):(this.i=!1,_i(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,qe(12)):(this.o=0,qe(13)),Vn(this),Un(this)}}}catch(g){}},V.hb=function(){if(this.g){var n=Ot(this.g),e=this.g.fa();this.C<e.length&&(Ms(this),cc(this,n,e),this.i&&4!=n&&_i(this))}},V.cancel=function(){this.I=!0,Vn(this)},V.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function fh(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(hn(),qe(17)),Vn(this),this.o=2,Un(this)):Os(this,this.V-n)};var Ps=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function It(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof It){this.h=void 0!==e?e:n.h,Ls(this,n.j),this.s=n.s,this.g=n.g,Fs(this,n.m),this.l=n.l,e=n.i;var t=new qn;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),lc(this,t),this.o=n.o}else n&&(t=String(n).match(Ps))?(this.h=!!e,Ls(this,t[1]||"",!0),this.s=Vs(t[2]||""),this.g=Vs(t[3]||"",!0),Fs(this,t[4]),this.l=Vs(t[5]||"",!0),lc(this,t[6]||"",!0),this.o=Vs(t[7]||"")):(this.h=!!e,this.i=new qn(null,this.h))}function Nt(n){return new It(n)}function Ls(n,e,t){n.j=t?Vs(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Fs(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function lc(n,e,t){e instanceof qn?(n.i=e,function Ih(n,e){e&&!n.j&&(rt(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(qs(this,r),dc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Ii(e,Ip)),n.i=new qn(e,n.h))}function he(n,e,t){n.i.set(e,t)}function Us(n){return he(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Vs(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ii(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,_h),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function _h(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}It.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ii(e,vh,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Ii(e,vh,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Ii(t,"/"==t.charAt(0)?vp:_p,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ii(t,wp)),n.join("")};var vh=/[#\/\?@]/g,_p=/[#\?:]/g,vp=/[#\?]/g,Ip=/[#\?@]/g,wp=/#/g;function qn(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function rt(n){n.g||(n.g=new Map,n.h=0,n.i&&function yh(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function qs(n,e){rt(n),e=Ir(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function hc(n,e){return rt(n),e=Ir(n,e),n.g.has(e)}function dc(n,e,t){qs(n,e),0<t.length&&(n.i=null,n.g.set(Ir(n,e),ds(t)),n.h+=t.length)}function Ir(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function Bs(n){this.l=n||wh,n=z.PerformanceNavigationTiming?0<(n=z.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(z.g&&z.g.Ga&&z.g.Ga()&&z.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(V=qn.prototype).add=function(n,e){rt(this),this.i=null,n=Ir(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},V.forEach=function(n,e){rt(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},V.oa=function(){rt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},V.W=function(n){rt(this);let e=[];if("string"==typeof n)hc(this,n)&&(e=e.concat(this.g.get(Ir(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},V.set=function(n,e){return rt(this),this.i=null,hc(this,n=Ir(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},V.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},V.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),u=this.W(r);for(r=0;r<u.length;r++){var i=s;""!==u[r]&&(i+="="+encodeURIComponent(String(u[r]))),n.push(i)}}return this.i=n.join("&")};var wh=10;function wi(n){return!!n.h||!!n.g&&n.g.size>=n.j}function Ea(n){return n.h?1:n.g?n.g.size:0}function Ta(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function xa(n,e){n.g?n.g.add(e):n.h=e}function fc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function bh(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return ds(n.i)}function wr(){}function bp(){this.g=new wr}function dn(n,e,t){const r=t||"";try{wa(n,function(i,s){let u=i;ri(i)&&(u=vs(i)),e.push(r+s+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Zs(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(s){}}function Ht(n){this.l=n.ac||null,this.j=n.jb||!1}function Gs(n,e){Fe.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Te,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Bs.prototype.cancel=function(){if(this.i=bh(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},wr.prototype.stringify=function(n){return z.JSON.stringify(n,void 0)},wr.prototype.parse=function(n){return z.JSON.parse(n,void 0)},Le(Ht,Ss),Ht.prototype.g=function(){return new Gs(this.l,this.j)},Ht.prototype.i=function(n){return function(){return n}}({}),Le(Gs,Fe);var Te=0;function pc(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Bn(n){n.readyState=4,n.l=null,n.j=null,n.A=null,bi(n)}function bi(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(V=Gs.prototype).open=function(n,e){if(this.readyState!=Te)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,bi(this)},V.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||z).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},V.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Bn(this)),this.readyState=Te},V.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,bi(this)),this.g&&(this.readyState=3,bi(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==z.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;pc(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},V.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Bn(this):bi(this),3==this.readyState&&pc(this)}},V.Va=function(n){this.g&&(this.response=this.responseText=n,Bn(this))},V.Ua=function(n){this.g&&(this.response=n,Bn(this))},V.ga=function(){this.g&&Bn(this)},V.setRequestHeader=function(n,e){this.v.append(n,e)},V.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},V.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(Gs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var ka=z.JSON.parse;function ye(n){Fe.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=mc,this.K=this.L=!1}Le(ye,Fe);var mc="",gc=/^https?$/i,Th=["POST","PUT"];function Aa(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,br(n),js(n)}function br(n){n.D||(n.D=!0,Ce(n,"complete"),Ce(n,"error"))}function Ei(n){if(n.h&&void 0!==cs&&(!n.C[1]||4!=Ot(n)||2!=n.aa()))if(n.v&&4==Ot(n))di(n.Ha,0,n);else if(Ce(n,"readystatechange"),4==Ot(n)){n.h=!1;try{const d=n.aa();e:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===d){var i=String(n.H).match(Ps)[1]||null;if(!i&&z.self&&z.self.location){var s=z.self.location.protocol;i=s.substr(0,s.length-1)}r=!gc.test(i?i.toLowerCase():"")}t=r}if(t)Ce(n,"complete"),Ce(n,"success");else{n.m=6;try{var u=2<Ot(n)?n.g.statusText:""}catch(f){u=""}n.j=u+" ["+n.aa()+"]",br(n)}}finally{js(n)}}}function js(n,e){if(n.g){zs(n);const t=n.g,r=n.C[0]?jt:null;n.g=null,n.C=null,e||Ce(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function zs(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(z.clearTimeout(n.A),n.A=null)}function Ot(n){return n.g?n.g.readyState:0}function Ws(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case mc:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function yc(n){let e="";return ui(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Ti(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=yc(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):he(n,e,t))}function Er(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function _c(n){this.Ca=0,this.i=[],this.j=new pi,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Er("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Er("baseRetryDelayMs",5e3,n),this.bb=Er("retryDelaySeedMs",1e4,n),this.$a=Er("forwardChannelMaxRetries",2,n),this.ta=Er("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new Bs(n&&n.concurrentRequestLimit),this.Fa=new bp,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Sa(n){if(Zn(n),3==n.G){var e=n.U++,t=Nt(n.F);he(t,"SID",n.I),he(t,"RID",e),he(t,"TYPE","terminate"),Gn(n,t),(e=new Fn(n,n.j,e,void 0)).K=2,e.v=Us(Nt(t)),t=!1,z.navigator&&z.navigator.sendBeacon&&(t=z.navigator.sendBeacon(e.v.toString(),"")),!t&&z.Image&&((new Image).src=e.v,t=!0),t||(e.g=xc(e.l,null),e.g.da(e.v)),e.F=Date.now(),_i(e)}Qs(n)}function Ca(n){n.g&&(Ra(n),n.g.cancel(),n.g=null)}function Zn(n){Ca(n),n.u&&(z.clearTimeout(n.u),n.u=null),$n(n),n.h.cancel(),n.m&&("number"==typeof n.m&&z.clearTimeout(n.m),n.m=null)}function Ks(n){wi(n.h)||n.m||(n.m=!0,hi(n.Ja,n),n.C=0)}function vc(n,e){var t;t=e?e.m:n.U++;const r=Nt(n.F);he(r,"SID",n.I),he(r,"RID",t),he(r,"AID",n.T),Gn(n,r),n.o&&n.s&&Ti(r,n.o,n.s),t=new Fn(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Ic(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),xa(n.h,t),yi(t,r,e)}function Gn(n,e){n.ia&&ui(n.ia,function(t,r){he(e,r,t)}),n.l&&wa({},function(t,r){he(e,r,t)})}function Ic(n,e,t){t=Math.min(n.i.length,t);var r=n.l?je(n.l.Ra,n.l,n):null;e:{var i=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=i[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let d=!0;for(let f=0;f<t;f++){let m=i[f].h;const g=i[f].g;if(m-=s,0>m)s=Math.max(0,i[f].h-100),d=!1;else try{dn(g,u,"req"+m+"_")}catch(_){r&&r(g)}}if(d){r=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function Da(n){n.g||n.u||(n.Z=1,hi(n.Ia,n),n.A=0)}function Hs(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=Pn(je(n.Ia,n),Ec(n,n.A)),n.A++,0))}function Ra(n){null!=n.B&&(z.clearTimeout(n.B),n.B=null)}function wc(n){n.g=new Fn(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=Nt(n.sa);he(e,"RID","rpc"),he(e,"SID",n.I),he(e,"CI",n.L?"0":"1"),he(e,"AID",n.T),he(e,"TYPE","xmlhttp"),Gn(n,e),n.o&&n.s&&Ti(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Us(Nt(e)),t.s=null,t.P=!0,uc(t,n)}function $n(n){null!=n.v&&(z.clearTimeout(n.v),n.v=null)}function bc(n,e){var t=null;if(n.g==e){$n(n),Ra(n),n.g=null;var r=2}else{if(!Ta(n.h,e))return;t=e.D,fc(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;Ce(r=Mn(),new sc(r,t)),Ks(n)}else Da(n);else if(3==(i=e.o)||0==i&&0<n.pa||!(1==r&&function xh(n,e){return!(Ea(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=Pn(je(n.Ja,n,e),Ec(n,n.C)),n.C++,0)))}(n,e)||2==r&&Hs(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),i){case 1:jn(n,5);break;case 4:jn(n,10);break;case 3:jn(n,6);break;default:jn(n,2)}}function Ec(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function jn(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=je(n.kb,n);t||(t=new It("//www.google.com/images/cleardot.gif"),z.location&&"http"==z.location.protocol||Ls(t,"https"),Us(t)),function Eh(n,e){const t=new pi;if(z.Image){const r=new Image;r.onload=be(Zs,t,r,"TestLoadImage: loaded",!0,e),r.onerror=be(Zs,t,r,"TestLoadImage: error",!1,e),r.onabort=be(Zs,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=be(Zs,t,r,"TestLoadImage: timeout",!1,e),z.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else qe(2);n.G=0,n.l&&n.l.va(e),Qs(n),Zn(n)}function Qs(n){if(n.G=0,n.la=[],n.l){const e=bh(n.h);(0!=e.length||0!=n.i.length)&&(Ku(n.la,e),Ku(n.la,n.i),n.h.i.length=0,ds(n.i),n.i.length=0),n.l.ua()}}function Tc(n,e,t){var r=t instanceof It?Nt(t):new It(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Fs(r,r.m);else{var i=z.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new It(null,void 0);r&&Ls(s,r),e&&(s.g=e),i&&Fs(s,i),t&&(s.l=t),r=s}return e=n.za,(t=n.D)&&e&&he(r,t,e),he(r,"VER",n.ma),Gn(n,r),r}function xc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ye(t&&n.Da&&!n.ra?new Ht({jb:!0}):n.ra)).Ka(n.H),e}function kc(){}function Ys(){if(an&&!(10<=Number(Wt)))throw Error("Environmental error: no available transport.")}function ut(n,e){Fe.call(this),this.g=new _c(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!fr(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!fr(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Tr(this)}function Na(n){_a.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Ac(){mi.call(this),this.status=1}function Tr(n){this.g=n}(V=ye.prototype).Ka=function(n){this.L=n},V.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():va.g(),this.C=function Cs(n){return n.h||(n.h=n.i())}(this.u?this.u:va),this.g.onreadystatechange=je(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Aa(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=z.FormData&&n instanceof z.FormData,!(0<=Wu(Th,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{zs(this),0<this.B&&((this.K=function $s(n){return an&&function uh(){return function Jo(n){var e=na;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=Qo(String(pr)).split("."),t=Qo("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",s=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;n=ii(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||ii(0==i[2].length,0==s[2].length)||ii(i[2],s[2]),i=i[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=je(this.qa,this)):this.A=di(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Aa(this,s)}},V.qa=function(){void 0!==cs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ce(this,"timeout"),this.abort(8))},V.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ce(this,"complete"),Ce(this,"abort"),js(this))},V.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),js(this,!0)),ye.X.M.call(this)},V.Ha=function(){this.s||(this.F||this.v||this.l?Ei(this):this.fb())},V.fb=function(){Ei(this)},V.aa=function(){try{return 2<Ot(this)?this.g.status:-1}catch(n){return-1}},V.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},V.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),ka(e)}},V.Ea=function(){return this.m},V.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(V=_c.prototype).ma=8,V.G=1,V.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const i=new Fn(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=Xu(s),ec(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Ic(this,i,e),he(t=Nt(this.F),"RID",n),he(t,"CVER",22),this.D&&he(t,"X-HTTP-Session-Id",this.D),Gn(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(yc(s)))+"&"+e:this.o&&Ti(t,this.o,s)),xa(this.h,i),this.Ya&&he(t,"TYPE","init"),this.O?(he(t,"$req",e),he(t,"SID","null"),i.Z=!0,yi(i,t,null)):yi(i,t,e),this.G=2}}else 3==this.G&&(n?vc(this,n):0==this.i.length||wi(this.h)||vc(this))},V.Ia=function(){if(this.u=null,wc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=Pn(je(this.eb,this),n)}},V.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,qe(10),Ca(this),wc(this))},V.cb=function(){null!=this.v&&(this.v=null,Ca(this),Hs(this),qe(19))},V.kb=function(n){n?(this.j.info("Successfully pinged google.com"),qe(2)):(this.j.info("Failed to ping google.com"),qe(1))},(V=kc.prototype).xa=function(){},V.wa=function(){},V.va=function(){},V.ua=function(){},V.Ra=function(){},Ys.prototype.g=function(n,e){return new ut(n,e)},Le(ut,Fe),ut.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;qe(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Tc(n,null,n.V),Ks(n)},ut.prototype.close=function(){Sa(this.g)},ut.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=vs(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&Ks(e)},ut.prototype.M=function(){this.g.l=null,delete this.j,Sa(this.g),delete this.g,ut.X.M.call(this)},Le(Na,_a),Le(Ac,mi),Le(Tr,kc),Tr.prototype.xa=function(){Ce(this.g,"a")},Tr.prototype.wa=function(n){Ce(this.g,new Na(n))},Tr.prototype.va=function(n){Ce(this.g,new Ac)},Tr.prototype.ua=function(){Ce(this.g,"b")},Ys.prototype.createWebChannel=Ys.prototype.g,ut.prototype.send=ut.prototype.u,ut.prototype.open=ut.prototype.m,ut.prototype.close=ut.prototype.close,ks.NO_ERROR=0,ks.TIMEOUT=8,ks.HTTP_ERROR=6,As.COMPLETE="complete",oc.EventType=Ln,Ln.OPEN="a",Ln.CLOSE="b",Ln.ERROR="c",Ln.MESSAGE="d",Fe.prototype.listen=Fe.prototype.N,ye.prototype.listenOnce=ye.prototype.O,ye.prototype.getLastError=ye.prototype.Oa,ye.prototype.getLastErrorCode=ye.prototype.Ea,ye.prototype.getStatus=ye.prototype.aa,ye.prototype.getResponseJson=ye.prototype.Sa,ye.prototype.getResponseText=ye.prototype.fa,ye.prototype.send=ye.prototype.da,ye.prototype.setWithCredentials=ye.prototype.Ka;var kh=Dt.createWebChannelTransport=function(){return new Ys},Oa=Dt.getStatEventTarget=function(){return Mn()},Ma=Dt.ErrorCode=ks,Pa=Dt.EventType=As,Ah=Dt.Event=On,Js=Dt.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Sh=Dt.FetchXmlHttpFactory=Ht,xr=Dt.WebChannel=oc,Xs=Dt.XhrIo=ye;const eo="@firebase/firestore";class Ue{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ue.UNAUTHENTICATED=new Ue(null),Ue.GOOGLE_CREDENTIALS=new Ue("google-credentials-uid"),Ue.FIRST_PARTY=new Ue("first-party-uid"),Ue.MOCK_USER=new Ue("mock-user");let fn="9.15.0";const wt=new $t.Yd("@firebase/firestore");function Qt(){return wt.logLevel}function D(n,...e){if(wt.logLevel<=$t.in.DEBUG){const t=e.map(xi);wt.debug(`Firestore (${fn}): ${n}`,...t)}}function xe(n,...e){if(wt.logLevel<=$t.in.ERROR){const t=e.map(xi);wt.error(`Firestore (${fn}): ${n}`,...t)}}function zn(n,...e){if(wt.logLevel<=$t.in.WARN){const t=e.map(xi);wt.warn(`Firestore (${fn}): ${n}`,...t)}}function xi(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function U(n="Unexpected state"){const e=`FIRESTORE (${fn}) INTERNAL ASSERTION FAILED: `+n;throw xe(e),new Error(e)}function Z(n,e){n||U()}function O(n,e){return n}const T={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends te.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ne{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class to{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Fa{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ue.UNAUTHENTICATED))}shutdown(){}}class Dh{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class ki{constructor(e){this.t=e,this.currentUser=Ue.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let u=new Ne;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Ne,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const m=u;e.enqueueRetryable((0,x.Z)(function*(){yield m.promise,yield s(r.currentUser)}))},f=m=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Ne)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Z("string"==typeof r.accessToken),new to(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return Z(null===e||"string"==typeof e),new Ue(e)}}class Rh{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i,this.type="FirstParty",this.user=Ue.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(Z(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Nh{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i}getToken(){return Promise.resolve(new Rh(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Ue.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class no{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Ua{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=s=>{null!=s.error&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,D("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(Z("string"==typeof t.token),this.A=t.token,new no(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Oh(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class ro{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Oh(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function W(n,e){return n<e?-1:n>e?1:0}function Wn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Cc(n){return n+"\0"}class de{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(T.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(T.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return de.fromMillis(Date.now())}static fromDate(e){return de.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new de(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class G{constructor(e){this.timestamp=e}static fromTimestamp(e){return new G(e)}static min(){return new G(new de(0,0))}static max(){return new G(new de(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Ai{constructor(e,t,r){void 0===t?t=0:t>e.length&&U(),void 0===r?r=e.length-t:r>e.length-t&&U(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Ai.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Ai?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),u=t.get(i);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ne extends Ai{construct(e,t,r){return new ne(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new A(T.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ne(t)}static emptyPath(){return new ne([])}}const Va=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class _e extends Ai{construct(e,t,r){return new _e(e,t,r)}static isValidIdentifier(e){return Va.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),_e.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new _e(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new A(T.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const d=e[i];if("\\"===d){if(i+1===e.length)throw new A(T.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new A(T.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,i+=2}else"`"===d?(u=!u,i++):"."!==d||u?(r+=d,i++):(s(),i++)}if(s(),u)throw new A(T.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new _e(t)}static emptyPath(){return new _e([])}}class M{constructor(e){this.path=e}static fromPath(e){return new M(ne.fromString(e))}static fromName(e){return new M(ne.fromString(e).popFirst(5))}static empty(){return new M(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new M(new ne(e.slice()))}}class kr{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function qa(n){return n.fields.find(e=>2===e.kind)}function Yt(n){return n.fields.filter(e=>2!==e.kind)}kr.UNKNOWN_ID=-1;class Ar{constructor(e,t){this.fieldPath=e,this.kind=t}}class Kn{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Kn(0,it.min())}}function Rc(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=G.fromTimestamp(1e9===r?new de(t+1,0):new de(t,r));return new it(i,M.empty(),e)}function Ba(n){return new it(n.readTime,n.key,-1)}class it{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new it(G.min(),M.empty(),-1)}static max(){return new it(G.max(),M.empty(),-1)}}function so(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=M.comparator(n.documentKey,e.documentKey),0!==t?t:W(n.largestBatchId,e.largestBatchId))}const Nc="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Za{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Mt(n){return Ga.apply(this,arguments)}function Ga(){return Ga=(0,x.Z)(function*(n){if(n.code!==T.FAILED_PRECONDITION||n.message!==Nc)throw n;D("LocalStore","Unexpectedly lost primary lease")}),Ga.apply(this,arguments)}class E{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new E((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof E?t:E.resolve(t)}catch(t){return E.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):E.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):E.reject(t)}static resolve(e){return new E((t,r)=>{t(e)})}static reject(e){return new E((t,r)=>{r(e)})}static waitFor(e){return new E((t,r)=>{let i=0,s=0,u=!1;e.forEach(d=>{++i,d.next(()=>{++s,u&&s===i&&t()},f=>r(f))}),u=!0,s===i&&t()})}static or(e){let t=E.resolve(!1);for(const r of e)t=t.next(i=>i?E.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new E((r,i)=>{const s=e.length,u=new Array(s);let d=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(g=>{u[m]=g,++d,d===s&&r(u)},g=>i(g))}})}static doWhile(e,t){return new E((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class oo{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Ne,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Si(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=$a(r.target.error);this.P.reject(new Si(e,i))}}static open(e,t,r,i){try{return new oo(t,e.transaction(i,r))}catch(s){throw new Si(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(D("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Ph(t)}}class ct{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===ct.D((0,te.z$)())&&xe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return D("SimpleDb","Removing database:",e),Pt(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,te.hl)())return!1;if(ct.N())return!0;const e=(0,te.z$)(),t=ct.D(e),r=0<t&&t<10,i=ct.k(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,x.Z)(function*(){return t.db||(D("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{r(u.target.result)},s.onblocked=()=>{i(new Si(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const d=u.target.error;i("VersionError"===d.name?new A(T.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new A(T.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new Si(e,d))},s.onupgradeneeded=u=>{D("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{D("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,x.Z)(function*(){const u="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.F(e);const f=oo.open(s.db,e,u?"readonly":"readwrite",r),m=i(f).next(g=>(f.V(),g)).catch(g=>(f.abort(g),E.reject(g))).toPromise();return m.catch(()=>{}),yield f.v,m}catch(f){const m=f,g="FirebaseError"!==m.name&&d<3;if(D("SimpleDb","Transaction failed with error:",m.message,"Retrying:",g),s.close(),!g)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Mh{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Pt(this.q.delete())}}class Si extends A{constructor(e,t){super(T.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function Jt(n){return"IndexedDbTransactionError"===n.name}class Ph{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(D("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Pt(r)}add(e){return D("SimpleDb","ADD",this.store.name,e,e),Pt(this.store.add(e))}get(e){return Pt(this.store.get(e)).next(t=>(void 0===t&&(t=null),D("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return D("SimpleDb","DELETE",this.store.name,e),Pt(this.store.delete(e))}count(){return D("SimpleDb","COUNT",this.store.name),Pt(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.H(i,(u,d)=>{s.push(d)}).next(()=>s)}{const i=this.store.getAll(r.range);return new E((s,u)=>{i.onerror=d=>{u(d.target.error)},i.onsuccess=d=>{s(d.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new E((i,s)=>{r.onerror=u=>{s(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}Y(e,t){D("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,(s,u,d)=>d.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}tt(e){const t=this.cursor({});return new E((r,i)=>{t.onerror=s=>{const u=$a(s.target.error);i(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(d=>{d?u.continue():r()}):r()}})}H(e,t){const r=[];return new E((i,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const d=u.target.result;if(!d)return void i();const f=new Mh(d),m=t(d.primaryKey,d.value,f);if(m instanceof E){const g=m.catch(_=>(f.done(),E.reject(_)));r.push(g)}f.isDone?i():null===f.G?d.continue():d.continue(f.G)}}).next(()=>E.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Pt(n){return new E((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=$a(r.target.error);t(i)}})}let Oc=!1;function $a(n){const e=ct.D((0,te.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Oc||(Oc=!0,setTimeout(()=>{throw r},0)),r}}return n}class Lh{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;D("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,x.Z)(function*(){t.task=null;try{D("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){Jt(r)?D("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Mt(r)}yield t.nt(6e4)}))}}class Fh{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,x.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let i=t,s=!0;return E.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return D("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,i).next(d=>{i-=d,r.add(u)});s=!1})).next(()=>t-i)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(i,s)).next(d=>(D("IndexBackiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>u.size)}))}ot(e,t){let r=e;return t.changes.forEach((i,s)=>{const u=Ba(s);so(u,r)>0&&(r=u)}),new it(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let lt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>r.writeSequenceNumber(i))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Uh{constructor(e,t,r,i,s,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=d,this.useFetchStreams=f}}class pn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new pn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof pn&&e.projectId===this.projectId&&e.database===this.database}}function Mc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Xt(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Pc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ci(n){return null==n}function Di(n){return 0===n&&1/n==-1/0}function Lc(n){return"number"==typeof n&&Number.isInteger(n)&&!Di(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class De{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new De(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new De(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}De.EMPTY_BYTE_STRING=new De("");const qh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function mn(n){if(Z(!!n),"string"==typeof n){let e=0;const t=qh.exec(n);if(Z(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:ve(n.seconds),nanos:ve(n.nanos)}}function ve(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function Hn(n){return"string"==typeof n?De.fromBase64String(n):De.fromUint8Array(n)}function Ri(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Fc(n){const e=n.mapValue.fields.__previous_value__;return Ri(e)?Fc(e):e}function Qn(n){const e=mn(n.mapValue.fields.__local_write_time__.timestampValue);return new de(e.seconds,e.nanos)}const gn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Ni={nullValue:"NULL_VALUE"};function Yn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ri(n)?4:Vc(n)?9007199254740991:10:U()}function bt(n,e){if(n===e)return!0;const t=Yn(n);if(t!==Yn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Qn(n).isEqual(Qn(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=mn(r.timestampValue),u=mn(i.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,Hn(n.bytesValue).isEqual(Hn(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return ve(r.geoPointValue.latitude)===ve(i.geoPointValue.latitude)&&ve(r.geoPointValue.longitude)===ve(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return ve(r.integerValue)===ve(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=ve(r.doubleValue),u=ve(i.doubleValue);return s===u?Di(s)===Di(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Wn(n.arrayValue.values||[],e.arrayValue.values||[],bt);case 10:return function(r,i){const s=r.mapValue.fields||{},u=i.mapValue.fields||{};if(Mc(s)!==Mc(u))return!1;for(const d in s)if(s.hasOwnProperty(d)&&(void 0===u[d]||!bt(s[d],u[d])))return!1;return!0}(n,e);default:return U()}var i}function Oi(n,e){return void 0!==(n.values||[]).find(t=>bt(t,e))}function en(n,e){if(n===e)return 0;const t=Yn(n),r=Yn(e);if(t!==r)return W(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return function(i,s){const u=ve(i.integerValue||i.doubleValue),d=ve(s.integerValue||s.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1}(n,e);case 3:return ja(n.timestampValue,e.timestampValue);case 4:return ja(Qn(n),Qn(e));case 5:return W(n.stringValue,e.stringValue);case 6:return function(i,s){const u=Hn(i),d=Hn(s);return u.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const u=i.split("/"),d=s.split("/");for(let f=0;f<u.length&&f<d.length;f++){const m=W(u[f],d[f]);if(0!==m)return m}return W(u.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const u=W(ve(i.latitude),ve(s.latitude));return 0!==u?u:W(ve(i.longitude),ve(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const u=i.values||[],d=s.values||[];for(let f=0;f<u.length&&f<d.length;++f){const m=en(u[f],d[f]);if(m)return m}return W(u.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===gn.mapValue&&s===gn.mapValue)return 0;if(i===gn.mapValue)return 1;if(s===gn.mapValue)return-1;const u=i.fields||{},d=Object.keys(u),f=s.fields||{},m=Object.keys(f);d.sort(),m.sort();for(let g=0;g<d.length&&g<m.length;++g){const _=W(d[g],m[g]);if(0!==_)return _;const w=en(u[d[g]],f[m[g]]);if(0!==w)return w}return W(d.length,m.length)}(n.mapValue,e.mapValue);default:throw U()}}function ja(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return W(n,e);const t=mn(n),r=mn(e),i=W(t.seconds,r.seconds);return 0!==i?i:W(t.nanos,r.nanos)}function Sr(n){return za(n)}function za(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=mn(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?Hn(n.bytesValue).toBase64():"referenceValue"in n?M.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const u of r.values||[])s?s=!1:i+=",",i+=za(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",u=!0;for(const d of i)u?u=!1:s+=",",s+=`${d}:${za(r.fields[d])}`;return s+"}"}(n.mapValue):U();var e}function Jn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Wa(n){return!!n&&"integerValue"in n}function Mi(n){return!!n&&"arrayValue"in n}function Ka(n){return!!n&&"nullValue"in n}function Uc(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ha(n){return!!n&&"mapValue"in n}function xt(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Xt(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=xt(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=xt(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Vc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Bh(n){return"nullValue"in n?Ni:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Jn(pn.empty(),M.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:U()}function Qa(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Jn(pn.empty(),M.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?gn:U()}function qc(n,e){const t=en(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function ao(n,e){const t=en(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class yn{constructor(e,t){this.position=e,this.inclusive=t}}function Bc(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],u=n.position[i];if(r=s.field.isKeyField()?M.comparator(M.fromName(u.referenceValue),t.key):en(u,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function uo(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!bt(n.position[t],e.position[t]))return!1;return!0}class Zc{}class X extends Zc{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Zh(e,t,r):"array-contains"===t?new Gh(e,r):"in"===t?new Pi(e,r):"not-in"===t?new $h(e,r):"array-contains-any"===t?new jh(e,r):new X(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new Xa(e,r):new eu(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(en(t,this.value)):null!==t&&Yn(this.value)===Yn(t)&&this.matchesComparison(en(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class se extends Zc{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new se(e,t)}matches(e){return Cr(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function Cr(n){return"and"===n.op}function Ya(n){return"or"===n.op}function Gc(n){return $c(n)&&Cr(n)}function $c(n){for(const e of n.filters)if(e instanceof se)return!1;return!0}function jc(n){if(n instanceof X)return n.field.canonicalString()+n.op.toString()+Sr(n.value);{const e=n.filters.map(t=>jc(t)).join(",");return`${n.op}(${e})`}}function Ja(n,e){return n instanceof X?(t=n,(r=e)instanceof X&&t.op===r.op&&t.field.isEqual(r.field)&&bt(t.value,r.value)):n instanceof se?function(t,r){return r instanceof se&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,s,u)=>i&&Ja(s,r.filters[u]),!0)}(n,e):void U();var t,r}function co(n,e){const t=n.filters.concat(e);return se.create(t,n.op)}function zc(n){return n instanceof X?`${(e=n).field.canonicalString()} ${e.op} ${Sr(e.value)}`:n instanceof se?function(e){return e.op.toString()+" {"+e.getFilters().map(zc).join(" ,")+"}"}(n):"Filter";var e}class Zh extends X{constructor(e,t,r){super(e,t,r),this.key=M.fromName(r.referenceValue)}matches(e){const t=M.comparator(e.key,this.key);return this.matchesComparison(t)}}class Xa extends X{constructor(e,t){super(e,"in",t),this.keys=Wc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class eu extends X{constructor(e,t){super(e,"not-in",t),this.keys=Wc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Wc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>M.fromName(r.referenceValue))}class Gh extends X{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Mi(t)&&Oi(t.arrayValue,this.value)}}class Pi extends X{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Oi(this.value.arrayValue,t)}}class $h extends X{constructor(e,t){super(e,"not-in",t)}matches(e){if(Oi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!Oi(this.value.arrayValue,t)}}class jh extends X{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Mi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>Oi(this.value.arrayValue,r))}}class Dr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Kc(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class Ie{constructor(e,t){this.comparator=e,this.root=t||Be.EMPTY}insert(e,t){return new Ie(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Be.BLACK,null,null))}remove(e){return new Ie(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new lo(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new lo(this.root,e,this.comparator,!1)}getReverseIterator(){return new lo(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new lo(this.root,e,this.comparator,!0)}}class lo{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Be{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:Be.RED,this.left=null!=i?i:Be.EMPTY,this.right=null!=s?s:Be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Be(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Be.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();const e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}}Be.EMPTY=null,Be.RED=!0,Be.BLACK=!1,Be.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(n,e,t,r,i){return this}insert(n,e,t){return new Be(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ue{constructor(e){this.comparator=e,this.data=new Ie(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Rr(this.data.getIterator())}getIteratorFrom(e){return new Rr(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ue(this.comparator);return t.data=e,t}}class Rr{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Nr(n){return n.hasNext()?n.getNext():void 0}class st{constructor(e){this.fields=e,e.sort(_e.comparator)}static empty(){return new st([])}unionWith(e){let t=new ue(_e.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new st(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Wn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Ze{constructor(e){this.value=e}static empty(){return new Ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Ha(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=xt(t)}setAll(e){let t=_e.emptyPath(),r={},i=[];e.forEach((u,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,r,i),r={},i=[],t=d.popLast()}u?r[d.lastSegment()]=xt(u):i.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());Ha(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return bt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];Ha(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Xt(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Ze(xt(this.value))}}function Hc(n){const e=[];return Xt(n.fields,(t,r)=>{const i=new _e([t]);if(Ha(r)){const s=Hc(r.mapValue).fields;if(0===s.length)e.push(i);else for(const u of s)e.push(i.child(u))}else e.push(i)}),new st(e)}class le{constructor(e,t,r,i,s,u,d){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=u,this.documentState=d}static newInvalidDocument(e){return new le(e,0,G.min(),G.min(),G.min(),Ze.empty(),0)}static newFoundDocument(e,t,r,i){return new le(e,1,t,G.min(),r,i,0)}static newNoDocument(e,t){return new le(e,2,t,G.min(),G.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new le(e,3,t,G.min(),G.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(G.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=G.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof le&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new le(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class zh{constructor(e,t=null,r=[],i=[],s=null,u=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=u,this.endAt=d,this.ft=null}}function ho(n,e=null,t=[],r=[],i=null,s=null,u=null){return new zh(n,e,t,r,i,s,u)}function tn(n){const e=O(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>jc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Ci(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Sr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Sr(r)).join(",")),e.ft=t}return e.ft}function Xn(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Kc(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Ja(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!uo(n.startAt,e.startAt)&&uo(n.endAt,e.endAt)}function Li(n){return M.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function fo(n,e){return n.filters.filter(t=>t instanceof X&&t.field.isEqual(e))}function po(n,e,t){let r=Ni,i=!0;for(const s of fo(n,e)){let u=Ni,d=!0;switch(s.op){case"<":case"<=":u=Bh(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,d=!1;break;case"!=":case"not-in":u=Ni}qc({value:r,inclusive:i},{value:u,inclusive:d})<0&&(r=u,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];qc({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function Qc(n,e,t){let r=gn,i=!0;for(const s of fo(n,e)){let u=gn,d=!0;switch(s.op){case">=":case">":u=Qa(s.value),d=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,d=!1;break;case"!=":case"not-in":u=gn}ao({value:r,inclusive:i},{value:u,inclusive:d})>0&&(r=u,i=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];ao({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class ke{constructor(e,t=null,r=[],i=[],s=null,u="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=u,this.startAt=d,this.endAt=f,this.dt=null,this._t=null}}function Or(n,e,t,r,i,s,u,d){return new ke(n,e,t,r,i,s,u,d)}function er(n){return new ke(n)}function Yc(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Fi(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Mr(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function tu(n){return null!==n.collectionGroup}function _n(n){const e=O(n);if(null===e.dt){e.dt=[];const t=Mr(e),r=Fi(e);if(null!==t&&null===r)t.isKeyField()||e.dt.push(new Dr(t)),e.dt.push(new Dr(_e.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Dr(_e.keyField(),s))}}}return e.dt}function Ye(n){const e=O(n);if(!e._t)if("F"===e.limitType)e._t=ho(e.path,e.collectionGroup,_n(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of _n(e))t.push(new Dr(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new yn(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new yn(e.startAt.position,e.startAt.inclusive):null;e._t=ho(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function Lt(n,e){e.getFirstInequalityField(),Mr(n);const t=n.filters.concat([e]);return new ke(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function Ui(n,e,t){return new ke(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function Vi(n,e){return Xn(Ye(n),Ye(e))&&n.limitType===e.limitType}function Jc(n){return`${tn(Ye(n))}|lt:${n.limitType}`}function nu(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>zc(r)).join(", ")}]`),Ci(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>Sr(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>Sr(r)).join(",")),`Target(${t})`}(Ye(n))}; limitType=${n.limitType})`}function mo(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):M.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of _n(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,u){const d=Bc(i,s,u);return i.inclusive?d<=0:d<0}(t.startAt,_n(t),r)||t.endAt&&!function(i,s,u){const d=Bc(i,s,u);return i.inclusive?d>=0:d>0}(t.endAt,_n(t),r)));var t,r}function Je(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function go(n){return(e,t)=>{let r=!1;for(const i of _n(n)){const s=ru(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function ru(n,e,t){const r=n.field.isKeyField()?M.comparator(e.key,t.key):function(i,s,u){const d=s.data.field(i),f=u.data.field(i);return null!==d&&null!==f?en(d,f):U()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return U()}}function Xc(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Di(e)?"-0":e}}function Ft(n){return{integerValue:""+n}}function Pr(n,e){return Lc(e)?Ft(e):Xc(n,e)}class qi{constructor(){this._=void 0}}function el(n,e,t){return n instanceof Lr?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof tr?tl(n,e):n instanceof nr?c(n,e):function(r,i){const s=yo(r,i),u=a(s)+a(r.gt);return Wa(s)&&Wa(r.gt)?Ft(u):Xc(r.yt,u)}(n,e)}function Wh(n,e,t){return n instanceof tr?tl(n,e):n instanceof nr?c(n,e):t}function yo(n,e){return n instanceof o?Wa(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class Lr extends qi{}class tr extends qi{constructor(e){super(),this.elements=e}}function tl(n,e){const t=l(e);for(const r of n.elements)t.some(i=>bt(i,r))||t.push(r);return{arrayValue:{values:t}}}class nr extends qi{constructor(e){super(),this.elements=e}}function c(n,e){let t=l(e);for(const r of n.elements)t=t.filter(i=>!bt(i,r));return{arrayValue:{values:t}}}class o extends qi{constructor(e,t){super(),this.yt=e,this.gt=t}}function a(n){return ve(n.integerValue||n.doubleValue)}function l(n){return Mi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class p{constructor(e,t){this.field=e,this.transform=t}}class v{constructor(e,t){this.version=e,this.transformResults=t}}class b{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new b}static exists(e){return new b(void 0,e)}static updateTime(e){return new b(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function N(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class L{}function j(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new ir(n.key,b.none()):new rr(n.key,n.data,b.none());{const t=n.data,r=Ze.empty();let i=new ue(_e.comparator);for(let s of e.fields)if(!i.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?r.delete(s):r.set(s,u),i=i.add(s)}return new At(n.key,r,new st(i.toArray()),b.none())}}function $(n,e,t){n instanceof rr?function(r,i,s){const u=r.value.clone(),d=su(r.fieldTransforms,i,s.transformResults);u.setAll(d),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof At?function(r,i,s){if(!N(r.precondition,i))return void i.convertToUnknownDocument(s.version);const u=su(r.fieldTransforms,i,s.transformResults),d=i.data;d.setAll(iu(r)),d.setAll(u),i.convertToFoundDocument(s.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function fe(n,e,t,r){return n instanceof rr?function(i,s,u,d){if(!N(i.precondition,s))return u;const f=i.value.clone(),m=_o(i.fieldTransforms,d,s);return f.setAll(m),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof At?function(i,s,u,d){if(!N(i.precondition,s))return u;const f=_o(i.fieldTransforms,d,s),m=s.data;return m.setAll(iu(i)),m.setAll(f),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):(u=t,N(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function kt(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=yo(r.transform,i||null);null!=s&&(null===t&&(t=Ze.empty()),t.set(r.field,s))}return t||null}function Bi(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Wn(t,r,(i,s)=>function y(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof tr&&r instanceof tr||t instanceof nr&&r instanceof nr?Wn(t.elements,r.elements,bt):t instanceof o&&r instanceof o?bt(t.gt,r.gt):t instanceof Lr&&r instanceof Lr);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class rr extends L{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class At extends L{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function iu(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function su(n,e,t){const r=new Map;Z(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],u=s.transform,d=e.data.field(s.field);r.set(s.field,Wh(u,d,t[i]))}return r}function _o(n,e,t){const r=new Map;for(const i of n){const s=i.transform,u=t.data.field(i.field);r.set(i.field,el(s,u,e))}return r}class ir extends L{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class vo extends L{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class ou{constructor(e){this.count=e}}var Ae,re;function Io(n){switch(n){default:return U();case T.CANCELLED:case T.UNKNOWN:case T.DEADLINE_EXCEEDED:case T.RESOURCE_EXHAUSTED:case T.INTERNAL:case T.UNAVAILABLE:case T.UNAUTHENTICATED:return!1;case T.INVALID_ARGUMENT:case T.NOT_FOUND:case T.ALREADY_EXISTS:case T.PERMISSION_DENIED:case T.FAILED_PRECONDITION:case T.ABORTED:case T.OUT_OF_RANGE:case T.UNIMPLEMENTED:case T.DATA_LOSS:return!0}}function nl(n){if(void 0===n)return xe("GRPC error has no .code"),T.UNKNOWN;switch(n){case Ae.OK:return T.OK;case Ae.CANCELLED:return T.CANCELLED;case Ae.UNKNOWN:return T.UNKNOWN;case Ae.DEADLINE_EXCEEDED:return T.DEADLINE_EXCEEDED;case Ae.RESOURCE_EXHAUSTED:return T.RESOURCE_EXHAUSTED;case Ae.INTERNAL:return T.INTERNAL;case Ae.UNAVAILABLE:return T.UNAVAILABLE;case Ae.UNAUTHENTICATED:return T.UNAUTHENTICATED;case Ae.INVALID_ARGUMENT:return T.INVALID_ARGUMENT;case Ae.NOT_FOUND:return T.NOT_FOUND;case Ae.ALREADY_EXISTS:return T.ALREADY_EXISTS;case Ae.PERMISSION_DENIED:return T.PERMISSION_DENIED;case Ae.FAILED_PRECONDITION:return T.FAILED_PRECONDITION;case Ae.ABORTED:return T.ABORTED;case Ae.OUT_OF_RANGE:return T.OUT_OF_RANGE;case Ae.UNIMPLEMENTED:return T.UNIMPLEMENTED;case Ae.DATA_LOSS:return T.DATA_LOSS;default:return U()}}(re=Ae||(Ae={}))[re.OK=0]="OK",re[re.CANCELLED=1]="CANCELLED",re[re.UNKNOWN=2]="UNKNOWN",re[re.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",re[re.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",re[re.NOT_FOUND=5]="NOT_FOUND",re[re.ALREADY_EXISTS=6]="ALREADY_EXISTS",re[re.PERMISSION_DENIED=7]="PERMISSION_DENIED",re[re.UNAUTHENTICATED=16]="UNAUTHENTICATED",re[re.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",re[re.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",re[re.ABORTED=10]="ABORTED",re[re.OUT_OF_RANGE=11]="OUT_OF_RANGE",re[re.UNIMPLEMENTED=12]="UNIMPLEMENTED",re[re.INTERNAL=13]="INTERNAL",re[re.UNAVAILABLE=14]="UNAVAILABLE",re[re.DATA_LOSS=15]="DATA_LOSS";class Fr{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Xt(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return Pc(this.inner)}size(){return this.innerSize}}const jy=new Ie(M.comparator);function Et(){return jy}const Ep=new Ie(M.comparator);function au(...n){let e=Ep;for(const t of n)e=e.insert(t.key,t);return e}function Tp(n){let e=Ep;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function vn(){return uu()}function xp(){return uu()}function uu(){return new Fr(n=>n.toString(),(n,e)=>n.isEqual(e))}const zy=new Ie(M.comparator),Wy=new ue(M.comparator);function H(...n){let e=Wy;for(const t of n)e=e.add(t);return e}const Ky=new ue(W);function rl(){return Ky}class cu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,lu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new cu(G.min(),i,rl(),Et(),H())}}class lu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new lu(r,t,H(),H(),H())}}class il{constructor(e,t,r,i){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=i}}class kp{constructor(e,t){this.targetId=e,this.Et=t}}class Ap{constructor(e,t,r=De.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class Sp{constructor(){this.At=0,this.Rt=Dp(),this.bt=De.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=H(),t=H(),r=H();return this.Rt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:U()}}),new lu(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=Dp()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Hy{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=Et(),this.qt=Cp(),this.Ut=new ue(W)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,i)=>{this.zt(i)&&t(i)})}Jt(e){const t=e.targetId,r=e.Et.count,i=this.Yt(t);if(i){const s=i.target;if(Li(s))if(0===r){const u=new M(s.path);this.Qt(t,u,le.newNoDocument(u,G.min()))}else Z(1===r);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,u)=>{const d=this.Yt(u);if(d){if(s.current&&Li(d.target)){const f=new M(d.target.path);null!==this.Lt.get(f)||this.te(u,f)||this.Qt(u,f,le.newNoDocument(f,e))}s.St&&(t.set(u,s.Ct()),s.xt())}});let r=H();this.qt.forEach((s,u)=>{let d=!0;u.forEachWhile(f=>{const m=this.Yt(f);return!m||2===m.purpose||(d=!1,!1)}),d&&(r=r.add(s))}),this.Lt.forEach((s,u)=>u.setReadTime(e));const i=new cu(e,t,this.Ut,this.Lt,r);return this.Lt=Et(),this.qt=Cp(),this.Ut=new ue(W),i}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const i=this.Wt(e);this.te(e,t)?i.Nt(t,1):i.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Sp,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new ue(W),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Sp),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Cp(){return new Ie(M.comparator)}function Dp(){return new Ie(M.comparator)}const Qy={asc:"ASCENDING",desc:"DESCENDING"},Yy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Jy={and:"AND",or:"OR"};class Xy{constructor(e,t){this.databaseId=e,this.wt=t}}function wo(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Rp(n,e){return n.wt?e.toBase64():e.toUint8Array()}function e_(n,e){return wo(n,e.toTimestamp())}function Oe(n){return Z(!!n),G.fromTimestamp(function(e){const t=mn(e);return new de(t.seconds,t.nanos)}(n))}function Kh(n,e){return(t=n,new ne(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Np(n){const e=ne.fromString(n);return Z(Bp(e)),e}function hu(n,e){return Kh(n.databaseId,e.path)}function In(n,e){const t=Np(e);if(t.get(1)!==n.databaseId.projectId)throw new A(T.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new A(T.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new M(Mp(t))}function Hh(n,e){return Kh(n.databaseId,e)}function Op(n){const e=Np(n);return 4===e.length?ne.emptyPath():Mp(e)}function du(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Mp(n){return Z(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Pp(n,e,t){return{name:hu(n,e),fields:t.value.mapValue.fields}}function Lp(n,e,t){const r=In(n,e.name),i=Oe(e.updateTime),s=e.createTime?Oe(e.createTime):G.min(),u=new Ze({mapValue:{fields:e.fields}}),d=le.newFoundDocument(r,i,s,u);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function fu(n,e){let t;if(e instanceof rr)t={update:Pp(n,e.key,e.value)};else if(e instanceof ir)t={delete:hu(n,e.key)};else if(e instanceof At)t={update:Pp(n,e.key,e.data),updateMask:u_(e.fieldMask)};else{if(!(e instanceof vo))return U();t={verify:hu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const u=s.transform;if(u instanceof Lr)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof tr)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof nr)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof o)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw U()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:e_(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:U()),t;var i}function Qh(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?b.updateTime(Oe(i.updateTime)):void 0!==i.exists?b.exists(i.exists):b.none():b.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let d=null;"setToServerValue"in u?(Z("REQUEST_TIME"===u.setToServerValue),d=new Lr):"appendMissingElements"in u?d=new tr(u.appendMissingElements.values||[]):"removeAllFromArray"in u?d=new nr(u.removeAllFromArray.values||[]):"increment"in u?d=new o(s,u.increment):U();const f=_e.fromServerFormat(u.fieldPath);return new p(f,d)}(n,i)):[];var i;if(e.update){const i=In(n,e.update.name),s=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new st((e.updateMask.fieldPaths||[]).map(m=>_e.fromServerFormat(m)));return new At(i,s,u,t,r)}return new rr(i,s,t,r)}if(e.delete){const i=In(n,e.delete);return new ir(i,t)}if(e.verify){const i=In(n,e.verify);return new vo(i,t)}return U()}function Fp(n,e){return{documents:[Hh(n,e.path)]}}function Yh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=Hh(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Hh(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(f){if(0!==f.length)return qp(se.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(f){if(0!==f.length)return f.map(m=>{return{field:bo((g=m).field),direction:s_(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(m=e.limit,n.wt||Ci(m)?m:{value:m});var m,d,f;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt={before:!(f=e.endAt).inclusive,values:f.position}),t}function Up(n){let e=Op(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){Z(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(g){const _=Vp(g);return _ instanceof se&&Gc(_)?_.getFilters():[_]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new Dr(Eo((_=g).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let d=null;t.limit&&(d=function(g){let _;return _="object"==typeof g?g.value:g,Ci(_)?null:_}(t.limit));let f=null;var g;t.startAt&&(f=new yn((g=t.startAt).values||[],!!g.before));let m=null;return t.endAt&&(m=function(g){return new yn(g.values||[],!g.before)}(t.endAt)),Or(e,i,u,s,d,"F",f,m)}function Vp(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Eo(e.unaryFilter.field);return X.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=Eo(e.unaryFilter.field);return X.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=Eo(e.unaryFilter.field);return X.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Eo(e.unaryFilter.field);return X.create(s,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):void 0!==n.fieldFilter?X.create(Eo((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return se.create(e.compositeFilter.filters.map(t=>Vp(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return U()}}(e.compositeFilter.op))}(n):U();var e}function s_(n){return Qy[n]}function o_(n){return Yy[n]}function a_(n){return Jy[n]}function bo(n){return{fieldPath:n.canonicalString()}}function Eo(n){return _e.fromServerFormat(n.fieldPath)}function qp(n){return n instanceof X?function(e){if("=="===e.op){if(Uc(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NAN"}};if(Ka(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Uc(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NOT_NAN"}};if(Ka(e.value))return{unaryFilter:{field:bo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:bo(e.field),op:o_(e.op),value:e.value}}}(n):n instanceof se?function(e){const t=e.getFilters().map(r=>qp(r));return 1===t.length?t[0]:{compositeFilter:{op:a_(e.op),filters:t}}}(n):U()}function u_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Bp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function ht(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Zp(e)),e=c_(n.get(t),e);return Zp(e)}function c_(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Zp(n){return n+"\x01\x01"}function wn(n){const e=n.length;if(Z(e>=2),2===e)return Z("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ne.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&U(),n.charAt(u+1)){case"\x01":const d=n.substring(s,u);let f;0===i.length?f=d:(i+=d,f=i,i=""),r.push(f);break;case"\x10":i+=n.substring(s,u),i+="\0";break;case"\x11":i+=n.substring(s,u+1);break;default:U()}s=u+2}return new ne(r)}const Gp=["userId","batchId"];function sl(n,e){return[n,ht(e)]}function $p(n,e,t){return[n,ht(e),t]}const l_={},h_=["prefixPath","collectionGroup","readTime","documentId"],d_=["prefixPath","collectionGroup","documentId"],f_=["collectionGroup","readTime","prefixPath","documentId"],p_=["canonicalId","targetId"],m_=["targetId","path"],g_=["path","targetId"],y_=["collectionId","parent"],__=["indexId","uid"],v_=["uid","sequenceNumber"],I_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],w_=["indexId","uid","orderedDocumentKey"],b_=["userId","collectionPath","documentId"],E_=["userId","collectionPath","largestBatchId"],T_=["userId","collectionGroup","largestBatchId"],jp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],x_=[...jp,"documentOverlays"],zp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Wp=zp,k_=[...Wp,"indexConfiguration","indexState","indexEntries"];class Jh extends Za{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function ze(n,e){const t=O(n);return ct.M(t.se,e)}class Xh{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&$(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=fe(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=fe(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=xp();return this.mutations.forEach(i=>{const s=e.get(i.key),u=s.overlayedDocument;let d=this.applyToLocalView(u,s.mutatedFields);d=t.has(i.key)?null:d;const f=j(u,d);null!==f&&r.set(i.key,f),u.isValidDocument()||u.convertToNoDocument(G.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&Wn(this.mutations,e.mutations,(t,r)=>Bi(t,r))&&Wn(this.baseMutations,e.baseMutations,(t,r)=>Bi(t,r))}}class ed{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){Z(e.mutations.length===r.length);let i=zy;const s=e.mutations;for(let u=0;u<s.length;u++)i=i.insert(s[u].key,r[u].version);return new ed(e,t,r,i)}}class td{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ur{constructor(e,t,r,i,s=G.min(),u=G.min(),d=De.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=d}withSequenceNumber(e){return new Ur(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Ur(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Ur(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Kp{constructor(e){this.ie=e}}function Hp(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ol(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:hu(i=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:wo(i,s.version.toTimestamp()),createTime:wo(i,s.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Zi(e.version)};else{if(!e.isUnknownDocument())return U();r.unknownDocument={path:t.path.toArray(),version:Zi(e.version)}}var i,s;return r}function ol(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Zi(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Gi(n){const e=new de(n.seconds,n.nanoseconds);return G.fromTimestamp(e)}function $i(n,e){const t=(e.baseMutations||[]).map(s=>Qh(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const r=e.mutations.map(s=>Qh(n.ie,s)),i=de.fromMillis(e.localWriteTimeMs);return new Xh(e.batchId,i,t,r)}function pu(n){const e=Gi(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?Gi(n.lastLimboFreeSnapshotVersion):G.min();let r;var i;return void 0!==n.query.documents?(Z(1===(i=n.query).documents.length),r=Ye(er(Op(i.documents[0])))):r=Ye(Up(n.query)),new Ur(r,n.targetId,0,n.lastListenSequenceNumber,e,t,De.fromBase64String(n.resumeToken))}function Qp(n,e){const t=Zi(e.snapshotVersion),r=Zi(e.lastLimboFreeSnapshotVersion);let i;i=Li(e.target)?Fp(n.ie,e.target):Yh(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:tn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function nd(n){const e=Up({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?Ui(e,e.limit,"L"):e}function rd(n,e){return new td(e.largestBatchId,Qh(n.ie,e.overlayMutation))}function Yp(n,e){const t=e.path.lastSegment();return[n,ht(e.path.popLast()),t]}function Jp(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Zi(r.readTime),documentKey:ht(r.documentKey.path),largestBatchId:r.largestBatchId}}class S_{getBundleMetadata(e,t){return Xp(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:Gi(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return Xp(e).put({bundleId:(r=t).id,createTime:Zi(Oe(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return em(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:nd(i.bundledQuery),readTime:Gi(i.readTime)};var i})}saveNamedQuery(e,t){return em(e).put({name:(r=t).name,readTime:Zi(Oe(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Xp(n){return ze(n,"bundles")}function em(n){return ze(n,"namedQueries")}class al{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new al(e,t.uid||"")}getOverlay(e,t){return mu(e).get(Yp(this.userId,t)).next(r=>r?rd(this.yt,r):null)}getOverlays(e,t){const r=vn();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,u)=>{const d=new td(t,u);i.push(this.oe(e,d))}),E.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(ht(u.getCollectionPath())));const s=[];return i.forEach(u=>{const d=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);s.push(mu(e).Y("collectionPathOverlayIndex",d))}),E.waitFor(s)}getOverlaysForCollection(e,t,r){const i=vn(),s=ht(t),u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return mu(e).W("collectionPathOverlayIndex",u).next(d=>{for(const f of d){const m=rd(this.yt,f);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=vn();let u;const d=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return mu(e).Z({index:"collectionGroupOverlayIndex",range:d},(f,m,g)=>{const _=rd(this.yt,m);s.size()<i||_.largestBatchId===u?(s.set(_.getKey(),_),u=_.largestBatchId):g.done()}).next(()=>s)}oe(e,t){return mu(e).put(function(r,i,s){const[u,d,f]=Yp(i,s.mutation.key);return{userId:i,collectionPath:d,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:fu(r.ie,s.mutation)}}(this.yt,this.userId,t))}}function mu(n){return ze(n,"documentOverlays")}class ji{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(ve(e.integerValue));else if("doubleValue"in e){const r=ve(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),Di(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(Hn(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?Vc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):U()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const i of Object.keys(r))this.de(i,t),this.ce(r[i],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const i of r)this.ce(i,t)}me(e,t){this.he(t,37),M.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function C_(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function tm(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=C_(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}ji.Ie=new ji;class D_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const i=t.codePointAt(0);this.Ee(240|i>>>18),this.Ee(128|63&i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const i=t.codePointAt(0);this.be(240|i>>>18),this.be(128|63&i>>>12),this.be(128|63&i>>>6),this.be(128|63&i)}}this.Pe()}Se(e){const t=this.De(e),r=tm(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}xe(e){const t=this.De(e),r=tm(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class R_{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class N_{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class gu{constructor(){this.$e=new D_,this.Be=new R_(this.$e),this.Le=new N_(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class zi{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new zi(this.indexId,this.documentKey,this.arrayValue,r)}}function Vr(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=nm(n.arrayValue,e.arrayValue),0!==t?t:(t=nm(n.directionalValue,e.directionalValue),0!==t?t:M.comparator(n.documentKey,e.documentKey)))}function nm(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class O_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){Z(e.collectionGroup===this.collectionId);const t=qa(e);if(void 0!==t&&!this.We(t))return!1;const r=Yt(e);let i=0,s=0;for(;i<r.length&&this.We(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.Qe){const u=r[i];if(!this.ze(this.Qe,u)||!this.He(this.Ke[s++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(s>=this.Ke.length||!this.He(this.Ke[s++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rm(n){var e,t;if(Z(n instanceof X||n instanceof se),n instanceof X){if(n instanceof Pi){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>X.create(n.field,"==",s)))||[];return se.create(i,"or")}return n}const r=n.filters.map(i=>rm(i));return se.create(r,n.op)}function M_(n){if(0===n.getFilters().length)return[];const e=od(rm(n));return Z(im(e)),id(e)||sd(e)?[e]:e.getFilters()}function id(n){return n instanceof X}function sd(n){return n instanceof se&&Gc(n)}function im(n){return id(n)||sd(n)||function(e){if(e instanceof se&&Ya(e)){for(const t of e.getFilters())if(!id(t)&&!sd(t))return!1;return!0}return!1}(n)}function od(n){if(Z(n instanceof X||n instanceof se),n instanceof X)return n;if(1===n.filters.length)return od(n.filters[0]);const e=n.filters.map(r=>od(r));let t=se.create(e,n.op);return t=ul(t),im(t)?t:(Z(t instanceof se),Z(Cr(t)),Z(t.filters.length>1),t.filters.reduce((r,i)=>ad(r,i)))}function ad(n,e){let t;return Z(n instanceof X||n instanceof se),Z(e instanceof X||e instanceof se),t=n instanceof X?e instanceof X?se.create([n,e],"and"):sm(n,e):e instanceof X?sm(e,n):function(r,i){if(Z(r.filters.length>0&&i.filters.length>0),Cr(r)&&Cr(i))return co(r,i.getFilters());const s=Ya(r)?r:i,u=Ya(r)?i:r,d=s.filters.map(f=>ad(f,u));return se.create(d,"or")}(n,e),ul(t)}function sm(n,e){if(Cr(e))return co(e,n.getFilters());{const t=e.filters.map(r=>ad(n,r));return se.create(t,"or")}}function ul(n){if(Z(n instanceof X||n instanceof se),n instanceof X)return n;const e=n.getFilters();if(1===e.length)return ul(e[0]);if($c(n))return n;const t=e.map(i=>ul(i)),r=[];return t.forEach(i=>{i instanceof X?r.push(i):i instanceof se&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:se.create(r,n.op)}class P_{constructor(){this.Je=new ud}addToCollectionParentIndex(e,t){return this.Je.add(t),E.resolve()}getCollectionParents(e,t){return E.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return E.resolve()}deleteFieldIndex(e,t){return E.resolve()}getDocumentsMatchingTarget(e,t){return E.resolve(null)}getIndexType(e,t){return E.resolve(0)}getFieldIndexes(e,t){return E.resolve([])}getNextCollectionGroupToUpdate(e){return E.resolve(null)}getMinOffset(e,t){return E.resolve(it.min())}getMinOffsetFromCollectionGroup(e,t){return E.resolve(it.min())}updateCollectionGroup(e,t,r){return E.resolve()}updateIndexEntries(e,t){return E.resolve()}}class ud{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ue(ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ue(ne.comparator)).toArray()}}const cl=new Uint8Array(0);class L_{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ud,this.Xe=new Fr(r=>tn(r),(r,i)=>Xn(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:r,parent:ht(i)};return om(e).put(s)}return E.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Cc(t),""],!1,!0);return om(e).W(i).next(s=>{for(const u of s){if(u.collectionId!==t)break;r.push(wn(u.parent))}return r})}addFieldIndex(e,t){const r=ll(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var u;delete i.indexId;const s=r.add(i);if(t.indexState){const u=_u(e);return s.next(d=>{u.put(Jp(d,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=ll(e),i=_u(e),s=yu(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=yu(e);let i=!0;const s=new Map;return E.forEach(this.Ze(t),u=>this.tn(e,u).next(d=>{i&&(i=!!d),s.set(u,d)})).next(()=>{if(i){let u=H();const d=[];return E.forEach(s,(f,m)=>{var g;D("IndexedDbIndexManager",`Using index ${g=f,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(ee=>`${ee.fieldPath}:${ee.kind}`).join(",")}`} to execute ${tn(t)}`);const _=function(ee,Q){const K=qa(Q);if(void 0===K)return null;for(const J of fo(ee,K.fieldPath))switch(J.op){case"array-contains-any":return J.value.arrayValue.values||[];case"array-contains":return[J.value]}return null}(m,f),w=function(ee,Q){const K=new Map;for(const J of Yt(Q))for(const Ge of fo(ee,J.fieldPath))switch(Ge.op){case"==":case"in":K.set(J.fieldPath.canonicalString(),Ge.value);break;case"not-in":case"!=":return K.set(J.fieldPath.canonicalString(),Ge.value),Array.from(K.values())}return null}(m,f),k=function(ee,Q){const K=[];let J=!0;for(const Ge of Yt(Q)){const Lu=0===Ge.kind?po(ee,Ge.fieldPath,ee.startAt):Qc(ee,Ge.fieldPath,ee.startAt);K.push(Lu.value),J&&(J=Lu.inclusive)}return new yn(K,J)}(m,f),S=function(ee,Q){const K=[];let J=!0;for(const Ge of Yt(Q)){const Lu=0===Ge.kind?Qc(ee,Ge.fieldPath,ee.endAt):po(ee,Ge.fieldPath,ee.endAt);K.push(Lu.value),J&&(J=Lu.inclusive)}return new yn(K,J)}(m,f),P=this.en(f,m,k),q=this.en(f,m,S),oe=this.nn(f,m,w),ce=this.sn(f.indexId,_,P,k.inclusive,q,S.inclusive,oe);return E.forEach(ce,ee=>r.J(ee,t.limit).next(Q=>{Q.forEach(K=>{const J=M.fromSegments(K.documentKey);u.has(J)||(u=u.add(J),d.push(J))})}))}).next(()=>d)}return E.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:M_(se.create(e.filters,"and")).map(r=>ho(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,i,s,u,d){const f=(null!=t?t.length:1)*Math.max(r.length,s.length),m=f/(null!=t?t.length:1),g=[];for(let _=0;_<f;++_){const w=t?this.rn(t[_/m]):cl,k=this.on(e,w,r[_%m],i),S=this.un(e,w,s[_%m],u),P=d.map(q=>this.on(e,w,q,!0));g.push(...this.createRange(k,S,P))}return g}on(e,t,r,i){const s=new zi(e,M.empty(),t,r);return i?s:s.Ue()}un(e,t,r,i){const s=new zi(e,M.empty(),t,r);return i?s.Ue():s}tn(e,t){const r=new O_(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let u=null;for(const d of s)r.je(d)&&(!u||d.fields.length>u.fields.length)&&(u=d);return u})}getIndexType(e,t){let r=2;const i=this.Ze(t);return E.forEach(i,s=>this.tn(e,s).next(u=>{u?0!==r&&u.fields.length<function(d){let f=new ue(_e.comparator),m=!1;for(const g of d.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?m=!0:f=f.add(_.field));for(const g of d.orderBy)g.field.isKeyField()||(f=f.add(g.field));return f.size+(m?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}cn(e,t){const r=new gu;for(const i of Yt(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const u=r.qe(i.kind);ji.Ie.ue(s,u)}return r.Fe()}rn(e){const t=new gu;return ji.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new gu;return ji.Ie.ue(Jn(this.databaseId,t),r.qe(function(i){const s=Yt(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(null===r)return[];let i=[];i.push(new gu);let s=0;for(const u of Yt(e)){const d=r[s++];for(const f of i)if(this.hn(t,u.fieldPath)&&Mi(d))i=this.ln(i,u,d);else{const m=f.qe(u.kind);ji.Ie.ue(d,m)}}return this.fn(i)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const i=[...e],s=[];for(const u of r.arrayValue.values||[])for(const d of i){const f=new gu;f.seed(d.Fe()),ji.Ie.ue(u,f.qe(t.kind)),s.push(f)}return s}hn(e,t){return!!e.filters.find(r=>r instanceof X&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=ll(e),i=_u(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const u=[];return E.forEach(s,d=>i.get([d.indexId,this.uid]).next(f=>{u.push(function(m,g){const _=g?new Kn(g.sequenceNumber,new it(Gi(g.readTime),new M(wn(g.documentKey)),g.largestBatchId)):Kn.empty(),w=m.fields.map(([k,S])=>new Ar(_e.fromServerFormat(k),S));return new kr(m.indexId,m.collectionGroup,w,_)}(d,f))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:W(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=ll(e),s=_u(e);return this.dn(e).next(u=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>E.forEach(d,f=>s.put(Jp(f.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return E.forEach(t,(i,s)=>{const u=r.get(i.collectionGroup);return(u?E.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(d=>(r.set(i.collectionGroup,d),E.forEach(d,f=>this._n(e,i,f).next(m=>{const g=this.wn(s,f);return m.isEqual(g)?E.resolve():this.mn(e,s,f,m,g)}))))})}gn(e,t,r,i){return yu(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,i){return yu(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const i=yu(e);let s=new ue(Vr);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(u,d)=>{s=s.add(new zi(r.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}wn(e,t){let r=new ue(Vr);const i=this.cn(t,e);if(null==i)return r;const s=qa(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Mi(u))for(const d of u.arrayValue.values||[])r=r.add(new zi(t.indexId,e.key,this.rn(d),i))}else r=r.add(new zi(t.indexId,e.key,cl,i));return r}mn(e,t,r,i,s){D("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(d,f,m,g,_){const w=d.getIterator(),k=f.getIterator();let S=Nr(w),P=Nr(k);for(;S||P;){let q=!1,oe=!1;if(S&&P){const ce=m(S,P);ce<0?oe=!0:ce>0&&(q=!0)}else null!=S?oe=!0:q=!0;q?(g(P),P=Nr(k)):oe?(_(S),S=Nr(w)):(S=Nr(w),P=Nr(k))}}(i,s,Vr,d=>{u.push(this.gn(e,t,r,d))},d=>{u.push(this.yn(e,t,r,d))}),E.waitFor(u)}dn(e){let t=1;return _u(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,d)=>Vr(u,d)).filter((u,d,f)=>!d||0!==Vr(u,f[d-1]));const i=[];i.push(e);for(const u of r){const d=Vr(u,e),f=Vr(u,t);if(0===d)i[0]=e.Ue();else if(d>0&&f<0)i.push(u),i.push(u.Ue());else if(f>0)break}i.push(t);const s=[];for(let u=0;u<i.length;u+=2){if(this.pn(i[u],i[u+1]))return[];s.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,cl,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,cl,[]]))}return s}pn(e,t){return Vr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(am)}getMinOffset(e,t){return E.mapArray(this.Ze(t),r=>this.tn(e,r).next(i=>i||U())).next(am)}}function om(n){return ze(n,"collectionParents")}function yu(n){return ze(n,"indexEntries")}function ll(n){return ze(n,"indexConfiguration")}function _u(n){return ze(n,"indexState")}function am(n){Z(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;so(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new it(e.readTime,e.documentKey,t)}const um={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class Tt{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new Tt(e,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function cm(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let d=0;const f=r.Z({range:u},(g,_,w)=>(d++,w.delete()));s.push(f.next(()=>{Z(1===d)}));const m=[];for(const g of t.mutations){const _=$p(e,g.key.path,t.batchId);s.push(i.delete(_)),m.push(g.key)}return E.waitFor(s).next(()=>m)}function hl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}Tt.DEFAULT_COLLECTION_PERCENTILE=10,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Tt.DEFAULT=new Tt(41943040,Tt.DEFAULT_COLLECTION_PERCENTILE,Tt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Tt.DISABLED=new Tt(-1,0,0);class dl{constructor(e,t,r,i){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=i,this.In={}}static re(e,t,r,i){Z(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new dl(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return qr(e).Z({index:"userMutationsIndex",range:r},(i,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=To(e),u=qr(e);return u.add({}).next(d=>{Z("number"==typeof d);const f=new Xh(d,t,r,i),m=function(w,k,S){const P=S.baseMutations.map(oe=>fu(w.ie,oe)),q=S.mutations.map(oe=>fu(w.ie,oe));return{userId:k,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:P,mutations:q}}(this.yt,this.userId,f),g=[];let _=new ue((w,k)=>W(w.canonicalString(),k.canonicalString()));for(const w of i){const k=$p(this.userId,w.key.path,d);_=_.add(w.key.path.popLast()),g.push(u.put(m)),g.push(s.put(k,l_))}return _.forEach(w=>{g.push(this.indexManager.addToCollectionParentIndex(e,w))}),e.addOnCommittedListener(()=>{this.In[d]=f.keys()}),E.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return qr(e).get(t).next(r=>r?(Z(r.userId===this.userId),$i(this.yt,r)):null)}Tn(e,t){return this.In[t]?E.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.In[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return qr(e).Z({index:"userMutationsIndex",range:i},(u,d,f)=>{d.userId===this.userId&&(Z(d.batchId>=r),s=$i(this.yt,d)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return qr(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,s,u)=>{r=s.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return qr(e).W("userMutationsIndex",t).next(r=>r.map(i=>$i(this.yt,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=sl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return To(e).Z({range:i},(u,d,f)=>{const[m,g,_]=u,w=wn(g);if(m===this.userId&&t.path.isEqual(w))return qr(e).get(_).next(k=>{if(!k)throw U();Z(k.userId===this.userId),s.push($i(this.yt,k))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(W);const i=[];return t.forEach(s=>{const u=sl(this.userId,s.path),d=IDBKeyRange.lowerBound(u),f=To(e).Z({range:d},(m,g,_)=>{const[w,k,S]=m,P=wn(k);w===this.userId&&s.path.isEqual(P)?r=r.add(S):_.done()});i.push(f)}),E.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=sl(this.userId,r),u=IDBKeyRange.lowerBound(s);let d=new ue(W);return To(e).Z({range:u},(f,m,g)=>{const[_,w,k]=f,S=wn(w);_===this.userId&&r.isPrefixOf(S)?S.length===i&&(d=d.add(k)):g.done()}).next(()=>this.En(e,d))}En(e,t){const r=[],i=[];return t.forEach(s=>{i.push(qr(e).get(s).next(u=>{if(null===u)throw U();Z(u.userId===this.userId),r.push($i(this.yt,u))}))}),E.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return cm(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),E.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return E.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return To(e).Z({range:r},(s,u,d)=>{if(s[0]===this.userId){const f=wn(s[1]);i.push(f)}else d.done()}).next(()=>{Z(0===i.length)})})}containsKey(e,t){return lm(e,this.userId,t)}Rn(e){return hm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function lm(n,e,t){const r=sl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let u=!1;return To(n).Z({range:s,X:!0},(d,f,m)=>{const[g,_,w]=d;g===e&&_===i&&(u=!0),m.done()}).next(()=>u)}function qr(n){return ze(n,"mutations")}function To(n){return ze(n,"documentMutations")}function hm(n){return ze(n,"mutationQueues")}class Wi{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Wi(0)}static vn(){return new Wi(-1)}}class F_{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Wi(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>G.fromTimestamp(new de(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Sn(e,i)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>xo(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(Z(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return xo(e).Z((u,d)=>{const f=pu(d);f.sequenceNumber<=t&&null===r.get(f.targetId)&&(i++,s.push(this.removeTargetData(e,f)))}).next(()=>E.waitFor(s)).next(()=>i)}forEachTarget(e,t){return xo(e).Z((r,i)=>{const s=pu(i);t(s)})}Vn(e){return dm(e).get("targetGlobalKey").next(t=>(Z(null!==t),t))}Sn(e,t){return dm(e).put("targetGlobalKey",t)}Dn(e,t){return xo(e).put(Qp(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=tn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return xo(e).Z({range:i,index:"queryTargetsIndex"},(u,d,f)=>{const m=pu(d);Xn(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=Br(e);return t.forEach(u=>{const d=ht(u.path);i.push(s.put({targetId:r,path:d})),i.push(this.referenceDelegate.addReference(e,r,u))}),E.waitFor(i)}removeMatchingKeys(e,t,r){const i=Br(e);return E.forEach(t,s=>{const u=ht(s.path);return E.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=Br(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Br(e);let s=H();return i.Z({range:r,X:!0},(u,d,f)=>{const m=wn(u[1]),g=new M(m);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=ht(t.path),i=IDBKeyRange.bound([r],[Cc(r)],!1,!0);let s=0;return Br(e).Z({index:"documentTargetsIndex",X:!0,range:i},([u,d],f,m)=>{0!==u&&(s++,m.done())}).next(()=>s>0)}ne(e,t){return xo(e).get(t).next(r=>r?pu(r):null)}}function xo(n){return ze(n,"targets")}function dm(n){return ze(n,"targetGlobal")}function Br(n){return ze(n,"targetDocuments")}function fm([n,e],[t,r]){const i=W(n,t);return 0===i?W(e,r):i}class U_{constructor(e){this.xn=e,this.buffer=new ue(fm),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();fm(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class V_{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;D("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,x.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){Jt(r)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Mt(r)}yield t.Fn(3e5)}))}}class q_{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return E.resolve(lt.at);const r=new U_(t);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),E.resolve(um)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),um):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,i,s,u,d,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,u=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,d=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,f=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(m=Date.now(),Qt()<=$t.in.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${i} in `+(d-u)+`ms\n\tRemoved ${s} targets in `+(f-d)+`ms\n\tRemoved ${_} documents in `+(m-f)+`ms\nTotal Duration: ${m-g}ms`),E.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}class B_{constructor(e,t){this.db=e,this.garbageCollector=new q_(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,i)=>t(i))}addReference(e,t,r){return fl(e,r)}removeReference(e,t,r){return fl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return fl(e,t)}Gn(e,t){return function(r,i){let s=!1;return hm(r).tt(u=>lm(r,u,i).next(d=>(d&&(s=!0),E.resolve(!d)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Kn(e,(u,d)=>{if(d<=t){const f=this.Gn(e,u).next(m=>{if(!m)return s++,r.getEntry(e,u).next(()=>(r.removeEntry(u,G.min()),Br(e).delete([0,ht(u.path)])))});i.push(f)}}).next(()=>E.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return fl(e,t)}Kn(e,t){const r=Br(e);let i,s=lt.at;return r.Z({index:"documentTargetsIndex"},([u,d],{path:f,sequenceNumber:m})=>{0===u?(s!==lt.at&&t(new M(wn(i)),s),s=m,i=f):s=lt.at}).next(()=>{s!==lt.at&&t(new M(wn(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function fl(n,e){return Br(n).put((r=n.currentSequenceNumber,{targetId:0,path:ht(e.path),sequenceNumber:r}));var r}class pm{constructor(){this.changes=new Fr(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,le.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?E.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Z_{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Ki(e).put(r)}removeEntry(e,t,r){return Ki(e).delete(function(i,s){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],ol(s),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=le.newInvalidDocument(t);return Ki(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(vu(t))},(i,s)=>{r=this.jn(t,s)}).next(()=>r)}Wn(e,t){let r={size:0,document:le.newInvalidDocument(t)};return Ki(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(vu(t))},(i,s)=>{r={document:this.jn(t,s),size:hl(s)}}).next(()=>r)}getEntries(e,t){let r=Et();return this.zn(e,t,(i,s)=>{const u=this.jn(i,s);r=r.insert(i,u)}).next(()=>r)}Hn(e,t){let r=Et(),i=new Ie(M.comparator);return this.zn(e,t,(s,u)=>{const d=this.jn(s,u);r=r.insert(s,d),i=i.insert(s,hl(u))}).next(()=>({documents:r,Jn:i}))}zn(e,t,r){if(t.isEmpty())return E.resolve();let i=new ue(_m);t.forEach(f=>i=i.add(f));const s=IDBKeyRange.bound(vu(i.first()),vu(i.last())),u=i.getIterator();let d=u.getNext();return Ki(e).Z({index:"documentKeyIndex",range:s},(f,m,g)=>{const _=M.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;d&&_m(d,_)<0;)r(d,null),d=u.getNext();d&&d.isEqual(_)&&(r(d,m),d=u.hasNext()?u.getNext():null),d?g.j(vu(d)):g.done()}).next(()=>{for(;d;)r(d,null),d=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,r){const i=[t.popLast().toArray(),t.lastSegment(),ol(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ki(e).W(IDBKeyRange.bound(i,s,!0)).next(u=>{let d=Et();for(const f of u){const m=this.jn(M.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);d=d.insert(m.key,m)}return d})}getAllFromCollectionGroup(e,t,r,i){let s=Et();const u=ym(t,r),d=ym(t,it.max());return Ki(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,d,!0)},(f,m,g)=>{const _=this.jn(M.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(_.key,_),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new G_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return gm(e).get("remoteDocumentGlobalKey").next(t=>(Z(!!t),t))}Qn(e,t){return gm(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function A_(n,e){let t;if(e.document)t=Lp(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=M.fromSegments(e.noDocument.path),i=Gi(e.noDocument.readTime);t=le.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{const r=M.fromSegments(e.unknownDocument.path),i=Gi(e.unknownDocument.version);t=le.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new de(r[0],r[1]);return G.fromTimestamp(i)}(e.readTime)),t}(this.yt,t);if(!r.isNoDocument()||!r.version.isEqual(G.min()))return r}return le.newInvalidDocument(e)}}function mm(n){return new Z_(n)}class G_ extends pm{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Fr(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ue((s,u)=>W(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const d=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,d.readTime)),u.isValidDocument()){const f=Hp(this.Yn.yt,u);i=i.add(s.path.popLast()),r+=hl(f)-d.size,t.push(this.Yn.addEntry(e,s,f))}else if(r-=d.size,this.trackRemovals){const f=Hp(this.Yn.yt,u.convertToNoDocument(G.min()));t.push(this.Yn.addEntry(e,s,f))}}),i.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,r)),E.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:i})=>(i.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:r.get(s).readTime})}),r))}}function gm(n){return ze(n,"remoteDocumentGlobal")}function Ki(n){return ze(n,"remoteDocumentsV14")}function vu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ym(n,e){const t=e.documentKey.path.toArray();return[n,ol(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function _m(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=W(t[s],r[s]),i)return i;return i=W(t.length,r.length),i||(i=W(t[t.length-2],r[r.length-2]),i||W(t[t.length-1],r[r.length-1]))}class $_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class vm{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&fe(r.mutation,i,st.empty(),de.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,H()).next(()=>r))}getLocalViewOfDocuments(e,t,r=H()){const i=vn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let u=au();return s.forEach((d,f)=>{u=u.insert(d,f.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=vn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,H()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((u,d)=>{t.set(u,d)})})}computeViews(e,t,r,i){let s=Et();const u=uu(),d=uu();return t.forEach((f,m)=>{const g=r.get(m.key);i.has(m.key)&&(void 0===g||g.mutation instanceof At)?s=s.insert(m.key,m):void 0!==g&&(u.set(m.key,g.mutation.getFieldMask()),fe(g.mutation,m,g.mutation.getFieldMask(),de.now()))}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,g)=>u.set(m,g)),t.forEach((m,g)=>{var _;return d.set(m,new $_(g,null!==(_=u.get(m))&&void 0!==_?_:null))}),d))}recalculateAndSaveOverlays(e,t){const r=uu();let i=new Ie((u,d)=>u-d),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const d of u)d.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let g=r.get(f)||st.empty();g=d.applyToLocalView(m,g),r.set(f,g);const _=(i.get(d.batchId)||H()).add(f);i=i.insert(d.batchId,_)})}).next(()=>{const u=[],d=i.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,g=f.value,_=xp();g.forEach(w=>{if(!s.has(w)){const k=j(t.get(w),r.get(w));null!==k&&_.set(w,k),s=s.add(w)}}),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return E.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return M.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):tu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const u=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):E.resolve(vn());let d=-1,f=s;return u.next(m=>E.forEach(m,(g,_)=>(d<_.largestBatchId&&(d=_.largestBatchId),s.get(g)?E.resolve():this.remoteDocumentCache.getEntry(e,g).next(w=>{f=f.insert(g,w)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,H())).next(g=>({batchId:d,changes:Tp(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new M(t)).next(r=>{let i=au();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=au();return this.indexManager.getCollectionParents(e,i).next(u=>E.forEach(u,d=>{const f=(m=t,g=d.child(i),new ke(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,g;return this.getDocumentsMatchingCollectionQuery(e,f,r).next(m=>{m.forEach((g,_)=>{s=s.insert(g,_)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(s=>{s.forEach((d,f)=>{const m=f.getKey();null===i.get(m)&&(i=i.insert(m,le.newInvalidDocument(m)))});let u=au();return i.forEach((d,f)=>{const m=s.get(d);void 0!==m&&fe(m.mutation,f,st.empty(),de.now()),mo(t,f)&&(u=u.insert(d,f))}),u})}}class j_{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return E.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:Oe(r.createTime)}),E.resolve()}getNamedQuery(e,t){return E.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:nd(r.bundledQuery),readTime:Oe(r.readTime)}),E.resolve();var r}}class z_{constructor(){this.overlays=new Ie(M.comparator),this.es=new Map}getOverlay(e,t){return E.resolve(this.overlays.get(t))}getOverlays(e,t){const r=vn();return E.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.oe(e,t,s)}),E.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.es.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(r)),E.resolve()}getOverlaysForCollection(e,t,r){const i=vn(),s=t.length+1,u=new M(t.child("")),d=this.overlays.getIteratorFrom(u);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>r&&i.set(f.getKey(),f)}return E.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ie((m,g)=>m-g);const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let g=s.get(m.largestBatchId);null===g&&(g=vn(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const d=vn(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,g)=>d.set(m,g)),!(d.size()>=i)););return E.resolve(d)}oe(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new td(t,r));let s=this.es.get(t);void 0===s&&(s=H(),this.es.set(t,s)),this.es.set(t,s.add(r.key))}}class cd{constructor(){this.ns=new ue(We.ss),this.rs=new ue(We.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new We(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new We(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new M(new ne([])),r=new We(t,e),i=new We(t,e+1),s=[];return this.rs.forEachInRange([r,i],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new M(new ne([])),r=new We(t,e),i=new We(t,e+1);let s=H();return this.rs.forEachInRange([r,i],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new We(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class We{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return M.comparator(e.key,t.key)||W(e._s,t._s)}static os(e,t){return W(e._s,t._s)||M.comparator(e.key,t.key)}}class W_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new ue(We.ss)}checkEmpty(e){return E.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.ws;this.ws++;const u=new Xh(s,t,r,i);this.mutationQueue.push(u);for(const d of i)this.gs=this.gs.add(new We(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return E.resolve(u)}lookupMutationBatch(e,t){return E.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ps(t+1),s=i<0?0:i;return E.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return E.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return E.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new We(t,0),i=new We(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([r,i],u=>{const d=this.ys(u._s);s.push(d)}),E.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(W);return t.forEach(i=>{const s=new We(i,0),u=new We(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],d=>{r=r.add(d._s)})}),E.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;M.isDocumentKey(s)||(s=s.child(""));const u=new We(new M(s),0);let d=new ue(W);return this.gs.forEachWhile(f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(d=d.add(f._s)),!0)},u),E.resolve(this.Is(d))}Is(e){const t=[];return e.forEach(r=>{const i=this.ys(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){Z(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return E.forEach(t.mutations,i=>{const s=new We(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new We(t,0),i=this.gs.firstAfterOrEqual(r);return E.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return E.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class K_{constructor(e){this.Es=e,this.docs=new Ie(M.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,u=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return E.resolve(r?r.document.mutableCopy():le.newInvalidDocument(t))}getEntries(e,t){let r=Et();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():le.newInvalidDocument(i))}),E.resolve(r)}getAllFromCollection(e,t,r){let i=Et();const s=new M(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!t.isPrefixOf(d.path))break;d.path.length>t.length+1||so(Ba(f),r)<=0||(i=i.insert(f.key,f.mutableCopy()))}return E.resolve(i)}getAllFromCollectionGroup(e,t,r,i){U()}As(e,t){return E.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new H_(this)}getSize(e){return E.resolve(this.size)}}class H_ extends pm{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),E.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Q_{constructor(e){this.persistence=e,this.Rs=new Fr(t=>tn(t),Xn),this.lastRemoteSnapshotVersion=G.min(),this.highestTargetId=0,this.bs=0,this.Ps=new cd,this.targetCount=0,this.vs=Wi.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,i)=>t(i)),E.resolve()}getLastRemoteSnapshotVersion(e){return E.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return E.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),E.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),E.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Wi(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,E.resolve()}updateTargetData(e,t){return this.Dn(t),E.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,E.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Rs.forEach((u,d)=>{d.sequenceNumber<=t&&null===r.get(d.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),i++)}),E.waitFor(s).next(()=>i)}getTargetCount(e){return E.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return E.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),E.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(u=>{s.push(i.markPotentiallyOrphaned(e,u))}),E.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),E.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return E.resolve(r)}containsKey(e,t){return E.resolve(this.Ps.containsKey(t))}}class Im{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new lt(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Q_(this),this.indexManager=new P_,this.remoteDocumentCache=new K_(r=>this.referenceDelegate.xs(r)),this.yt=new Kp(t),this.Ns=new j_(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new z_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new W_(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);const i=new Y_(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(s=>this.referenceDelegate.Os(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ms(e,t){return E.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class Y_ extends Za{constructor(e){super(),this.currentSequenceNumber=e}}class pl{constructor(e){this.persistence=e,this.Fs=new cd,this.$s=null}static Bs(e){return new pl(e)}get Ls(){if(this.$s)return this.$s;throw U()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),E.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),E.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),E.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ls.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return E.forEach(this.Ls,r=>{const i=M.fromPath(r);return this.qs(e,i).next(s=>{s||t.removeEntry(i,G.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return E.or([()=>E.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class J_{constructor(e){this.yt=e}$(e,t,r,i){const s=new oo("createOrUpgrade",t);var d;r<1&&i>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gp,{unique:!0}),d.createObjectStore("documentMutations"),wm(e),function(d){d.createObjectStore("remoteDocuments")}(e));let u=E.resolve();return r<3&&i>=3&&(0!==r&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),wm(e)),u=u.next(()=>function(d){const f=d.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:G.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(d,f){return f.store("mutations").W().next(m=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Gp,{unique:!0});const g=f.store("mutations"),_=m.map(w=>g.put(w));return E.waitFor(_)})}(e,s))),u=u.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Us(s))),r<6&&i>=6&&(u=u.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),r<7&&i>=7&&(u=u.next(()=>this.Gs(s))),r<8&&i>=8&&(u=u.next(()=>this.Qs(e,s))),r<9&&i>=9&&(u=u.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.js(s))),r<11&&i>=11&&(u=u.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(d){const f=d.createObjectStore("documentOverlays",{keyPath:b_});f.createIndex("collectionPathOverlayIndex",E_,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",T_,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(d){const f=d.createObjectStore("remoteDocumentsV14",{keyPath:h_});f.createIndex("documentKeyIndex",d_),f.createIndex("collectionGroupIndex",f_)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.zs(e,s))),r<15&&i>=15&&(u=u.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:__}).createIndex("sequenceNumberIndex",v_,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:I_}).createIndex("documentKeyIndex",w_,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=hl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>E.forEach(i,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",u).next(d=>E.forEach(d,f=>{Z(f.userId===s.userId);const m=$i(this.yt,f);return cm(e,s.userId,m).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((u,d)=>{const f=new ne(u),m=[0,ht(f)];s.push(t.get(m).next(g=>g?E.resolve():t.put({targetId:0,path:ht(f),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>E.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:y_});const r=t.store("collectionParents"),i=new ud,s=u=>{if(i.add(u)){const d=u.lastSegment(),f=u.popLast();return r.put({collectionId:d,parent:ht(f)})}};return t.store("remoteDocuments").Z({X:!0},(u,d)=>{const f=new ne(u);return s(f.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,d,f],m)=>{const g=wn(d);return s(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,i)=>{const s=pu(i),u=Qp(this.yt,s);return t.put(u)})}Ws(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((s,u)=>{const d=t.store("remoteDocumentsV14"),f=(m=u,m.document?new M(ne.fromString(m.document.name).popFirst(5)):m.noDocument?M.fromSegments(m.noDocument.path):m.unknownDocument?M.fromSegments(m.unknownDocument.path):U()).path.toArray();var m;const g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(d.put(g))}).next(()=>E.waitFor(i))}zs(e,t){const r=t.store("mutations"),i=mm(this.yt),s=new Im(pl.Bs,this.yt.ie);return r.W().next(u=>{const d=new Map;return u.forEach(f=>{var m;let g=null!==(m=d.get(f.userId))&&void 0!==m?m:H();$i(this.yt,f).keys().forEach(_=>g=g.add(_)),d.set(f.userId,g)}),E.forEach(d,(f,m)=>{const g=new Ue(m),_=al.re(this.yt,g),w=s.getIndexManager(g),k=dl.re(g,this.yt,w,s.referenceDelegate);return new vm(i,k,_,w).recalculateAndSaveOverlaysForDocumentKeys(new Jh(t,lt.at),f).next()})})}}function wm(n){n.createObjectStore("targetDocuments",{keyPath:m_}).createIndex("documentTargetsIndex",g_,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",p_,{unique:!0}),n.createObjectStore("targetGlobal")}const ld="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class hd{constructor(e,t,r,i,s,u,d,f,m,g,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=s,this.window=u,this.document=d,this.Js=m,this.Ys=g,this.Xs=_,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=w=>Promise.resolve(),!hd.C())throw new A(T.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new B_(this,i),this.ii=t+"main",this.yt=new Kp(f),this.ri=new ct(this.ii,this.Xs,new J_(this.yt)),this.Cs=new F_(this.referenceDelegate,this.yt),this.remoteDocumentCache=mm(this.yt),this.Ns=new S_,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&xe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(T.FAILED_PRECONDITION,ld);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new lt(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,x.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,x.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,x.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>ml(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(Jt(e))return D("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Iu(e).get("owner").next(t=>E.resolve(this.mi(t)))}gi(e){return ml(e).delete(this.clientId)}yi(){var e=this;return(0,x.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=ze(r,"clientMetadata");return i.W().next(s=>{const u=e.Ii(s,18e5),d=s.filter(f=>-1===u.indexOf(f));return E.forEach(d,f=>i.delete(f.clientId)).next(()=>d)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?E.resolve(!0):Iu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new A(T.FAILED_PRECONDITION,ld);return!1}}return!(!this.networkEnabled||!this.inForeground)||ml(e).W().next(r=>void 0===this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,d=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&d)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&D("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,x.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Jh(t,lt.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>ml(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return dl.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new L_(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return al.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){D("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?k_:14===u?Wp:13===u?zp:12===u?x_:11===u?jp:void U();var u;let d;return this.ri.runTransaction(e,i,s,f=>(d=new Jh(f,this.Ss?this.Ss.next():lt.at),"readwrite-primary"===t?this.fi(d).next(m=>!!m||this.di(d)).next(m=>{if(!m)throw xe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new A(T.FAILED_PRECONDITION,Nc);return r(d)}).next(m=>this.wi(d).next(()=>m)):this.Vi(d).next(()=>r(d)))).then(f=>(d.raiseOnCommittedEvent(),f))}Vi(e){return Iu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new A(T.FAILED_PRECONDITION,ld)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Iu(e).put("owner",t)}static C(){return ct.C()}_i(e){const t=Iu(e);return t.get("owner").next(r=>this.mi(r)?(D("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):E.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(xe(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,te.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return D("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return xe("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){xe("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Iu(n){return ze(n,"owner")}function ml(n){return ze(n,"clientMetadata")}function dd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class fd{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=i}static Ci(e,t){let r=H(),i=H();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new fd(e,t.fromCache,r,i)}}class bm{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.ki(e,t).next(s=>s||this.Oi(e,t,i,r)).next(s=>s||this.Mi(e,t))}ki(e,t){if(Yc(t))return E.resolve(null);let r=Ye(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=Ui(t,null,"F"),r=Ye(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const u=H(...s);return this.Ni.getDocuments(e,u).next(d=>this.indexManager.getMinOffset(e,r).next(f=>{const m=this.Fi(t,d);return this.$i(t,m,u,f.readTime)?this.ki(e,Ui(t,null,"F")):this.Bi(e,m,t,f)}))})))}Oi(e,t,r,i){return Yc(t)||i.isEqual(G.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,r,i)?this.Mi(e,t):(Qt()<=$t.in.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),nu(t)),this.Bi(e,u,t,Rc(i,-1)))})}Fi(e,t){let r=new ue(go(e));return t.forEach((i,s)=>{mo(e,s)&&(r=r.add(s))}),r}$i(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mi(e,t){return Qt()<=$t.in.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",nu(t)),this.Ni.getDocumentsMatchingQuery(e,t,it.min())}Bi(e,t,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class X_{constructor(e,t,r,i){this.persistence=e,this.Li=t,this.yt=i,this.qi=new Ie(W),this.Ui=new Fr(s=>tn(s),Xn),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new vm(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Em(n,e,t,r){return new X_(n,e,t,r)}function Tm(n,e){return pd.apply(this,arguments)}function pd(){return pd=(0,x.Z)(function*(n,e){const t=O(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const u=[],d=[];let f=H();for(const m of i){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of s){d.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return t.localDocuments.getDocuments(r,f).next(m=>({ji:m,removedBatchIds:u,addedBatchIds:d}))})})}),pd.apply(this,arguments)}function ev(n,e){const t=O(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,d,f,m){const g=f.batch,_=g.keys();let w=E.resolve();return _.forEach(k=>{w=w.next(()=>m.getEntry(d,k)).next(S=>{const P=f.docVersions.get(k);Z(null!==P),S.version.compareTo(P)<0&&(g.applyToRemoteDocument(S,f),S.isValidDocument()&&(S.setReadTime(f.commitVersion),m.addEntry(S)))})}),w.next(()=>u.mutationQueue.removeMutationBatch(d,g))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let d=H();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function xm(n){const e=O(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function tv(n,e){const t=O(n),r=e.snapshotVersion;let i=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});i=t.qi;const d=[];e.targetChanges.forEach((g,_)=>{const w=i.get(_);if(!w)return;d.push(t.Cs.removeMatchingKeys(s,g.removedDocuments,_).next(()=>t.Cs.addMatchingKeys(s,g.addedDocuments,_)));let k=w.withSequenceNumber(s.currentSequenceNumber);var S,P,q;e.targetMismatches.has(_)?k=k.withResumeToken(De.EMPTY_BYTE_STRING,G.min()).withLastLimboFreeSnapshotVersion(G.min()):g.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(g.resumeToken,r)),i=i.insert(_,k),P=k,q=g,(0===(S=w).resumeToken.approximateByteSize()||P.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8||q.addedDocuments.size+q.modifiedDocuments.size+q.removedDocuments.size>0)&&d.push(t.Cs.updateTargetData(s,k))});let f=Et(),m=H();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),d.push(km(s,u,e.documentUpdates).next(g=>{f=g.Wi,m=g.zi})),!r.isEqual(G.min())){const g=t.Cs.getLastRemoteSnapshotVersion(s).next(_=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,r));d.push(g)}return E.waitFor(d).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.qi=i,s))}function km(n,e,t){let r=H(),i=H();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let u=Et();return t.forEach((d,f)=>{const m=s.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(d)),f.isNoDocument()&&f.version.isEqual(G.min())?(e.removeEntry(d,f.readTime),u=u.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(d,f)):D("LocalStore","Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)}),{Wi:u,zi:i}})}function nv(n,e){const t=O(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ko(n,e){const t=O(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Cs.getTargetData(r,e).next(s=>s?(i=s,E.resolve(i)):t.Cs.allocateTargetId(r).next(u=>(i=new Ur(e,u,0,r.currentSequenceNumber),t.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.qi.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}function Ao(n,e,t){return md.apply(this,arguments)}function md(){return md=(0,x.Z)(function*(n,e,t){const r=O(n),i=r.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!Jt(u))throw u;D("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.qi=r.qi.remove(e),r.Ui.delete(i.target)}),md.apply(this,arguments)}function gl(n,e,t){const r=O(n);let i=G.min(),s=H();return r.persistence.runTransaction("Execute query","readonly",u=>function(d,f,m){const g=O(d),_=g.Ui.get(m);return void 0!==_?E.resolve(g.qi.get(_)):g.Cs.getTargetData(f,m)}(r,u,Ye(e)).next(d=>{if(d)return i=d.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(u,d.targetId).next(f=>{s=f})}).next(()=>r.Li.getDocumentsMatchingQuery(u,e,t?i:G.min(),t?s:H())).next(d=>(Cm(r,Je(e),d),{documents:d,Hi:s})))}function Am(n,e){const t=O(n),r=O(t.Cs),i=t.qi.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ne(s,e).next(u=>u?u.target:null))}function Sm(n,e){const t=O(n),r=t.Ki.get(e)||G.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Gi.getAllFromCollectionGroup(i,e,Rc(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Cm(t,e,i),i))}function Cm(n,e,t){let r=n.Ki.get(e)||G.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Ki.set(e,r)}function gd(){return gd=(0,x.Z)(function*(n,e,t,r){const i=O(n);let s=H(),u=Et();for(const m of t){const g=e.Ji(m.metadata.name);m.document&&(s=s.add(g));const _=e.Yi(m);_.setReadTime(e.Xi(m.metadata.readTime)),u=u.insert(g,_)}const d=i.Gi.newChangeBuffer({trackRemovals:!0}),f=yield ko(i,(m=r,Ye(er(ne.fromString(`__bundle__/docs/${m}`)))));var m;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>km(m,d,u).next(g=>(d.apply(m),g)).next(g=>i.Cs.removeMatchingKeysForTargetId(m,f.targetId).next(()=>i.Cs.addMatchingKeys(m,s,f.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,g.Wi,g.zi)).next(()=>g.Wi)))}),gd.apply(this,arguments)}function iv(n,e){return yd.apply(this,arguments)}function yd(){return yd=(0,x.Z)(function*(n,e,t=H()){const r=yield ko(n,Ye(nd(e.bundledQuery))),i=O(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const u=Oe(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ns.saveNamedQuery(s,e);const d=r.withResumeToken(De.EMPTY_BYTE_STRING,u);return i.qi=i.qi.insert(d.targetId,d),i.Cs.updateTargetData(s,d).next(()=>i.Cs.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Cs.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ns.saveNamedQuery(s,e))})}),yd.apply(this,arguments)}function Dm(n,e){return`firestore_clients_${n}_${e}`}function Rm(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function _d(n,e){return`firestore_targets_${n}_${e}`}class yl{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Zi(e,t,r){const i=JSON.parse(r);let s,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(s=new A(i.error.code,i.error.message))),u?new yl(e,t,i.state,s):(xe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class wu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new A(r.error.code,r.error.message))),s?new wu(e,r.state,i):(xe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class _l{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=rl();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=Lc(r.activeTargetIds[u]),s=s.add(r.activeTargetIds[u]);return i?new _l(e,s):(xe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class vd{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vd(t.clientId,t.onlineState):(xe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Id{constructor(){this.activeTargetIds=rl()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wd{constructor(e,t,r,i,s){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new Ie(W),this.started=!1,this.cr=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Dm(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new Id),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,x.Z)(function*(){const t=yield e.syncEngine.vi();for(const i of t){if(i===e.sr)continue;const s=e.getItem(Dm(e.persistenceKey,i));if(s){const u=_l.Zi(i,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const i=e.yr(r);i&&e.pr(i)}for(const i of e.cr)e.rr(i);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(_d(this.persistenceKey,e));if(r){const i=wu.Zi(e,r);i&&(t=i.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(_d(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Er(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return D("SharedClientState","READ",e,t),t}setItem(e,t){D("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){D("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(D("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void xe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,x.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const i=t.vr(r.key);return t.Vr(i,null)}{const i=t.Sr(r.key,r.newValue);if(i)return t.Vr(i.clientId,i)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const i=t.Dr(r.key,r.newValue);if(i)return t.Cr(i)}}else if(t._r.test(r.key)){if(null!==r.newValue){const i=t.Nr(r.key,r.newValue);if(i)return t.kr(i)}}else if(r.key===t.wr){if(null!==r.newValue){const i=t.yr(r.newValue);if(i)return t.pr(i)}}else if(r.key===t.hr){const i=function(s){let u=lt.at;if(null!=s)try{const d=JSON.parse(s);Z("number"==typeof d),u=d}catch(d){xe("SharedClientState","Failed to read sequence number from WebStorage",d)}return u}(r.newValue);i!==lt.at&&t.sequenceNumberHandler(i)}else if(r.key===t.mr){const i=t.Or(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const i=new yl(this.currentUser,e,t,r),s=Rm(this.persistenceKey,this.currentUser,e);this.setItem(s,i.tr())}Er(e){const t=Rm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const i=_d(this.persistenceKey,e),s=new wu(e,t,r);this.setItem(i,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return _l.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),i=Number(r[1]);return yl.Zi(new Ue(void 0!==r[2]?r[2]:null),i,t)}Nr(e,t){const r=this._r.exec(e),i=Number(r[1]);return wu.Zi(i,t)}yr(e){return vd.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,x.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);D("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),i=this.Ir(this.ur),s=this.Ir(r),u=[],d=[];return s.forEach(f=>{i.has(f)||u.push(f)}),i.forEach(f=>{s.has(f)||d.push(f)}),this.syncEngine.Br(u,d).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=rl();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Nm{constructor(){this.Lr=new Id,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Id,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class sv{Ur(e){}shutdown(){}}class Om{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const ov={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class av{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class uv extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,i,s){const u=this.ho(e,t);D("RestConnection","Sending: ",u,r);const d={};return this.lo(d,i,s),this.fo(e,u,d,r).then(f=>(D("RestConnection","Received: ",f),f),f=>{throw zn("RestConnection",`${e} failed with error: `,f,"url: ",u,"request:",r),f})}_o(e,t,r,i,s,u){return this.ao(e,t,r,i,s)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+fn,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}ho(e,t){return`${this.oo}/v1/${t}:${ov[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,i){return new Promise((s,u)=>{const d=new Xs;d.setWithCredentials(!0),d.listenOnce(Pa.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Ma.NO_ERROR:const m=d.getResponseJson();D("Connection","XHR received:",JSON.stringify(m)),s(m);break;case Ma.TIMEOUT:D("Connection",'RPC "'+e+'" timed out'),u(new A(T.DEADLINE_EXCEEDED,"Request time out"));break;case Ma.HTTP_ERROR:const g=d.getStatus();if(D("Connection",'RPC "'+e+'" failed with status:',g,"response text:",d.getResponseText()),g>0){let _=d.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=null==_?void 0:_.error;if(w&&w.status&&w.message){const k=function(S){const P=S.toLowerCase().replace(/_/g,"-");return Object.values(T).indexOf(P)>=0?P:T.UNKNOWN}(w.status);u(new A(k,w.message))}else u(new A(T.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new A(T.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{D("Connection",'RPC "'+e+'" completed.')}});const f=JSON.stringify(i);d.send(t,"POST",f,r,15)})}wo(e,t,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=kh(),u=Oa(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(d.xmlHttpFactory=new Sh({})),this.lo(d.initMessageHeaders,t,r),d.encodeInitMessageHeaders=!0;const f=i.join("");D("Connection","Creating WebChannel: "+f,d);const m=s.createWebChannel(f,d);let g=!1,_=!1;const w=new av({Hr:S=>{_?D("Connection","Not sending because WebChannel is closed:",S):(g||(D("Connection","Opening WebChannel transport."),m.open(),g=!0),D("Connection","WebChannel sending:",S),m.send(S))},Jr:()=>m.close()}),k=(S,P,q)=>{S.listen(P,oe=>{try{q(oe)}catch(ce){setTimeout(()=>{throw ce},0)}})};return k(m,xr.EventType.OPEN,()=>{_||D("Connection","WebChannel transport opened.")}),k(m,xr.EventType.CLOSE,()=>{_||(_=!0,D("Connection","WebChannel transport closed"),w.io())}),k(m,xr.EventType.ERROR,S=>{_||(_=!0,zn("Connection","WebChannel transport errored:",S),w.io(new A(T.UNAVAILABLE,"The operation could not be completed")))}),k(m,xr.EventType.MESSAGE,S=>{var P;if(!_){const q=S.data[0];Z(!!q);const oe=q,ce=oe.error||(null===(P=oe[0])||void 0===P?void 0:P.error);if(ce){D("Connection","WebChannel received error:",ce);const ee=ce.status;let Q=function(J){const Ge=Ae[J];if(void 0!==Ge)return nl(Ge)}(ee),K=ce.message;void 0===Q&&(Q=T.INTERNAL,K="Unknown error status: "+ee+" with message "+ce.message),_=!0,w.io(new A(Q,K)),m.close()}else D("Connection","WebChannel received:",q),w.ro(q)}}),k(u,Ah.STAT_EVENT,S=>{S.stat===Js.PROXY?D("Connection","Detected buffering proxy"):S.stat===Js.NOPROXY&&D("Connection","Detected no buffering proxy")}),setTimeout(()=>{w.so()},0),w}}function Mm(){return"undefined"!=typeof window?window:null}function vl(){return"undefined"!=typeof document?document:null}function bu(n){return new Xy(n,!0)}class bd{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-r);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Pm{constructor(e,t,r,i,s,u,d,f){this.Hs=e,this.vo=r,this.Vo=i,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new bd(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,x.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,x.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var r=this;return(0,x.Z)(function*(){r.Lo(),r.qo(),r.xo.cancel(),r.So++,4!==e?r.xo.reset():t&&t.code===T.RESOURCE_EXHAUSTED?(xe(t.toString()),xe("Using maximum backoff delay to prevent overloading the backend."),r.xo.Ao()):t&&t.code===T.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Uo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.So===t&&this.Go(r,i)},r=>{e(()=>{const i=new A(T.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(i)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.Qo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,x.Z)(function*(){e.state=0,e.start()}))}Qo(e){return D("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class cv extends Pm{constructor(e,t,r,i,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function n_(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:U(),i=e.targetChange.targetIds||[],s=function(f,m){return f.wt?(Z(void 0===m||"string"==typeof m),De.fromBase64String(m||"")):(Z(void 0===m||m instanceof Uint8Array),De.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,d=u&&function(f){const m=void 0===f.code?T.UNKNOWN:nl(f.code);return new A(m,f.message||"")}(u);t=new Ap(r,i,s,d||null)}else if("documentChange"in e){const r=e.documentChange,i=In(n,r.document.name),s=Oe(r.document.updateTime),u=r.document.createTime?Oe(r.document.createTime):G.min(),d=new Ze({mapValue:{fields:r.document.fields}}),f=le.newFoundDocument(i,s,u,d);t=new il(r.targetIds||[],r.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const r=e.documentDelete,i=In(n,r.document),s=r.readTime?Oe(r.readTime):G.min(),u=le.newNoDocument(i,s);t=new il([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=In(n,r.document);t=new il([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return U();{const r=e.filter,s=new ou(r.count||0);t=new kp(r.targetId,s)}}var f;return t}(this.yt,e),r=function(i){if(!("targetChange"in i))return G.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?G.min():s.readTime?Oe(s.readTime):G.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=du(this.yt),t.addTarget=function(i,s){let u;const d=s.target;return u=Li(d)?{documents:Fp(i,d)}:{query:Yh(i,d)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Rp(i,s.resumeToken):s.snapshotVersion.compareTo(G.min())>0&&(u.readTime=wo(i,s.snapshotVersion.toTimestamp())),u}(this.yt,e);const r=function i_(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return U()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=du(this.yt),t.removeTarget=e,this.Bo(t)}}class lv extends Pm{constructor(e,t,r,i,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(Z(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function r_(n,e){return n&&n.length>0?(Z(void 0!==e),n.map(t=>function(r,i){let s=Oe(r.updateTime?r.updateTime:i);return s.isEqual(G.min())&&(s=Oe(i)),new v(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Oe(e.commitTime);return this.listener.Zo(r,t)}return Z(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=du(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>fu(this.yt,r))};this.Bo(t)}}class hv extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=i,this.nu=!1}su(){if(this.nu)throw new A(T.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.ao(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new A(T.UNKNOWN,i.toString())})}_o(e,t,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection._o(e,t,r,s,u,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===T.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new A(T.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class fv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(xe(t),this.ou=!1):D("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class pv{constructor(e,t,r,i,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(d=>{r.enqueueAndForget((0,x.Z)(function*(){var f;sr(u)&&(D("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,x.Z)(function*(m){const g=O(m);g._u.add(4),yield So(g),g.gu.set("Unknown"),g._u.delete(4),yield Eu(g)}),function(m){return f.apply(this,arguments)})(u))}))}),this.gu=new fv(r,i)}}function Eu(n){return Td.apply(this,arguments)}function Td(){return Td=(0,x.Z)(function*(n){if(sr(n))for(const e of n.wu)yield e(!0)}),Td.apply(this,arguments)}function So(n){return xd.apply(this,arguments)}function xd(){return xd=(0,x.Z)(function*(n){for(const e of n.wu)yield e(!1)}),xd.apply(this,arguments)}function Il(n,e){const t=O(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Sd(t)?Ad(t):Do(t).ko()&&kd(t,e))}function Tu(n,e){const t=O(n),r=Do(t);t.du.delete(e),r.ko()&&Lm(t,e),0===t.du.size&&(r.ko()?r.Fo():sr(t)&&t.gu.set("Unknown"))}function kd(n,e){n.yu.Ot(e.targetId),Do(n).zo(e)}function Lm(n,e){n.yu.Ot(e),Do(n).Ho(e)}function Ad(n){n.yu=new Hy({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),Do(n).start(),n.gu.uu()}function Sd(n){return sr(n)&&!Do(n).No()&&n.du.size>0}function sr(n){return 0===O(n)._u.size}function Fm(n){n.yu=void 0}function mv(n){return Cd.apply(this,arguments)}function Cd(){return Cd=(0,x.Z)(function*(n){n.du.forEach((e,t)=>{kd(n,e)})}),Cd.apply(this,arguments)}function gv(n,e){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,x.Z)(function*(n,e){Fm(n),Sd(n)?(n.gu.hu(e),Ad(n)):n.gu.set("Unknown")}),Dd.apply(this,arguments)}function yv(n,e,t){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,x.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof Ap&&2===e.state&&e.cause)try{yield(r=(0,x.Z)(function*(i,s){const u=s.cause;for(const d of s.targetIds)i.du.has(d)&&(yield i.remoteSyncer.rejectListen(d,u),i.du.delete(d),i.yu.removeTarget(d))}),function(i,s){return r.apply(this,arguments)})(n,e)}catch(r){D("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield wl(n,r)}else if(e instanceof il?n.yu.Kt(e):e instanceof kp?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(G.min()))try{const r=yield xm(n.localStore);t.compareTo(r)>=0&&(yield function(i,s){const u=i.yu.Zt(s);return u.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const m=i.du.get(f);m&&i.du.set(f,m.withResumeToken(d.resumeToken,s))}}),u.targetMismatches.forEach(d=>{const f=i.du.get(d);if(!f)return;i.du.set(d,f.withResumeToken(De.EMPTY_BYTE_STRING,f.snapshotVersion)),Lm(i,d);const m=new Ur(f.target,d,1,f.sequenceNumber);kd(i,m)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){D("RemoteStore","Failed to raise snapshot:",r),yield wl(n,r)}var r}),Rd.apply(this,arguments)}function wl(n,e,t){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,x.Z)(function*(n,e,t){if(!Jt(e))throw e;n._u.add(1),yield So(n),n.gu.set("Offline"),t||(t=()=>xm(n.localStore)),n.asyncQueue.enqueueRetryable((0,x.Z)(function*(){D("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Eu(n)}))}),Nd.apply(this,arguments)}function Um(n,e){return e().catch(t=>wl(n,t,e))}function Co(n){return Od.apply(this,arguments)}function Od(){return Od=(0,x.Z)(function*(n){const e=O(n),t=Zr(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;_v(e);)try{const i=yield nv(e.localStore,r);if(null===i){0===e.fu.length&&t.Fo();break}r=i.batchId,vv(e,i)}catch(i){yield wl(e,i)}Vm(e)&&qm(e)}),Od.apply(this,arguments)}function _v(n){return sr(n)&&n.fu.length<10}function vv(n,e){n.fu.push(e);const t=Zr(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Vm(n){return sr(n)&&!Zr(n).No()&&n.fu.length>0}function qm(n){Zr(n).start()}function Iv(n){return Md.apply(this,arguments)}function Md(){return Md=(0,x.Z)(function*(n){Zr(n).eu()}),Md.apply(this,arguments)}function wv(n){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,x.Z)(function*(n){const e=Zr(n);for(const t of n.fu)e.Xo(t.mutations)}),Pd.apply(this,arguments)}function bv(n,e,t){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,x.Z)(function*(n,e,t){const r=n.fu.shift(),i=ed.from(r,e,t);yield Um(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Co(n)}),Ld.apply(this,arguments)}function Ev(n,e){return Fd.apply(this,arguments)}function Fd(){return Fd=(0,x.Z)(function*(n,e){var t;e&&Zr(n).Yo&&(yield(t=(0,x.Z)(function*(r,i){if(Io(s=i.code)&&s!==T.ABORTED){const u=r.fu.shift();Zr(r).Mo(),yield Um(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield Co(r)}var s}),function(r,i){return t.apply(this,arguments)})(n,e)),Vm(n)&&qm(n)}),Fd.apply(this,arguments)}function Bm(n,e){return Ud.apply(this,arguments)}function Ud(){return Ud=(0,x.Z)(function*(n,e){const t=O(n);t.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");const r=sr(t);t._u.add(3),yield So(t),r&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Eu(t)}),Ud.apply(this,arguments)}function Vd(n,e){return qd.apply(this,arguments)}function qd(){return qd=(0,x.Z)(function*(n,e){const t=O(n);e?(t._u.delete(2),yield Eu(t)):e||(t._u.add(2),yield So(t),t.gu.set("Unknown"))}),qd.apply(this,arguments)}function Do(n){return n.pu||(n.pu=function(e,t,r){const i=O(e);return i.su(),new cv(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:mv.bind(null,n),Zr:gv.bind(null,n),Wo:yv.bind(null,n)}),n.wu.push(function(){var e=(0,x.Z)(function*(t){t?(n.pu.Mo(),Sd(n)?Ad(n):n.gu.set("Unknown")):(yield n.pu.stop(),Fm(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function Zr(n){return n.Iu||(n.Iu=function(e,t,r){const i=O(e);return i.su(),new lv(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:Iv.bind(null,n),Zr:Ev.bind(null,n),tu:wv.bind(null,n),Zo:bv.bind(null,n)}),n.wu.push(function(){var e=(0,x.Z)(function*(t){t?(n.Iu.Mo(),yield Co(n)):(yield n.Iu.stop(),n.fu.length>0&&(D("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class Bd{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Ne,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,s){const u=Date.now()+r,d=new Bd(e,t,u,i,s);return d.start(r),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(T.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ro(n,e){if(xe("AsyncQueue",`${e}: ${n}`),Jt(n))return new A(T.UNAVAILABLE,`${e}: ${n}`);throw n}class No{constructor(e){this.comparator=e?(t,r)=>e(t,r)||M.comparator(t.key,r.key):(t,r)=>M.comparator(t.key,r.key),this.keyedMap=au(),this.sortedSet=new Ie(this.comparator)}static emptySet(e){return new No(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof No)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new No;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Zm{constructor(){this.Tu=new Ie(M.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?0!==e.type&&3===r.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==r.type?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Tu=this.Tu.remove(t):1===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):U():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class Oo{constructor(e,t,r,i,s,u,d,f,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,s){const u=[];return t.forEach(d=>{u.push({type:0,doc:d})}),new Oo(e,t,No.emptySet(t),u,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Vi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Tv{constructor(){this.Au=void 0,this.listeners=[]}}class xv{constructor(){this.queries=new Fr(e=>Jc(e),Vi),this.onlineState="Unknown",this.Ru=new Set}}function Zd(n,e){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,x.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new Tv),i)try{s.Au=yield t.onListen(r)}catch(u){const d=Ro(u,`Initialization of query '${nu(e.query)}' failed`);return void e.onError(d)}t.queries.set(r,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&zd(t)}),Gd.apply(this,arguments)}function $d(n,e){return jd.apply(this,arguments)}function jd(){return jd=(0,x.Z)(function*(n,e){const t=O(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),jd.apply(this,arguments)}function kv(n,e){const t=O(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const d of u.listeners)d.Pu(i)&&(r=!0);u.Au=i}}r&&zd(t)}function Av(n,e,t){const r=O(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function zd(n){n.Ru.forEach(e=>{e.next()})}class Wd{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new Oo(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Oo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Sv{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Gm{constructor(e){this.yt=e}Ji(e){return In(this.yt,e)}Yi(e){return e.metadata.exists?Lp(this.yt,e.document,!1):le.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Oe(e)}}class Cv{constructor(e,t,r){this.Mu=e,this.localStore=t,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$m(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const r=ne.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new Gm(this.yt);for(const i of e)if(i.metadata.queries){const s=r.Ji(i.metadata.name);for(const u of i.metadata.queries){const d=(t.get(u)||H()).add(s);t.set(u,d)}}return t}complete(){var e=this;return(0,x.Z)(function*(){const t=yield function rv(n,e,t,r){return gd.apply(this,arguments)}(e.localStore,new Gm(e.yt),e.documents,e.Mu.id),r=e.$u(e.documents);for(const i of e.queries)yield iv(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function $m(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class jm{constructor(e){this.key=e}}class zm{constructor(e){this.key=e}}class Wm{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=H(),this.mutatedKeys=H(),this.Gu=go(e),this.Qu=new No(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new Zm,i=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=i,d=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,_)=>{const w=i.get(g),k=mo(this.query,_)?_:null,S=!!w&&this.mutatedKeys.has(w.key),P=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let q=!1;w&&k?w.data.isEqual(k.data)?S!==P&&(r.track({type:3,doc:k}),q=!0):this.Hu(w,k)||(r.track({type:2,doc:k}),q=!0,(f&&this.Gu(k,f)>0||m&&this.Gu(k,m)<0)&&(d=!0)):!w&&k?(r.track({type:0,doc:k}),q=!0):w&&!k&&(r.track({type:1,doc:w}),q=!0,(f||m)&&(d=!0)),q&&(k?(u=u.add(k),s=P?s.add(g):s.delete(g)):(u=u.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{Qu:u,zu:r,$i:d,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((m,g)=>function(_,w){const k=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return k(_)-k(w)}(m.type,g.type)||this.Gu(m.doc,g.doc)),this.Ju(r);const u=t?this.Yu():[],d=0===this.Ku.size&&this.current?1:0,f=d!==this.Uu;return this.Uu=d,0!==s.length||f?{snapshot:new Oo(this.query,e.Qu,i,s,e.mutatedKeys,0===d,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Zm,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=H(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new zm(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new jm(r))}),t}tc(e){this.qu=e.Hi,this.Ku=H();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Oo.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Dv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Rv{constructor(e){this.key=e,this.nc=!1}}class Nv{constructor(e,t,r,i,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new Fr(d=>Jc(d),Vi),this.rc=new Map,this.oc=new Set,this.uc=new Ie(M.comparator),this.cc=new Map,this.ac=new cd,this.hc={},this.lc=new Map,this.fc=Wi.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Ov(n,e){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,x.Z)(function*(n,e){const t=_f(n);let r,i;const s=t.ic.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const u=yield ko(t.localStore,Ye(e));t.isPrimaryClient&&Il(t.remoteStore,u);const d=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield Hd(t,e,r,"current"===d,u.resumeToken)}return i}),Kd.apply(this,arguments)}function Hd(n,e,t,r,i){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,x.Z)(function*(n,e,t,r,i){n._c=(_,w,k)=>{return(S=(0,x.Z)(function*(P,q,oe,ce){let ee=q.view.Wu(oe);ee.$i&&(ee=yield gl(P.localStore,q.query,!1).then(({documents:J})=>q.view.Wu(J,ee)));const Q=ce&&ce.targetChanges.get(q.targetId),K=q.view.applyChanges(ee,P.isPrimaryClient,Q);return af(P,q.targetId,K.Xu),K.snapshot}),function(P,q,oe,ce){return S.apply(this,arguments)})(n,_,w,k);var S};const s=yield gl(n.localStore,e,!0),u=new Wm(e,s.Hi),d=u.Wu(s.documents),f=lu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),m=u.applyChanges(d,n.isPrimaryClient,f);af(n,t,m.Xu);const g=new Dv(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),m.snapshot}),Qd.apply(this,arguments)}function Mv(n,e){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,x.Z)(function*(n,e){const t=O(n),r=t.ic.get(e),i=t.rc.get(r.targetId);if(i.length>1)return t.rc.set(r.targetId,i.filter(s=>!Vi(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield Ao(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Tu(t.remoteStore,r.targetId),Mo(t,r.targetId)}).catch(Mt))):(Mo(t,r.targetId),yield Ao(t.localStore,r.targetId,!0))}),Yd.apply(this,arguments)}function Jd(){return Jd=(0,x.Z)(function*(n,e,t){const r=vf(n);try{const i=yield function(s,u){const d=O(s),f=de.now(),m=u.reduce((w,k)=>w.add(k.key),H());let g,_;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=Et(),S=H();return d.Gi.getEntries(w,m).next(P=>{k=P,k.forEach((q,oe)=>{oe.isValidDocument()||(S=S.add(q))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,k)).next(P=>{g=P;const q=[];for(const oe of u){const ce=kt(oe,g.get(oe.key).overlayedDocument);null!=ce&&q.push(new At(oe.key,ce,Hc(ce.value.mapValue),b.exists(!0)))}return d.mutationQueue.addMutationBatch(w,f,q,u)}).next(P=>{_=P;const q=P.applyToLocalDocumentSet(g,S);return d.documentOverlayCache.saveOverlays(w,P.batchId,q)})}).then(()=>({batchId:_.batchId,changes:Tp(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,u,d){let f=s.hc[s.currentUser.toKey()];f||(f=new Ie(W)),f=f.insert(u,d),s.hc[s.currentUser.toKey()]=f}(r,i.batchId,t),yield or(r,i.changes),yield Co(r.remoteStore)}catch(i){const s=Ro(i,"Failed to persist write");t.reject(s)}}),Jd.apply(this,arguments)}function Km(n,e){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,x.Z)(function*(n,e){const t=O(n);try{const r=yield tv(t.localStore,e);e.targetChanges.forEach((i,s)=>{const u=t.cc.get(s);u&&(Z(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.nc=!0:i.modifiedDocuments.size>0?Z(u.nc):i.removedDocuments.size>0&&(Z(u.nc),u.nc=!1))}),yield or(t,r,e)}catch(r){yield Mt(r)}}),Xd.apply(this,arguments)}function Hm(n,e,t){const r=O(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ic.forEach((s,u)=>{const d=u.view.bu(e);d.snapshot&&i.push(d.snapshot)}),function(s,u){const d=O(s);d.onlineState=u;let f=!1;d.queries.forEach((m,g)=>{for(const _ of g.listeners)_.bu(u)&&(f=!0)}),f&&zd(d)}(r.eventManager,e),i.length&&r.sc.Wo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Lv(n,e,t){return ef.apply(this,arguments)}function ef(){return ef=(0,x.Z)(function*(n,e,t){const r=O(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.cc.get(e),s=i&&i.key;if(s){let u=new Ie(M.comparator);u=u.insert(s,le.newNoDocument(s,G.min()));const d=H().add(s),f=new cu(G.min(),new Map,new ue(W),u,d);yield Km(r,f),r.uc=r.uc.remove(s),r.cc.delete(e),uf(r)}else yield Ao(r.localStore,e,!1).then(()=>Mo(r,e,t)).catch(Mt)}),ef.apply(this,arguments)}function Fv(n,e){return tf.apply(this,arguments)}function tf(){return tf=(0,x.Z)(function*(n,e){const t=O(n),r=e.batch.batchId;try{const i=yield ev(t.localStore,e);of(t,r,null),sf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield or(t,i)}catch(i){yield Mt(i)}}),tf.apply(this,arguments)}function Uv(n,e,t){return nf.apply(this,arguments)}function nf(){return nf=(0,x.Z)(function*(n,e,t){const r=O(n);try{const i=yield function(s,u){const d=O(s);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return d.mutationQueue.lookupMutationBatch(f,u).next(g=>(Z(null!==g),m=g.keys(),d.mutationQueue.removeMutationBatch(f,g))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>d.localDocuments.getDocuments(f,m))})}(r.localStore,e);of(r,e,t),sf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield or(r,i)}catch(i){yield Mt(i)}}),nf.apply(this,arguments)}function rf(){return rf=(0,x.Z)(function*(n,e){const t=O(n);sr(t.remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(s){const u=O(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>u.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===r)return void e.resolve();const i=t.lc.get(r)||[];i.push(e),t.lc.set(r,i)}catch(r){const i=Ro(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),rf.apply(this,arguments)}function sf(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function of(n,e,t){const r=O(n);let i=r.hc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function Mo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||Qm(n,r)})}function Qm(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Tu(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),uf(n))}function af(n,e,t){for(const r of t)r instanceof jm?(n.ac.addReference(r.key,e),qv(n,r)):r instanceof zm?(D("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||Qm(n,r.key)):U()}function qv(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(D("SyncEngine","New document in limbo: "+t),n.oc.add(r),uf(n))}function uf(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new M(ne.fromString(e)),r=n.fc.next();n.cc.set(r,new Rv(t)),n.uc=n.uc.insert(t,r),Il(n.remoteStore,new Ur(Ye(er(t.path)),r,2,lt.at))}}function or(n,e,t){return cf.apply(this,arguments)}function cf(){return cf=(0,x.Z)(function*(n,e,t){const r=O(n),i=[],s=[],u=[];var d;r.ic.isEmpty()||(r.ic.forEach((d,f)=>{u.push(r._c(f,e,t).then(m=>{if((m||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(f.targetId,(null==m?void 0:m.fromCache)?"not-current":"current"),m){i.push(m);const g=fd.Ci(f.targetId,m);s.push(g)}}))}),yield Promise.all(u),r.sc.Wo(i),yield(d=(0,x.Z)(function*(f,m){const g=O(f);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>E.forEach(m,w=>E.forEach(w.Si,k=>g.persistence.referenceDelegate.addReference(_,w.targetId,k)).next(()=>E.forEach(w.Di,k=>g.persistence.referenceDelegate.removeReference(_,w.targetId,k)))))}catch(_){if(!Jt(_))throw _;D("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const w=_.targetId;if(!_.fromCache){const k=g.qi.get(w),P=k.withLastLimboFreeSnapshotVersion(k.snapshotVersion);g.qi=g.qi.insert(w,P)}}}),function(f,m){return d.apply(this,arguments)})(r.localStore,s))}),cf.apply(this,arguments)}function Bv(n,e){return lf.apply(this,arguments)}function lf(){return lf=(0,x.Z)(function*(n,e){const t=O(n);if(!t.currentUser.isEqual(e)){D("SyncEngine","User change. New user:",e.toKey());const r=yield Tm(t.localStore,e);t.currentUser=e,(i=t).lc.forEach(u=>{u.forEach(d=>{d.reject(new A(T.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield or(t,r.ji)}var i}),lf.apply(this,arguments)}function Zv(n,e){const t=O(n),r=t.cc.get(e);if(r&&r.nc)return H().add(r.key);{let i=H();const s=t.rc.get(e);if(!s)return i;for(const u of s){const d=t.ic.get(u);i=i.unionWith(d.view.ju)}return i}}function Gv(n,e){return hf.apply(this,arguments)}function hf(){return hf=(0,x.Z)(function*(n,e){const t=O(n),r=yield gl(t.localStore,e.query,!0),i=e.view.tc(r);return t.isPrimaryClient&&af(t,e.targetId,i.Xu),i}),hf.apply(this,arguments)}function $v(n,e){return df.apply(this,arguments)}function df(){return df=(0,x.Z)(function*(n,e){const t=O(n);return Sm(t.localStore,e).then(r=>or(t,r))}),df.apply(this,arguments)}function jv(n,e,t,r){return ff.apply(this,arguments)}function ff(){return ff=(0,x.Z)(function*(n,e,t,r){const i=O(n),s=yield function(u,d){const f=O(u),m=O(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",g=>m.Tn(g,d).next(_=>_?f.localDocuments.getDocuments(g,_):E.resolve(null)))}(i.localStore,e);var d;null!==s?("pending"===t?yield Co(i.remoteStore):"acknowledged"===t||"rejected"===t?(of(i,e,r||null),sf(i,e),d=e,O(O(i.localStore).mutationQueue).An(d)):U(),yield or(i,s)):D("SyncEngine","Cannot apply mutation batch with id: "+e)}),ff.apply(this,arguments)}function pf(){return pf=(0,x.Z)(function*(n,e){const t=O(n);if(_f(t),vf(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Ym(t,r.toArray());t.dc=!0,yield Vd(t.remoteStore,!0);for(const s of i)Il(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const r=[];let i=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?r.push(u):i=i.then(()=>(Mo(t,u),Ao(t.localStore,u,!0))),Tu(t.remoteStore,u)}),yield i,yield Ym(t,r),function(s){const u=O(s);u.cc.forEach((d,f)=>{Tu(u.remoteStore,f)}),u.ac.fs(),u.cc=new Map,u.uc=new Ie(M.comparator)}(t),t.dc=!1,yield Vd(t.remoteStore,!1)}}),pf.apply(this,arguments)}function Ym(n,e,t){return mf.apply(this,arguments)}function mf(){return mf=(0,x.Z)(function*(n,e,t){const r=O(n),i=[],s=[];for(const u of e){let d;const f=r.rc.get(u);if(f&&0!==f.length){d=yield ko(r.localStore,Ye(f[0]));for(const m of f){const g=r.ic.get(m),_=yield Gv(r,g);_.snapshot&&s.push(_.snapshot)}}else{const m=yield Am(r.localStore,u);d=yield ko(r.localStore,m),yield Hd(r,Jm(m),u,!1,d.resumeToken)}i.push(d)}return r.sc.Wo(s),i}),mf.apply(this,arguments)}function Jm(n){return Or(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Wv(n){const e=O(n);return O(O(e.localStore).persistence).vi()}function Kv(n,e,t,r){return gf.apply(this,arguments)}function gf(){return gf=(0,x.Z)(function*(n,e,t,r){const i=O(n);if(i.dc)return void D("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield Sm(i.localStore,Je(s[0])),d=cu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,De.EMPTY_BYTE_STRING);yield or(i,u,d);break}case"rejected":yield Ao(i.localStore,e,!0),Mo(i,e,r);break;default:U()}}),gf.apply(this,arguments)}function Hv(n,e,t){return yf.apply(this,arguments)}function yf(){return yf=(0,x.Z)(function*(n,e,t){const r=_f(n);if(r.dc){for(const i of e){if(r.rc.has(i)){D("SyncEngine","Adding an already active target "+i);continue}const s=yield Am(r.localStore,i),u=yield ko(r.localStore,s);yield Hd(r,Jm(s),u.targetId,!1,u.resumeToken),Il(r.remoteStore,u)}for(const i of t)r.rc.has(i)&&(yield Ao(r.localStore,i,!1).then(()=>{Tu(r.remoteStore,i),Mo(r,i)}).catch(Mt))}}),yf.apply(this,arguments)}function _f(n){const e=O(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Km.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Lv.bind(null,e),e.sc.Wo=kv.bind(null,e.eventManager),e.sc.wc=Av.bind(null,e.eventManager),e}function vf(n){const e=O(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Fv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Uv.bind(null,e),e}class Xm{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,x.Z)(function*(){t.yt=bu(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Em(this.persistence,new bm,e.initialUser,this.yt)}yc(e){return new Im(pl.Bs,this.yt)}gc(e){return new Nm}terminate(){var e=this;return(0,x.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class eg extends Xm{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,x.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield vf(r.Ac.syncEngine),yield Co(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Em(this.persistence,new bm,e.initialUser,this.yt)}Tc(e,t){return new V_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Fh(t,this.persistence);return new Lh(e.asyncQueue,r)}yc(e){const t=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?Tt.withCacheSize(this.cacheSizeBytes):Tt.DEFAULT;return new hd(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Mm(),vl(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Nm}}class Yv extends eg{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,x.Z)(function*(){yield t().call(r,e);const i=r.Ac.syncEngine;r.sharedClientState instanceof wd&&(r.sharedClientState.syncEngine={Fr:jv.bind(null,i),$r:Kv.bind(null,i),Br:Hv.bind(null,i),vi:Wv.bind(null,i),Mr:$v.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var s=(0,x.Z)(function*(u){yield function zv(n,e){return pf.apply(this,arguments)}(r.Ac.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start():u||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(u&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():u||r.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Mm();if(!wd.C(t))throw new A(T.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new wd(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class If{initialize(e,t){var r=this;return(0,x.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Hm(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=Bv.bind(null,r.syncEngine),yield Vd(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new xv}createDatastore(e){const t=bu(e.databaseInfo.databaseId),r=new uv(e.databaseInfo);return new hv(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=d=>Hm(this.syncEngine,d,0),u=Om.C()?new Om:new sv,new pv(t,r,i,s,u);var t,r,i,s,u}createSyncEngine(e,t){return function(r,i,s,u,d,f,m){const g=new Nv(r,i,s,u,d,f);return m&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,x.Z)(function*(t){const r=O(t);D("RemoteStore","RemoteStore shutting down."),r._u.add(5),yield So(r),r.mu.shutdown(),r.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function wf(n,e,t){if(!t)throw new A(T.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function tg(n,e,t,r){if(!0===e&&!0===r)throw new A(T.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ng(n){if(!M.isDocumentKey(n))throw new A(T.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rg(n){if(M.isDocumentKey(n))throw new A(T.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function bl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":U()}function ie(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new A(T.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=bl(n);throw new A(T.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ig(n,e){if(e<=0)throw new A(T.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const sg=new Map;class og{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new A(T.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(T.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,tg("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class xu{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new og({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(T.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(T.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new og(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Fa;switch(t.type){case"gapi":return new Nh(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new A(T.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=sg.get(e);t&&(D("ComponentProvider","Removing Datastore"),sg.delete(e),t.terminate())}(this),Promise.resolve()}}class pe{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new bn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new pe(this.firestore,e,this._key)}}class Xe{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Xe(this.firestore,e,this._query)}}class bn extends Xe{constructor(e,t,r){super(e,t,er(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new pe(this.firestore,null,new M(e))}withConverter(e){return new bn(this.firestore,e,this._path)}}function ug(n,e,...t){if(n=(0,te.m9)(n),wf("collection","path",e),n instanceof xu){const r=ne.fromString(e,...t);return rg(r),new bn(n,null,r)}{if(!(n instanceof pe||n instanceof bn))throw new A(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return rg(r),new bn(n.firestore,null,r)}}function El(n,e,...t){if(n=(0,te.m9)(n),1===arguments.length&&(e=ro.R()),wf("doc","path",e),n instanceof xu){const r=ne.fromString(e,...t);return ng(r),new pe(n,null,new M(r))}{if(!(n instanceof pe||n instanceof bn))throw new A(T.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return ng(r),new pe(n.firestore,n instanceof bn?n.converter:null,new M(r))}}function cg(n,e){return n=(0,te.m9)(n),e=(0,te.m9)(e),(n instanceof pe||n instanceof bn)&&(e instanceof pe||e instanceof bn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function bf(n,e){return n=(0,te.m9)(n),e=(0,te.m9)(e),n instanceof Xe&&e instanceof Xe&&n.firestore===e.firestore&&Vi(n._query,e._query)&&n.converter===e.converter}function lg(n,e=10240){let t=0;return{read:()=>(0,x.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,x.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Tl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):xe("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Xv{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Ne,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ku)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,x.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,x.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,x.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),i=Number(r);isNaN(i)&&e.Dc(`length string (${r}) is not valid number`);const s=yield e.Cc(i);return new Sv(JSON.parse(s),t.length+i)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,x.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,x.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,x.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class n0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,x.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new A(T.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,x.Z)(function*(s,u){const d=O(s),f=du(d.yt)+"/documents",m={documents:u.map(k=>hu(d.yt,k))},g=yield d._o("BatchGetDocuments",f,m,u.length),_=new Map;g.forEach(k=>{const S=function t_(n,e){return"found"in e?function(t,r){Z(!!r.found);const i=In(t,r.found.name),s=Oe(r.found.updateTime),u=r.found.createTime?Oe(r.found.createTime):G.min(),d=new Ze({mapValue:{fields:r.found.fields}});return le.newFoundDocument(i,s,u,d)}(n,e):"missing"in e?function(t,r){Z(!!r.missing),Z(!!r.readTime);const i=In(t,r.missing),s=Oe(r.readTime);return le.newNoDocument(i,s)}(n,e):U()}(d.yt,k);_.set(S.key.toString(),S)});const w=[];return u.forEach(k=>{const S=_.get(k.toString());Z(!!S),w.push(S)}),w}),function(s,u){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new ir(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,x.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=M.fromPath(i);e.mutations.push(new vo(s,e.precondition(s)))}),yield(r=(0,x.Z)(function*(i,s){const u=O(i),d=du(u.yt)+"/documents",f={writes:s.map(m=>fu(u.yt,m))};yield u.ao("Commit",d,f)}),function(i,s){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=G.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new A(T.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(G.min())?b.exists(!1):b.updateTime(t):b.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(G.min()))throw new A(T.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return b.updateTime(t)}return b.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class r0{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.kc=r.maxAttempts,this.xo=new bd(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,x.Z)(function*(){const t=new n0(e.datastore),r=e.Mc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Fc(s)}))}).catch(i=>{e.Fc(i)})}))}Mc(e){try{const t=this.updateFunction(e);return!Ci(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Io(t)}return!1}}class s0{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Ue.UNAUTHENTICATED,this.clientId=ro.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,x.Z)(function*(d){D("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(D("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,x.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(T.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Ne;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Ro(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function hg(n,e){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,x.Z)(function*(s){r.isEqual(s)||(yield Tm(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ef.apply(this,arguments)}function dg(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield xf(n);D("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Bm(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Bm(e.remoteStore,s)),n.onlineComponents=e}),Tf.apply(this,arguments)}function xf(n){return kf.apply(this,arguments)}function kf(){return kf=(0,x.Z)(function*(n){return n.offlineComponents||(D("FirestoreClient","Using default OfflineComponentProvider"),yield hg(n,new Xm)),n.offlineComponents}),kf.apply(this,arguments)}function xl(n){return Af.apply(this,arguments)}function Af(){return Af=(0,x.Z)(function*(n){return n.onlineComponents||(D("FirestoreClient","Using default OnlineComponentProvider"),yield dg(n,new If)),n.onlineComponents}),Af.apply(this,arguments)}function fg(n){return xf(n).then(e=>e.persistence)}function kl(n){return xf(n).then(e=>e.localStore)}function Sf(n){return xl(n).then(e=>e.remoteStore)}function Cf(n){return xl(n).then(e=>e.syncEngine)}function Po(n){return Df.apply(this,arguments)}function Df(){return Df=(0,x.Z)(function*(n){const e=yield xl(n),t=e.eventManager;return t.onListen=Ov.bind(null,e.syncEngine),t.onUnlisten=Mv.bind(null,e.syncEngine),t}),Df.apply(this,arguments)}function mg(n,e,t={}){const r=new Ne;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(i,s,u,d,f){const m=new Tl({next:_=>{s.enqueueAndForget(()=>$d(i,g));const w=_.docs.has(u);!w&&_.fromCache?f.reject(new A(T.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&_.fromCache&&d&&"server"===d.source?f.reject(new A(T.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new Wd(er(u.path),m,{includeMetadataChanges:!0,Nu:!0});return Zd(i,g)}(yield Po(n),n.asyncQueue,e,t,r)})),r.promise}function gg(n,e,t={}){const r=new Ne;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(i,s,u,d,f){const m=new Tl({next:_=>{s.enqueueAndForget(()=>$d(i,g)),_.fromCache&&"server"===d.source?f.reject(new A(T.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new Wd(u,m,{includeMetadataChanges:!0,Nu:!0});return Zd(i,g)}(yield Po(n),n.asyncQueue,e,t,r)})),r.promise}class f0{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new bd(this,"async_queue_retry"),this.Wc=()=>{const t=vl();t&&D("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=vl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=vl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Ne;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,x.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!Jt(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,xe("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const i=Bd.createAndSchedule(this,e,t,r,s=>this.Yc(s));return this.Uc.push(i),i}zc(){this.Kc&&U()}verifyOperationInProgress(){}Xc(){var e=this;return(0,x.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Rf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class p0{constructor(){this._progressObserver={},this._taskCompletionResolver=new Ne,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class me extends xu{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new f0,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||yg(this),this._firestoreClient.terminate()}}function Me(n){return n._firestoreClient||yg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function yg(n){var e;const t=n._freezeSettings(),r=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Uh(n._databaseId,s,n._persistenceKey,(d=t).host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,d.useFetchStreams));var s,d;n._firestoreClient=new s0(n._authCredentials,n._appCheckCredentials,n._queue,r)}function _g(n,e,t){const r=new Ne;return n.asyncQueue.enqueue((0,x.Z)(function*(){try{yield hg(n,t),yield dg(n,e),r.resolve()}catch(i){const s=i;if(!("FirebaseError"===(u=s).name?u.code===T.FAILED_PRECONDITION||u.code===T.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;zn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var u})).then(()=>r.promise)}function vg(n){if(n._initialized||n._terminated)throw new A(T.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class En{constructor(e){this._byteString=e}static fromBase64String(e){try{return new En(De.fromBase64String(e))}catch(t){throw new A(T.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new En(De.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class ar{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(T.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new _e(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Hi{constructor(e){this._methodName=e}}class Al{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(T.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(T.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}const T0=/^__.*__$/;class x0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new At(e,this.data,this.fieldMask,t,this.fieldTransforms):new rr(e,this.data,t,this.fieldTransforms)}}class Ig{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new At(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function wg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}class Sl{constructor(e,t,r,i,s,u){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=i,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Sl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Rl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(wg(this.sa)&&T0.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class k0{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||bu(e)}da(e,t,r,i=!1){return new Sl({sa:e,methodName:t,fa:r,path:_e.emptyPath(),oa:!1,la:i},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Qi(n){const e=n._freezeSettings(),t=bu(n._databaseId);return new k0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Cl(n,e,t,r,i,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,i);Pf("Data must be an object, but it was:",u,r);const d=Tg(r,u);let f,m;if(s.merge)f=new st(u.fieldMask),m=u.fieldTransforms;else if(s.mergeFields){const g=[];for(const _ of s.mergeFields){const w=Lf(e,_,t);if(!u.contains(w))throw new A(T.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);kg(g,w)||g.push(w)}f=new st(g),m=u.fieldTransforms.filter(_=>f.covers(_.field))}else f=null,m=u.fieldTransforms;return new x0(new Ze(d),f,m)}class ku extends Hi{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof ku}}function bg(n,e,t){return new Sl({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class Nf extends Hi{_toFieldTransform(e){return new p(e.path,new Lr)}isEqual(e){return e instanceof Nf}}class A0 extends Hi{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=bg(this,e,!0),r=this._a.map(s=>Yi(s,t)),i=new tr(r);return new p(e.path,i)}isEqual(e){return this===e}}class S0 extends Hi{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=bg(this,e,!0),r=this._a.map(s=>Yi(s,t)),i=new nr(r);return new p(e.path,i)}isEqual(e){return this===e}}class C0 extends Hi{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new o(e.yt,Pr(e.yt,this.wa));return new p(e.path,t)}isEqual(e){return this===e}}function Of(n,e,t,r){const i=n.da(1,e,t);Pf("Data must be an object, but it was:",i,r);const s=[],u=Ze.empty();Xt(r,(f,m)=>{const g=Dl(e,f,t);m=(0,te.m9)(m);const _=i.ca(g);if(m instanceof ku)s.push(g);else{const w=Yi(m,_);null!=w&&(s.push(g),u.set(g,w))}});const d=new st(s);return new Ig(u,d,i.fieldTransforms)}function Mf(n,e,t,r,i,s){const u=n.da(1,e,t),d=[Lf(e,r,t)],f=[i];if(s.length%2!=0)throw new A(T.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)d.push(Lf(e,s[w])),f.push(s[w+1]);const m=[],g=Ze.empty();for(let w=d.length-1;w>=0;--w)if(!kg(m,d[w])){const k=d[w];let S=f[w];S=(0,te.m9)(S);const P=u.ca(k);if(S instanceof ku)m.push(k);else{const q=Yi(S,P);null!=q&&(m.push(k),g.set(k,q))}}const _=new st(m);return new Ig(g,_,u.fieldTransforms)}function Eg(n,e,t,r=!1){return Yi(t,n.da(r?4:3,e))}function Yi(n,e){if(xg(n=(0,te.m9)(n)))return Pf("Unsupported field value:",e,n),Tg(n,e);if(n instanceof Hi)return function(t,r){if(!wg(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const u of t){let d=Yi(u,r.aa(s));null==d&&(d={nullValue:"NULL_VALUE"}),i.push(d),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,te.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Pr(r.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=de.fromDate(t);return{timestampValue:wo(r.yt,i)}}if(t instanceof de){const i=new de(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:wo(r.yt,i)}}if(t instanceof Al)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof En)return{bytesValue:Rp(r.yt,t._byteString)};if(t instanceof pe){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:Kh(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${bl(t)}`)}(n,e)}function Tg(n,e){const t={};return Pc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xt(n,(r,i)=>{const s=Yi(i,e.ra(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function xg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof de||n instanceof Al||n instanceof En||n instanceof pe||n instanceof Hi)}function Pf(n,e,t){if(!xg(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=bl(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function Lf(n,e,t){if((e=(0,te.m9)(e))instanceof ar)return e._internalPath;if("string"==typeof e)return Dl(n,e);throw Rl("Field path arguments must be of type string or ",n,!1,void 0,t)}const D0=new RegExp("[~\\*/\\[\\]]");function Dl(n,e,t){if(e.search(D0)>=0)throw Rl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new ar(...e.split("."))._internalPath}catch(r){throw Rl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Rl(n,e,t,r,i){const s=r&&!r.isEmpty(),u=void 0!==i;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(s||u)&&(f+=" (found",s&&(f+=` in field ${r}`),u&&(f+=` in document ${i}`),f+=")"),new A(T.INVALID_ARGUMENT,d+n+f)}function kg(n,e){return n.some(t=>t.isEqual(e))}class Au{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new pe(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new R0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Nl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class R0 extends Au{data(){return super.data()}}function Nl(n,e){return"string"==typeof e?Dl(n,e):e instanceof ar?e._internalPath:e._delegate._internalPath}function Ag(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new A(T.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ff{}class Su extends Ff{}function Gr(n,e,...t){let r=[];e instanceof Ff&&r.push(e),r=r.concat(t),function(i){const s=i.filter(d=>d instanceof Lo).length,u=i.filter(d=>d instanceof Cu).length;if(s>1||s>0&&u>0)throw new A(T.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Cu extends Su{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Cu(e,t,r)}_apply(e){const t=this._parse(e);return Rg(e._query,t),new Xe(e.firestore,e.converter,Lt(e._query,t))}_parse(e){const t=Qi(e.firestore);return function(i,s,u,d,f,m,g){let _;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new A(T.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Dg(g,m);const w=[];for(const k of g)w.push(Cg(d,i,k));_={arrayValue:{values:w}}}else _=Cg(d,i,g)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Dg(g,m),_=Eg(u,"where",g,"in"===m||"not-in"===m);return X.create(f,m,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Lo extends Ff{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Lo(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:se.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let s=r;const u=i.getFlattenedFilters();for(const d of u)Rg(s,d),s=Lt(s,d)}(e._query,t),new Xe(e.firestore,e.converter,Lt(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Uf extends Su{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Uf(e,t)}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new A(T.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new A(T.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new Dr(i,s);return function(d,f){if(null===Fi(d)){const m=Mr(d);null!==m&&Ng(0,m,f.field)}}(r,u),u}(e._query,this._field,this._direction);return new Xe(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new ke(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Ol extends Su{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Ol(e,t,r)}_apply(e){return new Xe(e.firestore,e.converter,Ui(e._query,this._limit,this._limitType))}}class Ml extends Su{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Ml(e,t,r)}_apply(e){const t=Sg(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,(i=t,new ke((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class Pl extends Su{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Pl(e,t,r)}_apply(e){const t=Sg(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,(i=t,new ke((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function Sg(n,e,t,r){if(t[0]=(0,te.m9)(t[0]),t[0]instanceof Au)return function(i,s,u,d,f){if(!d)throw new A(T.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of _n(i))if(g.field.isKeyField())m.push(Jn(s,d.key));else{const _=d.data.field(g.field);if(Ri(_))throw new A(T.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const w=g.field.canonicalString();throw new A(T.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}m.push(_)}return new yn(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Qi(n.firestore);return function(s,u,d,f,m,g){const _=s.explicitOrderBy;if(m.length>_.length)throw new A(T.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let k=0;k<m.length;k++){const S=m[k];if(_[k].field.isKeyField()){if("string"!=typeof S)throw new A(T.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof S}`);if(!tu(s)&&-1!==S.indexOf("/"))throw new A(T.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${S}' contains a slash.`);const P=s.path.child(ne.fromString(S));if(!M.isDocumentKey(P))throw new A(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${P}' is not because it contains an odd number of segments.`);const q=new M(P);w.push(Jn(u,q))}else{const P=Eg(d,f,S);w.push(P)}}return new yn(w,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Cg(n,e,t){if("string"==typeof(t=(0,te.m9)(t))){if(""===t)throw new A(T.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!tu(e)&&-1!==t.indexOf("/"))throw new A(T.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ne.fromString(t));if(!M.isDocumentKey(r))throw new A(T.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Jn(n,new M(r))}if(t instanceof pe)return Jn(n,t._key);throw new A(T.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${bl(t)}.`)}function Dg(n,e){if(!Array.isArray(n)||0===n.length)throw new A(T.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new A(T.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Rg(n,e){if(e.isInequality()){const r=Mr(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new A(T.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=Fi(n);null!==s&&Ng(0,i,s)}const t=function(r,i){for(const s of r)for(const u of s.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new A(T.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Ng(n,e,t){if(!t.isEqual(e))throw new A(T.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Vf{convertValue(e,t="none"){switch(Yn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Hn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U()}}convertObject(e,t){const r={};return Xt(e.fields,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Al(ve(e.latitude),ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Fc(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Qn(e));default:return null}}convertTimestamp(e){const t=mn(e);return new de(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ne.fromString(e);Z(Bp(r));const i=new pn(r.get(1),r.get(3)),s=new M(r.popFirst(5));return i.isEqual(t)||xe(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Ll(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class q0 extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new En(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}}class Ji{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class ur extends Au{constructor(e,t,r,i,s,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Du(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Nl("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Du extends ur{data(e={}){return super.data(e)}}class $r{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Ji(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Du(this._firestore,this._userDataWriter,r.key,r,new Ji(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(T.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Du(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ji(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const d=new Du(r._firestore,r._userDataWriter,u.doc.key,u.doc,new Ji(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,m=-1;return 0!==u.type&&(f=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),m=s.indexOf(u.doc.key)),{type:B0(u.type),doc:d,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function B0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Mg(n,e){return n instanceof ur&&e instanceof ur?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof $r&&e instanceof $r&&n._firestore===e._firestore&&bf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class jr extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new En(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new pe(this.firestore,null,t)}}function Pg(n,e,t){n=ie(n,pe);const r=ie(n.firestore,me),i=Ll(n.converter,e,t);return Fo(r,[Cl(Qi(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,b.none())])}function Lg(n,e,t,...r){n=ie(n,pe);const i=ie(n.firestore,me),s=Qi(i);let u;return u="string"==typeof(e=(0,te.m9)(e))||e instanceof ar?Mf(s,"updateDoc",n._key,e,t,r):Of(s,"updateDoc",n._key,e),Fo(i,[u.toMutation(n._key,b.exists(!0))])}function Fg(n,...e){var t,r,i;n=(0,te.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Rf(e[u])||(s=e[u],u++);const d={includeMetadataChanges:s.includeMetadataChanges};if(Rf(e[u])){const _=e[u];e[u]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[u+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[u+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let f,m,g;if(n instanceof pe)m=ie(n.firestore,me),g=er(n._key.path),f={next:_=>{e[u]&&e[u](qf(m,n,_))},error:e[u+1],complete:e[u+2]};else{const _=ie(n,Xe);m=ie(_.firestore,me),g=_._query;const w=new jr(m);f={next:k=>{e[u]&&e[u](new $r(m,w,_,k))},error:e[u+1],complete:e[u+2]},Ag(n._query)}return function(_,w,k,S){const P=new Tl(S),q=new Wd(w,P,k);return _.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return Zd(yield Po(_),q)})),()=>{P.bc(),_.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return $d(yield Po(_),q)}))}}(Me(m),g,d,f)}function Fo(n,e){return function(t,r){const i=new Ne;return t.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function Pv(n,e,t){return Jd.apply(this,arguments)}(yield Cf(t),r,i)})),i.promise}(Me(n),e)}function qf(n,e,t){const r=t.docs.get(e._key),i=new jr(n);return new ur(n,i,e._key,r,new Ji(t.hasPendingWrites,t.fromCache),e.converter)}const Y0={maxAttempts:5};class Ug{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Qi(e)}set(e,t,r){this._verifyNotCommitted();const i=zr(e,this._firestore),s=Ll(i.converter,t,r),u=Cl(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,b.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=zr(e,this._firestore);let u;return u="string"==typeof(t=(0,te.m9)(t))||t instanceof ar?Mf(this._dataReader,"WriteBatch.update",s._key,t,r,i):Of(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,b.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=zr(e,this._firestore);return this._mutations=this._mutations.concat(new ir(t._key,b.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(T.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function zr(n,e){if((n=(0,te.m9)(n)).firestore!==e)throw new A(T.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class J0 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Qi(e)}get(e){const t=zr(e,this._firestore),r=new q0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return U();const s=i[0];if(s.isFoundDocument())return new Au(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Au(this._firestore,r,t._key,null,t.converter);throw U()})}set(e,t,r){const i=zr(e,this._firestore),s=Ll(i.converter,t,r),u=Cl(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const s=zr(e,this._firestore);let u;return u="string"==typeof(t=(0,te.m9)(t))||t instanceof ar?Mf(this._dataReader,"Transaction.update",s._key,t,r,i):Of(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=zr(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=zr(e,this._firestore),r=new jr(this._firestore);return super.get(e).then(i=>new ur(this._firestore,r,t._key,i._document,new Ji(!1,!1),t.converter))}}function Bf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new A("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function qg(){if("undefined"==typeof Uint8Array)throw new A("unimplemented","Uint8Arrays are not available in this environment.")}function Bg(){if(!function Vh(){return"undefined"!=typeof atob}())throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){fn=yt.SDK_VERSION,(0,yt._registerComponent)(new ni.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),u=new me(new ki(t.getProvider("auth-internal")),new Ua(t.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new A(T.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new pn(d.options.projectId,f)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,yt.registerVersion)(eo,"3.8.0",n),(0,yt.registerVersion)(eo,"3.8.0","esm2017")}();class Ru{constructor(e){this._delegate=e}static fromBase64String(e){return Bg(),new Ru(En.fromBase64String(e))}static fromUint8Array(e){return qg(),new Ru(En.fromUint8Array(e))}toBase64(){return Bg(),this._delegate.toBase64()}toUint8Array(){return qg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Zf(n){return function aI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class uI{enableIndexedDbPersistence(e,t){return function g0(n,e){vg(n=ie(n,me));const t=Me(n),r=n._freezeSettings(),i=new If;return _g(t,i,new eg(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function y0(n){vg(n=ie(n,me));const e=Me(n),t=n._freezeSettings(),r=new If;return _g(e,r,new Yv(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function _0(n){if(n._initialized&&!n._terminated)throw new A(T.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Ne;return n._queue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{yield(t=(0,x.Z)(function*(r){if(!ct.C())return Promise.resolve();const i=r+"main";yield ct.delete(i)}),function(r){return t.apply(this,arguments)})(dd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Zg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof pn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&zn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function ag(n,e,t,r={}){var i;const s=(n=ie(n,xu))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&zn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,d;if("string"==typeof r.mockUserToken)u=r.mockUserToken,d=Ue.MOCK_USER;else{u=(0,te.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new A(T.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ue(f)}n._authCredentials=new Dh(new to(u,d))}}(this._delegate,e,t,r)}enableNetwork(){return function I0(n){return function o0(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield fg(n),t=yield Sf(n);return e.setNetworkEnabled(!0),function(r){const i=O(r);return i._u.delete(0),Eu(i)}(t)}))}(Me(n=ie(n,me)))}(this._delegate)}disableNetwork(){return function w0(n){return function a0(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield fg(n),t=yield Sf(n);return e.setNetworkEnabled(!1),(r=(0,x.Z)(function*(i){const s=O(i);s._u.add(0),yield So(s),s.gu.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(Me(n=ie(n,me)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,tg("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function v0(n){return function(e){const t=new Ne;return e.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function Vv(n,e){return rf.apply(this,arguments)}(yield Cf(e),t)})),t.promise}(Me(n=ie(n,me)))}(this._delegate)}onSnapshotsInSync(e){return function Q0(n,e){return function l0(n,e){const t=new Tl(e);return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return r=yield Po(n),i=t,O(r).Ru.add(i),void i.next();var r,i})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return r=yield Po(n),i=t,void O(r).Ru.delete(i);var r,i}))}}(Me(n=ie(n,me)),Rf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Uo(this,ug(this._delegate,e))}catch(t){throw dt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,El(this._delegate,e))}catch(t){throw dt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ft(this,function Jv(n,e){if(n=ie(n,xu),wf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new A(T.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xe(n,null,(t=e,new ke(ne.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw dt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function X0(n,e,t){n=ie(n,me);const r=Object.assign(Object.assign({},Y0),t);return function(i){if(i.maxAttempts<1)throw new A(T.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,u){const d=new Ne;return i.asyncQueue.enqueueAndForget((0,x.Z)(function*(){const f=yield function pg(n){return xl(n).then(e=>e.datastore)}(i);new r0(i.asyncQueue,f,u,s,d).run()})),d.promise}(Me(n),i=>e(new J0(n,i)),r)}(this._delegate,t=>e(new Gg(this,t)))}batch(){return Me(this._delegate),new $g(new Ug(this._delegate,e=>Fo(this._delegate,e)))}loadBundle(e){return function b0(n,e){const t=Me(n=ie(n,me)),r=new p0;return function h0(n,e,t,r){const i=function(s,u){let d;return d="string"==typeof s?(new TextEncoder).encode(s):s,f=function(f,m){if(f instanceof Uint8Array)return lg(f,m);if(f instanceof ArrayBuffer)return lg(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new Xv(f,u);var f}(t,bu(e));n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){!function Qv(n,e,t){const r=O(n);var i;(i=(0,x.Z)(function*(s,u,d){try{const f=yield u.getMetadata();if(yield function(w,k){const S=O(w),P=Oe(k.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",q=>S.Ns.getBundleMetadata(q,k.id)).then(q=>!!q&&q.createTime.compareTo(P)>=0)}(s.localStore,f))return yield u.close(),d._completeWith({taskState:"Success",documentsLoaded:(w=f).totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}),Promise.resolve(new Set);d._updateProgress($m(f));const m=new Cv(f,s.localStore,u.yt);let g=yield u.mc();for(;g;){const w=yield m.Fu(g);w&&d._updateProgress(w),g=yield u.mc()}const _=yield m.complete();return yield or(s,_.Lu,void 0),yield function(w,k){const S=O(w);return S.persistence.runTransaction("Save bundle","readwrite",P=>S.Ns.saveBundleMetadata(P,k))}(s.localStore,f),d._completeWith(_.progress),Promise.resolve(_.Bu)}catch(f){return zn("SyncEngine",`Loading bundle failed with ${f}`),d._failWith(f),Promise.resolve(new Set)}var w}),function(s,u,d){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield Cf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function E0(n,e){return function d0(n,e){return n.asyncQueue.enqueue((0,x.Z)(function*(){return function(t,r){const i=O(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.Ns.getNamedQuery(s,r))}(yield kl(n),e)}))}(Me(n=ie(n,me)),e).then(t=>t?new Xe(n,null,t.query):null)}(this._delegate,e).then(t=>t?new ft(this,t):null)}}class Fl extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ru(new En(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}}class Gg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Fl(e)}get(e){const t=es(e);return this._delegate.get(t).then(r=>new Nu(this._firestore,new ur(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=es(e);return r?(Bf("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=es(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=es(e);return this._delegate.delete(t),this}}class $g{constructor(e){this._delegate=e}set(e,t,r){const i=es(e);return r?(Bf("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=es(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=es(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class Xi{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Du(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Ou(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=Xi.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new Xi(e,new Fl(e),t),i.set(t,s)),s}}Xi.INSTANCES=new WeakMap;class Ut{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fl(e)}static forPath(e,t,r){if(e.length%2!=0)throw new A("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ut(t,new pe(t._delegate,r,new M(e)))}static forKey(e,t,r){return new Ut(t,new pe(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Uo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Uo(this.firestore,ug(this._delegate,e))}catch(t){throw dt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,te.m9)(e))instanceof pe&&cg(this._delegate,e)}set(e,t){t=Bf("DocumentReference.set",t);try{return t?Pg(this._delegate,e,t):Pg(this._delegate,e)}catch(r){throw dt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Lg(this._delegate,e):Lg(this._delegate,e,t,...r)}catch(i){throw dt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function K0(n){return Fo(ie(n.firestore,me),[new ir(n._key,b.none())])}(this._delegate)}onSnapshot(...e){const t=jg(e),r=zg(e,i=>new Nu(this.firestore,new ur(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Fg(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function G0(n){n=ie(n,pe);const e=ie(n.firestore,me),t=Me(e),r=new jr(e);return function u0(n,e){const t=new Ne;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(r=(0,x.Z)(function*(i,s,u){try{const d=yield function(f,m){const g=O(f);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,m))}(i,s);d.isFoundDocument()?u.resolve(d):d.isNoDocument()?u.resolve(null):u.reject(new A(T.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const f=Ro(d,`Failed to get document '${s} from cache`);u.reject(f)}}),function(i,s,u){return r.apply(this,arguments)})(yield kl(n),e,t);var r})),t.promise}(t,n._key).then(i=>new ur(e,r,n._key,i,new Ji(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function $0(n){n=ie(n,pe);const e=ie(n.firestore,me);return mg(Me(e),n._key,{source:"server"}).then(t=>qf(e,n,t))}(this._delegate):function Z0(n){n=ie(n,pe);const e=ie(n.firestore,me);return mg(Me(e),n._key).then(t=>qf(e,n,t))}(this._delegate),t.then(r=>new Nu(this.firestore,new ur(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Ut(this.firestore,this._delegate.withConverter(e?Xi.getInstance(this.firestore,e):null))}}function dt(n,e,t){return n.message=n.message.replace(e,t),n}function jg(n){for(const e of n)if("object"==typeof e&&!Zf(e))return e;return{}}function zg(n,e){var t,r;let i;return i=Zf(n[0])?n[0]:Zf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Nu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Mg(this._delegate,e._delegate)}}class Ou extends Nu{data(e){const t=this._delegate.data(e);return function Ch(n,e){n||U()}(void 0!==t),t}}class ft{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Fl(e)}where(e,t,r){try{return new ft(this.firestore,Gr(this._delegate,function N0(n,e,t){const r=e,i=Nl("where",n);return Cu._create(i,r,t)}(e,t,r)))}catch(i){throw dt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ft(this.firestore,Gr(this._delegate,function O0(n,e="asc"){const t=e,r=Nl("orderBy",n);return Uf._create(r,t)}(e,t)))}catch(r){throw dt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ft(this.firestore,Gr(this._delegate,function M0(n){return ig("limit",n),Ol._create("limit",n,"F")}(e)))}catch(t){throw dt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ft(this.firestore,Gr(this._delegate,function P0(n){return ig("limitToLast",n),Ol._create("limitToLast",n,"L")}(e)))}catch(t){throw dt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ft(this.firestore,Gr(this._delegate,function L0(...n){return Ml._create("startAt",n,!0)}(...e)))}catch(t){throw dt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ft(this.firestore,Gr(this._delegate,function F0(...n){return Ml._create("startAfter",n,!1)}(...e)))}catch(t){throw dt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ft(this.firestore,Gr(this._delegate,function U0(...n){return Pl._create("endBefore",n,!1)}(...e)))}catch(t){throw dt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ft(this.firestore,Gr(this._delegate,function V0(...n){return Pl._create("endAt",n,!0)}(...e)))}catch(t){throw dt(t,"endAt()","Query.endAt()")}}isEqual(e){return bf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function z0(n){n=ie(n,Xe);const e=ie(n.firestore,me),t=Me(e),r=new jr(e);return function c0(n,e){const t=new Ne;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(r=(0,x.Z)(function*(i,s,u){try{const d=yield gl(i,s,!0),f=new Wm(s,d.Hi),m=f.Wu(d.documents),g=f.applyChanges(m,!1);u.resolve(g.snapshot)}catch(d){const f=Ro(d,`Failed to execute query '${s} against cache`);u.reject(f)}}),function(i,s,u){return r.apply(this,arguments)})(yield kl(n),e,t);var r})),t.promise}(t,n._query).then(i=>new $r(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function W0(n){n=ie(n,Xe);const e=ie(n.firestore,me),t=Me(e),r=new jr(e);return gg(t,n._query,{source:"server"}).then(i=>new $r(e,r,n,i))}(this._delegate):function j0(n){n=ie(n,Xe);const e=ie(n.firestore,me),t=Me(e),r=new jr(e);return Ag(n._query),gg(t,n._query).then(i=>new $r(e,r,n,i))}(this._delegate),t.then(r=>new Gf(this.firestore,new $r(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=jg(e),r=zg(e,i=>new Gf(this.firestore,new $r(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Fg(this._delegate,t,r)}withConverter(e){return new ft(this.firestore,this._delegate.withConverter(e?Xi.getInstance(this.firestore,e):null))}}class lI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Ou(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Gf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ft(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Ou(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new lI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Ou(this._firestore,r))})}isEqual(e){return Mg(this._delegate,e._delegate)}}class Uo extends ft{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return new Ut(this.firestore,void 0===e?El(this._delegate):El(this._delegate,e))}catch(t){throw dt(t,"doc()","CollectionReference.doc()")}}add(e){return function H0(n,e){const t=ie(n.firestore,me),r=El(n),i=Ll(n.converter,e);return Fo(t,[Cl(Qi(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,b.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return cg(this._delegate,e._delegate)}withConverter(e){return new Uo(this.firestore,this._delegate.withConverter(e?Xi.getInstance(this.firestore,e):null))}}function es(n){return ie(n,pe)}class $f{constructor(...e){this._delegate=new ar(...e)}static documentId(){return new $f(_e.keyField().canonicalString())}isEqual(e){return(e=(0,te.m9)(e))instanceof ar&&this._delegate._internalPath.isEqual(e._internalPath)}}class ts{constructor(e){this._delegate=e}static serverTimestamp(){const e=function tI(){return new Nf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ts(e)}static delete(){const e=function eI(){return new ku("deleteField")}();return e._methodName="FieldValue.delete",new ts(e)}static arrayUnion(...e){const t=function nI(...n){return new A0("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new ts(t)}static arrayRemove(...e){const t=function rI(...n){return new S0("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new ts(t)}static increment(e){const t=function iI(n){return new C0("increment",n)}(e);return t._methodName="FieldValue.increment",new ts(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const hI={Firestore:Zg,GeoPoint:Al,Timestamp:de,Blob:Ru,Transaction:Gg,WriteBatch:$g,DocumentReference:Ut,DocumentSnapshot:Nu,Query:ft,QueryDocumentSnapshot:Ou,QuerySnapshot:Gf,CollectionReference:Uo,FieldPath:$f,FieldValue:ts,setLogLevel:function cI(n){!function La(n){wt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function fI(n){(function dI(n,e){n.INTERNAL.registerComponent(new ni.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},hI)))})(n,(e,t)=>new Zg(e,t,new uI)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(Dn.Z);var Wg=F(6451),Ul=F(5363),Wr=F(3900),Kg=F(3151),pI=F(590),mI=F(576);function Hg(n,e){return(0,mI.m)(e)?(0,Wr.w)(()=>n,e):(0,Wr.w)(()=>n)}var jf=F(9468);F(259);const Wf=new Map,Yg={activated:!1,tokenObservers:[]},II={initialized:!1,enabled:!1};function et(n){return Wf.get(n)||Object.assign({},Yg)}function ql(){return II}class kI{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,x.Z)(function*(){t.stop();try{t.pending=new te.BH,yield function AI(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new te.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const pt=new te.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Xg(n){if(!et(n).activated)throw pt.create("use-before-activation",{appName:n.name})}function Qf(n,e){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,x.Z)(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},i=t.getImmediate({optional:!0});if(i){const _=yield i.getHeartbeatsHeader();_&&(r["X-Firebase-Client"]=_)}const s={method:"POST",body:JSON.stringify(e),headers:r};let u,d;try{u=yield fetch(n,s)}catch(_){throw pt.create("fetch-network-error",{originalErrorMessage:null==_?void 0:_.message})}if(200!==u.status)throw pt.create("fetch-status-error",{httpStatus:u.status});try{d=yield u.json()}catch(_){throw pt.create("fetch-parse-error",{originalErrorMessage:null==_?void 0:_.message})}const f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw pt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});const m=1e3*Number(f[1]),g=Date.now();return{token:d.token,expireTimeMillis:g+m,issuedAtTimeMillis:g}}),Yf.apply(this,arguments)}function RI(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:e}}}const Mu="firebase-app-check-store";let Gl=null;function ty(){return Gl||(Gl=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(pt.create("storage-open",{originalErrorMessage:null===(i=r.target.error)||void 0===i?void 0:i.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(Mu,{keyPath:"compositeKey"})}}catch(t){e(pt.create("storage-open",{originalErrorMessage:null==t?void 0:t.message}))}}),Gl)}function Jf(){return Jf=(0,x.Z)(function*(n,e){const r=(yield ty()).transaction(Mu,"readwrite"),s=r.objectStore(Mu).put({compositeKey:n,value:e});return new Promise((u,d)=>{s.onsuccess=f=>{u()},r.onerror=f=>{var m;d(pt.create("storage-set",{originalErrorMessage:null===(m=f.target.error)||void 0===m?void 0:m.message}))}})}),Jf.apply(this,arguments)}const Pu=new $t.Yd("@firebase/app-check");function tp(n,e){return(0,te.hl)()?function PI(n,e){return function ny(n,e){return Jf.apply(this,arguments)}(function iy(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Pu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function sy(){return ql().enabled}function oy(){return rp.apply(this,arguments)}function rp(){return rp=(0,x.Z)(function*(){const n=ql();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),rp.apply(this,arguments)}const BI={error:"UNKNOWN_ERROR"};function ZI(n){return te.US.encodeString(JSON.stringify(n),!1)}function $l(n){return ip.apply(this,arguments)}function ip(){return ip=(0,x.Z)(function*(n,e=!1){const t=n.app;Xg(t);const r=et(t);let s,i=r.token;if(i&&!Vo(i)&&(r.token=void 0,i=void 0),!i){const f=yield r.cachedTokenPromise;f&&(Vo(f)?i=f:yield tp(t,void 0))}if(!e&&i&&Vo(i))return{token:i.token};let d,u=!1;if(sy()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Qf(RI(t,yield oy()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),u=!0);const f=yield r.exchangeTokenPromise;return yield tp(t,f),r.token=f,{token:f.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),u=!0),i=yield et(t).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?Pu.warn(f.message):Pu.error(f),s=f}return i?s?d=Vo(i)?{token:i.token,internalError:s}:cy(s):(d={token:i.token},r.token=i,yield tp(t,i)):d=cy(s),u&&uy(t,d),d}),ip.apply(this,arguments)}function op(n,e){const t=et(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function ay(n){const{app:e}=n,t=et(e);let r=t.tokenRefresher;r||(r=function GI(n){const{app:e}=n;return new kI((0,x.Z)(function*(){let r;if(r=et(e).token?yield $l(n,!0):yield $l(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{const t=et(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function uy(n,e){const t=et(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch(i){}}function Vo(n){return n.expireTimeMillis-Date.now()>0}function cy(n){return{token:ZI(BI),error:n}}class $I{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=et(this.app);for(const t of e)op(this.app,t.next);return Promise.resolve()}}const yy="app-check-internal";!function iw(){(0,yt._registerComponent)(new ni.wA("app-check",n=>function jI(n,e){return new $I(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(yy).initialize()})),(0,yt._registerComponent)(new ni.wA(yy,n=>function zI(n){return{getToken:e=>$l(n,e),addTokenListener:e=>function sp(n,e,t,r){const{app:i}=n,s=et(i);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:r,type:e}],s.token&&Vo(s.token)){const d=s.token;Promise.resolve().then(()=>{t({token:d.token}),ay(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>ay(n))}(n,"INTERNAL",e),removeTokenListener:e=>op(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,yt.registerVersion)("@firebase/app-check","0.6.0")}();class lp{constructor(){return(0,$e.vb)("app-check")}}"undefined"!=typeof window&&window,F(9260);const vy=new h.OlP("angularfire2.auth.use-emulator"),Iy=new h.OlP("angularfire2.auth.settings"),wy=new h.OlP("angularfire2.auth.tenant-id"),by=new h.OlP("angularfire2.auth.langugage-code"),Ey=new h.OlP("angularfire2.auth.use-device-language"),Ty=new h.OlP("angularfire.auth.persistence"),xy=(n,e,t,r,i,s,u,d)=>(0,Gt.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const f=e.runOutsideAngular(()=>n.auth());if(t&&f.useEmulator(...t),r&&(f.tenantId=r),f.languageCode=i,s&&f.useDeviceLanguage(),u)for(const[m,g]of Object.entries(u))f.settings[m]=g;return d&&f.setPersistence(d),f},[t,r,i,s,u,d]);let ky=(()=>{class n{constructor(t,r,i,s,u,d,f,m,g,_,w,k){const S=new ae.x,P=(0,gt.of)(void 0).pipe((0,Ul.Q)(u.outsideAngular),(0,Wr.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(F.bind(F,9169)))),(0,Re.U)(()=>(0,Gt.on)(t,s,r)),(0,Re.U)(q=>xy(q,s,d,m,g,_,f,w)),(0,Kg.d)({bufferSize:1,refCount:!1}));if((0,at.PM)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,gt.of)(null);else{P.pipe((0,pI.P)()).subscribe();const oe=P.pipe((0,Wr.w)(Q=>Q.getRedirectResult().then(K=>K,()=>null)),$e.iC,(0,Kg.d)({bufferSize:1,refCount:!1})),ce=P.pipe((0,Wr.w)(Q=>new Xr.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onAuthStateChanged(J=>K.next(J),J=>K.error(J),()=>K.complete()))})))),ee=P.pipe((0,Wr.w)(Q=>new Xr.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onIdTokenChanged(J=>K.next(J),J=>K.error(J),()=>K.complete()))}))));this.authState=oe.pipe(Hg(ce),(0,jf.R)(u.outsideAngular),(0,Ul.Q)(u.insideAngular)),this.user=oe.pipe(Hg(ee),(0,jf.R)(u.outsideAngular),(0,Ul.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,Wr.w)(Q=>Q?(0,Zt.D)(Q.getIdToken()):(0,gt.of)(null))),this.idTokenResult=this.user.pipe((0,Wr.w)(Q=>Q?(0,Zt.D)(Q.getIdTokenResult()):(0,gt.of)(null))),this.credential=(0,Wg.T)(oe,S,this.authState.pipe((0,Ke.h)(Q=>!Q))).pipe((0,Re.U)(Q=>(null==Q?void 0:Q.user)?Q:null),(0,jf.R)(u.outsideAngular),(0,Ul.Q)(u.insideAngular))}return(0,Gt.pX)(this,P,s,{spy:{apply:(q,oe,ce)=>{(q.startsWith("signIn")||q.startsWith("createUser"))&&ce.then(ee=>S.next(ee))}}})}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(Gt.Dh),h.LFG(Gt.xv,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG($e.HU),h.LFG(vy,8),h.LFG(Iy,8),h.LFG(wy,8),h.LFG(by,8),h.LFG(Ey,8),h.LFG(Ty,8),h.LFG(lp,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function Ay(n,e){return function lw(n,e=nh.z){return new Xr.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function dp(n,e){return Ay(n,e).pipe((0,Re.U)(t=>({payload:t,type:"query"})))}function zl(n,e){return dp(n,e).pipe((0,He.O)(void 0),ei(),(0,Re.U)(([t,r])=>{const i=r.payload.docChanges(),s=i.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((u,d)=>{const f=i.find(g=>g.doc.ref.isEqual(u.ref)),m=null==t?void 0:t.payload.docs.find(g=>g.ref.isEqual(u.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(u.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:u}})}),s}))}function Sy(n,e,t){return zl(n,t).pipe((0,Ct.R)((r,i)=>function dw(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function fw(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return fp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return fp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return fp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,on.x)(),(0,Re.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function fp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Cy(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Dy{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=zl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Re.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,He.O)(void 0),ei(),(0,Ke.h)(([r,i])=>i.length>0||!r),(0,Re.U)(([r,i])=>i),$e.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Ct.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Cy(e);return Sy(this.query,t,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return dp(this.query,this.afs.schedulers.outsideAngular).pipe((0,Re.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),$e.iC)}get(e){return(0,Zt.D)(this.query.get(e)).pipe($e.iC)}add(e){return this.ref.add(e)}doc(e){return new Ry(this.ref.doc(e),this.afs)}}class Ry{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Ny(r,t);return new Dy(i,s,this.afs)}snapshotChanges(){return function hw(n,e){return Ay(n,e).pipe((0,He.O)(void 0),ei(),(0,Re.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Re.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,Zt.D)(this.ref.get(e)).pipe($e.iC)}}class pw{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?zl(this.query,this.afs.schedulers.outsideAngular).pipe((0,Re.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Ke.h)(t=>t.length>0),$e.iC):zl(this.query,this.afs.schedulers.outsideAngular).pipe($e.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Ct.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Cy(e);return Sy(this.query,t,this.afs.schedulers.outsideAngular).pipe($e.iC)}valueChanges(e={}){return dp(this.query,this.afs.schedulers.outsideAngular).pipe((0,Re.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),$e.iC)}get(e){return(0,Zt.D)(this.query.get(e)).pipe($e.iC)}}const mw=new h.OlP("angularfire2.enableFirestorePersistence"),gw=new h.OlP("angularfire2.firestore.persistenceSettings"),yw=new h.OlP("angularfire2.firestore.settings"),_w=new h.OlP("angularfire2.firestore.use-emulator");function Ny(n,e=(t=>t)){return{query:e(n),ref:n}}let Oy=(()=>{class n{constructor(t,r,i,s,u,d,f,m,g,_,w,k,S,P,q,oe,ce){this.schedulers=f;const ee=(0,Gt.on)(t,d,r),Q=g;_&&xy(ee,d,w,S,P,q,k,oe),[this.firestore,this.persistenceEnabled$]=(0,Gt.cc)(`${ee.name}.firestore`,"AngularFirestore",ee.name,()=>{const K=d.runOutsideAngular(()=>ee.firestore());if(s&&K.settings(s),Q&&K.useEmulator(...Q),i&&!(0,at.PM)(u)){const J=()=>{try{return(0,Zt.D)(K.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(Ge){return"undefined"!=typeof console&&console.warn(Ge),(0,gt.of)(!1)}};return[K,d.runOutsideAngular(J)]}return[K,(0,gt.of)(!1)]},[s,Q,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=Ny(i,r),d=this.schedulers.ngZone.run(()=>s);return new Dy(d,u,this)}collectionGroup(t,r){const i=r||(u=>u),s=this.firestore.collectionGroup(t);return new pw(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new Ry(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(h.LFG(Gt.Dh),h.LFG(Gt.xv,8),h.LFG(mw,8),h.LFG(yw,8),h.LFG(h.Lbi),h.LFG(h.R0b),h.LFG($e.HU),h.LFG(gw,8),h.LFG(_w,8),h.LFG(ky,8),h.LFG(vy,8),h.LFG(Iy,8),h.LFG(wy,8),h.LFG(by,8),h.LFG(Ey,8),h.LFG(Ty,8),h.LFG(lp,8))},n.\u0275prov=h.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),vw=(()=>{class n{constructor(t,r,i,s){this.fb=t,this.dialogRef=r,this.data=i,this.store=s}onSubmit(){this.dialogRef.close(),window.navigator.clipboard.writeText(this.formGroup.value.copy_link)}ngOnInit(){this.formGroup=this.fb.group({copy_link:[{value:null,disabled:!1},B.kI.required]});const t=Uu(30);(0,Zt.D)(this.store.collection(t).add({actors:this.data.actors.map(r=>r.toDto()),rotations:this.data.rotations.map(r=>r.toDto()),current_rotation:this.data.current_rotation})).subscribe(()=>{this.formGroup.patchValue({copy_link:`${window.location.href}?store=${t}`})})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn),h.Y36(ge),h.Y36(Oy))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-export-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","copy_link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"button",4),h._uU(11),h.ALo(12,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,5,"export_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,7,"export_dialog.placeholder.copy_link")),h.xp6(3),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(12,9,"export_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Wo.Nt,B.Fj,B.JJ,B.u,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),Iw=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r}onSubmit(){const t=this.formGroup.value.link.split("?store=");t.length<2||this.dialogRef.close(t[t.length-1])}ngOnInit(){this.formGroup=this.fb.group({link:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(rn))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-import-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(h.TgZ(0,"h1",0),h._uU(1),h.ALo(2,"translate"),h.qZA(),h.TgZ(3,"mat-dialog-content",1),h.NdJ("submit",function(){return r.onSubmit()}),h.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),h._uU(7),h.ALo(8,"translate"),h.qZA(),h._UZ(9,"input",3),h.qZA(),h.TgZ(10,"button",4),h._uU(11),h.ALo(12,"translate"),h.qZA()()()),2&t&&(h.xp6(1),h.Oqu(h.lcZ(2,5,"import_dialog.title")),h.xp6(2),h.Q6J("formGroup",r.formGroup),h.xp6(4),h.Oqu(h.lcZ(8,7,"import_dialog.placeholder.link")),h.xp6(3),h.Q6J("disabled",r.formGroup.invalid),h.xp6(1),h.hij(" ",h.lcZ(12,9,"import_dialog.submit")," "))},directives:[sn,hr,B.JL,B.sg,B._Y,Ve.KE,Ve.hX,Wo.Nt,B.Fj,B.JJ,B.u,Bt.lW],pipes:[St.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();var mt=(()=>(function(n){n[n.MOVE_ACTOR=0]="MOVE_ACTOR",n[n.DRAW_LINE=1]="DRAW_LINE",n[n.ERASE_LINE=2]="ERASE_LINE"}(mt||(mt={})),mt))(),Tn=F(8962),Vt=F(3191),My=F(9718),cr=F(2722),ww=F(8372);const Wl=["*"],bw=["content"];function Ew(n,e){if(1&n){const t=h.EpF();h.TgZ(0,"div",2),h.NdJ("click",function(){return h.CHM(t),h.oxw()._onBackdropClicked()}),h.qZA()}if(2&n){const t=h.oxw();h.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Tw(n,e){1&n&&(h.TgZ(0,"mat-drawer-content"),h.Hsn(1,2),h.qZA())}const xw=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],kw=["mat-drawer","mat-drawer-content","*"];function Aw(n,e){if(1&n){const t=h.EpF();h.TgZ(0,"div",2),h.NdJ("click",function(){return h.CHM(t),h.oxw()._onBackdropClicked()}),h.qZA()}if(2&n){const t=h.oxw();h.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Sw(n,e){1&n&&(h.TgZ(0,"mat-sidenav-content"),h.Hsn(1,2),h.qZA())}const Cw=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Dw=["mat-sidenav","mat-sidenav-content","*"],Py={transformDrawer:(0,Y.X$)("transform",[(0,Y.SB)("open, open-instant",(0,Y.oB)({transform:"none",visibility:"visible"})),(0,Y.SB)("void",(0,Y.oB)({"box-shadow":"none",visibility:"hidden"})),(0,Y.eR)("void => open-instant",(0,Y.jt)("0ms")),(0,Y.eR)("void <=> open, open-instant => void",(0,Y.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},Nw=new h.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function Ow(){return!1}}),pp=new h.OlP("MAT_DRAWER_CONTAINER");let Kl=(()=>{class n extends Tn.PQ{constructor(t,r,i,s,u){super(i,s,u),this._changeDetectorRef=t,this._container=r}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.sBO),h.Y36((0,h.Gpc)(()=>Fy)),h.Y36(h.SBq),h.Y36(Tn.mF),h.Y36(h.R0b))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(t,r){2&t&&h.Udp("margin-left",r._container._contentMargins.left,"px")("margin-right",r._container._contentMargins.right,"px")},features:[h._Bn([{provide:Tn.PQ,useExisting:n}]),h.qOj],ngContentSelectors:Wl,decls:1,vars:0,template:function(t,r){1&t&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),Ly=(()=>{class n{constructor(t,r,i,s,u,d,f,m){this._elementRef=t,this._focusTrapFactory=r,this._focusMonitor=i,this._platform=s,this._ngZone=u,this._interactivityChecker=d,this._doc=f,this._container=m,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new ae.x,this._animationEnd=new ae.x,this._animationState="void",this.openedChange=new h.vpe(!0),this._openedStream=this.openedChange.pipe((0,Ke.h)(g=>g),(0,Re.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,Ke.h)(g=>g.fromState!==g.toState&&0===g.toState.indexOf("open")),(0,My.h)(void 0)),this._closedStream=this.openedChange.pipe((0,Ke.h)(g=>!g),(0,Re.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,Ke.h)(g=>g.fromState!==g.toState&&"void"===g.toState),(0,My.h)(void 0)),this._destroyed=new ae.x,this.onPositionChanged=new h.vpe,this._modeChanged=new ae.x,this.openedChange.subscribe(g=>{g?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{(0,dr.R)(this._elementRef.nativeElement,"keydown").pipe((0,Ke.h)(g=>g.keyCode===is.hY&&!this.disableClose&&!(0,is.Vb)(g)),(0,cr.R)(this._destroyed)).subscribe(g=>this._ngZone.run(()=>{this.close(),g.stopPropagation(),g.preventDefault()}))}),this._animationEnd.pipe((0,on.x)((g,_)=>g.fromState===_.fromState&&g.toState===_.toState)).subscribe(g=>{const{fromState:_,toState:w}=g;(0===w.indexOf("open")&&"void"===_||"void"===w&&0===_.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t="end"===t?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(t),this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=(0,Vt.Ig)(t)}get autoFocus(){const t=this._autoFocus;return null==t?"side"===this.mode?"dialog":"first-tabbable":t}set autoFocus(t){("true"===t||"false"===t||null==t)&&(t=(0,Vt.Ig)(t)),this._autoFocus=t}get opened(){return this._opened}set opened(t){this.toggle((0,Vt.Ig)(t))}_forceFocus(t,r){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const i=()=>{t.removeEventListener("blur",i),t.removeEventListener("mousedown",i),t.removeAttribute("tabindex")};t.addEventListener("blur",i),t.addEventListener("mousedown",i)})),t.focus(r)}_focusByCssSelector(t,r){let i=this._elementRef.nativeElement.querySelector(t);i&&this._forceFocus(i,r)}_takeFocus(){if(!this._focusTrap)return;const t=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(r=>{!r&&"function"==typeof this._elementRef.nativeElement.focus&&t.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(t){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,t):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const t=this._doc.activeElement;return!!t&&this._elementRef.nativeElement.contains(t)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var t;this._focusTrap&&this._focusTrap.destroy(),null===(t=this._anchor)||void 0===t||t.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(t=!this.opened,r){t&&r&&(this._openedVia=r);const i=this._setOpen(t,!t&&this._isFocusWithinDrawer(),this._openedVia||"program");return t||(this._openedVia=null),i}_setOpen(t,r,i){return this._opened=t,t?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",r&&this._restoreFocus(i)),this._updateFocusTrapState(),new Promise(s=>{this.openedChange.pipe((0,R.q)(1)).subscribe(u=>s(u?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(t){const r=this._elementRef.nativeElement,i=r.parentNode;"end"===t?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),i.insertBefore(this._anchor,r)),i.appendChild(r)):this._anchor&&this._anchor.parentNode.insertBefore(r,this._anchor)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.SBq),h.Y36(An.qV),h.Y36(An.tE),h.Y36(tt.t4),h.Y36(h.R0b),h.Y36(An.ic),h.Y36(at.K0,8),h.Y36(pp,8))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer"]],viewQuery:function(t,r){if(1&t&&h.Gf(bw,5),2&t){let i;h.iGM(i=h.CRH())&&(r._content=i.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(t,r){1&t&&h.WFA("@transform.start",function(s){return r._animationStarted.next(s)})("@transform.done",function(s){return r._animationEnd.next(s)}),2&t&&(h.uIk("align",null),h.d8E("@transform",r._animationState),h.ekj("mat-drawer-end","end"===r.position)("mat-drawer-over","over"===r.mode)("mat-drawer-push","push"===r.mode)("mat-drawer-side","side"===r.mode)("mat-drawer-opened",r.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:Wl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,r){1&t&&(h.F$t(),h.TgZ(0,"div",0,1),h.Hsn(2),h.qZA())},directives:[Tn.PQ],encapsulation:2,data:{animation:[Py.transformDrawer]},changeDetection:0}),n})(),Fy=(()=>{class n{constructor(t,r,i,s,u,d=!1,f){this._dir=t,this._element=r,this._ngZone=i,this._changeDetectorRef=s,this._animationMode=f,this._drawers=new h.n_E,this.backdropClick=new h.vpe,this._destroyed=new ae.x,this._doCheckSubject=new ae.x,this._contentMargins={left:null,right:null},this._contentMarginChanges=new ae.x,t&&t.change.pipe((0,cr.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),u.change().pipe((0,cr.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=d}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=(0,Vt.Ig)(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:(0,Vt.Ig)(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,He.O)(this._allDrawers),(0,cr.R)(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(r=>!r._container||r._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,He.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,ww.b)(10),(0,cr.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,r=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._getWidth();else if("push"==this._left.mode){const i=this._left._getWidth();t+=i,r-=i}if(this._right&&this._right.opened)if("side"==this._right.mode)r+=this._right._getWidth();else if("push"==this._right.mode){const i=this._right._getWidth();r+=i,t-=i}t=t||null,r=r||null,(t!==this._contentMargins.left||r!==this._contentMargins.right)&&(this._contentMargins={left:t,right:r},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe((0,Ke.h)(r=>r.fromState!==r.toState),(0,cr.R)(this._drawers.changes)).subscribe(r=>{"open-instant"!==r.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==t.mode&&t.openedChange.pipe((0,cr.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe((0,cr.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,R.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe((0,cr.R)((0,Wg.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const r=this._element.nativeElement.classList,i="mat-drawer-container-has-open";t?r.add(i):r.remove(i)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{"end"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return"side"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(Se.Is,8),h.Y36(h.SBq),h.Y36(h.R0b),h.Y36(h.sBO),h.Y36(Tn.rL),h.Y36(Nw),h.Y36(Sn.Qb,8))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-drawer-container"]],contentQueries:function(t,r,i){if(1&t&&(h.Suo(i,Kl,5),h.Suo(i,Ly,5)),2&t){let s;h.iGM(s=h.CRH())&&(r._content=s.first),h.iGM(s=h.CRH())&&(r._allDrawers=s)}},viewQuery:function(t,r){if(1&t&&h.Gf(Kl,5),2&t){let i;h.iGM(i=h.CRH())&&(r._userContent=i.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(t,r){2&t&&h.ekj("mat-drawer-container-explicit-backdrop",r._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[h._Bn([{provide:pp,useExisting:n}])],ngContentSelectors:kw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,r){1&t&&(h.F$t(xw),h.YNc(0,Ew,1,2,"div",0),h.Hsn(1),h.Hsn(2,1),h.YNc(3,Tw,2,0,"mat-drawer-content",1)),2&t&&(h.Q6J("ngIf",r.hasBackdrop),h.xp6(3),h.Q6J("ngIf",!r._content))},directives:[Kl,at.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),mp=(()=>{class n extends Kl{constructor(t,r,i,s,u){super(t,r,i,s,u)}}return n.\u0275fac=function(t){return new(t||n)(h.Y36(h.sBO),h.Y36((0,h.Gpc)(()=>Vy)),h.Y36(h.SBq),h.Y36(Tn.mF),h.Y36(h.R0b))},n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(t,r){2&t&&h.Udp("margin-left",r._container._contentMargins.left,"px")("margin-right",r._container._contentMargins.right,"px")},features:[h._Bn([{provide:Tn.PQ,useExisting:n}]),h.qOj],ngContentSelectors:Wl,decls:1,vars:0,template:function(t,r){1&t&&(h.F$t(),h.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),Uy=(()=>{class n extends Ly{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=(0,Vt.Ig)(t)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=(0,Vt.su)(t)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=(0,Vt.su)(t)}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=h.n5z(n)))(r||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(t,r){2&t&&(h.uIk("align",null),h.Udp("top",r.fixedInViewport?r.fixedTopGap:null,"px")("bottom",r.fixedInViewport?r.fixedBottomGap:null,"px"),h.ekj("mat-drawer-end","end"===r.position)("mat-drawer-over","over"===r.mode)("mat-drawer-push","push"===r.mode)("mat-drawer-side","side"===r.mode)("mat-drawer-opened",r.opened)("mat-sidenav-fixed",r.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[h.qOj],ngContentSelectors:Wl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,r){1&t&&(h.F$t(),h.TgZ(0,"div",0,1),h.Hsn(2),h.qZA())},directives:[Tn.PQ],encapsulation:2,data:{animation:[Py.transformDrawer]},changeDetection:0}),n})(),Vy=(()=>{class n extends Fy{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=h.n5z(n)))(r||n)}}(),n.\u0275cmp=h.Xpm({type:n,selectors:[["mat-sidenav-container"]],contentQueries:function(t,r,i){if(1&t&&(h.Suo(i,mp,5),h.Suo(i,Uy,5)),2&t){let s;h.iGM(s=h.CRH())&&(r._content=s.first),h.iGM(s=h.CRH())&&(r._allDrawers=s)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(t,r){2&t&&h.ekj("mat-drawer-container-explicit-backdrop",r._backdropOverride)},exportAs:["matSidenavContainer"],features:[h._Bn([{provide:pp,useExisting:n}]),h.qOj],ngContentSelectors:Dw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,r){1&t&&(h.F$t(Cw),h.YNc(0,Aw,1,2,"div",0),h.Hsn(1),h.Hsn(2,1),h.YNc(3,Sw,2,0,"mat-sidenav-content",1)),2&t&&(h.Q6J("ngIf",r.hasBackdrop),h.xp6(3),h.Q6J("ngIf",!r._content))},directives:[mp,at.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),Mw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[at.ez,we.BQ,Tn.ZD],Tn.ZD,we.BQ]}),n})();var Pw=F(5245);const Lw=["field"];function Fw(n,e){if(1&n&&(h.TgZ(0,"mat-option",8),h._uU(1),h.qZA()),2&n){const t=e.$implicit;h.Q6J("value",t.UUID),h.xp6(1),h.Oqu(t.toString())}}const Uw=[{path:"",component:(()=>{class n{constructor(t,r,i,s){this.formBuilder=t,this.matDialog=r,this.store=i,this.router=s,this.mouseDown=!1,this.actors=[],this.rotations=[],this.currentRotationIndex=0,this.FieldMode=mt,this.fieldMode=mt.MOVE_ACTOR,this.formGroup=this.formBuilder.group({current_rotation:[null,B.kI.required]})}get rotation(){return this.rotations[this.currentRotationIndex]}ngAfterViewInit(){var t=this;this.context=this.fieldElement.nativeElement.getContext("2d"),this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height;for(const r of[["touchstart","mousedown"],["touchmove","mousemove"]])this.context.canvas.addEventListener(r[0],i=>{const s=i.touches[0];this.fieldElement.nativeElement.dispatchEvent(new MouseEvent(r[1],{clientX:s.clientX,clientY:s.clientY}))});this.context.canvas.addEventListener("touchend",()=>this.onMouseUp()),this.context.canvas.addEventListener("touchcancel",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousedown",r=>this.onMouseDown(r)),this.fieldElement.nativeElement.addEventListener("mouseup",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mouseleave",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousemove",r=>this.onMouseMove(r)),setTimeout((0,x.Z)(function*(){const r=new URLSearchParams(window.location.search);if(r&&r.get("store")&&30===r.get("store").length)yield t.importLink(r.get("store")),t.router.navigate(["/"]);else{const i=Cn.retrieve(n.LOCAL_STORAGE_KEY_ROTATIONS),s=Cn.retrieve(n.LOCAL_STORAGE_KEY_ACTORS),u=Cn.retrieve(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION);i&&s&&u?(t.actors=s.map(d=>Hr.fromDto(d,t.context)),t.rotations=i.map(d=>Qe.fromDto(d,t.context)),t.currentRotationIndex=t.rotations.findIndex(d=>d.UUID===u),t.actors.forEach(d=>d.shape.setRotationProperties(t.rotation.UUID,t.rotation.rotation))):t.rotations=[new Qe(new xn(1),"Default rotation")],t.formGroup.patchValue({current_rotation:t.rotation.UUID})}t.formGroup.valueChanges.subscribe(i=>t.onRotationChanged(i.current_rotation)),t.render()}),100),(0,dr.R)(window,"resize").subscribe(()=>this.fixRenderDimensions())}fixRenderDimensions(){this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height,this.render()}onRotationChanged(t){this.currentRotationIndex=this.rotations.findIndex(r=>r.UUID===t),this.actors.forEach(r=>r.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.render()}onMouseDown(t){const r=t.clientX,i=t.clientY;if(this.mouseDown=!0,this.fieldMode===mt.MOVE_ACTOR)for(let s=this.actors.length-1;s>=0;--s){const u=this.actors[s].shape;if(u.isHit(r,i))return void(this.draggedShape=u)}else this.fieldMode===mt.DRAW_LINE&&(this.drawnLine=new Bo(this.context),this.drawnLine.addPosition(r,i),this.rotation.addLine(this.drawnLine))}onMouseUp(){this.draggedShape=void 0,this.drawnLine=void 0,this.mouseDown=!1}onMouseMove(t){const r=t.clientX,i=t.clientY;if(this.fieldMode===mt.ERASE_LINE)this.mouseDown&&this.rotation.removeIfHitLine(r,i);else if(this.draggedShape)this.draggedShape.setPosition(r,i);else{if(!this.drawnLine)return;this.drawnLine.addPosition(r,i)}this.render()}onAddActorClicked(){this.matDialog.open(Ko,{autoFocus:!1}).afterClosed().subscribe(r=>{if(r){switch(r.player_role){case ot.Setter:this.addShape(r,new kn(r,this.context));break;case ot.MiddleBlocker:this.addShape(r,new ns(r,this.context,!1));break;case ot.Libero:this.addShape(r,new ns(r,this.context,!0));break;case ot.OutsideHitter:this.addShape(r,new lr(r,this.context,!1));break;case ot.OppositeHitter:this.addShape(r,new lr(r,this.context,!0))}this.render()}})}addShape(t,r){r.setRotationProperties(this.rotation.UUID,this.rotation.rotation),t.setShape(r),this.actors.push(t)}onDeleteActorClicked(){this.matDialog.open(Xl,{data:{actors:this.actors},autoFocus:!1}).afterClosed().subscribe(r=>{if(!r)return;const i=this.actors.findIndex(s=>s.UUID===r);this.actors.splice(i,1),this.render()})}onDeleteRotationClicked(){this.matDialog.open(eh,{data:{rotations:this.rotations},autoFocus:!1}).afterClosed().subscribe(r=>{if(!r)return;const i=this.rotation.UUID,s=this.rotations.findIndex(u=>u.UUID===r);this.rotations.splice(s,1),this.actors.forEach(u=>u.shape.removeRotation(r)),i===r&&(0===this.rotations.length&&this.rotations.push(new Qe(new xn(1),"Default rotation")),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.actors.forEach(u=>u.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation))),this.currentRotationIndex=this.rotations.findIndex(u=>u.UUID===i),this.render()})}onAddRotationClicked(){this.matDialog.open(th,{autoFocus:!1}).afterClosed().subscribe(r=>{!r||(this.actors.forEach(i=>i.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.rotations.push(r),this.currentRotationIndex=this.rotations.length-1,this.formGroup.patchValue({current_rotation:r.UUID}),this.render())})}onExportClicked(){this.matDialog.open(vw,{autoFocus:!1,data:{actors:this.actors,rotations:this.rotations,current_rotation:this.rotation.UUID}})}onImportClicked(){this.matDialog.open(Iw,{autoFocus:!1}).afterClosed().subscribe(r=>this.importLink(r))}importLink(t){var r=this;return(0,x.Z)(function*(){!t||30!==t.length||(yield r.store.collection(t).get().toPromise().then(i=>{const s=i.docs[0].data();r.actors=s.actors.map(d=>Hr.fromDto(d,r.context)),r.rotations=s.rotations.map(d=>Qe.fromDto(d,r.context));const u=s.current_rotation;r.currentRotationIndex=r.rotations.findIndex(d=>d.UUID===u),r.formGroup.patchValue({current_rotation:r.rotation.UUID}),r.actors.forEach(d=>d.shape.setRotationProperties(r.rotation.UUID,r.rotation.rotation)),r.render()}))})()}setMoveActorMode(){this.fieldMode=mt.MOVE_ACTOR}onToggleDrawMode(){this.fieldMode=this.fieldMode===mt.DRAW_LINE?mt.MOVE_ACTOR:mt.DRAW_LINE}onToggleEraseMode(){this.fieldMode=this.fieldMode===mt.ERASE_LINE?mt.MOVE_ACTOR:mt.ERASE_LINE}render(){this.initCourt(),this.actors.forEach(t=>t.draw()),this.rotation.draw(),Cn.store(n.LOCAL_STORAGE_KEY_ROTATIONS,this.rotations.map(t=>t.toDto())),Cn.store(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION,this.rotation.UUID),Cn.store(n.LOCAL_STORAGE_KEY_ACTORS,this.actors.map(t=>t.toDto()))}initCourt(){const t=this.context.canvas.getBoundingClientRect().width,r=this.context.canvas.getBoundingClientRect().height;this.context.clearRect(0,0,t,r),this.context.fillStyle=n.OUTER_COLOR,this.context.fillRect(0,0,t,r);const i=.025*t,u=(r-.025*r)/10,d=(t-2*i)/9,f=i,m=t-2*i;this.context.fillStyle=n.FRONT_FIELD_COLOR,this.context.fillRect(f,0,m,4*u),this.context.fillStyle=n.BACK_FIELD_COLOR,this.context.fillRect(f,4*u,m,6*u);const g=u/20,_=d/20;this.context.fillStyle=n.LINE_COLOR,this.context.fillRect(f,0,_,10*u),this.context.fillRect(m+f-_,0,_,10*u),this.context.fillRect(f,4*u,m,g),this.context.fillRect(f,10*u,m,g),this.context.fillRect(f,1*u-3*g,m,3*g)}}return n.OUTER_COLOR="#469ABB",n.LINE_COLOR="#FFFFFF",n.FRONT_FIELD_COLOR="#FF5202",n.BACK_FIELD_COLOR="#F8A941",n.LOCAL_STORAGE_KEY_ACTORS="actors_storage",n.LOCAL_STORAGE_KEY_ROTATIONS="rotations_storage",n.LOCAL_STORAGE_KEY_CURRENT_ROTATION="current_rotation_uuid",n.\u0275fac=function(t){return new(t||n)(h.Y36(B.qu),h.Y36(as),h.Y36(Oy),h.Y36(C.F0))},n.\u0275cmp=h.Xpm({type:n,selectors:[["vpms-field"]],viewQuery:function(t,r){if(1&t&&h.Gf(Lw,5),2&t){let i;h.iGM(i=h.CRH())&&(r.fieldElement=i.first)}},decls:57,vars:37,consts:[["mode","over"],["sidenav",""],[3,"formGroup"],["formControlName","current_rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["mat-flat-button","",1,"toggle_sidenav",3,"click"],["field",""],[3,"value"]],template:function(t,r){if(1&t){const i=h.EpF();h.TgZ(0,"mat-sidenav-container")(1,"mat-sidenav",0,1)(3,"mat-form-field",2)(4,"mat-select",3),h.YNc(5,Fw,2,2,"mat-option",4),h.qZA()(),h.TgZ(6,"button",5),h.NdJ("click",function(){return r.onAddRotationClicked()}),h.TgZ(7,"mat-icon"),h._uU(8,"add"),h.qZA(),h._uU(9),h.ALo(10,"translate"),h.qZA(),h.TgZ(11,"button",5),h.NdJ("click",function(){return r.onDeleteRotationClicked()}),h.TgZ(12,"mat-icon"),h._uU(13,"delete"),h.qZA(),h._uU(14),h.ALo(15,"translate"),h.qZA(),h.TgZ(16,"button",5),h.NdJ("click",function(){return r.onAddActorClicked()}),h.TgZ(17,"mat-icon"),h._uU(18,"add"),h.qZA(),h._uU(19),h.ALo(20,"translate"),h.qZA(),h.TgZ(21,"button",5),h.NdJ("click",function(){return r.onDeleteActorClicked()}),h.TgZ(22,"mat-icon"),h._uU(23,"delete"),h.qZA(),h._uU(24),h.ALo(25,"translate"),h.qZA(),h.TgZ(26,"button",5),h.NdJ("click",function(){return r.onExportClicked()}),h.TgZ(27,"mat-icon"),h._uU(28,"share"),h.qZA(),h._uU(29),h.ALo(30,"translate"),h.qZA(),h.TgZ(31,"button",5),h.NdJ("click",function(){return r.onImportClicked()}),h.TgZ(32,"mat-icon"),h._uU(33,"import_export"),h.qZA(),h._uU(34),h.ALo(35,"translate"),h.qZA(),h.TgZ(36,"button",5),h.NdJ("click",function(){return r.setMoveActorMode()}),h.TgZ(37,"mat-icon"),h._uU(38,"person"),h.qZA(),h._uU(39),h.ALo(40,"translate"),h.qZA(),h.TgZ(41,"button",5),h.NdJ("click",function(){return r.onToggleDrawMode()}),h.TgZ(42,"mat-icon"),h._uU(43,"mode_edit_outline"),h.qZA(),h._uU(44),h.ALo(45,"translate"),h.qZA(),h.TgZ(46,"button",5),h.NdJ("click",function(){return r.onToggleEraseMode()}),h.TgZ(47,"mat-icon"),h._uU(48,"auto_fix_normal"),h.qZA(),h._uU(49),h.ALo(50,"translate"),h.qZA()(),h.TgZ(51,"mat-sidenav-content")(52,"button",6),h.NdJ("click",function(){return h.CHM(i),h.MAs(2).toggle()}),h.TgZ(53,"mat-icon"),h._uU(54,"arrow_right"),h.qZA()(),h._UZ(55,"canvas",null,7),h.qZA()()}if(2&t){const i=h.MAs(2);h.xp6(3),h.Q6J("formGroup",r.formGroup),h.xp6(2),h.Q6J("ngForOf",r.rotations),h.xp6(4),h.hij(" ",h.lcZ(10,19,"field.add_rotation")," "),h.xp6(5),h.hij(" ",h.lcZ(15,21,"field.delete_rotation")," "),h.xp6(5),h.hij(" ",h.lcZ(20,23,"field.add_actor")," "),h.xp6(5),h.hij(" ",h.lcZ(25,25,"field.delete_actor")," "),h.xp6(5),h.hij(" ",h.lcZ(30,27,"field.export")," "),h.xp6(5),h.hij(" ",h.lcZ(35,29,"field.import")," "),h.xp6(2),h.ekj("toggled",r.fieldMode===r.FieldMode.MOVE_ACTOR),h.xp6(3),h.hij(" ",h.lcZ(40,31,"field.actor_mode")," "),h.xp6(2),h.ekj("toggled",r.fieldMode===r.FieldMode.DRAW_LINE),h.xp6(3),h.hij(" ",h.lcZ(45,33,"field.draw_mode")," "),h.xp6(2),h.ekj("toggled",r.fieldMode===r.FieldMode.ERASE_LINE),h.xp6(3),h.hij(" ",h.lcZ(50,35,"field.erase_mode")," "),h.xp6(3),h.ekj("is_opened",i.opened)}},directives:[Vy,Uy,Ve.KE,B.JL,B.sg,Jr.gD,B.JJ,B.u,at.sg,we.ey,Bt.lW,Pw.Hw,mp],pipes:[St.X$],styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}.toggled[_ngcontent-%COMP%]{color:#0a64ae}mat-sidenav-container[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:15rem;padding:1rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:3rem;text-align:left;margin-bottom:.5rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#0a64ae}mat-sidenav[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.toggle_sidenav[_ngcontent-%COMP%]{position:absolute;top:3rem;left:-1rem;z-index:20;transform:rotate(90deg)}.toggle_sidenav.is_opened[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(90deg)}.toggle_sidenav[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-90deg)}canvas[_ngcontent-%COMP%]{display:block;height:100%;width:100%;touch-action:none}"]}),n})()}];let Vw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[C.Bz.forChild(Uw)],C.Bz]}),n})();var qy=F(7144);let Gy=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({}),n})(),Yw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[we.si,we.BQ,qy.Q8,Gy],we.BQ,Gy]}),n})(),Jw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=h.oAB({type:n}),n.\u0275inj=h.cJS({imports:[[Vw,I.m,St.aw,zo,B.UX,at.ez,Yw,Mw]]}),n})()},9169:($y,Fu,F)=>{F.r(Fu);var I=F(5861),St=F(3942),C=F(2090),x=F(9681),qo=F(1877),Kr=F(655),lr=F(4859);const Vu=function ns(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Hr=function Bo(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},h=new C.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),nn=new qo.Yd("@firebase/auth");function we(c,...o){nn.logLevel<=qo.in.ERROR&&nn.error(`Auth (${x.SDK_VERSION}): ${c}`,...o)}function Se(c,...o){throw Ke(c,...o)}function ae(c,...o){return Ke(c,...o)}function qu(c,o,a){const l=Object.assign(Object.assign({},Hr()),{[o]:a});return new C.LL("auth","Firebase",l).create(o,{appName:c.name})}function gt(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&Se(c,"argument-error"),qu(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ke(c,...o){if("string"!=typeof c){const a=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return h.create(c,...o)}function R(c,o,...a){if(!c)throw Ke(o,...a)}function He(c){const o="INTERNAL ASSERTION FAILED: "+c;throw we(o),new Error(o)}function tt(c,o){c||He(o)}const at=new Map;function Y(c){tt(c instanceof Function,"Expected a class definition");let o=at.get(c);return o?(tt(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,at.set(c,o),o)}function Sn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Zo(){return"http:"===ss()||"https:"===ss()}function ss(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class Qr{constructor(o,a){this.shortDelay=o,this.longDelay=a,tt(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,C.uI)()||(0,C.b$)()}get(){return function Hl(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Zo()||(0,C.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Go(c,o){tt(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Bu{static initialize(o,a,l){this.fetchImpl=o,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void He("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void He("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void He("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const rn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Zu=new Qr(3e4,6e4);function ge(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function Pe(c,o,a,l){return os.apply(this,arguments)}function os(){return(os=(0,I.Z)(function*(c,o,a,l,p={}){return Ql(c,p,(0,I.Z)(function*(){let y={},v={};l&&("GET"===o?v=l:y={body:JSON.stringify(l)});const b=(0,C.xO)(Object.assign({key:c.config.apiKey},v)).slice(1),N=yield c._getAdditionalHeaders();return N["Content-Type"]="application/json",c.languageCode&&(N["X-Firebase-Locale"]=c.languageCode),Bu.fetch()(as(c,c.config.apiHost,a,b),Object.assign({method:o,headers:N,referrerPolicy:"no-referrer"},y))}))})).apply(this,arguments)}function Ql(c,o,a){return $o.apply(this,arguments)}function $o(){return($o=(0,I.Z)(function*(c,o,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},rn),o);try{const p=new Yl(c),y=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const v=yield y.json();if("needConfirmation"in v)throw Yr(c,"account-exists-with-different-credential",v);if(y.ok&&!("errorMessage"in v))return v;{const b=y.ok?v.errorMessage:v.error.message,[N,L]=b.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===N)throw Yr(c,"credential-already-in-use",v);if("EMAIL_EXISTS"===N)throw Yr(c,"email-already-in-use",v);if("USER_DISABLED"===N)throw Yr(c,"user-disabled",v);const j=l[N]||N.toLowerCase().replace(/[_\s]+/g,"-");if(L)throw qu(c,j,L);Se(c,j)}}catch(p){if(p instanceof C.ZR)throw p;Se(c,"network-request-failed")}})).apply(this,arguments)}function qt(c,o,a,l){return jo.apply(this,arguments)}function jo(){return(jo=(0,I.Z)(function*(c,o,a,l,p={}){const y=yield Pe(c,o,a,l,p);return"mfaPendingCredential"in y&&Se(c,"multi-factor-auth-required",{_serverResponse:y}),y})).apply(this,arguments)}function as(c,o,a,l){const p=`${o}${a}?${l}`;return c.config.emulator?Go(c.config,p):`${c.config.apiScheme}://${p}`}class Yl{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(ae(this.auth,"network-request-failed")),Zu.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Yr(c,o,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const p=ae(c,o,l);return p.customData._tokenResponse=a,p}function sn(){return(sn=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function hr(c,o){return Gu.apply(this,arguments)}function Gu(){return(Gu=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Jl(c,o){return zo.apply(this,arguments)}function zo(){return(zo=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Ve(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function Bt(){return(Bt=(0,I.Z)(function*(c,o=!1){const a=(0,C.m9)(c),l=yield a.getIdToken(o),p=us(l);R(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const y="object"==typeof p.firebase?p.firebase:void 0,v=null==y?void 0:y.sign_in_provider;return{claims:p,token:l,authTime:Ve(Ko(p.auth_time)),issuedAtTime:Ve(Ko(p.iat)),expirationTime:Ve(Ko(p.exp)),signInProvider:v||null,signInSecondFactor:(null==y?void 0:y.sign_in_second_factor)||null}})).apply(this,arguments)}function Ko(c){return 1e3*Number(c)}function us(c){const[o,a,l]=c.split(".");if(void 0===o||void 0===a||void 0===l)return we("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,C.tV)(a);return p?JSON.parse(p):(we("Failed to decode base64 JWT payload"),null)}catch(p){return we("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function Qe(c,o){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,I.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(l){throw l instanceof C.ZR&&eh(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function eh({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class th{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),l)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Cn{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ve(this.lastLoginAt),this.creationTime=Ve(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function dr(c){return Zt.apply(this,arguments)}function Zt(){return(Zt=(0,I.Z)(function*(c){var o;const a=c.auth,l=yield c.getIdToken(),p=yield Qe(c,Jl(a,{idToken:l}));R(null==p?void 0:p.users.length,a,"internal-error");const y=p.users[0];c._notifyReloadListener(y);const v=(null===(o=y.providerUserInfo)||void 0===o?void 0:o.length)?rh(y.providerUserInfo):[],b=$e(c.providerData,v),j=!!c.isAnonymous&&!(c.email&&y.passwordHash||(null==b?void 0:b.length)),$={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:b,metadata:new Cn(y.createdAt,y.lastLoginAt),isAnonymous:j};Object.assign(c,$)})).apply(this,arguments)}function Xr(){return(Xr=(0,I.Z)(function*(c){const o=(0,C.m9)(c);yield dr(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function $e(c,o){return[...c.filter(l=>!o.some(p=>p.providerId===l.providerId)),...o]}function rh(c){return c.map(o=>{var{providerId:a}=o,l=(0,Kr._T)(o,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function ei(){return(ei=(0,I.Z)(function*(c,o){const a=yield Ql(c,{},(0,I.Z)(function*(){const l=(0,C.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:y}=c.config,v=as(c,p,"/v1/token",`key=${y}`),b=yield c._getAdditionalHeaders();return b["Content-Type"]="application/x-www-form-urlencoded",Bu.fetch()(v,{method:"POST",headers:b,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Re{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){R(o.idToken,"internal-error"),R(void 0!==o.idToken,"internal-error"),R(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Xl(c){const o=us(c);return R(o,"internal-error"),R(void 0!==o.exp,"internal-error"),R(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var l=this;return(0,I.Z)(function*(){return R(!l.accessToken||l.refreshToken,o,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var l=this;return(0,I.Z)(function*(){const{accessToken:p,refreshToken:y,expiresIn:v}=yield function ih(c,o){return ei.apply(this,arguments)}(o,a);l.updateTokensAndExpiration(p,y,Number(v))})()}updateTokensAndExpiration(o,a,l){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,a){const{refreshToken:l,accessToken:p,expirationTime:y}=a,v=new Re;return l&&(R("string"==typeof l,"internal-error",{appName:o}),v.refreshToken=l),p&&(R("string"==typeof p,"internal-error",{appName:o}),v.accessToken=p),y&&(R("number"==typeof y,"internal-error",{appName:o}),v.expirationTime=y),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Re,this.toJSON())}_performRefresh(){return He("not implemented")}}function Ct(c,o){R("string"==typeof c||void 0===c,"internal-error",{appName:o})}class on{constructor(o){var{uid:a,auth:l,stsTokenManager:p}=o,y=(0,Kr._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new th(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new Cn(y.createdAt||void 0,y.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const l=yield Qe(a,a.stsTokenManager.getToken(a.auth,o));return R(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(o){return function Jr(c){return Bt.apply(this,arguments)}(this,o)}reload(){return function nh(c){return Xr.apply(this,arguments)}(this)}_assign(o){this!==o&&(R(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new on(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){R(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var l=this;return(0,I.Z)(function*(){let p=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield dr(l)),yield l.auth._persistUserIfCurrent(l),p&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield Qe(o,function yp(c,o){return sn.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var l,p,y,v,b,N,L,j;const $=null!==(l=a.displayName)&&void 0!==l?l:void 0,fe=null!==(p=a.email)&&void 0!==p?p:void 0,kt=null!==(y=a.phoneNumber)&&void 0!==y?y:void 0,Bi=null!==(v=a.photoURL)&&void 0!==v?v:void 0,rr=null!==(b=a.tenantId)&&void 0!==b?b:void 0,At=null!==(N=a._redirectEventId)&&void 0!==N?N:void 0,iu=null!==(L=a.createdAt)&&void 0!==L?L:void 0,su=null!==(j=a.lastLoginAt)&&void 0!==j?j:void 0,{uid:_o,emailVerified:ir,isAnonymous:vo,providerData:ou,stsTokenManager:Ae}=a;R(_o&&Ae,o,"internal-error");const re=Re.fromJSON(this.name,Ae);R("string"==typeof _o,o,"internal-error"),Ct($,o.name),Ct(fe,o.name),R("boolean"==typeof ir,o,"internal-error"),R("boolean"==typeof vo,o,"internal-error"),Ct(kt,o.name),Ct(Bi,o.name),Ct(rr,o.name),Ct(At,o.name),Ct(iu,o.name),Ct(su,o.name);const Io=new on({uid:_o,auth:o,email:fe,emailVerified:ir,displayName:$,isAnonymous:vo,photoURL:Bi,phoneNumber:kt,tenantId:rr,stsTokenManager:re,createdAt:iu,lastLoginAt:su});return ou&&Array.isArray(ou)&&(Io.providerData=ou.map(nl=>Object.assign({},nl))),At&&(Io._redirectEventId=At),Io}static _fromIdTokenResponse(o,a,l=!1){return(0,I.Z)(function*(){const p=new Re;p.updateFromServerResponse(a);const y=new on({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:l});return yield dr(y),y})()}}const ti=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,l){var p=this;return(0,I.Z)(function*(){p.storage[a]=l})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=l.storage[a];return void 0===p?null:p})()}_remove(a){var l=this;return(0,I.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function Dn(c,o,a){return`firebase:${c}:${o}:${a}`}class yt{constructor(o,a,l){this.persistence=o,this.auth=a,this.userKey=l;const{config:p,name:y}=this.auth;this.fullUserKey=Dn(this.userKey,p.apiKey,y),this.fullPersistenceKey=Dn("persistence",p.apiKey,y),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?on._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,l="authUser"){return(0,I.Z)(function*(){if(!a.length)return new yt(Y(ti),o,l);const p=(yield Promise.all(a.map(function(){var L=(0,I.Z)(function*(j){if(yield j._isAvailable())return j});return function(j){return L.apply(this,arguments)}}()))).filter(L=>L);let y=p[0]||Y(ti);const v=Dn(l,o.config.apiKey,o.name);let b=null;for(const L of a)try{const j=yield L._get(v);if(j){const $=on._fromJSON(o,j);L!==y&&(b=$),y=L;break}}catch(j){}const N=p.filter(L=>L._shouldAllowMigration);return y._shouldAllowMigration&&N.length?(y=N[0],b&&(yield y._set(v,b.toJSON())),yield Promise.all(a.map(function(){var L=(0,I.Z)(function*(j){if(j!==y)try{yield j._remove(v)}catch($){}});return function(j){return L.apply(this,arguments)}}())),new yt(y,o,l)):new yt(y,o,l)})()}}function ni(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Dt(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if($t(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(cs(o))return"Blackberry";if(z(o))return"Webos";if(te(o))return"Safari";if((o.includes("chrome/")||$u(o))&&!o.includes("edge/"))return"Chrome";if(V(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function $t(c=(0,C.z$)()){return/firefox\//i.test(c)}function te(c=(0,C.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function $u(c=(0,C.z$)()){return/crios\//i.test(c)}function Dt(c=(0,C.z$)()){return/iemobile/i.test(c)}function V(c=(0,C.z$)()){return/android/i.test(c)}function cs(c=(0,C.z$)()){return/blackberry/i.test(c)}function z(c=(0,C.z$)()){return/webos/i.test(c)}function jt(c=(0,C.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function hs(c=(0,C.z$)()){return jt(c)||V(c)||z(c)||cs(c)||/windows phone/i.test(c)||Dt(c)}function ju(c,o=[]){let a;switch(c){case"Browser":a=ni((0,C.z$)());break;case"Worker":a=`${ni((0,C.z$)())}-${c}`;break;default:a=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${x.SDK_VERSION}/${l}`}class ah{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const l=y=>new Promise((v,b)=>{try{v(o(y))}catch(N){b(N)}});l.onAbort=a,this.queue.push(l);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){if(a.auth.currentUser===o)return;const l=[];try{for(const p of a.queue)yield p(o),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const y of l)try{y()}catch(v){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}class je{constructor(o,a,l){this.app=o,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Le(this),this.idTokenSubscription=new Le(this),this.beforeStateQueue=new ah(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=h,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(o,a){var l=this;return a&&(this._popupRedirectResolver=Y(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var p,y;if(!l._deleted&&(l.persistenceManager=yield yt.create(l,o),!l._deleted)){if(null===(p=l._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(v){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(y=l.currentUser)||void 0===y?void 0:y.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var l;const p=yield a.assertedPersistence.getCurrentUser();let y=p,v=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const b=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,N=null==y?void 0:y._redirectEventId,L=yield a.tryRedirectSignIn(o);(!b||b===N)&&(null==L?void 0:L.user)&&(y=L.user,v=!0)}if(!y)return a.directlySetCurrentUser(null);if(!y._redirectEventId){if(v)try{yield a.beforeStateQueue.runMiddleware(y)}catch(b){y=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(b))}return y?a.reloadAndSetCurrentUserOrClear(y):a.directlySetCurrentUser(null)}return R(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===y._redirectEventId?a.directlySetCurrentUser(y):a.reloadAndSetCurrentUserOrClear(y)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){try{yield dr(o)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function gp(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const l=o?(0,C.m9)(o):null;return l&&R(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(o,a=!1){var l=this;return(0,I.Z)(function*(){if(!l._deleted)return o&&R(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,I.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(Y(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new C.LL("auth","Firebase",o())}onAuthStateChanged(o,a,l){return this.registerStateListener(this.authStateSubscription,o,a,l)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,l){return this.registerStateListener(this.idTokenSubscription,o,a,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var l=this;return(0,I.Z)(function*(){const p=yield l.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const l=o&&Y(o)||a._popupRedirectResolver;R(l,a,"argument-error"),a.redirectPersistenceManager=yield yt.create(a,[Y(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var l,p;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,l,p){if(this._deleted)return()=>{};const y="function"==typeof a?a:a.next.bind(a),v=this._isInitialized?Promise.resolve():this._initializationPromise;return R(v,this,"internal-error"),v.then(()=>y(this.currentUser)),"function"==typeof a?o.addObserver(a,l,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return R(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=ju(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(l["X-Firebase-Client"]=p),l})()}}function be(c){return(0,C.m9)(c)}class Le{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,C.ne)(a=>this.observer=a)}get next(){return R(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function zu(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function ds(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Ee{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return He("not implemented")}_getIdTokenResponse(o){return He("not implemented")}_linkToIdToken(o,a){return He("not implemented")}_getReauthenticationResolver(o){return He("not implemented")}}function Hu(c,o){return fr.apply(this,arguments)}function fr(){return(fr=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:resetPassword",ge(c,o))})).apply(this,arguments)}function Qo(c,o){return ii.apply(this,arguments)}function ii(){return(ii=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function fs(c,o){return _t.apply(this,arguments)}function _t(){return(_t=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:update",ge(c,o))})).apply(this,arguments)}function Jo(){return(Jo=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPassword",ge(c,o))})).apply(this,arguments)}function ps(c,o){return an.apply(this,arguments)}function an(){return(an=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:sendOobCode",ge(c,o))})).apply(this,arguments)}function Qu(c,o){return si.apply(this,arguments)}function si(){return(si=(0,I.Z)(function*(c,o){return ps(c,o)})).apply(this,arguments)}function Yu(c,o){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,I.Z)(function*(c,o){return ps(c,o)})).apply(this,arguments)}function Ju(c,o){return pr.apply(this,arguments)}function pr(){return(pr=(0,I.Z)(function*(c,o){return ps(c,o)})).apply(this,arguments)}function ea(c,o){return oi.apply(this,arguments)}function oi(){return(oi=(0,I.Z)(function*(c,o){return ps(c,o)})).apply(this,arguments)}function na(){return(na=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithEmailLink",ge(c,o))})).apply(this,arguments)}function ai(){return(ai=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithEmailLink",ge(c,o))})).apply(this,arguments)}class mr extends Ee{constructor(o,a,l,p=null){super("password",l),this._email=o,this._password=a,this._tenantId=p}static _fromEmailAndPassword(o,a){return new mr(o,a,"password")}static _fromEmailAndCode(o,a,l=null){return new mr(o,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){switch(a.signInMethod){case"password":return function Yo(c,o){return Jo.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function ta(c,o){return na.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:Se(o,"internal-error")}})()}_linkToIdToken(o,a){var l=this;return(0,I.Z)(function*(){switch(l.signInMethod){case"password":return Qo(o,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function uh(c,o){return ai.apply(this,arguments)}(o,{idToken:a,email:l._email,oobCode:l._password});default:Se(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function Wt(c,o){return Rn.apply(this,arguments)}function Rn(){return(Rn=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithIdp",ge(c,o))})).apply(this,arguments)}class nt extends Ee{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new nt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):Se("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p}=a,y=(0,Kr._T)(a,["providerId","signInMethod"]);if(!l||!p)return null;const v=new nt(l,p);return v.idToken=y.idToken||void 0,v.accessToken=y.accessToken||void 0,v.secret=y.secret,v.nonce=y.nonce,v.pendingToken=y.pendingToken||null,v}_getIdTokenResponse(o){return Wt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,Wt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Wt(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,C.xO)(a)}return o}}function lh(c,o){return ra.apply(this,arguments)}function ra(){return(ra=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:sendVerificationCode",ge(c,o))})).apply(this,arguments)}function ui(){return(ui=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPhoneNumber",ge(c,o))})).apply(this,arguments)}function gs(){return(gs=(0,I.Z)(function*(c,o){const a=yield qt(c,"POST","/v1/accounts:signInWithPhoneNumber",ge(c,o));if(a.temporaryProof)throw Yr(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const ec={USER_NOT_FOUND:"user-not-found"};function ci(){return(ci=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPhoneNumber",ge(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),ec)})).apply(this,arguments)}class Kt extends Ee{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Kt({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Kt({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function ms(c,o){return ui.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function Xu(c,o){return gs.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function ys(c,o){return ci.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:l,verificationCode:p}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:l,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}=o;return l||a||p||y?new Kt({verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}):null}}class gr{constructor(o){var a,l,p,y,v,b;const N=(0,C.zd)((0,C.pd)(o)),L=null!==(a=N.apiKey)&&void 0!==a?a:null,j=null!==(l=N.oobCode)&&void 0!==l?l:null,$=function ia(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=N.mode)&&void 0!==p?p:null);R(L&&j&&$,"argument-error"),this.apiKey=L,this.operation=$,this.code=j,this.continueUrl=null!==(y=N.continueUrl)&&void 0!==y?y:null,this.languageCode=null!==(v=N.languageCode)&&void 0!==v?v:null,this.tenantId=null!==(b=N.tenantId)&&void 0!==b?b:null}static parseLink(o){const a=function sa(c){const o=(0,C.zd)((0,C.pd)(c)).link,a=o?(0,C.zd)((0,C.pd)(o)).deep_link_id:null,l=(0,C.zd)((0,C.pd)(c)).deep_link_id;return(l?(0,C.zd)((0,C.pd)(l)).link:null)||l||a||o||c}(o);try{return new gr(a)}catch(l){return null}}}let oa=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return mr._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const p=gr.parseLink(l);return R(p,"argument-error"),mr._fromEmailAndCode(a,p.code,p.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Rt{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Nn extends Rt{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class un extends Nn{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return R("providerId"in a&&"signInMethod"in a,"argument-error"),nt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return R(o.idToken||o.accessToken,"argument-error"),nt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return un.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return un.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:l,oauthTokenSecret:p,pendingToken:y,nonce:v,providerId:b}=o;if(!l&&!p&&!a&&!y||!b)return null;try{return new un(b)._credential({idToken:a,accessToken:l,nonce:v,pendingToken:y})}catch(N){return null}}}let aa=(()=>{class c extends Nn{constructor(){super("facebook.com")}static credential(a){return nt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),tc=(()=>{class c extends Nn{constructor(){super("google.com"),this.addScope("profile")}static credential(a,l){return nt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:l,oauthAccessToken:p}=a;if(!l&&!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),_s=(()=>{class c extends Nn{constructor(){super("github.com")}static credential(a){return nt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class cn extends Ee{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return Wt(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,Wt(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,Wt(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p,pendingToken:y}=a;return l&&p&&y&&l===p?new cn(l,y):null}static _create(o,a){return new cn(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Ce extends Rt{constructor(o){R(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Ce.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Ce.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=cn.fromJSON(o);return R(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:l}=o;if(!a||!l)return null;try{return cn._create(l,a)}catch(p){return null}}}let li=(()=>{class c extends Nn{constructor(){super("twitter.com")}static credential(a,l){return nt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=a;if(!l||!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function vs(c,o){return ca.apply(this,arguments)}function ca(){return(ca=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signUp",ge(c,o))})).apply(this,arguments)}class vt{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,l,p=!1){return(0,I.Z)(function*(){const y=yield on._fromIdTokenResponse(o,l,p),v=la(l);return new vt({user:y,providerId:v,_tokenResponse:l,operationType:a})})()}static _forOperation(o,a,l){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const p=la(l);return new vt({user:o,providerId:p,_tokenResponse:l,operationType:a})})()}}function la(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function ha(){return(ha=(0,I.Z)(function*(c){var o;const a=be(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new vt({user:a.currentUser,providerId:null,operationType:"signIn"});const l=yield vs(a,{returnSecureToken:!0}),p=yield vt._fromIdTokenResponse(a,"signIn",l,!0);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class hi extends C.ZR{constructor(o,a,l,p){var y;super(a.code,a.message),this.operationType=l,this.user=p,Object.setPrototypeOf(this,hi.prototype),this.customData={appName:o.name,tenantId:null!==(y=o.tenantId)&&void 0!==y?y:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,a,l,p){return new hi(o,a,l,p)}}function Is(c,o,a,l){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(y=>{throw"auth/multi-factor-auth-required"===y.code?hi._fromErrorAndOperation(c,y,o,l):y})}function nc(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function ws(){return(ws=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c);yield _r(!0,a,o);const{providerUserInfo:l}=yield hr(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),p=nc(l||[]);return a.providerData=a.providerData.filter(y=>p.has(y.providerId)),p.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function fa(c,o){return yr.apply(this,arguments)}function yr(){return(yr=(0,I.Z)(function*(c,o,a=!1){const l=yield Qe(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return vt._forOperation(c,"link",l)})).apply(this,arguments)}function _r(c,o,a){return di.apply(this,arguments)}function di(){return(di=(0,I.Z)(function*(c,o,a){yield dr(o);const p=!1===c?"provider-already-linked":"no-such-provider";R(nc(o.providerData).has(a)===c,o.auth,p)})).apply(this,arguments)}function pa(c,o){return ma.apply(this,arguments)}function ma(){return(ma=(0,I.Z)(function*(c,o,a=!1){const{auth:l}=c,p="reauthenticate";try{const y=yield Qe(c,Is(l,p,o,c),a);R(y.idToken,l,"internal-error");const v=us(y.idToken);R(v,l,"internal-error");const{sub:b}=v;return R(c.uid===b,l,"user-mismatch"),vt._forOperation(c,p,y)}catch(y){throw"auth/user-not-found"===(null==y?void 0:y.code)&&Se(l,"user-mismatch"),y}})).apply(this,arguments)}function vr(c,o){return bs.apply(this,arguments)}function bs(){return(bs=(0,I.Z)(function*(c,o,a=!1){const l="signIn",p=yield Is(c,l,o),y=yield vt._fromIdTokenResponse(c,l,p);return a||(yield c._updateCurrentUser(y.user)),y})).apply(this,arguments)}function fi(c,o){return Es.apply(this,arguments)}function Es(){return(Es=(0,I.Z)(function*(c,o){return vr(be(c),o)})).apply(this,arguments)}function pi(c,o){return ga.apply(this,arguments)}function ga(){return(ga=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c);return yield _r(!1,a,o.providerId),fa(a,o)})).apply(this,arguments)}function rc(c,o){return ln.apply(this,arguments)}function ln(){return(ln=(0,I.Z)(function*(c,o){return pa((0,C.m9)(c),o)})).apply(this,arguments)}function fh(c,o){return ya.apply(this,arguments)}function ya(){return(ya=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithCustomToken",ge(c,o))})).apply(this,arguments)}function Ts(){return(Ts=(0,I.Z)(function*(c,o){const a=be(c),l=yield fh(a,{token:o,returnSecureToken:!0}),p=yield vt._fromIdTokenResponse(a,"signIn",l);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class Mn{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?xs._fromServerResponse(o,a):Se(o,"internal-error")}}class xs extends Mn{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new xs(a)}}function hn(c,o,a){var l;R((null===(l=a.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),R(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(R(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(R(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function qe(){return(qe=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p={requestType:"PASSWORD_RESET",email:o};a&&hn(l,p,a),yield Yu(l,p)})).apply(this,arguments)}function Pn(){return(Pn=(0,I.Z)(function*(c,o,a){yield Hu((0,C.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function As(){return(As=(0,I.Z)(function*(c,o){yield fs((0,C.m9)(c),{oobCode:o})})).apply(this,arguments)}function Ss(c,o){return Cs.apply(this,arguments)}function Cs(){return(Cs=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c),l=yield Hu(a,{oobCode:o}),p=l.requestType;switch(R(p,a,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":R(l.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":R(l.mfaInfo,a,"internal-error");default:R(l.email,a,"internal-error")}let y=null;return l.mfaInfo&&(y=Mn._fromServerResponse(be(a),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:y},operation:p}})).apply(this,arguments)}function Ln(){return(Ln=(0,I.Z)(function*(c,o){const{data:a}=yield Ss((0,C.m9)(c),o);return a.email})).apply(this,arguments)}function mi(){return(mi=(0,I.Z)(function*(c,o,a){const l=be(c),p=yield vs(l,{returnSecureToken:!0,email:o,password:a}),y=yield vt._fromIdTokenResponse(l,"signIn",p);return yield l._updateCurrentUser(y.user),y})).apply(this,arguments)}function Fn(){return(Fn=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p={requestType:"EMAIL_SIGNIN",email:o};R(a.handleCodeInApp,l,"argument-error"),a&&hn(l,p,a),yield Ju(l,p)})).apply(this,arguments)}function gi(){return(gi=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p=oa.credentialWithLink(o,a||Sn());return R(p._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),fi(l,p)})).apply(this,arguments)}function Rs(c,o){return yi.apply(this,arguments)}function yi(){return(yi=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:createAuthUri",ge(c,o))})).apply(this,arguments)}function Ns(){return(Ns=(0,I.Z)(function*(c,o){const l={identifier:o,continueUri:Zo()?Sn():"http://localhost"},{signinMethods:p}=yield Rs((0,C.m9)(c),l);return p||[]})).apply(this,arguments)}function Ia(){return(Ia=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c),p={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&hn(a.auth,p,o);const{email:y}=yield Qu(a.auth,p);y!==c.email&&(yield c.reload())})).apply(this,arguments)}function Os(){return(Os=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),y={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&hn(l.auth,y,a);const{email:v}=yield ea(l.auth,y);v!==c.email&&(yield c.reload())})).apply(this,arguments)}function Ms(c,o){return Un.apply(this,arguments)}function Un(){return(Un=(0,I.Z)(function*(c,o){return Pe(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function vi(){return(vi=(0,I.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const l=(0,C.m9)(c),y={idToken:yield l.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},v=yield Qe(l,Ms(l.auth,y));l.displayName=v.displayName||null,l.photoURL=v.photoUrl||null;const b=l.providerData.find(({providerId:N})=>"password"===N);b&&(b.displayName=l.displayName,b.photoURL=l.photoURL),yield l._updateTokensIfNecessary(v)})).apply(this,arguments)}function wa(c,o,a){return Ps.apply(this,arguments)}function Ps(){return(Ps=(0,I.Z)(function*(c,o,a){const{auth:l}=c,y={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(y.email=o),a&&(y.password=a);const v=yield Qe(c,Qo(l,y));yield c._updateTokensIfNecessary(v,!0)})).apply(this,arguments)}class It{constructor(o,a,l={}){this.isNewUser=o,this.providerId=a,this.profile=l}}class Nt extends It{constructor(o,a,l,p){super(o,a,l),this.username=p}}class Ls extends It{constructor(o,a){super(o,"facebook.com",a)}}class Fs extends Nt{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class lc extends It{constructor(o,a){super(o,"google.com",a)}}class he extends Nt{constructor(o,a,l){super(o,"twitter.com",a,l)}}function Us(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function yh(c){var o,a;if(!c)return null;const{providerId:l}=c,p=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},y=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&(null==c?void 0:c.idToken)){const v=null===(a=null===(o=us(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(v)return new It(y,"anonymous"!==v&&"custom"!==v?v:null)}if(!l)return null;switch(l){case"facebook.com":return new Ls(y,p);case"github.com":return new Fs(y,p);case"google.com":return new lc(y,p);case"twitter.com":return new he(y,p,c.screenName||null);case"custom":case"anonymous":return new It(y,null);default:return new It(y,l,p)}}(a)}class rt{constructor(o,a,l){this.type=o,this.credential=a,this.auth=l}static _fromIdtoken(o,a){return new rt("enroll",o,a)}static _fromMfaPendingCredential(o){return new rt("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,l;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return rt._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(l=o.multiFactorSession)||void 0===l?void 0:l.idToken)return rt._fromIdtoken(o.multiFactorSession.idToken)}return null}}class qs{constructor(o,a,l){this.session=o,this.hints=a,this.signInResolver=l}static _fromError(o,a){const l=be(o),p=a.customData._serverResponse,y=(p.mfaInfo||[]).map(b=>Mn._fromServerResponse(l,b));R(p.mfaPendingCredential,l,"internal-error");const v=rt._fromMfaPendingCredential(p.mfaPendingCredential);return new qs(v,y,function(){var b=(0,I.Z)(function*(N){const L=yield N._process(l,v);delete p.mfaInfo,delete p.mfaPendingCredential;const j=Object.assign(Object.assign({},p),{idToken:L.idToken,refreshToken:L.refreshToken});switch(a.operationType){case"signIn":const $=yield vt._fromIdTokenResponse(l,a.operationType,j);return yield l._updateCurrentUser($.user),$;case"reauthenticate":return R(a.user,l,"internal-error"),vt._forOperation(a.user,a.operationType,j);default:Se(l,"internal-error")}});return function(N){return b.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}function dc(c,o){return Pe(c,"POST","/v2/accounts/mfaEnrollment:start",ge(c,o))}class ba{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(l=>Mn._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new ba(o)}getSession(){var o=this;return(0,I.Z)(function*(){return rt._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var l=this;return(0,I.Z)(function*(){const p=o,y=yield l.getSession(),v=yield Qe(l.user,p._process(l.user.auth,y,a));return yield l.user._updateTokensIfNecessary(v),l.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){const l="string"==typeof o?o:o.uid,p=yield a.user.getIdToken(),y=yield Qe(a.user,function Ih(c,o){return Pe(c,"POST","/v2/accounts/mfaEnrollment:withdraw",ge(c,o))}(a.user.auth,{idToken:p,mfaEnrollmentId:l}));a.enrolledFactors=a.enrolledFactors.filter(({uid:v})=>v!==l),yield a.user._updateTokensIfNecessary(y);try{yield a.user.reload()}catch(v){if("auth/user-token-expired"!==(null==v?void 0:v.code))throw v}})()}}const Bs=new WeakMap,wi="__sak";class Ea{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(wi,"1"),this.storage.removeItem(wi),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const wr=(()=>{class c extends Ea{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function Ta(){const c=(0,C.z$)();return te(c)||jt(c)}()&&function oh(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=hs(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),y=this.localCache[l];p!==y&&a(l,y,p)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((b,N,L)=>{this.notifyListeners(b,L)});const p=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const b=this.storage.getItem(p);if(a.newValue!==b)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!l)return}const y=()=>{const b=this.storage.getItem(p);!l&&this.localCache[p]===b||this.notifyListeners(p,b)},v=this.storage.getItem(p);!function sh(){return(0,C.w1)()&&10===document.documentMode}()||v===a.newValue||a.newValue===a.oldValue?y():setTimeout(y,10)}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var p=()=>super._set,y=this;return(0,I.Z)(function*(){yield p().call(y,a,l),y.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,p=this;return(0,I.Z)(function*(){const y=yield l().call(p,a);return p.localCache[a]=JSON.stringify(y),y})()}_remove(a){var l=()=>super._remove,p=this;return(0,I.Z)(function*(){yield l().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),dn=(()=>{class c extends Ea{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let Zs=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(y=>y.isListeningto(a));if(l)return l;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,I.Z)(function*(){const p=a,{eventId:y,eventType:v,data:b}=p.data,N=l.handlersMap[v];if(!(null==N?void 0:N.size))return;p.ports[0].postMessage({status:"ack",eventId:y,eventType:v});const L=Array.from(N).map(function(){var $=(0,I.Z)(function*(fe){return fe(p.origin,b)});return function(fe){return $.apply(this,arguments)}}()),j=yield function Eh(c){return Promise.all(c.map(function(){var o=(0,I.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return o.apply(this,arguments)}}()))}(L);p.ports[0].postMessage({status:"done",eventId:y,eventType:v,response:j})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function Ht(c="",o=10){let a="";for(let l=0;l<o;l++)a+=Math.floor(10*Math.random());return c+a}class Gs{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,l=50){var p=this;return(0,I.Z)(function*(){const y="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let v,b;return new Promise((N,L)=>{const j=Ht("",20);y.port1.start();const $=setTimeout(()=>{L(new Error("unsupported_event"))},l);b={messageChannel:y,onMessage(fe){const kt=fe;if(kt.data.eventId===j)switch(kt.data.status){case"ack":clearTimeout($),v=setTimeout(()=>{L(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),N(kt.data.response);break;default:clearTimeout($),clearTimeout(v),L(new Error("invalid_response"))}}},p.handlers.add(b),y.port1.addEventListener("message",b.onMessage),p.target.postMessage({eventType:o,eventId:j,data:a},[y.port2])}).finally(()=>{b&&p.removeMessageHandler(b)})})()}}function Te(){return window}function Bn(){return void 0!==Te().WorkerGlobalScope&&"function"==typeof Te().importScripts}function ka(){return(ka=(0,I.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const gc="firebaseLocalStorageDb",$s="firebaseLocalStorage",Aa="fbase_key";class br{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Ei(c,o){return c.transaction([$s],o?"readwrite":"readonly").objectStore($s)}function zs(){const c=indexedDB.open(gc,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore($s,{keyPath:Aa})}catch(p){a(p)}}),c.addEventListener("success",(0,I.Z)(function*(){const l=c.result;l.objectStoreNames.contains($s)?o(l):(l.close(),yield function js(){const c=indexedDB.deleteDatabase(gc);return new br(c).toPromise()}(),o(yield zs()))}))})}function Ot(c,o,a){return Ws.apply(this,arguments)}function Ws(){return(Ws=(0,I.Z)(function*(c,o,a){const l=Ei(c,!0).put({[Aa]:o,value:a});return new br(l).toPromise()})).apply(this,arguments)}function Ti(){return(Ti=(0,I.Z)(function*(c,o){const a=Ei(c,!1).get(o),l=yield new br(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Er(c,o){const a=Ei(c,!0).delete(o);return new br(a).toPromise()}const Zn=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield zs()),a.db})()}_withRetries(a){var l=this;return(0,I.Z)(function*(){let p=0;for(;;)try{const y=yield l._openDb();return yield a(y)}catch(y){if(p++>3)throw y;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Bn()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){a.receiver=Zs._getInstance(function mc(){return Bn()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,I.Z)(function*(p,y){return{keyProcessed:(yield a._poll()).includes(y.key)}});return function(p,y){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,I.Z)(function*(p,y){return["keyChanged"]});return function(p,y){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var l,p;if(a.activeServiceWorker=yield function bi(){return ka.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Gs(a.activeServiceWorker);const y=yield a.sender._send("ping",{},800);!y||(null===(l=y[0])||void 0===l?void 0:l.fulfilled)&&(null===(p=y[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,I.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function ye(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield zs();return yield Ot(a,wi,"1"),yield Er(a,wi),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,I.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var p=this;return(0,I.Z)(function*(){return p._withPendingWrite((0,I.Z)(function*(){return yield p._withRetries(y=>Ot(y,a,l)),p.localCache[a]=l,p.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=yield l._withRetries(y=>function yc(c,o){return Ti.apply(this,arguments)}(y,a));return l.localCache[a]=p,p})()}_remove(a){var l=this;return(0,I.Z)(function*(){return l._withPendingWrite((0,I.Z)(function*(){return yield l._withRetries(p=>Er(p,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const l=yield a._withRetries(v=>{const b=Ei(v,!1).getAll();return new br(b).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const p=[],y=new Set;for(const{fbase_key:v,value:b}of l)y.add(v),JSON.stringify(a.localCache[v])!==JSON.stringify(b)&&(a.notifyListeners(v,b),p.push(v));for(const v of Object.keys(a.localCache))a.localCache[v]&&!y.has(v)&&(a.notifyListeners(v,null),p.push(v));return p})()}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Ks(c,o){return Pe(c,"POST","/v2/accounts/mfaSignIn:start",ge(c,o))}function Gn(){return(Gn=(0,I.Z)(function*(c){return(yield Pe(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Da(c){return new Promise((o,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=p=>{const y=ae("internal-error");y.customData=p,a(y)},l.type="text/javascript",l.charset="UTF-8",function Ic(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function Hs(c){return`__${c}${Math.floor(1e6*Math.random())}`}const $n=1e12;class bc{constructor(o){this.auth=o,this.counter=$n,this._widgets=new Map}render(o,a){const l=this.counter;return this._widgets.set(l,new Ec(o,this.auth.name,a||{})),this.counter++,l}reset(o){var a;const l=o||$n;null===(a=this._widgets.get(l))||void 0===a||a.delete(),this._widgets.delete(l)}getResponse(o){var a;return(null===(a=this._widgets.get(o||$n))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var l;return null===(l=a._widgets.get(o||$n))||void 0===l||l.execute(),""})()}}class Ec{constructor(o,a,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;R(p,"argument-error",{appName:a}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function jn(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(l){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(l){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Qs=Hs("rcb"),Tc=new Qr(3e4,6e4);class kc{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=Te().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return R(function Ys(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(Te().grecaptcha):new Promise((l,p)=>{const y=Te().setTimeout(()=>{p(ae(o,"network-request-failed"))},Tc.get());Te()[Qs]=()=>{Te().clearTimeout(y),delete Te()[Qs];const b=Te().grecaptcha;if(!b)return void p(ae(o,"internal-error"));const N=b.render;b.render=(L,j)=>{const $=N(L,j);return this.counter++,$},this.hostLanguage=a,l(b)},Da(`https://www.google.com/recaptcha/api.js??${(0,C.xO)({onload:Qs,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(y),p(ae(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=Te().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class ut{load(o){return(0,I.Z)(function*(){return new bc(o)})()}clearedOneInstance(){}}const Na="recaptcha",Ac={theme:"light",type:"image"};class Tr{constructor(o,a=Object.assign({},Ac),l){this.parameters=a,this.type=Na,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=be(l),this.isInvisible="invisible"===this.parameters.size,R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;R(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new ut:new kc,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(a)||new Promise(y=>{const v=b=>{!b||(o.tokenChangeListeners.delete(v),y(b))};o.tokenChangeListeners.add(v),o.isInvisible&&l.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){R(!this.parameters.sitekey,this.auth,"argument-error"),R(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(l=>l(a)),"function"==typeof o)o(a);else if("string"==typeof o){const l=Te()[o];"function"==typeof l&&l(a)}}}assertNotDestroyed(){R(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const l=document.createElement("div");a.appendChild(l),a=l}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){R(Zo()&&!Bn(),o.auth,"internal-error"),yield function kh(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function vc(c){return Gn.apply(this,arguments)}(o.auth);R(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return R(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Oa{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Kt._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Pa(){return(Pa=(0,I.Z)(function*(c,o,a){const l=be(c),p=yield Xs(l,o,(0,C.m9)(a));return new Oa(p,y=>fi(l,y))})).apply(this,arguments)}function Js(){return(Js=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);yield _r(!1,l,"phone");const p=yield Xs(l.auth,o,(0,C.m9)(a));return new Oa(p,y=>pi(l,y))})).apply(this,arguments)}function xr(){return(xr=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p=yield Xs(l.auth,o,(0,C.m9)(a));return new Oa(p,y=>rc(l,y))})).apply(this,arguments)}function Xs(c,o,a){return eo.apply(this,arguments)}function eo(){return(eo=(0,I.Z)(function*(c,o,a){var l;const p=yield a.verify();try{let y;if(R("string"==typeof p,c,"argument-error"),R(a.type===Na,c,"argument-error"),y="string"==typeof o?{phoneNumber:o}:o,"session"in y){const v=y.session;if("phoneNumber"in y)return R("enroll"===v.type,c,"internal-error"),(yield dc(c,{idToken:v.credential,phoneEnrollmentInfo:{phoneNumber:y.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{R("signin"===v.type,c,"internal-error");const b=(null===(l=y.multiFactorHint)||void 0===l?void 0:l.uid)||y.multiFactorUid;return R(b,c,"missing-multi-factor-info"),(yield Ks(c,{mfaPendingCredential:v.credential,mfaEnrollmentId:b,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:v}=yield lh(c,{phoneNumber:y.phoneNumber,recaptchaToken:p});return v}}finally{a._reset()}})).apply(this,arguments)}function fn(){return(fn=(0,I.Z)(function*(c,o){yield fa((0,C.m9)(c),o)})).apply(this,arguments)}let wt=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=be(a)}verifyPhoneNumber(a,l){return Xs(this.auth,a,(0,C.m9)(l))}static credential(a,l){return Kt._fromVerification(a,l)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:l,temporaryProof:p}=a;return l&&p?Kt._fromTokenResponse(l,p):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function Qt(c,o){return o?Y(o):(R(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class La extends Ee{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return Wt(o,this._buildIdpRequest())}_linkToIdToken(o,a){return Wt(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return Wt(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function D(c){return vr(c.auth,new La(c),c.bypassAuthState)}function xe(c){const{auth:o,user:a}=c;return R(a,o,"internal-error"),pa(a,new La(c),c.bypassAuthState)}function zn(c){return xi.apply(this,arguments)}function xi(){return(xi=(0,I.Z)(function*(c){const{auth:o,user:a}=c;return R(a,o,"internal-error"),fa(a,new La(c),c.bypassAuthState)})).apply(this,arguments)}class U{constructor(o,a,l,p,y=!1){this.auth=o,this.resolver=l,this.user=p,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,I.Z)(function*(l,p){o.pendingPromise={resolve:l,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(y){o.reject(y)}});return function(l,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:l,sessionId:p,postBody:y,tenantId:v,error:b,type:N}=o;if(b)return void a.reject(b);const L={auth:a.auth,requestUri:l,sessionId:p,tenantId:v||void 0,postBody:y||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(N)(L))}catch(j){a.reject(j)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return D;case"linkViaPopup":case"linkViaRedirect":return zn;case"reauthViaPopup":case"reauthViaRedirect":return xe;default:Se(this.auth,"internal-error")}}resolve(o){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Z=new Qr(2e3,1e4);function O(){return(O=(0,I.Z)(function*(c,o,a){const l=be(c);gt(c,o,Rt);const p=Qt(l,a);return new Fa(l,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function A(){return(A=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);gt(l.auth,o,Rt);const p=Qt(l.auth,a);return new Fa(l.auth,"reauthViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}function to(){return(to=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);gt(l.auth,o,Rt);const p=Qt(l.auth,a);return new Fa(l.auth,"linkViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}let Fa=(()=>{class c extends U{constructor(a,l,p,y,v){super(a,l,y,v),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const l=yield a.execute();return R(l,a.auth,"internal-error"),l})()}onExecution(){var a=this;return(0,I.Z)(function*(){tt(1===a.filter.length,"Popup operations only handle one event");const l=Ht();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],l),a.authWindow.associatedEvent=l,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(ae(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(ae(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var l,p;this.pollId=(null===(p=null===(l=this.authWindow)||void 0===l?void 0:l.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(ae(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,Z.get())};a()}}return c.currentPopupAction=null,c})();const ki=new Map;class Rh extends U{constructor(o,a,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let l=ki.get(a.auth._key());if(!l){try{const y=(yield function Nh(c,o){return no.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;l=()=>Promise.resolve(y)}catch(p){l=()=>Promise.reject(p)}ki.set(a.auth._key(),l)}return a.bypassAuthState||ki.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,l=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(l,o);if("unknown"!==o.type){if(o.eventId){const p=yield l.auth._redirectUserForId(o.eventId);if(p)return l.user=p,a().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function no(){return(no=(0,I.Z)(function*(c,o){const a=Wn(o),l=W(c);if(!(yield l._isAvailable()))return!1;const p="true"===(yield l._get(a));return yield l._remove(a),p})).apply(this,arguments)}function Ua(c,o){return Sc.apply(this,arguments)}function Sc(){return(Sc=(0,I.Z)(function*(c,o){return W(c)._set(Wn(o),"true")})).apply(this,arguments)}function ro(c,o){ki.set(c._key(),o)}function W(c){return Y(c._redirectPersistence)}function Wn(c){return Dn("pendingRedirect",c.config.apiKey,c.name)}function G(){return(G=(0,I.Z)(function*(c,o,a){const l=be(c);gt(c,o,Rt);const p=Qt(l,a);return yield Ua(p,l),p._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function Va(){return(Va=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);gt(l.auth,o,Rt);const p=Qt(l.auth,a);yield Ua(p,l.auth);const y=yield Dc(l);return p._openRedirect(l.auth,o,"reauthViaRedirect",y)})).apply(this,arguments)}function kr(){return(kr=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);gt(l.auth,o,Rt);const p=Qt(l.auth,a);yield _r(!1,l,o.providerId),yield Ua(p,l.auth);const y=yield Dc(l);return p._openRedirect(l.auth,o,"linkViaRedirect",y)})).apply(this,arguments)}function Yt(){return(Yt=(0,I.Z)(function*(c,o){return yield be(c)._initializationPromise,io(c,o,!1)})).apply(this,arguments)}function io(c,o){return Ar.apply(this,arguments)}function Ar(){return(Ar=(0,I.Z)(function*(c,o,a=!1){const l=be(c),p=Qt(l,o),v=yield new Rh(l,p,a).execute();return v&&!a&&(delete v.user._redirectEventId,yield l._persistUserIfCurrent(v.user),yield l._setRedirectUser(null,o)),v})).apply(this,arguments)}function Dc(c){return Kn.apply(this,arguments)}function Kn(){return(Kn=(0,I.Z)(function*(c){const o=Ht(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class Ba{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(a=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Nc(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return so(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var l;if(o.error&&!so(o)){const p=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(ae(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const l=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(it(o))}saveEventToCache(o){this.cachedEventUids.add(it(o)),this.lastProcessedEventTime=Date.now()}}function it(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function so({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Za(c){return Mt.apply(this,arguments)}function Mt(){return(Mt=(0,I.Z)(function*(c,o={}){return Pe(c,"GET","/v1/projects",o)})).apply(this,arguments)}const Ga=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,E=/^https?/;function ct(){return(ct=(0,I.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Za(c);for(const a of o)try{if(Mh(a))return}catch(l){}Se(c,"unauthorized-domain")})).apply(this,arguments)}function Mh(c){const o=Sn(),{protocol:a,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const v=new URL(c);return""===v.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&v.hostname===l}if(!E.test(a))return!1;if(Ga.test(c))return l===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(l)}const Si=new Qr(3e4,6e4);function Jt(){const c=Te().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let Pt=null;function Oc(c){return Pt=Pt||function Ph(c){return new Promise((o,a)=>{var l,p,y;function v(){Jt(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{Jt(),a(ae(c,"network-request-failed"))},timeout:Si.get()})}if(null===(p=null===(l=Te().gapi)||void 0===l?void 0:l.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(y=Te().gapi)||void 0===y?void 0:y.load)){const b=Hs("iframefcb");return Te()[b]=()=>{gapi.load?v():a(ae(c,"network-request-failed"))},Da(`https://apis.google.com/js/api.js?onload=${b}`).catch(N=>a(N))}v()}}).catch(o=>{throw Pt=null,o})}(c),Pt}const $a=new Qr(5e3,15e3),lt={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Uh=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function pn(c){const o=c.config;R(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Go(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:o.apiKey,appName:c.name,v:x.SDK_VERSION},p=Uh.get(c.config.apiHost);p&&(l.eid=p);const y=c._getFrameworks();return y.length&&(l.fw=y.join(",")),`${a}?${(0,C.xO)(l).slice(1)}`}function Xt(){return Xt=(0,I.Z)(function*(c){const o=yield Oc(c),a=Te().gapi;return R(a,c,"internal-error"),o.open({where:document.body,url:pn(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:lt,dontclear:!0},l=>new Promise(function(){var p=(0,I.Z)(function*(y,v){yield l.restyle({setHideOnLeave:!1});const b=ae(c,"network-request-failed"),N=Te().setTimeout(()=>{v(b)},$a.get());function L(){Te().clearTimeout(N),y(l)}l.ping(L).then(L,()=>{v(b)})});return function(y,v){return p.apply(this,arguments)}}()))}),Xt.apply(this,arguments)}const Pc={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class De{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function Ri(c,o,a,l,p,y){R(c.config.authDomain,c,"auth-domain-config-required"),R(c.config.apiKey,c,"invalid-api-key");const v={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:x.SDK_VERSION,eventId:p};if(o instanceof Rt){o.setDefaultLanguage(c.languageCode),v.providerId=o.providerId||"",(0,C.xb)(o.getCustomParameters())||(v.customParameters=JSON.stringify(o.getCustomParameters()));for(const[N,L]of Object.entries(y||{}))v[N]=L}if(o instanceof Nn){const N=o.getScopes().filter(L=>""!==L);N.length>0&&(v.scopes=N.join(","))}c.tenantId&&(v.tid=c.tenantId);const b=v;for(const N of Object.keys(b))void 0===b[N]&&delete b[N];return`${function Fc({config:c}){return c.emulator?Go(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,C.xO)(b).slice(1)}`}const Qn="webStorageSupport";class bt extends class Yn{constructor(o){this.factorId=o}_process(o,a,l){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,l);case"signin":return this._finalizeSignIn(o,a.credential);default:return He("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new bt(o)}_finalizeEnroll(o,a,l){return function Ir(c,o){return Pe(c,"POST","/v2/accounts/mfaEnrollment:finalize",ge(c,o))}(o,{idToken:a,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function xh(c,o){return Pe(c,"POST","/v2/accounts/mfaSignIn:finalize",ge(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Oi=(()=>{class c{constructor(){}static assertion(a){return bt._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var en="@firebase/auth";class Sr{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(l=>{o((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){R(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function xt(){return window}function Qa(){return(Qa=(0,I.Z)(function*(c,o,a){var l;const{BuildInfo:p}=xt();tt(o.sessionId,"AuthEvent did not contain a session ID");const y=yield X(o.sessionId),v={};return jt()?v.ibi=p.packageName:V()?v.apn=p.packageName:Se(c,"operation-not-supported-in-this-environment"),p.displayName&&(v.appDisplayName=p.displayName),v.sessionId=y,Ri(c,a,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,v)})).apply(this,arguments)}function ao(){return(ao=(0,I.Z)(function*(c){const{BuildInfo:o}=xt(),a={};jt()?a.iosBundleId=o.packageName:V()?a.androidPackageName=o.packageName:Se(c,"operation-not-supported-in-this-environment"),yield Za(c,a)})).apply(this,arguments)}function uo(){return(uo=(0,I.Z)(function*(c,o,a){const{cordova:l}=xt();let p=()=>{};try{yield new Promise((y,v)=>{let b=null;function N(){var $;y();const fe=null===($=l.plugins.browsertab)||void 0===$?void 0:$.close;"function"==typeof fe&&fe(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function L(){b||(b=window.setTimeout(()=>{v(ae(c,"redirect-cancelled-by-user"))},2e3))}function j(){"visible"===(null==document?void 0:document.visibilityState)&&L()}o.addPassiveListener(N),document.addEventListener("resume",L,!1),V()&&document.addEventListener("visibilitychange",j,!1),p=()=>{o.removePassiveListener(N),document.removeEventListener("resume",L,!1),document.removeEventListener("visibilitychange",j,!1),b&&window.clearTimeout(b)}})}finally{p()}})).apply(this,arguments)}function X(c){return se.apply(this,arguments)}function se(){return(se=(0,I.Z)(function*(c){const o=Cr(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function Cr(c){if(tt(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let l=0;l<c.length;l++)a[l]=c.charCodeAt(l);return a}(0,C.Pz)("authIdTokenMaxAge"),function Jn(c){(0,x._registerComponent)(new lr.wA("auth",(o,{options:a})=>{const l=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:y,authDomain:v}=l.options;return((b,N)=>{R(y&&!y.includes(":"),"invalid-api-key",{appName:b.name}),R(!(null==v?void 0:v.includes(":")),"argument-error",{appName:b.name});const L={apiKey:y,authDomain:v,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ju(c)},j=new je(b,N,L);return function is(c,o){const a=(null==o?void 0:o.persistence)||[],l=(Array.isArray(a)?a:[a]).map(Y);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}(j,a),j})(l,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,l)=>{o.getProvider("auth-internal").initialize()})),(0,x._registerComponent)(new lr.wA("auth-internal",o=>{const a=be(o.getProvider("auth").getImmediate());return new Sr(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,x.registerVersion)(en,"0.21.0",function za(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,x.registerVersion)(en,"0.21.0","esm2017")}("Browser");class Gc extends Ba{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function Ja(c){return co.apply(this,arguments)}function co(){return(co=(0,I.Z)(function*(c){const o=yield Xa()._get(eu(c));return o&&(yield Xa()._remove(eu(c))),o})).apply(this,arguments)}function Zh(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const l=Math.floor(Math.random()*o.length);c.push(o.charAt(l))}return c.join("")}function Xa(){return Y(wr)}function eu(c){return Dn("authEvent",c.config.apiKey,c.name)}function Pi(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,C.zd)(a.join("?"))}function Kc(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ae("no-auth-event")}}function Rr(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function st(c=(0,C.z$)()){return!("file:"!==Rr()&&"ionic:"!==Rr()&&"capacitor:"!==Rr()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function ho(){try{const c=self.localStorage,o=Ht();if(c)return c.setItem(o,"1"),c.removeItem(o),!function zh(c=(0,C.z$)()){return function Hc(){return(0,C.w1)()&&11===(null==document?void 0:document.documentMode)}()||function le(c=(0,C.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,C.hl)()}catch(c){return tn()&&(0,C.hl)()}return!1}function tn(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Xn(){return(function Nr(){return"http:"===Rr()||"https:"===Rr()}()||(0,C.ru)()||st())&&!function Ze(){return(0,C.b$)()||(0,C.UG)()}()&&ho()&&!tn()}function Li(){return st()&&"undefined"!=typeof document}function po(){return(po=(0,I.Z)(function*(){return!!Li()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const ke={LOCAL:"local",NONE:"none",SESSION:"session"},Or=R,er="persistence";function Fi(c){return Mr.apply(this,arguments)}function Mr(){return(Mr=(0,I.Z)(function*(c){yield c._initializationPromise;const o=_n(),a=Dn(er,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function _n(){var c;try{return(null===(c=function Qc(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const Ye=R;class Lt{constructor(){this.browserResolver=Y(class gn{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=dn,this._completeRedirectFn=io,this._overrideRedirectResult=ro}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){var v;tt(null===(v=y.eventManagers[o._key()])||void 0===v?void 0:v.manager,"_initialize() not called before _openPopup()");const b=Ri(o,a,l,Sn(),p);return function qh(c,o,a,l=500,p=600){const y=Math.max((window.screen.availHeight-p)/2,0).toString(),v=Math.max((window.screen.availWidth-l)/2,0).toString();let b="";const N=Object.assign(Object.assign({},Pc),{width:l.toString(),height:p.toString(),top:y,left:v}),L=(0,C.z$)().toLowerCase();a&&(b=$u(L)?"_blank":a),$t(L)&&(o=o||"http://localhost",N.scrollbars="yes");const j=Object.entries(N).reduce((fe,[kt,Bi])=>`${fe}${kt}=${Bi},`,"");if(function ri(c=(0,C.z$)()){var o;return jt(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(L)&&"_self"!==b)return function mn(c,o){const a=document.createElement("a");a.href=c,a.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(o||"",b),new De(null);const $=window.open(o||"",b,j);R($,c,"popup-blocked");try{$.focus()}catch(fe){}return new De($)}(o,b,Ht())})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y._originValidation(o),function pc(c){Te().location.href=c}(Ri(o,a,l,Sn(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:y}=this.eventManagers[a];return p?Promise.resolve(p):(tt(y,"If manager is not set, promise should be"),y)}const l=this.initAndGetManager(o);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const l=yield function Mc(c){return Xt.apply(this,arguments)}(o),p=new Ba(o);return l.register("authEvent",y=>(R(null==y?void 0:y.authEvent,o,"invalid-auth-event"),{status:p.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=l,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Qn,{type:Qn},p=>{var y;const v=null===(y=null==p?void 0:p[0])||void 0===y?void 0:y[Qn];void 0!==v&&a(!!v),Se(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function oo(c){return ct.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return hs()||te()||jt()}}),this.cordovaResolver=Y(class jh{constructor(){this._redirectPersistence=dn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=io,this._overrideRedirectResult=ro}_initialize(o){var a=this;return(0,I.Z)(function*(){const l=o._key();let p=a.eventManagers.get(l);return p||(p=new Gc(o),a.eventManagers.set(l,p),a.attachCallbackListeners(o,p)),p})()}_openPopup(o){Se(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){!function Zc(c){var o,a,l,p,y,v,b,N,L,j;const $=xt();R("function"==typeof(null===(o=null==$?void 0:$.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),R(void 0!==(null===(a=null==$?void 0:$.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),R("function"==typeof(null===(y=null===(p=null===(l=null==$?void 0:$.cordova)||void 0===l?void 0:l.plugins)||void 0===p?void 0:p.browsertab)||void 0===y?void 0:y.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(N=null===(b=null===(v=null==$?void 0:$.cordova)||void 0===v?void 0:v.plugins)||void 0===b?void 0:b.browsertab)||void 0===N?void 0:N.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(j=null===(L=null==$?void 0:$.cordova)||void 0===L?void 0:L.InAppBrowser)||void 0===j?void 0:j.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const v=yield y._initialize(o);yield v.initialized(),v.resetRedirect(),function Oh(){ki.clear()}(),yield y._originValidation(o);const b=function $c(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Zh(),postBody:null,tenantId:c.tenantId,error:ae(c,"no-auth-event")}}(o,l,p);yield function jc(c,o){return Xa()._set(eu(c),o)}(o,b);const N=yield function Bh(c,o,a){return Qa.apply(this,arguments)}(o,b,a),L=yield function yn(c){const{cordova:o}=xt();return new Promise(a=>{o.plugins.browsertab.isAvailable(l=>{let p=null;l?o.plugins.browsertab.openUrl(c):p=o.InAppBrowser.open(c,function ls(c=(0,C.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(p)})})}(N);return function Bc(c,o,a){return uo.apply(this,arguments)}(o,v,L)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function qc(c){return ao.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:l,handleOpenURL:p,BuildInfo:y}=xt(),v=setTimeout((0,I.Z)(function*(){yield Ja(o),a.onEvent(Kc())}),500),b=function(){var j=(0,I.Z)(function*($){clearTimeout(v);const fe=yield Ja(o);let kt=null;fe&&(null==$?void 0:$.url)&&(kt=function zc(c,o){var a,l;const p=function Gh(c){const o=Pi(c),a=o.link?decodeURIComponent(o.link):void 0,l=Pi(a).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return Pi(p).link||p||l||a||c}(o);if(p.includes("/__/auth/callback")){const y=Pi(p),v=y.firebaseError?function Wc(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(y.firebaseError)):null,b=null===(l=null===(a=null==v?void 0:v.code)||void 0===a?void 0:a.split("auth/"))||void 0===l?void 0:l[1],N=b?ae(b):null;return N?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:N,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:p,postBody:null}}return null}(fe,$.url)),a.onEvent(kt||Kc())});return function(fe){return j.apply(this,arguments)}}();void 0!==l&&"function"==typeof l.subscribe&&l.subscribe(null,b);const N=p,L=`${y.packageName.toLowerCase()}://`;xt().handleOpenURL=function(){var j=(0,I.Z)(function*($){if($.toLowerCase().startsWith(L)&&b({url:$}),"function"==typeof N)try{N($)}catch(fe){console.error(fe)}});return function($){return j.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=dn,this._completeRedirectFn=io,this._overrideRedirectResult=ro}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openPopup(o,a,l,p)})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openRedirect(o,a,l,p)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return Li()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Ye(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function fo(){return po.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function Ui(c){return c.unwrap()}function Jc(c){return mo(c)}function mo(c){const{_tokenResponse:o}=c instanceof C.ZR?c.customData:c;if(!o)return null;if(!(c instanceof C.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return wt.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let l;switch(a){case"google.com":l=tc;break;case"facebook.com":l=aa;break;case"github.com":l=_s;break;case"twitter.com":l=li;break;default:const{oauthIdToken:p,oauthAccessToken:y,oauthTokenSecret:v,pendingToken:b,nonce:N}=o;return y||v||p||b?b?a.startsWith("saml.")?cn._create(a,b):nt._fromParams({providerId:a,signInMethod:a,pendingToken:b,idToken:p,accessToken:y}):new un(a).credential({idToken:p,accessToken:y,rawNonce:N}):null}return c instanceof C.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function Je(c,o){return o.catch(a=>{throw a instanceof C.ZR&&function nu(c,o){var a;const l=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new Xc(c,function hc(c,o){var a;const l=(0,C.m9)(c),p=o;return R(o.customData.operationType,l,"argument-error"),R(null===(a=p.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,l,"argument-error"),qs._fromError(l,p)}(c,o));else if(l){const p=mo(o),y=o;p&&(y.credential=p,y.tenantId=l.tenantId||void 0,y.email=l.email||void 0,y.phoneNumber=l.phoneNumber||void 0)}}(c,a),a}).then(a=>{const p=a.user;return{operationType:a.operationType,credential:Jc(a),additionalUserInfo:Us(a),user:Ft.getOrCreate(p)}})}function go(c,o){return ru.apply(this,arguments)}function ru(){return(ru=(0,I.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:l=>Je(c,a.confirm(l))}})).apply(this,arguments)}class Xc{constructor(o,a){this.resolver=a,this.auth=function Vi(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Je(Ui(this.auth),this.resolver.resolveSignIn(o))}}class Ft{constructor(o){this._delegate=o,this.multiFactor=function wh(c){const o=(0,C.m9)(c);return Bs.has(o)||Bs.set(o,ba._fromUser(o)),Bs.get(o)}(o)}static getOrCreate(o){return Ft.USER_MAP.has(o)||Ft.USER_MAP.set(o,new Ft(o)),Ft.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return Je(a.auth,pi(a._delegate,o))})()}linkWithPhoneNumber(o,a){var l=this;return(0,I.Z)(function*(){return go(l.auth,function Ah(c,o,a){return Js.apply(this,arguments)}(l._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return Je(a.auth,function Ne(c,o,a){return to.apply(this,arguments)}(a._delegate,o,Lt))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Fi(be(a.auth)),function _e(c,o,a){return function M(c,o,a){return kr.apply(this,arguments)}(c,o,a)}(a._delegate,o,Lt)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return Je(a.auth,rc(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return go(this.auth,function Sh(c,o,a){return xr.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return Je(this.auth,function T(c,o,a){return A.apply(this,arguments)}(this._delegate,o,Lt))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Fi(be(a.auth)),function Ai(c,o,a){return function ne(c,o,a){return Va.apply(this,arguments)}(c,o,a)}(a._delegate,o,Lt)})()}sendEmailVerification(o){return function cc(c,o){return Ia.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function da(c,o){return ws.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function mh(c,o){return wa((0,C.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function gh(c,o){return wa((0,C.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Ue(c,o){return fn.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function Vn(c,o){return vi.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function _i(c,o,a){return Os.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ft.USER_MAP=new WeakMap;const Pr=R;let qi=(()=>{class c{constructor(a,l){if(this.app=a,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=a.options;Pr(p,"invalid-api-key",{appName:a.name}),Pr(p,"invalid-api-key",{appName:a.name});const y="undefined"!=typeof window?Lt:void 0;this._delegate=l.initialize({options:{persistence:Wh(p,a.name),popupRedirectResolver:y}}),this._delegate._updateErrorMap(Vu),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ft.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,l){!function zt(c,o,a){const l=be(c);R(l._canInitEmulator,l,"emulator-config-failed"),R(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),y=zu(o),{host:v,port:b}=function Wu(c){const o=zu(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(l);if(p){const y=p[1];return{host:y,port:ds(l.substr(y.length+1))}}{const[y,v]=l.split(":");return{host:y,port:ds(v)}}}(o);l.config.emulator={url:`${y}//${v}${null===b?"":`:${b}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:v,port:b,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function Ku(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,l)}applyActionCode(a){return function ks(c,o){return As.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return Ss(this._delegate,a)}confirmPasswordReset(a,l){return function sc(c,o,a){return Pn.apply(this,arguments)}(this._delegate,a,l)}createUserWithEmailAndPassword(a,l){var p=this;return(0,I.Z)(function*(){return Je(p._delegate,function _a(c,o,a){return mi.apply(this,arguments)}(p._delegate,a,l))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function uc(c,o){return Ns.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function ac(c,o){const a=gr.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){Pr(Xn(),a._delegate,"operation-not-supported-in-this-environment");const l=yield function qa(c,o){return Yt.apply(this,arguments)}(a._delegate,Lt);return l?Je(a._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function Ie(c,o){be(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,l,p){const{next:y,error:v,complete:b}=el(a,l,p);return this._delegate.onAuthStateChanged(y,v,b)}onIdTokenChanged(a,l,p){const{next:y,error:v,complete:b}=el(a,l,p);return this._delegate.onIdTokenChanged(y,v,b)}sendSignInLinkToEmail(a,l){return function Ds(c,o,a){return Fn.apply(this,arguments)}(this._delegate,a,l)}sendPasswordResetEmail(a,l){return function ic(c,o,a){return qe.apply(this,arguments)}(this._delegate,a,l||void 0)}setPersistence(a){var l=this;return(0,I.Z)(function*(){let p;switch(function Yc(c,o){Or(Object.values(ke).includes(o),c,"invalid-persistence-type"),(0,C.b$)()?Or(o!==ke.SESSION,c,"unsupported-persistence-type"):(0,C.UG)()?Or(o===ke.NONE,c,"unsupported-persistence-type"):tn()?Or(o===ke.NONE||o===ke.LOCAL&&(0,C.hl)(),c,"unsupported-persistence-type"):Or(o===ke.NONE||ho(),c,"unsupported-persistence-type")}(l._delegate,a),a){case ke.SESSION:p=dn;break;case ke.LOCAL:p=(yield Y(Zn)._isAvailable())?Zn:wr;break;case ke.NONE:p=ti;break;default:return Se("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return Je(this._delegate,function dh(c){return ha.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return Je(this._delegate,fi(this._delegate,a))}signInWithCustomToken(a){return Je(this._delegate,function On(c,o){return Ts.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,l){return Je(this._delegate,function va(c,o,a){return fi((0,C.m9)(c),oa.credential(o,a))}(this._delegate,a,l))}signInWithEmailLink(a,l){return Je(this._delegate,function ph(c,o,a){return gi.apply(this,arguments)}(this._delegate,a,l))}signInWithPhoneNumber(a,l){return go(this._delegate,function Ma(c,o,a){return Pa.apply(this,arguments)}(this._delegate,a,l))}signInWithPopup(a){var l=this;return(0,I.Z)(function*(){return Pr(Xn(),l._delegate,"operation-not-supported-in-this-environment"),Je(l._delegate,function Ch(c,o,a){return O.apply(this,arguments)}(l._delegate,a,Lt))})()}signInWithRedirect(a){var l=this;return(0,I.Z)(function*(){return Pr(Xn(),l._delegate,"operation-not-supported-in-this-environment"),yield Fi(l._delegate),function Cc(c,o,a){return function de(c,o,a){return G.apply(this,arguments)}(c,o,a)}(l._delegate,a,Lt)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function oc(c,o){return Ln.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=ke,c})();function el(c,o,a){let l=c;"function"!=typeof c&&({next:l,error:o,complete:a}=c);const p=l;return{next:v=>p(v&&Ft.getOrCreate(v)),error:o,complete:a}}function Wh(c,o){const a=function tu(c,o){const a=_n();if(!a)return[];const l=Dn(er,c,o);switch(a.getItem(l)){case ke.NONE:return[ti];case ke.LOCAL:return[Zn,dn];case ke.SESSION:return[dn];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(Zn)&&a.push(Zn),"undefined"!=typeof window)for(const l of[wr,dn])a.includes(l)||a.push(l);return a.includes(ti)||a.push(ti),a}class yo{constructor(){this.providerId="phone",this._delegate=new wt(Ui(St.Z.auth()))}static credential(o,a){return wt.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}yo.PHONE_SIGN_IN_METHOD=wt.PHONE_SIGN_IN_METHOD,yo.PROVIDER_ID=wt.PROVIDER_ID;const Lr=R;class tr{constructor(o,a,l=St.Z.app()){var p;Lr(null===(p=l.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new Tr(o,a,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function nr(c){c.INTERNAL.registerComponent(new lr.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new qi(a,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:oa,FacebookAuthProvider:aa,GithubAuthProvider:_s,GoogleAuthProvider:tc,OAuthProvider:un,SAMLAuthProvider:Ce,PhoneAuthProvider:yo,PhoneMultiFactorGenerator:Oi,RecaptchaVerifier:tr,TwitterAuthProvider:li,Auth:qi,AuthCredential:Ee,Error:C.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.3.0")}(St.Z)}}]);