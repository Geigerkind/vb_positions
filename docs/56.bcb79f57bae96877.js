"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[56],{1056:(j_,Bu,F)=>{F.r(Bu),F.d(Bu,{FieldModule:()=>nb});var I=F(9298),Tt=F(1062),D=F(2705);let qt=(()=>{class n{constructor(t){this.context=t}draw(){this.drawShape()}fromDiscreteX(t){return t*(this.context.canvas.width/n.FIELD_RESOLUTION)}fromDiscreteY(t){return t*(this.context.canvas.height/n.FIELD_RESOLUTION)}toDiscreteX(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.width)),n.FIELD_RESOLUTION))}toDiscreteY(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.height)),n.FIELD_RESOLUTION))}}return n.FIELD_RESOLUTION=9e3,n})(),Bt=(()=>{class n extends qt{constructor(t,i,r){super(i),this.actor=t,this.fieldPositions=r||new Map}toDto(){return{f:[...this.fieldPositions.entries()].map(([t,i])=>({x:Number(i.x.toFixed(0)).valueOf(),y:Number(i.y.toFixed(0)).valueOf(),u:t}))}}draw(){super.draw(),this.drawPosition(),this.drawActorName()}currentPosition(){return this.actor.position.rotate(this.rotationOffset)}setPosition(t,i){this.fieldPositions.set(this._rotationUUID,{x:this.toDiscreteX(t),y:this.toDiscreteY(i)})}get x(){return this.fromDiscreteX(this.getFieldPosition().x)}get y(){return this.fromDiscreteY(this.getFieldPosition().y)}getFieldPosition(){return this.fieldPositions.get(this._rotationUUID)}setRotationProperties(t,i){const r=this._rotationUUID;if(this._rotationUUID=t,this.rotationOffset=i,0===this.fieldPositions.size)this.setPosition(this.context.canvas.width/2,this.context.canvas.height/2);else if(!this.fieldPositions.has(t)){const s=this.fieldPositions.get(r);this.setPosition(this.fromDiscreteX(s.x),this.fromDiscreteY(s.y))}}removeRotation(t){this.fieldPositions.delete(t)}}return n.ACTOR_COLOR="#34abcd",n})(),ti=(()=>{class n extends Bt{constructor(t,i,r,s){super(t,i,s),this.dashed=r}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.fillStyle=Bt.ACTOR_COLOR,this.context.fill(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+12)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.5*this.radius))}isHit(t,i){return t>=this.x-this.radius&&t<=this.x+this.radius&&i>=this.y-this.radius&&i<=this.y+this.radius}}return n.RELATIVE_RADIUS=.048,n.RADIUS_MAX=40,n})();var Pe=(()=>{return(n=Pe||(Pe={})).Setter="Setter",n.MiddleBlocker="Middle blocker",n.Libero="Libero",n.OutsideHitter="Outside hitter",n.OppositeHitter="Opposite hitter",n.DefensiveSpecialist="Defensive specialist",Pe;var n})(),G=F(3075);class gt{constructor(e){if(e<1||e>6)throw new Error("Player position must be between 1 and 6.");this._position=e}get value(){return this._position}rotate(e){let i=this._position+(e._position-1);return i>6&&(i-=6),new gt(i)}}function Zu(n=5){let e="";for(;e.length<n;)e+=Math.random().toString(36).substring(2,7);return e.substring(0,n)}let Xl=(()=>{class n extends Bt{constructor(t,i,r){super(t,i,r)}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,Math.PI,!0),this.context.fillStyle=Bt.ACTOR_COLOR,this.context.fill(),this.context.setLineDash([]),this.context.closePath(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y-10)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+this.radius/2))}isHit(t,i){return t>=this.x-this.radius&&t<=this.x+this.radius&&i>=this.y-this.radius&&i<=this.y}}return n.RELATIVE_RADIUS=.0576,n.RADIUS_MAX=50,n})(),Zt=(()=>{class n extends Bt{constructor(t,i,r,s){super(t,i,s),this.dashed=r}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x-2,this.y+25)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle=Bt.ACTOR_COLOR,this.context.fill()}isHit(t,i){return t>=this.x-this.size&&t<=this.x+this.size&&i>=this.y-this.size&&i<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class Gu extends qt{constructor(e,t){super(e),this.positions=null!=t?t:[]}addPosition(e,t){this.positions.push({x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}drawShape(){if(!(this.positions.length<=1)){this.context.beginPath(),this.context.setLineDash([]),this.context.moveTo(this.fromDiscreteX(this.positions[0].x),this.fromDiscreteY(this.positions[0].y));for(let e=1;e<this.positions.length;++e)this.context.lineTo(this.fromDiscreteX(this.positions[e].x),this.fromDiscreteY(this.positions[e].y));this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}}isHit(e,t){const i=this.toDiscreteX(e),r=this.toDiscreteY(t);let u=this.positions[0];for(let d=1;d<this.positions.length;++d){const f=this.positions[d];if(u.x<f.x){const m=u.x-2<=i&&f.x+2>=i;if(u.y<f.y){if(m&&u.y-2<=r&&f.y+2>=r)return!0}else if(m&&u.y+2>=r&&f.y-2<=r)return!0}else{const m=u.x+2>=i&&f.x-2<=i;if(u.y<f.y){if(m&&u.y-2<=r&&f.y+2>=r)return!0}else if(m&&u.y+2>=r&&f.y-2<=r)return!0}u=f}return!1}toDto(){return{f:Object.fromEntries(this.positions.reduce((e,t)=>(e.set(e.size,t),e),new Map))}}}let Po=(()=>{class n extends Bt{constructor(t,i,r){super(t,i,r)}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+this.size/2-2)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash([]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y-this.size),this.context.lineTo(this.x-this.size,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle=Bt.ACTOR_COLOR,this.context.fill()}isHit(t,i){return t>=this.x-this.size&&t<=this.x+this.size&&i>=this.y-this.size&&i<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class zu{static fromActorDto(e,t,i){const r=new Map(t.f.map(s=>[s.u,{x:s.x,y:s.y}]));switch(e.player_role){case Pe.Setter:return new Xl(e,i,r);case Pe.MiddleBlocker:case Pe.Libero:return new Zt(e,i,!1,r);case Pe.DefensiveSpecialist:return new Po(e,i,r);case Pe.OutsideHitter:return new ti(e,i,!1,r);case Pe.OppositeHitter:return new ti(e,i,!0,r)}}static fromLineDto(e,t){const i=Math.max(...Object.keys(e.f).map(s=>Number(s))),r=[];for(let s=0;s<=i;++s)r.push({x:Number(e.f[s.toString()].x),y:Number(e.f[s.toString()].y)});return new Gu(t,r)}}class Zi{constructor(e,t,i,r,s){this.position=e,this.player_role=t,this.player_name=i,this._UUID=r||Zu(),s&&(this._shape=s)}get UUID(){return this._UUID}get shape(){return this._shape}static fromDto(e,t){const i=new Zi(new gt(e.p),e.pr,"NULL"===e.pn?void 0:e.pn,e.u),r=zu.fromActorDto(i,e.s,t);return i.setShape(r),i}toDto(){var e;return{pn:null!==(e=this.player_name)&&void 0!==e?e:"NULL",pr:this.player_role,p:this.position.value,u:this.UUID,s:this.shape.toDto()}}setShape(e){this._shape=e}draw(){this.shape.draw()}toString(){return this.player_name?`${this.player_name} (${this.position.value}) - ${this.player_role.toString()}`:`Unnamed actor (${this.position.value}) - ${this.player_role.toString()}`}}var l=F(5e3),is=F(9776),un=F(7429),Ee=F(508),Ae=F(226),ue=F(7579),$u=F(9770),_t=F(9646),Ke=F(9300),N=F(5698),He=F(8675),tt=F(925),nt=F(9808),Y=F(1777),Sn=F(8255),rs=F(1159),Dn=F(6360);function Lo(n,e){}class ss{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const eh={dialogContainer:(0,Y.X$)("dialogContainer",[(0,Y.SB)("void, exit",(0,Y.oB)({opacity:0,transform:"scale(0.7)"})),(0,Y.SB)("enter",(0,Y.oB)({transform:"none"})),(0,Y.eR)("* => enter",(0,Y.ru)([(0,Y.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,Y.oB)({transform:"none",opacity:1})),(0,Y.IO)("@*",(0,Y.pV)(),{optional:!0})])),(0,Y.eR)("* => void, * => exit",(0,Y.ru)([(0,Y.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,Y.oB)({opacity:0})),(0,Y.IO)("@*",(0,Y.pV)(),{optional:!0})]))])};let Gi=(()=>{class n extends un.en{constructor(t,i,r,s,u,d,f,m){super(),this._elementRef=t,this._focusTrapFactory=i,this._changeDetectorRef=r,this._config=u,this._interactivityChecker=d,this._ngZone=f,this._focusMonitor=m,this._animationStateChanged=new l.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=g=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(g)),this._ariaLabelledBy=u.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,tt.ht)())}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{t.removeEventListener("blur",r),t.removeEventListener("mousedown",r),t.removeAttribute("tabindex")};t.addEventListener("blur",r),t.addEventListener("mousedown",r)})),t.focus(i)}_focusByCssSelector(t,i){let r=this._elementRef.nativeElement.querySelector(t);r&&this._forceFocus(r,i)}_trapFocus(){const t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{i||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const i=(0,tt.ht)(),r=this._elementRef.nativeElement;(!i||i===this._document.body||i===r||r.contains(i))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,i=(0,tt.ht)();return t===i||t.contains(i)}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(l.SBq),l.Y36(Sn.qV),l.Y36(l.sBO),l.Y36(nt.K0,8),l.Y36(ss),l.Y36(Sn.ic),l.Y36(l.R0b),l.Y36(Sn.tE))},n.\u0275dir=l.lG2({type:n,viewQuery:function(t,i){if(1&t&&l.Gf(un.Pl,7),2&t){let r;l.iGM(r=l.CRH())&&(i._portalOutlet=r.first)}},features:[l.qOj]}),n})(),Fo=(()=>{class n extends Gi{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:i}){"enter"===t?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:i})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:i}))}_onAnimationStart({toState:t,totalTime:i}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:i}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:i})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=l.n5z(n)))(i||n)}}(),n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,i){1&t&&l.WFA("@dialogContainer.start",function(s){return i._onAnimationStart(s)})("@dialogContainer.done",function(s){return i._onAnimationDone(s)}),2&t&&(l.Ikx("id",i._id),l.uIk("role",i._config.role)("aria-labelledby",i._config.ariaLabel?null:i._ariaLabelledBy)("aria-label",i._config.ariaLabel)("aria-describedby",i._config.ariaDescribedBy||null),l.d8E("@dialogContainer",i._state))},features:[l.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,i){1&t&&l.YNc(0,Lo,0,0,"ng-template",0)},directives:[un.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[eh.dialogContainer]}}),n})(),ju=0;class cn{constructor(e,t,i="mat-dialog-"+ju++){this._overlayRef=e,this._containerInstance=t,this.id=i,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new ue.x,this._afterClosed=new ue.x,this._beforeClosed=new ue.x,this._state=0,t._id=i,t._animationStateChanged.pipe((0,Ke.h)(r=>"opened"===r.state),(0,N.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,Ke.h)(r=>"closed"===r.state),(0,N.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),e.keydownEvents().pipe((0,Ke.h)(r=>r.keyCode===rs.hY&&!this.disableClose&&!(0,rs.Vb)(r))).subscribe(r=>{r.preventDefault(),Wu(this,"keyboard")}),e.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():Wu(this,"mouse")})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe((0,Ke.h)(t=>"closing"===t.state),(0,N.q)(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(e){let t=this._getPositionStrategy();return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(e="",t=""){return this._overlayRef.updateSize({width:e,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(e){return this._overlayRef.addPanelClass(e),this}removePanelClass(e){return this._overlayRef.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function Wu(n,e,t){return void 0!==n._containerInstance&&(n._containerInstance._closeInteractionType=e),n.close(t)}const pe=new l.OlP("MatDialogData"),Le=new l.OlP("mat-dialog-default-options"),os=new l.OlP("mat-dialog-scroll-strategy"),Gt={provide:os,deps:[is.aV],useFactory:function Uo(n){return()=>n.scrollStrategies.block()}};let Vo=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,y){this._overlay=t,this._injector=i,this._defaultOptions=r,this._parentDialog=s,this._overlayContainer=u,this._dialogRefConstructor=f,this._dialogContainerType=m,this._dialogDataToken=g,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new ue.x,this._afterOpenedAtThisLevel=new ue.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,$u.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,He.O)(void 0))),this._scrollStrategy=d}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,i){i=function nh(n,e){return Object.assign(Object.assign({},e),n)}(i,this._defaultOptions||new ss),i.id&&this.getDialogById(i.id);const r=this._createOverlay(i),s=this._attachDialogContainer(r,i),u=this._attachDialogContent(t,s,r,i);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(u),u.afterClosed().subscribe(()=>this._removeOpenDialog(u)),this.afterOpened.next(u),s._initializeWithAttachedContent(),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(i=>i.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const i=this._getOverlayConfig(t);return this._overlay.create(i)}_getOverlayConfig(t){const i=new is.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(i.backdropClass=t.backdropClass),i}_attachDialogContainer(t,i){const s=l.zs3.create({parent:i&&i.viewContainerRef&&i.viewContainerRef.injector||this._injector,providers:[{provide:ss,useValue:i}]}),u=new un.C5(this._dialogContainerType,i.viewContainerRef,s,i.componentFactoryResolver);return t.attach(u).instance}_attachDialogContent(t,i,r,s){const u=new this._dialogRefConstructor(r,i,s.id);if(t instanceof l.Rgc)i.attachTemplatePortal(new un.UE(t,null,{$implicit:s.data,dialogRef:u}));else{const d=this._createInjector(s,u,i),f=i.attachComponentPortal(new un.C5(t,s.viewContainerRef,d,s.componentFactoryResolver));u.componentInstance=f.instance}return u.updateSize(s.width,s.height).updatePosition(s.position),u}_createInjector(t,i,r){const s=t&&t.viewContainerRef&&t.viewContainerRef.injector,u=[{provide:this._dialogContainerType,useValue:r},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:i}];return t.direction&&(!s||!s.get(Ae.Is,null,l.XFs.Optional))&&u.push({provide:Ae.Is,useValue:{value:t.direction,change:(0,_t.of)()}}),l.zs3.create({parent:s||this._injector,providers:u})}_removeOpenDialog(t){const i=this.openDialogs.indexOf(t);i>-1&&(this.openDialogs.splice(i,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((r,s)=>{r?s.setAttribute("aria-hidden",r):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const i=t.parentElement.children;for(let r=i.length-1;r>-1;r--){let s=i[r];s!==t&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let i=t.length;for(;i--;)t[i].close()}}return n.\u0275fac=function(t){l.$Z()},n.\u0275dir=l.lG2({type:n}),n})(),as=(()=>{class n extends Vo{constructor(t,i,r,s,u,d,f,m){super(t,i,s,d,f,u,cn,Fo,pe,m)}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(is.aV),l.LFG(l.zs3),l.LFG(nt.Ye,8),l.LFG(Le,8),l.LFG(os),l.LFG(n,12),l.LFG(is.Xj),l.LFG(Dn.Qb,8))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac}),n})(),zi=0,ln=(()=>{class n{constructor(t,i,r){this._dialogRef=t,this._elementRef=i,this._dialog=r,this.id="mat-dialog-title-"+zi++}ngOnInit(){this._dialogRef||(this._dialogRef=function ih(n,e){let t=n.nativeElement.parentElement;for(;t&&!t.classList.contains("mat-dialog-container");)t=t.parentElement;return t?e.find(i=>i.id===t.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef._containerInstance;t&&!t._ariaLabelledBy&&(t._ariaLabelledBy=this.id)})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(cn,8),l.Y36(l.SBq),l.Y36(as))},n.\u0275dir=l.lG2({type:n,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-dialog-title"],hostVars:1,hostBindings:function(t,i){2&t&&l.Ikx("id",i.id)},inputs:{id:"id"},exportAs:["matDialogTitle"]}),n})(),ni=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=l.lG2({type:n,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-dialog-content"]}),n})(),qo=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({providers:[as,Gt],imports:[[is.U8,un.eL,Ee.BQ],Ee.BQ]}),n})();var Ve=F(7322),Bo=F(7531),$i=F(4107),zt=F(7423);let Zo=(()=>{class n{constructor(t,i){this.fb=t,this.dialogRef=i,this.PlayerRole=Pe}onSubmit(){this.dialogRef.close(new Zi(new gt(this.formGroup.value.position),this.formGroup.value.player_role,this.formGroup.value.player_name))}ngOnInit(){this.formGroup=this.fb.group({player_name:[null],position:[null,G.kI.required],player_role:[null,G.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-add-actor-dialog"]],decls:53,vars:47,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","player_name"],["appearance","fill"],["formControlName","position"],[3,"value"],["formControlName","player_role"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l._UZ(9,"input",3),l.qZA(),l.TgZ(10,"mat-form-field",4)(11,"mat-label"),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"mat-select",5)(15,"mat-option",6),l._uU(16,"1"),l.qZA(),l.TgZ(17,"mat-option",6),l._uU(18,"2"),l.qZA(),l.TgZ(19,"mat-option",6),l._uU(20,"3"),l.qZA(),l.TgZ(21,"mat-option",6),l._uU(22,"4"),l.qZA(),l.TgZ(23,"mat-option",6),l._uU(24,"5"),l.qZA(),l.TgZ(25,"mat-option",6),l._uU(26,"6"),l.qZA()()(),l.TgZ(27,"mat-form-field",4)(28,"mat-label"),l._uU(29),l.ALo(30,"translate"),l.qZA(),l.TgZ(31,"mat-select",7)(32,"mat-option",6),l._uU(33),l.ALo(34,"translate"),l.qZA(),l.TgZ(35,"mat-option",6),l._uU(36),l.ALo(37,"translate"),l.qZA(),l.TgZ(38,"mat-option",6),l._uU(39),l.ALo(40,"translate"),l.qZA(),l.TgZ(41,"mat-option",6),l._uU(42),l.ALo(43,"translate"),l.qZA(),l.TgZ(44,"mat-option",6),l._uU(45),l.ALo(46,"translate"),l.qZA(),l.TgZ(47,"mat-option",6),l._uU(48),l.ALo(49,"translate"),l.qZA()()(),l.TgZ(50,"button",8),l._uU(51),l.ALo(52,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,25,"add_actor_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,27,"add_actor_dialog.placeholder.player_name")),l.xp6(5),l.Oqu(l.lcZ(13,29,"add_actor_dialog.placeholder.position")),l.xp6(3),l.Q6J("value",1),l.xp6(2),l.Q6J("value",2),l.xp6(2),l.Q6J("value",3),l.xp6(2),l.Q6J("value",4),l.xp6(2),l.Q6J("value",5),l.xp6(2),l.Q6J("value",6),l.xp6(4),l.Oqu(l.lcZ(30,31,"add_actor_dialog.placeholder.player_role")),l.xp6(3),l.Q6J("value",i.PlayerRole.Setter),l.xp6(1),l.Oqu(l.lcZ(34,33,"add_actor_dialog.player_roles.setter")),l.xp6(2),l.Q6J("value",i.PlayerRole.MiddleBlocker),l.xp6(1),l.Oqu(l.lcZ(37,35,"add_actor_dialog.player_roles.middle_blocker")),l.xp6(2),l.Q6J("value",i.PlayerRole.Libero),l.xp6(1),l.Oqu(l.lcZ(40,37,"add_actor_dialog.player_roles.libero")),l.xp6(2),l.Q6J("value",i.PlayerRole.DefensiveSpecialist),l.xp6(1),l.Oqu(l.lcZ(43,39,"add_actor_dialog.player_roles.defensive_specialist")),l.xp6(2),l.Q6J("value",i.PlayerRole.OutsideHitter),l.xp6(1),l.Oqu(l.lcZ(46,41,"add_actor_dialog.player_roles.outside_hitter")),l.xp6(2),l.Q6J("value",i.PlayerRole.OppositeHitter),l.xp6(1),l.Oqu(l.lcZ(49,43,"add_actor_dialog.player_roles.opposite_hitter")),l.xp6(2),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(52,45,"add_actor_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,Bo.Nt,G.Fj,G.JJ,G.u,$i.gD,Ee.ey,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();function us(n,e){if(1&n&&(l.TgZ(0,"mat-option",6),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.Q6J("value",t.UUID),l.xp6(1),l.Oqu(t.toString())}}let rh=(()=>{class n{constructor(t,i,r){this.fb=t,this.dialogRef=i,this.data=r}onSubmit(){this.dialogRef.close(this.formGroup.value.actor)}ngOnInit(){this.formGroup=this.fb.group({actor:[null,G.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn),l.Y36(pe))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-delete-actor-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","actor"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l.TgZ(9,"mat-select",3),l.YNc(10,us,2,2,"mat-option",4),l.qZA()(),l.TgZ(11,"button",5),l._uU(12),l.ALo(13,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,6,"delete_actor_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,8,"delete_actor_dialog.placeholder.actor")),l.xp6(3),l.Q6J("ngForOf",i.data.actors),l.xp6(1),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(13,10,"delete_actor_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,$i.gD,G.JJ,G.u,nt.sg,Ee.ey,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Qe{constructor(e,t,i,r){this.rotation=e,this.name=t,this._UUID=null!=i?i:Zu(),this._lines=null!=r?r:[]}get UUID(){return this._UUID}get lines(){return this._lines}static fromDto(e,t){const i=new gt(e.r),r=e.l.map(s=>zu.fromLineDto(s,t));return new Qe(i,"NULL"===e.n?void 0:e.n,e.u,r)}toDto(){var e;return{n:null!==(e=this.name)&&void 0!==e?e:"NULL",r:this.rotation.value,u:this.UUID,l:this._lines.map(t=>t.toDto())}}toString(){return this.name?`${this.name} (${this.rotation.value})`:`Unknown rotation (${this.rotation.value})`}addLine(e){this._lines.push(e)}removeLine(e){const t=this._lines.findIndex(i=>i===e);t<0||this._lines.splice(t,1)}}function Go(n,e){if(1&n&&(l.TgZ(0,"mat-option",6),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.Q6J("value",t.UUID),l.xp6(1),l.Oqu(t.toString())}}let sh=(()=>{class n{constructor(t,i,r){this.fb=t,this.dialogRef=i,this.data=r}onSubmit(){this.dialogRef.close(this.formGroup.value.rotation)}ngOnInit(){this.formGroup=this.fb.group({rotation:[null,G.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn),l.Y36(pe))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-delete-rotation-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l.TgZ(9,"mat-select",3),l.YNc(10,Go,2,2,"mat-option",4),l.qZA()(),l.TgZ(11,"button",5),l._uU(12),l.ALo(13,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,6,"delete_rotation_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,8,"delete_rotation_dialog.placeholder.rotation")),l.xp6(3),l.Q6J("ngForOf",i.data.rotations),l.xp6(1),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(13,10,"delete_rotation_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,$i.gD,G.JJ,G.u,nt.sg,Ee.ey,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();function oh(n,e){if(1&n&&(l.TgZ(0,"mat-option",6),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.Q6J("value",t.UUID),l.xp6(1),l.Oqu(t.toString())}}let Hu=(()=>{class n{constructor(t,i,r){this.fb=t,this.dialogRef=i,this.data=r}onSubmit(){this.dialogRef.close({rotation:new Qe(new gt(this.formGroup.value.current_rotation),this.formGroup.value.rotation_name),add_before:this.formGroup.value.add_before})}ngOnInit(){this.formGroup=this.fb.group({rotation_name:null,current_rotation:[1,G.kI.required],add_before:null})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn),l.Y36(pe))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-add-rotation-dialog"]],decls:36,vars:24,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","rotation_name"],["appearance","fill"],["formControlName","current_rotation"],[3,"value"],["formControlName","add_before"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l._UZ(9,"input",3),l.qZA(),l.TgZ(10,"mat-form-field",4)(11,"mat-label"),l._uU(12),l.ALo(13,"translate"),l.qZA(),l.TgZ(14,"mat-select",5)(15,"mat-option",6),l._uU(16,"1"),l.qZA(),l.TgZ(17,"mat-option",6),l._uU(18,"2"),l.qZA(),l.TgZ(19,"mat-option",6),l._uU(20,"3"),l.qZA(),l.TgZ(21,"mat-option",6),l._uU(22,"4"),l.qZA(),l.TgZ(23,"mat-option",6),l._uU(24,"5"),l.qZA(),l.TgZ(25,"mat-option",6),l._uU(26,"6"),l.qZA()()(),l.TgZ(27,"mat-form-field",4)(28,"mat-label"),l._uU(29),l.ALo(30,"translate"),l.qZA(),l.TgZ(31,"mat-select",7),l.YNc(32,oh,2,2,"mat-option",8),l.qZA()(),l.TgZ(33,"button",9),l._uU(34),l.ALo(35,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,14,"add_rotation_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,16,"add_rotation_dialog.placeholder.rotation_name")),l.xp6(5),l.Oqu(l.lcZ(13,18,"add_rotation_dialog.placeholder.current_rotation")),l.xp6(3),l.Q6J("value",1),l.xp6(2),l.Q6J("value",2),l.xp6(2),l.Q6J("value",3),l.xp6(2),l.Q6J("value",4),l.xp6(2),l.Q6J("value",5),l.xp6(2),l.Q6J("value",6),l.xp6(4),l.Oqu(l.lcZ(30,20,"add_rotation_dialog.placeholder.add_before")),l.xp6(3),l.Q6J("ngForOf",i.data.rotations),l.xp6(1),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(35,22,"add_rotation_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,Bo.Nt,G.Fj,G.JJ,G.u,$i.gD,Ee.ey,nt.sg,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class xt{static store(e,t){const i=JSON.stringify(t);window.localStorage.setItem(e,i)}static retrieve(e){const t=window.localStorage.getItem(e);if(t)return JSON.parse(t)}static remove(e){window.localStorage.removeItem(e)}}var $t=F(8996),ah=F(4986),ji=F(8306),ze=F(2122),uh=F(4482),ch=F(5403);function Wi(){return(0,uh.e)((n,e)=>{let t,i=!1;n.subscribe((0,ch.x)(e,r=>{const s=t;t=r,i&&e.next([s,r]),i=!0}))})}var q,De=F(4004),kt=F(5026),hn=F(1884),jt=F(2011),Rn=(F(9169),F(3942)),x=F(5861),dn=F(9681),Hi=F(4859),At=F(1877),re=F(2090),Qu="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ut={},cs=cs||{},j=Qu||self;function ls(){}function hs(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function Qi(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var zo="closure_uid_"+(1e9*Math.random()>>>0),Ju=0;function lh(n,e,t){return n.call.apply(n.bind,arguments)}function hh(n,e,t){if(!n)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var r=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(r,i),n.apply(e,r)}}return function(){return n.apply(e,arguments)}}function se(n,e,t){return(se=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?lh:hh).apply(null,arguments)}function Yi(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var i=t.slice();return i.push.apply(i,arguments),n.apply(this,i)}}function Fe(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(i,r,s){for(var u=Array(arguments.length-2),d=2;d<arguments.length;d++)u[d-2]=arguments[d];return e.prototype[r].apply(i,u)}}function Wt(){this.s=this.s,this.o=this.o}Wt.prototype.s=!1,Wt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function Yu(n){Object.prototype.hasOwnProperty.call(n,zo)&&n[zo]||(n[zo]=++Ju)}(this)},Wt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const $o=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function jo(n){const e=n.length;if(0<e){const t=Array(e);for(let i=0;i<e;i++)t[i]=n[i];return t}return[]}function Nn(n,e){for(let t=1;t<arguments.length;t++){const i=arguments[t];if(hs(i)){const r=n.length||0,s=i.length||0;n.length=r+s;for(let u=0;u<s;u++)n[r+u]=i[u]}else n.push(i)}}function qe(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}qe.prototype.h=function(){this.defaultPrevented=!0};var Wo=function(){if(!j.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{j.addEventListener("test",ls,e),j.removeEventListener("test",ls,e)}catch(t){}return n}();function Ji(n){return/^[\s\xa0]*$/.test(n)}var ds=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function Ko(n,e){return n<e?-1:n>e?1:0}function ii(){var n=j.navigator;return n&&(n=n.userAgent)?n:""}function Ct(n){return-1!=ii().indexOf(n)}function Xi(n){return Xi[" "](n),n}Xi[" "]=ls;var _s,n,Ho=Ct("Opera"),ri=Ct("Trident")||Ct("MSIE"),ps=Ct("Edge"),Qo=ps||ri,ms=Ct("Gecko")&&!(-1!=ii().toLowerCase().indexOf("webkit")&&!Ct("Edge"))&&!(Ct("Trident")||Ct("MSIE"))&&!Ct("Edge"),fh=-1!=ii().toLowerCase().indexOf("webkit")&&!Ct("Edge");function gs(){var n=j.document;return n?n.documentMode:void 0}e:{var er="",Yo=(n=ii(),ms?/rv:([^\);]+)(\)|;)/.exec(n):ps?/Edge\/([\d\.]+)/.exec(n):ri?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):fh?/WebKit\/(\S+)/.exec(n):Ho?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(Yo&&(er=Yo?Yo[1]:""),ri){var tr=gs();if(null!=tr&&tr>parseFloat(er)){_s=String(tr);break e}}_s=er}var ph={};var Xo=j.document&&ri&&(gs()||parseInt(_s,10))||void 0;function nr(n,e){if(qe.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,i=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ms){e:{try{Xi(e.nodeName);var r=!0;break e}catch(s){}r=!1}r||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:Dt[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&nr.X.h.call(this)}}Fe(nr,qe);var Dt={2:"touch",3:"pen",4:"mouse"};nr.prototype.h=function(){nr.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var ir="closure_listenable_"+(1e6*Math.random()|0),ea=0;function mh(n,e,t,i,r){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!i,this.ha=r,this.key=++ea,this.ba=this.ea=!1}function si(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function ta(n,e,t){for(const i in n)e.call(t,n[i],i,n)}function ys(n){const e={};for(const t in n)e[t]=n[t];return e}const Xu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ec(n,e){let t,i;for(let r=1;r<arguments.length;r++){for(t in i=arguments[r],i)n[t]=i[t];for(let s=0;s<Xu.length;s++)t=Xu[s],Object.prototype.hasOwnProperty.call(i,t)&&(n[t]=i[t])}}function oi(n){this.src=n,this.g={},this.h=0}function Kt(n,e){var t=e.type;if(t in n.g){var s,i=n.g[t],r=$o(i,e);(s=0<=r)&&Array.prototype.splice.call(i,r,1),s&&(si(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function na(n,e,t,i){for(var r=0;r<n.length;++r){var s=n[r];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==i)return r}return-1}oi.prototype.add=function(n,e,t,i,r){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=na(n,e,i,r);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new mh(e,this.src,s,!!i,r)).ea=t,n.push(e)),e};var ia="closure_lm_"+(1e6*Math.random()|0),Mn={};function gh(n,e,t,i,r){if(i&&i.once)return Pn(n,e,t,i,r);if(Array.isArray(e)){for(var s=0;s<e.length;s++)gh(n,e[s],t,i,r);return null}return t=oa(t),n&&n[ir]?n.N(e,t,Qi(i)?!!i.capture:!!i,r):vs(n,e,t,!1,i,r)}function vs(n,e,t,i,r,s){if(!e)throw Error("Invalid event type");var u=Qi(r)?!!r.capture:!!r,d=sa(n);if(d||(n[ia]=d=new oi(n)),(t=d.add(e,t,i,u,s)).proxy)return t;if(i=function Ht(){const e=tc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=i,i.src=n,i.listener=t,n.addEventListener)Wo||(r=u),void 0===r&&(r=!1),n.addEventListener(e.toString(),i,r);else if(n.attachEvent)n.attachEvent(ra(e.toString()),i);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(i)}return t}function Pn(n,e,t,i,r){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Pn(n,e[s],t,i,r);return null}return t=oa(t),n&&n[ir]?n.O(e,t,Qi(i)?!!i.capture:!!i,r):vs(n,e,t,!0,i,r)}function Ln(n,e,t,i,r){if(Array.isArray(e))for(var s=0;s<e.length;s++)Ln(n,e[s],t,i,r);else i=Qi(i)?!!i.capture:!!i,t=oa(t),n&&n[ir]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=na(s=n.g[e],t,i,r))&&(si(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=sa(n))&&(e=n.g[e.toString()],n=-1,e&&(n=na(e,t,i,r)),(t=-1<n?e[n]:null)&&Is(t))}function Is(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[ir])Kt(e.i,n);else{var t=n.type,i=n.proxy;e.removeEventListener?e.removeEventListener(t,i,n.capture):e.detachEvent?e.detachEvent(ra(t),i):e.addListener&&e.removeListener&&e.removeListener(i),(t=sa(e))?(Kt(t,n),0==t.h&&(t.src=null,e[ia]=null)):si(n)}}}function ra(n){return n in Mn?Mn[n]:Mn[n]="on"+n}function tc(n,e){if(n.ba)n=!0;else{e=new nr(e,this);var t=n.listener,i=n.ha||n.src;n.ea&&Is(n),n=t.call(i,e)}return n}function sa(n){return(n=n[ia])instanceof oi?n:null}var fn="__closure_events_fn_"+(1e9*Math.random()>>>0);function oa(n){return"function"==typeof n?n:(n[fn]||(n[fn]=function(e){return n.handleEvent(e)}),n[fn])}function Te(){Wt.call(this),this.i=new oi(this),this.P=this,this.I=null}function Ue(n,e){var t,i=n.I;if(i)for(t=[];i;i=i.I)t.push(i);if(n=n.P,i=e.type||e,"string"==typeof e)e=new qe(e,n);else if(e instanceof qe)e.target=e.target||n;else{var r=e;ec(e=new qe(i,n),r)}if(r=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];r=rr(u,i,!0,e)&&r}if(r=rr(u=e.g=n,i,!0,e)&&r,r=rr(u,i,!1,e)&&r,t)for(s=0;s<t.length;s++)r=rr(u=e.g=t[s],i,!1,e)&&r}function rr(n,e,t,i){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var r=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var d=u.listener,f=u.ha||u.src;u.ea&&Kt(n.i,u),r=!1!==d.call(f,i)&&r}}return r&&!i.defaultPrevented}Fe(Te,Wt),Te.prototype[ir]=!0,Te.prototype.removeEventListener=function(n,e,t,i){Ln(this,n,e,t,i)},Te.prototype.M=function(){if(Te.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],i=0;i<t.length;i++)si(t[i]);delete n.g[e],n.h--}}this.I=null},Te.prototype.N=function(n,e,t,i){return this.i.add(String(n),e,!1,t,i)},Te.prototype.O=function(n,e,t,i){return this.i.add(String(n),e,!0,t,i)};var sr=j.JSON.stringify;function yt(){var n=Es;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var bs,ic=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new aa,n=>n.reset());class aa{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function ws(n){j.setTimeout(()=>{throw n},0)}function ua(n,e){bs||function _h(){var n=j.Promise.resolve(void 0);bs=function(){n.then(ca)}}(),or||(bs(),or=!0),Es.add(n,e)}var or=!1,Es=new class nc{constructor(){this.h=this.g=null}add(e,t){const i=ic.get();i.set(e,t),this.h?this.h.next=i:this.g=i,this.h=i}};function ca(){for(var n;n=yt();){try{n.h.call(n.g)}catch(t){ws(t)}var e=ic;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}or=!1}function Fn(n,e){Te.call(this),this.h=n||1,this.g=e||j,this.j=se(this.lb,this),this.l=Date.now()}function ar(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function Ts(n,e,t){if("function"==typeof n)t&&(n=se(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=se(n.handleEvent,n)}return 2147483647<Number(e)?-1:j.setTimeout(n,e||0)}function xs(n){n.g=Ts(()=>{n.g=null,n.i&&(n.i=!1,xs(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}Fe(Fn,Te),(q=Fn.prototype).ca=!1,q.R=null,q.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Ue(this,"tick"),this.ca&&(ar(this),this.start()))}},q.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},q.M=function(){Fn.X.M.call(this),ar(this),delete this.g};class rc extends Wt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:xs(this)}M(){super.M(),this.g&&(j.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Un(n){Wt.call(this),this.h=n,this.g={}}Fe(Un,Wt);var ur=[];function ks(n,e,t,i){Array.isArray(t)||(t&&(ur[0]=t.toString()),t=ur);for(var r=0;r<t.length;r++){var s=gh(e,t[r],i||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function la(n){ta(n.g,function(e,t){this.g.hasOwnProperty(t)&&Is(e)},n),n.g={}}function ai(){this.g=!0}function ui(n,e,t,i){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function yh(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var i=t[n];if(!(2>i.length)){var r=i[1];if(Array.isArray(r)&&!(1>r.length)){var s=r[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<r.length;u++)r[u]=""}}}return sr(t)}catch(d){return e}}(n,t)+(i?" "+i:"")})}Un.prototype.M=function(){Un.X.M.call(this),la(this)},Un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},ai.prototype.Aa=function(){this.g=!1},ai.prototype.info=function(){};var Qt={},cr=null;function ci(){return cr=cr||new Te}function lr(n){qe.call(this,Qt.Pa,n)}function hr(n){const e=ci();Ue(e,new lr(e))}function As(n,e){qe.call(this,Qt.STAT_EVENT,n),this.stat=e}function Ye(n){const e=ci();Ue(e,new As(e,n))}function Cs(n,e){qe.call(this,Qt.Qa,n),this.size=e}function dr(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return j.setTimeout(function(){n()},e)}Qt.Pa="serverreachability",Fe(lr,qe),Qt.STAT_EVENT="statevent",Fe(As,qe),Qt.Qa="timingevent",Fe(Cs,qe);var li={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},fa={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function fr(){}function Ss(){}fr.prototype.h=null;var ma,pr={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function mr(){qe.call(this,"d")}function pa(){qe.call(this,"c")}function hi(){}function gr(n,e,t,i){this.l=n,this.j=e,this.m=t,this.U=i||1,this.S=new Un(this),this.O=ga,this.T=new Fn(n=Qo?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new ac}function ac(){this.i=null,this.g="",this.h=!1}Fe(mr,qe),Fe(pa,qe),Fe(hi,fr),hi.prototype.g=function(){return new XMLHttpRequest},hi.prototype.i=function(){return{}},ma=new hi;var ga=45e3,_a={},di={};function ya(n,e,t){n.K=1,n.v=Ia(Jt(e)),n.s=t,n.P=!0,Ds(n,null)}function Ds(n,e){n.F=Date.now(),Vn(n),n.A=Jt(n.v);var t=n.A,i=n.U;Array.isArray(i)||(i=[String(i)]),mc(t.i,"t",i),n.C=0,t=n.l.H,n.h=new ac,n.g=Sc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new rc(se(n.La,n,n.g),n.N)),ks(n.S,n.g,"readystatechange",n.ib),e=n.H?ys(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),hr(),function sc(n,e,t,i,r,s){n.info(function(){if(n.g)if(s)for(var u="",d=s.split("&"),f=0;f<d.length;f++){var m=d[f].split("=");if(1<m.length){var g=m[0];m=m[1];var y=g.split("_");u=2<=y.length&&"type"==y[1]?u+(g+"=")+m+"&":u+(g+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+i+") [attempt "+r+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function uc(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Rs(n,e,t){let r,i=!0;for(;!n.I&&n.C<t.length;){if(r=vh(n,t),r==di){4==e&&(n.o=4,Ye(14),i=!1),ui(n.j,n.m,null,"[Incomplete Response]");break}if(r==_a){n.o=4,Ye(15),ui(n.j,n.m,t,"[Invalid Chunk]"),i=!1;break}ui(n.j,n.m,r,null),va(n,r)}uc(n)&&r!=di&&r!=_a&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Ye(16),i=!1),n.i=n.i&&i,i?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Oa(e),e.K=!0,Ye(11))):(ui(n.j,n.m,t,"[Invalid Chunked Response]"),Yt(n),_r(n))}function vh(n,e){var t=n.C,i=e.indexOf("\n",t);return-1==i?di:(t=Number(e.substring(t,i)),isNaN(t)?_a:(i+=1)+t>e.length?di:(e=e.substr(i,t),n.C=i+t,e))}function Vn(n){n.V=Date.now()+n.O,cc(n,n.O)}function cc(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=dr(se(n.gb,n),e)}function fi(n){n.B&&(j.clearTimeout(n.B),n.B=null)}function _r(n){0==n.l.G||n.I||xc(n.l,n)}function Yt(n){fi(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,ar(n.T),la(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function va(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||xa(t.h,n)))if(!n.J&&xa(t.h,n)&&3==t.G){try{var i=t.Fa.g.parse(e)}catch(m){i=null}if(Array.isArray(i)&&3==i.length){var r=i;if(0==r[0])e:if(t.u)t.Ba=r[1],0<t.Ba-t.T&&37500>r[2]&&t.L&&0==t.A&&!t.v&&(t.v=dr(se(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Zs(t),Xt(t)}Na(t),Ye(18)}if(1>=_c(t.h)&&t.ja){try{t.ja()}catch(m){}t.ja=void 0}}else en(t,11)}else if((n.J||t.g==n)&&Zs(t),!Ji(e))for(r=t.Fa.g.parse(e),e=0;e<r.length;e++){let m=r[e];if(t.T=m[0],m=m[1],2==t.G)if("c"==m[0]){t.I=m[1],t.ka=m[2];const g=m[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const y=m[4];null!=y&&(t.Ca=y,t.j.info("SVER="+t.Ca));const w=m[5];null!=w&&"number"==typeof w&&0<w&&(t.J=i=1.5*w,t.j.info("backChannelRequestTimeoutMs_="+i)),i=t;const k=n.g;if(k){const S=k.g?k.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=i.h;s.g||-1==S.indexOf("spdy")&&-1==S.indexOf("quic")&&-1==S.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(ka(s,s.h),s.h=null))}if(i.D){const M=k.g?k.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(i.za=M,fe(i.F,i.D,M))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((i=t).sa=Cc(i,i.H?i.ka:null,i.V),u.J){bh(i.h,u);var d=u,f=i.J;f&&d.setTimeout(f),d.B&&(fi(d),Vn(d)),i.g=u}else Ra(i);0<t.i.length&&qs(t)}else"stop"!=m[0]&&"close"!=m[0]||en(t,7);else 3==t.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?en(t,7):Ec(t):"noop"!=m[0]&&t.l&&t.l.wa(m),t.A=0)}hr()}catch(m){}}function Ns(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(hs(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function lc(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(hs(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const i in n)e[t++]=i;return e}}}(n),i=function Ih(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(hs(n)){for(var e=[],t=n.length,i=0;i<t;i++)e.push(n[i]);return e}for(i in e=[],t=0,n)e[t++]=n[i];return e}(n),r=i.length,s=0;s<r;s++)e.call(void 0,i[s],t&&t[s],n)}(q=gr.prototype).setTimeout=function(n){this.O=n},q.ib=function(n){n=n.target;const e=this.L;e&&3==bt(n)?e.l():this.La(n)},q.La=function(n){try{if(n==this.g)e:{const g=bt(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>g)&&(3!=g||Qo||this.g&&(this.h.h||this.g.fa()||wc(this.g)))){this.I||4!=g||7==e||hr(),fi(this);var t=this.g.aa();this.Y=t;t:if(uc(this)){var i=wc(this.g);n="";var r=i.length,s=4==bt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Yt(this),_r(this);var u="";break t}this.h.i=new j.TextDecoder}for(e=0;e<r;e++)this.h.h=!0,n+=this.h.i.decode(i[e],{stream:s&&e==r-1});i.splice(0,r),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function ha(n,e,t,i,r,s,u){n.info(function(){return"XMLHTTP RESP ("+i+") [ attempt "+r+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var d,f=this.g;if((d=f.g?f.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Ji(d)){var m=d;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,Ye(12),Yt(this),_r(this);break e}ui(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,va(this,t)}this.P?(Rs(this,g,u),Qo&&this.i&&3==g&&(ks(this.S,this.T,"tick",this.hb),this.T.start())):(ui(this.j,this.m,u,null),va(this,u)),4==g&&Yt(this),this.i&&!this.I&&(4==g?xc(this.l,this):(this.i=!1,Vn(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Ye(12)):(this.o=0,Ye(13)),Yt(this),_r(this)}}}catch(g){}},q.hb=function(){if(this.g){var n=bt(this.g),e=this.g.fa();this.C<e.length&&(fi(this),Rs(this,n,e),this.i&&4!=n&&Vn(this))}},q.cancel=function(){this.I=!0,Yt(this)},q.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function da(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(hr(),Ye(17)),Yt(this),this.o=2,_r(this)):cc(this,this.V-n)};var hc=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function pn(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof pn){this.h=void 0!==e?e:n.h,Os(this,n.j),this.s=n.s,this.g=n.g,Ms(this,n.m),this.l=n.l,e=n.i;var t=new wt;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),dc(this,t),this.o=n.o}else n&&(t=String(n).match(hc))?(this.h=!!e,Os(this,t[1]||"",!0),this.s=yr(t[2]||""),this.g=yr(t[3]||"",!0),Ms(this,t[4]),this.l=yr(t[5]||"",!0),dc(this,t[6]||"",!0),this.o=yr(t[7]||"")):(this.h=!!e,this.i=new wt(null,this.h))}function Jt(n){return new pn(n)}function Os(n,e,t){n.j=t?yr(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ms(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function dc(n,e,t){e instanceof wt?(n.i=e,function ba(n,e){e&&!n.j&&(Rt(n),n.i=null,n.g.forEach(function(t,i){var r=i.toLowerCase();i!=r&&(fc(this,i),mc(this,r,t))},n)),n.j=e}(n.i,n.h)):(t||(e=vr(e,wp)),n.i=new wt(e,n.h))}function fe(n,e,t){n.i.set(e,t)}function Ia(n){return fe(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function yr(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function vr(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,yp),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function yp(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}pn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(vr(e,wh,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(vr(e,wh,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(vr(t,"/"==t.charAt(0)?Ip:vp,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",vr(t,wa)),n.join("")};var wh=/[#\/\?@]/g,vp=/[#\?:]/g,Ip=/[#\?]/g,wp=/[#\?@]/g,wa=/#/g;function wt(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Rt(n){n.g||(n.g=new Map,n.h=0,n.i&&function pi(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var i=n[t].indexOf("="),r=null;if(0<=i){var s=n[t].substring(0,i);r=n[t].substring(i+1)}else s=n[t];e(s,r?decodeURIComponent(r.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function fc(n,e){Rt(n),e=mi(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function pc(n,e){return Rt(n),e=mi(n,e),n.g.has(e)}function mc(n,e,t){fc(n,e),0<t.length&&(n.i=null,n.g.set(mi(n,e),jo(t)),n.h+=t.length)}function mi(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function gc(n){this.l=n||Ps,n=j.PerformanceNavigationTiming?0<(n=j.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(j.g&&j.g.Ga&&j.g.Ga()&&j.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(q=wt.prototype).add=function(n,e){Rt(this),this.i=null,n=mi(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},q.forEach=function(n,e){Rt(this),this.g.forEach(function(t,i){t.forEach(function(r){n.call(e,r,i,this)},this)},this)},q.oa=function(){Rt(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let i=0;i<e.length;i++){const r=n[i];for(let s=0;s<r.length;s++)t.push(e[i])}return t},q.W=function(n){Rt(this);let e=[];if("string"==typeof n)pc(this,n)&&(e=e.concat(this.g.get(mi(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},q.set=function(n,e){return Rt(this),this.i=null,pc(this,n=mi(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},q.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},q.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var i=e[t];const s=encodeURIComponent(String(i)),u=this.W(i);for(i=0;i<u.length;i++){var r=s;""!==u[i]&&(r+="="+encodeURIComponent(String(u[i]))),n.push(r)}}return this.i=n.join("&")};var Ps=10;function Ta(n){return!!n.h||!!n.g&&n.g.size>=n.j}function _c(n){return n.h?1:n.g?n.g.size:0}function xa(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function ka(n,e){n.g?n.g.add(e):n.h=e}function bh(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function Ir(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return jo(n.i)}function yc(){}function mn(){this.g=new yc}function Eh(n,e,t){const i=t||"";try{Ns(n,function(r,s){let u=r;Qi(r)&&(u=sr(r)),e.push(i+s+"="+encodeURIComponent(u))})}catch(r){throw e.push(i+"type="+encodeURIComponent("_badmap")),r}}function gn(n,e,t,i,r){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,r(i)}catch(s){}}function wr(n){this.l=n.ac||null,this.j=n.jb||!1}function _e(n,e){Te.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Aa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}gc.prototype.cancel=function(){if(this.i=Ir(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},yc.prototype.stringify=function(n){return j.JSON.stringify(n,void 0)},yc.prototype.parse=function(n){return j.JSON.parse(n,void 0)},Fe(wr,fr),wr.prototype.g=function(){return new _e(this.l,this.j)},wr.prototype.i=function(n){return function(){return n}}({}),Fe(_e,Te);var Aa=0;function Ls(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function br(n){n.readyState=4,n.l=null,n.j=null,n.A=null,qn(n)}function qn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(q=_e.prototype).open=function(n,e){if(this.readyState!=Aa)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,qn(this)},q.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||j).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},q.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,br(this)),this.readyState=Aa},q.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,qn(this)),this.g&&(this.readyState=3,qn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==j.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Ls(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},q.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?br(this):qn(this),3==this.readyState&&Ls(this)}},q.Va=function(n){this.g&&(this.response=this.responseText=n,br(this))},q.Ua=function(n){this.g&&(this.response=n,br(this))},q.ga=function(){this.g&&br(this)},q.setRequestHeader=function(n,e){this.v.append(n,e)},q.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},q.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(_e.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var xh=j.JSON.parse;function ye(n){Te.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ca,this.K=this.L=!1}Fe(ye,Te);var Ca="",kh=/^https?$/i,Fs=["POST","PUT"];function gi(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Er(n),_i(n)}function Er(n){n.D||(n.D=!0,Ue(n,"complete"),Ue(n,"error"))}function Ic(n){if(n.h&&void 0!==cs&&(!n.C[1]||4!=bt(n)||2!=n.aa()))if(n.v&&4==bt(n))Ts(n.Ha,0,n);else if(Ue(n,"readystatechange"),4==bt(n)){n.h=!1;try{const d=n.aa();e:switch(d){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var i;if(i=0===d){var r=String(n.H).match(hc)[1]||null;if(!r&&j.self&&j.self.location){var s=j.self.location.protocol;r=s.substr(0,s.length-1)}i=!kh.test(r?r.toLowerCase():"")}t=i}if(t)Ue(n,"complete"),Ue(n,"success");else{n.m=6;try{var u=2<bt(n)?n.g.statusText:""}catch(f){u=""}n.j=u+" ["+n.aa()+"]",Er(n)}}finally{_i(n)}}}function _i(n,e){if(n.g){Sa(n);const t=n.g,i=n.C[0]?ls:null;n.g=null,n.C=null,e||Ue(n,"ready");try{t.onreadystatechange=i}catch(r){}}}function Sa(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(j.clearTimeout(n.A),n.A=null)}function bt(n){return n.g?n.g.readyState:0}function wc(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ca:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function Us(n){let e="";return ta(n,function(t,i){e+=i,e+=":",e+=t,e+="\r\n"}),e}function Vs(n,e,t){e:{for(i in t){var i=!1;break e}i=!0}i||(t=Us(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):fe(n,e,t))}function Tr(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function bc(n){this.Ca=0,this.i=[],this.j=new ai,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Tr("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Tr("baseRetryDelayMs",5e3,n),this.bb=Tr("retryDelaySeedMs",1e4,n),this.$a=Tr("forwardChannelMaxRetries",2,n),this.ta=Tr("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new gc(n&&n.concurrentRequestLimit),this.Fa=new mn,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Ec(n){if(Tc(n),3==n.G){var e=n.U++,t=Jt(n.F);fe(t,"SID",n.I),fe(t,"RID",e),fe(t,"TYPE","terminate"),xr(n,t),(e=new gr(n,n.j,e,void 0)).K=2,e.v=Ia(Jt(t)),t=!1,j.navigator&&j.navigator.sendBeacon&&(t=j.navigator.sendBeacon(e.v.toString(),"")),!t&&j.Image&&((new Image).src=e.v,t=!0),t||(e.g=Sc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Vn(e)}Ac(n)}function Xt(n){n.g&&(Oa(n),n.g.cancel(),n.g=null)}function Tc(n){Xt(n),n.u&&(j.clearTimeout(n.u),n.u=null),Zs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&j.clearTimeout(n.m),n.m=null)}function qs(n){Ta(n.h)||n.m||(n.m=!0,ua(n.Ja,n),n.C=0)}function Bs(n,e){var t;t=e?e.m:n.U++;const i=Jt(n.F);fe(i,"SID",n.I),fe(i,"RID",t),fe(i,"AID",n.T),xr(n,i),n.o&&n.s&&Vs(i,n.o,n.s),t=new gr(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=Da(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),ka(n.h,t),ya(t,i,e)}function xr(n,e){n.ia&&ta(n.ia,function(t,i){fe(e,i,t)}),n.l&&Ns({},function(t,i){fe(e,i,t)})}function Da(n,e,t){t=Math.min(n.i.length,t);var i=n.l?se(n.l.Ra,n.l,n):null;e:{var r=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=r[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let d=!0;for(let f=0;f<t;f++){let m=r[f].h;const g=r[f].g;if(m-=s,0>m)s=Math.max(0,r[f].h-100),d=!1;else try{Eh(g,u,"req"+m+"_")}catch(y){i&&i(g)}}if(d){i=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,i}function Ra(n){n.g||n.u||(n.Z=1,ua(n.Ia,n),n.A=0)}function Na(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=dr(se(n.Ia,n),kc(n,n.A)),n.A++,0))}function Oa(n){null!=n.B&&(j.clearTimeout(n.B),n.B=null)}function kr(n){n.g=new gr(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=Jt(n.sa);fe(e,"RID","rpc"),fe(e,"SID",n.I),fe(e,"CI",n.L?"0":"1"),fe(e,"AID",n.T),fe(e,"TYPE","xmlhttp"),xr(n,e),n.o&&n.s&&Vs(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Ia(Jt(e)),t.s=null,t.P=!0,Ds(t,n)}function Zs(n){null!=n.v&&(j.clearTimeout(n.v),n.v=null)}function xc(n,e){var t=null;if(n.g==e){Zs(n),Oa(n),n.g=null;var i=2}else{if(!xa(n.h,e))return;t=e.D,bh(n.h,e),i=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==i){t=e.s?e.s.length:0,e=Date.now()-e.F;var r=n.C;Ue(i=ci(),new Cs(i,t)),qs(n)}else Ra(n);else if(3==(r=e.o)||0==r&&0<n.pa||!(1==i&&function Ah(n,e){return!(_c(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=dr(se(n.Ja,n,e),kc(n,n.C)),n.C++,0)))}(n,e)||2==i&&Na(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),r){case 1:en(n,5);break;case 4:en(n,10);break;case 3:en(n,6);break;default:en(n,2)}}function kc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function en(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var i=se(n.kb,n);t||(t=new pn("//www.google.com/images/cleardot.gif"),j.location&&"http"==j.location.protocol||Os(t,"https"),Ia(t)),function Th(n,e){const t=new ai;if(j.Image){const i=new Image;i.onload=Yi(gn,t,i,"TestLoadImage: loaded",!0,e),i.onerror=Yi(gn,t,i,"TestLoadImage: error",!1,e),i.onabort=Yi(gn,t,i,"TestLoadImage: abort",!1,e),i.ontimeout=Yi(gn,t,i,"TestLoadImage: timeout",!1,e),j.setTimeout(function(){i.ontimeout&&i.ontimeout()},1e4),i.src=n}else e(!1)}(t.toString(),i)}else Ye(2);n.G=0,n.l&&n.l.va(e),Ac(n),Tc(n)}function Ac(n){if(n.G=0,n.la=[],n.l){const e=Ir(n.h);(0!=e.length||0!=n.i.length)&&(Nn(n.la,e),Nn(n.la,n.i),n.h.i.length=0,jo(n.i),n.i.length=0),n.l.ua()}}function Cc(n,e,t){var i=t instanceof pn?Jt(t):new pn(t,void 0);if(""!=i.g)e&&(i.g=e+"."+i.g),Ms(i,i.m);else{var r=j.location;i=r.protocol,e=e?e+"."+r.hostname:r.hostname,r=+r.port;var s=new pn(null,void 0);i&&Os(s,i),e&&(s.g=e),r&&Ms(s,r),t&&(s.l=t),i=s}return e=n.za,(t=n.D)&&e&&fe(i,t,e),fe(i,"VER",n.ma),xr(n,i),i}function Sc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new ye(t&&n.Da&&!n.ra?new wr({jb:!0}):n.ra)).Ka(n.H),e}function Dc(){}function Gs(){if(ri&&!(10<=Number(Xo)))throw Error("Environmental error: no available transport.")}function it(n,e){Te.call(this),this.g=new bc(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!Ji(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Ji(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new yi(this)}function Rc(n){mr.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Nc(){pa.call(this),this.status=1}function yi(n){this.g=n}(q=ye.prototype).Ka=function(n){this.L=n},q.da=function(n,e,t,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():ma.g(),this.C=function oc(n){return n.h||(n.h=n.i())}(this.u?this.u:ma),this.g.onreadystatechange=se(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void gi(this,s)}if(n=t||"",t=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)t.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const s of i.keys())t.set(s,i.get(s))}i=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),r=j.FormData&&n instanceof j.FormData,!(0<=$o(Fs,e))||i||r||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Sa(this),0<this.B&&((this.K=function vc(n){return ri&&function Jo(){return function fs(n){var e=ph;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=ds(String(_s)).split("."),t=ds("9").split("."),i=Math.max(e.length,t.length);for(let u=0;0==n&&u<i;u++){var r=e[u]||"",s=t[u]||"";do{if(r=/(\d*)(\D*)(.*)/.exec(r)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==r[0].length&&0==s[0].length)break;n=Ko(0==r[1].length?0:parseInt(r[1],10),0==s[1].length?0:parseInt(s[1],10))||Ko(0==r[2].length,0==s[2].length)||Ko(r[2],s[2]),r=r[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=se(this.qa,this)):this.A=Ts(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){gi(this,s)}},q.qa=function(){void 0!==cs&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ue(this,"timeout"),this.abort(8))},q.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,Ue(this,"complete"),Ue(this,"abort"),_i(this))},q.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),_i(this,!0)),ye.X.M.call(this)},q.Ha=function(){this.s||(this.F||this.v||this.l?Ic(this):this.fb())},q.fb=function(){Ic(this)},q.aa=function(){try{return 2<bt(this)?this.g.status:-1}catch(n){return-1}},q.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},q.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),xh(e)}},q.Ea=function(){return this.m},q.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(q=bc.prototype).ma=8,q.G=1,q.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const r=new gr(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=ys(s),ec(s,this.S)):s=this.S),null!==this.o||this.N||(r.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var i=this.i[t];if(void 0===(i="__data__"in i.g&&"string"==typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(e+=i)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=Da(this,r,e),fe(t=Jt(this.F),"RID",n),fe(t,"CVER",22),this.D&&fe(t,"X-HTTP-Session-Id",this.D),xr(this,t),s&&(this.N?e="headers="+encodeURIComponent(String(Us(s)))+"&"+e:this.o&&Vs(t,this.o,s)),ka(this.h,r),this.Ya&&fe(t,"TYPE","init"),this.O?(fe(t,"$req",e),fe(t,"SID","null"),r.Z=!0,ya(r,t,null)):ya(r,t,e),this.G=2}}else 3==this.G&&(n?Bs(this,n):0==this.i.length||Ta(this.h)||Bs(this))},q.Ia=function(){if(this.u=null,kr(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=dr(se(this.eb,this),n)}},q.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Ye(10),Xt(this),kr(this))},q.cb=function(){null!=this.v&&(this.v=null,Xt(this),Na(this),Ye(19))},q.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Ye(2)):(this.j.info("Failed to ping google.com"),Ye(1))},(q=Dc.prototype).xa=function(){},q.wa=function(){},q.va=function(){},q.ua=function(){},q.Ra=function(){},Gs.prototype.g=function(n,e){return new it(n,e)},Fe(it,Te),it.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Ye(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Cc(n,null,n.V),qs(n)},it.prototype.close=function(){Ec(this.g)},it.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=sr(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&qs(e)},it.prototype.M=function(){this.g.l=null,delete this.j,Ec(this.g),delete this.g,it.X.M.call(this)},Fe(Rc,mr),Fe(Nc,pa),Fe(yi,Dc),yi.prototype.xa=function(){Ue(this.g,"a")},yi.prototype.wa=function(n){Ue(this.g,new Rc(n))},yi.prototype.va=function(n){Ue(this.g,new Nc)},yi.prototype.ua=function(){Ue(this.g,"b")},Gs.prototype.createWebChannel=Gs.prototype.g,it.prototype.send=it.prototype.u,it.prototype.open=it.prototype.m,it.prototype.close=it.prototype.close,li.NO_ERROR=0,li.TIMEOUT=8,li.HTTP_ERROR=6,fa.COMPLETE="complete",Ss.EventType=pr,pr.OPEN="a",pr.CLOSE="b",pr.ERROR="c",pr.MESSAGE="d",Te.prototype.listen=Te.prototype.N,ye.prototype.listenOnce=ye.prototype.O,ye.prototype.getLastError=ye.prototype.Oa,ye.prototype.getLastErrorCode=ye.prototype.Ea,ye.prototype.getStatus=ye.prototype.aa,ye.prototype.getResponseJson=ye.prototype.Sa,ye.prototype.getResponseText=ye.prototype.fa,ye.prototype.send=ye.prototype.da,ye.prototype.setWithCredentials=ye.prototype.Ka;var Ma=ut.createWebChannelTransport=function(){return new Gs},Ch=ut.getStatEventTarget=function(){return ci()},Ar=ut.ErrorCode=li,Sh=ut.EventType=fa,Pa=ut.Event=Qt,Oc=ut.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},La=ut.FetchXmlHttpFactory=wr,Bn=ut.WebChannel=Ss,Fa=ut.XhrIo=ye;const Mc="@firebase/firestore";class Ce{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}Ce.UNAUTHENTICATED=new Ce(null),Ce.GOOGLE_CREDENTIALS=new Ce("google-credentials-uid"),Ce.FIRST_PARTY=new Ce("first-party-uid"),Ce.MOCK_USER=new Ce("mock-user");let Nt="9.15.0";const rt=new At.Yd("@firebase/firestore");function Cr(){return rt.logLevel}function R(n,...e){if(rt.logLevel<=At.in.DEBUG){const t=e.map(zs);rt.debug(`Firestore (${Nt}): ${n}`,...t)}}function xe(n,...e){if(rt.logLevel<=At.in.ERROR){const t=e.map(zs);rt.error(`Firestore (${Nt}): ${n}`,...t)}}function tn(n,...e){if(rt.logLevel<=At.in.WARN){const t=e.map(zs);rt.warn(`Firestore (${Nt}): ${n}`,...t)}}function zs(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function U(n="Unexpected state"){const e=`FIRESTORE (${Nt}) INTERNAL ASSERTION FAILED: `+n;throw xe(e),new Error(e)}function B(n,e){n||U()}function P(n,e){return n}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class C extends re.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ke{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class $s{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Rh{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Ce.UNAUTHENTICATED))}shutdown(){}}class Sr{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Nh{constructor(e){this.t=e,this.currentUser=Ce.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var i=this;let r=this.i;const s=m=>this.i!==r?(r=this.i,t(m)):Promise.resolve();let u=new ke;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new ke,e.enqueueRetryable(()=>s(this.currentUser))};const d=()=>{const m=u;e.enqueueRetryable((0,x.Z)(function*(){yield m.promise,yield s(i.currentUser)}))},f=m=>{R("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),d()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(R("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new ke)}},0),d()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(i=>this.i!==e?(R("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(B("string"==typeof i.accessToken),new $s(i.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return B(null===e||"string"==typeof e),new Ce(e)}}class Oh{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r,this.type="FirstParty",this.user=Ce.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(B(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Va{constructor(e,t,i,r){this.h=e,this.l=t,this.m=i,this.g=r}getToken(){return Promise.resolve(new Oh(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(Ce.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class js{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qa{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const i=s=>{null!=s.error&&R("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,R("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>i(s))};const r=s=>{R("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>r(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?r(s):R("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(B("string"==typeof t.token),this.A=t.token,new js(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ba(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let i=0;i<n;i++)t[i]=Math.floor(256*Math.random());return t}class Za{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let i="";for(;i.length<20;){const r=Ba(40);for(let s=0;s<r.length;++s)i.length<20&&r[s]<t&&(i+=e.charAt(r[s]%e.length))}return i}}function W(n,e){return n<e?-1:n>e?1:0}function vi(n,e,t){return n.length===e.length&&n.every((i,r)=>t(i,e[r]))}function Pc(n){return n+"\0"}class le{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new C(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new C(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new C(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new C(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return le.fromMillis(Date.now())}static fromDate(e){return le.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),i=Math.floor(1e6*(e-1e3*t));return new le(t,i)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?W(this.nanoseconds,e.nanoseconds):W(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Z{constructor(e){this.timestamp=e}static fromTimestamp(e){return new Z(e)}static min(){return new Z(new le(0,0))}static max(){return new Z(new le(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Dr{constructor(e,t,i){void 0===t?t=0:t>e.length&&U(),void 0===i?i=e.length-t:i>e.length-t&&U(),this.segments=e,this.offset=t,this.len=i}get length(){return this.len}isEqual(e){return 0===Dr.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Dr?e.forEach(i=>{t.push(i)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,i=this.limit();t<i;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const i=Math.min(e.length,t.length);for(let r=0;r<i;r++){const s=e.get(r),u=t.get(r);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ee extends Dr{construct(e,t,i){return new ee(e,t,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const i of e){if(i.indexOf("//")>=0)throw new C(E.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);t.push(...i.split("/").filter(r=>r.length>0))}return new ee(t)}static emptyPath(){return new ee([])}}const Mh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ve extends Dr{construct(e,t,i){return new ve(e,t,i)}static isValidIdentifier(e){return Mh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ve.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ve(["__name__"])}static fromServerFormat(e){const t=[];let i="",r=0;const s=()=>{if(0===i.length)throw new C(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(i),i=""};let u=!1;for(;r<e.length;){const d=e[r];if("\\"===d){if(r+1===e.length)throw new C(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[r+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new C(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,r+=2}else"`"===d?(u=!u,r++):"."!==d||u?(i+=d,r++):(s(),r++)}if(s(),u)throw new C(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new ve(t)}static emptyPath(){return new ve([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(ee.fromString(e))}static fromName(e){return new O(ee.fromString(e).popFirst(5))}static empty(){return new O(ee.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ee.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ee.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new ee(e.slice()))}}class Ws{constructor(e,t,i,r){this.indexId=e,this.collectionGroup=t,this.fields=i,this.indexState=r}}function Rr(n){return n.fields.find(e=>2===e.kind)}function Ot(n){return n.fields.filter(e=>2!==e.kind)}Ws.UNKNOWN_ID=-1;class Nr{constructor(e,t){this.fieldPath=e,this.kind=t}}class Or{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Or(0,st.min())}}function $a(n,e){const t=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,r=Z.fromTimestamp(1e9===i?new le(t+1,0):new le(t,i));return new st(r,O.empty(),e)}function ja(n){return new st(n.readTime,n.key,-1)}class st{constructor(e,t,i){this.readTime=e,this.documentKey=t,this.largestBatchId=i}static min(){return new st(Z.min(),O.empty(),-1)}static max(){return new st(Z.max(),O.empty(),-1)}}function Wa(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(n.documentKey,e.documentKey),0!==t?t:W(n.largestBatchId,e.largestBatchId))}const Ka="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ks{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function _n(n){return Ha.apply(this,arguments)}function Ha(){return Ha=(0,x.Z)(function*(n){if(n.code!==E.FAILED_PRECONDITION||n.message!==Ka)throw n;R("LocalStore","Unexpectedly lost primary lease")}),Ha.apply(this,arguments)}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&U(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((i,r)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(i,r)},this.catchCallback=s=>{this.wrapFailure(t,s).next(i,r)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,i)=>{t(e)})}static reject(e){return new b((t,i)=>{i(e)})}static waitFor(e){return new b((t,i)=>{let r=0,s=0,u=!1;e.forEach(d=>{++r,d.next(()=>{++s,u&&s===r&&t()},f=>i(f))}),u=!0,s===r&&t()})}static or(e){let t=b.resolve(!1);for(const i of e)t=t.next(r=>r?b.resolve(r):i());return t}static forEach(e,t){const i=[];return e.forEach((r,s)=>{i.push(t.call(this,r,s))}),this.waitFor(i)}static mapArray(e,t){return new b((i,r)=>{const s=e.length,u=new Array(s);let d=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(g=>{u[m]=g,++d,d===s&&i(u)},g=>r(g))}})}static doWhile(e,t){return new b((i,r)=>{const s=()=>{!0===e()?t().next(()=>{s()},r):i()};s()})}}class Ii{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new ke,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new wi(e,t.error)):this.P.resolve()},this.transaction.onerror=i=>{const r=Qa(i.target.error);this.P.reject(new wi(e,r))}}static open(e,t,i,r){try{return new Ii(t,e.transaction(r,i))}catch(s){throw new wi(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(R("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Hs(t)}}class Et{constructor(e,t,i){this.name=e,this.version=t,this.S=i,12.2===Et.D((0,re.z$)())&&xe("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return R("SimpleDb","Removing database:",e),Zn(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,re.hl)())return!1;if(Et.N())return!0;const e=(0,re.z$)(),t=Et.D(e),i=0<t&&t<10,r=Et.k(e),s=0<r&&r<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||i||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),i=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(i)}static k(e){const t=e.match(/Android ([\d.]+)/i),i=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(i)}F(e){var t=this;return(0,x.Z)(function*(){return t.db||(R("SimpleDb","Opening database:",t.name),t.db=yield new Promise((i,r)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{i(u.target.result)},s.onblocked=()=>{r(new wi(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const d=u.target.error;r("VersionError"===d.name?new C(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===d.name?new C(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+d):new wi(e,d))},s.onupgradeneeded=u=>{R("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{R("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=i=>t.B(i)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,i,r){var s=this;return(0,x.Z)(function*(){const u="readonly"===t;let d=0;for(;;){++d;try{s.db=yield s.F(e);const f=Ii.open(s.db,e,u?"readonly":"readwrite",i),m=r(f).next(g=>(f.V(),g)).catch(g=>(f.abort(g),b.reject(g))).toPromise();return m.catch(()=>{}),yield f.v,m}catch(f){const m=f,g="FirebaseError"!==m.name&&d<3;if(R("SimpleDb","Transaction failed with error:",m.message,"Retrying:",g),s.close(),!g)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class Ph{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Zn(this.q.delete())}}class wi extends C{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function yn(n){return"IndexedDbTransactionError"===n.name}class Hs{constructor(e){this.store=e}put(e,t){let i;return void 0!==t?(R("SimpleDb","PUT",this.store.name,e,t),i=this.store.put(t,e)):(R("SimpleDb","PUT",this.store.name,"<auto-key>",e),i=this.store.put(e)),Zn(i)}add(e){return R("SimpleDb","ADD",this.store.name,e,e),Zn(this.store.add(e))}get(e){return Zn(this.store.get(e)).next(t=>(void 0===t&&(t=null),R("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return R("SimpleDb","DELETE",this.store.name,e),Zn(this.store.delete(e))}count(){return R("SimpleDb","COUNT",this.store.name),Zn(this.store.count())}W(e,t){const i=this.options(e,t);if(i.index||"function"!=typeof this.store.getAll){const r=this.cursor(i),s=[];return this.H(r,(u,d)=>{s.push(d)}).next(()=>s)}{const r=this.store.getAll(i.range);return new b((s,u)=>{r.onerror=d=>{u(d.target.error)},r.onsuccess=d=>{s(d.target.result)}})}}J(e,t){const i=this.store.getAll(e,null===t?void 0:t);return new b((r,s)=>{i.onerror=u=>{s(u.target.error)},i.onsuccess=u=>{r(u.target.result)}})}Y(e,t){R("SimpleDb","DELETE ALL",this.store.name);const i=this.options(e,t);i.X=!1;const r=this.cursor(i);return this.H(r,(s,u,d)=>d.delete())}Z(e,t){let i;t?i=e:(i={},t=e);const r=this.cursor(i);return this.H(r,t)}tt(e){const t=this.cursor({});return new b((i,r)=>{t.onerror=s=>{const u=Qa(s.target.error);r(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(d=>{d?u.continue():i()}):i()}})}H(e,t){const i=[];return new b((r,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const d=u.target.result;if(!d)return void r();const f=new Ph(d),m=t(d.primaryKey,d.value,f);if(m instanceof b){const g=m.catch(y=>(f.done(),b.reject(y)));i.push(g)}f.isDone?r():null===f.G?d.continue():d.continue(f.G)}}).next(()=>b.waitFor(i))}options(e,t){let i;return void 0!==e&&("string"==typeof e?i=e:t=e),{index:i,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const i=this.store.index(e.index);return e.X?i.openKeyCursor(e.range,t):i.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Zn(n){return new b((e,t)=>{n.onsuccess=i=>{e(i.target.result)},n.onerror=i=>{const r=Qa(i.target.error);t(r)}})}let Lc=!1;function Qa(n){const e=Et.D((0,re.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const i=new C("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Lc||(Lc=!0,setTimeout(()=>{throw i},0)),i}}return n}class Lh{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;R("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,x.Z)(function*(){t.task=null;try{R("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(i){yn(i)?R("IndexBackiller","Ignoring IndexedDB error during index backfill: ",i):yield _n(i)}yield t.nt(6e4)}))}}class Fh{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,x.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",i=>t.it(i,e))})()}it(e,t){const i=new Set;let r=t,s=!0;return b.doWhile(()=>!0===s&&r>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!i.has(u))return R("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,r).next(d=>{r-=d,i.add(u)});s=!1})).next(()=>t-r)}rt(e,t,i){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(r=>this.localStore.localDocuments.getNextDocuments(e,t,r,i).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(r,s)).next(d=>(R("IndexBackiller",`Updating offset: ${d}`),this.localStore.indexManager.updateCollectionGroup(e,t,d))).next(()=>u.size)}))}ot(e,t){let i=e;return t.changes.forEach((r,s)=>{const u=ja(s);Wa(u,i)>0&&(i=u)}),new st(i.readTime,i.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ct=(()=>{class n{constructor(t,i){this.previousValue=t,i&&(i.sequenceNumberHandler=r=>this.ut(r),this.ct=r=>i.writeSequenceNumber(r))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Uh{constructor(e,t,i,r,s,u,d,f){this.databaseId=e,this.appId=t,this.persistenceKey=i,this.host=r,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=d,this.useFetchStreams=f}}class vn{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new vn("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof vn&&e.projectId===this.projectId&&e.database===this.database}}function Qs(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Gn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function Fc(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Mr(n){return null==n}function Pr(n){return 0===n&&1/n==-1/0}function Uc(n){return"number"==typeof n&&Number.isInteger(n)&&!Pr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class Re{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Re(t)}static fromUint8Array(e){const t=function(i){let r="";for(let s=0;s<i.length;++s)r+=String.fromCharCode(i[s]);return r}(e);return new Re(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let i=0;i<e.length;i++)t[i]=e.charCodeAt(i);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return W(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Re.EMPTY_BYTE_STRING=new Re("");const Vh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function In(n){if(B(!!n),"string"==typeof n){let e=0;const t=Vh.exec(n);if(B(!!t),t[1]){let r=t[1];r=(r+"000000000").substr(0,9),e=Number(r)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Ie(n.seconds),nanos:Ie(n.nanos)}}function Ie(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function nn(n){return"string"==typeof n?Re.fromBase64String(n):Re.fromUint8Array(n)}function Ya(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function Ys(n){const e=n.mapValue.fields.__previous_value__;return Ya(e)?Ys(e):e}function Lr(n){const e=In(n.mapValue.fields.__local_write_time__.timestampValue);return new le(e.seconds,e.nanos)}const rn={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},Js={nullValue:"NULL_VALUE"};function sn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ya(n)?4:Zc(n)?9007199254740991:10:U()}function Mt(n,e){if(n===e)return!0;const t=sn(n);if(t!==sn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return Lr(n).isEqual(Lr(e));case 3:return function(i,r){if("string"==typeof i.timestampValue&&"string"==typeof r.timestampValue&&i.timestampValue.length===r.timestampValue.length)return i.timestampValue===r.timestampValue;const s=In(i.timestampValue),u=In(r.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return r=e,nn(n.bytesValue).isEqual(nn(r.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(i,r){return Ie(i.geoPointValue.latitude)===Ie(r.geoPointValue.latitude)&&Ie(i.geoPointValue.longitude)===Ie(r.geoPointValue.longitude)}(n,e);case 2:return function(i,r){if("integerValue"in i&&"integerValue"in r)return Ie(i.integerValue)===Ie(r.integerValue);if("doubleValue"in i&&"doubleValue"in r){const s=Ie(i.doubleValue),u=Ie(r.doubleValue);return s===u?Pr(s)===Pr(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return vi(n.arrayValue.values||[],e.arrayValue.values||[],Mt);case 10:return function(i,r){const s=i.mapValue.fields||{},u=r.mapValue.fields||{};if(Qs(s)!==Qs(u))return!1;for(const d in s)if(s.hasOwnProperty(d)&&(void 0===u[d]||!Mt(s[d],u[d])))return!1;return!0}(n,e);default:return U()}var r}function bi(n,e){return void 0!==(n.values||[]).find(t=>Mt(t,e))}function on(n,e){if(n===e)return 0;const t=sn(n),i=sn(e);if(t!==i)return W(t,i);switch(t){case 0:case 9007199254740991:return 0;case 1:return W(n.booleanValue,e.booleanValue);case 2:return function(r,s){const u=Ie(r.integerValue||r.doubleValue),d=Ie(s.integerValue||s.doubleValue);return u<d?-1:u>d?1:u===d?0:isNaN(u)?isNaN(d)?0:-1:1}(n,e);case 3:return qc(n.timestampValue,e.timestampValue);case 4:return qc(Lr(n),Lr(e));case 5:return W(n.stringValue,e.stringValue);case 6:return function(r,s){const u=nn(r),d=nn(s);return u.compareTo(d)}(n.bytesValue,e.bytesValue);case 7:return function(r,s){const u=r.split("/"),d=s.split("/");for(let f=0;f<u.length&&f<d.length;f++){const m=W(u[f],d[f]);if(0!==m)return m}return W(u.length,d.length)}(n.referenceValue,e.referenceValue);case 8:return function(r,s){const u=W(Ie(r.latitude),Ie(s.latitude));return 0!==u?u:W(Ie(r.longitude),Ie(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(r,s){const u=r.values||[],d=s.values||[];for(let f=0;f<u.length&&f<d.length;++f){const m=on(u[f],d[f]);if(m)return m}return W(u.length,d.length)}(n.arrayValue,e.arrayValue);case 10:return function(r,s){if(r===rn.mapValue&&s===rn.mapValue)return 0;if(r===rn.mapValue)return 1;if(s===rn.mapValue)return-1;const u=r.fields||{},d=Object.keys(u),f=s.fields||{},m=Object.keys(f);d.sort(),m.sort();for(let g=0;g<d.length&&g<m.length;++g){const y=W(d[g],m[g]);if(0!==y)return y;const w=on(u[d[g]],f[m[g]]);if(0!==w)return w}return W(d.length,m.length)}(n.mapValue,e.mapValue);default:throw U()}}function qc(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return W(n,e);const t=In(n),i=In(e),r=W(t.seconds,i.seconds);return 0!==r?r:W(t.nanos,i.nanos)}function Ei(n){return Ja(n)}function Ja(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(i){const r=In(i);return`time(${r.seconds},${r.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?nn(n.bytesValue).toBase64():"referenceValue"in n?O.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(i){let r="[",s=!0;for(const u of i.values||[])s?s=!1:r+=",",r+=Ja(u);return r+"]"}(n.arrayValue):"mapValue"in n?function(i){const r=Object.keys(i.fields||{}).sort();let s="{",u=!0;for(const d of r)u?u=!1:s+=",",s+=`${d}:${Ja(i.fields[d])}`;return s+"}"}(n.mapValue):U();var e}function zn(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Xa(n){return!!n&&"integerValue"in n}function Ti(n){return!!n&&"arrayValue"in n}function Bc(n){return!!n&&"nullValue"in n}function qh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Pt(n){return!!n&&"mapValue"in n}function Fr(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Gn(n.mapValue.fields,(t,i)=>e.mapValue.fields[t]=Fr(i)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=Fr(n.arrayValue.values[t]);return e}return Object.assign({},n)}function Zc(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function eu(n){return"nullValue"in n?Js:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?zn(vn.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:U()}function Bh(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?zn(vn.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?rn:U()}function Xs(n,e){const t=on(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Gc(n,e){const t=on(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class wn{constructor(e,t){this.position=e,this.inclusive=t}}function eo(n,e,t){let i=0;for(let r=0;r<n.position.length;r++){const s=e[r],u=n.position[r];if(i=s.field.isKeyField()?O.comparator(O.fromName(u.referenceValue),t.key):on(u,t.data.field(s.field)),"desc"===s.dir&&(i*=-1),0!==i)break}return i}function zc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Mt(n.position[t],e.position[t]))return!1;return!0}class $c{}class J extends $c{constructor(e,t,i){super(),this.field=e,this.op=t,this.value=i}static create(e,t,i){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,i):new iu(e,t,i):"array-contains"===t?new no(e,i):"in"===t?new Yc(e,i):"not-in"===t?new Gh(e,i):"array-contains-any"===t?new zh(e,i):new J(e,t,i)}static createKeyFieldInFilter(e,t,i){return"in"===t?new ru(e,i):new Zh(e,i)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(on(t,this.value)):null!==t&&sn(this.value)===sn(t)&&this.matchesComparison(on(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return U()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ce extends $c{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ce(e,t)}matches(e){return xi(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function xi(n){return"and"===n.op}function tu(n){return"or"===n.op}function jc(n){return Wc(n)&&xi(n)}function Wc(n){for(const e of n.filters)if(e instanceof ce)return!1;return!0}function nu(n){if(n instanceof J)return n.field.canonicalString()+n.op.toString()+Ei(n.value);{const e=n.filters.map(t=>nu(t)).join(",");return`${n.op}(${e})`}}function to(n,e){return n instanceof J?(t=n,(i=e)instanceof J&&t.op===i.op&&t.field.isEqual(i.field)&&Mt(t.value,i.value)):n instanceof ce?function(t,i){return i instanceof ce&&t.op===i.op&&t.filters.length===i.filters.length&&t.filters.reduce((r,s,u)=>r&&to(s,i.filters[u]),!0)}(n,e):void U();var t,i}function Kc(n,e){const t=n.filters.concat(e);return ce.create(t,n.op)}function Hc(n){return n instanceof J?`${(e=n).field.canonicalString()} ${e.op} ${Ei(e.value)}`:n instanceof ce?function(e){return e.op.toString()+" {"+e.getFilters().map(Hc).join(" ,")+"}"}(n):"Filter";var e}class iu extends J{constructor(e,t,i){super(e,t,i),this.key=O.fromName(i.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class ru extends J{constructor(e,t){super(e,"in",t),this.keys=Qc(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class Zh extends J{constructor(e,t){super(e,"not-in",t),this.keys=Qc(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function Qc(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(i=>O.fromName(i.referenceValue))}class no extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Ti(t)&&bi(t.arrayValue,this.value)}}class Yc extends J{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&bi(this.value.arrayValue,t)}}class Gh extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(bi(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!bi(this.value.arrayValue,t)}}class zh extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Ti(t)||!t.arrayValue.values)&&t.arrayValue.values.some(i=>bi(this.value.arrayValue,i))}}class $n{constructor(e,t="asc"){this.field=e,this.dir=t}}function $h(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class we{constructor(e,t){this.comparator=e,this.root=t||Be.EMPTY}insert(e,t){return new we(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Be.BLACK,null,null))}remove(e){return new we(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const i=this.comparator(e,t.key);if(0===i)return t.value;i<0?t=t.left:i>0&&(t=t.right)}return null}indexOf(e){let t=0,i=this.root;for(;!i.isEmpty();){const r=this.comparator(e,i.key);if(0===r)return t+i.left.size;r<0?i=i.left:(t+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,i)=>(e(t,i),!1))}toString(){const e=[];return this.inorderTraversal((t,i)=>(e.push(`${t}:${i}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new io(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new io(this.root,e,this.comparator,!1)}getReverseIterator(){return new io(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new io(this.root,e,this.comparator,!0)}}class io{constructor(e,t,i,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?i(e.key,t):1,t&&r&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Be{constructor(e,t,i,r,s){this.key=e,this.value=t,this.color=null!=i?i:Be.RED,this.left=null!=r?r:Be.EMPTY,this.right=null!=s?s:Be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,i,r,s){return new Be(null!=e?e:this.key,null!=t?t:this.value,null!=i?i:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,i){let r=this;const s=i(e,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(e,t,i),null):0===s?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,i)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let i,r=this;if(t(e,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(e,t),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===t(e,r.key)){if(r.right.isEmpty())return Be.EMPTY;i=r.right.min(),r=r.copy(i.key,i.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(e,t))}return r.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw U();const e=this.left.check();if(e!==this.right.check())throw U();return e+(this.isRed()?0:1)}}Be.EMPTY=null,Be.RED=!0,Be.BLACK=!1,Be.EMPTY=new class{constructor(){this.size=0}get key(){throw U()}get value(){throw U()}get color(){throw U()}get left(){throw U()}get right(){throw U()}copy(n,e,t,i,r){return this}insert(n,e,t){return new Be(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class oe{constructor(e){this.comparator=e,this.data=new we(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,i)=>(e(t),!1))}forEachInRange(e,t){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const r=i.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}forEachWhile(e,t){let i;for(i=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Jc(this.data.getIterator())}getIteratorFrom(e){return new Jc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(i=>{t=t.add(i)}),t}isEqual(e){if(!(e instanceof oe)||this.size!==e.size)return!1;const t=this.data.getIterator(),i=e.data.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(0!==this.comparator(r,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new oe(this.comparator);return t.data=e,t}}class Jc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function jn(n){return n.hasNext()?n.getNext():void 0}class lt{constructor(e){this.fields=e,e.sort(ve.comparator)}static empty(){return new lt([])}unionWith(e){let t=new oe(ve.comparator);for(const i of this.fields)t=t.add(i);for(const i of e)t=t.add(i);return new lt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return vi(this.fields,e.fields,(t,i)=>t.isEqual(i))}}class Ze{constructor(e){this.value=e}static empty(){return new Ze({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let i=0;i<e.length-1;++i)if(t=(t.mapValue.fields||{})[e.get(i)],!Pt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Fr(t)}setAll(e){let t=ve.emptyPath(),i={},r=[];e.forEach((u,d)=>{if(!t.isImmediateParentOf(d)){const f=this.getFieldsMap(t);this.applyChanges(f,i,r),i={},r=[],t=d.popLast()}u?i[d.lastSegment()]=Fr(u):r.push(d.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,i,r)}delete(e){const t=this.field(e.popLast());Pt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Mt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let i=0;i<e.length;++i){let r=t.mapValue.fields[e.get(i)];Pt(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(i)]=r),t=r}return t.mapValue.fields}applyChanges(e,t,i){Gn(t,(r,s)=>e[r]=s);for(const r of i)delete e[r]}clone(){return new Ze(Fr(this.value))}}function Xc(n){const e=[];return Gn(n.fields,(t,i)=>{const r=new ve([t]);if(Pt(i)){const s=Xc(i.mapValue).fields;if(0===s.length)e.push(r);else for(const u of s)e.push(r.child(u))}else e.push(r)}),new lt(e)}class de{constructor(e,t,i,r,s,u,d){this.key=e,this.documentType=t,this.version=i,this.readTime=r,this.createTime=s,this.data=u,this.documentState=d}static newInvalidDocument(e){return new de(e,0,Z.min(),Z.min(),Z.min(),Ze.empty(),0)}static newFoundDocument(e,t,i,r){return new de(e,1,t,Z.min(),i,r,0)}static newNoDocument(e,t){return new de(e,2,t,Z.min(),Z.min(),Ze.empty(),0)}static newUnknownDocument(e,t){return new de(e,3,t,Z.min(),Z.min(),Ze.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(Z.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Ze.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Ze.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Z.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof de&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new de(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class el{constructor(e,t=null,i=[],r=[],s=null,u=null,d=null){this.path=e,this.collectionGroup=t,this.orderBy=i,this.filters=r,this.limit=s,this.startAt=u,this.endAt=d,this.ft=null}}function Ur(n,e=null,t=[],i=[],r=null,s=null,u=null){return new el(n,e,t,i,r,s,u)}function an(n){const e=P(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(i=>nu(i)).join(","),t+="|ob:",t+=e.orderBy.map(i=>{return(r=i).field.canonicalString()+r.dir;var r}).join(","),Mr(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ei(i)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ei(i)).join(",")),e.ft=t}return e.ft}function ki(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!$h(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!to(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!zc(n.startAt,e.startAt)&&zc(n.endAt,e.endAt)}function ro(n){return O.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Ai(n,e){return n.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function tl(n,e,t){let i=Js,r=!0;for(const s of Ai(n,e)){let u=Js,d=!0;switch(s.op){case"<":case"<=":u=eu(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,d=!1;break;case"!=":case"not-in":u=Js}Xs({value:i,inclusive:r},{value:u,inclusive:d})<0&&(i=u,r=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Xs({value:i,inclusive:r},{value:u,inclusive:t.inclusive})<0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}function ot(n,e,t){let i=rn,r=!0;for(const s of Ai(n,e)){let u=rn,d=!0;switch(s.op){case">=":case">":u=Bh(s.value),d=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,d=!1;break;case"!=":case"not-in":u=rn}Gc({value:i,inclusive:r},{value:u,inclusive:d})>0&&(i=u,r=d)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Gc({value:i,inclusive:r},{value:u,inclusive:t.inclusive})>0&&(i=u,r=t.inclusive);break}return{value:i,inclusive:r}}class ht{constructor(e,t=null,i=[],r=[],s=null,u="F",d=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=i,this.filters=r,this.limit=s,this.limitType=u,this.startAt=d,this.endAt=f,this.dt=null,this._t=null}}function su(n,e,t,i,r,s,u,d){return new ht(n,e,t,i,r,s,u,d)}function Ci(n){return new ht(n)}function so(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function Vr(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function oo(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function ao(n){return null!==n.collectionGroup}function Wn(n){const e=P(n);if(null===e.dt){e.dt=[];const t=oo(e),i=Vr(e);if(null!==t&&null===i)t.isKeyField()||e.dt.push(new $n(t)),e.dt.push(new $n(ve.keyField(),"asc"));else{let r=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(r=!0);if(!r){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new $n(ve.keyField(),s))}}}return e.dt}function be(n){const e=P(n);if(!e._t)if("F"===e.limitType)e._t=Ur(e.path,e.collectionGroup,Wn(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of Wn(e))t.push(new $n(s.field,"desc"===s.dir?"asc":"desc"));const i=e.endAt?new wn(e.endAt.position,e.endAt.inclusive):null,r=e.startAt?new wn(e.startAt.position,e.startAt.inclusive):null;e._t=Ur(e.path,e.collectionGroup,t,e.filters,e.limit,i,r)}return e._t}function uo(n,e){e.getFirstInequalityField(),oo(n);const t=n.filters.concat([e]);return new ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function co(n,e,t){return new ht(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qr(n,e){return ki(be(n),be(e))&&n.limitType===e.limitType}function nl(n){return`${an(be(n))}|lt:${n.limitType}`}function lo(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(i=>Hc(i)).join(", ")}]`),Mr(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(i=>{return`${(r=i).field.canonicalString()} (${r.dir})`;var r}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(i=>Ei(i)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(i=>Ei(i)).join(",")),`Target(${t})`}(be(n))}; limitType=${n.limitType})`}function $e(n,e){return e.isFoundDocument()&&function(t,i){const r=i.key.path;return null!==t.collectionGroup?i.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(r):O.isDocumentKey(t.path)?t.path.isEqual(r):t.path.isImmediateParentOf(r)}(n,e)&&function(t,i){for(const r of Wn(t))if(!r.field.isKeyField()&&null===i.data.field(r.field))return!1;return!0}(n,e)&&function(t,i){for(const r of t.filters)if(!r.matches(i))return!1;return!0}(n,e)&&(i=e,!((t=n).startAt&&!function(r,s,u){const d=eo(r,s,u);return r.inclusive?d<=0:d<0}(t.startAt,Wn(t),i)||t.endAt&&!function(r,s,u){const d=eo(r,s,u);return r.inclusive?d>=0:d>0}(t.endAt,Wn(t),i)));var t,i}function ho(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function fo(n){return(e,t)=>{let i=!1;for(const r of Wn(n)){const s=jh(r,e,t);if(0!==s)return s;i=i||r.field.isKeyField()}return 0}}function jh(n,e,t){const i=n.field.isKeyField()?O.comparator(e.key,t.key):function(r,s,u){const d=s.data.field(r),f=u.data.field(r);return null!==d&&null!==f?on(d,f):U()}(n.field,e,t);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return U()}}function Lt(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Pr(e)?"-0":e}}function Si(n){return{integerValue:""+n}}function ou(n,e){return Uc(e)?Si(e):Lt(n,e)}class Br{constructor(){this._=void 0}}function Wh(n,e,t){return n instanceof Di?function(i,r){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:i.seconds,nanos:i.nanoseconds}}}};return r&&(s.fields.__previous_value__=r),{mapValue:s}}(t,e):n instanceof Kn?rl(n,e):n instanceof c?o(n,e):function(i,r){const s=il(i,r),u=h(s)+h(i.gt);return Xa(s)&&Xa(i.gt)?Si(u):Lt(i.yt,u)}(n,e)}function au(n,e,t){return n instanceof Kn?rl(n,e):n instanceof c?o(n,e):t}function il(n,e){return n instanceof a?Xa(t=e)||(i=t)&&"doubleValue"in i?e:{integerValue:0}:null;var i,t}class Di extends Br{}class Kn extends Br{constructor(e){super(),this.elements=e}}function rl(n,e){const t=p(e);for(const i of n.elements)t.some(r=>Mt(r,i))||t.push(i);return{arrayValue:{values:t}}}class c extends Br{constructor(e){super(),this.elements=e}}function o(n,e){let t=p(e);for(const i of n.elements)t=t.filter(r=>!Mt(r,i));return{arrayValue:{values:t}}}class a extends Br{constructor(e,t){super(),this.yt=e,this.gt=t}}function h(n){return Ie(n.integerValue||n.doubleValue)}function p(n){return Ti(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class _{constructor(e,t){this.field=e,this.transform=t}}class T{constructor(e,t){this.version=e,this.transformResults=t}}class A{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new A}static exists(e){return new A(void 0,e)}static updateTime(e){return new A(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function L(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class ${}function z(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new Hn(n.key,A.none()):new bn(n.key,n.data,A.none());{const t=n.data,i=Ze.empty();let r=new oe(ve.comparator);for(let s of e.fields)if(!r.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?i.delete(s):i.set(s,u),r=r.add(s)}return new Ft(n.key,i,new lt(r.toArray()),A.none())}}function Ne(n,e,t){n instanceof bn?function(i,r,s){const u=i.value.clone(),d=mo(i.fieldTransforms,r,s.transformResults);u.setAll(d),r.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Ft?function(i,r,s){if(!L(i.precondition,r))return void r.convertToUnknownDocument(s.version);const u=mo(i.fieldTransforms,r,s.transformResults),d=r.data;d.setAll(cu(i)),d.setAll(u),r.convertToFoundDocument(s.version,d).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function Je(n,e,t,i){return n instanceof bn?function(r,s,u,d){if(!L(r.precondition,s))return u;const f=r.value.clone(),m=lu(r.fieldTransforms,d,s);return f.setAll(m),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,i):n instanceof Ft?function(r,s,u,d){if(!L(r.precondition,s))return u;const f=lu(r.fieldTransforms,d,s),m=s.data;return m.setAll(cu(r)),m.setAll(f),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===u?null:u.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map(g=>g.field))}(n,e,t,i):(u=t,L(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function po(n,e){let t=null;for(const i of n.fieldTransforms){const r=e.data.field(i.field),s=il(i.transform,r||null);null!=s&&(null===t&&(t=Ze.empty()),t.set(i.field,s))}return t||null}function uu(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(i=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===i||t&&i&&vi(t,i,(r,s)=>function v(n,e){return n.field.isEqual(e.field)&&(i=e.transform,(t=n.transform)instanceof Kn&&i instanceof Kn||t instanceof c&&i instanceof c?vi(t.elements,i.elements,Mt):t instanceof a&&i instanceof a?Mt(t.gt,i.gt):t instanceof Di&&i instanceof Di);var t,i}(r,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,i}class bn extends ${constructor(e,t,i,r=[]){super(),this.key=e,this.value=t,this.precondition=i,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Ft extends ${constructor(e,t,i,r,s=[]){super(),this.key=e,this.data=t,this.fieldMask=i,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function cu(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const i=n.data.field(t);e.set(t,i)}}),e}function mo(n,e,t){const i=new Map;B(n.length===t.length);for(let r=0;r<t.length;r++){const s=n[r],u=s.transform,d=e.data.field(s.field);i.set(s.field,au(u,d,t[r]))}return i}function lu(n,e,t){const i=new Map;for(const r of n){const s=r.transform,u=t.data.field(r.field);i.set(r.field,Wh(s,u,e))}return i}class Hn extends ${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Zr extends ${constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class sl{constructor(e){this.count=e}}var Se,te;function ol(n){switch(n){default:return U();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function Ep(n){if(void 0===n)return xe("GRPC error has no .code"),E.UNKNOWN;switch(n){case Se.OK:return E.OK;case Se.CANCELLED:return E.CANCELLED;case Se.UNKNOWN:return E.UNKNOWN;case Se.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case Se.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case Se.INTERNAL:return E.INTERNAL;case Se.UNAVAILABLE:return E.UNAVAILABLE;case Se.UNAUTHENTICATED:return E.UNAUTHENTICATED;case Se.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case Se.NOT_FOUND:return E.NOT_FOUND;case Se.ALREADY_EXISTS:return E.ALREADY_EXISTS;case Se.PERMISSION_DENIED:return E.PERMISSION_DENIED;case Se.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case Se.ABORTED:return E.ABORTED;case Se.OUT_OF_RANGE:return E.OUT_OF_RANGE;case Se.UNIMPLEMENTED:return E.UNIMPLEMENTED;case Se.DATA_LOSS:return E.DATA_LOSS;default:return U()}}(te=Se||(Se={}))[te.OK=0]="OK",te[te.CANCELLED=1]="CANCELLED",te[te.UNKNOWN=2]="UNKNOWN",te[te.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",te[te.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",te[te.NOT_FOUND=5]="NOT_FOUND",te[te.ALREADY_EXISTS=6]="ALREADY_EXISTS",te[te.PERMISSION_DENIED=7]="PERMISSION_DENIED",te[te.UNAUTHENTICATED=16]="UNAUTHENTICATED",te[te.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",te[te.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",te[te.ABORTED=10]="ABORTED",te[te.OUT_OF_RANGE=11]="OUT_OF_RANGE",te[te.UNIMPLEMENTED=12]="UNIMPLEMENTED",te[te.INTERNAL=13]="INTERNAL",te[te.UNAVAILABLE=14]="UNAVAILABLE",te[te.DATA_LOSS=15]="DATA_LOSS";class Ri{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0!==i)for(const[r,s]of i)if(this.equalsFn(r,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const i=this.mapKeyFn(e),r=this.inner[i];if(void 0===r)return this.inner[i]=[[e,t]],void this.innerSize++;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],e))return void(r[s]=[e,t]);r.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),i=this.inner[t];if(void 0===i)return!1;for(let r=0;r<i.length;r++)if(this.equalsFn(i[r][0],e))return 1===i.length?delete this.inner[t]:i.splice(r,1),this.innerSize--,!0;return!1}forEach(e){Gn(this.inner,(t,i)=>{for(const[r,s]of i)e(r,s)})}isEmpty(){return Fc(this.inner)}size(){return this.innerSize}}const W_=new we(O.comparator);function vt(){return W_}const Tp=new we(O.comparator);function hu(...n){let e=Tp;for(const t of n)e=e.insert(t.key,t);return e}function xp(n){let e=Tp;return n.forEach((t,i)=>e=e.insert(t,i.overlayedDocument)),e}function En(){return du()}function kp(){return du()}function du(){return new Ri(n=>n.toString(),(n,e)=>n.isEqual(e))}const K_=new we(O.comparator),H_=new oe(O.comparator);function H(...n){let e=H_;for(const t of n)e=e.add(t);return e}const Q_=new oe(W);function al(){return Q_}class fu{constructor(e,t,i,r,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=i,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,i){const r=new Map;return r.set(e,pu.createSynthesizedTargetChangeForCurrentChange(e,t,i)),new fu(Z.min(),r,al(),vt(),H())}}class pu{constructor(e,t,i,r,s){this.resumeToken=e,this.current=t,this.addedDocuments=i,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,i){return new pu(i,t,H(),H(),H())}}class ul{constructor(e,t,i,r){this.It=e,this.removedTargetIds=t,this.key=i,this.Tt=r}}class Ap{constructor(e,t){this.targetId=e,this.Et=t}}class Cp{constructor(e,t,i=Re.EMPTY_BYTE_STRING,r=null){this.state=e,this.targetIds=t,this.resumeToken=i,this.cause=r}}class Sp{constructor(){this.At=0,this.Rt=Rp(),this.bt=Re.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=H(),t=H(),i=H();return this.Rt.forEach((r,s)=>{switch(s){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:i=i.add(r);break;default:U()}}),new pu(this.bt,this.Pt,e,t,i)}xt(){this.vt=!1,this.Rt=Rp()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Y_{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=vt(),this.qt=Dp(),this.Ut=new oe(W)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const i=this.Wt(t);switch(e.state){case 0:this.zt(t)&&i.Dt(e.resumeToken);break;case 1:i.Mt(),i.Vt||i.xt(),i.Dt(e.resumeToken);break;case 2:i.Mt(),i.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(i.Ft(),i.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),i.Dt(e.resumeToken));break;default:U()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((i,r)=>{this.zt(r)&&t(r)})}Jt(e){const t=e.targetId,i=e.Et.count,r=this.Yt(t);if(r){const s=r.target;if(ro(s))if(0===i){const u=new O(s.path);this.Qt(t,u,de.newNoDocument(u,Z.min()))}else B(1===i);else this.Xt(t)!==i&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,u)=>{const d=this.Yt(u);if(d){if(s.current&&ro(d.target)){const f=new O(d.target.path);null!==this.Lt.get(f)||this.te(u,f)||this.Qt(u,f,de.newNoDocument(f,e))}s.St&&(t.set(u,s.Ct()),s.xt())}});let i=H();this.qt.forEach((s,u)=>{let d=!0;u.forEachWhile(f=>{const m=this.Yt(f);return!m||2===m.purpose||(d=!1,!1)}),d&&(i=i.add(s))}),this.Lt.forEach((s,u)=>u.setReadTime(e));const r=new fu(e,t,this.Ut,this.Lt,i);return this.Lt=vt(),this.qt=Dp(),this.Ut=new oe(W),r}Gt(e,t){if(!this.zt(e))return;const i=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,i),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,i){if(!this.zt(e))return;const r=this.Wt(e);this.te(e,t)?r.Nt(t,1):r.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),i&&(this.Lt=this.Lt.insert(t,i))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new Sp,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new oe(W),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||R("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new Sp),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Dp(){return new we(O.comparator)}function Rp(){return new we(O.comparator)}const J_={asc:"ASCENDING",desc:"DESCENDING"},X_={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},ey={and:"AND",or:"OR"};class ty{constructor(e,t){this.databaseId=e,this.wt=t}}function go(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Np(n,e){return n.wt?e.toBase64():e.toUint8Array()}function ny(n,e){return go(n,e.toTimestamp())}function Oe(n){return B(!!n),Z.fromTimestamp(function(e){const t=In(e);return new le(t.seconds,t.nanos)}(n))}function Kh(n,e){return(t=n,new ee(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Op(n){const e=ee.fromString(n);return B(Zp(e)),e}function mu(n,e){return Kh(n.databaseId,e.path)}function Tn(n,e){const t=Op(e);if(t.get(1)!==n.databaseId.projectId)throw new C(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new C(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(Pp(t))}function Hh(n,e){return Kh(n.databaseId,e)}function Mp(n){const e=Op(n);return 4===e.length?ee.emptyPath():Pp(e)}function gu(n){return new ee(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Pp(n){return B(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Lp(n,e,t){return{name:mu(n,e),fields:t.value.mapValue.fields}}function Fp(n,e,t){const i=Tn(n,e.name),r=Oe(e.updateTime),s=e.createTime?Oe(e.createTime):Z.min(),u=new Ze({mapValue:{fields:e.fields}}),d=de.newFoundDocument(i,r,s,u);return t&&d.setHasCommittedMutations(),t?d.setHasCommittedMutations():d}function _u(n,e){let t;if(e instanceof bn)t={update:Lp(n,e.key,e.value)};else if(e instanceof Hn)t={delete:mu(n,e.key)};else if(e instanceof Ft)t={update:Lp(n,e.key,e.data),updateMask:ly(e.fieldMask)};else{if(!(e instanceof Zr))return U();t={verify:mu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(i=>function(r,s){const u=s.transform;if(u instanceof Di)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Kn)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof c)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof a)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw U()}(0,i))),e.precondition.isNone||(t.currentDocument=void 0!==(r=e.precondition).updateTime?{updateTime:ny(n,r.updateTime)}:void 0!==r.exists?{exists:r.exists}:U()),t;var r}function Qh(n,e){const t=e.currentDocument?void 0!==(r=e.currentDocument).updateTime?A.updateTime(Oe(r.updateTime)):void 0!==r.exists?A.exists(r.exists):A.none():A.none(),i=e.updateTransforms?e.updateTransforms.map(r=>function(s,u){let d=null;"setToServerValue"in u?(B("REQUEST_TIME"===u.setToServerValue),d=new Di):"appendMissingElements"in u?d=new Kn(u.appendMissingElements.values||[]):"removeAllFromArray"in u?d=new c(u.removeAllFromArray.values||[]):"increment"in u?d=new a(s,u.increment):U();const f=ve.fromServerFormat(u.fieldPath);return new _(f,d)}(n,r)):[];var r;if(e.update){const r=Tn(n,e.update.name),s=new Ze({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new lt((e.updateMask.fieldPaths||[]).map(m=>ve.fromServerFormat(m)));return new Ft(r,s,u,t,i)}return new bn(r,s,t,i)}if(e.delete){const r=Tn(n,e.delete);return new Hn(r,t)}if(e.verify){const r=Tn(n,e.verify);return new Zr(r,t)}return U()}function Up(n,e){return{documents:[Hh(n,e.path)]}}function Yh(n,e){const t={structuredQuery:{}},i=e.path;null!==e.collectionGroup?(t.parent=Hh(n,i),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Hh(n,i.popLast()),t.structuredQuery.from=[{collectionId:i.lastSegment()}]);const r=function(f){if(0!==f.length)return Bp(ce.create(f,"and"))}(e.filters);r&&(t.structuredQuery.where=r);const s=function(f){if(0!==f.length)return f.map(m=>{return{field:_o((g=m).field),direction:ay(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(m=e.limit,n.wt||Mr(m)?m:{value:m});var m,d,f;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(d=e.startAt).inclusive,values:d.position}),e.endAt&&(t.structuredQuery.endAt={before:!(f=e.endAt).inclusive,values:f.position}),t}function Vp(n){let e=Mp(n.parent);const t=n.structuredQuery,i=t.from?t.from.length:0;let r=null;if(i>0){B(1===i);const g=t.from[0];g.allDescendants?r=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(g){const y=qp(g);return y instanceof ce&&jc(y)?y.getFilters():[y]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new $n(yo((y=g).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(y.direction));var y}));let d=null;t.limit&&(d=function(g){let y;return y="object"==typeof g?g.value:g,Mr(y)?null:y}(t.limit));let f=null;var g;t.startAt&&(f=new wn((g=t.startAt).values||[],!!g.before));let m=null;return t.endAt&&(m=function(g){return new wn(g.values||[],!g.before)}(t.endAt)),su(e,r,u,s,d,"F",f,m)}function qp(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=yo(e.unaryFilter.field);return J.create(t,"==",{doubleValue:NaN});case"IS_NULL":const i=yo(e.unaryFilter.field);return J.create(i,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=yo(e.unaryFilter.field);return J.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=yo(e.unaryFilter.field);return J.create(s,"!=",{nullValue:"NULL_VALUE"});default:return U()}}(n):void 0!==n.fieldFilter?J.create(yo((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return U()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return ce.create(e.compositeFilter.filters.map(t=>qp(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return U()}}(e.compositeFilter.op))}(n):U();var e}function ay(n){return J_[n]}function uy(n){return X_[n]}function cy(n){return ey[n]}function _o(n){return{fieldPath:n.canonicalString()}}function yo(n){return ve.fromServerFormat(n.fieldPath)}function Bp(n){return n instanceof J?function(e){if("=="===e.op){if(qh(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NAN"}};if(Bc(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(qh(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NOT_NAN"}};if(Bc(e.value))return{unaryFilter:{field:_o(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:_o(e.field),op:uy(e.op),value:e.value}}}(n):n instanceof ce?function(e){const t=e.getFilters().map(i=>Bp(i));return 1===t.length?t[0]:{compositeFilter:{op:cy(e.op),filters:t}}}(n):U()}function ly(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Zp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function dt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=Gp(e)),e=hy(n.get(t),e);return Gp(e)}function hy(n,e){let t=e;const i=n.length;for(let r=0;r<i;r++){const s=n.charAt(r);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function Gp(n){return n+"\x01\x01"}function xn(n){const e=n.length;if(B(e>=2),2===e)return B("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ee.emptyPath();const t=e-2,i=[];let r="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&U(),n.charAt(u+1)){case"\x01":const d=n.substring(s,u);let f;0===r.length?f=d:(r+=d,f=r,r=""),i.push(f);break;case"\x10":r+=n.substring(s,u),r+="\0";break;case"\x11":r+=n.substring(s,u+1);break;default:U()}s=u+2}return new ee(i)}const zp=["userId","batchId"];function cl(n,e){return[n,dt(e)]}function $p(n,e,t){return[n,dt(e),t]}const dy={},fy=["prefixPath","collectionGroup","readTime","documentId"],py=["prefixPath","collectionGroup","documentId"],my=["collectionGroup","readTime","prefixPath","documentId"],gy=["canonicalId","targetId"],_y=["targetId","path"],yy=["path","targetId"],vy=["collectionId","parent"],Iy=["indexId","uid"],wy=["uid","sequenceNumber"],by=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],Ey=["indexId","uid","orderedDocumentKey"],Ty=["userId","collectionPath","documentId"],xy=["userId","collectionPath","largestBatchId"],ky=["userId","collectionGroup","largestBatchId"],jp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],Ay=[...jp,"documentOverlays"],Wp=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],Kp=Wp,Cy=[...Kp,"indexConfiguration","indexState","indexEntries"];class Jh extends Ks{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function je(n,e){const t=P(n);return Et.M(t.se,e)}class Xh{constructor(e,t,i,r){this.batchId=e,this.localWriteTime=t,this.baseMutations=i,this.mutations=r}applyToRemoteDocument(e,t){const i=t.mutationResults;for(let r=0;r<this.mutations.length;r++){const s=this.mutations[r];s.key.isEqual(e.key)&&Ne(s,e,i[r])}}applyToLocalView(e,t){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(t=Je(i,e,t,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(t=Je(i,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const i=kp();return this.mutations.forEach(r=>{const s=e.get(r.key),u=s.overlayedDocument;let d=this.applyToLocalView(u,s.mutatedFields);d=t.has(r.key)?null:d;const f=z(u,d);null!==f&&i.set(r.key,f),u.isValidDocument()||u.convertToNoDocument(Z.min())}),i}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&vi(this.mutations,e.mutations,(t,i)=>uu(t,i))&&vi(this.baseMutations,e.baseMutations,(t,i)=>uu(t,i))}}class ed{constructor(e,t,i,r){this.batch=e,this.commitVersion=t,this.mutationResults=i,this.docVersions=r}static from(e,t,i){B(e.mutations.length===i.length);let r=K_;const s=e.mutations;for(let u=0;u<s.length;u++)r=r.insert(s[u].key,i[u].version);return new ed(e,t,i,r)}}class td{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ni{constructor(e,t,i,r,s=Z.min(),u=Z.min(),d=Re.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=i,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=d}withSequenceNumber(e){return new Ni(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Ni(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Ni(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class Hp{constructor(e){this.ie=e}}function Qp(n,e){const t=e.key,i={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:ll(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())i.document={name:mu(r=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:go(r,s.version.toTimestamp()),createTime:go(r,s.createTime.toTimestamp())};else if(e.isNoDocument())i.noDocument={path:t.path.toArray(),readTime:Gr(e.version)};else{if(!e.isUnknownDocument())return U();i.unknownDocument={path:t.path.toArray(),version:Gr(e.version)}}var r,s;return i}function ll(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Gr(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function zr(n){const e=new le(n.seconds,n.nanoseconds);return Z.fromTimestamp(e)}function $r(n,e){const t=(e.baseMutations||[]).map(s=>Qh(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const i=e.mutations.map(s=>Qh(n.ie,s)),r=le.fromMillis(e.localWriteTimeMs);return new Xh(e.batchId,r,t,i)}function yu(n){const e=zr(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?zr(n.lastLimboFreeSnapshotVersion):Z.min();let i;var r;return void 0!==n.query.documents?(B(1===(r=n.query).documents.length),i=be(Ci(Mp(r.documents[0])))):i=be(Vp(n.query)),new Ni(i,n.targetId,0,n.lastListenSequenceNumber,e,t,Re.fromBase64String(n.resumeToken))}function Yp(n,e){const t=Gr(e.snapshotVersion),i=Gr(e.lastLimboFreeSnapshotVersion);let r;r=ro(e.target)?Up(n.ie,e.target):Yh(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:an(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:i,query:r}}function nd(n){const e=Vp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?co(e,e.limit,"L"):e}function id(n,e){return new td(e.largestBatchId,Qh(n.ie,e.overlayMutation))}function Jp(n,e){const t=e.path.lastSegment();return[n,dt(e.path.popLast()),t]}function Xp(n,e,t,i){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Gr(i.readTime),documentKey:dt(i.documentKey.path),largestBatchId:i.largestBatchId}}class Dy{getBundleMetadata(e,t){return em(e).get(t).next(i=>{if(i)return{id:(r=i).bundleId,createTime:zr(r.createTime),version:r.version};var r})}saveBundleMetadata(e,t){return em(e).put({bundleId:(i=t).id,createTime:Gr(Oe(i.createTime)),version:i.version});var i}getNamedQuery(e,t){return tm(e).get(t).next(i=>{if(i)return{name:(r=i).name,query:nd(r.bundledQuery),readTime:zr(r.readTime)};var r})}saveNamedQuery(e,t){return tm(e).put({name:(i=t).name,readTime:Gr(Oe(i.readTime)),bundledQuery:i.bundledQuery});var i}}function em(n){return je(n,"bundles")}function tm(n){return je(n,"namedQueries")}class hl{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new hl(e,t.uid||"")}getOverlay(e,t){return vu(e).get(Jp(this.userId,t)).next(i=>i?id(this.yt,i):null)}getOverlays(e,t){const i=En();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){const r=[];return i.forEach((s,u)=>{const d=new td(t,u);r.push(this.oe(e,d))}),b.waitFor(r)}removeOverlaysForBatchId(e,t,i){const r=new Set;t.forEach(u=>r.add(dt(u.getCollectionPath())));const s=[];return r.forEach(u=>{const d=IDBKeyRange.bound([this.userId,u,i],[this.userId,u,i+1],!1,!0);s.push(vu(e).Y("collectionPathOverlayIndex",d))}),b.waitFor(s)}getOverlaysForCollection(e,t,i){const r=En(),s=dt(t),u=IDBKeyRange.bound([this.userId,s,i],[this.userId,s,Number.POSITIVE_INFINITY],!0);return vu(e).W("collectionPathOverlayIndex",u).next(d=>{for(const f of d){const m=id(this.yt,f);r.set(m.getKey(),m)}return r})}getOverlaysForCollectionGroup(e,t,i,r){const s=En();let u;const d=IDBKeyRange.bound([this.userId,t,i],[this.userId,t,Number.POSITIVE_INFINITY],!0);return vu(e).Z({index:"collectionGroupOverlayIndex",range:d},(f,m,g)=>{const y=id(this.yt,m);s.size()<r||y.largestBatchId===u?(s.set(y.getKey(),y),u=y.largestBatchId):g.done()}).next(()=>s)}oe(e,t){return vu(e).put(function(i,r,s){const[u,d,f]=Jp(r,s.mutation.key);return{userId:r,collectionPath:d,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:_u(i.ie,s.mutation)}}(this.yt,this.userId,t))}}function vu(n){return je(n,"documentOverlays")}class jr{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(Ie(e.integerValue));else if("doubleValue"in e){const i=Ie(e.doubleValue);isNaN(i)?this.he(t,13):(this.he(t,15),Pr(i)?t.le(0):t.le(i))}else if("timestampValue"in e){const i=e.timestampValue;this.he(t,20),"string"==typeof i?t.fe(i):(t.fe(`${i.seconds||""}`),t.le(i.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(nn(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const i=e.geoPointValue;this.he(t,45),t.le(i.latitude||0),t.le(i.longitude||0)}else"mapValue"in e?Zc(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):U()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const i=e.fields||{};this.he(t,55);for(const r of Object.keys(i))this.de(r,t),this.ce(i[r],t)}ye(e,t){const i=e.values||[];this.he(t,50);for(const r of i)this.ce(r,t)}me(e,t){this.he(t,37),O.fromName(e).path.forEach(i=>{this.he(t,60),this.pe(i,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function Ry(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function nm(n){const e=64-function(t){let i=0;for(let r=0;r<8;++r){const s=Ry(255&t[r]);if(i+=s,8!==s)break}return i}(n);return Math.ceil(e/8)}jr.Ie=new jr;class Ny{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.Ee(i.value),i=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let i=t.next();for(;!i.done;)this.be(i.value),i=t.next();this.Pe()}ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.Ee(i);else if(i<2048)this.Ee(960|i>>>6),this.Ee(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i);else{const r=t.codePointAt(0);this.Ee(240|r>>>18),this.Ee(128|63&r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r)}}this.Ae()}Ve(e){for(const t of e){const i=t.charCodeAt(0);if(i<128)this.be(i);else if(i<2048)this.be(960|i>>>6),this.be(128|63&i);else if(t<"\ud800"||"\udbff"<t)this.be(480|i>>>12),this.be(128|63&i>>>6),this.be(128|63&i);else{const r=t.codePointAt(0);this.be(240|r>>>18),this.be(128|63&r>>>12),this.be(128|63&r>>>6),this.be(128|63&r)}}this.Pe()}Se(e){const t=this.De(e),i=nm(t);this.Ce(1+i),this.buffer[this.position++]=255&i;for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=255&t[r]}xe(e){const t=this.De(e),i=nm(t);this.Ce(1+i),this.buffer[this.position++]=~(255&i);for(let r=t.length-i;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(r){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,r,!1),new Uint8Array(s.buffer)}(e),i=0!=(128&t[0]);t[0]^=i?255:128;for(let r=1;r<t.length;++r)t[r]^=i?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let i=2*this.buffer.length;i<t&&(i=t);const r=new Uint8Array(i);r.set(this.buffer),this.buffer=r}}class Oy{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class My{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class Iu{constructor(){this.$e=new Ny,this.Be=new Oy(this.$e),this.Le=new My(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Wr{constructor(e,t,i,r){this.indexId=e,this.documentKey=t,this.arrayValue=i,this.directionalValue=r}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,i=new Uint8Array(t);return i.set(this.directionalValue,0),t!==e?i.set([0],this.directionalValue.length):++i[i.length-1],new Wr(this.indexId,this.documentKey,this.arrayValue,i)}}function Oi(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=im(n.arrayValue,e.arrayValue),0!==t?t:(t=im(n.directionalValue,e.directionalValue),0!==t?t:O.comparator(n.documentKey,e.documentKey)))}function im(n,e){for(let t=0;t<n.length&&t<e.length;++t){const i=n[t]-e[t];if(0!==i)return i}return n.length-e.length}class Py{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const i=t;i.isInequality()?this.Qe=i:this.Ge.push(i)}}je(e){B(e.collectionGroup===this.collectionId);const t=Rr(e);if(void 0!==t&&!this.We(t))return!1;const i=Ot(e);let r=0,s=0;for(;r<i.length&&this.We(i[r]);++r);if(r===i.length)return!0;if(void 0!==this.Qe){const u=i[r];if(!this.ze(this.Qe,u)||!this.He(this.Ke[s++],u))return!1;++r}for(;r<i.length;++r){const u=i[r];if(s>=this.Ke.length||!this.He(this.Ke[s++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function rm(n){var e,t;if(B(n instanceof J||n instanceof ce),n instanceof J){if(n instanceof Yc){const r=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>J.create(n.field,"==",s)))||[];return ce.create(r,"or")}return n}const i=n.filters.map(r=>rm(r));return ce.create(i,n.op)}function Ly(n){if(0===n.getFilters().length)return[];const e=od(rm(n));return B(sm(e)),rd(e)||sd(e)?[e]:e.getFilters()}function rd(n){return n instanceof J}function sd(n){return n instanceof ce&&jc(n)}function sm(n){return rd(n)||sd(n)||function(e){if(e instanceof ce&&tu(e)){for(const t of e.getFilters())if(!rd(t)&&!sd(t))return!1;return!0}return!1}(n)}function od(n){if(B(n instanceof J||n instanceof ce),n instanceof J)return n;if(1===n.filters.length)return od(n.filters[0]);const e=n.filters.map(i=>od(i));let t=ce.create(e,n.op);return t=dl(t),sm(t)?t:(B(t instanceof ce),B(xi(t)),B(t.filters.length>1),t.filters.reduce((i,r)=>ad(i,r)))}function ad(n,e){let t;return B(n instanceof J||n instanceof ce),B(e instanceof J||e instanceof ce),t=n instanceof J?e instanceof J?ce.create([n,e],"and"):om(n,e):e instanceof J?om(e,n):function(i,r){if(B(i.filters.length>0&&r.filters.length>0),xi(i)&&xi(r))return Kc(i,r.getFilters());const s=tu(i)?i:r,u=tu(i)?r:i,d=s.filters.map(f=>ad(f,u));return ce.create(d,"or")}(n,e),dl(t)}function om(n,e){if(xi(e))return Kc(e,n.getFilters());{const t=e.filters.map(i=>ad(n,i));return ce.create(t,"or")}}function dl(n){if(B(n instanceof J||n instanceof ce),n instanceof J)return n;const e=n.getFilters();if(1===e.length)return dl(e[0]);if(Wc(n))return n;const t=e.map(r=>dl(r)),i=[];return t.forEach(r=>{r instanceof J?i.push(r):r instanceof ce&&(r.op===n.op?i.push(...r.filters):i.push(r))}),1===i.length?i[0]:ce.create(i,n.op)}class Fy{constructor(){this.Je=new ud}addToCollectionParentIndex(e,t){return this.Je.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(st.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(st.min())}updateCollectionGroup(e,t,i){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class ud{constructor(){this.index={}}add(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t]||new oe(ee.comparator),s=!r.has(i);return this.index[t]=r.add(i),s}has(e){const t=e.lastSegment(),i=e.popLast(),r=this.index[t];return r&&r.has(i)}getEntries(e){return(this.index[e]||new oe(ee.comparator)).toArray()}}const fl=new Uint8Array(0);class Uy{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new ud,this.Xe=new Ri(i=>an(i),(i,r)=>ki(i,r)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const i=t.lastSegment(),r=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:i,parent:dt(r)};return am(e).put(s)}return b.resolve()}getCollectionParents(e,t){const i=[],r=IDBKeyRange.bound([t,""],[Pc(t),""],!1,!0);return am(e).W(r).next(s=>{for(const u of s){if(u.collectionId!==t)break;i.push(xn(u.parent))}return i})}addFieldIndex(e,t){const i=pl(e),r={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(d=>[d.fieldPath.canonicalString(),d.kind])};var u;delete r.indexId;const s=i.add(r);if(t.indexState){const u=bu(e);return s.next(d=>{u.put(Xp(d,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const i=pl(e),r=bu(e),s=wu(e);return i.delete(t.indexId).next(()=>r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const i=wu(e);let r=!0;const s=new Map;return b.forEach(this.Ze(t),u=>this.tn(e,u).next(d=>{r&&(r=!!d),s.set(u,d)})).next(()=>{if(r){let u=H();const d=[];return b.forEach(s,(f,m)=>{var g;R("IndexedDbIndexManager",`Using index ${g=f,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(ne=>`${ne.fieldPath}:${ne.kind}`).join(",")}`} to execute ${an(t)}`);const y=function(ne,Q){const K=Rr(Q);if(void 0===K)return null;for(const X of Ai(ne,K.fieldPath))switch(X.op){case"array-contains-any":return X.value.arrayValue.values||[];case"array-contains":return[X.value]}return null}(m,f),w=function(ne,Q){const K=new Map;for(const X of Ot(Q))for(const Ge of Ai(ne,X.fieldPath))switch(Ge.op){case"==":case"in":K.set(X.fieldPath.canonicalString(),Ge.value);break;case"not-in":case"!=":return K.set(X.fieldPath.canonicalString(),Ge.value),Array.from(K.values())}return null}(m,f),k=function(ne,Q){const K=[];let X=!0;for(const Ge of Ot(Q)){const qu=0===Ge.kind?tl(ne,Ge.fieldPath,ne.startAt):ot(ne,Ge.fieldPath,ne.startAt);K.push(qu.value),X&&(X=qu.inclusive)}return new wn(K,X)}(m,f),S=function(ne,Q){const K=[];let X=!0;for(const Ge of Ot(Q)){const qu=0===Ge.kind?ot(ne,Ge.fieldPath,ne.endAt):tl(ne,Ge.fieldPath,ne.endAt);K.push(qu.value),X&&(X=qu.inclusive)}return new wn(K,X)}(m,f),M=this.en(f,m,k),V=this.en(f,m,S),ae=this.nn(f,m,w),he=this.sn(f.indexId,y,M,k.inclusive,V,S.inclusive,ae);return b.forEach(he,ne=>i.J(ne,t.limit).next(Q=>{Q.forEach(K=>{const X=O.fromSegments(K.documentKey);u.has(X)||(u=u.add(X),d.push(X))})}))}).next(()=>d)}return b.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:Ly(ce.create(e.filters,"and")).map(i=>Ur(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,i,r,s,u,d){const f=(null!=t?t.length:1)*Math.max(i.length,s.length),m=f/(null!=t?t.length:1),g=[];for(let y=0;y<f;++y){const w=t?this.rn(t[y/m]):fl,k=this.on(e,w,i[y%m],r),S=this.un(e,w,s[y%m],u),M=d.map(V=>this.on(e,w,V,!0));g.push(...this.createRange(k,S,M))}return g}on(e,t,i,r){const s=new Wr(e,O.empty(),t,i);return r?s:s.Ue()}un(e,t,i,r){const s=new Wr(e,O.empty(),t,i);return r?s.Ue():s}tn(e,t){const i=new Py(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next(s=>{let u=null;for(const d of s)i.je(d)&&(!u||d.fields.length>u.fields.length)&&(u=d);return u})}getIndexType(e,t){let i=2;const r=this.Ze(t);return b.forEach(r,s=>this.tn(e,s).next(u=>{u?0!==i&&u.fields.length<function(d){let f=new oe(ve.comparator),m=!1;for(const g of d.filters)for(const y of g.getFlattenedFilters())y.field.isKeyField()||("array-contains"===y.op||"array-contains-any"===y.op?m=!0:f=f.add(y.field));for(const g of d.orderBy)g.field.isKeyField()||(f=f.add(g.field));return f.size+(m?1:0)}(s)&&(i=1):i=0})).next(()=>null!==t.limit&&r.length>1&&2===i?1:i)}cn(e,t){const i=new Iu;for(const r of Ot(e)){const s=t.data.field(r.fieldPath);if(null==s)return null;const u=i.qe(r.kind);jr.Ie.ue(s,u)}return i.Fe()}rn(e){const t=new Iu;return jr.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const i=new Iu;return jr.Ie.ue(zn(this.databaseId,t),i.qe(function(r){const s=Ot(r);return 0===s.length?0:s[s.length-1].kind}(e))),i.Fe()}nn(e,t,i){if(null===i)return[];let r=[];r.push(new Iu);let s=0;for(const u of Ot(e)){const d=i[s++];for(const f of r)if(this.hn(t,u.fieldPath)&&Ti(d))r=this.ln(r,u,d);else{const m=f.qe(u.kind);jr.Ie.ue(d,m)}}return this.fn(r)}en(e,t,i){return this.nn(e,t,i.position)}fn(e){const t=[];for(let i=0;i<e.length;++i)t[i]=e[i].Fe();return t}ln(e,t,i){const r=[...e],s=[];for(const u of i.arrayValue.values||[])for(const d of r){const f=new Iu;f.seed(d.Fe()),jr.Ie.ue(u,f.qe(t.kind)),s.push(f)}return s}hn(e,t){return!!e.filters.find(i=>i instanceof J&&i.field.isEqual(t)&&("in"===i.op||"not-in"===i.op))}getFieldIndexes(e,t){const i=pl(e),r=bu(e);return(t?i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):i.W()).next(s=>{const u=[];return b.forEach(s,d=>r.get([d.indexId,this.uid]).next(f=>{u.push(function(m,g){const y=g?new Or(g.sequenceNumber,new st(zr(g.readTime),new O(xn(g.documentKey)),g.largestBatchId)):Or.empty(),w=m.fields.map(([k,S])=>new Nr(ve.fromServerFormat(k),S));return new Ws(m.indexId,m.collectionGroup,w,y)}(d,f))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((i,r)=>{const s=i.indexState.sequenceNumber-r.indexState.sequenceNumber;return 0!==s?s:W(i.collectionGroup,r.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,i){const r=pl(e),s=bu(e);return this.dn(e).next(u=>r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(d=>b.forEach(d,f=>s.put(Xp(f.indexId,this.user,u,i)))))}updateIndexEntries(e,t){const i=new Map;return b.forEach(t,(r,s)=>{const u=i.get(r.collectionGroup);return(u?b.resolve(u):this.getFieldIndexes(e,r.collectionGroup)).next(d=>(i.set(r.collectionGroup,d),b.forEach(d,f=>this._n(e,r,f).next(m=>{const g=this.wn(s,f);return m.isEqual(g)?b.resolve():this.mn(e,s,f,m,g)}))))})}gn(e,t,i,r){return wu(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.an(i,t.key),documentKey:t.key.path.toArray()})}yn(e,t,i,r){return wu(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.an(i,t.key),t.key.path.toArray()])}_n(e,t,i){const r=wu(e);let s=new oe(Oi);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([i.indexId,this.uid,this.an(i,t)])},(u,d)=>{s=s.add(new Wr(i.indexId,t,d.arrayValue,d.directionalValue))}).next(()=>s)}wn(e,t){let i=new oe(Oi);const r=this.cn(t,e);if(null==r)return i;const s=Rr(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Ti(u))for(const d of u.arrayValue.values||[])i=i.add(new Wr(t.indexId,e.key,this.rn(d),r))}else i=i.add(new Wr(t.indexId,e.key,fl,r));return i}mn(e,t,i,r,s){R("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(d,f,m,g,y){const w=d.getIterator(),k=f.getIterator();let S=jn(w),M=jn(k);for(;S||M;){let V=!1,ae=!1;if(S&&M){const he=m(S,M);he<0?ae=!0:he>0&&(V=!0)}else null!=S?ae=!0:V=!0;V?(g(M),M=jn(k)):ae?(y(S),S=jn(w)):(S=jn(w),M=jn(k))}}(r,s,Oi,d=>{u.push(this.gn(e,t,i,d))},d=>{u.push(this.yn(e,t,i,d))}),b.waitFor(u)}dn(e){let t=1;return bu(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,r,s)=>{s.done(),t=r.sequenceNumber+1}).next(()=>t)}createRange(e,t,i){i=i.sort((u,d)=>Oi(u,d)).filter((u,d,f)=>!d||0!==Oi(u,f[d-1]));const r=[];r.push(e);for(const u of i){const d=Oi(u,e),f=Oi(u,t);if(0===d)r[0]=e.Ue();else if(d>0&&f<0)r.push(u),r.push(u.Ue());else if(f>0)break}r.push(t);const s=[];for(let u=0;u<r.length;u+=2){if(this.pn(r[u],r[u+1]))return[];s.push(IDBKeyRange.bound([r[u].indexId,this.uid,r[u].arrayValue,r[u].directionalValue,fl,[]],[r[u+1].indexId,this.uid,r[u+1].arrayValue,r[u+1].directionalValue,fl,[]]))}return s}pn(e,t){return Oi(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(um)}getMinOffset(e,t){return b.mapArray(this.Ze(t),i=>this.tn(e,i).next(r=>r||U())).next(um)}}function am(n){return je(n,"collectionParents")}function wu(n){return je(n,"indexEntries")}function pl(n){return je(n,"indexConfiguration")}function bu(n){return je(n,"indexState")}function um(n){B(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let i=1;i<n.length;i++){const r=n[i].indexState.offset;Wa(r,e)<0&&(e=r),t<r.largestBatchId&&(t=r.largestBatchId)}return new st(e.readTime,e.documentKey,t)}const cm={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class It{constructor(e,t,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=i}static withCacheSize(e){return new It(e,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function lm(n,e,t){const i=n.store("mutations"),r=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let d=0;const f=i.Z({range:u},(g,y,w)=>(d++,w.delete()));s.push(f.next(()=>{B(1===d)}));const m=[];for(const g of t.mutations){const y=$p(e,g.key.path,t.batchId);s.push(r.delete(y)),m.push(g.key)}return b.waitFor(s).next(()=>m)}function ml(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw U();e=n.noDocument}return JSON.stringify(e).length}It.DEFAULT_COLLECTION_PERCENTILE=10,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,It.DEFAULT=new It(41943040,It.DEFAULT_COLLECTION_PERCENTILE,It.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),It.DISABLED=new It(-1,0,0);class gl{constructor(e,t,i,r){this.userId=e,this.yt=t,this.indexManager=i,this.referenceDelegate=r,this.In={}}static re(e,t,i,r){B(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new gl(s,t,i,r)}checkEmpty(e){let t=!0;const i=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).Z({index:"userMutationsIndex",range:i},(r,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,i,r){const s=vo(e),u=Mi(e);return u.add({}).next(d=>{B("number"==typeof d);const f=new Xh(d,t,i,r),m=function(w,k,S){const M=S.baseMutations.map(ae=>_u(w.ie,ae)),V=S.mutations.map(ae=>_u(w.ie,ae));return{userId:k,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:M,mutations:V}}(this.yt,this.userId,f),g=[];let y=new oe((w,k)=>W(w.canonicalString(),k.canonicalString()));for(const w of r){const k=$p(this.userId,w.key.path,d);y=y.add(w.key.path.popLast()),g.push(u.put(m)),g.push(s.put(k,dy))}return y.forEach(w=>{g.push(this.indexManager.addToCollectionParentIndex(e,w))}),e.addOnCommittedListener(()=>{this.In[d]=f.keys()}),b.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return Mi(e).get(t).next(i=>i?(B(i.userId===this.userId),$r(this.yt,i)):null)}Tn(e,t){return this.In[t]?b.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(i=>{if(i){const r=i.keys();return this.In[t]=r,r}return null})}getNextMutationBatchAfterBatchId(e,t){const i=t+1,r=IDBKeyRange.lowerBound([this.userId,i]);let s=null;return Mi(e).Z({index:"userMutationsIndex",range:r},(u,d,f)=>{d.userId===this.userId&&(B(d.batchId>=i),s=$r(this.yt,d)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let i=-1;return Mi(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(r,s,u)=>{i=s.batchId,u.done()}).next(()=>i)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Mi(e).W("userMutationsIndex",t).next(i=>i.map(r=>$r(this.yt,r)))}getAllMutationBatchesAffectingDocumentKey(e,t){const i=cl(this.userId,t.path),r=IDBKeyRange.lowerBound(i),s=[];return vo(e).Z({range:r},(u,d,f)=>{const[m,g,y]=u,w=xn(g);if(m===this.userId&&t.path.isEqual(w))return Mi(e).get(y).next(k=>{if(!k)throw U();B(k.userId===this.userId),s.push($r(this.yt,k))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new oe(W);const r=[];return t.forEach(s=>{const u=cl(this.userId,s.path),d=IDBKeyRange.lowerBound(u),f=vo(e).Z({range:d},(m,g,y)=>{const[w,k,S]=m,M=xn(k);w===this.userId&&s.path.isEqual(M)?i=i.add(S):y.done()});r.push(f)}),b.waitFor(r).next(()=>this.En(e,i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1,s=cl(this.userId,i),u=IDBKeyRange.lowerBound(s);let d=new oe(W);return vo(e).Z({range:u},(f,m,g)=>{const[y,w,k]=f,S=xn(w);y===this.userId&&i.isPrefixOf(S)?S.length===r&&(d=d.add(k)):g.done()}).next(()=>this.En(e,d))}En(e,t){const i=[],r=[];return t.forEach(s=>{r.push(Mi(e).get(s).next(u=>{if(null===u)throw U();B(u.userId===this.userId),i.push($r(this.yt,u))}))}),b.waitFor(r).next(()=>i)}removeMutationBatch(e,t){return lm(e.se,this.userId,t).next(i=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),b.forEach(i,r=>this.referenceDelegate.markPotentiallyOrphaned(e,r))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();const i=IDBKeyRange.lowerBound([this.userId]),r=[];return vo(e).Z({range:i},(s,u,d)=>{if(s[0]===this.userId){const f=xn(s[1]);r.push(f)}else d.done()}).next(()=>{B(0===r.length)})})}containsKey(e,t){return hm(e,this.userId,t)}Rn(e){return dm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function hm(n,e,t){const i=cl(e,t.path),r=i[1],s=IDBKeyRange.lowerBound(i);let u=!1;return vo(n).Z({range:s,X:!0},(d,f,m)=>{const[g,y,w]=d;g===e&&y===r&&(u=!0),m.done()}).next(()=>u)}function Mi(n){return je(n,"mutations")}function vo(n){return je(n,"documentMutations")}function dm(n){return je(n,"mutationQueues")}class Kr{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Kr(0)}static vn(){return new Kr(-1)}}class Vy{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const i=new Kr(t.highestTargetId);return t.highestTargetId=i.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>Z.fromTimestamp(new le(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,i){return this.Vn(e).next(r=>(r.highestListenSequenceNumber=t,i&&(r.lastRemoteSnapshotVersion=i.toTimestamp()),t>r.highestListenSequenceNumber&&(r.highestListenSequenceNumber=t),this.Sn(e,r)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(i=>(i.targetCount+=1,this.Cn(t,i),this.Sn(e,i))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Io(e).delete(t.targetId)).next(()=>this.Vn(e)).next(i=>(B(i.targetCount>0),i.targetCount-=1,this.Sn(e,i)))}removeTargets(e,t,i){let r=0;const s=[];return Io(e).Z((u,d)=>{const f=yu(d);f.sequenceNumber<=t&&null===i.get(f.targetId)&&(r++,s.push(this.removeTargetData(e,f)))}).next(()=>b.waitFor(s)).next(()=>r)}forEachTarget(e,t){return Io(e).Z((i,r)=>{const s=yu(r);t(s)})}Vn(e){return fm(e).get("targetGlobalKey").next(t=>(B(null!==t),t))}Sn(e,t){return fm(e).put("targetGlobalKey",t)}Dn(e,t){return Io(e).put(Yp(this.yt,t))}Cn(e,t){let i=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,i=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,i=!0),i}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const i=an(t),r=IDBKeyRange.bound([i,Number.NEGATIVE_INFINITY],[i,Number.POSITIVE_INFINITY]);let s=null;return Io(e).Z({range:r,index:"queryTargetsIndex"},(u,d,f)=>{const m=yu(d);ki(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,i){const r=[],s=Pi(e);return t.forEach(u=>{const d=dt(u.path);r.push(s.put({targetId:i,path:d})),r.push(this.referenceDelegate.addReference(e,i,u))}),b.waitFor(r)}removeMatchingKeys(e,t,i){const r=Pi(e);return b.forEach(t,s=>{const u=dt(s.path);return b.waitFor([r.delete([i,u]),this.referenceDelegate.removeReference(e,i,s)])})}removeMatchingKeysForTargetId(e,t){const i=Pi(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return i.delete(r)}getMatchingKeysForTargetId(e,t){const i=IDBKeyRange.bound([t],[t+1],!1,!0),r=Pi(e);let s=H();return r.Z({range:i,X:!0},(u,d,f)=>{const m=xn(u[1]),g=new O(m);s=s.add(g)}).next(()=>s)}containsKey(e,t){const i=dt(t.path),r=IDBKeyRange.bound([i],[Pc(i)],!1,!0);let s=0;return Pi(e).Z({index:"documentTargetsIndex",X:!0,range:r},([u,d],f,m)=>{0!==u&&(s++,m.done())}).next(()=>s>0)}ne(e,t){return Io(e).get(t).next(i=>i?yu(i):null)}}function Io(n){return je(n,"targets")}function fm(n){return je(n,"targetGlobal")}function Pi(n){return je(n,"targetDocuments")}function pm([n,e],[t,i]){const r=W(n,t);return 0===r?W(e,i):r}class qy{constructor(e){this.xn=e,this.buffer=new oe(pm),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const i=this.buffer.last();pm(t,i)<0&&(this.buffer=this.buffer.delete(i).add(t))}}get maxValue(){return this.buffer.last()[0]}}class By{constructor(e,t,i){this.garbageCollector=e,this.asyncQueue=t,this.localStore=i,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;R("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,x.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(i){yn(i)?R("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",i):yield _n(i)}yield t.Fn(3e5)}))}}class Zy{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(i=>Math.floor(t/100*i))}nthSequenceNumber(e,t){if(0===t)return b.resolve(ct.at);const i=new qy(t);return this.$n.forEachTarget(e,r=>i.On(r.sequenceNumber)).next(()=>this.$n.Ln(e,r=>i.On(r))).next(()=>i.maxValue)}removeTargets(e,t,i){return this.$n.removeTargets(e,t,i)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(cm)):this.getCacheSize(e).next(i=>i<this.params.cacheSizeCollectionThreshold?(R("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cm):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let i,r,s,u,d,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(y=>(y>this.params.maximumSequenceNumbersToCollect?(R("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${y}`),r=this.params.maximumSequenceNumbersToCollect):r=y,u=Date.now(),this.nthSequenceNumber(e,r))).next(y=>(i=y,d=Date.now(),this.removeTargets(e,i,t))).next(y=>(s=y,f=Date.now(),this.removeOrphanedDocuments(e,i))).next(y=>(m=Date.now(),Cr()<=At.in.DEBUG&&R("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${r} in `+(d-u)+`ms\n\tRemoved ${s} targets in `+(f-d)+`ms\n\tRemoved ${y} documents in `+(m-f)+`ms\nTotal Duration: ${m-g}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:s,documentsRemoved:y})))}}class Gy{constructor(e,t){this.db=e,this.garbageCollector=new Zy(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(r=>i+r))}Un(e){let t=0;return this.Ln(e,i=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(i,r)=>t(r))}addReference(e,t,i){return _l(e,i)}removeReference(e,t,i){return _l(e,i)}removeTargets(e,t,i){return this.db.getTargetCache().removeTargets(e,t,i)}markPotentiallyOrphaned(e,t){return _l(e,t)}Gn(e,t){return function(i,r){let s=!1;return dm(i).tt(u=>hm(i,u,r).next(d=>(d&&(s=!0),b.resolve(!d)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const i=this.db.getRemoteDocumentCache().newChangeBuffer(),r=[];let s=0;return this.Kn(e,(u,d)=>{if(d<=t){const f=this.Gn(e,u).next(m=>{if(!m)return s++,i.getEntry(e,u).next(()=>(i.removeEntry(u,Z.min()),Pi(e).delete([0,dt(u.path)])))});r.push(f)}}).next(()=>b.waitFor(r)).next(()=>i.apply(e)).next(()=>s)}removeTarget(e,t){const i=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,i)}updateLimboDocument(e,t){return _l(e,t)}Kn(e,t){const i=Pi(e);let r,s=ct.at;return i.Z({index:"documentTargetsIndex"},([u,d],{path:f,sequenceNumber:m})=>{0===u?(s!==ct.at&&t(new O(xn(r)),s),s=m,r=f):s=ct.at}).next(()=>{s!==ct.at&&t(new O(xn(r)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function _l(n,e){return Pi(n).put((i=n.currentSequenceNumber,{targetId:0,path:dt(e.path),sequenceNumber:i}));var i}class mm{constructor(){this.changes=new Ri(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,de.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const i=this.changes.get(t);return void 0!==i?b.resolve(i):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class zy{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,i){return Hr(e).put(i)}removeEntry(e,t,i){return Hr(e).delete(function(r,s){const u=r.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],ll(s),u[u.length-1]]}(t,i))}updateMetadata(e,t){return this.getMetadata(e).next(i=>(i.byteSize+=t,this.Qn(e,i)))}getEntry(e,t){let i=de.newInvalidDocument(t);return Hr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Eu(t))},(r,s)=>{i=this.jn(t,s)}).next(()=>i)}Wn(e,t){let i={size:0,document:de.newInvalidDocument(t)};return Hr(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Eu(t))},(r,s)=>{i={document:this.jn(t,s),size:ml(s)}}).next(()=>i)}getEntries(e,t){let i=vt();return this.zn(e,t,(r,s)=>{const u=this.jn(r,s);i=i.insert(r,u)}).next(()=>i)}Hn(e,t){let i=vt(),r=new we(O.comparator);return this.zn(e,t,(s,u)=>{const d=this.jn(s,u);i=i.insert(s,d),r=r.insert(s,ml(u))}).next(()=>({documents:i,Jn:r}))}zn(e,t,i){if(t.isEmpty())return b.resolve();let r=new oe(vm);t.forEach(f=>r=r.add(f));const s=IDBKeyRange.bound(Eu(r.first()),Eu(r.last())),u=r.getIterator();let d=u.getNext();return Hr(e).Z({index:"documentKeyIndex",range:s},(f,m,g)=>{const y=O.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;d&&vm(d,y)<0;)i(d,null),d=u.getNext();d&&d.isEqual(y)&&(i(d,m),d=u.hasNext()?u.getNext():null),d?g.j(Eu(d)):g.done()}).next(()=>{for(;d;)i(d,null),d=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,i){const r=[t.popLast().toArray(),t.lastSegment(),ll(i.readTime),i.documentKey.path.isEmpty()?"":i.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Hr(e).W(IDBKeyRange.bound(r,s,!0)).next(u=>{let d=vt();for(const f of u){const m=this.jn(O.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);d=d.insert(m.key,m)}return d})}getAllFromCollectionGroup(e,t,i,r){let s=vt();const u=ym(t,i),d=ym(t,st.max());return Hr(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,d,!0)},(f,m,g)=>{const y=this.jn(O.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(y.key,y),s.size===r&&g.done()}).next(()=>s)}newChangeBuffer(e){return new $y(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _m(e).get("remoteDocumentGlobalKey").next(t=>(B(!!t),t))}Qn(e,t){return _m(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const i=function Sy(n,e){let t;if(e.document)t=Fp(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const i=O.fromSegments(e.noDocument.path),r=zr(e.noDocument.readTime);t=de.newNoDocument(i,r),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return U();{const i=O.fromSegments(e.unknownDocument.path),r=zr(e.unknownDocument.version);t=de.newUnknownDocument(i,r)}}return e.readTime&&t.setReadTime(function(i){const r=new le(i[0],i[1]);return Z.fromTimestamp(r)}(e.readTime)),t}(this.yt,t);if(!i.isNoDocument()||!i.version.isEqual(Z.min()))return i}return de.newInvalidDocument(e)}}function gm(n){return new zy(n)}class $y extends mm{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new Ri(i=>i.toString(),(i,r)=>i.isEqual(r))}applyChanges(e){const t=[];let i=0,r=new oe((s,u)=>W(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const d=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,d.readTime)),u.isValidDocument()){const f=Qp(this.Yn.yt,u);r=r.add(s.path.popLast()),i+=ml(f)-d.size,t.push(this.Yn.addEntry(e,s,f))}else if(i-=d.size,this.trackRemovals){const f=Qp(this.Yn.yt,u.convertToNoDocument(Z.min()));t.push(this.Yn.addEntry(e,s,f))}}),r.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,i)),b.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(i=>(this.Xn.set(t,{size:i.size,readTime:i.document.readTime}),i.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:i,Jn:r})=>(r.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:i.get(s).readTime})}),i))}}function _m(n){return je(n,"remoteDocumentGlobal")}function Hr(n){return je(n,"remoteDocumentsV14")}function Eu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function ym(n,e){const t=e.documentKey.path.toArray();return[n,ll(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function vm(n,e){const t=n.path.toArray(),i=e.path.toArray();let r=0;for(let s=0;s<t.length-2&&s<i.length-2;++s)if(r=W(t[s],i[s]),r)return r;return r=W(t.length,i.length),r||(r=W(t[t.length-2],i[i.length-2]),r||W(t[t.length-1],i[i.length-1]))}class jy{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Im{constructor(e,t,i,r){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=i,this.indexManager=r}getDocument(e,t){let i=null;return this.documentOverlayCache.getOverlay(e,t).next(r=>(i=r,this.remoteDocumentCache.getEntry(e,t))).next(r=>(null!==i&&Je(i.mutation,r,lt.empty(),le.now()),r))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.getLocalViewOfDocuments(e,i,H()).next(()=>i))}getLocalViewOfDocuments(e,t,i=H()){const r=En();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,i).next(s=>{let u=hu();return s.forEach((d,f)=>{u=u.insert(d,f.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const i=En();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,H()))}populateOverlays(e,t,i){const r=[];return i.forEach(s=>{t.has(s)||r.push(s)}),this.documentOverlayCache.getOverlays(e,r).next(s=>{s.forEach((u,d)=>{t.set(u,d)})})}computeViews(e,t,i,r){let s=vt();const u=du(),d=du();return t.forEach((f,m)=>{const g=i.get(m.key);r.has(m.key)&&(void 0===g||g.mutation instanceof Ft)?s=s.insert(m.key,m):void 0!==g&&(u.set(m.key,g.mutation.getFieldMask()),Je(g.mutation,m,g.mutation.getFieldMask(),le.now()))}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,g)=>u.set(m,g)),t.forEach((m,g)=>{var y;return d.set(m,new jy(g,null!==(y=u.get(m))&&void 0!==y?y:null))}),d))}recalculateAndSaveOverlays(e,t){const i=du();let r=new we((u,d)=>u-d),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const d of u)d.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let g=i.get(f)||lt.empty();g=d.applyToLocalView(m,g),i.set(f,g);const y=(r.get(d.batchId)||H()).add(f);r=r.insert(d.batchId,y)})}).next(()=>{const u=[],d=r.getReverseIterator();for(;d.hasNext();){const f=d.getNext(),m=f.key,g=f.value,y=kp();g.forEach(w=>{if(!s.has(w)){const k=z(t.get(w),i.get(w));null!==k&&y.set(w,k),s=s.add(w)}}),u.push(this.documentOverlayCache.saveOverlays(e,m,y))}return b.waitFor(u)}).next(()=>i)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(i=>this.recalculateAndSaveOverlays(e,i))}getDocumentsMatchingQuery(e,t,i){return O.isDocumentKey((r=t).path)&&null===r.collectionGroup&&0===r.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):ao(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,i):this.getDocumentsMatchingCollectionQuery(e,t,i);var r}getNextDocuments(e,t,i,r){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,i,r).next(s=>{const u=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,i.largestBatchId,r-s.size):b.resolve(En());let d=-1,f=s;return u.next(m=>b.forEach(m,(g,y)=>(d<y.largestBatchId&&(d=y.largestBatchId),s.get(g)?b.resolve():this.remoteDocumentCache.getEntry(e,g).next(w=>{f=f.insert(g,w)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,H())).next(g=>({batchId:d,changes:xp(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(i=>{let r=hu();return i.isFoundDocument()&&(r=r.insert(i.key,i)),r})}getDocumentsMatchingCollectionGroupQuery(e,t,i){const r=t.collectionGroup;let s=hu();return this.indexManager.getCollectionParents(e,r).next(u=>b.forEach(u,d=>{const f=(m=t,g=d.child(r),new ht(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,g;return this.getDocumentsMatchingCollectionQuery(e,f,i).next(m=>{m.forEach((g,y)=>{s=s.insert(g,y)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,i){let r;return this.remoteDocumentCache.getAllFromCollection(e,t.path,i).next(s=>(r=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,i.largestBatchId))).next(s=>{s.forEach((d,f)=>{const m=f.getKey();null===r.get(m)&&(r=r.insert(m,de.newInvalidDocument(m)))});let u=hu();return r.forEach((d,f)=>{const m=s.get(d);void 0!==m&&Je(m.mutation,f,lt.empty(),le.now()),$e(t,f)&&(u=u.insert(d,f))}),u})}}class Wy{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return b.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var i;return this.Zn.set(t.id,{id:(i=t).id,version:i.version,createTime:Oe(i.createTime)}),b.resolve()}getNamedQuery(e,t){return b.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(i=t).name,query:nd(i.bundledQuery),readTime:Oe(i.readTime)}),b.resolve();var i}}class Ky{constructor(){this.overlays=new we(O.comparator),this.es=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const i=En();return b.forEach(t,r=>this.getOverlay(e,r).next(s=>{null!==s&&i.set(r,s)})).next(()=>i)}saveOverlays(e,t,i){return i.forEach((r,s)=>{this.oe(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,i){const r=this.es.get(i);return void 0!==r&&(r.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(i)),b.resolve()}getOverlaysForCollection(e,t,i){const r=En(),s=t.length+1,u=new O(t.child("")),d=this.overlays.getIteratorFrom(u);for(;d.hasNext();){const f=d.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>i&&r.set(f.getKey(),f)}return b.resolve(r)}getOverlaysForCollectionGroup(e,t,i,r){let s=new we((m,g)=>m-g);const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>i){let g=s.get(m.largestBatchId);null===g&&(g=En(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const d=En(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,g)=>d.set(m,g)),!(d.size()>=r)););return b.resolve(d)}oe(e,t,i){const r=this.overlays.get(i.key);if(null!==r){const u=this.es.get(r.largestBatchId).delete(i.key);this.es.set(r.largestBatchId,u)}this.overlays=this.overlays.insert(i.key,new td(t,i));let s=this.es.get(t);void 0===s&&(s=H(),this.es.set(t,s)),this.es.set(t,s.add(i.key))}}class cd{constructor(){this.ns=new oe(We.ss),this.rs=new oe(We.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const i=new We(e,t);this.ns=this.ns.add(i),this.rs=this.rs.add(i)}us(e,t){e.forEach(i=>this.addReference(i,t))}removeReference(e,t){this.cs(new We(e,t))}hs(e,t){e.forEach(i=>this.removeReference(i,t))}ls(e){const t=new O(new ee([])),i=new We(t,e),r=new We(t,e+1),s=[];return this.rs.forEachInRange([i,r],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new O(new ee([])),i=new We(t,e),r=new We(t,e+1);let s=H();return this.rs.forEachInRange([i,r],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new We(e,0),i=this.ns.firstAfterOrEqual(t);return null!==i&&e.isEqual(i.key)}}class We{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return O.comparator(e.key,t.key)||W(e._s,t._s)}static os(e,t){return W(e._s,t._s)||O.comparator(e.key,t.key)}}class Hy{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new oe(We.ss)}checkEmpty(e){return b.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,i,r){const s=this.ws;this.ws++;const u=new Xh(s,t,i,r);this.mutationQueue.push(u);for(const d of r)this.gs=this.gs.add(new We(d.key,s)),this.indexManager.addToCollectionParentIndex(e,d.key.path.popLast());return b.resolve(u)}lookupMutationBatch(e,t){return b.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const r=this.ps(t+1),s=r<0?0:r;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const i=new We(t,0),r=new We(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([i,r],u=>{const d=this.ys(u._s);s.push(d)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let i=new oe(W);return t.forEach(r=>{const s=new We(r,0),u=new We(r,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],d=>{i=i.add(d._s)})}),b.resolve(this.Is(i))}getAllMutationBatchesAffectingQuery(e,t){const i=t.path,r=i.length+1;let s=i;O.isDocumentKey(s)||(s=s.child(""));const u=new We(new O(s),0);let d=new oe(W);return this.gs.forEachWhile(f=>{const m=f.key.path;return!!i.isPrefixOf(m)&&(m.length===r&&(d=d.add(f._s)),!0)},u),b.resolve(this.Is(d))}Is(e){const t=[];return e.forEach(i=>{const r=this.ys(i);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){B(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let i=this.gs;return b.forEach(t.mutations,r=>{const s=new We(r.key,t.batchId);return i=i.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,r.key)}).next(()=>{this.gs=i})}An(e){}containsKey(e,t){const i=new We(t,0),r=this.gs.firstAfterOrEqual(i);return b.resolve(t.isEqual(r&&r.key))}performConsistencyCheck(e){return b.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class Qy{constructor(e){this.Es=e,this.docs=new we(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const i=t.key,r=this.docs.get(i),s=r?r.size:0,u=this.Es(t);return this.docs=this.docs.insert(i,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const i=this.docs.get(t);return b.resolve(i?i.document.mutableCopy():de.newInvalidDocument(t))}getEntries(e,t){let i=vt();return t.forEach(r=>{const s=this.docs.get(r);i=i.insert(r,s?s.document.mutableCopy():de.newInvalidDocument(r))}),b.resolve(i)}getAllFromCollection(e,t,i){let r=vt();const s=new O(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:d,value:{document:f}}=u.getNext();if(!t.isPrefixOf(d.path))break;d.path.length>t.length+1||Wa(ja(f),i)<=0||(r=r.insert(f.key,f.mutableCopy()))}return b.resolve(r)}getAllFromCollectionGroup(e,t,i,r){U()}As(e,t){return b.forEach(this.docs,i=>t(i))}newChangeBuffer(e){return new Yy(this)}getSize(e){return b.resolve(this.size)}}class Yy extends mm{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((i,r)=>{r.isValidDocument()?t.push(this.Yn.addEntry(e,r)):this.Yn.removeEntry(i)}),b.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class Jy{constructor(e){this.persistence=e,this.Rs=new Ri(t=>an(t),ki),this.lastRemoteSnapshotVersion=Z.min(),this.highestTargetId=0,this.bs=0,this.Ps=new cd,this.targetCount=0,this.vs=Kr.Pn()}forEachTarget(e,t){return this.Rs.forEach((i,r)=>t(r)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,i){return i&&(this.lastRemoteSnapshotVersion=i),t>this.bs&&(this.bs=t),b.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Kr(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Dn(t),b.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,i){let r=0;const s=[];return this.Rs.forEach((u,d)=>{d.sequenceNumber<=t&&null===i.get(d.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,d.targetId)),r++)}),b.waitFor(s).next(()=>r)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const i=this.Rs.get(t)||null;return b.resolve(i)}addMatchingKeys(e,t,i){return this.Ps.us(t,i),b.resolve()}removeMatchingKeys(e,t,i){this.Ps.hs(t,i);const r=this.persistence.referenceDelegate,s=[];return r&&t.forEach(u=>{s.push(r.markPotentiallyOrphaned(e,u))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),b.resolve()}getMatchingKeysForTargetId(e,t){const i=this.Ps.ds(t);return b.resolve(i)}containsKey(e,t){return b.resolve(this.Ps.containsKey(t))}}class wm{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ct(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new Jy(this),this.indexManager=new Fy,this.remoteDocumentCache=new Qy(i=>this.referenceDelegate.xs(i)),this.yt=new Hp(t),this.Ns=new Wy(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ky,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let i=this.Vs[e.toKey()];return i||(i=new Hy(t,this.referenceDelegate),this.Vs[e.toKey()]=i),i}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,i){R("MemoryPersistence","Starting transaction:",e);const r=new Xy(this.Ss.next());return this.referenceDelegate.ks(),i(r).next(s=>this.referenceDelegate.Os(r).next(()=>s)).toPromise().then(s=>(r.raiseOnCommittedEvent(),s))}Ms(e,t){return b.or(Object.values(this.Vs).map(i=>()=>i.containsKey(e,t)))}}class Xy extends Ks{constructor(e){super(),this.currentSequenceNumber=e}}class yl{constructor(e){this.persistence=e,this.Fs=new cd,this.$s=null}static Bs(e){return new yl(e)}get Ls(){if(this.$s)return this.$s;throw U()}addReference(e,t,i){return this.Fs.addReference(i,t),this.Ls.delete(i.toString()),b.resolve()}removeReference(e,t,i){return this.Fs.removeReference(i,t),this.Ls.add(i.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),b.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(r=>this.Ls.add(r.toString()));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(r=>{r.forEach(s=>this.Ls.add(s.toString()))}).next(()=>i.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Ls,i=>{const r=O.fromPath(i);return this.qs(e,r).next(s=>{s||t.removeEntry(r,Z.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(i=>{i?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return b.or([()=>b.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class ev{constructor(e){this.yt=e}$(e,t,i,r){const s=new Ii("createOrUpgrade",t);var d;i<1&&r>=1&&(e.createObjectStore("owner"),(d=e).createObjectStore("mutationQueues",{keyPath:"userId"}),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zp,{unique:!0}),d.createObjectStore("documentMutations"),bm(e),function(d){d.createObjectStore("remoteDocuments")}(e));let u=b.resolve();return i<3&&r>=3&&(0!==i&&(function(d){d.deleteObjectStore("targetDocuments"),d.deleteObjectStore("targets"),d.deleteObjectStore("targetGlobal")}(e),bm(e)),u=u.next(()=>function(d){const f=d.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:Z.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),i<4&&r>=4&&(0!==i&&(u=u.next(()=>function(d,f){return f.store("mutations").W().next(m=>{d.deleteObjectStore("mutations"),d.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",zp,{unique:!0});const g=f.store("mutations"),y=m.map(w=>g.put(w));return b.waitFor(y)})}(e,s))),u=u.next(()=>{!function(d){d.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),i<5&&r>=5&&(u=u.next(()=>this.Us(s))),i<6&&r>=6&&(u=u.next(()=>(function(d){d.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),i<7&&r>=7&&(u=u.next(()=>this.Gs(s))),i<8&&r>=8&&(u=u.next(()=>this.Qs(e,s))),i<9&&r>=9&&(u=u.next(()=>{!function(d){d.objectStoreNames.contains("remoteDocumentChanges")&&d.deleteObjectStore("remoteDocumentChanges")}(e)})),i<10&&r>=10&&(u=u.next(()=>this.js(s))),i<11&&r>=11&&(u=u.next(()=>{(function(d){d.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(d){d.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),i<12&&r>=12&&(u=u.next(()=>{!function(d){const f=d.createObjectStore("documentOverlays",{keyPath:Ty});f.createIndex("collectionPathOverlayIndex",xy,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",ky,{unique:!1})}(e)})),i<13&&r>=13&&(u=u.next(()=>function(d){const f=d.createObjectStore("remoteDocumentsV14",{keyPath:fy});f.createIndex("documentKeyIndex",py),f.createIndex("collectionGroupIndex",my)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),i<14&&r>=14&&(u=u.next(()=>this.zs(e,s))),i<15&&r>=15&&(u=u.next(()=>function(d){d.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),d.createObjectStore("indexState",{keyPath:Iy}).createIndex("sequenceNumberIndex",wy,{unique:!1}),d.createObjectStore("indexEntries",{keyPath:by}).createIndex("documentKeyIndex",Ey,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((i,r)=>{t+=ml(r)}).next(()=>{const i={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",i)})}Us(e){const t=e.store("mutationQueues"),i=e.store("mutations");return t.W().next(r=>b.forEach(r,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return i.W("userMutationsIndex",u).next(d=>b.forEach(d,f=>{B(f.userId===s.userId);const m=$r(this.yt,f);return lm(e,s.userId,m).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),i=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(r=>{const s=[];return i.Z((u,d)=>{const f=new ee(u),m=[0,dt(f)];s.push(t.get(m).next(g=>g?b.resolve():t.put({targetId:0,path:dt(f),sequenceNumber:r.highestListenSequenceNumber})))}).next(()=>b.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:vy});const i=t.store("collectionParents"),r=new ud,s=u=>{if(r.add(u)){const d=u.lastSegment(),f=u.popLast();return i.put({collectionId:d,parent:dt(f)})}};return t.store("remoteDocuments").Z({X:!0},(u,d)=>{const f=new ee(u);return s(f.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,d,f],m)=>{const g=xn(d);return s(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((i,r)=>{const s=yu(r),u=Yp(this.yt,s);return t.put(u)})}Ws(e,t){const i=t.store("remoteDocuments"),r=[];return i.Z((s,u)=>{const d=t.store("remoteDocumentsV14"),f=(m=u,m.document?new O(ee.fromString(m.document.name).popFirst(5)):m.noDocument?O.fromSegments(m.noDocument.path):m.unknownDocument?O.fromSegments(m.unknownDocument.path):U()).path.toArray();var m;const g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};r.push(d.put(g))}).next(()=>b.waitFor(r))}zs(e,t){const i=t.store("mutations"),r=gm(this.yt),s=new wm(yl.Bs,this.yt.ie);return i.W().next(u=>{const d=new Map;return u.forEach(f=>{var m;let g=null!==(m=d.get(f.userId))&&void 0!==m?m:H();$r(this.yt,f).keys().forEach(y=>g=g.add(y)),d.set(f.userId,g)}),b.forEach(d,(f,m)=>{const g=new Ce(m),y=hl.re(this.yt,g),w=s.getIndexManager(g),k=gl.re(g,this.yt,w,s.referenceDelegate);return new Im(r,k,y,w).recalculateAndSaveOverlaysForDocumentKeys(new Jh(t,ct.at),f).next()})})}}function bm(n){n.createObjectStore("targetDocuments",{keyPath:_y}).createIndex("documentTargetsIndex",yy,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",gy,{unique:!0}),n.createObjectStore("targetGlobal")}const ld="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class hd{constructor(e,t,i,r,s,u,d,f,m,g,y=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=i,this.Hs=s,this.window=u,this.document=d,this.Js=m,this.Ys=g,this.Xs=y,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=w=>Promise.resolve(),!hd.C())throw new C(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Gy(this,r),this.ii=t+"main",this.yt=new Hp(f),this.ri=new Et(this.ii,this.Xs,new ev(this.yt)),this.Cs=new Vy(this.referenceDelegate,this.yt),this.remoteDocumentCache=gm(this.yt),this.Ns=new Dy,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&xe("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new C(E.FAILED_PRECONDITION,ld);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ct(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var i=(0,x.Z)(function*(r){if(t.started)return e(r)});return function(r){return i.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,x.Z)(function*(i){null===i.newVersion&&(yield e())});return function(i){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,x.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>vl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(yn(e))return R("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return R("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return Tu(e).get("owner").next(t=>b.resolve(this.mi(t)))}gi(e){return vl(e).delete(this.clientId)}yi(){var e=this;return(0,x.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",i=>{const r=je(i,"clientMetadata");return r.W().next(s=>{const u=e.Ii(s,18e5),d=s.filter(f=>-1===u.indexOf(f));return b.forEach(d,f=>r.delete(f.clientId)).next(()=>d)})}).catch(()=>[]);if(e.oi)for(const i of t)e.oi.removeItem(e.Ti(i.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?b.resolve(!0):Tu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new C(E.FAILED_PRECONDITION,ld);return!1}}return!(!this.networkEnabled||!this.inForeground)||vl(e).W().next(i=>void 0===this.Ii(i,5e3).find(r=>{if(this.clientId!==r.clientId){const u=!this.inForeground&&r.inForeground,d=this.networkEnabled===r.networkEnabled;if(!this.networkEnabled&&r.networkEnabled||u&&d)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&R("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,x.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const i=new Jh(t,ct.at);return e._i(i).next(()=>e.gi(i))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(i=>this.pi(i.updateTimeMs,t)&&!this.Ei(i.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>vl(e).W().next(t=>this.Ii(t,18e5).map(i=>i.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return gl.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new Uy(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return hl.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,i){R("IndexedDbPersistence","Starting transaction:",e);const r="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?Cy:14===u?Kp:13===u?Wp:12===u?Ay:11===u?jp:void U();var u;let d;return this.ri.runTransaction(e,r,s,f=>(d=new Jh(f,this.Ss?this.Ss.next():ct.at),"readwrite-primary"===t?this.fi(d).next(m=>!!m||this.di(d)).next(m=>{if(!m)throw xe(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new C(E.FAILED_PRECONDITION,Ka);return i(d)}).next(m=>this.wi(d).next(()=>m)):this.Vi(d).next(()=>i(d)))).then(f=>(d.raiseOnCommittedEvent(),f))}Vi(e){return Tu(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new C(E.FAILED_PRECONDITION,ld)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return Tu(e).put("owner",t)}static C(){return Et.C()}_i(e){const t=Tu(e);return t.get("owner").next(i=>this.mi(i)?(R("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}pi(e,t){const i=Date.now();return!(e<i-t||e>i&&(xe(`Detected an update time that is in the future: ${e} > ${i}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,re.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const i=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return R("IndexedDbPersistence",`Client '${e}' ${i?"is":"is not"} zombied in LocalStorage`),i}catch(i){return xe("IndexedDbPersistence","Failed to get zombied client id.",i),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){xe("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function Tu(n){return je(n,"owner")}function vl(n){return je(n,"clientMetadata")}function dd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class fd{constructor(e,t,i,r){this.targetId=e,this.fromCache=t,this.Si=i,this.Di=r}static Ci(e,t){let i=H(),r=H();for(const s of t.docChanges)switch(s.type){case 0:i=i.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}return new fd(e,t.fromCache,i,r)}}class Em{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,i,r){return this.ki(e,t).next(s=>s||this.Oi(e,t,r,i)).next(s=>s||this.Mi(e,t))}ki(e,t){if(so(t))return b.resolve(null);let i=be(t);return this.indexManager.getIndexType(e,i).next(r=>0===r?null:(null!==t.limit&&1===r&&(t=co(t,null,"F"),i=be(t)),this.indexManager.getDocumentsMatchingTarget(e,i).next(s=>{const u=H(...s);return this.Ni.getDocuments(e,u).next(d=>this.indexManager.getMinOffset(e,i).next(f=>{const m=this.Fi(t,d);return this.$i(t,m,u,f.readTime)?this.ki(e,co(t,null,"F")):this.Bi(e,m,t,f)}))})))}Oi(e,t,i,r){return so(t)||r.isEqual(Z.min())?this.Mi(e,t):this.Ni.getDocuments(e,i).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,i,r)?this.Mi(e,t):(Cr()<=At.in.DEBUG&&R("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),lo(t)),this.Bi(e,u,t,$a(r,-1)))})}Fi(e,t){let i=new oe(fo(e));return t.forEach((r,s)=>{$e(e,s)&&(i=i.add(s))}),i}$i(e,t,i,r){if(null===e.limit)return!1;if(i.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Mi(e,t){return Cr()<=At.in.DEBUG&&R("QueryEngine","Using full collection scan to execute query:",lo(t)),this.Ni.getDocumentsMatchingQuery(e,t,st.min())}Bi(e,t,i,r){return this.Ni.getDocumentsMatchingQuery(e,i,r).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class tv{constructor(e,t,i,r){this.persistence=e,this.Li=t,this.yt=r,this.qi=new we(W),this.Ui=new Ri(s=>an(s),ki),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(i)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Im(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function Tm(n,e,t,i){return new tv(n,e,t,i)}function xm(n,e){return pd.apply(this,arguments)}function pd(){return pd=(0,x.Z)(function*(n,e){const t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let r;return t.mutationQueue.getAllMutationBatches(i).next(s=>(r=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(i))).next(s=>{const u=[],d=[];let f=H();for(const m of r){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of s){d.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return t.localDocuments.getDocuments(i,f).next(m=>({ji:m,removedBatchIds:u,addedBatchIds:d}))})})}),pd.apply(this,arguments)}function nv(n,e){const t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",i=>{const r=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,d,f,m){const g=f.batch,y=g.keys();let w=b.resolve();return y.forEach(k=>{w=w.next(()=>m.getEntry(d,k)).next(S=>{const M=f.docVersions.get(k);B(null!==M),S.version.compareTo(M)<0&&(g.applyToRemoteDocument(S,f),S.isValidDocument()&&(S.setReadTime(f.commitVersion),m.addEntry(S)))})}),w.next(()=>u.mutationQueue.removeMutationBatch(d,g))}(t,i,e,s).next(()=>s.apply(i)).next(()=>t.mutationQueue.performConsistencyCheck(i)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(i,r,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,function(u){let d=H();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(d=d.add(u.batch.mutations[f].key));return d}(e))).next(()=>t.localDocuments.getDocuments(i,r))})}function km(n){const e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function iv(n,e){const t=P(n),i=e.snapshotVersion;let r=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});r=t.qi;const d=[];e.targetChanges.forEach((g,y)=>{const w=r.get(y);if(!w)return;d.push(t.Cs.removeMatchingKeys(s,g.removedDocuments,y).next(()=>t.Cs.addMatchingKeys(s,g.addedDocuments,y)));let k=w.withSequenceNumber(s.currentSequenceNumber);var S,M,V;e.targetMismatches.has(y)?k=k.withResumeToken(Re.EMPTY_BYTE_STRING,Z.min()).withLastLimboFreeSnapshotVersion(Z.min()):g.resumeToken.approximateByteSize()>0&&(k=k.withResumeToken(g.resumeToken,i)),r=r.insert(y,k),M=k,V=g,(0===(S=w).resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&d.push(t.Cs.updateTargetData(s,k))});let f=vt(),m=H();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&d.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),d.push(Am(s,u,e.documentUpdates).next(g=>{f=g.Wi,m=g.zi})),!i.isEqual(Z.min())){const g=t.Cs.getLastRemoteSnapshotVersion(s).next(y=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,i));d.push(g)}return b.waitFor(d).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.qi=r,s))}function Am(n,e,t){let i=H(),r=H();return t.forEach(s=>i=i.add(s)),e.getEntries(n,i).next(s=>{let u=vt();return t.forEach((d,f)=>{const m=s.get(d);f.isFoundDocument()!==m.isFoundDocument()&&(r=r.add(d)),f.isNoDocument()&&f.version.isEqual(Z.min())?(e.removeEntry(d,f.readTime),u=u.insert(d,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(d,f)):R("LocalStore","Ignoring outdated watch update for ",d,". Current version:",m.version," Watch version:",f.version)}),{Wi:u,zi:r}})}function rv(n,e){const t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",i=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(i,e)))}function wo(n,e){const t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",i=>{let r;return t.Cs.getTargetData(i,e).next(s=>s?(r=s,b.resolve(r)):t.Cs.allocateTargetId(i).next(u=>(r=new Ni(e,u,0,i.currentSequenceNumber),t.Cs.addTargetData(i,r).next(()=>r))))}).then(i=>{const r=t.qi.get(i.targetId);return(null===r||i.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(t.qi=t.qi.insert(i.targetId,i),t.Ui.set(e,i.targetId)),i})}function bo(n,e,t){return md.apply(this,arguments)}function md(){return md=(0,x.Z)(function*(n,e,t){const i=P(n),r=i.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield i.persistence.runTransaction("Release target",s,u=>i.persistence.referenceDelegate.removeTarget(u,r)))}catch(u){if(!yn(u))throw u;R("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}i.qi=i.qi.remove(e),i.Ui.delete(r.target)}),md.apply(this,arguments)}function Il(n,e,t){const i=P(n);let r=Z.min(),s=H();return i.persistence.runTransaction("Execute query","readonly",u=>function(d,f,m){const g=P(d),y=g.Ui.get(m);return void 0!==y?b.resolve(g.qi.get(y)):g.Cs.getTargetData(f,m)}(i,u,be(e)).next(d=>{if(d)return r=d.lastLimboFreeSnapshotVersion,i.Cs.getMatchingKeysForTargetId(u,d.targetId).next(f=>{s=f})}).next(()=>i.Li.getDocumentsMatchingQuery(u,e,t?r:Z.min(),t?s:H())).next(d=>(Dm(i,ho(e),d),{documents:d,Hi:s})))}function Cm(n,e){const t=P(n),i=P(t.Cs),r=t.qi.get(e);return r?Promise.resolve(r.target):t.persistence.runTransaction("Get target data","readonly",s=>i.ne(s,e).next(u=>u?u.target:null))}function Sm(n,e){const t=P(n),i=t.Ki.get(e)||Z.min();return t.persistence.runTransaction("Get new document changes","readonly",r=>t.Gi.getAllFromCollectionGroup(r,e,$a(i,-1),Number.MAX_SAFE_INTEGER)).then(r=>(Dm(t,e,r),r))}function Dm(n,e,t){let i=n.Ki.get(e)||Z.min();t.forEach((r,s)=>{s.readTime.compareTo(i)>0&&(i=s.readTime)}),n.Ki.set(e,i)}function gd(){return gd=(0,x.Z)(function*(n,e,t,i){const r=P(n);let s=H(),u=vt();for(const m of t){const g=e.Ji(m.metadata.name);m.document&&(s=s.add(g));const y=e.Yi(m);y.setReadTime(e.Xi(m.metadata.readTime)),u=u.insert(g,y)}const d=r.Gi.newChangeBuffer({trackRemovals:!0}),f=yield wo(r,(m=i,be(Ci(ee.fromString(`__bundle__/docs/${m}`)))));var m;return r.persistence.runTransaction("Apply bundle documents","readwrite",m=>Am(m,d,u).next(g=>(d.apply(m),g)).next(g=>r.Cs.removeMatchingKeysForTargetId(m,f.targetId).next(()=>r.Cs.addMatchingKeys(m,s,f.targetId)).next(()=>r.localDocuments.getLocalViewOfDocuments(m,g.Wi,g.zi)).next(()=>g.Wi)))}),gd.apply(this,arguments)}function ov(n,e){return _d.apply(this,arguments)}function _d(){return _d=(0,x.Z)(function*(n,e,t=H()){const i=yield wo(n,be(nd(e.bundledQuery))),r=P(n);return r.persistence.runTransaction("Save named query","readwrite",s=>{const u=Oe(e.readTime);if(i.snapshotVersion.compareTo(u)>=0)return r.Ns.saveNamedQuery(s,e);const d=i.withResumeToken(Re.EMPTY_BYTE_STRING,u);return r.qi=r.qi.insert(d.targetId,d),r.Cs.updateTargetData(s,d).next(()=>r.Cs.removeMatchingKeysForTargetId(s,i.targetId)).next(()=>r.Cs.addMatchingKeys(s,t,i.targetId)).next(()=>r.Ns.saveNamedQuery(s,e))})}),_d.apply(this,arguments)}function Rm(n,e){return`firestore_clients_${n}_${e}`}function Nm(n,e,t){let i=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(i+=`_${e.uid}`),i}function yd(n,e){return`firestore_targets_${n}_${e}`}class wl{constructor(e,t,i,r){this.user=e,this.batchId=t,this.state=i,this.error=r}static Zi(e,t,i){const r=JSON.parse(i);let s,u="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return u&&r.error&&(u="string"==typeof r.error.message&&"string"==typeof r.error.code,u&&(s=new C(r.error.code,r.error.message))),u?new wl(e,t,r.state,s):(xe("SharedClientState",`Failed to parse mutation state for ID '${t}': ${i}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xu{constructor(e,t,i){this.targetId=e,this.state=t,this.error=i}static Zi(e,t){const i=JSON.parse(t);let r,s="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return s&&i.error&&(s="string"==typeof i.error.message&&"string"==typeof i.error.code,s&&(r=new C(i.error.code,i.error.message))),s?new xu(e,i.state,r):(xe("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class bl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const i=JSON.parse(t);let r="object"==typeof i&&i.activeTargetIds instanceof Array,s=al();for(let u=0;r&&u<i.activeTargetIds.length;++u)r=Uc(i.activeTargetIds[u]),s=s.add(i.activeTargetIds[u]);return r?new bl(e,s):(xe("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class vd{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new vd(t.clientId,t.onlineState):(xe("SharedClientState",`Failed to parse online state: ${e}`),null)}}class Id{constructor(){this.activeTargetIds=al()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class wd{constructor(e,t,i,r,s){this.window=e,this.Hs=t,this.persistenceKey=i,this.sr=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new we(W),this.started=!1,this.cr=[];const u=i.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Rm(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new Id),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(d){return`firestore_bundle_loaded_v2_${d}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,x.Z)(function*(){const t=yield e.syncEngine.vi();for(const r of t){if(r===e.sr)continue;const s=e.getItem(Rm(e.persistenceKey,r));if(s){const u=bl.Zi(r,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const i=e.storage.getItem(e.wr);if(i){const r=e.yr(i);r&&e.pr(r)}for(const r of e.cr)e.rr(r);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((i,r)=>{r.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,i){this.Tr(e,t,i),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const i=this.storage.getItem(yd(this.persistenceKey,e));if(i){const r=xu.Zi(e,i);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(yd(this.persistenceKey,e))}updateQueryState(e,t,i){this.Rr(e,t,i)}handleUserChange(e,t,i){t.forEach(r=>{this.Er(r)}),this.currentUser=e,i.forEach(r=>{this.addPendingMutation(r)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return R("SharedClientState","READ",e,t),t}setItem(e,t){R("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){R("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const i=e;if(i.storageArea===this.storage){if(R("SharedClientState","EVENT",i.key,i.newValue),i.key===this.ar)return void xe("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,x.Z)(function*(){if(t.started){if(null!==i.key)if(t.lr.test(i.key)){if(null==i.newValue){const r=t.vr(i.key);return t.Vr(r,null)}{const r=t.Sr(i.key,i.newValue);if(r)return t.Vr(r.clientId,r)}}else if(t.dr.test(i.key)){if(null!==i.newValue){const r=t.Dr(i.key,i.newValue);if(r)return t.Cr(r)}}else if(t._r.test(i.key)){if(null!==i.newValue){const r=t.Nr(i.key,i.newValue);if(r)return t.kr(r)}}else if(i.key===t.wr){if(null!==i.newValue){const r=t.yr(i.newValue);if(r)return t.pr(r)}}else if(i.key===t.hr){const r=function(s){let u=ct.at;if(null!=s)try{const d=JSON.parse(s);B("number"==typeof d),u=d}catch(d){xe("SharedClientState","Failed to read sequence number from WebStorage",d)}return u}(i.newValue);r!==ct.at&&t.sequenceNumberHandler(r)}else if(i.key===t.mr){const r=t.Or(i.newValue);yield Promise.all(r.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(i)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,i){const r=new wl(this.currentUser,e,t,i),s=Nm(this.persistenceKey,this.currentUser,e);this.setItem(s,r.tr())}Er(e){const t=Nm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,i){const r=yd(this.persistenceKey,e),s=new xu(e,t,i);this.setItem(r,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const i=this.vr(e);return bl.Zi(i,t)}Dr(e,t){const i=this.dr.exec(e),r=Number(i[1]);return wl.Zi(new Ce(void 0!==i[2]?i[2]:null),r,t)}Nr(e,t){const i=this._r.exec(e),r=Number(i[1]);return xu.Zi(r,t)}yr(e){return vd.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,x.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);R("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const i=t?this.ur.insert(e,t):this.ur.remove(e),r=this.Ir(this.ur),s=this.Ir(i),u=[],d=[];return s.forEach(f=>{r.has(f)||u.push(f)}),r.forEach(f=>{s.has(f)||d.push(f)}),this.syncEngine.Br(u,d).then(()=>{this.ur=i})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=al();return e.forEach((i,r)=>{t=t.unionWith(r.activeTargetIds)}),t}}class Om{constructor(){this.Lr=new Id,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,i){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,i){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new Id,Promise.resolve()}handleUserChange(e,t,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class av{Ur(e){}shutdown(){}}class Mm{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){R("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){R("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const uv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class cv{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class lv extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,i,r,s){const u=this.ho(e,t);R("RestConnection","Sending: ",u,i);const d={};return this.lo(d,r,s),this.fo(e,u,d,i).then(f=>(R("RestConnection","Received: ",f),f),f=>{throw tn("RestConnection",`${e} failed with error: `,f,"url: ",u,"request:",i),f})}_o(e,t,i,r,s,u){return this.ao(e,t,i,r,s)}lo(e,t,i){e["X-Goog-Api-Client"]="gl-js/ fire/"+Nt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((r,s)=>e[s]=r),i&&i.headers.forEach((r,s)=>e[s]=r)}ho(e,t){return`${this.oo}/v1/${t}:${uv[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,i,r){return new Promise((s,u)=>{const d=new Fa;d.setWithCredentials(!0),d.listenOnce(Sh.COMPLETE,()=>{try{switch(d.getLastErrorCode()){case Ar.NO_ERROR:const m=d.getResponseJson();R("Connection","XHR received:",JSON.stringify(m)),s(m);break;case Ar.TIMEOUT:R("Connection",'RPC "'+e+'" timed out'),u(new C(E.DEADLINE_EXCEEDED,"Request time out"));break;case Ar.HTTP_ERROR:const g=d.getStatus();if(R("Connection",'RPC "'+e+'" failed with status:',g,"response text:",d.getResponseText()),g>0){let y=d.getResponseJson();Array.isArray(y)&&(y=y[0]);const w=null==y?void 0:y.error;if(w&&w.status&&w.message){const k=function(S){const M=S.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(M)>=0?M:E.UNKNOWN}(w.status);u(new C(k,w.message))}else u(new C(E.UNKNOWN,"Server responded with status "+d.getStatus()))}else u(new C(E.UNAVAILABLE,"Connection failed."));break;default:U()}}finally{R("Connection",'RPC "'+e+'" completed.')}});const f=JSON.stringify(r);d.send(t,"POST",f,i,15)})}wo(e,t,i){const r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=Ma(),u=Ch(),d={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(d.xmlHttpFactory=new La({})),this.lo(d.initMessageHeaders,t,i),d.encodeInitMessageHeaders=!0;const f=r.join("");R("Connection","Creating WebChannel: "+f,d);const m=s.createWebChannel(f,d);let g=!1,y=!1;const w=new cv({Hr:S=>{y?R("Connection","Not sending because WebChannel is closed:",S):(g||(R("Connection","Opening WebChannel transport."),m.open(),g=!0),R("Connection","WebChannel sending:",S),m.send(S))},Jr:()=>m.close()}),k=(S,M,V)=>{S.listen(M,ae=>{try{V(ae)}catch(he){setTimeout(()=>{throw he},0)}})};return k(m,Bn.EventType.OPEN,()=>{y||R("Connection","WebChannel transport opened.")}),k(m,Bn.EventType.CLOSE,()=>{y||(y=!0,R("Connection","WebChannel transport closed"),w.io())}),k(m,Bn.EventType.ERROR,S=>{y||(y=!0,tn("Connection","WebChannel transport errored:",S),w.io(new C(E.UNAVAILABLE,"The operation could not be completed")))}),k(m,Bn.EventType.MESSAGE,S=>{var M;if(!y){const V=S.data[0];B(!!V);const ae=V,he=ae.error||(null===(M=ae[0])||void 0===M?void 0:M.error);if(he){R("Connection","WebChannel received error:",he);const ne=he.status;let Q=function(X){const Ge=Se[X];if(void 0!==Ge)return Ep(Ge)}(ne),K=he.message;void 0===Q&&(Q=E.INTERNAL,K="Unknown error status: "+ne+" with message "+he.message),y=!0,w.io(new C(Q,K)),m.close()}else R("Connection","WebChannel received:",V),w.ro(V)}}),k(u,Pa.STAT_EVENT,S=>{S.stat===Oc.PROXY?R("Connection","Detected buffering proxy"):S.stat===Oc.NOPROXY&&R("Connection","Detected no buffering proxy")}),setTimeout(()=>{w.so()},0),w}}function Pm(){return"undefined"!=typeof window?window:null}function El(){return"undefined"!=typeof document?document:null}function ku(n){return new ty(n,!0)}class bd{constructor(e,t,i=1e3,r=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=i,this.yo=r,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),i=Math.max(0,Date.now()-this.Eo),r=Math.max(0,t-i);r>0&&R("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${i} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,r,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Lm{constructor(e,t,i,r,s,u,d,f){this.Hs=e,this.vo=i,this.Vo=r,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=d,this.listener=f,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new bd(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,x.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,x.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var i=this;return(0,x.Z)(function*(){i.Lo(),i.qo(),i.xo.cancel(),i.So++,4!==e?i.xo.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(xe(t.toString()),xe("Using maximum backoff delay to prevent overloading the backend."),i.xo.Ao()):t&&t.code===E.UNAUTHENTICATED&&3!==i.state&&(i.authCredentialsProvider.invalidateToken(),i.appCheckCredentialsProvider.invalidateToken()),null!==i.stream&&(i.Uo(),i.stream.close(),i.stream=null),i.state=e,yield i.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([i,r])=>{this.So===t&&this.Go(i,r)},i=>{e(()=>{const r=new C(E.UNKNOWN,"Fetching auth token failed: "+i.message);return this.Qo(r)})})}Go(e,t){const i=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{i(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(r=>{i(()=>this.Qo(r))}),this.stream.onMessage(r=>{i(()=>this.onMessage(r))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,x.Z)(function*(){e.state=0,e.start()}))}Qo(e){return R("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(R("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class hv extends Lm{constructor(e,t,i,r,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,i,r,u),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function ry(n,e){let t;if("targetChange"in e){const i="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:U(),r=e.targetChange.targetIds||[],s=function(f,m){return f.wt?(B(void 0===m||"string"==typeof m),Re.fromBase64String(m||"")):(B(void 0===m||m instanceof Uint8Array),Re.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,d=u&&function(f){const m=void 0===f.code?E.UNKNOWN:Ep(f.code);return new C(m,f.message||"")}(u);t=new Cp(i,r,s,d||null)}else if("documentChange"in e){const i=e.documentChange,r=Tn(n,i.document.name),s=Oe(i.document.updateTime),u=i.document.createTime?Oe(i.document.createTime):Z.min(),d=new Ze({mapValue:{fields:i.document.fields}}),f=de.newFoundDocument(r,s,u,d);t=new ul(i.targetIds||[],i.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const i=e.documentDelete,r=Tn(n,i.document),s=i.readTime?Oe(i.readTime):Z.min(),u=de.newNoDocument(r,s);t=new ul([],i.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const i=e.documentRemove,r=Tn(n,i.document);t=new ul([],i.removedTargetIds||[],r,null)}else{if(!("filter"in e))return U();{const i=e.filter,s=new sl(i.count||0);t=new Ap(i.targetId,s)}}var f;return t}(this.yt,e),i=function(r){if(!("targetChange"in r))return Z.min();const s=r.targetChange;return s.targetIds&&s.targetIds.length?Z.min():s.readTime?Oe(s.readTime):Z.min()}(e);return this.listener.Wo(t,i)}zo(e){const t={};t.database=gu(this.yt),t.addTarget=function(r,s){let u;const d=s.target;return u=ro(d)?{documents:Up(r,d)}:{query:Yh(r,d)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Np(r,s.resumeToken):s.snapshotVersion.compareTo(Z.min())>0&&(u.readTime=go(r,s.snapshotVersion.toTimestamp())),u}(this.yt,e);const i=function oy(n,e){const t=function(i,r){switch(r){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return U()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);i&&(t.labels=i),this.Bo(t)}Ho(e){const t={};t.database=gu(this.yt),t.removeTarget=e,this.Bo(t)}}class dv extends Lm{constructor(e,t,i,r,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,i,r,u),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(B(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function sy(n,e){return n&&n.length>0?(B(void 0!==e),n.map(t=>function(i,r){let s=Oe(i.updateTime?i.updateTime:r);return s.isEqual(Z.min())&&(s=Oe(r)),new T(s,i.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),i=Oe(e.commitTime);return this.listener.Zo(i,t)}return B(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=gu(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(i=>_u(this.yt,i))};this.Bo(t)}}class fv extends class{}{constructor(e,t,i,r){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=i,this.yt=r,this.nu=!1}su(){if(this.nu)throw new C(E.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([r,s])=>this.connection.ao(e,t,i,r,s)).catch(r=>{throw"FirebaseError"===r.name?(r.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new C(E.UNKNOWN,r.toString())})}_o(e,t,i,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection._o(e,t,i,s,u,r)).catch(s=>{throw"FirebaseError"===s.name?(s.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new C(E.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class mv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(xe(t),this.ou=!1):R("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class gv{constructor(e,t,i,r,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=i,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(d=>{i.enqueueAndForget((0,x.Z)(function*(){var f;Qn(u)&&(R("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,x.Z)(function*(m){const g=P(m);g._u.add(4),yield Eo(g),g.gu.set("Unknown"),g._u.delete(4),yield Au(g)}),function(m){return f.apply(this,arguments)})(u))}))}),this.gu=new mv(i,r)}}function Au(n){return Td.apply(this,arguments)}function Td(){return Td=(0,x.Z)(function*(n){if(Qn(n))for(const e of n.wu)yield e(!0)}),Td.apply(this,arguments)}function Eo(n){return xd.apply(this,arguments)}function xd(){return xd=(0,x.Z)(function*(n){for(const e of n.wu)yield e(!1)}),xd.apply(this,arguments)}function Tl(n,e){const t=P(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),Cd(t)?Ad(t):xo(t).ko()&&kd(t,e))}function Cu(n,e){const t=P(n),i=xo(t);t.du.delete(e),i.ko()&&Fm(t,e),0===t.du.size&&(i.ko()?i.Fo():Qn(t)&&t.gu.set("Unknown"))}function kd(n,e){n.yu.Ot(e.targetId),xo(n).zo(e)}function Fm(n,e){n.yu.Ot(e),xo(n).Ho(e)}function Ad(n){n.yu=new Y_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),xo(n).start(),n.gu.uu()}function Cd(n){return Qn(n)&&!xo(n).No()&&n.du.size>0}function Qn(n){return 0===P(n)._u.size}function Um(n){n.yu=void 0}function _v(n){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,x.Z)(function*(n){n.du.forEach((e,t)=>{kd(n,e)})}),Sd.apply(this,arguments)}function yv(n,e){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,x.Z)(function*(n,e){Um(n),Cd(n)?(n.gu.hu(e),Ad(n)):n.gu.set("Unknown")}),Dd.apply(this,arguments)}function vv(n,e,t){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,x.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof Cp&&2===e.state&&e.cause)try{yield(i=(0,x.Z)(function*(r,s){const u=s.cause;for(const d of s.targetIds)r.du.has(d)&&(yield r.remoteSyncer.rejectListen(d,u),r.du.delete(d),r.yu.removeTarget(d))}),function(r,s){return i.apply(this,arguments)})(n,e)}catch(i){R("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),i),yield xl(n,i)}else if(e instanceof ul?n.yu.Kt(e):e instanceof Ap?n.yu.Jt(e):n.yu.jt(e),!t.isEqual(Z.min()))try{const i=yield km(n.localStore);t.compareTo(i)>=0&&(yield function(r,s){const u=r.yu.Zt(s);return u.targetChanges.forEach((d,f)=>{if(d.resumeToken.approximateByteSize()>0){const m=r.du.get(f);m&&r.du.set(f,m.withResumeToken(d.resumeToken,s))}}),u.targetMismatches.forEach(d=>{const f=r.du.get(d);if(!f)return;r.du.set(d,f.withResumeToken(Re.EMPTY_BYTE_STRING,f.snapshotVersion)),Fm(r,d);const m=new Ni(f.target,d,1,f.sequenceNumber);kd(r,m)}),r.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(i){R("RemoteStore","Failed to raise snapshot:",i),yield xl(n,i)}var i}),Rd.apply(this,arguments)}function xl(n,e,t){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,x.Z)(function*(n,e,t){if(!yn(e))throw e;n._u.add(1),yield Eo(n),n.gu.set("Offline"),t||(t=()=>km(n.localStore)),n.asyncQueue.enqueueRetryable((0,x.Z)(function*(){R("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Au(n)}))}),Nd.apply(this,arguments)}function Vm(n,e){return e().catch(t=>xl(n,t,e))}function To(n){return Od.apply(this,arguments)}function Od(){return Od=(0,x.Z)(function*(n){const e=P(n),t=Li(e);let i=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;Iv(e);)try{const r=yield rv(e.localStore,i);if(null===r){0===e.fu.length&&t.Fo();break}i=r.batchId,wv(e,r)}catch(r){yield xl(e,r)}qm(e)&&Bm(e)}),Od.apply(this,arguments)}function Iv(n){return Qn(n)&&n.fu.length<10}function wv(n,e){n.fu.push(e);const t=Li(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function qm(n){return Qn(n)&&!Li(n).No()&&n.fu.length>0}function Bm(n){Li(n).start()}function bv(n){return Md.apply(this,arguments)}function Md(){return Md=(0,x.Z)(function*(n){Li(n).eu()}),Md.apply(this,arguments)}function Ev(n){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,x.Z)(function*(n){const e=Li(n);for(const t of n.fu)e.Xo(t.mutations)}),Pd.apply(this,arguments)}function Tv(n,e,t){return Ld.apply(this,arguments)}function Ld(){return Ld=(0,x.Z)(function*(n,e,t){const i=n.fu.shift(),r=ed.from(i,e,t);yield Vm(n,()=>n.remoteSyncer.applySuccessfulWrite(r)),yield To(n)}),Ld.apply(this,arguments)}function xv(n,e){return Fd.apply(this,arguments)}function Fd(){return Fd=(0,x.Z)(function*(n,e){var t;e&&Li(n).Yo&&(yield(t=(0,x.Z)(function*(i,r){if(ol(s=r.code)&&s!==E.ABORTED){const u=i.fu.shift();Li(i).Mo(),yield Vm(i,()=>i.remoteSyncer.rejectFailedWrite(u.batchId,r)),yield To(i)}var s}),function(i,r){return t.apply(this,arguments)})(n,e)),qm(n)&&Bm(n)}),Fd.apply(this,arguments)}function Zm(n,e){return Ud.apply(this,arguments)}function Ud(){return Ud=(0,x.Z)(function*(n,e){const t=P(n);t.asyncQueue.verifyOperationInProgress(),R("RemoteStore","RemoteStore received new credentials");const i=Qn(t);t._u.add(3),yield Eo(t),i&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Au(t)}),Ud.apply(this,arguments)}function Vd(n,e){return qd.apply(this,arguments)}function qd(){return qd=(0,x.Z)(function*(n,e){const t=P(n);e?(t._u.delete(2),yield Au(t)):e||(t._u.add(2),yield Eo(t),t.gu.set("Unknown"))}),qd.apply(this,arguments)}function xo(n){return n.pu||(n.pu=function(e,t,i){const r=P(e);return r.su(),new hv(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:_v.bind(null,n),Zr:yv.bind(null,n),Wo:vv.bind(null,n)}),n.wu.push(function(){var e=(0,x.Z)(function*(t){t?(n.pu.Mo(),Cd(n)?Ad(n):n.gu.set("Unknown")):(yield n.pu.stop(),Um(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function Li(n){return n.Iu||(n.Iu=function(e,t,i){const r=P(e);return r.su(),new dv(t,r.connection,r.authCredentials,r.appCheckCredentials,r.yt,i)}(n.datastore,n.asyncQueue,{Yr:bv.bind(null,n),Zr:xv.bind(null,n),tu:Ev.bind(null,n),Zo:Tv.bind(null,n)}),n.wu.push(function(){var e=(0,x.Z)(function*(t){t?(n.Iu.Mo(),yield To(n)):(yield n.Iu.stop(),n.fu.length>0&&(R("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class Bd{constructor(e,t,i,r,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=i,this.op=r,this.removalCallback=s,this.deferred=new ke,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,i,r,s){const u=Date.now()+i,d=new Bd(e,t,u,r,s);return d.start(i),d}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new C(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ko(n,e){if(xe("AsyncQueue",`${e}: ${n}`),yn(n))return new C(E.UNAVAILABLE,`${e}: ${n}`);throw n}class Ao{constructor(e){this.comparator=e?(t,i)=>e(t,i)||O.comparator(t.key,i.key):(t,i)=>O.comparator(t.key,i.key),this.keyedMap=hu(),this.sortedSet=new we(this.comparator)}static emptySet(e){return new Ao(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,i)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ao)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;t.hasNext();){const r=t.getNext().key,s=i.getNext().key;if(!r.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const i=new Ao;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=t,i}}class Gm{constructor(){this.Tu=new we(O.comparator)}track(e){const t=e.doc.key,i=this.Tu.get(t);i?0!==e.type&&3===i.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==i.type?this.Tu=this.Tu.insert(t,{type:i.type,doc:e.doc}):2===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===i.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===i.type?this.Tu=this.Tu.remove(t):1===e.type&&2===i.type?this.Tu=this.Tu.insert(t,{type:1,doc:i.doc}):0===e.type&&1===i.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):U():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,i)=>{e.push(i)}),e}}class Co{constructor(e,t,i,r,s,u,d,f,m){this.query=e,this.docs=t,this.oldDocs=i,this.docChanges=r,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=d,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,i,r,s){const u=[];return t.forEach(d=>{u.push({type:0,doc:d})}),new Co(e,t,Ao.emptySet(t),u,i,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,i=e.docChanges;if(t.length!==i.length)return!1;for(let r=0;r<t.length;r++)if(t[r].type!==i[r].type||!t[r].doc.isEqual(i[r].doc))return!1;return!0}}class kv{constructor(){this.Au=void 0,this.listeners=[]}}class Av{constructor(){this.queries=new Ri(e=>nl(e),qr),this.onlineState="Unknown",this.Ru=new Set}}function Zd(n,e){return Gd.apply(this,arguments)}function Gd(){return Gd=(0,x.Z)(function*(n,e){const t=P(n),i=e.query;let r=!1,s=t.queries.get(i);if(s||(r=!0,s=new kv),r)try{s.Au=yield t.onListen(i)}catch(u){const d=ko(u,`Initialization of query '${lo(e.query)}' failed`);return void e.onError(d)}t.queries.set(i,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&jd(t)}),Gd.apply(this,arguments)}function zd(n,e){return $d.apply(this,arguments)}function $d(){return $d=(0,x.Z)(function*(n,e){const t=P(n),i=e.query;let r=!1;const s=t.queries.get(i);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),r=0===s.listeners.length)}if(r)return t.queries.delete(i),t.onUnlisten(i)}),$d.apply(this,arguments)}function Cv(n,e){const t=P(n);let i=!1;for(const r of e){const u=t.queries.get(r.query);if(u){for(const d of u.listeners)d.Pu(r)&&(i=!0);u.Au=r}}i&&jd(t)}function Sv(n,e,t){const i=P(n),r=i.queries.get(e);if(r)for(const s of r.listeners)s.onError(t);i.queries.delete(e)}function jd(n){n.Ru.forEach(e=>{e.next()})}class Wd{constructor(e,t,i){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=i||{}}Pu(e){if(!this.options.includeMetadataChanges){const i=[];for(const r of e.docChanges)3!==r.type&&i.push(r);e=new Co(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=Co.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Dv{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class zm{constructor(e){this.yt=e}Ji(e){return Tn(this.yt,e)}Yi(e){return e.metadata.exists?Fp(this.yt,e.document,!1):de.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Oe(e)}}class Rv{constructor(e,t,i){this.Mu=e,this.localStore=t,this.yt=i,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=$m(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const i=ee.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(i.get(i.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,i=new zm(this.yt);for(const r of e)if(r.metadata.queries){const s=i.Ji(r.metadata.name);for(const u of r.metadata.queries){const d=(t.get(u)||H()).add(s);t.set(u,d)}}return t}complete(){var e=this;return(0,x.Z)(function*(){const t=yield function sv(n,e,t,i){return gd.apply(this,arguments)}(e.localStore,new zm(e.yt),e.documents,e.Mu.id),i=e.$u(e.documents);for(const r of e.queries)yield ov(e.localStore,r,i.get(r.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function $m(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class jm{constructor(e){this.key=e}}class Wm{constructor(e){this.key=e}}class Km{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=H(),this.mutatedKeys=H(),this.Gu=fo(e),this.Qu=new Ao(this.Gu)}get ju(){return this.qu}Wu(e,t){const i=t?t.zu:new Gm,r=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=r,d=!1;const f="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,m="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(e.inorderTraversal((g,y)=>{const w=r.get(g),k=$e(this.query,y)?y:null,S=!!w&&this.mutatedKeys.has(w.key),M=!!k&&(k.hasLocalMutations||this.mutatedKeys.has(k.key)&&k.hasCommittedMutations);let V=!1;w&&k?w.data.isEqual(k.data)?S!==M&&(i.track({type:3,doc:k}),V=!0):this.Hu(w,k)||(i.track({type:2,doc:k}),V=!0,(f&&this.Gu(k,f)>0||m&&this.Gu(k,m)<0)&&(d=!0)):!w&&k?(i.track({type:0,doc:k}),V=!0):w&&!k&&(i.track({type:1,doc:w}),V=!0,(f||m)&&(d=!0)),V&&(k?(u=u.add(k),s=M?s.add(g):s.delete(g)):(u=u.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),s=s.delete(g.key),i.track({type:1,doc:g})}return{Qu:u,zu:i,$i:d,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,i){const r=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((m,g)=>function(y,w){const k=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return U()}};return k(y)-k(w)}(m.type,g.type)||this.Gu(m.doc,g.doc)),this.Ju(i);const u=t?this.Yu():[],d=0===this.Ku.size&&this.current?1:0,f=d!==this.Uu;return this.Uu=d,0!==s.length||f?{snapshot:new Co(this.query,e.Qu,r,s,e.mutatedKeys,0===d,f,!1,!!i&&i.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new Gm,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=H(),this.Qu.forEach(i=>{this.Zu(i.key)&&(this.Ku=this.Ku.add(i.key))});const t=[];return e.forEach(i=>{this.Ku.has(i)||t.push(new Wm(i))}),this.Ku.forEach(i=>{e.has(i)||t.push(new jm(i))}),t}tc(e){this.qu=e.Hi,this.Ku=H();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return Co.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Nv{constructor(e,t,i){this.query=e,this.targetId=t,this.view=i}}class Ov{constructor(e){this.key=e,this.nc=!1}}class Mv{constructor(e,t,i,r,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=i,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new Ri(d=>nl(d),qr),this.rc=new Map,this.oc=new Set,this.uc=new we(O.comparator),this.cc=new Map,this.ac=new cd,this.hc={},this.lc=new Map,this.fc=Kr.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Pv(n,e){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,x.Z)(function*(n,e){const t=yf(n);let i,r;const s=t.ic.get(e);if(s)i=s.targetId,t.sharedClientState.addLocalQueryTarget(i),r=s.view.ec();else{const u=yield wo(t.localStore,be(e));t.isPrimaryClient&&Tl(t.remoteStore,u);const d=t.sharedClientState.addLocalQueryTarget(u.targetId);i=u.targetId,r=yield Hd(t,e,i,"current"===d,u.resumeToken)}return r}),Kd.apply(this,arguments)}function Hd(n,e,t,i,r){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,x.Z)(function*(n,e,t,i,r){n._c=(y,w,k)=>{return(S=(0,x.Z)(function*(M,V,ae,he){let ne=V.view.Wu(ae);ne.$i&&(ne=yield Il(M.localStore,V.query,!1).then(({documents:X})=>V.view.Wu(X,ne)));const Q=he&&he.targetChanges.get(V.targetId),K=V.view.applyChanges(ne,M.isPrimaryClient,Q);return af(M,V.targetId,K.Xu),K.snapshot}),function(M,V,ae,he){return S.apply(this,arguments)})(n,y,w,k);var S};const s=yield Il(n.localStore,e,!0),u=new Km(e,s.Hi),d=u.Wu(s.documents),f=pu.createSynthesizedTargetChangeForCurrentChange(t,i&&"Offline"!==n.onlineState,r),m=u.applyChanges(d,n.isPrimaryClient,f);af(n,t,m.Xu);const g=new Nv(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),m.snapshot}),Qd.apply(this,arguments)}function Lv(n,e){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,x.Z)(function*(n,e){const t=P(n),i=t.ic.get(e),r=t.rc.get(i.targetId);if(r.length>1)return t.rc.set(i.targetId,r.filter(s=>!qr(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(i.targetId),t.sharedClientState.isActiveQueryTarget(i.targetId)||(yield bo(t.localStore,i.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(i.targetId),Cu(t.remoteStore,i.targetId),So(t,i.targetId)}).catch(_n))):(So(t,i.targetId),yield bo(t.localStore,i.targetId,!0))}),Yd.apply(this,arguments)}function Jd(){return Jd=(0,x.Z)(function*(n,e,t){const i=vf(n);try{const r=yield function(s,u){const d=P(s),f=le.now(),m=u.reduce((w,k)=>w.add(k.key),H());let g,y;return d.persistence.runTransaction("Locally write mutations","readwrite",w=>{let k=vt(),S=H();return d.Gi.getEntries(w,m).next(M=>{k=M,k.forEach((V,ae)=>{ae.isValidDocument()||(S=S.add(V))})}).next(()=>d.localDocuments.getOverlayedDocuments(w,k)).next(M=>{g=M;const V=[];for(const ae of u){const he=po(ae,g.get(ae.key).overlayedDocument);null!=he&&V.push(new Ft(ae.key,he,Xc(he.value.mapValue),A.exists(!0)))}return d.mutationQueue.addMutationBatch(w,f,V,u)}).next(M=>{y=M;const V=M.applyToLocalDocumentSet(g,S);return d.documentOverlayCache.saveOverlays(w,M.batchId,V)})}).then(()=>({batchId:y.batchId,changes:xp(g)}))}(i.localStore,e);i.sharedClientState.addPendingMutation(r.batchId),function(s,u,d){let f=s.hc[s.currentUser.toKey()];f||(f=new we(W)),f=f.insert(u,d),s.hc[s.currentUser.toKey()]=f}(i,r.batchId,t),yield Yn(i,r.changes),yield To(i.remoteStore)}catch(r){const s=ko(r,"Failed to persist write");t.reject(s)}}),Jd.apply(this,arguments)}function Hm(n,e){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,x.Z)(function*(n,e){const t=P(n);try{const i=yield iv(t.localStore,e);e.targetChanges.forEach((r,s)=>{const u=t.cc.get(s);u&&(B(r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size<=1),r.addedDocuments.size>0?u.nc=!0:r.modifiedDocuments.size>0?B(u.nc):r.removedDocuments.size>0&&(B(u.nc),u.nc=!1))}),yield Yn(t,i,e)}catch(i){yield _n(i)}}),Xd.apply(this,arguments)}function Qm(n,e,t){const i=P(n);if(i.isPrimaryClient&&0===t||!i.isPrimaryClient&&1===t){const r=[];i.ic.forEach((s,u)=>{const d=u.view.bu(e);d.snapshot&&r.push(d.snapshot)}),function(s,u){const d=P(s);d.onlineState=u;let f=!1;d.queries.forEach((m,g)=>{for(const y of g.listeners)y.bu(u)&&(f=!0)}),f&&jd(d)}(i.eventManager,e),r.length&&i.sc.Wo(r),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}function Uv(n,e,t){return ef.apply(this,arguments)}function ef(){return ef=(0,x.Z)(function*(n,e,t){const i=P(n);i.sharedClientState.updateQueryState(e,"rejected",t);const r=i.cc.get(e),s=r&&r.key;if(s){let u=new we(O.comparator);u=u.insert(s,de.newNoDocument(s,Z.min()));const d=H().add(s),f=new fu(Z.min(),new Map,new oe(W),u,d);yield Hm(i,f),i.uc=i.uc.remove(s),i.cc.delete(e),uf(i)}else yield bo(i.localStore,e,!1).then(()=>So(i,e,t)).catch(_n)}),ef.apply(this,arguments)}function Vv(n,e){return tf.apply(this,arguments)}function tf(){return tf=(0,x.Z)(function*(n,e){const t=P(n),i=e.batch.batchId;try{const r=yield nv(t.localStore,e);of(t,i,null),sf(t,i),t.sharedClientState.updateMutationState(i,"acknowledged"),yield Yn(t,r)}catch(r){yield _n(r)}}),tf.apply(this,arguments)}function qv(n,e,t){return nf.apply(this,arguments)}function nf(){return nf=(0,x.Z)(function*(n,e,t){const i=P(n);try{const r=yield function(s,u){const d=P(s);return d.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return d.mutationQueue.lookupMutationBatch(f,u).next(g=>(B(null!==g),m=g.keys(),d.mutationQueue.removeMutationBatch(f,g))).next(()=>d.mutationQueue.performConsistencyCheck(f)).next(()=>d.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>d.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>d.localDocuments.getDocuments(f,m))})}(i.localStore,e);of(i,e,t),sf(i,e),i.sharedClientState.updateMutationState(e,"rejected",t),yield Yn(i,r)}catch(r){yield _n(r)}}),nf.apply(this,arguments)}function rf(){return rf=(0,x.Z)(function*(n,e){const t=P(n);Qn(t.remoteStore)||R("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const i=yield function(s){const u=P(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",d=>u.mutationQueue.getHighestUnacknowledgedBatchId(d))}(t.localStore);if(-1===i)return void e.resolve();const r=t.lc.get(i)||[];r.push(e),t.lc.set(i,r)}catch(i){const r=ko(i,"Initialization of waitForPendingWrites() operation failed");e.reject(r)}}),rf.apply(this,arguments)}function sf(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function of(n,e,t){const i=P(n);let r=i.hc[i.currentUser.toKey()];if(r){const s=r.get(e);s&&(t?s.reject(t):s.resolve(),r=r.remove(e)),i.hc[i.currentUser.toKey()]=r}}function So(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const i of n.rc.get(e))n.ic.delete(i),t&&n.sc.wc(i,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(i=>{n.ac.containsKey(i)||Ym(n,i)})}function Ym(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Cu(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),uf(n))}function af(n,e,t){for(const i of t)i instanceof jm?(n.ac.addReference(i.key,e),Zv(n,i)):i instanceof Wm?(R("SyncEngine","Document no longer in limbo: "+i.key),n.ac.removeReference(i.key,e),n.ac.containsKey(i.key)||Ym(n,i.key)):U()}function Zv(n,e){const t=e.key,i=t.path.canonicalString();n.uc.get(t)||n.oc.has(i)||(R("SyncEngine","New document in limbo: "+t),n.oc.add(i),uf(n))}function uf(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new O(ee.fromString(e)),i=n.fc.next();n.cc.set(i,new Ov(t)),n.uc=n.uc.insert(t,i),Tl(n.remoteStore,new Ni(be(Ci(t.path)),i,2,ct.at))}}function Yn(n,e,t){return cf.apply(this,arguments)}function cf(){return cf=(0,x.Z)(function*(n,e,t){const i=P(n),r=[],s=[],u=[];var d;i.ic.isEmpty()||(i.ic.forEach((d,f)=>{u.push(i._c(f,e,t).then(m=>{if((m||t)&&i.isPrimaryClient&&i.sharedClientState.updateQueryState(f.targetId,(null==m?void 0:m.fromCache)?"not-current":"current"),m){r.push(m);const g=fd.Ci(f.targetId,m);s.push(g)}}))}),yield Promise.all(u),i.sc.Wo(r),yield(d=(0,x.Z)(function*(f,m){const g=P(f);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",y=>b.forEach(m,w=>b.forEach(w.Si,k=>g.persistence.referenceDelegate.addReference(y,w.targetId,k)).next(()=>b.forEach(w.Di,k=>g.persistence.referenceDelegate.removeReference(y,w.targetId,k)))))}catch(y){if(!yn(y))throw y;R("LocalStore","Failed to update sequence numbers: "+y)}for(const y of m){const w=y.targetId;if(!y.fromCache){const k=g.qi.get(w),M=k.withLastLimboFreeSnapshotVersion(k.snapshotVersion);g.qi=g.qi.insert(w,M)}}}),function(f,m){return d.apply(this,arguments)})(i.localStore,s))}),cf.apply(this,arguments)}function Gv(n,e){return lf.apply(this,arguments)}function lf(){return lf=(0,x.Z)(function*(n,e){const t=P(n);if(!t.currentUser.isEqual(e)){R("SyncEngine","User change. New user:",e.toKey());const i=yield xm(t.localStore,e);t.currentUser=e,(r=t).lc.forEach(u=>{u.forEach(d=>{d.reject(new C(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),r.lc.clear(),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield Yn(t,i.ji)}var r}),lf.apply(this,arguments)}function zv(n,e){const t=P(n),i=t.cc.get(e);if(i&&i.nc)return H().add(i.key);{let r=H();const s=t.rc.get(e);if(!s)return r;for(const u of s){const d=t.ic.get(u);r=r.unionWith(d.view.ju)}return r}}function $v(n,e){return hf.apply(this,arguments)}function hf(){return hf=(0,x.Z)(function*(n,e){const t=P(n),i=yield Il(t.localStore,e.query,!0),r=e.view.tc(i);return t.isPrimaryClient&&af(t,e.targetId,r.Xu),r}),hf.apply(this,arguments)}function jv(n,e){return df.apply(this,arguments)}function df(){return df=(0,x.Z)(function*(n,e){const t=P(n);return Sm(t.localStore,e).then(i=>Yn(t,i))}),df.apply(this,arguments)}function Wv(n,e,t,i){return ff.apply(this,arguments)}function ff(){return ff=(0,x.Z)(function*(n,e,t,i){const r=P(n),s=yield function(u,d){const f=P(u),m=P(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",g=>m.Tn(g,d).next(y=>y?f.localDocuments.getDocuments(g,y):b.resolve(null)))}(r.localStore,e);var d;null!==s?("pending"===t?yield To(r.remoteStore):"acknowledged"===t||"rejected"===t?(of(r,e,i||null),sf(r,e),d=e,P(P(r.localStore).mutationQueue).An(d)):U(),yield Yn(r,s)):R("SyncEngine","Cannot apply mutation batch with id: "+e)}),ff.apply(this,arguments)}function pf(){return pf=(0,x.Z)(function*(n,e){const t=P(n);if(yf(t),vf(t),!0===e&&!0!==t.dc){const i=t.sharedClientState.getAllActiveQueryTargets(),r=yield Jm(t,i.toArray());t.dc=!0,yield Vd(t.remoteStore,!0);for(const s of r)Tl(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const i=[];let r=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?i.push(u):r=r.then(()=>(So(t,u),bo(t.localStore,u,!0))),Cu(t.remoteStore,u)}),yield r,yield Jm(t,i),function(s){const u=P(s);u.cc.forEach((d,f)=>{Cu(u.remoteStore,f)}),u.ac.fs(),u.cc=new Map,u.uc=new we(O.comparator)}(t),t.dc=!1,yield Vd(t.remoteStore,!1)}}),pf.apply(this,arguments)}function Jm(n,e,t){return mf.apply(this,arguments)}function mf(){return mf=(0,x.Z)(function*(n,e,t){const i=P(n),r=[],s=[];for(const u of e){let d;const f=i.rc.get(u);if(f&&0!==f.length){d=yield wo(i.localStore,be(f[0]));for(const m of f){const g=i.ic.get(m),y=yield $v(i,g);y.snapshot&&s.push(y.snapshot)}}else{const m=yield Cm(i.localStore,u);d=yield wo(i.localStore,m),yield Hd(i,Xm(m),u,!1,d.resumeToken)}r.push(d)}return i.sc.Wo(s),r}),mf.apply(this,arguments)}function Xm(n){return su(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function Hv(n){const e=P(n);return P(P(e.localStore).persistence).vi()}function Qv(n,e,t,i){return gf.apply(this,arguments)}function gf(){return gf=(0,x.Z)(function*(n,e,t,i){const r=P(n);if(r.dc)return void R("SyncEngine","Ignoring unexpected query state notification.");const s=r.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield Sm(r.localStore,ho(s[0])),d=fu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Re.EMPTY_BYTE_STRING);yield Yn(r,u,d);break}case"rejected":yield bo(r.localStore,e,!0),So(r,e,i);break;default:U()}}),gf.apply(this,arguments)}function Yv(n,e,t){return _f.apply(this,arguments)}function _f(){return _f=(0,x.Z)(function*(n,e,t){const i=yf(n);if(i.dc){for(const r of e){if(i.rc.has(r)){R("SyncEngine","Adding an already active target "+r);continue}const s=yield Cm(i.localStore,r),u=yield wo(i.localStore,s);yield Hd(i,Xm(s),u.targetId,!1,u.resumeToken),Tl(i.remoteStore,u)}for(const r of t)i.rc.has(r)&&(yield bo(i.localStore,r,!1).then(()=>{Cu(i.remoteStore,r),So(i,r)}).catch(_n))}}),_f.apply(this,arguments)}function yf(n){const e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=Hm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=zv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Uv.bind(null,e),e.sc.Wo=Cv.bind(null,e.eventManager),e.sc.wc=Sv.bind(null,e.eventManager),e}function vf(n){const e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Vv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=qv.bind(null,e),e}class eg{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,x.Z)(function*(){t.yt=ku(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return Tm(this.persistence,new Em,e.initialUser,this.yt)}yc(e){return new wm(yl.Bs,this.yt)}gc(e){return new Om}terminate(){var e=this;return(0,x.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class tg extends eg{constructor(e,t,i){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=i,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,i=this;return(0,x.Z)(function*(){yield t().call(i,e),yield i.Ac.initialize(i,e),yield vf(i.Ac.syncEngine),yield To(i.Ac.remoteStore),yield i.persistence.li(()=>(i.gcScheduler&&!i.gcScheduler.started&&i.gcScheduler.start(),i.indexBackfillerScheduler&&!i.indexBackfillerScheduler.started&&i.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return Tm(this.persistence,new Em,e.initialUser,this.yt)}Tc(e,t){return new By(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const i=new Fh(t,this.persistence);return new Lh(e.asyncQueue,i)}yc(e){const t=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),i=void 0!==this.cacheSizeBytes?It.withCacheSize(this.cacheSizeBytes):It.DEFAULT;return new hd(this.synchronizeTabs,t,e.clientId,i,e.asyncQueue,Pm(),El(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Om}}class Xv extends tg{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,i=this;return(0,x.Z)(function*(){yield t().call(i,e);const r=i.Ac.syncEngine;i.sharedClientState instanceof wd&&(i.sharedClientState.syncEngine={Fr:Wv.bind(null,r),$r:Qv.bind(null,r),Br:Yv.bind(null,r),vi:Hv.bind(null,r),Mr:jv.bind(null,r)},yield i.sharedClientState.start()),yield i.persistence.li(function(){var s=(0,x.Z)(function*(u){yield function Kv(n,e){return pf.apply(this,arguments)}(i.Ac.syncEngine,u),i.gcScheduler&&(u&&!i.gcScheduler.started?i.gcScheduler.start():u||i.gcScheduler.stop()),i.indexBackfillerScheduler&&(u&&!i.indexBackfillerScheduler.started?i.indexBackfillerScheduler.start():u||i.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Pm();if(!wd.C(t))throw new C(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const i=dd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new wd(t,e.asyncQueue,i,e.clientId,e.initialUser)}}class If{initialize(e,t){var i=this;return(0,x.Z)(function*(){i.localStore||(i.localStore=e.localStore,i.sharedClientState=e.sharedClientState,i.datastore=i.createDatastore(t),i.remoteStore=i.createRemoteStore(t),i.eventManager=i.createEventManager(t),i.syncEngine=i.createSyncEngine(t,!e.synchronizeTabs),i.sharedClientState.onlineStateHandler=r=>Qm(i.syncEngine,r,1),i.remoteStore.remoteSyncer.handleCredentialChange=Gv.bind(null,i.syncEngine),yield Vd(i.remoteStore,i.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Av}createDatastore(e){const t=ku(e.databaseInfo.databaseId),i=new lv(e.databaseInfo);return new fv(e.authCredentials,e.appCheckCredentials,i,t)}createRemoteStore(e){return t=this.localStore,i=this.datastore,r=e.asyncQueue,s=d=>Qm(this.syncEngine,d,0),u=Mm.C()?new Mm:new av,new gv(t,i,r,s,u);var t,i,r,s,u}createSyncEngine(e,t){return function(i,r,s,u,d,f,m){const g=new Mv(i,r,s,u,d,f);return m&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,x.Z)(function*(t){const i=P(t);R("RemoteStore","RemoteStore shutting down."),i._u.add(5),yield Eo(i),i.mu.shutdown(),i.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function wf(n,e,t){if(!t)throw new C(E.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function ng(n,e,t,i){if(!0===e&&!0===i)throw new C(E.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function ig(n){if(!O.isDocumentKey(n))throw new C(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function rg(n){if(O.isDocumentKey(n))throw new C(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function kl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":U()}function ie(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new C(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=kl(n);throw new C(E.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function sg(n,e){if(e<=0)throw new C(E.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const og=new Map;class ag{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new C(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new C(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,ng("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Su{constructor(e,t,i,r){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=i,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ag({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new C(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new C(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ag(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Rh;switch(t.type){case"gapi":return new Va(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new C(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=og.get(e);t&&(R("ComponentProvider","Removing Datastore"),og.delete(e),t.terminate())}(this),Promise.resolve()}}class me{constructor(e,t,i){this.converter=t,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new kn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new me(this.firestore,e,this._key)}}class Xe{constructor(e,t,i){this.converter=t,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Xe(this.firestore,e,this._query)}}class kn extends Xe{constructor(e,t,i){super(e,t,Ci(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new me(this.firestore,null,new O(e))}withConverter(e){return new kn(this.firestore,e,this._path)}}function cg(n,e,...t){if(n=(0,re.m9)(n),wf("collection","path",e),n instanceof Su){const i=ee.fromString(e,...t);return rg(i),new kn(n,null,i)}{if(!(n instanceof me||n instanceof kn))throw new C(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ee.fromString(e,...t));return rg(i),new kn(n.firestore,null,i)}}function Al(n,e,...t){if(n=(0,re.m9)(n),1===arguments.length&&(e=Za.R()),wf("doc","path",e),n instanceof Su){const i=ee.fromString(e,...t);return ig(i),new me(n,null,new O(i))}{if(!(n instanceof me||n instanceof kn))throw new C(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ee.fromString(e,...t));return ig(i),new me(n.firestore,n instanceof kn?n.converter:null,new O(i))}}function lg(n,e){return n=(0,re.m9)(n),e=(0,re.m9)(e),(n instanceof me||n instanceof kn)&&(e instanceof me||e instanceof kn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function bf(n,e){return n=(0,re.m9)(n),e=(0,re.m9)(e),n instanceof Xe&&e instanceof Xe&&n.firestore===e.firestore&&qr(n._query,e._query)&&n.converter===e.converter}function hg(n,e=10240){let t=0;return{read:()=>(0,x.Z)(function*(){if(t<n.byteLength){const i={value:n.slice(t,t+e),done:!1};return t+=e,i}return{done:!0}})(),cancel:()=>(0,x.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Cl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):xe("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class t0{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new ke,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(i=>{i&&i.Ou()?this.metadata.resolve(i.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==i?void 0:i.ku)}`))},i=>this.metadata.reject(i))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,x.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,x.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,x.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const i=e.vc.decode(t),r=Number(i);isNaN(r)&&e.Dc(`length string (${i}) is not valid number`);const s=yield e.Cc(r);return new Dv(JSON.parse(s),t.length+r)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,x.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const i=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),i})()}Cc(e){var t=this;return(0,x.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const i=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),i})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,x.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const i=new Uint8Array(e.buffer.length+t.value.length);i.set(e.buffer),i.set(t.value,e.buffer.length),e.buffer=i}return t.done})()}}class s0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,x.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new C(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const i=yield(r=(0,x.Z)(function*(s,u){const d=P(s),f=gu(d.yt)+"/documents",m={documents:u.map(k=>mu(d.yt,k))},g=yield d._o("BatchGetDocuments",f,m,u.length),y=new Map;g.forEach(k=>{const S=function iy(n,e){return"found"in e?function(t,i){B(!!i.found);const r=Tn(t,i.found.name),s=Oe(i.found.updateTime),u=i.found.createTime?Oe(i.found.createTime):Z.min(),d=new Ze({mapValue:{fields:i.found.fields}});return de.newFoundDocument(r,s,u,d)}(n,e):"missing"in e?function(t,i){B(!!i.missing),B(!!i.readTime);const r=Tn(t,i.missing),s=Oe(i.readTime);return de.newNoDocument(r,s)}(n,e):U()}(d.yt,k);y.set(S.key.toString(),S)});const w=[];return u.forEach(k=>{const S=y.get(k.toString());B(!!S),w.push(S)}),w}),function(s,u){return r.apply(this,arguments)})(t.datastore,e);var r;return i.forEach(r=>t.recordVersion(r)),i})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(i){this.lastWriteError=i}this.writtenDocs.add(e.toString())}delete(e){this.write(new Hn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,x.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var i;e.mutations.forEach(i=>{t.delete(i.key.toString())}),t.forEach((i,r)=>{const s=O.fromPath(r);e.mutations.push(new Zr(s,e.precondition(s)))}),yield(i=(0,x.Z)(function*(r,s){const u=P(r),d=gu(u.yt)+"/documents",f={writes:s.map(m=>_u(u.yt,m))};yield u.ao("Commit",d,f)}),function(r,s){return i.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw U();t=Z.min()}const i=this.readVersions.get(e.key.toString());if(i){if(!t.isEqual(i))throw new C(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(Z.min())?A.exists(!1):A.updateTime(t):A.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(Z.min()))throw new C(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return A.updateTime(t)}return A.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class o0{constructor(e,t,i,r,s){this.asyncQueue=e,this.datastore=t,this.options=i,this.updateFunction=r,this.deferred=s,this.kc=i.maxAttempts,this.xo=new bd(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,x.Z)(function*(){const t=new s0(e.datastore),i=e.Mc(t);i&&i.then(r=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(r)}).catch(s=>{e.Fc(s)}))}).catch(r=>{e.Fc(r)})}))}Mc(e){try{const t=this.updateFunction(e);return!Mr(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ol(t)}return!1}}class a0{constructor(e,t,i,r){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=i,this.databaseInfo=r,this.user=Ce.UNAUTHENTICATED,this.clientId=Za.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(i,function(){var u=(0,x.Z)(function*(d){R("FirestoreClient","Received user=",d.uid),yield s.authCredentialListener(d),s.user=d});return function(d){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(i,u=>(R("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,x.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new C(E.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new ke;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(i){const r=ko(i,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}function dg(n,e){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),R("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let i=t.initialUser;n.setCredentialChangeListener(function(){var r=(0,x.Z)(function*(s){i.isEqual(s)||(yield xm(e.localStore,s),i=s)});return function(s){return r.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),Ef.apply(this,arguments)}function fg(n,e){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,x.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield xf(n);R("FirestoreClient","Initializing OnlineComponentProvider");const i=yield n.getConfiguration();yield e.initialize(t,i),n.setCredentialChangeListener(r=>Zm(e.remoteStore,r)),n.setAppCheckTokenChangeListener((r,s)=>Zm(e.remoteStore,s)),n.onlineComponents=e}),Tf.apply(this,arguments)}function xf(n){return kf.apply(this,arguments)}function kf(){return kf=(0,x.Z)(function*(n){return n.offlineComponents||(R("FirestoreClient","Using default OfflineComponentProvider"),yield dg(n,new eg)),n.offlineComponents}),kf.apply(this,arguments)}function Sl(n){return Af.apply(this,arguments)}function Af(){return Af=(0,x.Z)(function*(n){return n.onlineComponents||(R("FirestoreClient","Using default OnlineComponentProvider"),yield fg(n,new If)),n.onlineComponents}),Af.apply(this,arguments)}function pg(n){return xf(n).then(e=>e.persistence)}function Dl(n){return xf(n).then(e=>e.localStore)}function Cf(n){return Sl(n).then(e=>e.remoteStore)}function Sf(n){return Sl(n).then(e=>e.syncEngine)}function Do(n){return Df.apply(this,arguments)}function Df(){return Df=(0,x.Z)(function*(n){const e=yield Sl(n),t=e.eventManager;return t.onListen=Pv.bind(null,e.syncEngine),t.onUnlisten=Lv.bind(null,e.syncEngine),t}),Df.apply(this,arguments)}function gg(n,e,t={}){const i=new ke;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(r,s,u,d,f){const m=new Cl({next:y=>{s.enqueueAndForget(()=>zd(r,g));const w=y.docs.has(u);!w&&y.fromCache?f.reject(new C(E.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&y.fromCache&&d&&"server"===d.source?f.reject(new C(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(y)},error:y=>f.reject(y)}),g=new Wd(Ci(u.path),m,{includeMetadataChanges:!0,Nu:!0});return Zd(r,g)}(yield Do(n),n.asyncQueue,e,t,i)})),i.promise}function _g(n,e,t={}){const i=new ke;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function(r,s,u,d,f){const m=new Cl({next:y=>{s.enqueueAndForget(()=>zd(r,g)),y.fromCache&&"server"===d.source?f.reject(new C(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(y)},error:y=>f.reject(y)}),g=new Wd(u,m,{includeMetadataChanges:!0,Nu:!0});return Zd(r,g)}(yield Do(n),n.asyncQueue,e,t,i)})),i.promise}class m0{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new bd(this,"async_queue_retry"),this.Wc=()=>{const t=El();t&&R("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=El();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=El();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new ke;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,x.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!yn(t))throw t;R("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(i=>{throw this.Kc=i,this.Gc=!1,xe("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(i)),i}).then(i=>(this.Gc=!1,i))));return this.Bc=t,t}enqueueAfterDelay(e,t,i){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const r=Bd.createAndSchedule(this,e,t,i,s=>this.Yc(s));return this.Uc.push(r),r}zc(){this.Kc&&U()}verifyOperationInProgress(){}Xc(){var e=this;return(0,x.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,i)=>t.targetTimeMs-i.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Rf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const i=e;for(const r of["next","error","complete"])if(r in i&&"function"==typeof i[r])return!0;return!1}(n)}class g0{constructor(){this._progressObserver={},this._taskCompletionResolver=new ke,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,i){this._progressObserver={next:e,error:t,complete:i}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ge extends Su{constructor(e,t,i,r){super(e,t,i,r),this.type="firestore",this._queue=new m0,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||yg(this),this._firestoreClient.terminate()}}function Me(n){return n._firestoreClient||yg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function yg(n){var e;const t=n._freezeSettings(),i=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Uh(n._databaseId,s,n._persistenceKey,(d=t).host,d.ssl,d.experimentalForceLongPolling,d.experimentalAutoDetectLongPolling,d.useFetchStreams));var s,d;n._firestoreClient=new a0(n._authCredentials,n._appCheckCredentials,n._queue,i)}function vg(n,e,t){const i=new ke;return n.asyncQueue.enqueue((0,x.Z)(function*(){try{yield dg(n,t),yield fg(n,e),i.resolve()}catch(r){const s=r;if(!("FirebaseError"===(u=s).name?u.code===E.FAILED_PRECONDITION||u.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;tn("Error enabling offline persistence. Falling back to persistence disabled: "+s),i.reject(s)}var u})).then(()=>i.promise)}function Ig(n){if(n._initialized||n._terminated)throw new C(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class An{constructor(e){this._byteString=e}static fromBase64String(e){try{return new An(Re.fromBase64String(e))}catch(t){throw new C(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new An(Re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class Jn{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new C(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ve(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Qr{constructor(e){this._methodName=e}}class Rl{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new C(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new C(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return W(this._lat,e._lat)||W(this._long,e._long)}}const k0=/^__.*__$/;class A0{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return null!==this.fieldMask?new Ft(e,this.data,this.fieldMask,t,this.fieldTransforms):new bn(e,this.data,t,this.fieldTransforms)}}class wg{constructor(e,t,i){this.data=e,this.fieldMask=t,this.fieldTransforms=i}toMutation(e,t){return new Ft(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function bg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw U()}}class Nl{constructor(e,t,i,r,s,u){this.settings=e,this.databaseId=t,this.yt=i,this.ignoreUndefinedProperties=r,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Nl(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.ua(e),r}ca(e){var t;const i=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.ia({path:i,oa:!1});return r.na(),r}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Pl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(bg(this.sa)&&k0.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class C0{constructor(e,t,i){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=i||ku(e)}da(e,t,i,r=!1){return new Nl({sa:e,methodName:t,fa:i,path:ve.emptyPath(),oa:!1,la:r},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Yr(n){const e=n._freezeSettings(),t=ku(n._databaseId);return new C0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Ol(n,e,t,i,r,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,r);Pf("Data must be an object, but it was:",u,i);const d=xg(i,u);let f,m;if(s.merge)f=new lt(u.fieldMask),m=u.fieldTransforms;else if(s.mergeFields){const g=[];for(const y of s.mergeFields){const w=Lf(e,y,t);if(!u.contains(w))throw new C(E.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Ag(g,w)||g.push(w)}f=new lt(g),m=u.fieldTransforms.filter(y=>f.covers(y.field))}else f=null,m=u.fieldTransforms;return new A0(new Ze(d),f,m)}class Du extends Qr{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Du}}function Eg(n,e,t){return new Nl({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class Nf extends Qr{_toFieldTransform(e){return new _(e.path,new Di)}isEqual(e){return e instanceof Nf}}class S0 extends Qr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Eg(this,e,!0),i=this._a.map(s=>Jr(s,t)),r=new Kn(i);return new _(e.path,r)}isEqual(e){return this===e}}class D0 extends Qr{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Eg(this,e,!0),i=this._a.map(s=>Jr(s,t)),r=new c(i);return new _(e.path,r)}isEqual(e){return this===e}}class R0 extends Qr{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new a(e.yt,ou(e.yt,this.wa));return new _(e.path,t)}isEqual(e){return this===e}}function Of(n,e,t,i){const r=n.da(1,e,t);Pf("Data must be an object, but it was:",r,i);const s=[],u=Ze.empty();Gn(i,(f,m)=>{const g=Ml(e,f,t);m=(0,re.m9)(m);const y=r.ca(g);if(m instanceof Du)s.push(g);else{const w=Jr(m,y);null!=w&&(s.push(g),u.set(g,w))}});const d=new lt(s);return new wg(u,d,r.fieldTransforms)}function Mf(n,e,t,i,r,s){const u=n.da(1,e,t),d=[Lf(e,i,t)],f=[r];if(s.length%2!=0)throw new C(E.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)d.push(Lf(e,s[w])),f.push(s[w+1]);const m=[],g=Ze.empty();for(let w=d.length-1;w>=0;--w)if(!Ag(m,d[w])){const k=d[w];let S=f[w];S=(0,re.m9)(S);const M=u.ca(k);if(S instanceof Du)m.push(k);else{const V=Jr(S,M);null!=V&&(m.push(k),g.set(k,V))}}const y=new lt(m);return new wg(g,y,u.fieldTransforms)}function Tg(n,e,t,i=!1){return Jr(t,n.da(i?4:3,e))}function Jr(n,e){if(kg(n=(0,re.m9)(n)))return Pf("Unsupported field value:",e,n),xg(n,e);if(n instanceof Qr)return function(t,i){if(!bg(i.sa))throw i.ha(`${t._methodName}() can only be used with update() and set()`);if(!i.path)throw i.ha(`${t._methodName}() is not currently supported inside arrays`);const r=t._toFieldTransform(i);r&&i.fieldTransforms.push(r)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,i){const r=[];let s=0;for(const u of t){let d=Jr(u,i.aa(s));null==d&&(d={nullValue:"NULL_VALUE"}),r.push(d),s++}return{arrayValue:{values:r}}}(n,e)}return function(t,i){if(null===(t=(0,re.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return ou(i.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const r=le.fromDate(t);return{timestampValue:go(i.yt,r)}}if(t instanceof le){const r=new le(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:go(i.yt,r)}}if(t instanceof Rl)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof An)return{bytesValue:Np(i.yt,t._byteString)};if(t instanceof me){const r=i.databaseId,s=t.firestore._databaseId;if(!s.isEqual(r))throw i.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:Kh(t.firestore._databaseId||i.databaseId,t._key.path)}}throw i.ha(`Unsupported field value: ${kl(t)}`)}(n,e)}function xg(n,e){const t={};return Fc(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Gn(n,(i,r)=>{const s=Jr(r,e.ra(i));null!=s&&(t[i]=s)}),{mapValue:{fields:t}}}function kg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof le||n instanceof Rl||n instanceof An||n instanceof me||n instanceof Qr)}function Pf(n,e,t){if(!kg(t)||"object"!=typeof(i=t)||null===i||Object.getPrototypeOf(i)!==Object.prototype&&null!==Object.getPrototypeOf(i)){const i=kl(t);throw e.ha("an object"===i?n+" a custom object":n+" "+i)}var i}function Lf(n,e,t){if((e=(0,re.m9)(e))instanceof Jn)return e._internalPath;if("string"==typeof e)return Ml(n,e);throw Pl("Field path arguments must be of type string or ",n,!1,void 0,t)}const N0=new RegExp("[~\\*/\\[\\]]");function Ml(n,e,t){if(e.search(N0)>=0)throw Pl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new Jn(...e.split("."))._internalPath}catch(i){throw Pl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Pl(n,e,t,i,r){const s=i&&!i.isEmpty(),u=void 0!==r;let d=`Function ${e}() called with invalid data`;t&&(d+=" (via `toFirestore()`)"),d+=". ";let f="";return(s||u)&&(f+=" (found",s&&(f+=` in field ${i}`),u&&(f+=` in document ${r}`),f+=")"),new C(E.INVALID_ARGUMENT,d+n+f)}function Ag(n,e){return n.some(t=>t.isEqual(e))}class Ru{constructor(e,t,i,r,s){this._firestore=e,this._userDataWriter=t,this._key=i,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new me(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new O0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ll("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class O0 extends Ru{data(){return super.data()}}function Ll(n,e){return"string"==typeof e?Ml(n,e):e instanceof Jn?e._internalPath:e._delegate._internalPath}function Cg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new C(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ff{}class Nu extends Ff{}function Fi(n,e,...t){let i=[];e instanceof Ff&&i.push(e),i=i.concat(t),function(r){const s=r.filter(d=>d instanceof Ro).length,u=r.filter(d=>d instanceof Ou).length;if(s>1||s>0&&u>0)throw new C(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const r of i)n=r._apply(n);return n}class Ou extends Nu{constructor(e,t,i){super(),this._field=e,this._op=t,this._value=i,this.type="where"}static _create(e,t,i){return new Ou(e,t,i)}_apply(e){const t=this._parse(e);return Ng(e._query,t),new Xe(e.firestore,e.converter,uo(e._query,t))}_parse(e){const t=Yr(e.firestore);return function(r,s,u,d,f,m,g){let y;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new C(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Rg(g,m);const w=[];for(const k of g)w.push(Dg(d,r,k));y={arrayValue:{values:w}}}else y=Dg(d,r,g)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Rg(g,m),y=Tg(u,"where",g,"in"===m||"not-in"===m);return J.create(f,m,y)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Ro extends Ff{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Ro(e,t)}_parse(e){const t=this._queryConstraints.map(i=>i._parse(e)).filter(i=>i.getFilters().length>0);return 1===t.length?t[0]:ce.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(i,r){let s=i;const u=r.getFlattenedFilters();for(const d of u)Ng(s,d),s=uo(s,d)}(e._query,t),new Xe(e.firestore,e.converter,uo(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Uf extends Nu{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Uf(e,t)}_apply(e){const t=function(i,r,s){if(null!==i.startAt)throw new C(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==i.endAt)throw new C(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new $n(r,s);return function(d,f){if(null===Vr(d)){const m=oo(d);null!==m&&Og(0,m,f.field)}}(i,u),u}(e._query,this._field,this._direction);return new Xe(e.firestore,e.converter,function(i,r){const s=i.explicitOrderBy.concat([r]);return new ht(i.path,i.collectionGroup,s,i.filters.slice(),i.limit,i.limitType,i.startAt,i.endAt)}(e._query,t))}}class Fl extends Nu{constructor(e,t,i){super(),this.type=e,this._limit=t,this._limitType=i}static _create(e,t,i){return new Fl(e,t,i)}_apply(e){return new Xe(e.firestore,e.converter,co(e._query,this._limit,this._limitType))}}class Ul extends Nu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Ul(e,t,i)}_apply(e){const t=Sg(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,(r=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,r,i.endAt)));var i,r}}class Vl extends Nu{constructor(e,t,i){super(),this.type=e,this._docOrFields=t,this._inclusive=i}static _create(e,t,i){return new Vl(e,t,i)}_apply(e){const t=Sg(e,this.type,this._docOrFields,this._inclusive);return new Xe(e.firestore,e.converter,(r=t,new ht((i=e._query).path,i.collectionGroup,i.explicitOrderBy.slice(),i.filters.slice(),i.limit,i.limitType,i.startAt,r)));var i,r}}function Sg(n,e,t,i){if(t[0]=(0,re.m9)(t[0]),t[0]instanceof Ru)return function(r,s,u,d,f){if(!d)throw new C(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of Wn(r))if(g.field.isKeyField())m.push(zn(s,d.key));else{const y=d.data.field(g.field);if(Ya(y))throw new C(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===y){const w=g.field.canonicalString();throw new C(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}m.push(y)}return new wn(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,i);{const r=Yr(n.firestore);return function(s,u,d,f,m,g){const y=s.explicitOrderBy;if(m.length>y.length)throw new C(E.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let k=0;k<m.length;k++){const S=m[k];if(y[k].field.isKeyField()){if("string"!=typeof S)throw new C(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof S}`);if(!ao(s)&&-1!==S.indexOf("/"))throw new C(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${S}' contains a slash.`);const M=s.path.child(ee.fromString(S));if(!O.isDocumentKey(M))throw new C(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const V=new O(M);w.push(zn(u,V))}else{const M=Tg(d,f,S);w.push(M)}}return new wn(w,g)}(n._query,n.firestore._databaseId,r,e,t,i)}}function Dg(n,e,t){if("string"==typeof(t=(0,re.m9)(t))){if(""===t)throw new C(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ao(e)&&-1!==t.indexOf("/"))throw new C(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const i=e.path.child(ee.fromString(t));if(!O.isDocumentKey(i))throw new C(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return zn(n,new O(i))}if(t instanceof me)return zn(n,t._key);throw new C(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${kl(t)}.`)}function Rg(n,e){if(!Array.isArray(n)||0===n.length)throw new C(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new C(E.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Ng(n,e){if(e.isInequality()){const i=oo(n),r=e.field;if(null!==i&&!i.isEqual(r))throw new C(E.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${i.toString()}' and '${r.toString()}'`);const s=Vr(n);null!==s&&Og(0,r,s)}const t=function(i,r){for(const s of i)for(const u of s.getFlattenedFilters())if(r.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(i){switch(i){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new C(E.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Og(n,e,t){if(!t.isEqual(e))throw new C(E.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Vf{convertValue(e,t="none"){switch(sn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ie(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nn(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw U()}}convertObject(e,t){const i={};return Gn(e.fields,(r,s)=>{i[r]=this.convertValue(s,t)}),i}convertGeoPoint(e){return new Rl(Ie(e.latitude),Ie(e.longitude))}convertArray(e,t){return(e.values||[]).map(i=>this.convertValue(i,t))}convertServerTimestamp(e,t){switch(t){case"previous":const i=Ys(e);return null==i?null:this.convertValue(i,t);case"estimate":return this.convertTimestamp(Lr(e));default:return null}}convertTimestamp(e){const t=In(e);return new le(t.seconds,t.nanos)}convertDocumentKey(e,t){const i=ee.fromString(e);B(Zp(i));const r=new vn(i.get(1),i.get(3)),s=new O(i.popFirst(5));return r.isEqual(t)||xe(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function ql(n,e,t){let i;return i=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,i}class Z0 extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new An(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}}class Xr{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Xn extends Ru{constructor(e,t,i,r,s,u){super(e,t,i,r,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Mu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const i=this._document.data.field(Ll("DocumentSnapshot.get",e));if(null!==i)return this._userDataWriter.convertValue(i,t.serverTimestamps)}}}class Mu extends Xn{data(e={}){return super.data(e)}}class Ui{constructor(e,t,i,r){this._firestore=e,this._userDataWriter=t,this._snapshot=r,this.metadata=new Xr(r.hasPendingWrites,r.fromCache),this.query=i}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(i=>{e.call(t,new Mu(this._firestore,this._userDataWriter,i.key,i,new Xr(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new C(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(i,r){if(i._snapshot.oldDocs.isEmpty()){let s=0;return i._snapshot.docChanges.map(u=>({type:"added",doc:new Mu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Xr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter),oldIndex:-1,newIndex:s++}))}{let s=i._snapshot.oldDocs;return i._snapshot.docChanges.filter(u=>r||3!==u.type).map(u=>{const d=new Mu(i._firestore,i._userDataWriter,u.doc.key,u.doc,new Xr(i._snapshot.mutatedKeys.has(u.doc.key),i._snapshot.fromCache),i.query.converter);let f=-1,m=-1;return 0!==u.type&&(f=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),m=s.indexOf(u.doc.key)),{type:G0(u.type),doc:d,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function G0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return U()}}function Pg(n,e){return n instanceof Xn&&e instanceof Xn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Ui&&e instanceof Ui&&n._firestore===e._firestore&&bf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Vi extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new An(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new me(this.firestore,null,t)}}function Lg(n,e,t){n=ie(n,me);const i=ie(n.firestore,ge),r=ql(n.converter,e,t);return No(i,[Ol(Yr(i),"setDoc",n._key,r,null!==n.converter,t).toMutation(n._key,A.none())])}function Fg(n,e,t,...i){n=ie(n,me);const r=ie(n.firestore,ge),s=Yr(r);let u;return u="string"==typeof(e=(0,re.m9)(e))||e instanceof Jn?Mf(s,"updateDoc",n._key,e,t,i):Of(s,"updateDoc",n._key,e),No(r,[u.toMutation(n._key,A.exists(!0))])}function Ug(n,...e){var t,i,r;n=(0,re.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Rf(e[u])||(s=e[u],u++);const d={includeMetadataChanges:s.includeMetadataChanges};if(Rf(e[u])){const y=e[u];e[u]=null===(t=y.next)||void 0===t?void 0:t.bind(y),e[u+1]=null===(i=y.error)||void 0===i?void 0:i.bind(y),e[u+2]=null===(r=y.complete)||void 0===r?void 0:r.bind(y)}let f,m,g;if(n instanceof me)m=ie(n.firestore,ge),g=Ci(n._key.path),f={next:y=>{e[u]&&e[u](qf(m,n,y))},error:e[u+1],complete:e[u+2]};else{const y=ie(n,Xe);m=ie(y.firestore,ge),g=y._query;const w=new Vi(m);f={next:k=>{e[u]&&e[u](new Ui(m,w,y,k))},error:e[u+1],complete:e[u+2]},Cg(n._query)}return function(y,w,k,S){const M=new Cl(S),V=new Wd(w,M,k);return y.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return Zd(yield Do(y),V)})),()=>{M.bc(),y.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return zd(yield Do(y),V)}))}}(Me(m),g,d,f)}function No(n,e){return function(t,i){const r=new ke;return t.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function Fv(n,e,t){return Jd.apply(this,arguments)}(yield Sf(t),i,r)})),r.promise}(Me(n),e)}function qf(n,e,t){const i=t.docs.get(e._key),r=new Vi(n);return new Xn(n,r,e._key,i,new Xr(t.hasPendingWrites,t.fromCache),e.converter)}const X0={maxAttempts:5};class Vg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Yr(e)}set(e,t,i){this._verifyNotCommitted();const r=qi(e,this._firestore),s=ql(r.converter,t,i),u=Ol(this._dataReader,"WriteBatch.set",r._key,s,null!==r.converter,i);return this._mutations.push(u.toMutation(r._key,A.none())),this}update(e,t,i,...r){this._verifyNotCommitted();const s=qi(e,this._firestore);let u;return u="string"==typeof(t=(0,re.m9)(t))||t instanceof Jn?Mf(this._dataReader,"WriteBatch.update",s._key,t,i,r):Of(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,A.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=qi(e,this._firestore);return this._mutations=this._mutations.concat(new Hn(t._key,A.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new C(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function qi(n,e){if((n=(0,re.m9)(n)).firestore!==e)throw new C(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class eI extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Yr(e)}get(e){const t=qi(e,this._firestore),i=new Z0(this._firestore);return this._transaction.lookup([t._key]).then(r=>{if(!r||1!==r.length)return U();const s=r[0];if(s.isFoundDocument())return new Ru(this._firestore,i,s.key,s,t.converter);if(s.isNoDocument())return new Ru(this._firestore,i,t._key,null,t.converter);throw U()})}set(e,t,i){const r=qi(e,this._firestore),s=ql(r.converter,t,i),u=Ol(this._dataReader,"Transaction.set",r._key,s,null!==r.converter,i);return this._transaction.set(r._key,u),this}update(e,t,i,...r){const s=qi(e,this._firestore);let u;return u="string"==typeof(t=(0,re.m9)(t))||t instanceof Jn?Mf(this._dataReader,"Transaction.update",s._key,t,i,r):Of(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=qi(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=qi(e,this._firestore),i=new Vi(this._firestore);return super.get(e).then(r=>new Xn(this._firestore,i,t._key,r._document,new Xr(!1,!1),t.converter))}}function Bf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new C("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Bg(){if("undefined"==typeof Uint8Array)throw new C("unimplemented","Uint8Arrays are not available in this environment.")}function Zg(){if(!function Vc(){return"undefined"!=typeof atob}())throw new C("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Nt=dn.SDK_VERSION,(0,dn._registerComponent)(new Hi.wA("firestore",(t,{instanceIdentifier:i,options:r})=>{const s=t.getProvider("app").getImmediate(),u=new ge(new Nh(t.getProvider("auth-internal")),new qa(t.getProvider("app-check-internal")),function(d,f){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new C(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new vn(d.options.projectId,f)}(s,i),s);return r=Object.assign({useFetchStreams:e},r),u._setSettings(r),u},"PUBLIC").setMultipleInstances(!0)),(0,dn.registerVersion)(Mc,"3.8.0",n),(0,dn.registerVersion)(Mc,"3.8.0","esm2017")}();class Pu{constructor(e){this._delegate=e}static fromBase64String(e){return Zg(),new Pu(An.fromBase64String(e))}static fromUint8Array(e){return Bg(),new Pu(An.fromUint8Array(e))}toBase64(){return Zg(),this._delegate.toBase64()}toUint8Array(){return Bg(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Zf(n){return function cI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const i of e)if(i in t&&"function"==typeof t[i])return!0;return!1}(n,["next","error","complete"])}class lI{enableIndexedDbPersistence(e,t){return function y0(n,e){Ig(n=ie(n,ge));const t=Me(n),i=n._freezeSettings(),r=new If;return vg(t,r,new tg(r,i.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function v0(n){Ig(n=ie(n,ge));const e=Me(n),t=n._freezeSettings(),i=new If;return vg(e,i,new Xv(i,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function I0(n){if(n._initialized&&!n._terminated)throw new C(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new ke;return n._queue.enqueueAndForgetEvenWhileRestricted((0,x.Z)(function*(){try{yield(t=(0,x.Z)(function*(i){if(!Et.C())return Promise.resolve();const r=i+"main";yield Et.delete(r)}),function(i){return t.apply(this,arguments)})(dd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class Gg{constructor(e,t,i){this._delegate=t,this._persistenceProvider=i,this.INTERNAL={delete:()=>this.terminate()},e instanceof vn||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&tn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,i={}){!function ug(n,e,t,i={}){var r;const s=(n=ie(n,Su))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&tn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),i.mockUserToken){let u,d;if("string"==typeof i.mockUserToken)u=i.mockUserToken,d=Ce.MOCK_USER;else{u=(0,re.Sg)(i.mockUserToken,null===(r=n._app)||void 0===r?void 0:r.options.projectId);const f=i.mockUserToken.sub||i.mockUserToken.user_id;if(!f)throw new C(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");d=new Ce(f)}n._authCredentials=new Sr(new $s(u,d))}}(this._delegate,e,t,i)}enableNetwork(){return function b0(n){return function u0(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield pg(n),t=yield Cf(n);return e.setNetworkEnabled(!0),function(i){const r=P(i);return r._u.delete(0),Au(r)}(t)}))}(Me(n=ie(n,ge)))}(this._delegate)}disableNetwork(){return function E0(n){return function c0(n){return n.asyncQueue.enqueue((0,x.Z)(function*(){const e=yield pg(n),t=yield Cf(n);return e.setNetworkEnabled(!1),(i=(0,x.Z)(function*(r){const s=P(r);s._u.add(0),yield Eo(s),s.gu.set("Offline")}),function(r){return i.apply(this,arguments)})(t);var i}))}(Me(n=ie(n,ge)))}(this._delegate)}enablePersistence(e){let t=!1,i=!1;return e&&(t=!!e.synchronizeTabs,i=!!e.experimentalForceOwningTab,ng("synchronizeTabs",t,"experimentalForceOwningTab",i)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,i)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function w0(n){return function(e){const t=new ke;return e.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return function Bv(n,e){return rf.apply(this,arguments)}(yield Sf(e),t)})),t.promise}(Me(n=ie(n,ge)))}(this._delegate)}onSnapshotsInSync(e){return function J0(n,e){return function d0(n,e){const t=new Cl(e);return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return i=yield Do(n),r=t,P(i).Ru.add(r),void r.next();var i,r})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return i=yield Do(n),r=t,void P(i).Ru.delete(r);var i,r}))}}(Me(n=ie(n,ge)),Rf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new C("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Oo(this,cg(this._delegate,e))}catch(t){throw ft(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ut(this,Al(this._delegate,e))}catch(t){throw ft(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new pt(this,function e0(n,e){if(n=ie(n,Su),wf("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new C(E.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Xe(n,null,(t=e,new ht(ee.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw ft(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function tI(n,e,t){n=ie(n,ge);const i=Object.assign(Object.assign({},X0),t);return function(r){if(r.maxAttempts<1)throw new C(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(r,s,u){const d=new ke;return r.asyncQueue.enqueueAndForget((0,x.Z)(function*(){const f=yield function mg(n){return Sl(n).then(e=>e.datastore)}(r);new o0(r.asyncQueue,f,u,s,d).run()})),d.promise}(Me(n),r=>e(new eI(n,r)),i)}(this._delegate,t=>e(new zg(this,t)))}batch(){return Me(this._delegate),new $g(new Vg(this._delegate,e=>No(this._delegate,e)))}loadBundle(e){return function T0(n,e){const t=Me(n=ie(n,ge)),i=new g0;return function f0(n,e,t,i){const r=function(s,u){let d;return d="string"==typeof s?(new TextEncoder).encode(s):s,f=function(f,m){if(f instanceof Uint8Array)return hg(f,m);if(f instanceof ArrayBuffer)return hg(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(d),new t0(f,u);var f}(t,ku(e));n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){!function Jv(n,e,t){const i=P(n);var r;(r=(0,x.Z)(function*(s,u,d){try{const f=yield u.getMetadata();if(yield function(w,k){const S=P(w),M=Oe(k.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",V=>S.Ns.getBundleMetadata(V,k.id)).then(V=>!!V&&V.createTime.compareTo(M)>=0)}(s.localStore,f))return yield u.close(),d._completeWith({taskState:"Success",documentsLoaded:(w=f).totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}),Promise.resolve(new Set);d._updateProgress($m(f));const m=new Rv(f,s.localStore,u.yt);let g=yield u.mc();for(;g;){const w=yield m.Fu(g);w&&d._updateProgress(w),g=yield u.mc()}const y=yield m.complete();return yield Yn(s,y.Lu,void 0),yield function(w,k){const S=P(w);return S.persistence.runTransaction("Save bundle","readwrite",M=>S.Ns.saveBundleMetadata(M,k))}(s.localStore,f),d._completeWith(y.progress),Promise.resolve(y.Bu)}catch(f){return tn("SyncEngine",`Loading bundle failed with ${f}`),d._failWith(f),Promise.resolve(new Set)}var w}),function(s,u,d){return r.apply(this,arguments)})(i,e,t).then(r=>{i.sharedClientState.notifyBundleLoaded(r)})}(yield Sf(n),r,i)}))}(t,n._databaseId,e,i),i}(this._delegate,e)}namedQuery(e){return function x0(n,e){return function p0(n,e){return n.asyncQueue.enqueue((0,x.Z)(function*(){return function(t,i){const r=P(t);return r.persistence.runTransaction("Get named query","readonly",s=>r.Ns.getNamedQuery(s,i))}(yield Dl(n),e)}))}(Me(n=ie(n,ge)),e).then(t=>t?new Xe(n,null,t.query):null)}(this._delegate,e).then(t=>t?new pt(this,t):null)}}class Bl extends Vf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Pu(new An(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ut.forKey(t,this.firestore,null)}}class zg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Bl(e)}get(e){const t=ts(e);return this._delegate.get(t).then(i=>new Lu(this._firestore,new Xn(this._firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,t.converter)))}set(e,t,i){const r=ts(e);return i?(Bf("Transaction.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=ts(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=ts(e);return this._delegate.delete(t),this}}class $g{constructor(e){this._delegate=e}set(e,t,i){const r=ts(e);return i?(Bf("WriteBatch.set",i),this._delegate.set(r,t,i)):this._delegate.set(r,t),this}update(e,t,i,...r){const s=ts(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,i,...r),this}delete(e){const t=ts(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class es{constructor(e,t,i){this._firestore=e,this._userDataWriter=t,this._delegate=i}fromFirestore(e,t){const i=new Mu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Fu(this._firestore,i),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const i=es.INSTANCES;let r=i.get(e);r||(r=new WeakMap,i.set(e,r));let s=r.get(t);return s||(s=new es(e,new Bl(e),t),r.set(t,s)),s}}es.INSTANCES=new WeakMap;class Ut{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Bl(e)}static forPath(e,t,i){if(e.length%2!=0)throw new C("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ut(t,new me(t._delegate,i,new O(e)))}static forKey(e,t,i){return new Ut(t,new me(t._delegate,i,e))}get id(){return this._delegate.id}get parent(){return new Oo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Oo(this.firestore,cg(this._delegate,e))}catch(t){throw ft(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,re.m9)(e))instanceof me&&lg(this._delegate,e)}set(e,t){t=Bf("DocumentReference.set",t);try{return t?Lg(this._delegate,e,t):Lg(this._delegate,e)}catch(i){throw ft(i,"setDoc()","DocumentReference.set()")}}update(e,t,...i){try{return 1===arguments.length?Fg(this._delegate,e):Fg(this._delegate,e,t,...i)}catch(r){throw ft(r,"updateDoc()","DocumentReference.update()")}}delete(){return function Q0(n){return No(ie(n.firestore,ge),[new Hn(n._key,A.none())])}(this._delegate)}onSnapshot(...e){const t=jg(e),i=Wg(e,r=>new Lu(this.firestore,new Xn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)));return Ug(this._delegate,t,i)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function $0(n){n=ie(n,me);const e=ie(n.firestore,ge),t=Me(e),i=new Vi(e);return function l0(n,e){const t=new ke;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(i=(0,x.Z)(function*(r,s,u){try{const d=yield function(f,m){const g=P(f);return g.persistence.runTransaction("read document","readonly",y=>g.localDocuments.getDocument(y,m))}(r,s);d.isFoundDocument()?u.resolve(d):d.isNoDocument()?u.resolve(null):u.reject(new C(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(d){const f=ko(d,`Failed to get document '${s} from cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield Dl(n),e,t);var i})),t.promise}(t,n._key).then(r=>new Xn(e,i,n._key,r,new Xr(null!==r&&r.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function j0(n){n=ie(n,me);const e=ie(n.firestore,ge);return gg(Me(e),n._key,{source:"server"}).then(t=>qf(e,n,t))}(this._delegate):function z0(n){n=ie(n,me);const e=ie(n.firestore,ge);return gg(Me(e),n._key).then(t=>qf(e,n,t))}(this._delegate),t.then(i=>new Lu(this.firestore,new Xn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)))}withConverter(e){return new Ut(this.firestore,this._delegate.withConverter(e?es.getInstance(this.firestore,e):null))}}function ft(n,e,t){return n.message=n.message.replace(e,t),n}function jg(n){for(const e of n)if("object"==typeof e&&!Zf(e))return e;return{}}function Wg(n,e){var t,i;let r;return r=Zf(n[0])?n[0]:Zf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{r.next&&r.next(e(s))},error:null===(t=r.error)||void 0===t?void 0:t.bind(r),complete:null===(i=r.complete)||void 0===i?void 0:i.bind(r)}}class Lu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ut(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Pg(this._delegate,e._delegate)}}class Fu extends Lu{data(e){const t=this._delegate.data(e);return function Ua(n,e){n||U()}(void 0!==t),t}}class pt{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Bl(e)}where(e,t,i){try{return new pt(this.firestore,Fi(this._delegate,function M0(n,e,t){const i=e,r=Ll("where",n);return Ou._create(r,i,t)}(e,t,i)))}catch(r){throw ft(r,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new pt(this.firestore,Fi(this._delegate,function P0(n,e="asc"){const t=e,i=Ll("orderBy",n);return Uf._create(i,t)}(e,t)))}catch(i){throw ft(i,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new pt(this.firestore,Fi(this._delegate,function L0(n){return sg("limit",n),Fl._create("limit",n,"F")}(e)))}catch(t){throw ft(t,"limit()","Query.limit()")}}limitToLast(e){try{return new pt(this.firestore,Fi(this._delegate,function F0(n){return sg("limitToLast",n),Fl._create("limitToLast",n,"L")}(e)))}catch(t){throw ft(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new pt(this.firestore,Fi(this._delegate,function U0(...n){return Ul._create("startAt",n,!0)}(...e)))}catch(t){throw ft(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new pt(this.firestore,Fi(this._delegate,function V0(...n){return Ul._create("startAfter",n,!1)}(...e)))}catch(t){throw ft(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new pt(this.firestore,Fi(this._delegate,function q0(...n){return Vl._create("endBefore",n,!1)}(...e)))}catch(t){throw ft(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new pt(this.firestore,Fi(this._delegate,function B0(...n){return Vl._create("endAt",n,!0)}(...e)))}catch(t){throw ft(t,"endAt()","Query.endAt()")}}isEqual(e){return bf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function K0(n){n=ie(n,Xe);const e=ie(n.firestore,ge),t=Me(e),i=new Vi(e);return function h0(n,e){const t=new ke;return n.asyncQueue.enqueueAndForget((0,x.Z)(function*(){return(i=(0,x.Z)(function*(r,s,u){try{const d=yield Il(r,s,!0),f=new Km(s,d.Hi),m=f.Wu(d.documents),g=f.applyChanges(m,!1);u.resolve(g.snapshot)}catch(d){const f=ko(d,`Failed to execute query '${s} against cache`);u.reject(f)}}),function(r,s,u){return i.apply(this,arguments)})(yield Dl(n),e,t);var i})),t.promise}(t,n._query).then(r=>new Ui(e,i,n,r))}(this._delegate):"server"===(null==e?void 0:e.source)?function H0(n){n=ie(n,Xe);const e=ie(n.firestore,ge),t=Me(e),i=new Vi(e);return _g(t,n._query,{source:"server"}).then(r=>new Ui(e,i,n,r))}(this._delegate):function W0(n){n=ie(n,Xe);const e=ie(n.firestore,ge),t=Me(e),i=new Vi(e);return Cg(n._query),_g(t,n._query).then(r=>new Ui(e,i,n,r))}(this._delegate),t.then(i=>new Gf(this.firestore,new Ui(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)))}onSnapshot(...e){const t=jg(e),i=Wg(e,r=>new Gf(this.firestore,new Ui(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)));return Ug(this._delegate,t,i)}withConverter(e){return new pt(this.firestore,this._delegate.withConverter(e?es.getInstance(this.firestore,e):null))}}class dI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Fu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class Gf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new pt(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Fu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new dI(this._firestore,t))}forEach(e,t){this._delegate.forEach(i=>{e.call(t,new Fu(this._firestore,i))})}isEqual(e){return Pg(this._delegate,e._delegate)}}class Oo extends pt{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ut(this.firestore,e):null}doc(e){try{return new Ut(this.firestore,void 0===e?Al(this._delegate):Al(this._delegate,e))}catch(t){throw ft(t,"doc()","CollectionReference.doc()")}}add(e){return function Y0(n,e){const t=ie(n.firestore,ge),i=Al(n),r=ql(n.converter,e);return No(t,[Ol(Yr(n.firestore),"addDoc",i._key,r,null!==n.converter,{}).toMutation(i._key,A.exists(!1))]).then(()=>i)}(this._delegate,e).then(t=>new Ut(this.firestore,t))}isEqual(e){return lg(this._delegate,e._delegate)}withConverter(e){return new Oo(this.firestore,this._delegate.withConverter(e?es.getInstance(this.firestore,e):null))}}function ts(n){return ie(n,me)}class zf{constructor(...e){this._delegate=new Jn(...e)}static documentId(){return new zf(ve.keyField().canonicalString())}isEqual(e){return(e=(0,re.m9)(e))instanceof Jn&&this._delegate._internalPath.isEqual(e._internalPath)}}class ns{constructor(e){this._delegate=e}static serverTimestamp(){const e=function iI(){return new Nf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new ns(e)}static delete(){const e=function nI(){return new Du("deleteField")}();return e._methodName="FieldValue.delete",new ns(e)}static arrayUnion(...e){const t=function rI(...n){return new S0("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new ns(t)}static arrayRemove(...e){const t=function sI(...n){return new D0("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new ns(t)}static increment(e){const t=function oI(n){return new R0("increment",n)}(e);return t._methodName="FieldValue.increment",new ns(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const fI={Firestore:Gg,GeoPoint:Rl,Timestamp:le,Blob:Pu,Transaction:zg,WriteBatch:$g,DocumentReference:Ut,DocumentSnapshot:Lu,Query:pt,QueryDocumentSnapshot:Fu,QuerySnapshot:Gf,CollectionReference:Oo,FieldPath:zf,FieldValue:ns,setLogLevel:function hI(n){!function Dh(n){rt.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function mI(n){(function pI(n,e){n.INTERNAL.registerComponent(new Hi.wA("firestore-compat",t=>{const i=t.getProvider("app-compat").getImmediate(),r=t.getProvider("firestore").getImmediate();return e(i,r)},"PUBLIC").setServiceProps(Object.assign({},fI)))})(n,(e,t)=>new Gg(e,t,new lI)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(Rn.Z);var Kg=F(6451),Zl=F(5363),Bi=F(3900),Hg=F(3151),gI=F(590),_I=F(576);function Qg(n,e){return(0,_I.m)(e)?(0,Bi.w)(()=>n,e):(0,Bi.w)(()=>n)}var $f=F(9468);F(259);const Wf=new Map,Jg={activated:!1,tokenObservers:[]},bI={initialized:!1,enabled:!1};function et(n){return Wf.get(n)||Object.assign({},Jg)}function zl(){return bI}class CI{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,x.Z)(function*(){t.stop();try{t.pending=new re.BH,yield function SI(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new re.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(i){t.retryPolicy(i)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const mt=new re.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function e_(n){if(!et(n).activated)throw mt.create("use-before-activation",{appName:n.name})}function Qf(n,e){return Yf.apply(this,arguments)}function Yf(){return Yf=(0,x.Z)(function*({url:n,body:e},t){const i={"Content-Type":"application/json"},r=t.getImmediate({optional:!0});if(r){const y=yield r.getHeartbeatsHeader();y&&(i["X-Firebase-Client"]=y)}const s={method:"POST",body:JSON.stringify(e),headers:i};let u,d;try{u=yield fetch(n,s)}catch(y){throw mt.create("fetch-network-error",{originalErrorMessage:null==y?void 0:y.message})}if(200!==u.status)throw mt.create("fetch-status-error",{httpStatus:u.status});try{d=yield u.json()}catch(y){throw mt.create("fetch-parse-error",{originalErrorMessage:null==y?void 0:y.message})}const f=d.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw mt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${d.ttl}`});const m=1e3*Number(f[1]),g=Date.now();return{token:d.token,expireTimeMillis:g+m,issuedAtTimeMillis:g}}),Yf.apply(this,arguments)}function OI(n,e){const{projectId:t,appId:i,apiKey:r}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${i}:exchangeDebugToken?key=${r}`,body:{debug_token:e}}}const Uu="firebase-app-check-store";let Wl=null;function n_(){return Wl||(Wl=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(mt.create("storage-open",{originalErrorMessage:null===(r=i.target.error)||void 0===r?void 0:r.message}))},t.onupgradeneeded=i=>{0===i.oldVersion&&i.target.result.createObjectStore(Uu,{keyPath:"compositeKey"})}}catch(t){e(mt.create("storage-open",{originalErrorMessage:null==t?void 0:t.message}))}}),Wl)}function Jf(){return Jf=(0,x.Z)(function*(n,e){const i=(yield n_()).transaction(Uu,"readwrite"),s=i.objectStore(Uu).put({compositeKey:n,value:e});return new Promise((u,d)=>{s.onsuccess=f=>{u()},i.onerror=f=>{var m;d(mt.create("storage-set",{originalErrorMessage:null===(m=f.target.error)||void 0===m?void 0:m.message}))}})}),Jf.apply(this,arguments)}const Vu=new At.Yd("@firebase/app-check");function tp(n,e){return(0,re.hl)()?function FI(n,e){return function i_(n,e){return Jf.apply(this,arguments)}(function s_(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{Vu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function o_(){return zl().enabled}function a_(){return ip.apply(this,arguments)}function ip(){return ip=(0,x.Z)(function*(){const n=zl();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),ip.apply(this,arguments)}const GI={error:"UNKNOWN_ERROR"};function zI(n){return re.US.encodeString(JSON.stringify(n),!1)}function Kl(n){return rp.apply(this,arguments)}function rp(){return rp=(0,x.Z)(function*(n,e=!1){const t=n.app;e_(t);const i=et(t);let s,r=i.token;if(r&&!Mo(r)&&(i.token=void 0,r=void 0),!r){const f=yield i.cachedTokenPromise;f&&(Mo(f)?r=f:yield tp(t,void 0))}if(!e&&r&&Mo(r))return{token:r.token};let d,u=!1;if(o_()){i.exchangeTokenPromise||(i.exchangeTokenPromise=Qf(OI(t,yield a_()),n.heartbeatServiceProvider).finally(()=>{i.exchangeTokenPromise=void 0}),u=!0);const f=yield i.exchangeTokenPromise;return yield tp(t,f),i.token=f,{token:f.token}}try{i.exchangeTokenPromise||(i.exchangeTokenPromise=i.provider.getToken().finally(()=>{i.exchangeTokenPromise=void 0}),u=!0),r=yield et(t).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?Vu.warn(f.message):Vu.error(f),s=f}return r?s?d=Mo(r)?{token:r.token,internalError:s}:l_(s):(d={token:r.token},i.token=r,yield tp(t,r)):d=l_(s),u&&c_(t,d),d}),rp.apply(this,arguments)}function op(n,e){const t=et(n),i=t.tokenObservers.filter(r=>r.next!==e);0===i.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function u_(n){const{app:e}=n,t=et(e);let i=t.tokenRefresher;i||(i=function $I(n){const{app:e}=n;return new CI((0,x.Z)(function*(){let i;if(i=et(e).token?yield Kl(n,!0):yield Kl(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{const t=et(e);if(t.token){let i=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return i=Math.min(i,t.token.expireTimeMillis-3e5),Math.max(0,i-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function c_(n,e){const t=et(n).tokenObservers;for(const i of t)try{"EXTERNAL"===i.type&&null!=e.error?i.error(e.error):i.next(e)}catch(r){}}function Mo(n){return n.expireTimeMillis-Date.now()>0}function l_(n){return{token:zI(GI),error:n}}class jI{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=et(this.app);for(const t of e)op(this.app,t.next);return Promise.resolve()}}const y_="app-check-internal";!function ow(){(0,dn._registerComponent)(new Hi.wA("app-check",n=>function WI(n,e){return new jI(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(y_).initialize()})),(0,dn._registerComponent)(new Hi.wA(y_,n=>function KI(n){return{getToken:e=>Kl(n,e),addTokenListener:e=>function sp(n,e,t,i){const{app:r}=n,s=et(r);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:i,type:e}],s.token&&Mo(s.token)){const d=s.token;Promise.resolve().then(()=>{t({token:d.token}),u_(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>u_(n))}(n,"INTERNAL",e),removeTokenListener:e=>op(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,dn.registerVersion)("@firebase/app-check","0.6.0")}();class lp{constructor(){return(0,ze.vb)("app-check")}}"undefined"!=typeof window&&window,F(9260);const I_=new l.OlP("angularfire2.auth.use-emulator"),w_=new l.OlP("angularfire2.auth.settings"),b_=new l.OlP("angularfire2.auth.tenant-id"),E_=new l.OlP("angularfire2.auth.langugage-code"),T_=new l.OlP("angularfire2.auth.use-device-language"),x_=new l.OlP("angularfire.auth.persistence"),k_=(n,e,t,i,r,s,u,d)=>(0,jt.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const f=e.runOutsideAngular(()=>n.auth());if(t&&f.useEmulator(...t),i&&(f.tenantId=i),f.languageCode=r,s&&f.useDeviceLanguage(),u)for(const[m,g]of Object.entries(u))f.settings[m]=g;return d&&f.setPersistence(d),f},[t,i,r,s,u,d]);let A_=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,y,w,k){const S=new ue.x,M=(0,_t.of)(void 0).pipe((0,Zl.Q)(u.outsideAngular),(0,Bi.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(F.bind(F,9169)))),(0,De.U)(()=>(0,jt.on)(t,s,i)),(0,De.U)(V=>k_(V,s,d,m,g,y,f,w)),(0,Hg.d)({bufferSize:1,refCount:!1}));if((0,nt.PM)(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,_t.of)(null);else{M.pipe((0,gI.P)()).subscribe();const ae=M.pipe((0,Bi.w)(Q=>Q.getRedirectResult().then(K=>K,()=>null)),ze.iC,(0,Hg.d)({bufferSize:1,refCount:!1})),he=M.pipe((0,Bi.w)(Q=>new ji.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onAuthStateChanged(X=>K.next(X),X=>K.error(X),()=>K.complete()))})))),ne=M.pipe((0,Bi.w)(Q=>new ji.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onIdTokenChanged(X=>K.next(X),X=>K.error(X),()=>K.complete()))}))));this.authState=ae.pipe(Qg(he),(0,$f.R)(u.outsideAngular),(0,Zl.Q)(u.insideAngular)),this.user=ae.pipe(Qg(ne),(0,$f.R)(u.outsideAngular),(0,Zl.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,Bi.w)(Q=>Q?(0,$t.D)(Q.getIdToken()):(0,_t.of)(null))),this.idTokenResult=this.user.pipe((0,Bi.w)(Q=>Q?(0,$t.D)(Q.getIdTokenResult()):(0,_t.of)(null))),this.credential=(0,Kg.T)(ae,S,this.authState.pipe((0,Ke.h)(Q=>!Q))).pipe((0,De.U)(Q=>(null==Q?void 0:Q.user)?Q:null),(0,$f.R)(u.outsideAngular),(0,Zl.Q)(u.insideAngular))}return(0,jt.pX)(this,M,s,{spy:{apply:(V,ae,he)=>{(V.startsWith("signIn")||V.startsWith("createUser"))&&he.then(ne=>S.next(ne))}}})}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(jt.Dh),l.LFG(jt.xv,8),l.LFG(l.Lbi),l.LFG(l.R0b),l.LFG(ze.HU),l.LFG(I_,8),l.LFG(w_,8),l.LFG(b_,8),l.LFG(E_,8),l.LFG(T_,8),l.LFG(x_,8),l.LFG(lp,8))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function C_(n,e){return function dw(n,e=ah.z){return new ji.y(t=>{let i;return null!=e?e.schedule(()=>{i=n.onSnapshot({includeMetadataChanges:!0},t)}):i=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=i&&i()}})}(n,e)}function dp(n,e){return C_(n,e).pipe((0,De.U)(t=>({payload:t,type:"query"})))}function Ql(n,e){return dp(n,e).pipe((0,He.O)(void 0),Wi(),(0,De.U)(([t,i])=>{const r=i.payload.docChanges(),s=r.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((u,d)=>{const f=r.find(g=>g.doc.ref.isEqual(u.ref)),m=null==t?void 0:t.payload.docs.find(g=>g.ref.isEqual(u.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(u.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:d,newIndex:d,type:"modified",doc:u}})}),s}))}function S_(n,e,t){return Ql(n,t).pipe((0,kt.R)((i,r)=>function pw(n,e,t){return e.forEach(i=>{t.indexOf(i.type)>-1&&(n=function mw(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return fp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return fp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return fp(n,e.oldIndex,1)}return n}(n,i))}),n}(i,r.map(s=>s.payload),e),[]),(0,hn.x)(),(0,De.U)(i=>i.map(r=>({type:r.type,payload:r}))))}function fp(n,e,t,...i){const r=n.slice();return r.splice(e,t,...i),r}function D_(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class R_{constructor(e,t,i){this.ref=e,this.query=t,this.afs=i}stateChanges(e){let t=Ql(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,De.U)(i=>i.filter(r=>e.indexOf(r.type)>-1)))),t.pipe((0,He.O)(void 0),Wi(),(0,Ke.h)(([i,r])=>r.length>0||!i),(0,De.U)(([i,r])=>r),ze.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,kt.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=D_(e);return S_(this.query,t,this.afs.schedulers.outsideAngular).pipe(ze.iC)}valueChanges(e={}){return dp(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(t=>t.payload.docs.map(i=>e.idField?Object.assign(Object.assign({},i.data()),{[e.idField]:i.id}):i.data())),ze.iC)}get(e){return(0,$t.D)(this.query.get(e)).pipe(ze.iC)}add(e){return this.ref.add(e)}doc(e){return new N_(this.ref.doc(e),this.afs)}}class N_{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const i=this.ref.collection(e),{ref:r,query:s}=O_(i,t);return new R_(r,s,this.afs)}snapshotChanges(){return function fw(n,e){return C_(n,e).pipe((0,He.O)(void 0),Wi(),(0,De.U)(([t,i])=>i.exists?(null==t?void 0:t.exists)?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(ze.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,De.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,$t.D)(this.ref.get(e)).pipe(ze.iC)}}class gw{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Ql(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(t=>t.filter(i=>e.indexOf(i.type)>-1)),(0,Ke.h)(t=>t.length>0),ze.iC):Ql(this.query,this.afs.schedulers.outsideAngular).pipe(ze.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,kt.R)((t,i)=>[...t,...i],[]))}snapshotChanges(e){const t=D_(e);return S_(this.query,t,this.afs.schedulers.outsideAngular).pipe(ze.iC)}valueChanges(e={}){return dp(this.query,this.afs.schedulers.outsideAngular).pipe((0,De.U)(i=>i.payload.docs.map(r=>e.idField?Object.assign({[e.idField]:r.id},r.data()):r.data())),ze.iC)}get(e){return(0,$t.D)(this.query.get(e)).pipe(ze.iC)}}const _w=new l.OlP("angularfire2.enableFirestorePersistence"),yw=new l.OlP("angularfire2.firestore.persistenceSettings"),vw=new l.OlP("angularfire2.firestore.settings"),Iw=new l.OlP("angularfire2.firestore.use-emulator");function O_(n,e=(t=>t)){return{query:e(n),ref:n}}let M_=(()=>{class n{constructor(t,i,r,s,u,d,f,m,g,y,w,k,S,M,V,ae,he){this.schedulers=f;const ne=(0,jt.on)(t,d,i),Q=g;y&&k_(ne,d,w,S,M,V,k,ae),[this.firestore,this.persistenceEnabled$]=(0,jt.cc)(`${ne.name}.firestore`,"AngularFirestore",ne.name,()=>{const K=d.runOutsideAngular(()=>ne.firestore());if(s&&K.settings(s),Q&&K.useEmulator(...Q),r&&!(0,nt.PM)(u)){const X=()=>{try{return(0,$t.D)(K.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(Ge){return"undefined"!=typeof console&&console.warn(Ge),(0,_t.of)(!1)}};return[K,d.runOutsideAngular(X)]}return[K,(0,_t.of)(!1)]},[s,Q,r])}collection(t,i){let r;r="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=O_(r,i),d=this.schedulers.ngZone.run(()=>s);return new R_(d,u,this)}collectionGroup(t,i){const r=i||(u=>u),s=this.firestore.collectionGroup(t);return new gw(r(s),this)}doc(t){let i;i="string"==typeof t?this.firestore.doc(t):t;const r=this.schedulers.ngZone.run(()=>i);return new N_(r,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(l.LFG(jt.Dh),l.LFG(jt.xv,8),l.LFG(_w,8),l.LFG(vw,8),l.LFG(l.Lbi),l.LFG(l.R0b),l.LFG(ze.HU),l.LFG(yw,8),l.LFG(Iw,8),l.LFG(A_,8),l.LFG(I_,8),l.LFG(w_,8),l.LFG(b_,8),l.LFG(E_,8),l.LFG(T_,8),l.LFG(x_,8),l.LFG(lp,8))},n.\u0275prov=l.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),ww=(()=>{class n{constructor(t,i,r,s){this.fb=t,this.dialogRef=i,this.data=r,this.store=s}onSubmit(){this.dialogRef.close(),window.navigator.clipboard.writeText(this.formGroup.value.copy_link)}ngOnInit(){this.formGroup=this.fb.group({copy_link:[{value:null,disabled:!1},G.kI.required]});const t=Zu(30);(0,$t.D)(this.store.collection(t).add({actors:this.data.actors.map(i=>i.toDto()),rotations:this.data.rotations.map(i=>i.toDto()),current_rotation:this.data.current_rotation})).subscribe(()=>{this.formGroup.patchValue({copy_link:`${window.location.href}?store=${t}`})})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn),l.Y36(pe),l.Y36(M_))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-export-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","copy_link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l._UZ(9,"input",3),l.qZA(),l.TgZ(10,"button",4),l._uU(11),l.ALo(12,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,5,"export_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,7,"export_dialog.placeholder.copy_link")),l.xp6(3),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(12,9,"export_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,Bo.Nt,G.Fj,G.JJ,G.u,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),bw=(()=>{class n{constructor(t,i){this.fb=t,this.dialogRef=i}onSubmit(){const t=this.formGroup.value.link.split("?store=");t.length<2||this.dialogRef.close(t[t.length-1])}ngOnInit(){this.formGroup=this.fb.group({link:[null,G.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(cn))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-import-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,i){1&t&&(l.TgZ(0,"h1",0),l._uU(1),l.ALo(2,"translate"),l.qZA(),l.TgZ(3,"mat-dialog-content",1),l.NdJ("submit",function(){return i.onSubmit()}),l.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),l._uU(7),l.ALo(8,"translate"),l.qZA(),l._UZ(9,"input",3),l.qZA(),l.TgZ(10,"button",4),l._uU(11),l.ALo(12,"translate"),l.qZA()()()),2&t&&(l.xp6(1),l.Oqu(l.lcZ(2,5,"import_dialog.title")),l.xp6(2),l.Q6J("formGroup",i.formGroup),l.xp6(4),l.Oqu(l.lcZ(8,7,"import_dialog.placeholder.link")),l.xp6(3),l.Q6J("disabled",i.formGroup.invalid),l.xp6(1),l.hij(" ",l.lcZ(12,9,"import_dialog.submit")," "))},directives:[ln,ni,G.JL,G.sg,G._Y,Ve.KE,Ve.hX,Bo.Nt,G.Fj,G.JJ,G.u,zt.lW],pipes:[Tt.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();var at=(()=>(function(n){n[n.MOVE_ACTOR=0]="MOVE_ACTOR",n[n.DRAW_LINE=1]="DRAW_LINE",n[n.ERASE_LINE=2]="ERASE_LINE"}(at||(at={})),at))(),Cn=F(8962),Vt=F(3191),P_=F(4968),L_=F(9718),ei=F(2722),Ew=F(8372);const Yl=["*"],Tw=["content"];function xw(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"div",2),l.NdJ("click",function(){return l.CHM(t),l.oxw()._onBackdropClicked()}),l.qZA()}if(2&n){const t=l.oxw();l.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function kw(n,e){1&n&&(l.TgZ(0,"mat-drawer-content"),l.Hsn(1,2),l.qZA())}const Aw=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],Cw=["mat-drawer","mat-drawer-content","*"];function Sw(n,e){if(1&n){const t=l.EpF();l.TgZ(0,"div",2),l.NdJ("click",function(){return l.CHM(t),l.oxw()._onBackdropClicked()}),l.qZA()}if(2&n){const t=l.oxw();l.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Dw(n,e){1&n&&(l.TgZ(0,"mat-sidenav-content"),l.Hsn(1,2),l.qZA())}const Rw=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Nw=["mat-sidenav","mat-sidenav-content","*"],F_={transformDrawer:(0,Y.X$)("transform",[(0,Y.SB)("open, open-instant",(0,Y.oB)({transform:"none",visibility:"visible"})),(0,Y.SB)("void",(0,Y.oB)({"box-shadow":"none",visibility:"hidden"})),(0,Y.eR)("void => open-instant",(0,Y.jt)("0ms")),(0,Y.eR)("void <=> open, open-instant => void",(0,Y.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},Mw=new l.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function Pw(){return!1}}),pp=new l.OlP("MAT_DRAWER_CONTAINER");let Jl=(()=>{class n extends Cn.PQ{constructor(t,i,r,s,u){super(r,s,u),this._changeDetectorRef=t,this._container=i}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(l.sBO),l.Y36((0,l.Gpc)(()=>V_)),l.Y36(l.SBq),l.Y36(Cn.mF),l.Y36(l.R0b))},n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(t,i){2&t&&l.Udp("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[l._Bn([{provide:Cn.PQ,useExisting:n}]),l.qOj],ngContentSelectors:Yl,decls:1,vars:0,template:function(t,i){1&t&&(l.F$t(),l.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),U_=(()=>{class n{constructor(t,i,r,s,u,d,f,m){this._elementRef=t,this._focusTrapFactory=i,this._focusMonitor=r,this._platform=s,this._ngZone=u,this._interactivityChecker=d,this._doc=f,this._container=m,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new ue.x,this._animationEnd=new ue.x,this._animationState="void",this.openedChange=new l.vpe(!0),this._openedStream=this.openedChange.pipe((0,Ke.h)(g=>g),(0,De.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,Ke.h)(g=>g.fromState!==g.toState&&0===g.toState.indexOf("open")),(0,L_.h)(void 0)),this._closedStream=this.openedChange.pipe((0,Ke.h)(g=>!g),(0,De.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,Ke.h)(g=>g.fromState!==g.toState&&"void"===g.toState),(0,L_.h)(void 0)),this._destroyed=new ue.x,this.onPositionChanged=new l.vpe,this._modeChanged=new ue.x,this.openedChange.subscribe(g=>{g?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{(0,P_.R)(this._elementRef.nativeElement,"keydown").pipe((0,Ke.h)(g=>g.keyCode===rs.hY&&!this.disableClose&&!(0,rs.Vb)(g)),(0,ei.R)(this._destroyed)).subscribe(g=>this._ngZone.run(()=>{this.close(),g.stopPropagation(),g.preventDefault()}))}),this._animationEnd.pipe((0,hn.x)((g,y)=>g.fromState===y.fromState&&g.toState===y.toState)).subscribe(g=>{const{fromState:y,toState:w}=g;(0===w.indexOf("open")&&"void"===y||"void"===w&&0===y.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t="end"===t?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(t),this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=(0,Vt.Ig)(t)}get autoFocus(){const t=this._autoFocus;return null==t?"side"===this.mode?"dialog":"first-tabbable":t}set autoFocus(t){("true"===t||"false"===t||null==t)&&(t=(0,Vt.Ig)(t)),this._autoFocus=t}get opened(){return this._opened}set opened(t){this.toggle((0,Vt.Ig)(t))}_forceFocus(t,i){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const r=()=>{t.removeEventListener("blur",r),t.removeEventListener("mousedown",r),t.removeAttribute("tabindex")};t.addEventListener("blur",r),t.addEventListener("mousedown",r)})),t.focus(i)}_focusByCssSelector(t,i){let r=this._elementRef.nativeElement.querySelector(t);r&&this._forceFocus(r,i)}_takeFocus(){if(!this._focusTrap)return;const t=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(i=>{!i&&"function"==typeof this._elementRef.nativeElement.focus&&t.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(t){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,t):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const t=this._doc.activeElement;return!!t&&this._elementRef.nativeElement.contains(t)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var t;this._focusTrap&&this._focusTrap.destroy(),null===(t=this._anchor)||void 0===t||t.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(t=!this.opened,i){t&&i&&(this._openedVia=i);const r=this._setOpen(t,!t&&this._isFocusWithinDrawer(),this._openedVia||"program");return t||(this._openedVia=null),r}_setOpen(t,i,r){return this._opened=t,t?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",i&&this._restoreFocus(r)),this._updateFocusTrapState(),new Promise(s=>{this.openedChange.pipe((0,N.q)(1)).subscribe(u=>s(u?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(t){const i=this._elementRef.nativeElement,r=i.parentNode;"end"===t?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),r.insertBefore(this._anchor,i)),r.appendChild(i)):this._anchor&&this._anchor.parentNode.insertBefore(i,this._anchor)}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(l.SBq),l.Y36(Sn.qV),l.Y36(Sn.tE),l.Y36(tt.t4),l.Y36(l.R0b),l.Y36(Sn.ic),l.Y36(nt.K0,8),l.Y36(pp,8))},n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-drawer"]],viewQuery:function(t,i){if(1&t&&l.Gf(Tw,5),2&t){let r;l.iGM(r=l.CRH())&&(i._content=r.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(t,i){1&t&&l.WFA("@transform.start",function(s){return i._animationStarted.next(s)})("@transform.done",function(s){return i._animationEnd.next(s)}),2&t&&(l.uIk("align",null),l.d8E("@transform",i._animationState),l.ekj("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:Yl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,i){1&t&&(l.F$t(),l.TgZ(0,"div",0,1),l.Hsn(2),l.qZA())},directives:[Cn.PQ],encapsulation:2,data:{animation:[F_.transformDrawer]},changeDetection:0}),n})(),V_=(()=>{class n{constructor(t,i,r,s,u,d=!1,f){this._dir=t,this._element=i,this._ngZone=r,this._changeDetectorRef=s,this._animationMode=f,this._drawers=new l.n_E,this.backdropClick=new l.vpe,this._destroyed=new ue.x,this._doCheckSubject=new ue.x,this._contentMargins={left:null,right:null},this._contentMarginChanges=new ue.x,t&&t.change.pipe((0,ei.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),u.change().pipe((0,ei.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=d}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=(0,Vt.Ig)(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:(0,Vt.Ig)(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,He.O)(this._allDrawers),(0,ei.R)(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(i=>!i._container||i._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,He.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,Ew.b)(10),(0,ei.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,i=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._getWidth();else if("push"==this._left.mode){const r=this._left._getWidth();t+=r,i-=r}if(this._right&&this._right.opened)if("side"==this._right.mode)i+=this._right._getWidth();else if("push"==this._right.mode){const r=this._right._getWidth();i+=r,t-=r}t=t||null,i=i||null,(t!==this._contentMargins.left||i!==this._contentMargins.right)&&(this._contentMargins={left:t,right:i},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe((0,Ke.h)(i=>i.fromState!==i.toState),(0,ei.R)(this._drawers.changes)).subscribe(i=>{"open-instant"!==i.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==t.mode&&t.openedChange.pipe((0,ei.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe((0,ei.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,N.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe((0,ei.R)((0,Kg.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const i=this._element.nativeElement.classList,r="mat-drawer-container-has-open";t?i.add(r):i.remove(r)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{"end"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return"side"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(Ae.Is,8),l.Y36(l.SBq),l.Y36(l.R0b),l.Y36(l.sBO),l.Y36(Cn.rL),l.Y36(Mw),l.Y36(Dn.Qb,8))},n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-drawer-container"]],contentQueries:function(t,i,r){if(1&t&&(l.Suo(r,Jl,5),l.Suo(r,U_,5)),2&t){let s;l.iGM(s=l.CRH())&&(i._content=s.first),l.iGM(s=l.CRH())&&(i._allDrawers=s)}},viewQuery:function(t,i){if(1&t&&l.Gf(Jl,5),2&t){let r;l.iGM(r=l.CRH())&&(i._userContent=r.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(t,i){2&t&&l.ekj("mat-drawer-container-explicit-backdrop",i._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[l._Bn([{provide:pp,useExisting:n}])],ngContentSelectors:Cw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,i){1&t&&(l.F$t(Aw),l.YNc(0,xw,1,2,"div",0),l.Hsn(1),l.Hsn(2,1),l.YNc(3,kw,2,0,"mat-drawer-content",1)),2&t&&(l.Q6J("ngIf",i.hasBackdrop),l.xp6(3),l.Q6J("ngIf",!i._content))},directives:[Jl,nt.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),mp=(()=>{class n extends Jl{constructor(t,i,r,s,u){super(t,i,r,s,u)}}return n.\u0275fac=function(t){return new(t||n)(l.Y36(l.sBO),l.Y36((0,l.Gpc)(()=>B_)),l.Y36(l.SBq),l.Y36(Cn.mF),l.Y36(l.R0b))},n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(t,i){2&t&&l.Udp("margin-left",i._container._contentMargins.left,"px")("margin-right",i._container._contentMargins.right,"px")},features:[l._Bn([{provide:Cn.PQ,useExisting:n}]),l.qOj],ngContentSelectors:Yl,decls:1,vars:0,template:function(t,i){1&t&&(l.F$t(),l.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),q_=(()=>{class n extends U_{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=(0,Vt.Ig)(t)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=(0,Vt.su)(t)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=(0,Vt.su)(t)}}return n.\u0275fac=function(){let e;return function(i){return(e||(e=l.n5z(n)))(i||n)}}(),n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(t,i){2&t&&(l.uIk("align",null),l.Udp("top",i.fixedInViewport?i.fixedTopGap:null,"px")("bottom",i.fixedInViewport?i.fixedBottomGap:null,"px"),l.ekj("mat-drawer-end","end"===i.position)("mat-drawer-over","over"===i.mode)("mat-drawer-push","push"===i.mode)("mat-drawer-side","side"===i.mode)("mat-drawer-opened",i.opened)("mat-sidenav-fixed",i.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[l.qOj],ngContentSelectors:Yl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,i){1&t&&(l.F$t(),l.TgZ(0,"div",0,1),l.Hsn(2),l.qZA())},directives:[Cn.PQ],encapsulation:2,data:{animation:[F_.transformDrawer]},changeDetection:0}),n})(),B_=(()=>{class n extends V_{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=l.n5z(n)))(i||n)}}(),n.\u0275cmp=l.Xpm({type:n,selectors:[["mat-sidenav-container"]],contentQueries:function(t,i,r){if(1&t&&(l.Suo(r,mp,5),l.Suo(r,q_,5)),2&t){let s;l.iGM(s=l.CRH())&&(i._content=s.first),l.iGM(s=l.CRH())&&(i._allDrawers=s)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(t,i){2&t&&l.ekj("mat-drawer-container-explicit-backdrop",i._backdropOverride)},exportAs:["matSidenavContainer"],features:[l._Bn([{provide:pp,useExisting:n}]),l.qOj],ngContentSelectors:Nw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,i){1&t&&(l.F$t(Rw),l.YNc(0,Sw,1,2,"div",0),l.Hsn(1),l.Hsn(2,1),l.YNc(3,Dw,2,0,"mat-sidenav-content",1)),2&t&&(l.Q6J("ngIf",i.hasBackdrop),l.xp6(3),l.Q6J("ngIf",!i._content))},directives:[mp,nt.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),Lw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({imports:[[nt.ez,Ee.BQ,Cn.ZD],Cn.ZD,Ee.BQ]}),n})();var Fw=F(5245);const Uw=["field"];let Vw=(()=>{class n{constructor(){this.actors=[],this.lines=[],this.courtMode=at.MOVE_ACTOR,this.onRender=new l.vpe,this.onReady=new l.vpe,this.onLineAdded=new l.vpe,this.onLineErased=new l.vpe,this.mouseDown=!1}ngAfterViewInit(){this.context=this.fieldElement.nativeElement.getContext("2d"),this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height;for(const t of[["touchstart","mousedown"],["touchmove","mousemove"]])this.context.canvas.addEventListener(t[0],i=>{const r=i.touches[0];this.fieldElement.nativeElement.dispatchEvent(new MouseEvent(t[1],{clientX:r.clientX,clientY:r.clientY}))});this.context.canvas.addEventListener("touchend",()=>this.onMouseUp()),this.context.canvas.addEventListener("touchcancel",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousedown",t=>this.onMouseDown(t)),this.fieldElement.nativeElement.addEventListener("mouseup",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mouseleave",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousemove",t=>this.onMouseMove(t)),(0,P_.R)(window,"resize").subscribe(()=>this.fixRenderDimensions()),setTimeout(()=>this.onReady.emit(this.context),100)}ngOnChanges(){!this.context||this.render()}fixRenderDimensions(){this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height,this.render()}onMouseDown(t){const i=t.clientX,r=t.clientY;if(this.mouseDown=!0,this.courtMode===at.MOVE_ACTOR)for(let s=this.actors.length-1;s>=0;--s){const u=this.actors[s];if(u.isHit(i,r))return void(this.draggedShape=u)}else this.courtMode===at.DRAW_LINE&&(this.drawnLine=new Gu(this.context),this.drawnLine.addPosition(i,r))}onMouseUp(){this.drawnLine&&this.onLineAdded.emit(this.drawnLine),this.draggedShape=void 0,this.drawnLine=void 0,this.mouseDown=!1}onMouseMove(t){const i=t.clientX,r=t.clientY;if(this.courtMode===at.ERASE_LINE){if(this.mouseDown){const s=this.lines.find(u=>u.isHit(i,r));if(!s)return;this.onLineErased.emit(s)}}else if(this.draggedShape)this.draggedShape.setPosition(i,r);else{if(!this.drawnLine)return;this.drawnLine.addPosition(i,r)}this.render()}render(){this.initCourt(),this.actors.forEach(t=>t.draw()),this.lines.forEach(t=>t.draw()),this.drawnLine&&this.drawnLine.draw(),this.onRender.emit()}initCourt(){const t=this.context.canvas.getBoundingClientRect().width,i=this.context.canvas.getBoundingClientRect().height;this.context.clearRect(0,0,t,i),this.context.fillStyle=n.OUTER_COLOR,this.context.fillRect(0,0,t,i);const r=.025*t,u=(i-.025*i)/10,d=(t-2*r)/9,f=r,m=t-2*r;this.context.fillStyle=n.FRONT_FIELD_COLOR,this.context.fillRect(f,0,m,4*u),this.context.fillStyle=n.BACK_FIELD_COLOR,this.context.fillRect(f,4*u,m,6*u);const g=u/20,y=d/20;this.context.fillStyle=n.LINE_COLOR,this.context.fillRect(f,0,y,10*u),this.context.fillRect(m+f-y,0,y,10*u),this.context.fillRect(f,4*u,m,g),this.context.fillRect(f,10*u,m,g),this.context.fillRect(f,u-3*g,m,3*g)}}return n.OUTER_COLOR="#469ABB",n.LINE_COLOR="#FFFFFF",n.FRONT_FIELD_COLOR="#FF5202",n.BACK_FIELD_COLOR="#F8A941",n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-court"]],viewQuery:function(t,i){if(1&t&&l.Gf(Uw,5),2&t){let r;l.iGM(r=l.CRH())&&(i.fieldElement=r.first)}},inputs:{actors:"actors",lines:"lines",courtMode:"courtMode"},outputs:{onRender:"onRender",onReady:"onReady",onLineAdded:"onLineAdded",onLineErased:"onLineErased"},features:[l.TTD],decls:2,vars:0,consts:[["field",""]],template:function(t,i){1&t&&l._UZ(0,"canvas",null,0)},styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}canvas[_ngcontent-%COMP%]{display:block;height:100%;width:100%;touch-action:none}"]}),n})();const qw=["court"];function Bw(n,e){if(1&n&&(l.TgZ(0,"mat-option",11),l._uU(1),l.qZA()),2&n){const t=e.$implicit;l.Q6J("value",t.UUID),l.xp6(1),l.Oqu(t.toString())}}const Zw=[{path:"",component:(()=>{class n{constructor(t,i,r,s){this.formBuilder=t,this.matDialog=i,this.store=r,this.router=s,this.actors=[],this.rotations=[],this.currentRotationIndex=0,this.CourtMode=at,this.courtMode=at.MOVE_ACTOR,this.ready=!1,this.formGroup=this.formBuilder.group({current_rotation:[null,G.kI.required]})}get rotation(){return this.rotations[this.currentRotationIndex]}get actorShapes(){return this.actors.map(t=>t.shape)}get lineShapes(){var t,i;return null!==(i=null===(t=this.rotation)||void 0===t?void 0:t.lines)&&void 0!==i?i:[]}onCourtReady(t){this.context=t;const i=new URLSearchParams(window.location.search);if(i&&i.get("store")&&30===i.get("store").length)this.importLink(i.get("store")),this.router.navigate(["/"]);else{const r=xt.retrieve(n.LOCAL_STORAGE_KEY_ROTATIONS),s=xt.retrieve(n.LOCAL_STORAGE_KEY_ACTORS),u=xt.retrieve(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION);r&&s&&u?(this.actors=s.map(d=>Zi.fromDto(d,this.context)),this.rotations=r.map(d=>Qe.fromDto(d,this.context)),this.currentRotationIndex=this.rotations.findIndex(d=>d.UUID===u),this.actors.forEach(d=>d.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation))):this.rotations=[new Qe(new gt(1),"Default rotation")],this.formGroup.patchValue({current_rotation:this.rotation.UUID})}this.formGroup.valueChanges.subscribe(r=>this.onRotationChanged(r.current_rotation)),this.ready=!0}onRotationChanged(t){this.currentRotationIndex=this.rotations.findIndex(i=>i.UUID===t),this.actors.forEach(i=>i.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.court.render()}onAddActorClicked(){this.matDialog.open(Zo,{autoFocus:!1}).afterClosed().subscribe(i=>{if(i){switch(i.player_role){case Pe.Setter:this.addShape(i,new Xl(i,this.context));break;case Pe.MiddleBlocker:this.addShape(i,new Zt(i,this.context,!1));break;case Pe.Libero:this.addShape(i,new Zt(i,this.context,!0));break;case Pe.DefensiveSpecialist:this.addShape(i,new Po(i,this.context));break;case Pe.OutsideHitter:this.addShape(i,new ti(i,this.context,!1));break;case Pe.OppositeHitter:this.addShape(i,new ti(i,this.context,!0))}this.court.render()}})}addShape(t,i){i.setRotationProperties(this.rotation.UUID,this.rotation.rotation),t.setShape(i),this.actors.push(t)}onDeleteActorClicked(){this.matDialog.open(rh,{data:{actors:this.actors},autoFocus:!1}).afterClosed().subscribe(i=>{if(!i)return;const r=this.actors.findIndex(s=>s.UUID===i);this.actors.splice(r,1),this.court.render()})}onDeleteRotationClicked(){this.matDialog.open(sh,{data:{rotations:this.rotations},autoFocus:!1}).afterClosed().subscribe(i=>{if(!i)return;const r=this.rotation.UUID,s=this.rotations.findIndex(u=>u.UUID===i);this.rotations.splice(s,1),this.actors.forEach(u=>u.shape.removeRotation(i)),r===i?0===this.rotations.length&&(this.rotations.push(new Qe(new gt(1),"Default rotation")),this.currentRotationIndex=0):this.currentRotationIndex=this.rotations.findIndex(u=>u.UUID===r),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.actors.forEach(u=>u.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.court.render()})}onAddRotationClicked(){this.matDialog.open(Hu,{autoFocus:!1,data:{rotations:this.rotations}}).afterClosed().subscribe(i=>{if(i){if(i.add_before){const r=this.rotations.findIndex(s=>s.UUID===i.add_before);this.rotations.splice(r,0,i.rotation),this.currentRotationIndex=r}else this.rotations.push(i.rotation),this.currentRotationIndex=this.rotations.length-1;this.formGroup.patchValue({current_rotation:i.rotation.UUID}),this.actors.forEach(r=>r.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.court.render()}})}onExportClicked(){this.matDialog.open(ww,{autoFocus:!1,data:{actors:this.actors,rotations:this.rotations,current_rotation:this.rotation.UUID}})}onImportClicked(){this.matDialog.open(bw,{autoFocus:!1}).afterClosed().subscribe(i=>this.importLink(i))}importLink(t){!t||30!==t.length||this.store.collection(t).get().subscribe(i=>{const r=i.docs[0].data();this.actors=r.actors.map(u=>Zi.fromDto(u,this.context)),this.rotations=r.rotations.map(u=>Qe.fromDto(u,this.context));const s=r.current_rotation;this.currentRotationIndex=this.rotations.findIndex(u=>u.UUID===s),this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.actors.forEach(u=>u.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.court.render()})}setMoveActorMode(){this.courtMode=at.MOVE_ACTOR}onToggleDrawMode(){this.courtMode=this.courtMode===at.DRAW_LINE?at.MOVE_ACTOR:at.DRAW_LINE}onToggleEraseMode(){this.courtMode=this.courtMode===at.ERASE_LINE?at.MOVE_ACTOR:at.ERASE_LINE}onCourtRender(){!this.ready||(xt.store(n.LOCAL_STORAGE_KEY_ROTATIONS,this.rotations.map(t=>t.toDto())),xt.store(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION,this.rotation.UUID),xt.store(n.LOCAL_STORAGE_KEY_ACTORS,this.actors.map(t=>t.toDto())))}onLineAdded(t){this.rotation.addLine(t)}onLineErased(t){this.rotation.removeLine(t)}}return n.LOCAL_STORAGE_KEY_ACTORS="actors_storage",n.LOCAL_STORAGE_KEY_ROTATIONS="rotations_storage",n.LOCAL_STORAGE_KEY_CURRENT_ROTATION="current_rotation_uuid",n.\u0275fac=function(t){return new(t||n)(l.Y36(G.qu),l.Y36(as),l.Y36(M_),l.Y36(D.F0))},n.\u0275cmp=l.Xpm({type:n,selectors:[["vpms-field"]],viewQuery:function(t,i){if(1&t&&l.Gf(qw,5),2&t){let r;l.iGM(r=l.CRH())&&(i.court=r.first)}},decls:69,vars:49,consts:[["mode","over"],["sidenav",""],[3,"formGroup"],["formControlName","current_rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["href","https://github.com/Geigerkind/vb_positions","target","_blank",2,"margin-top","auto"],["mat-stroked-button",""],["mat-flat-button","",1,"toggle_sidenav",3,"click"],[3,"actors","lines","courtMode","onReady","onRender","onLineAdded","onLineErased"],["court",""],[3,"value"]],template:function(t,i){if(1&t){const r=l.EpF();l.TgZ(0,"mat-sidenav-container")(1,"mat-sidenav",0,1)(3,"mat-form-field",2)(4,"mat-select",3),l.YNc(5,Bw,2,2,"mat-option",4),l.qZA()(),l.TgZ(6,"button",5),l.NdJ("click",function(){return i.onAddRotationClicked()}),l.TgZ(7,"mat-icon"),l._uU(8,"add"),l.qZA(),l._uU(9),l.ALo(10,"translate"),l.qZA(),l.TgZ(11,"button",5),l.NdJ("click",function(){return i.onDeleteRotationClicked()}),l.TgZ(12,"mat-icon"),l._uU(13,"delete"),l.qZA(),l._uU(14),l.ALo(15,"translate"),l.qZA(),l.TgZ(16,"button",5),l.NdJ("click",function(){return i.onAddActorClicked()}),l.TgZ(17,"mat-icon"),l._uU(18,"add"),l.qZA(),l._uU(19),l.ALo(20,"translate"),l.qZA(),l.TgZ(21,"button",5),l.NdJ("click",function(){return i.onDeleteActorClicked()}),l.TgZ(22,"mat-icon"),l._uU(23,"delete"),l.qZA(),l._uU(24),l.ALo(25,"translate"),l.qZA(),l.TgZ(26,"h1"),l._uU(27),l.ALo(28,"translate"),l.qZA(),l.TgZ(29,"button",5),l.NdJ("click",function(){return i.setMoveActorMode()}),l.TgZ(30,"mat-icon"),l._uU(31,"person"),l.qZA(),l._uU(32),l.ALo(33,"translate"),l.qZA(),l.TgZ(34,"button",5),l.NdJ("click",function(){return i.onToggleDrawMode()}),l.TgZ(35,"mat-icon"),l._uU(36,"mode_edit_outline"),l.qZA(),l._uU(37),l.ALo(38,"translate"),l.qZA(),l.TgZ(39,"button",5),l.NdJ("click",function(){return i.onToggleEraseMode()}),l.TgZ(40,"mat-icon"),l._uU(41,"auto_fix_normal"),l.qZA(),l._uU(42),l.ALo(43,"translate"),l.qZA(),l.TgZ(44,"h1"),l._uU(45),l.ALo(46,"translate"),l.qZA(),l.TgZ(47,"button",5),l.NdJ("click",function(){return i.onExportClicked()}),l.TgZ(48,"mat-icon"),l._uU(49,"share"),l.qZA(),l._uU(50),l.ALo(51,"translate"),l.qZA(),l.TgZ(52,"button",5),l.NdJ("click",function(){return i.onImportClicked()}),l.TgZ(53,"mat-icon"),l._uU(54,"import_export"),l.qZA(),l._uU(55),l.ALo(56,"translate"),l.qZA(),l.TgZ(57,"a",6)(58,"button",7)(59,"mat-icon"),l._uU(60,"code"),l.qZA(),l._uU(61),l.ALo(62,"translate"),l.qZA()()(),l.TgZ(63,"mat-sidenav-content")(64,"button",8),l.NdJ("click",function(){return l.CHM(r),l.MAs(2).toggle()}),l.TgZ(65,"mat-icon"),l._uU(66,"arrow_right"),l.qZA()(),l.TgZ(67,"vpms-court",9,10),l.NdJ("onReady",function(u){return i.onCourtReady(u)})("onRender",function(){return i.onCourtRender()})("onLineAdded",function(u){return i.onLineAdded(u)})("onLineErased",function(u){return i.onLineErased(u)}),l.qZA()()()}if(2&t){const r=l.MAs(2);l.xp6(3),l.Q6J("formGroup",i.formGroup),l.xp6(2),l.Q6J("ngForOf",i.rotations),l.xp6(4),l.hij(" ",l.lcZ(10,25,"field.add_rotation")," "),l.xp6(5),l.hij(" ",l.lcZ(15,27,"field.delete_rotation")," "),l.xp6(5),l.hij(" ",l.lcZ(20,29,"field.add_actor")," "),l.xp6(5),l.hij(" ",l.lcZ(25,31,"field.delete_actor")," "),l.xp6(3),l.Oqu(l.lcZ(28,33,"field.subtitle.mode")),l.xp6(2),l.ekj("toggled",i.courtMode===i.CourtMode.MOVE_ACTOR),l.xp6(3),l.hij(" ",l.lcZ(33,35,"field.actor_mode")," "),l.xp6(2),l.ekj("toggled",i.courtMode===i.CourtMode.DRAW_LINE),l.xp6(3),l.hij(" ",l.lcZ(38,37,"field.draw_mode")," "),l.xp6(2),l.ekj("toggled",i.courtMode===i.CourtMode.ERASE_LINE),l.xp6(3),l.hij(" ",l.lcZ(43,39,"field.erase_mode")," "),l.xp6(3),l.Oqu(l.lcZ(46,41,"field.subtitle.share")),l.xp6(5),l.hij(" ",l.lcZ(51,43,"field.export")," "),l.xp6(5),l.hij(" ",l.lcZ(56,45,"field.import")," "),l.xp6(6),l.hij(" ",l.lcZ(62,47,"field.source_code")," "),l.xp6(3),l.ekj("is_opened",r.opened),l.xp6(3),l.Q6J("actors",i.actorShapes)("lines",i.lineShapes)("courtMode",i.courtMode)}},directives:[B_,q_,Ve.KE,G.JL,G.sg,$i.gD,G.JJ,G.u,nt.sg,Ee.ey,zt.lW,Fw.Hw,mp,Vw],pipes:[Tt.X$],styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}.toggled[_ngcontent-%COMP%]{color:#0a64ae}mat-sidenav-container[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:15rem;padding:1rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:3rem;text-align:left;margin-bottom:.5rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#0a64ae}mat-sidenav[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.toggle_sidenav[_ngcontent-%COMP%]{position:absolute;top:3rem;left:-1rem;z-index:20;transform:rotate(90deg)}.toggle_sidenav.is_opened[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(90deg)}.toggle_sidenav[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-90deg)}"]}),n})()}];let Gw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({imports:[[D.Bz.forChild(Zw)],D.Bz]}),n})();var Z_=F(7144);let $_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({}),n})(),tb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({imports:[[Ee.si,Ee.BQ,Z_.Q8,$_],Ee.BQ,$_]}),n})(),nb=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=l.oAB({type:n}),n.\u0275inj=l.cJS({imports:[[Gw,I.m,Tt.aw,qo,G.UX,nt.ez,tb,Lw]]}),n})()},9169:(j_,Bu,F)=>{F.r(Bu);var I=F(5861),Tt=F(3942),D=F(2090),qt=F(9681),Bt=F(1877),ti=F(655),Pe=F(4859);const zu=function Gu(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},Zi=function Po(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},l=new D.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),un=new Bt.Yd("@firebase/auth");function Ee(c,...o){un.logLevel<=Bt.in.ERROR&&un.error(`Auth (${qt.SDK_VERSION}): ${c}`,...o)}function Ae(c,...o){throw Ke(c,...o)}function ue(c,...o){return Ke(c,...o)}function $u(c,o,a){const h=Object.assign(Object.assign({},Zi()),{[o]:a});return new D.LL("auth","Firebase",h).create(o,{appName:c.name})}function _t(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&Ae(c,"argument-error"),$u(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Ke(c,...o){if("string"!=typeof c){const a=o[0],h=[...o.slice(1)];return h[0]&&(h[0].appName=c.name),c._errorFactory.create(a,...h)}return l.create(c,...o)}function N(c,o,...a){if(!c)throw Ke(o,...a)}function He(c){const o="INTERNAL ASSERTION FAILED: "+c;throw Ee(o),new Error(o)}function tt(c,o){c||He(o)}const nt=new Map;function Y(c){tt(c instanceof Function,"Expected a class definition");let o=nt.get(c);return o?(tt(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,nt.set(c,o),o)}function Dn(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function Lo(){return"http:"===ss()||"https:"===ss()}function ss(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class Gi{constructor(o,a){this.shortDelay=o,this.longDelay=a,tt(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,D.uI)()||(0,D.b$)()}get(){return function eh(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(Lo()||(0,D.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Fo(c,o){tt(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class ju{static initialize(o,a,h){this.fetchImpl=o,a&&(this.headersImpl=a),h&&(this.responseImpl=h)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void He("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void He("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void He("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const cn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Wu=new Gi(3e4,6e4);function pe(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function Le(c,o,a,h){return os.apply(this,arguments)}function os(){return(os=(0,I.Z)(function*(c,o,a,h,p={}){return th(c,p,(0,I.Z)(function*(){let _={},v={};h&&("GET"===o?v=h:_={body:JSON.stringify(h)});const T=(0,D.xO)(Object.assign({key:c.config.apiKey},v)).slice(1),A=yield c._getAdditionalHeaders();return A["Content-Type"]="application/json",c.languageCode&&(A["X-Firebase-Locale"]=c.languageCode),ju.fetch()(as(c,c.config.apiHost,a,T),Object.assign({method:o,headers:A,referrerPolicy:"no-referrer"},_))}))})).apply(this,arguments)}function th(c,o,a){return Uo.apply(this,arguments)}function Uo(){return(Uo=(0,I.Z)(function*(c,o,a){c._canInitEmulator=!1;const h=Object.assign(Object.assign({},cn),o);try{const p=new nh(c),_=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const v=yield _.json();if("needConfirmation"in v)throw zi(c,"account-exists-with-different-credential",v);if(_.ok&&!("errorMessage"in v))return v;{const T=_.ok?v.errorMessage:v.error.message,[A,L]=T.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===A)throw zi(c,"credential-already-in-use",v);if("EMAIL_EXISTS"===A)throw zi(c,"email-already-in-use",v);if("USER_DISABLED"===A)throw zi(c,"user-disabled",v);const $=h[A]||A.toLowerCase().replace(/[_\s]+/g,"-");if(L)throw $u(c,$,L);Ae(c,$)}}catch(p){if(p instanceof D.ZR)throw p;Ae(c,"network-request-failed")}})).apply(this,arguments)}function Gt(c,o,a,h){return Vo.apply(this,arguments)}function Vo(){return(Vo=(0,I.Z)(function*(c,o,a,h,p={}){const _=yield Le(c,o,a,h,p);return"mfaPendingCredential"in _&&Ae(c,"multi-factor-auth-required",{_serverResponse:_}),_})).apply(this,arguments)}function as(c,o,a,h){const p=`${o}${a}?${h}`;return c.config.emulator?Fo(c.config,p):`${c.config.apiScheme}://${p}`}class nh{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,h)=>{this.timer=setTimeout(()=>h(ue(this.auth,"network-request-failed")),Wu.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function zi(c,o,a){const h={appName:c.name};a.email&&(h.email=a.email),a.phoneNumber&&(h.phoneNumber=a.phoneNumber);const p=ue(c,o,h);return p.customData._tokenResponse=a,p}function ln(){return(ln=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function ni(c,o){return Ku.apply(this,arguments)}function Ku(){return(Ku=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ih(c,o){return qo.apply(this,arguments)}function qo(){return(qo=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function Ve(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function zt(){return(zt=(0,I.Z)(function*(c,o=!1){const a=(0,D.m9)(c),h=yield a.getIdToken(o),p=us(h);N(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const _="object"==typeof p.firebase?p.firebase:void 0,v=null==_?void 0:_.sign_in_provider;return{claims:p,token:h,authTime:Ve(Zo(p.auth_time)),issuedAtTime:Ve(Zo(p.iat)),expirationTime:Ve(Zo(p.exp)),signInProvider:v||null,signInSecondFactor:(null==_?void 0:_.sign_in_second_factor)||null}})).apply(this,arguments)}function Zo(c){return 1e3*Number(c)}function us(c){const[o,a,h]=c.split(".");if(void 0===o||void 0===a||void 0===h)return Ee("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,D.tV)(a);return p?JSON.parse(p):(Ee("Failed to decode base64 JWT payload"),null)}catch(p){return Ee("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function Qe(c,o){return Go.apply(this,arguments)}function Go(){return(Go=(0,I.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(h){throw h instanceof D.ZR&&sh(h)&&c.auth.currentUser===c&&(yield c.auth.signOut()),h}})).apply(this,arguments)}function sh({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class oh{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const h=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),h}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const h=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),h)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Hu{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ve(this.lastLoginAt),this.creationTime=Ve(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function xt(c){return $t.apply(this,arguments)}function $t(){return($t=(0,I.Z)(function*(c){var o;const a=c.auth,h=yield c.getIdToken(),p=yield Qe(c,ih(a,{idToken:h}));N(null==p?void 0:p.users.length,a,"internal-error");const _=p.users[0];c._notifyReloadListener(_);const v=(null===(o=_.providerUserInfo)||void 0===o?void 0:o.length)?uh(_.providerUserInfo):[],T=ze(c.providerData,v),$=!!c.isAnonymous&&!(c.email&&_.passwordHash||(null==T?void 0:T.length)),z={uid:_.localId,displayName:_.displayName||null,photoURL:_.photoUrl||null,email:_.email||null,emailVerified:_.emailVerified||!1,phoneNumber:_.phoneNumber||null,tenantId:_.tenantId||null,providerData:T,metadata:new Hu(_.createdAt,_.lastLoginAt),isAnonymous:$};Object.assign(c,z)})).apply(this,arguments)}function ji(){return(ji=(0,I.Z)(function*(c){const o=(0,D.m9)(c);yield xt(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function ze(c,o){return[...c.filter(h=>!o.some(p=>p.providerId===h.providerId)),...o]}function uh(c){return c.map(o=>{var{providerId:a}=o,h=(0,ti._T)(o,["providerId"]);return{providerId:a,uid:h.rawId||"",displayName:h.displayName||null,email:h.email||null,phoneNumber:h.phoneNumber||null,photoURL:h.photoUrl||null}})}function Wi(){return(Wi=(0,I.Z)(function*(c,o){const a=yield th(c,{},(0,I.Z)(function*(){const h=(0,D.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:_}=c.config,v=as(c,p,"/v1/token",`key=${_}`),T=yield c._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",ju.fetch()(v,{method:"POST",headers:T,body:h})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class De{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){N(o.idToken,"internal-error"),N(void 0!==o.idToken,"internal-error"),N(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function rh(c){const o=us(c);return N(o,"internal-error"),N(void 0!==o.exp,"internal-error"),N(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var h=this;return(0,I.Z)(function*(){return N(!h.accessToken||h.refreshToken,o,"user-token-expired"),a||!h.accessToken||h.isExpired?h.refreshToken?(yield h.refresh(o,h.refreshToken),h.accessToken):null:h.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var h=this;return(0,I.Z)(function*(){const{accessToken:p,refreshToken:_,expiresIn:v}=yield function ch(c,o){return Wi.apply(this,arguments)}(o,a);h.updateTokensAndExpiration(p,_,Number(v))})()}updateTokensAndExpiration(o,a,h){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*h}static fromJSON(o,a){const{refreshToken:h,accessToken:p,expirationTime:_}=a,v=new De;return h&&(N("string"==typeof h,"internal-error",{appName:o}),v.refreshToken=h),p&&(N("string"==typeof p,"internal-error",{appName:o}),v.accessToken=p),_&&(N("number"==typeof _,"internal-error",{appName:o}),v.expirationTime=_),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new De,this.toJSON())}_performRefresh(){return He("not implemented")}}function kt(c,o){N("string"==typeof c||void 0===c,"internal-error",{appName:o})}class hn{constructor(o){var{uid:a,auth:h,stsTokenManager:p}=o,_=(0,ti._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new oh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=h,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=_.displayName||null,this.email=_.email||null,this.emailVerified=_.emailVerified||!1,this.phoneNumber=_.phoneNumber||null,this.photoURL=_.photoURL||null,this.isAnonymous=_.isAnonymous||!1,this.tenantId=_.tenantId||null,this.providerData=_.providerData?[..._.providerData]:[],this.metadata=new Hu(_.createdAt||void 0,_.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const h=yield Qe(a,a.stsTokenManager.getToken(a.auth,o));return N(h,a.auth,"internal-error"),a.accessToken!==h&&(a.accessToken=h,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),h})()}getIdTokenResult(o){return function $i(c){return zt.apply(this,arguments)}(this,o)}reload(){return function ah(c){return ji.apply(this,arguments)}(this)}_assign(o){this!==o&&(N(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new hn(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){N(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var h=this;return(0,I.Z)(function*(){let p=!1;o.idToken&&o.idToken!==h.stsTokenManager.accessToken&&(h.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield xt(h)),yield h.auth._persistUserIfCurrent(h),p&&h.auth._notifyListenersIfCurrent(h)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield Qe(o,function _p(c,o){return ln.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var h,p,_,v,T,A,L,$;const z=null!==(h=a.displayName)&&void 0!==h?h:void 0,Ne=null!==(p=a.email)&&void 0!==p?p:void 0,Je=null!==(_=a.phoneNumber)&&void 0!==_?_:void 0,po=null!==(v=a.photoURL)&&void 0!==v?v:void 0,uu=null!==(T=a.tenantId)&&void 0!==T?T:void 0,bn=null!==(A=a._redirectEventId)&&void 0!==A?A:void 0,Ft=null!==(L=a.createdAt)&&void 0!==L?L:void 0,cu=null!==($=a.lastLoginAt)&&void 0!==$?$:void 0,{uid:mo,emailVerified:lu,isAnonymous:Hn,providerData:Zr,stsTokenManager:sl}=a;N(mo&&sl,o,"internal-error");const Se=De.fromJSON(this.name,sl);N("string"==typeof mo,o,"internal-error"),kt(z,o.name),kt(Ne,o.name),N("boolean"==typeof lu,o,"internal-error"),N("boolean"==typeof Hn,o,"internal-error"),kt(Je,o.name),kt(po,o.name),kt(uu,o.name),kt(bn,o.name),kt(Ft,o.name),kt(cu,o.name);const te=new hn({uid:mo,auth:o,email:Ne,emailVerified:lu,displayName:z,isAnonymous:Hn,photoURL:po,phoneNumber:Je,tenantId:uu,stsTokenManager:Se,createdAt:Ft,lastLoginAt:cu});return Zr&&Array.isArray(Zr)&&(te.providerData=Zr.map(ol=>Object.assign({},ol))),bn&&(te._redirectEventId=bn),te}static _fromIdTokenResponse(o,a,h=!1){return(0,I.Z)(function*(){const p=new De;p.updateFromServerResponse(a);const _=new hn({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:h});return yield xt(_),_})()}}const Ki=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,h){var p=this;return(0,I.Z)(function*(){p.storage[a]=h})()}_get(a){var h=this;return(0,I.Z)(function*(){const p=h.storage[a];return void 0===p?null:p})()}_remove(a){var h=this;return(0,I.Z)(function*(){delete h.storage[a]})()}_addListener(a,h){}_removeListener(a,h){}}return c.type="NONE",c})();function Rn(c,o,a){return`firebase:${c}:${o}:${a}`}class x{constructor(o,a,h){this.persistence=o,this.auth=a,this.userKey=h;const{config:p,name:_}=this.auth;this.fullUserKey=Rn(this.userKey,p.apiKey,_),this.fullPersistenceKey=Rn("persistence",p.apiKey,_),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?hn._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const h=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,h?a.setCurrentUser(h):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,h="authUser"){return(0,I.Z)(function*(){if(!a.length)return new x(Y(Ki),o,h);const p=(yield Promise.all(a.map(function(){var L=(0,I.Z)(function*($){if(yield $._isAvailable())return $});return function($){return L.apply(this,arguments)}}()))).filter(L=>L);let _=p[0]||Y(Ki);const v=Rn(h,o.config.apiKey,o.name);let T=null;for(const L of a)try{const $=yield L._get(v);if($){const z=hn._fromJSON(o,$);L!==_&&(T=z),_=L;break}}catch($){}const A=p.filter(L=>L._shouldAllowMigration);return _._shouldAllowMigration&&A.length?(_=A[0],T&&(yield _._set(v,T.toJSON())),yield Promise.all(a.map(function(){var L=(0,I.Z)(function*($){if($!==_)try{yield $._remove(v)}catch(z){}});return function($){return L.apply(this,arguments)}}())),new x(_,o,h)):new x(_,o,h)})()}}function dn(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Qu(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(Hi(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(q(o))return"Blackberry";if(cs(o))return"Webos";if(At(o))return"Safari";if((o.includes("chrome/")||re(o))&&!o.includes("edge/"))return"Chrome";if(ut(o))return"Android";{const h=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==h?void 0:h.length))return h[1]}return"Other"}function Hi(c=(0,D.z$)()){return/firefox\//i.test(c)}function At(c=(0,D.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function re(c=(0,D.z$)()){return/crios\//i.test(c)}function Qu(c=(0,D.z$)()){return/iemobile/i.test(c)}function ut(c=(0,D.z$)()){return/android/i.test(c)}function q(c=(0,D.z$)()){return/blackberry/i.test(c)}function cs(c=(0,D.z$)()){return/webos/i.test(c)}function j(c=(0,D.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Yu(c=(0,D.z$)()){return j(c)||ut(c)||cs(c)||q(c)||/windows phone/i.test(c)||Qu(c)}function Ju(c,o=[]){let a;switch(c){case"Browser":a=dn((0,D.z$)());break;case"Worker":a=`${dn((0,D.z$)())}-${c}`;break;default:a=c}const h=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${qt.SDK_VERSION}/${h}`}class lh{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const h=_=>new Promise((v,T)=>{try{v(o(_))}catch(A){T(A)}});h.onAbort=a,this.queue.push(h);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){if(a.auth.currentUser===o)return;const h=[];try{for(const p of a.queue)yield p(o),p.onAbort&&h.push(p.onAbort)}catch(p){h.reverse();for(const _ of h)try{_()}catch(v){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}class hh{constructor(o,a,h){this.app=o,this.heartbeatServiceProvider=a,this.config=h,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Yi(this),this.idTokenSubscription=new Yi(this),this.beforeStateQueue=new lh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=l,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=h.sdkClientVersion}_initializeWithPersistence(o,a){var h=this;return a&&(this._popupRedirectResolver=Y(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var p,_;if(!h._deleted&&(h.persistenceManager=yield x.create(h,o),!h._deleted)){if(null===(p=h._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield h._popupRedirectResolver._initialize(h)}catch(v){}yield h.initializeCurrentUser(a),h.lastNotifiedUid=(null===(_=h.currentUser)||void 0===_?void 0:_.uid)||null,!h._deleted&&(h._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var h;const p=yield a.assertedPersistence.getCurrentUser();let _=p,v=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const T=null===(h=a.redirectUser)||void 0===h?void 0:h._redirectEventId,A=null==_?void 0:_._redirectEventId,L=yield a.tryRedirectSignIn(o);(!T||T===A)&&(null==L?void 0:L.user)&&(_=L.user,v=!0)}if(!_)return a.directlySetCurrentUser(null);if(!_._redirectEventId){if(v)try{yield a.beforeStateQueue.runMiddleware(_)}catch(T){_=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(T))}return _?a.reloadAndSetCurrentUserOrClear(_):a.directlySetCurrentUser(null)}return N(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===_._redirectEventId?a.directlySetCurrentUser(_):a.reloadAndSetCurrentUserOrClear(_)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let h=null;try{h=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return h})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){try{yield xt(o)}catch(h){if("auth/network-request-failed"!==(null==h?void 0:h.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function gp(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const h=o?(0,D.m9)(o):null;return h&&N(h.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(h&&h._clone(a))})()}_updateCurrentUser(o,a=!1){var h=this;return(0,I.Z)(function*(){if(!h._deleted)return o&&N(h.tenantId===o.tenantId,h,"tenant-id-mismatch"),a||(yield h.beforeStateQueue.runMiddleware(o)),h.queue((0,I.Z)(function*(){yield h.directlySetCurrentUser(o),h.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(Y(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new D.LL("auth","Firebase",o())}onAuthStateChanged(o,a,h){return this.registerStateListener(this.authStateSubscription,o,a,h)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,h){return this.registerStateListener(this.idTokenSubscription,o,a,h)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var h=this;return(0,I.Z)(function*(){const p=yield h.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const h=o&&Y(o)||a._popupRedirectResolver;N(h,a,"argument-error"),a.redirectPersistenceManager=yield x.create(a,[Y(h._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var h,p;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(h=a._currentUser)||void 0===h?void 0:h._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const h=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==h&&(this.lastNotifiedUid=h,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,h,p){if(this._deleted)return()=>{};const _="function"==typeof a?a:a.next.bind(a),v=this._isInitialized?Promise.resolve():this._initializationPromise;return N(v,this,"internal-error"),v.then(()=>_(this.currentUser)),"function"==typeof a?o.addObserver(a,h,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return N(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Ju(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const h={"X-Client-Version":o.clientVersion};o.app.options.appId&&(h["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(h["X-Firebase-Client"]=p),h})()}}function se(c){return(0,D.m9)(c)}class Yi{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,D.ne)(a=>this.observer=a)}get next(){return N(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Wt(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function $o(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Nn{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return He("not implemented")}_getIdTokenResponse(o){return He("not implemented")}_linkToIdToken(o,a){return He("not implemented")}_getReauthenticationResolver(o){return He("not implemented")}}function qe(c,o){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:resetPassword",pe(c,o))})).apply(this,arguments)}function Ji(c,o){return ds.apply(this,arguments)}function ds(){return(ds=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Ko(c,o){return ii.apply(this,arguments)}function ii(){return(ii=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:update",pe(c,o))})).apply(this,arguments)}function Xi(){return(Xi=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithPassword",pe(c,o))})).apply(this,arguments)}function fs(c,o){return Ho.apply(this,arguments)}function Ho(){return(Ho=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:sendOobCode",pe(c,o))})).apply(this,arguments)}function ri(c,o){return ps.apply(this,arguments)}function ps(){return(ps=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function Qo(c,o){return ms.apply(this,arguments)}function ms(){return(ms=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function fh(c,o){return gs.apply(this,arguments)}function gs(){return(gs=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function _s(c,o){return er.apply(this,arguments)}function er(){return(er=(0,I.Z)(function*(c,o){return fs(c,o)})).apply(this,arguments)}function tr(){return(tr=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithEmailLink",pe(c,o))})).apply(this,arguments)}function Jo(){return(Jo=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithEmailLink",pe(c,o))})).apply(this,arguments)}class On extends Nn{constructor(o,a,h,p=null){super("password",h),this._email=o,this._password=a,this._tenantId=p}static _fromEmailAndPassword(o,a){return new On(o,a,"password")}static _fromEmailAndCode(o,a,h=null){return new On(o,a,"emailLink",h)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){switch(a.signInMethod){case"password":return function Ct(c,o){return Xi.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function Yo(c,o){return tr.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:Ae(o,"internal-error")}})()}_linkToIdToken(o,a){var h=this;return(0,I.Z)(function*(){switch(h.signInMethod){case"password":return Ji(o,{idToken:a,returnSecureToken:!0,email:h._email,password:h._password});case"emailLink":return function ph(c,o){return Jo.apply(this,arguments)}(o,{idToken:a,email:h._email,oobCode:h._password});default:Ae(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function St(c,o){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithIdp",pe(c,o))})).apply(this,arguments)}class Dt extends Nn{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new Dt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):Ae("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:p}=a,_=(0,ti._T)(a,["providerId","signInMethod"]);if(!h||!p)return null;const v=new Dt(h,p);return v.idToken=_.idToken||void 0,v.accessToken=_.accessToken||void 0,v.secret=_.secret,v.nonce=_.nonce,v.pendingToken=_.pendingToken||null,v}_getIdTokenResponse(o){return St(o,this.buildRequest())}_linkToIdToken(o,a){const h=this.buildRequest();return h.idToken=a,St(o,h)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,St(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,D.xO)(a)}return o}}function ir(c,o){return ea.apply(this,arguments)}function ea(){return(ea=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:sendVerificationCode",pe(c,o))})).apply(this,arguments)}function si(){return(si=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithPhoneNumber",pe(c,o))})).apply(this,arguments)}function ys(){return(ys=(0,I.Z)(function*(c,o){const a=yield Gt(c,"POST","/v1/accounts:signInWithPhoneNumber",pe(c,o));if(a.temporaryProof)throw zi(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Xu={USER_NOT_FOUND:"user-not-found"};function oi(){return(oi=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithPhoneNumber",pe(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Xu)})).apply(this,arguments)}class Kt extends Nn{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Kt({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Kt({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function mh(c,o){return si.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function ta(c,o){return ys.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function ec(c,o){return oi.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:h,verificationCode:p}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:h,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:h,phoneNumber:p,temporaryProof:_}=o;return h||a||p||_?new Kt({verificationId:a,verificationCode:h,phoneNumber:p,temporaryProof:_}):null}}class Mn{constructor(o){var a,h,p,_,v,T;const A=(0,D.zd)((0,D.pd)(o)),L=null!==(a=A.apiKey)&&void 0!==a?a:null,$=null!==(h=A.oobCode)&&void 0!==h?h:null,z=function na(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=A.mode)&&void 0!==p?p:null);N(L&&$&&z,"argument-error"),this.apiKey=L,this.operation=z,this.code=$,this.continueUrl=null!==(_=A.continueUrl)&&void 0!==_?_:null,this.languageCode=null!==(v=A.languageCode)&&void 0!==v?v:null,this.tenantId=null!==(T=A.tenantId)&&void 0!==T?T:null}static parseLink(o){const a=function ia(c){const o=(0,D.zd)((0,D.pd)(c)).link,a=o?(0,D.zd)((0,D.pd)(o)).deep_link_id:null,h=(0,D.zd)((0,D.pd)(c)).deep_link_id;return(h?(0,D.zd)((0,D.pd)(h)).link:null)||h||a||o||c}(o);try{return new Mn(a)}catch(h){return null}}}let vs=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,h){return On._fromEmailAndPassword(a,h)}static credentialWithLink(a,h){const p=Mn.parseLink(h);return N(p,"argument-error"),On._fromEmailAndCode(a,p.code,p.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class Ht{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class Pn extends Ht{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Ln extends Pn{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return N("providerId"in a&&"signInMethod"in a,"argument-error"),Dt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return N(o.idToken||o.accessToken,"argument-error"),Dt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Ln.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Ln.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:h,oauthTokenSecret:p,pendingToken:_,nonce:v,providerId:T}=o;if(!h&&!p&&!a&&!_||!T)return null;try{return new Ln(T)._credential({idToken:a,accessToken:h,nonce:v,pendingToken:_})}catch(A){return null}}}let Is=(()=>{class c extends Pn{constructor(){super("facebook.com")}static credential(a){return Dt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(h){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),ra=(()=>{class c extends Pn{constructor(){super("google.com"),this.addScope("profile")}static credential(a,h){return Dt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:h})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:h,oauthAccessToken:p}=a;if(!h&&!p)return null;try{return c.credential(h,p)}catch(_){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),tc=(()=>{class c extends Pn{constructor(){super("github.com")}static credential(a){return Dt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(h){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class fn extends Nn{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return St(o,this.buildRequest())}_linkToIdToken(o,a){const h=this.buildRequest();return h.idToken=a,St(o,h)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,St(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:h,signInMethod:p,pendingToken:_}=a;return h&&p&&_&&h===p?new fn(h,_):null}static _create(o,a){return new fn(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Te extends Ht{constructor(o){N(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Te.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Te.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=fn.fromJSON(o);return N(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:h}=o;if(!a||!h)return null;try{return fn._create(h,a)}catch(p){return null}}}let Ue=(()=>{class c extends Pn{constructor(){super("twitter.com")}static credential(a,h){return Dt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:h})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:h,oauthTokenSecret:p}=a;if(!h||!p)return null;try{return c.credential(h,p)}catch(_){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function rr(c,o){return sr.apply(this,arguments)}function sr(){return(sr=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signUp",pe(c,o))})).apply(this,arguments)}class yt{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,h,p=!1){return(0,I.Z)(function*(){const _=yield hn._fromIdTokenResponse(o,h,p),v=nc(h);return new yt({user:_,providerId:v,_tokenResponse:h,operationType:a})})()}static _forOperation(o,a,h){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(h,!0);const p=nc(h);return new yt({user:o,providerId:p,_tokenResponse:h,operationType:a})})()}}function nc(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function aa(){return(aa=(0,I.Z)(function*(c){var o;const a=se(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new yt({user:a.currentUser,providerId:null,operationType:"signIn"});const h=yield rr(a,{returnSecureToken:!0}),p=yield yt._fromIdTokenResponse(a,"signIn",h,!0);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class ws extends D.ZR{constructor(o,a,h,p){var _;super(a.code,a.message),this.operationType=h,this.user=p,Object.setPrototypeOf(this,ws.prototype),this.customData={appName:o.name,tenantId:null!==(_=o.tenantId)&&void 0!==_?_:void 0,_serverResponse:a.customData._serverResponse,operationType:h}}static _fromErrorAndOperation(o,a,h,p){return new ws(o,a,h,p)}}function ua(c,o,a,h){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(_=>{throw"auth/multi-factor-auth-required"===_.code?ws._fromErrorAndOperation(c,_,o,h):_})}function bs(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function or(){return(or=(0,I.Z)(function*(c,o){const a=(0,D.m9)(c);yield Fn(!0,a,o);const{providerUserInfo:h}=yield ni(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),p=bs(h||[]);return a.providerData=a.providerData.filter(_=>p.has(_.providerId)),p.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function Es(c,o){return ca.apply(this,arguments)}function ca(){return(ca=(0,I.Z)(function*(c,o,a=!1){const h=yield Qe(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return yt._forOperation(c,"link",h)})).apply(this,arguments)}function Fn(c,o,a){return ar.apply(this,arguments)}function ar(){return(ar=(0,I.Z)(function*(c,o,a){yield xt(o);const p=!1===c?"provider-already-linked":"no-such-provider";N(bs(o.providerData).has(a)===c,o.auth,p)})).apply(this,arguments)}function Ts(c,o){return xs.apply(this,arguments)}function xs(){return(xs=(0,I.Z)(function*(c,o,a=!1){const{auth:h}=c,p="reauthenticate";try{const _=yield Qe(c,ua(h,p,o,c),a);N(_.idToken,h,"internal-error");const v=us(_.idToken);N(v,h,"internal-error");const{sub:T}=v;return N(c.uid===T,h,"user-mismatch"),yt._forOperation(c,p,_)}catch(_){throw"auth/user-not-found"===(null==_?void 0:_.code)&&Ae(h,"user-mismatch"),_}})).apply(this,arguments)}function rc(c,o){return Un.apply(this,arguments)}function Un(){return(Un=(0,I.Z)(function*(c,o,a=!1){const h="signIn",p=yield ua(c,h,o),_=yield yt._fromIdTokenResponse(c,h,p);return a||(yield c._updateCurrentUser(_.user)),_})).apply(this,arguments)}function ur(c,o){return ks.apply(this,arguments)}function ks(){return(ks=(0,I.Z)(function*(c,o){return rc(se(c),o)})).apply(this,arguments)}function la(c,o){return ai.apply(this,arguments)}function ai(){return(ai=(0,I.Z)(function*(c,o){const a=(0,D.m9)(c);return yield Fn(!1,a,o.providerId),Es(a,o)})).apply(this,arguments)}function sc(c,o){return ha.apply(this,arguments)}function ha(){return(ha=(0,I.Z)(function*(c,o){return Ts((0,D.m9)(c),o)})).apply(this,arguments)}function ui(c,o){return da.apply(this,arguments)}function da(){return(da=(0,I.Z)(function*(c,o){return Gt(c,"POST","/v1/accounts:signInWithCustomToken",pe(c,o))})).apply(this,arguments)}function Qt(){return(Qt=(0,I.Z)(function*(c,o){const a=se(c),h=yield ui(a,{token:o,returnSecureToken:!0}),p=yield yt._fromIdTokenResponse(a,"signIn",h);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class cr{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?ci._fromServerResponse(o,a):Ae(o,"internal-error")}}class ci extends cr{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new ci(a)}}function lr(c,o,a){var h;N((null===(h=a.url)||void 0===h?void 0:h.length)>0,c,"invalid-continue-uri"),N(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(N(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(N(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function As(){return(As=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c),p={requestType:"PASSWORD_RESET",email:o};a&&lr(h,p,a),yield Qo(h,p)})).apply(this,arguments)}function Cs(){return(Cs=(0,I.Z)(function*(c,o,a){yield qe((0,D.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function li(){return(li=(0,I.Z)(function*(c,o){yield Ko((0,D.m9)(c),{oobCode:o})})).apply(this,arguments)}function fa(c,o){return fr.apply(this,arguments)}function fr(){return(fr=(0,I.Z)(function*(c,o){const a=(0,D.m9)(c),h=yield qe(a,{oobCode:o}),p=h.requestType;switch(N(p,a,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":N(h.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":N(h.mfaInfo,a,"internal-error");default:N(h.email,a,"internal-error")}let _=null;return h.mfaInfo&&(_=cr._fromServerResponse(se(a),h.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.newEmail:h.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===h.requestType?h.email:h.newEmail)||null,multiFactorInfo:_},operation:p}})).apply(this,arguments)}function Ss(){return(Ss=(0,I.Z)(function*(c,o){const{data:a}=yield fa((0,D.m9)(c),o);return a.email})).apply(this,arguments)}function mr(){return(mr=(0,I.Z)(function*(c,o,a){const h=se(c),p=yield rr(h,{returnSecureToken:!0,email:o,password:a}),_=yield yt._fromIdTokenResponse(h,"signIn",p);return yield h._updateCurrentUser(_.user),_})).apply(this,arguments)}function hi(){return(hi=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c),p={requestType:"EMAIL_SIGNIN",email:o};N(a.handleCodeInApp,h,"argument-error"),a&&lr(h,p,a),yield fh(h,p)})).apply(this,arguments)}function ga(){return(ga=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c),p=vs.credentialWithLink(o,a||Dn());return N(p._tenantId===(h.tenantId||null),h,"tenant-id-mismatch"),ur(h,p)})).apply(this,arguments)}function _a(c,o){return di.apply(this,arguments)}function di(){return(di=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:createAuthUri",pe(c,o))})).apply(this,arguments)}function Ds(){return(Ds=(0,I.Z)(function*(c,o){const h={identifier:o,continueUri:Lo()?Dn():"http://localhost"},{signinMethods:p}=yield _a((0,D.m9)(c),h);return p||[]})).apply(this,arguments)}function Rs(){return(Rs=(0,I.Z)(function*(c,o){const a=(0,D.m9)(c),p={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&lr(a.auth,p,o);const{email:_}=yield ri(a.auth,p);_!==c.email&&(yield c.reload())})).apply(this,arguments)}function Vn(){return(Vn=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c),_={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&lr(h.auth,_,a);const{email:v}=yield _s(h.auth,_);v!==c.email&&(yield c.reload())})).apply(this,arguments)}function cc(c,o){return fi.apply(this,arguments)}function fi(){return(fi=(0,I.Z)(function*(c,o){return Le(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function Yt(){return(Yt=(0,I.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const h=(0,D.m9)(c),_={idToken:yield h.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},v=yield Qe(h,cc(h.auth,_));h.displayName=v.displayName||null,h.photoURL=v.photoUrl||null;const T=h.providerData.find(({providerId:A})=>"password"===A);T&&(T.displayName=h.displayName,T.photoURL=h.photoURL),yield h._updateTokensIfNecessary(v)})).apply(this,arguments)}function lc(c,o,a){return Ns.apply(this,arguments)}function Ns(){return(Ns=(0,I.Z)(function*(c,o,a){const{auth:h}=c,_={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(_.email=o),a&&(_.password=a);const v=yield Qe(c,Ji(h,_));yield c._updateTokensIfNecessary(v,!0)})).apply(this,arguments)}class pi{constructor(o,a,h={}){this.isNewUser=o,this.providerId=a,this.profile=h}}class pn extends pi{constructor(o,a,h,p){super(o,a,h),this.username=p}}class Jt extends pi{constructor(o,a){super(o,"facebook.com",a)}}class Os extends pn{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class Ms extends pi{constructor(o,a){super(o,"google.com",a)}}class dc extends pn{constructor(o,a,h){super(o,"twitter.com",a,h)}}function fe(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function hc(c){var o,a;if(!c)return null;const{providerId:h}=c,p=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},_=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!h&&(null==c?void 0:c.idToken)){const v=null===(a=null===(o=us(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(v)return new pi(_,"anonymous"!==v&&"custom"!==v?v:null)}if(!h)return null;switch(h){case"facebook.com":return new Jt(_,p);case"github.com":return new Os(_,p);case"google.com":return new Ms(_,p);case"twitter.com":return new dc(_,p,c.screenName||null);case"custom":case"anonymous":return new pi(_,null);default:return new pi(_,h,p)}}(a)}class wt{constructor(o,a,h){this.type=o,this.credential=a,this.auth=h}static _fromIdtoken(o,a){return new wt("enroll",o,a)}static _fromMfaPendingCredential(o){return new wt("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,h;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return wt._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(h=o.multiFactorSession)||void 0===h?void 0:h.idToken)return wt._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Rt{constructor(o,a,h){this.session=o,this.hints=a,this.signInResolver=h}static _fromError(o,a){const h=se(o),p=a.customData._serverResponse,_=(p.mfaInfo||[]).map(T=>cr._fromServerResponse(h,T));N(p.mfaPendingCredential,h,"internal-error");const v=wt._fromMfaPendingCredential(p.mfaPendingCredential);return new Rt(v,_,function(){var T=(0,I.Z)(function*(A){const L=yield A._process(h,v);delete p.mfaInfo,delete p.mfaPendingCredential;const $=Object.assign(Object.assign({},p),{idToken:L.idToken,refreshToken:L.refreshToken});switch(a.operationType){case"signIn":const z=yield yt._fromIdTokenResponse(h,a.operationType,$);return yield h._updateCurrentUser(z.user),z;case"reauthenticate":return N(a.user,h,"internal-error"),yt._forOperation(a.user,a.operationType,$);default:Ae(h,"internal-error")}});return function(A){return T.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}function pc(c,o){return Le(c,"POST","/v2/accounts/mfaEnrollment:start",pe(c,o))}class ba{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(h=>cr._fromServerResponse(o.auth,h)))})}static _fromUser(o){return new ba(o)}getSession(){var o=this;return(0,I.Z)(function*(){return wt._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var h=this;return(0,I.Z)(function*(){const p=o,_=yield h.getSession(),v=yield Qe(h.user,p._process(h.user.auth,_,a));return yield h.user._updateTokensIfNecessary(v),h.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){const h="string"==typeof o?o:o.uid,p=yield a.user.getIdToken(),_=yield Qe(a.user,function mi(c,o){return Le(c,"POST","/v2/accounts/mfaEnrollment:withdraw",pe(c,o))}(a.user.auth,{idToken:p,mfaEnrollmentId:h}));a.enrolledFactors=a.enrolledFactors.filter(({uid:v})=>v!==h),yield a.user._updateTokensIfNecessary(_);try{yield a.user.reload()}catch(v){if("auth/user-token-expired"!==(null==v?void 0:v.code))throw v}})()}}const Ea=new WeakMap,Ps="__sak";class Ta{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(Ps,"1"),this.storage.removeItem(Ps),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Ir=(()=>{class c extends Ta{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,h)=>this.onStorageEvent(a,h),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function _c(){const c=(0,D.z$)();return At(c)||j(c)}()&&function zo(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=Yu(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const h of Object.keys(this.listeners)){const p=this.storage.getItem(h),_=this.localCache[h];p!==_&&a(h,_,p)}}onStorageEvent(a,h=!1){if(!a.key)return void this.forAllChangedKeys((T,A,L)=>{this.notifyListeners(T,L)});const p=a.key;if(h?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const T=this.storage.getItem(p);if(a.newValue!==T)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!h)return}const _=()=>{const T=this.storage.getItem(p);!h&&this.localCache[p]===T||this.notifyListeners(p,T)},v=this.storage.getItem(p);!function Qi(){return(0,D.w1)()&&10===document.documentMode}()||v===a.newValue||a.newValue===a.oldValue?_():setTimeout(_,10)}notifyListeners(a,h){this.localCache[a]=h;const p=this.listeners[a];if(p)for(const _ of Array.from(p))_(h&&JSON.parse(h))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,h,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:h,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,h){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,h){var p=()=>super._set,_=this;return(0,I.Z)(function*(){yield p().call(_,a,h),_.localCache[a]=JSON.stringify(h)})()}_get(a){var h=()=>super._get,p=this;return(0,I.Z)(function*(){const _=yield h().call(p,a);return p.localCache[a]=JSON.stringify(_),_})()}_remove(a){var h=()=>super._remove,p=this;return(0,I.Z)(function*(){yield h().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),mn=(()=>{class c extends Ta{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,h){}_removeListener(a,h){}}return c.type="SESSION",c})();let Th=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const h=this.receivers.find(_=>_.isListeningto(a));if(h)return h;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var h=this;return(0,I.Z)(function*(){const p=a,{eventId:_,eventType:v,data:T}=p.data,A=h.handlersMap[v];if(!(null==A?void 0:A.size))return;p.ports[0].postMessage({status:"ack",eventId:_,eventType:v});const L=Array.from(A).map(function(){var z=(0,I.Z)(function*(Ne){return Ne(p.origin,T)});return function(Ne){return z.apply(this,arguments)}}()),$=yield function Eh(c){return Promise.all(c.map(function(){var o=(0,I.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(h){return{fulfilled:!1,reason:h}}});return function(a){return o.apply(this,arguments)}}()))}(L);p.ports[0].postMessage({status:"done",eventId:_,eventType:v,response:$})})()}_subscribe(a,h){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(h)}_unsubscribe(a,h){this.handlersMap[a]&&h&&this.handlersMap[a].delete(h),(!h||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function gn(c="",o=10){let a="";for(let h=0;h<o;h++)a+=Math.floor(10*Math.random());return c+a}class wr{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,h=50){var p=this;return(0,I.Z)(function*(){const _="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!_)throw new Error("connection_unavailable");let v,T;return new Promise((A,L)=>{const $=gn("",20);_.port1.start();const z=setTimeout(()=>{L(new Error("unsupported_event"))},h);T={messageChannel:_,onMessage(Ne){const Je=Ne;if(Je.data.eventId===$)switch(Je.data.status){case"ack":clearTimeout(z),v=setTimeout(()=>{L(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),A(Je.data.response);break;default:clearTimeout(z),clearTimeout(v),L(new Error("invalid_response"))}}},p.handlers.add(T),_.port1.addEventListener("message",T.onMessage),p.target.postMessage({eventType:o,eventId:$,data:a},[_.port2])}).finally(()=>{T&&p.removeMessageHandler(T)})})()}}function _e(){return window}function Ls(){return void 0!==_e().WorkerGlobalScope&&"function"==typeof _e().importScripts}function qn(){return(qn=(0,I.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const Ca="firebaseLocalStorageDb",Fs="firebaseLocalStorage",vc="fbase_key";class gi{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Er(c,o){return c.transaction([Fs],o?"readwrite":"readonly").objectStore(Fs)}function _i(){const c=indexedDB.open(Ca,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const h=c.result;try{h.createObjectStore(Fs,{keyPath:vc})}catch(p){a(p)}}),c.addEventListener("success",(0,I.Z)(function*(){const h=c.result;h.objectStoreNames.contains(Fs)?o(h):(h.close(),yield function Ic(){const c=indexedDB.deleteDatabase(Ca);return new gi(c).toPromise()}(),o(yield _i()))}))})}function Sa(c,o,a){return bt.apply(this,arguments)}function bt(){return(bt=(0,I.Z)(function*(c,o,a){const h=Er(c,!0).put({[vc]:o,value:a});return new gi(h).toPromise()})).apply(this,arguments)}function Us(){return(Us=(0,I.Z)(function*(c,o){const a=Er(c,!1).get(o),h=yield new gi(a).toPromise();return void 0===h?null:h.value})).apply(this,arguments)}function Vs(c,o){const a=Er(c,!0).delete(o);return new gi(a).toPromise()}const Xt=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield _i()),a.db})()}_withRetries(a){var h=this;return(0,I.Z)(function*(){let p=0;for(;;)try{const _=yield h._openDb();return yield a(_)}catch(_){if(p++>3)throw _;h.db&&(h.db.close(),h.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Ls()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){a.receiver=Th._getInstance(function ye(){return Ls()?self:null}()),a.receiver._subscribe("keyChanged",function(){var h=(0,I.Z)(function*(p,_){return{keyProcessed:(yield a._poll()).includes(_.key)}});return function(p,_){return h.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var h=(0,I.Z)(function*(p,_){return["keyChanged"]});return function(p,_){return h.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var h,p;if(a.activeServiceWorker=yield function br(){return qn.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new wr(a.activeServiceWorker);const _=yield a.sender._send("ping",{},800);!_||(null===(h=_[0])||void 0===h?void 0:h.fulfilled)&&(null===(p=_[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var h=this;return(0,I.Z)(function*(){if(h.sender&&h.activeServiceWorker&&function xh(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===h.activeServiceWorker)try{yield h.sender._send("keyChanged",{key:a},h.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield _i();return yield Sa(a,Ps,"1"),yield Vs(a,Ps),!0}catch(a){}return!1})()}_withPendingWrite(a){var h=this;return(0,I.Z)(function*(){h.pendingWrites++;try{yield a()}finally{h.pendingWrites--}})()}_set(a,h){var p=this;return(0,I.Z)(function*(){return p._withPendingWrite((0,I.Z)(function*(){return yield p._withRetries(_=>Sa(_,a,h)),p.localCache[a]=h,p.notifyServiceWorker(a)}))})()}_get(a){var h=this;return(0,I.Z)(function*(){const p=yield h._withRetries(_=>function wc(c,o){return Us.apply(this,arguments)}(_,a));return h.localCache[a]=p,p})()}_remove(a){var h=this;return(0,I.Z)(function*(){return h._withPendingWrite((0,I.Z)(function*(){return yield h._withRetries(p=>Vs(p,a)),delete h.localCache[a],h.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const h=yield a._withRetries(v=>{const T=Er(v,!1).getAll();return new gi(T).toPromise()});if(!h)return[];if(0!==a.pendingWrites)return[];const p=[],_=new Set;for(const{fbase_key:v,value:T}of h)_.add(v),JSON.stringify(a.localCache[v])!==JSON.stringify(T)&&(a.notifyListeners(v,T),p.push(v));for(const v of Object.keys(a.localCache))a.localCache[v]&&!_.has(v)&&(a.notifyListeners(v,null),p.push(v));return p})()}notifyListeners(a,h){this.localCache[a]=h;const p=this.listeners[a];if(p)for(const _ of Array.from(p))_(h)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,h){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(h)}_removeListener(a,h){this.listeners[a]&&(this.listeners[a].delete(h),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function Tc(c,o){return Le(c,"POST","/v2/accounts/mfaSignIn:start",pe(c,o))}function Bs(){return(Bs=(0,I.Z)(function*(c){return(yield Le(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Da(c){return new Promise((o,a)=>{const h=document.createElement("script");h.setAttribute("src",c),h.onload=o,h.onerror=p=>{const _=ue("internal-error");_.customData=p,a(_)},h.type="text/javascript",h.charset="UTF-8",function xr(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(h)})}function Ra(c){return`__${c}${Math.floor(1e6*Math.random())}`}const kr=1e12;class Zs{constructor(o){this.auth=o,this.counter=kr,this._widgets=new Map}render(o,a){const h=this.counter;return this._widgets.set(h,new xc(o,this.auth.name,a||{})),this.counter++,h}reset(o){var a;const h=o||kr;null===(a=this._widgets.get(h))||void 0===a||a.delete(),this._widgets.delete(h)}getResponse(o){var a;return(null===(a=this._widgets.get(o||kr))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var h;return null===(h=a._widgets.get(o||kr))||void 0===h||h.execute(),""})()}}class xc{constructor(o,a,h){this.params=h,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;N(p,"argument-error",{appName:a}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function kc(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let h=0;h<c;h++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(h){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(h){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const en=Ra("rcb"),Ac=new Gi(3e4,6e4);class Sc{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=_e().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return N(function Dc(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(_e().grecaptcha):new Promise((h,p)=>{const _=_e().setTimeout(()=>{p(ue(o,"network-request-failed"))},Ac.get());_e()[en]=()=>{_e().clearTimeout(_),delete _e()[en];const T=_e().grecaptcha;if(!T)return void p(ue(o,"internal-error"));const A=T.render;T.render=(L,$)=>{const z=A(L,$);return this.counter++,z},this.hostLanguage=a,h(T)},Da(`https://www.google.com/recaptcha/api.js??${(0,D.xO)({onload:en,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(_),p(ue(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=_e().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Gs{load(o){return(0,I.Z)(function*(){return new Zs(o)})()}clearedOneInstance(){}}const it="recaptcha",Rc={theme:"light",type:"image"};class Nc{constructor(o,a=Object.assign({},Rc),h){this.parameters=a,this.type=it,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=se(h),this.isInvisible="invisible"===this.parameters.size,N("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;N(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Gs:new Sc,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),h=o.getAssertedRecaptcha();return h.getResponse(a)||new Promise(_=>{const v=T=>{!T||(o.tokenChangeListeners.delete(v),_(T))};o.tokenChangeListeners.add(v),o.isInvisible&&h.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){N(!this.parameters.sitekey,this.auth,"argument-error"),N(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),N("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(h=>h(a)),"function"==typeof o)o(a);else if("string"==typeof o){const h=_e()[o];"function"==typeof h&&h(a)}}}assertNotDestroyed(){N(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const h=document.createElement("div");a.appendChild(h),a=h}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){N(Lo()&&!Ls(),o.auth,"internal-error"),yield function yi(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function Ah(c){return Bs.apply(this,arguments)}(o.auth);N(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return N(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ma{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Kt._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Ar(){return(Ar=(0,I.Z)(function*(c,o,a){const h=se(c),p=yield Bn(h,o,(0,D.m9)(a));return new Ma(p,_=>ur(h,_))})).apply(this,arguments)}function Pa(){return(Pa=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c);yield Fn(!1,h,"phone");const p=yield Bn(h.auth,o,(0,D.m9)(a));return new Ma(p,_=>la(h,_))})).apply(this,arguments)}function La(){return(La=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c),p=yield Bn(h.auth,o,(0,D.m9)(a));return new Ma(p,_=>sc(h,_))})).apply(this,arguments)}function Bn(c,o,a){return Fa.apply(this,arguments)}function Fa(){return(Fa=(0,I.Z)(function*(c,o,a){var h;const p=yield a.verify();try{let _;if(N("string"==typeof p,c,"argument-error"),N(a.type===it,c,"argument-error"),_="string"==typeof o?{phoneNumber:o}:o,"session"in _){const v=_.session;if("phoneNumber"in _)return N("enroll"===v.type,c,"internal-error"),(yield pc(c,{idToken:v.credential,phoneEnrollmentInfo:{phoneNumber:_.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{N("signin"===v.type,c,"internal-error");const T=(null===(h=_.multiFactorHint)||void 0===h?void 0:h.uid)||_.multiFactorUid;return N(T,c,"missing-multi-factor-info"),(yield Tc(c,{mfaPendingCredential:v.credential,mfaEnrollmentId:T,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:v}=yield ir(c,{phoneNumber:_.phoneNumber,recaptchaToken:p});return v}}finally{a._reset()}})).apply(this,arguments)}function Ce(){return(Ce=(0,I.Z)(function*(c,o){yield Es((0,D.m9)(c),o)})).apply(this,arguments)}let Nt=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=se(a)}verifyPhoneNumber(a,h){return Bn(this.auth,a,(0,D.m9)(h))}static credential(a,h){return Kt._fromVerification(a,h)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:h,temporaryProof:p}=a;return h&&p?Kt._fromTokenResponse(h,p):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function rt(c,o){return o?Y(o):(N(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class Cr extends Nn{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return St(o,this._buildIdpRequest())}_linkToIdToken(o,a){return St(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return St(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Dh(c){return rc(c.auth,new Cr(c),c.bypassAuthState)}function R(c){const{auth:o,user:a}=c;return N(a,o,"internal-error"),Ts(a,new Cr(c),c.bypassAuthState)}function xe(c){return tn.apply(this,arguments)}function tn(){return(tn=(0,I.Z)(function*(c){const{auth:o,user:a}=c;return N(a,o,"internal-error"),Es(a,new Cr(c),c.bypassAuthState)})).apply(this,arguments)}class zs{constructor(o,a,h,p,_=!1){this.auth=o,this.resolver=h,this.user=p,this.bypassAuthState=_,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,I.Z)(function*(h,p){o.pendingPromise={resolve:h,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(_){o.reject(_)}});return function(h,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:h,sessionId:p,postBody:_,tenantId:v,error:T,type:A}=o;if(T)return void a.reject(T);const L={auth:a.auth,requestUri:h,sessionId:p,tenantId:v||void 0,postBody:_||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(A)(L))}catch($){a.reject($)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Dh;case"linkViaPopup":case"linkViaRedirect":return xe;case"reauthViaPopup":case"reauthViaRedirect":return R;default:Ae(this.auth,"internal-error")}}resolve(o){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){tt(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const U=new Gi(2e3,1e4);function Ua(){return(Ua=(0,I.Z)(function*(c,o,a){const h=se(c);_t(c,o,Ht);const p=rt(h,a);return new $s(h,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function E(){return(E=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c);_t(h.auth,o,Ht);const p=rt(h.auth,a);return new $s(h.auth,"reauthViaPopup",o,p,h).executeNotNull()})).apply(this,arguments)}function ke(){return(ke=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c);_t(h.auth,o,Ht);const p=rt(h.auth,a);return new $s(h.auth,"linkViaPopup",o,p,h).executeNotNull()})).apply(this,arguments)}let $s=(()=>{class c extends zs{constructor(a,h,p,_,v){super(a,h,_,v),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const h=yield a.execute();return N(h,a.auth,"internal-error"),h})()}onExecution(){var a=this;return(0,I.Z)(function*(){tt(1===a.filter.length,"Popup operations only handle one event");const h=gn();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],h),a.authWindow.associatedEvent=h,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(ue(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(ue(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var h,p;this.pollId=(null===(p=null===(h=this.authWindow)||void 0===h?void 0:h.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(ue(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,U.get())};a()}}return c.currentPopupAction=null,c})();const Sr=new Map;class Nh extends zs{constructor(o,a,h=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,h),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let h=Sr.get(a.auth._key());if(!h){try{const _=(yield function Oh(c,o){return Va.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;h=()=>Promise.resolve(_)}catch(p){h=()=>Promise.reject(p)}Sr.set(a.auth._key(),h)}return a.bypassAuthState||Sr.set(a.auth._key(),()=>Promise.resolve(null)),h()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,h=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(h,o);if("unknown"!==o.type){if(o.eventId){const p=yield h.auth._redirectUserForId(o.eventId);if(p)return h.user=p,a().call(h,o);h.resolve(null)}}else h.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function Va(){return(Va=(0,I.Z)(function*(c,o){const a=W(o),h=Za(c);if(!(yield h._isAvailable()))return!1;const p="true"===(yield h._get(a));return yield h._remove(a),p})).apply(this,arguments)}function js(c,o){return qa.apply(this,arguments)}function qa(){return(qa=(0,I.Z)(function*(c,o){return Za(c)._set(W(o),"true")})).apply(this,arguments)}function Ba(c,o){Sr.set(c._key(),o)}function Za(c){return Y(c._redirectPersistence)}function W(c){return Rn("pendingRedirect",c.config.apiKey,c.name)}function le(){return(le=(0,I.Z)(function*(c,o,a){const h=se(c);_t(c,o,Ht);const p=rt(h,a);return yield js(p,h),p._openRedirect(h,o,"signInViaRedirect")})).apply(this,arguments)}function ee(){return(ee=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c);_t(h.auth,o,Ht);const p=rt(h.auth,a);yield js(p,h.auth);const _=yield Nr(h);return p._openRedirect(h.auth,o,"reauthViaRedirect",_)})).apply(this,arguments)}function O(){return(O=(0,I.Z)(function*(c,o,a){const h=(0,D.m9)(c);_t(h.auth,o,Ht);const p=rt(h.auth,a);yield Fn(!1,h,o.providerId),yield js(p,h.auth);const _=yield Nr(h);return p._openRedirect(h.auth,o,"linkViaRedirect",_)})).apply(this,arguments)}function Rr(){return(Rr=(0,I.Z)(function*(c,o){return yield se(c)._initializationPromise,Ot(c,o,!1)})).apply(this,arguments)}function Ot(c,o){return Ga.apply(this,arguments)}function Ga(){return(Ga=(0,I.Z)(function*(c,o,a=!1){const h=se(c),p=rt(h,o),v=yield new Nh(h,p,a).execute();return v&&!a&&(delete v.user._redirectEventId,yield h._persistUserIfCurrent(v.user),yield h._setRedirectUser(null,o)),v})).apply(this,arguments)}function Nr(c){return za.apply(this,arguments)}function za(){return(za=(0,I.Z)(function*(c){const o=gn(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class $a{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(h=>{this.isEventForConsumer(o,h)&&(a=!0,this.sendToConsumer(o,h),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Wa(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return st(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var h;if(o.error&&!st(o)){const p=(null===(h=o.error.code)||void 0===h?void 0:h.split("auth/")[1])||"internal-error";a.onError(ue(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const h=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&h}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(ja(o))}saveEventToCache(o){this.cachedEventUids.add(ja(o)),this.lastProcessedEventTime=Date.now()}}function ja(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function st({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Ka(c){return Ks.apply(this,arguments)}function Ks(){return(Ks=(0,I.Z)(function*(c,o={}){return Le(c,"GET","/v1/projects",o)})).apply(this,arguments)}const _n=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Ha=/^https?/;function Ii(){return(Ii=(0,I.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Ka(c);for(const a of o)try{if(Et(a))return}catch(h){}Ae(c,"unauthorized-domain")})).apply(this,arguments)}function Et(c){const o=Dn(),{protocol:a,hostname:h}=new URL(o);if(c.startsWith("chrome-extension://")){const v=new URL(c);return""===v.hostname&&""===h?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&v.hostname===h}if(!Ha.test(a))return!1;if(_n.test(c))return h===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(h)}const Ph=new Gi(3e4,6e4);function wi(){const c=_e().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let Hs=null;function Zn(c){return Hs=Hs||function yn(c){return new Promise((o,a)=>{var h,p,_;function v(){wi(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{wi(),a(ue(c,"network-request-failed"))},timeout:Ph.get()})}if(null===(p=null===(h=_e().gapi)||void 0===h?void 0:h.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(_=_e().gapi)||void 0===_?void 0:_.load)){const T=Ra("iframefcb");return _e()[T]=()=>{gapi.load?v():a(ue(c,"network-request-failed"))},Da(`https://apis.google.com/js/api.js?onload=${T}`).catch(A=>a(A))}v()}}).catch(o=>{throw Hs=null,o})}(c),Hs}const Lc=new Gi(5e3,15e3),Fh={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ct=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Uh(c){const o=c.config;N(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Fo(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,h={apiKey:o.apiKey,appName:c.name,v:qt.SDK_VERSION},p=ct.get(c.config.apiHost);p&&(h.eid=p);const _=c._getFrameworks();return _.length&&(h.fw=_.join(",")),`${a}?${(0,D.xO)(h).slice(1)}`}function Qs(){return Qs=(0,I.Z)(function*(c){const o=yield Zn(c),a=_e().gapi;return N(a,c,"internal-error"),o.open({where:document.body,url:Uh(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Fh,dontclear:!0},h=>new Promise(function(){var p=(0,I.Z)(function*(_,v){yield h.restyle({setHideOnLeave:!1});const T=ue(c,"network-request-failed"),A=_e().setTimeout(()=>{v(T)},Lc.get());function L(){_e().clearTimeout(A),_(h)}h.ping(L).then(L,()=>{v(T)})});return function(_,v){return p.apply(this,arguments)}}()))}),Qs.apply(this,arguments)}const Gn={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Vc{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function nn(c,o,a,h,p,_){N(c.config.authDomain,c,"auth-domain-config-required"),N(c.config.apiKey,c,"invalid-api-key");const v={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:h,v:qt.SDK_VERSION,eventId:p};if(o instanceof Ht){o.setDefaultLanguage(c.languageCode),v.providerId=o.providerId||"",(0,D.xb)(o.getCustomParameters())||(v.customParameters=JSON.stringify(o.getCustomParameters()));for(const[A,L]of Object.entries(_||{}))v[A]=L}if(o instanceof Pn){const A=o.getScopes().filter(L=>""!==L);A.length>0&&(v.scopes=A.join(","))}c.tenantId&&(v.tid=c.tenantId);const T=v;for(const A of Object.keys(T))void 0===T[A]&&delete T[A];return`${function Ya({config:c}){return c.emulator?Fo(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,D.xO)(T).slice(1)}`}const Ys="webStorageSupport";class sn extends class Js{constructor(o){this.factorId=o}_process(o,a,h){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,h);case"signin":return this._finalizeSignIn(o,a.credential);default:return He("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new sn(o)}_finalizeEnroll(o,a,h){return function mc(c,o){return Le(c,"POST","/v2/accounts/mfaEnrollment:finalize",pe(c,o))}(o,{idToken:a,displayName:h,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function qs(c,o){return Le(c,"POST","/v2/accounts/mfaSignIn:finalize",pe(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let Mt=(()=>{class c{constructor(){}static assertion(a){return sn._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var bi="@firebase/auth";class qc{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(h=>{o((null==h?void 0:h.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){N(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Pt(){return window}function eu(){return(eu=(0,I.Z)(function*(c,o,a){var h;const{BuildInfo:p}=Pt();tt(o.sessionId,"AuthEvent did not contain a session ID");const _=yield $c(o.sessionId),v={};return j()?v.ibi=p.packageName:ut()?v.apn=p.packageName:Ae(c,"operation-not-supported-in-this-environment"),p.displayName&&(v.appDisplayName=p.displayName),v.sessionId=_,nn(c,a,o.type,void 0,null!==(h=o.eventId)&&void 0!==h?h:void 0,v)})).apply(this,arguments)}function Xs(){return(Xs=(0,I.Z)(function*(c){const{BuildInfo:o}=Pt(),a={};j()?a.iosBundleId=o.packageName:ut()?a.androidPackageName=o.packageName:Ae(c,"operation-not-supported-in-this-environment"),yield Ka(c,a)})).apply(this,arguments)}function eo(){return(eo=(0,I.Z)(function*(c,o,a){const{cordova:h}=Pt();let p=()=>{};try{yield new Promise((_,v)=>{let T=null;function A(){var z;_();const Ne=null===(z=h.plugins.browsertab)||void 0===z?void 0:z.close;"function"==typeof Ne&&Ne(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function L(){T||(T=window.setTimeout(()=>{v(ue(c,"redirect-cancelled-by-user"))},2e3))}function $(){"visible"===(null==document?void 0:document.visibilityState)&&L()}o.addPassiveListener(A),document.addEventListener("resume",L,!1),ut()&&document.addEventListener("visibilitychange",$,!1),p=()=>{o.removePassiveListener(A),document.removeEventListener("resume",L,!1),document.removeEventListener("visibilitychange",$,!1),T&&window.clearTimeout(T)}})}finally{p()}})).apply(this,arguments)}function $c(c){return J.apply(this,arguments)}function J(){return(J=(0,I.Z)(function*(c){const o=ce(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function ce(c){if(tt(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let h=0;h<c.length;h++)a[h]=c.charCodeAt(h);return a}(0,D.Pz)("authIdTokenMaxAge"),function Ja(c){(0,qt._registerComponent)(new Pe.wA("auth",(o,{options:a})=>{const h=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:_,authDomain:v}=h.options;return((T,A)=>{N(_&&!_.includes(":"),"invalid-api-key",{appName:T.name}),N(!(null==v?void 0:v.includes(":")),"argument-error",{appName:T.name});const L={apiKey:_,authDomain:v,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Ju(c)},$=new hh(T,A,L);return function rs(c,o){const a=(null==o?void 0:o.persistence)||[],h=(Array.isArray(a)?a:[a]).map(Y);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(h,null==o?void 0:o.popupRedirectResolver)}($,a),$})(h,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,h)=>{o.getProvider("auth-internal").initialize()})),(0,qt._registerComponent)(new Pe.wA("auth-internal",o=>{const a=se(o.getProvider("auth").getImmediate());return new qc(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,qt.registerVersion)(bi,"0.21.0",function Ei(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,qt.registerVersion)(bi,"0.21.0","esm2017")}("Browser");class tu extends $a{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function nu(c){return to.apply(this,arguments)}function to(){return(to=(0,I.Z)(function*(c){const o=yield iu()._get(ru(c));return o&&(yield iu()._remove(ru(c))),o})).apply(this,arguments)}function Hc(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const h=Math.floor(Math.random()*o.length);c.push(o.charAt(h))}return c.join("")}function iu(){return Y(Ir)}function ru(c){return Rn("authEvent",c.config.apiKey,c.name)}function no(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,D.zd)(a.join("?"))}function $n(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:ue("no-auth-event")}}function oe(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function jn(c=(0,D.z$)()){return!("file:"!==oe()&&"ionic:"!==oe()&&"capacitor:"!==oe()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function el(){try{const c=self.localStorage,o=gn();if(c)return c.setItem(o,"1"),c.removeItem(o),!function de(c=(0,D.z$)()){return function Ze(){return(0,D.w1)()&&11===(null==document?void 0:document.documentMode)}()||function Xc(c=(0,D.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,D.hl)()}catch(c){return Ur()&&(0,D.hl)()}return!1}function Ur(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function an(){return(function Jc(){return"http:"===oe()||"https:"===oe()}()||(0,D.ru)()||jn())&&!function lt(){return(0,D.b$)()||(0,D.UG)()}()&&el()&&!Ur()}function ki(){return jn()&&"undefined"!=typeof document}function Ai(){return(Ai=(0,I.Z)(function*(){return!!ki()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const ot={LOCAL:"local",NONE:"none",SESSION:"session"},ht=N,su="persistence";function so(c){return Vr.apply(this,arguments)}function Vr(){return(Vr=(0,I.Z)(function*(c){yield c._initializationPromise;const o=ao(),a=Rn(su,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function ao(){var c;try{return(null===(c=function tl(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const Wn=N;class be{constructor(){this.browserResolver=Y(class Lr{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=mn,this._completeRedirectFn=Ot,this._overrideRedirectResult=Ba}_openPopup(o,a,h,p){var _=this;return(0,I.Z)(function*(){var v;tt(null===(v=_.eventManagers[o._key()])||void 0===v?void 0:v.manager,"_initialize() not called before _openPopup()");const T=nn(o,a,h,Dn(),p);return function Re(c,o,a,h=500,p=600){const _=Math.max((window.screen.availHeight-p)/2,0).toString(),v=Math.max((window.screen.availWidth-h)/2,0).toString();let T="";const A=Object.assign(Object.assign({},Gn),{width:h.toString(),height:p.toString(),top:_,left:v}),L=(0,D.z$)().toLowerCase();a&&(T=re(L)?"_blank":a),Hi(L)&&(o=o||"http://localhost",A.scrollbars="yes");const $=Object.entries(A).reduce((Ne,[Je,po])=>`${Ne}${Je}=${po},`,"");if(function hs(c=(0,D.z$)()){var o;return j(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(L)&&"_self"!==T)return function Vh(c,o){const a=document.createElement("a");a.href=c,a.target=o;const h=document.createEvent("MouseEvent");h.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(h)}(o||"",T),new Vc(null);const z=window.open(o||"",T,$);N(z,c,"popup-blocked");try{z.focus()}catch(Ne){}return new Vc(z)}(o,T,gn())})()}_openRedirect(o,a,h,p){var _=this;return(0,I.Z)(function*(){return yield _._originValidation(o),function Aa(c){_e().location.href=c}(nn(o,a,h,Dn(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:_}=this.eventManagers[a];return p?Promise.resolve(p):(tt(_,"If manager is not set, promise should be"),_)}const h=this.initAndGetManager(o);return this.eventManagers[a]={promise:h},h.catch(()=>{delete this.eventManagers[a]}),h}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const h=yield function vn(c){return Qs.apply(this,arguments)}(o),p=new $a(o);return h.register("authEvent",_=>(N(null==_?void 0:_.authEvent,o,"invalid-auth-event"),{status:p.onEvent(_.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=h,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Ys,{type:Ys},p=>{var _;const v=null===(_=null==p?void 0:p[0])||void 0===_?void 0:_[Ys];void 0!==v&&a(!!v),Ae(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function b(c){return Ii.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Yu()||At()||j()}}),this.cordovaResolver=Y(class Gh{constructor(){this._redirectPersistence=mn,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Ot,this._overrideRedirectResult=Ba}_initialize(o){var a=this;return(0,I.Z)(function*(){const h=o._key();let p=a.eventManagers.get(h);return p||(p=new tu(o),a.eventManagers.set(h,p),a.attachCallbackListeners(o,p)),p})()}_openPopup(o){Ae(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,h,p){var _=this;return(0,I.Z)(function*(){!function zc(c){var o,a,h,p,_,v,T,A,L,$;const z=Pt();N("function"==typeof(null===(o=null==z?void 0:z.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),N(void 0!==(null===(a=null==z?void 0:z.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),N("function"==typeof(null===(_=null===(p=null===(h=null==z?void 0:z.cordova)||void 0===h?void 0:h.plugins)||void 0===p?void 0:p.browsertab)||void 0===_?void 0:_.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),N("function"==typeof(null===(A=null===(T=null===(v=null==z?void 0:z.cordova)||void 0===v?void 0:v.plugins)||void 0===T?void 0:T.browsertab)||void 0===A?void 0:A.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),N("function"==typeof(null===($=null===(L=null==z?void 0:z.cordova)||void 0===L?void 0:L.InAppBrowser)||void 0===$?void 0:$.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const v=yield _._initialize(o);yield v.initialized(),v.resetRedirect(),function bp(){Sr.clear()}(),yield _._originValidation(o);const T=function jc(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:Hc(),postBody:null,tenantId:c.tenantId,error:ue(c,"no-auth-event")}}(o,h,p);yield function Wc(c,o){return iu()._set(ru(c),o)}(o,T);const A=yield function Zc(c,o,a){return eu.apply(this,arguments)}(o,T,a),L=yield function Gc(c){const{cordova:o}=Pt();return new Promise(a=>{o.plugins.browsertab.isAvailable(h=>{let p=null;h?o.plugins.browsertab.openUrl(c):p=o.InAppBrowser.open(c,function ls(c=(0,D.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(p)})})}(A);return function wn(c,o,a){return eo.apply(this,arguments)}(o,v,L)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Bh(c){return Xs.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:h,handleOpenURL:p,BuildInfo:_}=Pt(),v=setTimeout((0,I.Z)(function*(){yield nu(o),a.onEvent($n())}),500),T=function(){var $=(0,I.Z)(function*(z){clearTimeout(v);const Ne=yield nu(o);let Je=null;Ne&&(null==z?void 0:z.url)&&(Je=function Kc(c,o){var a,h;const p=function Qc(c){const o=no(c),a=o.link?decodeURIComponent(o.link):void 0,h=no(a).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return no(p).link||p||h||a||c}(o);if(p.includes("/__/auth/callback")){const _=no(p),v=_.firebaseError?function Zh(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(_.firebaseError)):null,T=null===(h=null===(a=null==v?void 0:v.code)||void 0===a?void 0:a.split("auth/"))||void 0===h?void 0:h[1],A=T?ue(T):null;return A?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:A,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:p,postBody:null}}return null}(Ne,z.url)),a.onEvent(Je||$n())});return function(Ne){return $.apply(this,arguments)}}();void 0!==h&&"function"==typeof h.subscribe&&h.subscribe(null,T);const A=p,L=`${_.packageName.toLowerCase()}://`;Pt().handleOpenURL=function(){var $=(0,I.Z)(function*(z){if(z.toLowerCase().startsWith(L)&&T({url:z}),"function"==typeof A)try{A(z)}catch(Ne){console.error(Ne)}});return function(z){return $.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=mn,this._completeRedirectFn=Ot,this._overrideRedirectResult=Ba}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,h,p){var _=this;return(0,I.Z)(function*(){return yield _.selectUnderlyingResolver(),_.assertedUnderlyingResolver._openPopup(o,a,h,p)})()}_openRedirect(o,a,h,p){var _=this;return(0,I.Z)(function*(){return yield _.selectUnderlyingResolver(),_.assertedUnderlyingResolver._openRedirect(o,a,h,p)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return ki()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return Wn(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function ro(){return Ai.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function uo(c){return c.unwrap()}function qr(c){return lo(c)}function lo(c){const{_tokenResponse:o}=c instanceof D.ZR?c.customData:c;if(!o)return null;if(!(c instanceof D.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return Nt.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let h;switch(a){case"google.com":h=ra;break;case"facebook.com":h=Is;break;case"github.com":h=tc;break;case"twitter.com":h=Ue;break;default:const{oauthIdToken:p,oauthAccessToken:_,oauthTokenSecret:v,pendingToken:T,nonce:A}=o;return _||v||p||T?T?a.startsWith("saml.")?fn._create(a,T):Dt._fromParams({providerId:a,signInMethod:a,pendingToken:T,idToken:p,accessToken:_}):new Ln(a).credential({idToken:p,accessToken:_,rawNonce:A}):null}return c instanceof D.ZR?h.credentialFromError(c):h.credentialFromResult(c)}function $e(c,o){return o.catch(a=>{throw a instanceof D.ZR&&function nl(c,o){var a;const h=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new jh(c,function fc(c,o){var a;const h=(0,D.m9)(c),p=o;return N(o.customData.operationType,h,"argument-error"),N(null===(a=p.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,h,"argument-error"),Rt._fromError(h,p)}(c,o));else if(h){const p=lo(o),_=o;p&&(_.credential=p,_.tenantId=h.tenantId||void 0,_.email=h.email||void 0,_.phoneNumber=h.phoneNumber||void 0)}}(c,a),a}).then(a=>{const p=a.user;return{operationType:a.operationType,credential:qr(a),additionalUserInfo:fe(a),user:Lt.getOrCreate(p)}})}function ho(c,o){return fo.apply(this,arguments)}function fo(){return(fo=(0,I.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:h=>$e(c,a.confirm(h))}})).apply(this,arguments)}class jh{constructor(o,a){this.resolver=a,this.auth=function co(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return $e(uo(this.auth),this.resolver.resolveSignIn(o))}}class Lt{constructor(o){this._delegate=o,this.multiFactor=function gc(c){const o=(0,D.m9)(c);return Ea.has(o)||Ea.set(o,ba._fromUser(o)),Ea.get(o)}(o)}static getOrCreate(o){return Lt.USER_MAP.has(o)||Lt.USER_MAP.set(o,new Lt(o)),Lt.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return $e(a.auth,la(a._delegate,o))})()}linkWithPhoneNumber(o,a){var h=this;return(0,I.Z)(function*(){return ho(h.auth,function Sh(c,o,a){return Pa.apply(this,arguments)}(h._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return $e(a.auth,function C(c,o,a){return ke.apply(this,arguments)}(a._delegate,o,be))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield so(se(a.auth)),function Mh(c,o,a){return function ve(c,o,a){return O.apply(this,arguments)}(c,o,a)}(a._delegate,o,be)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return $e(a.auth,sc(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return ho(this.auth,function Oc(c,o,a){return La.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return $e(this.auth,function P(c,o,a){return E.apply(this,arguments)}(this._delegate,o,be))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield so(se(a.auth)),function Z(c,o,a){return function Dr(c,o,a){return ee.apply(this,arguments)}(c,o,a)}(a._delegate,o,be)})()}sendEmailVerification(o){return function uc(c,o){return Rs.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function _h(c,o){return or.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function va(c,o){return lc((0,D.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function Ih(c,o){return lc((0,D.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Mc(c,o){return Ce.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function _r(c,o){return Yt.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function vh(c,o,a){return Vn.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Lt.USER_MAP=new WeakMap;const Si=N;let ou=(()=>{class c{constructor(a,h){if(this.app=a,h.isInitialized())return this._delegate=h.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=a.options;Si(p,"invalid-api-key",{appName:a.name}),Si(p,"invalid-api-key",{appName:a.name});const _="undefined"!=typeof window?be:void 0;this._delegate=h.initialize({options:{persistence:Wh(p,a.name),popupRedirectResolver:_}}),this._delegate._updateErrorMap(zu),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Lt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,h){!function Fe(c,o,a){const h=se(c);N(h._canInitEmulator,h,"emulator-config-failed"),N(/^https?:\/\//.test(o),h,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),_=Wt(o),{host:v,port:T}=function dh(c){const o=Wt(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const h=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(h);if(p){const _=p[1];return{host:_,port:$o(h.substr(_.length+1))}}{const[_,v]=h.split(":");return{host:_,port:$o(v)}}}(o);h.config.emulator={url:`${_}//${v}${null===T?"":`:${T}`}/`},h.settings.appVerificationDisabledForTesting=!0,h.emulatorConfig=Object.freeze({host:v,port:T,protocol:_.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function jo(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,h)}applyActionCode(a){return function dr(c,o){return li.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return fa(this._delegate,a)}confirmPasswordReset(a,h){return function Ye(c,o,a){return Cs.apply(this,arguments)}(this._delegate,a,h)}createUserWithEmailAndPassword(a,h){var p=this;return(0,I.Z)(function*(){return $e(p._delegate,function pr(c,o,a){return mr.apply(this,arguments)}(p._delegate,a,h))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function ya(c,o){return Ds.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function gr(c,o){const a=Mn.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){Si(an(),a._delegate,"operation-not-supported-in-this-environment");const h=yield function Ws(c,o){return Rr.apply(this,arguments)}(a._delegate,be);return h?$e(a._delegate,Promise.resolve(h)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function $h(c,o){se(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,h,p){const{next:_,error:v,complete:T}=Br(a,h,p);return this._delegate.onAuthStateChanged(_,v,T)}onIdTokenChanged(a,h,p){const{next:_,error:v,complete:T}=Br(a,h,p);return this._delegate.onIdTokenChanged(_,v,T)}sendSignInLinkToEmail(a,h){return function ma(c,o,a){return hi.apply(this,arguments)}(this._delegate,a,h)}sendPasswordResetEmail(a,h){return function hr(c,o,a){return As.apply(this,arguments)}(this._delegate,a,h||void 0)}setPersistence(a){var h=this;return(0,I.Z)(function*(){let p;switch(function Ci(c,o){ht(Object.values(ot).includes(o),c,"invalid-persistence-type"),(0,D.b$)()?ht(o!==ot.SESSION,c,"unsupported-persistence-type"):(0,D.UG)()?ht(o===ot.NONE,c,"unsupported-persistence-type"):Ur()?ht(o===ot.NONE||o===ot.LOCAL&&(0,D.hl)(),c,"unsupported-persistence-type"):ht(o===ot.NONE||el(),c,"unsupported-persistence-type")}(h._delegate,a),a){case ot.SESSION:p=mn;break;case ot.LOCAL:p=(yield Y(Xt)._isAvailable())?Xt:Ir;break;case ot.NONE:p=Ki;break;default:return Ae("argument-error",{appName:h._delegate.name})}return h._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return $e(this._delegate,function ic(c){return aa.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return $e(this._delegate,ur(this._delegate,a))}signInWithCustomToken(a){return $e(this._delegate,function yh(c,o){return Qt.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,h){return $e(this._delegate,function pa(c,o,a){return ur((0,D.m9)(c),vs.credential(o,a))}(this._delegate,a,h))}signInWithEmailLink(a,h){return $e(this._delegate,function ac(c,o,a){return ga.apply(this,arguments)}(this._delegate,a,h))}signInWithPhoneNumber(a,h){return ho(this._delegate,function Ch(c,o,a){return Ar.apply(this,arguments)}(this._delegate,a,h))}signInWithPopup(a){var h=this;return(0,I.Z)(function*(){return Si(an(),h._delegate,"operation-not-supported-in-this-environment"),$e(h._delegate,function B(c,o,a){return Ua.apply(this,arguments)}(h._delegate,a,be))})()}signInWithRedirect(a){var h=this;return(0,I.Z)(function*(){return Si(an(),h._delegate,"operation-not-supported-in-this-environment"),yield so(h._delegate),function vi(c,o,a){return function Pc(c,o,a){return le.apply(this,arguments)}(c,o,a)}(h._delegate,a,be)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function oc(c,o){return Ss.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=ot,c})();function Br(c,o,a){let h=c;"function"!=typeof c&&({next:h,error:o,complete:a}=c);const p=h;return{next:v=>p(v&&Lt.getOrCreate(v)),error:o,complete:a}}function Wh(c,o){const a=function oo(c,o){const a=ao();if(!a)return[];const h=Rn(su,c,o);switch(a.getItem(h)){case ot.NONE:return[Ki];case ot.LOCAL:return[Xt,mn];case ot.SESSION:return[mn];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(Xt)&&a.push(Xt),"undefined"!=typeof window)for(const h of[Ir,mn])a.includes(h)||a.push(h);return a.includes(Ki)||a.push(Ki),a}class au{constructor(){this.providerId="phone",this._delegate=new Nt(uo(Tt.Z.auth()))}static credential(o,a){return Nt.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}au.PHONE_SIGN_IN_METHOD=Nt.PHONE_SIGN_IN_METHOD,au.PROVIDER_ID=Nt.PROVIDER_ID;const il=N;class Di{constructor(o,a,h=Tt.Z.app()){var p;il(null===(p=h.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:h.name}),this._delegate=new Nc(o,a,h.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function rl(c){c.INTERNAL.registerComponent(new Pe.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),h=o.getProvider("auth");return new ou(a,h)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:vs,FacebookAuthProvider:Is,GithubAuthProvider:tc,GoogleAuthProvider:ra,OAuthProvider:Ln,SAMLAuthProvider:Te,PhoneAuthProvider:au,PhoneMultiFactorGenerator:Mt,RecaptchaVerifier:Di,TwitterAuthProvider:Ue,Auth:ou,AuthCredential:Nn,Error:D.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.3.0")}(Tt.Z)}}]);