"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[318],{2318:(Zy,Zu,L)=>{L.r(Zu),L.d(Zu,{FieldModule:()=>Jw});var I=L(9298),Et=L(1062),C=L(2705),k=L(5861);let Vo=(()=>{class n{constructor(t){this.context=t}draw(){this.drawShape()}fromDiscreteX(t){return t*(this.context.canvas.width/n.FIELD_RESOLUTION)}fromDiscreteY(t){return t*(this.context.canvas.height/n.FIELD_RESOLUTION)}toDiscreteX(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.width)),n.FIELD_RESOLUTION))}toDiscreteY(t){return Math.max(0,Math.min(Math.ceil(t*(n.FIELD_RESOLUTION/this.context.canvas.height)),n.FIELD_RESOLUTION))}}return n.FIELD_RESOLUTION=9e3,n})();class Yr extends Vo{constructor(e,t,r){super(t),this.actor=e,this.fieldPositions=r||new Map}toDto(){return{f:[...this.fieldPositions.entries()].map(([e,t])=>({x:Number(t.x.toFixed(0)).valueOf(),y:Number(t.y.toFixed(0)).valueOf(),u:e}))}}draw(){super.draw(),this.drawPosition(),this.drawActorName()}currentPosition(){return this.actor.position.rotate(this.rotationOffset)}setPosition(e,t){this.fieldPositions.set(this._rotationUUID,{x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}get x(){return this.fromDiscreteX(this.getFieldPosition().x)}get y(){return this.fromDiscreteY(this.getFieldPosition().y)}getFieldPosition(){return this.fieldPositions.get(this._rotationUUID)}setRotationProperties(e,t){const r=this._rotationUUID;if(this._rotationUUID=e,this.rotationOffset=t,0===this.fieldPositions.size)this.setPosition(this.context.canvas.width/2,this.context.canvas.height/2);else if(!this.fieldPositions.has(e)){const i=this.fieldPositions.get(r);this.setPosition(this.context.canvas.width*i.x,this.context.canvas.height*i.y)}}removeRotation(e){this.fieldPositions.delete(e)}}let fr=(()=>{class n extends Yr{constructor(t,r,i,s){super(t,r,s),this.dashed=i}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,2*Math.PI,!1),this.context.fillStyle="red",this.context.fill(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y+12)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.5*this.radius))}isHit(t,r){return t>=this.x-this.radius&&t<=this.x+this.radius&&r>=this.y-this.radius&&r<=this.y+this.radius}}return n.RELATIVE_RADIUS=.048,n.RADIUS_MAX=40,n})();var rt=(()=>{return(n=rt||(rt={})).Setter="Setter",n.MiddleBlocker="Middle blocker",n.Libero="Libero",n.OutsideHitter="Outside hitter",n.OppositeHitter="Opposite hitter",rt;var n})(),B=L(3075);class An{constructor(e){if(e<1||e>6)throw new Error("Player position must be between 1 and 6.");this._position=e}get value(){return this._position}rotate(e){let r=this._position+(e._position-1);return r>6&&(r-=6),new An(r)}}function Gu(n=5){let e="";for(;e.length<n;)e+=Math.random().toString(36).substring(2,7);return e.substring(0,n)}let Sn=(()=>{class n extends Yr{constructor(t,r,i){super(t,r,i)}get radius(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_RADIUS,n.RADIUS_MAX)}drawShape(){this.context.beginPath(),this.context.arc(this.x,this.y,this.radius,0,Math.PI,!0),this.context.fillStyle="red",this.context.fill(),this.context.setLineDash([]),this.context.closePath(),this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x,this.y-10)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+this.radius/2))}isHit(t,r){return t>=this.x-this.radius&&t<=this.x+this.radius&&r>=this.y-this.radius&&r<=this.y}}return n.RELATIVE_RADIUS=.0576,n.RADIUS_MAX=50,n})(),is=(()=>{class n extends Yr{constructor(t,r,i,s){super(t,r,s),this.dashed=i}get size(){return Math.min(Math.max(this.context.canvas.width,this.context.canvas.height)*n.RELATIVE_SIZE,n.SIZE_MAX)}drawActorName(){!this.actor.player_name||(this.context.font="20px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.actor.player_name,this.x,this.y+1.6*this.size))}drawPosition(){this.context.font="40px Roboto",this.context.fillStyle="#000000",this.context.textAlign="center",this.context.fillText(this.currentPosition().value.toString(),this.x-2,this.y+25)}drawShape(){this.context.beginPath(),this.context.lineWidth=4,this.context.strokeStyle="#003300",this.context.setLineDash(this.dashed?[6]:[]),this.context.moveTo(this.x-this.size,this.y+this.size),this.context.lineTo(this.x+this.size,this.y+this.size),this.context.lineTo(this.x,this.y-this.size),this.context.closePath(),this.context.stroke(),this.context.fillStyle="red",this.context.fill()}isHit(t,r){return t>=this.x-this.size&&t<=this.x+this.size&&r>=this.y-this.size&&r<=this.y+this.size}}return n.RELATIVE_SIZE=.04,n.SIZE_MAX=40,n})();class Jr{constructor(e,t,r,i,s){this.position=e,this.player_role=t,this.player_name=r,this._UUID=i||Gu(),s&&(this._shape=s)}get UUID(){return this._UUID}get shape(){return this._shape}static fromDto(e,t){const r=new Jr(new An(e.p),e.pr,"NULL"===e.pn?void 0:e.pn,e.u),i=class $u{static fromActorDto(e,t,r){const i=new Map(t.f.map(s=>[s.u,{x:s.x,y:s.y}]));switch(e.player_role){case rt.Setter:return new Sn(e,r,i);case rt.MiddleBlocker:case rt.Libero:return new is(e,r,!1,i);case rt.OutsideHitter:return new fr(e,r,!1,i);case rt.OppositeHitter:return new fr(e,r,!0,i)}}}.fromActorDto(r,e.s,t);return r.setShape(i),r}toDto(){var e;return{pn:null!==(e=this.player_name)&&void 0!==e?e:"NULL",pr:this.player_role,p:this.position.value,u:this.UUID,s:this.shape.toDto()}}setShape(e){this._shape=e}draw(){this.shape.draw()}toString(){return this.player_name?`${this.player_name} (${this.position.value}) - ${this.player_role.toString()}`:`Unnamed actor (${this.position.value}) - ${this.player_role.toString()}`}}var d=L(5e3),pr=L(9776),mr=L(7429),Ae=L(508),gr=L(226),oe=L(7579),Ue=L(9770),tn=L(9646),Pe=L(9300),Cn=L(5698),R=L(8675),it=L(925),Ie=L(9808),ce=L(1777),Se=L(8255),ss=L(1159),qo=L(6360);function Xr(n,e){}class ei{constructor(){this.role="dialog",this.panelClass="",this.hasBackdrop=!0,this.backdropClass="",this.disableClose=!1,this.width="",this.height="",this.maxWidth="80vw",this.data=null,this.ariaDescribedBy=null,this.ariaLabelledBy=null,this.ariaLabel=null,this.autoFocus="first-tabbable",this.restoreFocus=!0,this.delayFocusTrap=!0,this.closeOnNavigation=!0}}const ju={dialogContainer:(0,ce.X$)("dialogContainer",[(0,ce.SB)("void, exit",(0,ce.oB)({opacity:0,transform:"scale(0.7)"})),(0,ce.SB)("enter",(0,ce.oB)({transform:"none"})),(0,ce.eR)("* => enter",(0,ce.ru)([(0,ce.jt)("150ms cubic-bezier(0, 0, 0.2, 1)",(0,ce.oB)({transform:"none",opacity:1})),(0,ce.IO)("@*",(0,ce.pV)(),{optional:!0})])),(0,ce.eR)("* => void, * => exit",(0,ce.ru)([(0,ce.jt)("75ms cubic-bezier(0.4, 0.0, 0.2, 1)",(0,ce.oB)({opacity:0})),(0,ce.IO)("@*",(0,ce.pV)(),{optional:!0})]))])};let th=(()=>{class n extends mr.en{constructor(t,r,i,s,u,h,f,m){super(),this._elementRef=t,this._focusTrapFactory=r,this._changeDetectorRef=i,this._config=u,this._interactivityChecker=h,this._ngZone=f,this._focusMonitor=m,this._animationStateChanged=new d.vpe,this._elementFocusedBeforeDialogWasOpened=null,this._closeInteractionType=null,this.attachDomPortal=g=>(this._portalOutlet.hasAttached(),this._portalOutlet.attachDomPortal(g)),this._ariaLabelledBy=u.ariaLabelledBy||null,this._document=s}_initializeWithAttachedContent(){this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._document&&(this._elementFocusedBeforeDialogWasOpened=(0,it.ht)())}attachComponentPortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachComponentPortal(t)}attachTemplatePortal(t){return this._portalOutlet.hasAttached(),this._portalOutlet.attachTemplatePortal(t)}_recaptureFocus(){this._containsFocus()||this._trapFocus()}_forceFocus(t,r){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const i=()=>{t.removeEventListener("blur",i),t.removeEventListener("mousedown",i),t.removeAttribute("tabindex")};t.addEventListener("blur",i),t.addEventListener("mousedown",i)})),t.focus(r)}_focusByCssSelector(t,r){let i=this._elementRef.nativeElement.querySelector(t);i&&this._forceFocus(i,r)}_trapFocus(){const t=this._elementRef.nativeElement;switch(this._config.autoFocus){case!1:case"dialog":this._containsFocus()||t.focus();break;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(r=>{r||this._focusDialogContainer()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this._config.autoFocus)}}_restoreFocus(){const t=this._elementFocusedBeforeDialogWasOpened;if(this._config.restoreFocus&&t&&"function"==typeof t.focus){const r=(0,it.ht)(),i=this._elementRef.nativeElement;(!r||r===this._document.body||r===i||i.contains(r))&&(this._focusMonitor?(this._focusMonitor.focusVia(t,this._closeInteractionType),this._closeInteractionType=null):t.focus())}this._focusTrap&&this._focusTrap.destroy()}_focusDialogContainer(){this._elementRef.nativeElement.focus&&this._elementRef.nativeElement.focus()}_containsFocus(){const t=this._elementRef.nativeElement,r=(0,it.ht)();return t===r||t.contains(r)}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(d.SBq),d.Y36(Se.qV),d.Y36(d.sBO),d.Y36(Ie.K0,8),d.Y36(ei),d.Y36(Se.ic),d.Y36(d.R0b),d.Y36(Se.tE))},n.\u0275dir=d.lG2({type:n,viewQuery:function(t,r){if(1&t&&d.Gf(mr.Pl,7),2&t){let i;d.iGM(i=d.CRH())&&(r._portalOutlet=i.first)}},features:[d.qOj]}),n})(),ti=(()=>{class n extends th{constructor(){super(...arguments),this._state="enter"}_onAnimationDone({toState:t,totalTime:r}){"enter"===t?(this._config.delayFocusTrap&&this._trapFocus(),this._animationStateChanged.next({state:"opened",totalTime:r})):"exit"===t&&(this._restoreFocus(),this._animationStateChanged.next({state:"closed",totalTime:r}))}_onAnimationStart({toState:t,totalTime:r}){"enter"===t?this._animationStateChanged.next({state:"opening",totalTime:r}):("exit"===t||"void"===t)&&this._animationStateChanged.next({state:"closing",totalTime:r})}_startExitAnimation(){this._state="exit",this._changeDetectorRef.markForCheck()}_initializeWithAttachedContent(){super._initializeWithAttachedContent(),this._config.delayFocusTrap||this._trapFocus()}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=d.n5z(n)))(r||n)}}(),n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-dialog-container"]],hostAttrs:["tabindex","-1","aria-modal","true",1,"mat-dialog-container"],hostVars:6,hostBindings:function(t,r){1&t&&d.WFA("@dialogContainer.start",function(s){return r._onAnimationStart(s)})("@dialogContainer.done",function(s){return r._onAnimationDone(s)}),2&t&&(d.Ikx("id",r._id),d.uIk("role",r._config.role)("aria-labelledby",r._config.ariaLabel?null:r._ariaLabelledBy)("aria-label",r._config.ariaLabel)("aria-describedby",r._config.ariaDescribedBy||null),d.d8E("@dialogContainer",r._state))},features:[d.qOj],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(t,r){1&t&&d.YNc(0,Xr,0,0,"ng-template",0)},directives:[mr.Pl],styles:[".mat-dialog-container{display:block;padding:24px;border-radius:4px;box-sizing:border-box;overflow:auto;outline:0;width:100%;height:100%;min-height:inherit;max-height:inherit}.cdk-high-contrast-active .mat-dialog-container{outline:solid 1px}.mat-dialog-content{display:block;margin:0 -24px;padding:0 24px;max-height:65vh;overflow:auto;-webkit-overflow-scrolling:touch}.mat-dialog-title{margin:0 0 20px;display:block}.mat-dialog-actions{padding:8px 0;display:flex;flex-wrap:wrap;min-height:52px;align-items:center;box-sizing:content-box;margin-bottom:-24px}.mat-dialog-actions[align=end]{justify-content:flex-end}.mat-dialog-actions[align=center]{justify-content:center}.mat-dialog-actions .mat-button-base+.mat-button-base,.mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:8px}[dir=rtl] .mat-dialog-actions .mat-button-base+.mat-button-base,[dir=rtl] .mat-dialog-actions .mat-mdc-button-base+.mat-mdc-button-base{margin-left:0;margin-right:8px}\n"],encapsulation:2,data:{animation:[ju.dialogContainer]}}),n})(),Bo=0;class Vt{constructor(e,t,r="mat-dialog-"+Bo++){this._overlayRef=e,this._containerInstance=t,this.id=r,this.disableClose=this._containerInstance._config.disableClose,this._afterOpened=new oe.x,this._afterClosed=new oe.x,this._beforeClosed=new oe.x,this._state=0,t._id=r,t._animationStateChanged.pipe((0,Pe.h)(i=>"opened"===i.state),(0,Cn.q)(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),t._animationStateChanged.pipe((0,Pe.h)(i=>"closed"===i.state),(0,Cn.q)(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._finishDialogClose()}),e.detachments().subscribe(()=>{this._beforeClosed.next(this._result),this._beforeClosed.complete(),this._afterClosed.next(this._result),this._afterClosed.complete(),this.componentInstance=null,this._overlayRef.dispose()}),e.keydownEvents().pipe((0,Pe.h)(i=>i.keyCode===ss.hY&&!this.disableClose&&!(0,ss.Vb)(i))).subscribe(i=>{i.preventDefault(),zu(this,"keyboard")}),e.backdropClick().subscribe(()=>{this.disableClose?this._containerInstance._recaptureFocus():zu(this,"mouse")})}close(e){this._result=e,this._containerInstance._animationStateChanged.pipe((0,Pe.h)(t=>"closing"===t.state),(0,Cn.q)(1)).subscribe(t=>{this._beforeClosed.next(e),this._beforeClosed.complete(),this._overlayRef.detachBackdrop(),this._closeFallbackTimeout=setTimeout(()=>this._finishDialogClose(),t.totalTime+100)}),this._state=1,this._containerInstance._startExitAnimation()}afterOpened(){return this._afterOpened}afterClosed(){return this._afterClosed}beforeClosed(){return this._beforeClosed}backdropClick(){return this._overlayRef.backdropClick()}keydownEvents(){return this._overlayRef.keydownEvents()}updatePosition(e){let t=this._getPositionStrategy();return e&&(e.left||e.right)?e.left?t.left(e.left):t.right(e.right):t.centerHorizontally(),e&&(e.top||e.bottom)?e.top?t.top(e.top):t.bottom(e.bottom):t.centerVertically(),this._overlayRef.updatePosition(),this}updateSize(e="",t=""){return this._overlayRef.updateSize({width:e,height:t}),this._overlayRef.updatePosition(),this}addPanelClass(e){return this._overlayRef.addPanelClass(e),this}removePanelClass(e){return this._overlayRef.removePanelClass(e),this}getState(){return this._state}_finishDialogClose(){this._state=2,this._overlayRef.dispose()}_getPositionStrategy(){return this._overlayRef.getConfig().positionStrategy}}function zu(n,e,t){return void 0!==n._containerInstance&&(n._containerInstance._closeInteractionType=e),n.close(t)}const os=new d.OlP("MatDialogData"),Ce=new d.OlP("mat-dialog-default-options"),De=new d.OlP("mat-dialog-scroll-strategy"),Zo={provide:De,deps:[pr.aV],useFactory:function Ku(n){return()=>n.scrollStrategies.block()}};let qt=(()=>{class n{constructor(t,r,i,s,u,h,f,m,g,_){this._overlay=t,this._injector=r,this._defaultOptions=i,this._parentDialog=s,this._overlayContainer=u,this._dialogRefConstructor=f,this._dialogContainerType=m,this._dialogDataToken=g,this._openDialogsAtThisLevel=[],this._afterAllClosedAtThisLevel=new oe.x,this._afterOpenedAtThisLevel=new oe.x,this._ariaHiddenElements=new Map,this.afterAllClosed=(0,Ue.P)(()=>this.openDialogs.length?this._getAfterAllClosed():this._getAfterAllClosed().pipe((0,R.O)(void 0))),this._scrollStrategy=h}get openDialogs(){return this._parentDialog?this._parentDialog.openDialogs:this._openDialogsAtThisLevel}get afterOpened(){return this._parentDialog?this._parentDialog.afterOpened:this._afterOpenedAtThisLevel}_getAfterAllClosed(){const t=this._parentDialog;return t?t._getAfterAllClosed():this._afterAllClosedAtThisLevel}open(t,r){r=function Hu(n,e){return Object.assign(Object.assign({},e),n)}(r,this._defaultOptions||new ei),r.id&&this.getDialogById(r.id);const i=this._createOverlay(r),s=this._attachDialogContainer(i,r),u=this._attachDialogContent(t,s,i,r);return this.openDialogs.length||this._hideNonDialogContentFromAssistiveTechnology(),this.openDialogs.push(u),u.afterClosed().subscribe(()=>this._removeOpenDialog(u)),this.afterOpened.next(u),s._initializeWithAttachedContent(),u}closeAll(){this._closeDialogs(this.openDialogs)}getDialogById(t){return this.openDialogs.find(r=>r.id===t)}ngOnDestroy(){this._closeDialogs(this._openDialogsAtThisLevel),this._afterAllClosedAtThisLevel.complete(),this._afterOpenedAtThisLevel.complete()}_createOverlay(t){const r=this._getOverlayConfig(t);return this._overlay.create(r)}_getOverlayConfig(t){const r=new pr.X_({positionStrategy:this._overlay.position().global(),scrollStrategy:t.scrollStrategy||this._scrollStrategy(),panelClass:t.panelClass,hasBackdrop:t.hasBackdrop,direction:t.direction,minWidth:t.minWidth,minHeight:t.minHeight,maxWidth:t.maxWidth,maxHeight:t.maxHeight,disposeOnNavigation:t.closeOnNavigation});return t.backdropClass&&(r.backdropClass=t.backdropClass),r}_attachDialogContainer(t,r){const s=d.zs3.create({parent:r&&r.viewContainerRef&&r.viewContainerRef.injector||this._injector,providers:[{provide:ei,useValue:r}]}),u=new mr.C5(this._dialogContainerType,r.viewContainerRef,s,r.componentFactoryResolver);return t.attach(u).instance}_attachDialogContent(t,r,i,s){const u=new this._dialogRefConstructor(i,r,s.id);if(t instanceof d.Rgc)r.attachTemplatePortal(new mr.UE(t,null,{$implicit:s.data,dialogRef:u}));else{const h=this._createInjector(s,u,r),f=r.attachComponentPortal(new mr.C5(t,s.viewContainerRef,h,s.componentFactoryResolver));u.componentInstance=f.instance}return u.updateSize(s.width,s.height).updatePosition(s.position),u}_createInjector(t,r,i){const s=t&&t.viewContainerRef&&t.viewContainerRef.injector,u=[{provide:this._dialogContainerType,useValue:i},{provide:this._dialogDataToken,useValue:t.data},{provide:this._dialogRefConstructor,useValue:r}];return t.direction&&(!s||!s.get(gr.Is,null,d.XFs.Optional))&&u.push({provide:gr.Is,useValue:{value:t.direction,change:(0,tn.of)()}}),d.zs3.create({parent:s||this._injector,providers:u})}_removeOpenDialog(t){const r=this.openDialogs.indexOf(t);r>-1&&(this.openDialogs.splice(r,1),this.openDialogs.length||(this._ariaHiddenElements.forEach((i,s)=>{i?s.setAttribute("aria-hidden",i):s.removeAttribute("aria-hidden")}),this._ariaHiddenElements.clear(),this._getAfterAllClosed().next()))}_hideNonDialogContentFromAssistiveTechnology(){const t=this._overlayContainer.getContainerElement();if(t.parentElement){const r=t.parentElement.children;for(let i=r.length-1;i>-1;i--){let s=r[i];s!==t&&"SCRIPT"!==s.nodeName&&"STYLE"!==s.nodeName&&!s.hasAttribute("aria-live")&&(this._ariaHiddenElements.set(s,s.getAttribute("aria-hidden")),s.setAttribute("aria-hidden","true"))}}}_closeDialogs(t){let r=t.length;for(;r--;)t[r].close()}}return n.\u0275fac=function(t){d.$Z()},n.\u0275dir=d.lG2({type:n}),n})(),ni=(()=>{class n extends qt{constructor(t,r,i,s,u,h,f,m){super(t,r,s,h,f,u,Vt,ti,os,m)}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(pr.aV),d.LFG(d.zs3),d.LFG(Ie.Ye,8),d.LFG(Ce,8),d.LFG(De),d.LFG(n,12),d.LFG(pr.Xj),d.LFG(qo.Qb,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac}),n})(),nh=0,yr=(()=>{class n{constructor(t,r,i){this._dialogRef=t,this._elementRef=r,this._dialog=i,this.id="mat-dialog-title-"+nh++}ngOnInit(){this._dialogRef||(this._dialogRef=function Go(n,e){let t=n.nativeElement.parentElement;for(;t&&!t.classList.contains("mat-dialog-container");)t=t.parentElement;return t?e.find(r=>r.id===t.id):null}(this._elementRef,this._dialog.openDialogs)),this._dialogRef&&Promise.resolve().then(()=>{const t=this._dialogRef._containerInstance;t&&!t._ariaLabelledBy&&(t._ariaLabelledBy=this.id)})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(Vt,8),d.Y36(d.SBq),d.Y36(ni))},n.\u0275dir=d.lG2({type:n,selectors:[["","mat-dialog-title",""],["","matDialogTitle",""]],hostAttrs:[1,"mat-dialog-title"],hostVars:1,hostBindings:function(t,r){2&t&&d.Ikx("id",r.id)},inputs:{id:"id"},exportAs:["matDialogTitle"]}),n})(),nn=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=d.lG2({type:n,selectors:[["","mat-dialog-content",""],["mat-dialog-content"],["","matDialogContent",""]],hostAttrs:[1,"mat-dialog-content"]}),n})(),rh=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({providers:[ni,Zo],imports:[[pr.U8,mr.eL,Ae.BQ],Ae.BQ]}),n})();var He=L(7322),rn=L(7531),us=L(4107),Dn=L(7423);let $o=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r,this.PlayerRole=rt}onSubmit(){this.dialogRef.close(new Jr(new An(this.formGroup.value.position),this.formGroup.value.player_role,this.formGroup.value.player_name))}ngOnInit(){this.formGroup=this.fb.group({player_name:[null],position:[null,B.kI.required],player_role:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-add-actor-dialog"]],decls:50,vars:43,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","player_name"],["appearance","fill"],["formControlName","position"],[3,"value"],["formControlName","player_role"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"mat-form-field",4)(11,"mat-label"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"mat-select",5)(15,"mat-option",6),d._uU(16,"1"),d.qZA(),d.TgZ(17,"mat-option",6),d._uU(18,"2"),d.qZA(),d.TgZ(19,"mat-option",6),d._uU(20,"3"),d.qZA(),d.TgZ(21,"mat-option",6),d._uU(22,"4"),d.qZA(),d.TgZ(23,"mat-option",6),d._uU(24,"5"),d.qZA(),d.TgZ(25,"mat-option",6),d._uU(26,"6"),d.qZA()()(),d.TgZ(27,"mat-form-field",4)(28,"mat-label"),d._uU(29),d.ALo(30,"translate"),d.qZA(),d.TgZ(31,"mat-select",7)(32,"mat-option",6),d._uU(33),d.ALo(34,"translate"),d.qZA(),d.TgZ(35,"mat-option",6),d._uU(36),d.ALo(37,"translate"),d.qZA(),d.TgZ(38,"mat-option",6),d._uU(39),d.ALo(40,"translate"),d.qZA(),d.TgZ(41,"mat-option",6),d._uU(42),d.ALo(43,"translate"),d.qZA(),d.TgZ(44,"mat-option",6),d._uU(45),d.ALo(46,"translate"),d.qZA()()(),d.TgZ(47,"button",8),d._uU(48),d.ALo(49,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,23,"add_actor_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,25,"add_actor_dialog.placeholder.player_name")),d.xp6(5),d.Oqu(d.lcZ(13,27,"add_actor_dialog.placeholder.position")),d.xp6(3),d.Q6J("value",1),d.xp6(2),d.Q6J("value",2),d.xp6(2),d.Q6J("value",3),d.xp6(2),d.Q6J("value",4),d.xp6(2),d.Q6J("value",5),d.xp6(2),d.Q6J("value",6),d.xp6(4),d.Oqu(d.lcZ(30,29,"add_actor_dialog.placeholder.player_role")),d.xp6(3),d.Q6J("value",r.PlayerRole.Setter),d.xp6(1),d.Oqu(d.lcZ(34,31,"add_actor_dialog.player_roles.setter")),d.xp6(2),d.Q6J("value",r.PlayerRole.MiddleBlocker),d.xp6(1),d.Oqu(d.lcZ(37,33,"add_actor_dialog.player_roles.middle_blocker")),d.xp6(2),d.Q6J("value",r.PlayerRole.Libero),d.xp6(1),d.Oqu(d.lcZ(40,35,"add_actor_dialog.player_roles.libero")),d.xp6(2),d.Q6J("value",r.PlayerRole.OutsideHitter),d.xp6(1),d.Oqu(d.lcZ(43,37,"add_actor_dialog.player_roles.outside_hitter")),d.xp6(2),d.Q6J("value",r.PlayerRole.OppositeHitter),d.xp6(1),d.Oqu(d.lcZ(46,39,"add_actor_dialog.player_roles.opposite_hitter")),d.xp6(2),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(49,41,"add_actor_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,rn.Nt,B.Fj,B.JJ,B.u,us.gD,Ae.ey,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();function jo(n,e){if(1&n&&(d.TgZ(0,"mat-option",6),d._uU(1),d.qZA()),2&n){const t=e.$implicit;d.Q6J("value",t.UUID),d.xp6(1),d.Oqu(t.toString())}}let cs=(()=>{class n{constructor(t,r,i){this.fb=t,this.dialogRef=r,this.data=i}onSubmit(){this.dialogRef.close(this.formGroup.value.actor)}ngOnInit(){this.formGroup=this.fb.group({actor:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt),d.Y36(os))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-delete-actor-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","actor"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"mat-select",3),d.YNc(10,jo,2,2,"mat-option",4),d.qZA()(),d.TgZ(11,"button",5),d._uU(12),d.ALo(13,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,6,"delete_actor_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,8,"delete_actor_dialog.placeholder.actor")),d.xp6(3),d.Q6J("ngForOf",r.data.actors),d.xp6(1),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(13,10,"delete_actor_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,us.gD,B.JJ,B.u,Ie.sg,Ae.ey,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Rn{constructor(e,t,r,i){this.rotation=e,this.name=t,this._UUID=null!=r?r:Gu(),this._lines=null!=i?i:[]}get UUID(){return this._UUID}static fromDto(e){const t=new An(e.r);return new Rn(t,"NULL"===e.n?void 0:e.n,e.u)}toDto(){var e;return{n:null!==(e=this.name)&&void 0!==e?e:"NULL",r:this.rotation.value,u:this.UUID}}toString(){return this.name?`${this.name} (${this.rotation.value})`:`Unknown rotation (${this.rotation.value})`}addLine(e){this._lines.push(e)}draw(){this._lines.forEach(e=>e.draw())}removeIfHitLine(e,t){const r=this._lines.findIndex(i=>i.isHit(e,t));r<0||this._lines.splice(r,1)}}function Bt(n,e){if(1&n&&(d.TgZ(0,"mat-option",6),d._uU(1),d.qZA()),2&n){const t=e.$implicit;d.Q6J("value",t.UUID),d.xp6(1),d.Oqu(t.toString())}}let zo=(()=>{class n{constructor(t,r,i){this.fb=t,this.dialogRef=r,this.data=i}onSubmit(){this.dialogRef.close(this.formGroup.value.rotation)}ngOnInit(){this.formGroup=this.fb.group({rotation:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt),d.Y36(os))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-delete-rotation-dialog"]],decls:14,vars:12,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill"],["formControlName","rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-raised-button","","color","primary","type","submit",3,"disabled"],[3,"value"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d.TgZ(9,"mat-select",3),d.YNc(10,Bt,2,2,"mat-option",4),d.qZA()(),d.TgZ(11,"button",5),d._uU(12),d.ALo(13,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,6,"delete_rotation_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,8,"delete_rotation_dialog.placeholder.rotation")),d.xp6(3),d.Q6J("ngForOf",r.data.rotations),d.xp6(1),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(13,10,"delete_rotation_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,us.gD,B.JJ,B.u,Ie.sg,Ae.ey,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),ih=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r}onSubmit(){this.dialogRef.close(new Rn(new An(this.formGroup.value.current_rotation),this.formGroup.value.rotation_name))}ngOnInit(){this.formGroup=this.fb.group({rotation_name:null,current_rotation:[1,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-add-rotation-dialog"]],decls:30,vars:20,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","rotation_name"],["appearance","fill"],["formControlName","current_rotation"],[3,"value"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"mat-form-field",4)(11,"mat-label"),d._uU(12),d.ALo(13,"translate"),d.qZA(),d.TgZ(14,"mat-select",5)(15,"mat-option",6),d._uU(16,"1"),d.qZA(),d.TgZ(17,"mat-option",6),d._uU(18,"2"),d.qZA(),d.TgZ(19,"mat-option",6),d._uU(20,"3"),d.qZA(),d.TgZ(21,"mat-option",6),d._uU(22,"4"),d.qZA(),d.TgZ(23,"mat-option",6),d._uU(24,"5"),d.qZA(),d.TgZ(25,"mat-option",6),d._uU(26,"6"),d.qZA()()(),d.TgZ(27,"button",7),d._uU(28),d.ALo(29,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,12,"add_rotation_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,14,"add_rotation_dialog.placeholder.rotation_name")),d.xp6(5),d.Oqu(d.lcZ(13,16,"add_rotation_dialog.placeholder.current_rotation")),d.xp6(3),d.Q6J("value",1),d.xp6(2),d.Q6J("value",2),d.xp6(2),d.Q6J("value",3),d.xp6(2),d.Q6J("value",4),d.xp6(2),d.Q6J("value",5),d.xp6(2),d.Q6J("value",6),d.xp6(2),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(29,18,"add_rotation_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,rn.Nt,B.Fj,B.JJ,B.u,us.gD,Ae.ey,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class _r{static store(e,t){const r=JSON.stringify(t);window.localStorage.setItem(e,r)}static retrieve(e){const t=window.localStorage.getItem(e);if(t)return JSON.parse(t)}static remove(e){window.localStorage.removeItem(e)}}var Wo=L(4968),vt=L(8996),Ko=L(4986),Ho=L(8306),Le=L(2122),sh=L(4482),oh=L(5403);function Qo(){return(0,sh.e)((n,e)=>{let t,r=!1;n.subscribe((0,oh.x)(e,i=>{const s=t;t=i,r&&e.next([s,i]),r=!0}))})}var Z,Ve=L(4004),Nn=L(5026),Zt=L(1884),Ge=L(2011),vr=(L(9169),L(3942)),st=L(9681),Gt=L(4859),$t=L(1877),ie=L(2090),Yo="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Tt={},On=On||{},W=Yo||self;function ri(){}function jt(n){var e=typeof n;return"array"==(e="object"!=e?e:n?Array.isArray(n)?"array":e:"null")||"object"==e&&"number"==typeof n.length}function ii(n){var e=typeof n;return"object"==e&&null!=n||"function"==e}var Jo="closure_uid_"+(1e9*Math.random()>>>0),Qu=0;function uh(n,e,t){return n.call.apply(n.bind,arguments)}function Yu(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function $e(n,e,t){return($e=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?uh:Yu).apply(null,arguments)}function ls(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function te(n,e){function t(){}t.prototype=e.prototype,n.X=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.Wb=function(r,i,s){for(var u=Array(arguments.length-2),h=2;h<arguments.length;h++)u[h-2]=arguments[h];return e.prototype[i].apply(r,u)}}function zt(){this.s=this.s,this.o=this.o}zt.prototype.s=!1,zt.prototype.na=function(){!this.s&&(this.s=!0,this.M(),0)&&function ah(n){Object.prototype.hasOwnProperty.call(n,Jo)&&n[Jo]||(n[Jo]=++Qu)}(this)},zt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Xo=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if("string"==typeof n)return"string"!=typeof e||1!=e.length?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function ea(n){const e=n.length;if(0<e){const t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function ta(n,e){for(let t=1;t<arguments.length;t++){const r=arguments[t];if(jt(r)){const i=n.length||0,s=r.length||0;n.length=i+s;for(let u=0;u<s;u++)n[i+u]=r[u]}else n.push(r)}}function je(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}je.prototype.h=function(){this.defaultPrevented=!0};var Ir=function(){if(!W.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{W.addEventListener("test",ri,e),W.removeEventListener("test",ri,e)}catch(t){}return n}();function si(n){return/^[\s\xa0]*$/.test(n)}var hs=String.prototype.trim?function(n){return n.trim()}:function(n){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(n)[1]};function ds(n,e){return n<e?-1:n>e?1:0}function wr(){var n=W.navigator;return n&&(n=n.userAgent)?n:""}function kt(n){return-1!=wr().indexOf(n)}function oi(n){return oi[" "](n),n}oi[" "]=ri;var gs,n,na=kt("Opera"),Wt=kt("Trident")||kt("MSIE"),fs=kt("Edge"),ra=fs||Wt,ps=kt("Gecko")&&!(-1!=wr().toLowerCase().indexOf("webkit")&&!kt("Edge"))&&!(kt("Trident")||kt("MSIE"))&&!kt("Edge"),lh=-1!=wr().toLowerCase().indexOf("webkit")&&!kt("Edge");function ms(){var n=W.document;return n?n.documentMode:void 0}e:{var ai="",ia=(n=wr(),ps?/rv:([^\);]+)(\)|;)/.exec(n):fs?/Edge\/([\d\.]+)/.exec(n):Wt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n):lh?/WebKit\/(\S+)/.exec(n):na?/(?:Version)[ \/]?(\S+)/.exec(n):void 0);if(ia&&(ai=ia?ia[1]:""),Wt){var ui=ms();if(null!=ui&&ui>parseFloat(ai)){gs=String(ui);break e}}gs=ai}var hh={};var ci=W.document&&Wt&&(ms()||parseInt(gs,10))||void 0;function ot(n,e){if(je.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(ps){e:{try{oi(e.nodeName);var i=!0;break e}catch(s){}i=!1}i||(e=null)}}else"mouseover"==t?e=n.fromElement:"mouseout"==t&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType="string"==typeof n.pointerType?n.pointerType:aa[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&ot.X.h.call(this)}}te(ot,je);var aa={2:"touch",3:"pen",4:"mouse"};ot.prototype.h=function(){ot.X.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var li="closure_listenable_"+(1e6*Math.random()|0),xt=0;function dh(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.ha=i,this.key=++xt,this.ba=this.ea=!1}function br(n){n.ba=!0,n.listener=null,n.proxy=null,n.src=null,n.ha=null}function ua(n,e,t){for(const r in n)e.call(t,n[r],r,n)}function _s(n){const e={};for(const t in n)e[t]=n[t];return e}const Xu="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function vs(n,e){let t,r;for(let i=1;i<arguments.length;i++){for(t in r=arguments[i],r)n[t]=r[t];for(let s=0;s<Xu.length;s++)t=Xu[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function Is(n){this.src=n,this.g={},this.h=0}function ca(n,e){var t=e.type;if(t in n.g){var s,r=n.g[t],i=Xo(r,e);(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(br(e),0==n.g[t].length&&(delete n.g[t],n.h--))}}function hi(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.ba&&s.listener==e&&s.capture==!!t&&s.ha==r)return i}return-1}Is.prototype.add=function(n,e,t,r,i){var s=n.toString();(n=this.g[s])||(n=this.g[s]=[],this.h++);var u=hi(n,e,r,i);return-1<u?(e=n[u],t||(e.ea=!1)):((e=new dh(e,this.src,s,!!r,i)).ea=t,n.push(e)),e};var Kt="closure_lm_"+(1e6*Math.random()|0),la={};function ec(n,e,t,r,i){if(r&&r.once)return ws(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)ec(n,e[s],t,r,i);return null}return t=ha(t),n&&n[li]?n.N(e,t,ii(r)?!!r.capture:!!r,i):Er(n,e,t,!1,r,i)}function Er(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var u=ii(i)?!!i.capture:!!i,h=bs(n);if(h||(n[Kt]=h=new Is(n)),(t=h.add(e,t,r,u,s)).proxy)return t;if(r=function mp(){const e=tc;return function n(t){return e.call(n.src,n.listener,t)}}(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)Ir||(i=u),void 0===i&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(Mn(e.toString()),r);else{if(!n.addListener||!n.removeListener)throw Error("addEventListener and attachEvent are unavailable.");n.addListener(r)}return t}function ws(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ws(n,e[s],t,r,i);return null}return t=ha(t),n&&n[li]?n.O(e,t,ii(r)?!!r.capture:!!r,i):Er(n,e,t,!0,r,i)}function At(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)At(n,e[s],t,r,i);else r=ii(r)?!!r.capture:!!r,t=ha(t),n&&n[li]?(n=n.i,(e=String(e).toString())in n.g&&-1<(t=hi(s=n.g[e],t,r,i))&&(br(s[t]),Array.prototype.splice.call(s,t,1),0==s.length&&(delete n.g[e],n.h--))):n&&(n=bs(n))&&(e=n.g[e.toString()],n=-1,e&&(n=hi(e,t,r,i)),(t=-1<n?e[n]:null)&&sn(t))}function sn(n){if("number"!=typeof n&&n&&!n.ba){var e=n.src;if(e&&e[li])ca(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(Mn(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=bs(e))?(ca(t,n),0==t.h&&(t.src=null,e[Kt]=null)):br(n)}}}function Mn(n){return n in la?la[n]:la[n]="on"+n}function tc(n,e){if(n.ba)n=!0;else{e=new ot(e,this);var t=n.listener,r=n.ha||n.src;n.ea&&sn(n),n=t.call(r,e)}return n}function bs(n){return(n=n[Kt])instanceof Is?n:null}var Es="__closure_events_fn_"+(1e9*Math.random()>>>0);function ha(n){return"function"==typeof n?n:(n[Es]||(n[Es]=function(e){return n.handleEvent(e)}),n[Es])}function ge(){zt.call(this),this.i=new Is(this),this.P=this,this.I=null}function qe(n,e){var t,r=n.I;if(r)for(t=[];r;r=r.I)t.push(r);if(n=n.P,r=e.type||e,"string"==typeof e)e=new je(e,n);else if(e instanceof je)e.target=e.target||n;else{var i=e;vs(e=new je(r,n),i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var u=e.g=t[s];i=Pn(u,r,!0,e)&&i}if(i=Pn(u=e.g=n,r,!0,e)&&i,i=Pn(u,r,!1,e)&&i,t)for(s=0;s<t.length;s++)i=Pn(u=e.g=t[s],r,!1,e)&&i}function Pn(n,e,t,r){if(!(e=n.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var u=e[s];if(u&&!u.ba&&u.capture==t){var h=u.listener,f=u.ha||u.src;u.ea&&ca(n.i,u),i=!1!==h.call(f,r)&&i}}return i&&!r.defaultPrevented}te(ge,zt),ge.prototype[li]=!0,ge.prototype.removeEventListener=function(n,e,t,r){At(this,n,e,t,r)},ge.prototype.M=function(){if(ge.X.M.call(this),this.i){var e,n=this.i;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)br(t[r]);delete n.g[e],n.h--}}this.I=null},ge.prototype.N=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)},ge.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};var Ts=W.JSON.stringify;function nc(){var n=sc;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var Tr,at=new class{constructor(n,e){this.i=n,this.j=e,this.h=0,this.g=null}get(){let n;return 0<this.h?(this.h--,n=this.g,this.g=n.next,n.next=null):n=this.i(),n}}(()=>new rc,n=>n.reset());class rc{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}function fh(n){W.setTimeout(()=>{throw n},0)}function ks(n,e){Tr||function ic(){var n=W.Promise.resolve(void 0);Tr=function(){n.then(fa)}}(),xs||(Tr(),xs=!0),sc.add(n,e)}var xs=!1,sc=new class da{constructor(){this.h=this.g=null}add(e,t){const r=at.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}};function fa(){for(var n;n=nc();){try{n.h.call(n.g)}catch(t){fh(t)}var e=at;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}xs=!1}function kr(n,e){ge.call(this),this.h=n||1,this.g=e||W,this.j=$e(this.lb,this),this.l=Date.now()}function di(n){n.ca=!1,n.R&&(n.g.clearTimeout(n.R),n.R=null)}function xr(n,e,t){if("function"==typeof n)t&&(n=$e(n,t));else{if(!n||"function"!=typeof n.handleEvent)throw Error("Invalid listener argument");n=$e(n.handleEvent,n)}return 2147483647<Number(e)?-1:W.setTimeout(n,e||0)}function As(n){n.g=xr(()=>{n.g=null,n.i&&(n.i=!1,As(n))},n.j);const e=n.h;n.h=null,n.m.apply(null,e)}te(kr,ge),(Z=kr.prototype).ca=!1,Z.R=null,Z.lb=function(){if(this.ca){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-n):(this.R&&(this.g.clearTimeout(this.R),this.R=null),qe(this,"tick"),this.ca&&(di(this),this.start()))}},Z.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Z.M=function(){kr.X.M.call(this),di(this),delete this.g};class oc extends zt{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:As(this)}M(){super.M(),this.g&&(W.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ln(n){zt.call(this),this.h=n,this.g={}}te(Ln,zt);var pa=[];function Ss(n,e,t,r){Array.isArray(t)||(t&&(pa[0]=t.toString()),t=pa);for(var i=0;i<t.length;i++){var s=ec(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function fi(n){ua(n.g,function(e,t){this.g.hasOwnProperty(t)&&sn(e)},n),n.g={}}function Ar(){this.g=!0}function Fn(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+function ph(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t)for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var u=1;u<i.length;u++)i[u]=""}}}return Ts(t)}catch(h){return e}}(n,t)+(r?" "+r:"")})}Ln.prototype.M=function(){Ln.X.M.call(this),fi(this)},Ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},Ar.prototype.Aa=function(){this.g=!1},Ar.prototype.info=function(){};var Ht={},uc=null;function Sr(){return uc=uc||new ge}function pi(n){je.call(this,Ht.Pa,n)}function Un(n){const e=Sr();qe(e,new pi(e))}function mi(n,e){je.call(this,Ht.STAT_EVENT,n),this.stat=e}function Qe(n){const e=Sr();qe(e,new mi(e,n))}function Cs(n,e){je.call(this,Ht.Qa,n),this.size=e}function gi(n,e){if("function"!=typeof n)throw Error("Fn must not be null and must be a function");return W.setTimeout(function(){n()},e)}Ht.Pa="serverreachability",te(pi,je),Ht.STAT_EVENT="statevent",te(mi,je),Ht.Qa="timingevent",te(Cs,je);var Cr={NO_ERROR:0,mb:1,zb:2,yb:3,tb:4,xb:5,Ab:6,Ma:7,TIMEOUT:8,Db:9},cc={rb:"complete",Nb:"success",Na:"error",Ma:"abort",Fb:"ready",Gb:"readystatechange",TIMEOUT:"timeout",Bb:"incrementaldata",Eb:"progress",ub:"downloadprogress",Vb:"uploadprogress"};function yi(){}function Ds(){}yi.prototype.h=null;var Ii,_i={OPEN:"a",qb:"b",Na:"c",Cb:"d"};function vi(){je.call(this,"d")}function _a(){je.call(this,"c")}function Rs(){}function wi(n,e,t,r){this.l=n,this.j=e,this.m=t,this.U=r||1,this.S=new Ln(this),this.O=mh,this.T=new kr(n=ra?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Ns}function Ns(){this.i=null,this.g="",this.h=!1}te(vi,je),te(_a,je),te(Rs,yi),Rs.prototype.g=function(){return new XMLHttpRequest},Rs.prototype.i=function(){return{}},Ii=new Rs;var mh=45e3,va={},Dr={};function Ia(n,e,t){n.K=1,n.v=Ls(et(e)),n.s=t,n.P=!0,Os(n,null)}function Os(n,e){n.F=Date.now(),Vn(n),n.A=et(n.v);var t=n.A,r=n.U;Array.isArray(r)||(r=[String(r)]),mc(t.i,"t",r),n.C=0,t=n.l.H,n.h=new Ns,n.g=Sc(n.l,t?e:null,!n.s),0<n.N&&(n.L=new oc($e(n.La,n,n.g),n.N)),Ss(n.S,n.g,"readystatechange",n.ib),e=n.H?_s(n.H):{},n.s?(n.u||(n.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.da(n.A,n.u,n.s,e)):(n.u="GET",n.g.da(n.A,n.u,null,e)),Un(),function ac(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var u="",h=s.split("&"),f=0;f<h.length;f++){var m=h[f].split("=");if(1<m.length){var g=m[0];m=m[1];var _=g.split("_");u=2<=_.length&&"type"==_[1]?u+(g+"=")+m+"&":u+(g+"=redacted&")}}else u=null;else u=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+t+"\n"+u})}(n.j,n.u,n.A,n.m,n.U,n.s)}function lc(n){return!!n.g&&"GET"==n.u&&2!=n.K&&n.l.Da}function Ms(n,e,t){let i,r=!0;for(;!n.I&&n.C<t.length;){if(i=gh(n,t),i==Dr){4==e&&(n.o=4,Qe(14),r=!1),Fn(n.j,n.m,null,"[Incomplete Response]");break}if(i==va){n.o=4,Qe(15),Fn(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}Fn(n.j,n.m,i,null),wa(n,i)}lc(n)&&i!=Dr&&i!=va&&(n.h.g="",n.C=0),4!=e||0!=t.length||n.h.h||(n.o=1,Qe(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.$&&(n.$=!0,(e=n.l).g==n&&e.$&&!e.K&&(e.j.info("Great, no buffering proxy detected. Bytes received: "+t.length),Ks(e),e.K=!0,Qe(11))):(Fn(n.j,n.m,t,"[Invalid Chunked Response]"),Qt(n),bi(n))}function gh(n,e){var t=n.C,r=e.indexOf("\n",t);return-1==r?Dr:(t=Number(e.substring(t,r)),isNaN(t)?va:(r+=1)+t>e.length?Dr:(e=e.substr(r,t),n.C=r+t,e))}function Vn(n){n.V=Date.now()+n.O,hc(n,n.O)}function hc(n,e){if(null!=n.B)throw Error("WatchDog timer not null");n.B=gi($e(n.gb,n),e)}function Rr(n){n.B&&(W.clearTimeout(n.B),n.B=null)}function bi(n){0==n.l.G||n.I||Di(n.l,n)}function Qt(n){Rr(n);var e=n.L;e&&"function"==typeof e.na&&e.na(),n.L=null,di(n.T),fi(n.S),n.g&&(e=n.g,n.g=null,e.abort(),e.na())}function wa(n,e){try{var t=n.l;if(0!=t.G&&(t.g==n||Bs(t.h,n)))if(!n.J&&Bs(t.h,n)&&3==t.G){try{var r=t.Fa.g.parse(e)}catch(m){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0])e:if(t.u)t.Ba=i[1],0<t.Ba-t.T&&37500>i[2]&&t.L&&0==t.A&&!t.v&&(t.v=gi($e(t.cb,t),6e3));else{if(t.g){if(!(t.g.F+3e3<n.F))break e;Hs(t),js(t)}Ws(t),Qe(18)}if(1>=ki(t.h)&&t.ja){try{t.ja()}catch(m){}t.ja=void 0}}else $n(t,11)}else if((n.J||t.g==n)&&Hs(t),!si(e))for(i=t.Fa.g.parse(e),e=0;e<i.length;e++){let m=i[e];if(t.T=m[0],m=m[1],2==t.G)if("c"==m[0]){t.I=m[1],t.ka=m[2];const g=m[3];null!=g&&(t.ma=g,t.j.info("VER="+t.ma));const _=m[4];null!=_&&(t.Ca=_,t.j.info("SVER="+t.Ca));const w=m[5];null!=w&&"number"==typeof w&&0<w&&(t.J=r=1.5*w,t.j.info("backChannelRequestTimeoutMs_="+r)),r=t;const x=n.g;if(x){const S=x.g?x.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(S){var s=r.h;s.g||-1==S.indexOf("spdy")&&-1==S.indexOf("quic")&&-1==S.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(xa(s,s.h),s.h=null))}if(r.D){const M=x.g?x.g.getResponseHeader("X-HTTP-Session-Id"):null;M&&(r.za=M,de(r.F,r.D,M))}}t.G=3,t.l&&t.l.xa(),t.$&&(t.P=Date.now()-n.F,t.j.info("Handshake RTT: "+t.P+"ms"));var u=n;if((r=t).sa=Qs(r,r.H?r.ka:null,r.V),u.J){yc(r.h,u);var h=u,f=r.J;f&&h.setTimeout(f),h.B&&(Rr(h),Vn(h)),r.g=u}else Tc(r);0<t.i.length&&Yt(t)}else"stop"!=m[0]&&"close"!=m[0]||$n(t,7);else 3==t.G&&("stop"==m[0]||"close"==m[0]?"stop"==m[0]?$n(t,7):Na(t):"noop"!=m[0]&&t.l&&t.l.wa(m),t.A=0)}Un()}catch(m){}}function dc(n,e){if(n.forEach&&"function"==typeof n.forEach)n.forEach(e,void 0);else if(jt(n)||"string"==typeof n)Array.prototype.forEach.call(n,e,void 0);else for(var t=function yh(n){if(n.oa&&"function"==typeof n.oa)return n.oa();if(!n.W||"function"!=typeof n.W){if("undefined"!=typeof Map&&n instanceof Map)return Array.from(n.keys());if(!("undefined"!=typeof Set&&n instanceof Set)){if(jt(n)||"string"==typeof n){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(const r in n)e[t++]=r;return e}}}(n),r=function ba(n){if(n.W&&"function"==typeof n.W)return n.W();if("undefined"!=typeof Map&&n instanceof Map||"undefined"!=typeof Set&&n instanceof Set)return Array.from(n.values());if("string"==typeof n)return n.split("");if(jt(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}for(r in e=[],t=0,n)e[t++]=n[r];return e}(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}(Z=wi.prototype).setTimeout=function(n){this.O=n},Z.ib=function(n){n=n.target;const e=this.L;e&&3==It(n)?e.l():this.La(n)},Z.La=function(n){try{if(n==this.g)e:{const g=It(this.g);var e=this.g.Ea();if(this.g.aa(),!(3>g)&&(3!=g||ra||this.g&&(this.h.h||this.g.fa()||Ca(this.g)))){this.I||4!=g||7==e||Un(),Rr(this);var t=this.g.aa();this.Y=t;t:if(lc(this)){var r=Ca(this.g);n="";var i=r.length,s=4==It(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){Qt(this),bi(this);var u="";break t}this.h.i=new W.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.splice(0,i),this.h.g+=n,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==t,function ma(n,e,t,r,i,s,u){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+t+"\n"+s+" "+u})}(this.j,this.u,this.A,this.m,this.U,g,t),this.i){if(this.Z&&!this.J){t:{if(this.g){var h,f=this.g;if((h=f.g?f.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!si(h)){var m=h;break t}}m=null}if(!(t=m)){this.i=!1,this.o=3,Qe(12),Qt(this),bi(this);break e}Fn(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,wa(this,t)}this.P?(Ms(this,g,u),ra&&this.i&&3==g&&(Ss(this.S,this.T,"tick",this.hb),this.T.start())):(Fn(this.j,this.m,u,null),wa(this,u)),4==g&&Qt(this),this.i&&!this.I&&(4==g?Di(this.l,this):(this.i=!1,Vn(this)))}else 400==t&&0<u.indexOf("Unknown SID")?(this.o=3,Qe(12)):(this.o=0,Qe(13)),Qt(this),bi(this)}}}catch(g){}},Z.hb=function(){if(this.g){var n=It(this.g),e=this.g.fa();this.C<e.length&&(Rr(this),Ms(this,n,e),this.i&&4!=n&&Vn(this))}},Z.cancel=function(){this.I=!0,Qt(this)},Z.gb=function(){this.B=null;const n=Date.now();0<=n-this.V?(function ga(n,e){n.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(Un(),Qe(17)),Qt(this),this.o=2,bi(this)):hc(this,this.V-n)};var Ea=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function qn(n,e){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof qn){this.h=void 0!==e?e:n.h,Ei(this,n.j),this.s=n.s,this.g=n.g,Ps(this,n.m),this.l=n.l,e=n.i;var t=new Us;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),fc(this,t),this.o=n.o}else n&&(t=String(n).match(Ea))?(this.h=!!e,Ei(this,t[1]||"",!0),this.s=Ti(t[2]||""),this.g=Ti(t[3]||"",!0),Ps(this,t[4]),this.l=Ti(t[5]||"",!0),fc(this,t[6]||"",!0),this.o=Ti(t[7]||"")):(this.h=!!e,this.i=new Us(null,this.h))}function et(n){return new qn(n)}function Ei(n,e,t){n.j=t?Ti(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function Ps(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function fc(n,e,t){e instanceof Us?(n.i=e,function vh(n,e){e&&!n.j&&(St(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(on(this,r),mc(this,i,t))},n)),n.j=e}(n.i,n.h)):(t||(e=Fs(e,_p)),n.i=new Us(e,n.h))}function de(n,e,t){n.i.set(e,t)}function Ls(n){return de(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Ti(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Fs(n,e,t){return"string"==typeof n?(n=encodeURI(n).replace(e,_h),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function _h(n){return"%"+((n=n.charCodeAt(0))>>4&15).toString(16)+(15&n).toString(16)}qn.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Fs(e,pc,!0),":");var t=this.g;return(t||"file"==e)&&(n.push("//"),(e=this.s)&&n.push(Fs(e,pc,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(t=this.m)&&n.push(":",String(t))),(t=this.l)&&(this.g&&"/"!=t.charAt(0)&&n.push("/"),n.push(Fs(t,"/"==t.charAt(0)?yp:gp,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Fs(t,vp)),n.join("")};var pc=/[#\/\?@]/g,gp=/[#\?:]/g,yp=/[#\?]/g,_p=/[#\?@]/g,vp=/#/g;function Us(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function St(n){n.g||(n.g=new Map,n.h=0,n.i&&function Ta(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}function on(n,e){St(n),e=Nr(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function Vs(n,e){return St(n),e=Nr(n,e),n.g.has(e)}function mc(n,e,t){on(n,e),0<t.length&&(n.i=null,n.g.set(Nr(n,e),ea(t)),n.h+=t.length)}function Nr(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function qs(n){this.l=n||ka,n=W.PerformanceNavigationTiming?0<(n=W.performance.getEntriesByType("navigation")).length&&("hq"==n[0].nextHopProtocol||"h2"==n[0].nextHopProtocol):!!(W.g&&W.g.Ga&&W.g.Ga()&&W.g.Ga().$b),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}(Z=Us.prototype).add=function(n,e){St(this),this.i=null,n=Nr(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this},Z.forEach=function(n,e){St(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)},Z.oa=function(){St(this);const n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){const i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t},Z.W=function(n){St(this);let e=[];if("string"==typeof n)Vs(this,n)&&(e=e.concat(this.g.get(Nr(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e},Z.set=function(n,e){return St(this),this.i=null,Vs(this,n=Nr(this,n))&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this},Z.get=function(n,e){return n&&0<(n=this.W(n)).length?String(n[0]):e},Z.toString=function(){if(this.i)return this.i;if(!this.g)return"";const n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];const s=encodeURIComponent(String(r)),u=this.W(r);for(r=0;r<u.length;r++){var i=s;""!==u[r]&&(i+="="+encodeURIComponent(String(u[r]))),n.push(i)}}return this.i=n.join("&")};var ka=10;function gc(n){return!!n.h||!!n.g&&n.g.size>=n.j}function ki(n){return n.h?1:n.g?n.g.size:0}function Bs(n,e){return n.h?n.h==e:!!n.g&&n.g.has(e)}function xa(n,e){n.g?n.g.add(e):n.h=e}function yc(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}function _c(n){if(null!=n.h)return n.i.concat(n.h.D);if(null!=n.g&&0!==n.g.size){let e=n.i;for(const t of n.g.values())e=e.concat(t.D);return e}return ea(n.i)}function vc(){}function Zs(){this.g=new vc}function Ip(n,e,t){const r=t||"";try{dc(n,function(i,s){let u=i;ii(i)&&(u=Ts(i)),e.push(r+s+"="+encodeURIComponent(u))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function Gs(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(s){}}function xi(n){this.l=n.ac||null,this.j=n.jb||!1}function un(n,e){ge.call(this),this.D=n,this.u=e,this.m=void 0,this.readyState=Aa,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}qs.prototype.cancel=function(){if(this.i=_c(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const n of this.g.values())n.cancel();this.g.clear()}},vc.prototype.stringify=function(n){return W.JSON.stringify(n,void 0)},vc.prototype.parse=function(n){return W.JSON.parse(n,void 0)},te(xi,yi),xi.prototype.g=function(){return new un(this.l,this.j)},xi.prototype.i=function(n){return function(){return n}}({}),te(un,ge);var Aa=0;function ke(n){n.j.read().then(n.Ta.bind(n)).catch(n.ga.bind(n))}function Ai(n){n.readyState=4,n.l=null,n.j=null,n.A=null,Bn(n)}function Bn(n){n.onreadystatechange&&n.onreadystatechange.call(n)}(Z=un.prototype).open=function(n,e){if(this.readyState!=Aa)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,Bn(this)},Z.send=function(n){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.D||W).fetch(new Request(this.B,e)).then(this.Wa.bind(this),this.ga.bind(this))},Z.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ai(this)),this.readyState=Aa},Z.Wa=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,Bn(this)),this.g&&(this.readyState=3,Bn(this),this.g)))if("arraybuffer"===this.responseType)n.arrayBuffer().then(this.Ua.bind(this),this.ga.bind(this));else if(void 0!==W.ReadableStream&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;ke(this)}else n.text().then(this.Va.bind(this),this.ga.bind(this))},Z.Ta=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?Ai(this):Bn(this),3==this.readyState&&ke(this)}},Z.Va=function(n){this.g&&(this.response=this.responseText=n,Ai(this))},Z.Ua=function(n){this.g&&(this.response=n,Ai(this))},Z.ga=function(){this.g&&Ai(this)},Z.setRequestHeader=function(n,e){this.v.append(n,e)},Z.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""},Z.getAllResponseHeaders=function(){if(!this.h)return"";const n=[],e=this.h.entries();for(var t=e.next();!t.done;)n.push((t=t.value)[0]+": "+t[1]),t=e.next();return n.join("\r\n")},Object.defineProperty(un.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(n){this.m=n?"include":"same-origin"}});var wh=W.JSON.parse;function fe(n){ge.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Ic,this.K=this.L=!1}te(fe,ge);var Ic="",bh=/^https?$/i,wc=["POST","PUT"];function Si(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,Sa(n),Zn(n)}function Sa(n){n.D||(n.D=!0,qe(n,"complete"),qe(n,"error"))}function Or(n){if(n.h&&void 0!==On&&(!n.C[1]||4!=It(n)||2!=n.aa()))if(n.v&&4==It(n))xr(n.Ha,0,n);else if(qe(n,"readystatechange"),4==It(n)){n.h=!1;try{const h=n.aa();e:switch(h){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=0===h){var i=String(n.H).match(Ea)[1]||null;if(!i&&W.self&&W.self.location){var s=W.self.location.protocol;i=s.substr(0,s.length-1)}r=!bh.test(i?i.toLowerCase():"")}t=r}if(t)qe(n,"complete"),qe(n,"success");else{n.m=6;try{var u=2<It(n)?n.g.statusText:""}catch(f){u=""}n.j=u+" ["+n.aa()+"]",Sa(n)}}finally{Zn(n)}}}function Zn(n,e){if(n.g){bc(n);const t=n.g,r=n.C[0]?ri:null;n.g=null,n.C=null,e||qe(n,"ready");try{t.onreadystatechange=r}catch(i){}}}function bc(n){n.g&&n.K&&(n.g.ontimeout=null),n.A&&(W.clearTimeout(n.A),n.A=null)}function It(n){return n.g?n.g.readyState:0}function Ca(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.J){case Ic:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch(e){return null}}function $s(n){let e="";return ua(n,function(t,r){e+=r,e+=":",e+=t,e+="\r\n"}),e}function Da(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=$s(t),"string"==typeof n?null!=t&&encodeURIComponent(String(t)):de(n,e,t))}function Gn(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function Ra(n){this.Ca=0,this.i=[],this.j=new Ar,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.ab=this.U=0,this.Za=Gn("failFast",!1,n),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Xa=Gn("baseRetryDelayMs",5e3,n),this.bb=Gn("retryDelaySeedMs",1e4,n),this.$a=Gn("forwardChannelMaxRetries",2,n),this.ta=Gn("forwardChannelRequestTimeoutMs",2e4,n),this.ra=n&&n.xmlHttpFactory||void 0,this.Da=n&&n.Zb||!1,this.J=void 0,this.H=n&&n.supportsCrossDomainXhr||!1,this.I="",this.h=new qs(n&&n.concurrentRequestLimit),this.Fa=new Zs,this.O=n&&n.fastHandshake||!1,this.N=n&&n.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Ya=n&&n.Xb||!1,n&&n.Aa&&this.j.Aa(),n&&n.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&n&&n.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Na(n){if(Th(n),3==n.G){var e=n.U++,t=et(n.F);de(t,"SID",n.I),de(t,"RID",e),de(t,"TYPE","terminate"),Ci(n,t),(e=new wi(n,n.j,e,void 0)).K=2,e.v=Ls(et(t)),t=!1,W.navigator&&W.navigator.sendBeacon&&(t=W.navigator.sendBeacon(e.v.toString(),"")),!t&&W.Image&&((new Image).src=e.v,t=!0),t||(e.g=Sc(e.l,null),e.g.da(e.v)),e.F=Date.now(),Vn(e)}Ac(n)}function js(n){n.g&&(Ks(n),n.g.cancel(),n.g=null)}function Th(n){js(n),n.u&&(W.clearTimeout(n.u),n.u=null),Hs(n),n.h.cancel(),n.m&&("number"==typeof n.m&&W.clearTimeout(n.m),n.m=null)}function Yt(n){gc(n.h)||n.m||(n.m=!0,ks(n.Ja,n),n.C=0)}function Ec(n,e){var t;t=e?e.m:n.U++;const r=et(n.F);de(r,"SID",n.I),de(r,"RID",t),de(r,"AID",n.T),Ci(n,r),n.o&&n.s&&Da(r,n.o,n.s),t=new wi(n,n.j,t,n.C+1),null===n.o&&(t.H=n.s),e&&(n.i=e.D.concat(n.i)),e=zs(n,t,1e3),t.setTimeout(Math.round(.5*n.ta)+Math.round(.5*n.ta*Math.random())),xa(n.h,t),Ia(t,r,e)}function Ci(n,e){n.ia&&ua(n.ia,function(t,r){de(e,r,t)}),n.l&&dc({},function(t,r){de(e,r,t)})}function zs(n,e,t){t=Math.min(n.i.length,t);var r=n.l?$e(n.l.Ra,n.l,n):null;e:{var i=n.i;let s=-1;for(;;){const u=["count="+t];-1==s?0<t?(s=i[0].h,u.push("ofs="+s)):s=0:u.push("ofs="+s);let h=!0;for(let f=0;f<t;f++){let m=i[f].h;const g=i[f].g;if(m-=s,0>m)s=Math.max(0,i[f].h-100),h=!1;else try{Ip(g,u,"req"+m+"_")}catch(_){r&&r(g)}}if(h){r=u.join("&");break e}}}return n=n.i.splice(0,t),e.D=n,r}function Tc(n){n.g||n.u||(n.Z=1,ks(n.Ia,n),n.A=0)}function Ws(n){return!(n.g||n.u||3<=n.A||(n.Z++,n.u=gi($e(n.Ia,n),xc(n,n.A)),n.A++,0))}function Ks(n){null!=n.B&&(W.clearTimeout(n.B),n.B=null)}function kc(n){n.g=new wi(n,n.j,"rpc",n.Z),null===n.o&&(n.g.H=n.s),n.g.N=0;var e=et(n.sa);de(e,"RID","rpc"),de(e,"SID",n.I),de(e,"CI",n.L?"0":"1"),de(e,"AID",n.T),de(e,"TYPE","xmlhttp"),Ci(n,e),n.o&&n.s&&Da(e,n.o,n.s),n.J&&n.g.setTimeout(n.J);var t=n.g;n=n.ka,t.K=1,t.v=Ls(et(e)),t.s=null,t.P=!0,Os(t,n)}function Hs(n){null!=n.v&&(W.clearTimeout(n.v),n.v=null)}function Di(n,e){var t=null;if(n.g==e){Hs(n),Ks(n),n.g=null;var r=2}else{if(!Bs(n.h,e))return;t=e.D,yc(n.h,e),r=1}if(0!=n.G)if(n.pa=e.Y,e.i)if(1==r){t=e.s?e.s.length:0,e=Date.now()-e.F;var i=n.C;qe(r=Sr(),new Cs(r,t)),Yt(n)}else Tc(n);else if(3==(i=e.o)||0==i&&0<n.pa||!(1==r&&function kh(n,e){return!(ki(n.h)>=n.h.j-(n.m?1:0)||(n.m?(n.i=e.D.concat(n.i),0):1==n.G||2==n.G||n.C>=(n.Za?0:n.$a)||(n.m=gi($e(n.Ja,n,e),xc(n,n.C)),n.C++,0)))}(n,e)||2==r&&Ws(n)))switch(t&&0<t.length&&(e=n.h,e.i=e.i.concat(t)),i){case 1:$n(n,5);break;case 4:$n(n,10);break;case 3:$n(n,6);break;default:$n(n,2)}}function xc(n,e){let t=n.Xa+Math.floor(Math.random()*n.bb);return n.l||(t*=2),t*e}function $n(n,e){if(n.j.info("Error code "+e),2==e){var t=null;n.l&&(t=null);var r=$e(n.kb,n);t||(t=new qn("//www.google.com/images/cleardot.gif"),W.location&&"http"==W.location.protocol||Ei(t,"https"),Ls(t)),function an(n,e){const t=new Ar;if(W.Image){const r=new Image;r.onload=ls(Gs,t,r,"TestLoadImage: loaded",!0,e),r.onerror=ls(Gs,t,r,"TestLoadImage: error",!1,e),r.onabort=ls(Gs,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=ls(Gs,t,r,"TestLoadImage: timeout",!1,e),W.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}(t.toString(),r)}else Qe(2);n.G=0,n.l&&n.l.va(e),Ac(n),Th(n)}function Ac(n){if(n.G=0,n.la=[],n.l){const e=_c(n.h);(0!=e.length||0!=n.i.length)&&(ta(n.la,e),ta(n.la,n.i),n.h.i.length=0,ea(n.i),n.i.length=0),n.l.ua()}}function Qs(n,e,t){var r=t instanceof qn?et(t):new qn(t,void 0);if(""!=r.g)e&&(r.g=e+"."+r.g),Ps(r,r.m);else{var i=W.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new qn(null,void 0);r&&Ei(s,r),e&&(s.g=e),i&&Ps(s,i),t&&(s.l=t),r=s}return e=n.za,(t=n.D)&&e&&de(r,t,e),de(r,"VER",n.ma),Ci(n,r),r}function Sc(n,e,t){if(e&&!n.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new fe(t&&n.Da&&!n.ra?new xi({jb:!0}):n.ra)).Ka(n.H),e}function Cc(){}function Ys(){if(Wt&&!(10<=Number(ci)))throw Error("Environmental error: no available transport.")}function ut(n,e){ge.call(this),this.g=new Ra(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(n?n["X-WebChannel-Client-Profile"]=e.ya:n={"X-WebChannel-Client-Profile":e.ya}),this.g.S=n,(n=e&&e.Yb)&&!si(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!si(e)&&(this.g.D=e,null!==(n=this.h)&&e in n&&e in(n=this.h)&&delete n[e]),this.j=new Mr(this)}function Dc(n){vi.call(this);var e=n.__sm__;if(e){e:{for(const t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=null!==e&&n in e?e[n]:void 0),this.data=e}else this.data=n}function Oa(){_a.call(this),this.status=1}function Mr(n){this.g=n}(Z=fe.prototype).Ka=function(n){this.L=n},Z.da=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+n);e=e?e.toUpperCase():"GET",this.H=n,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():Ii.g(),this.C=function ya(n){return n.h||(n.h=n.i())}(this.u?this.u:Ii),this.g.onreadystatechange=$e(this.Ha,this);try{this.F=!0,this.g.open(e,String(n),!0),this.F=!1}catch(s){return void Si(this,s)}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const s of r.keys())t.set(s,r.get(s))}r=Array.from(t.keys()).find(s=>"content-type"==s.toLowerCase()),i=W.FormData&&n instanceof W.FormData,!(0<=Xo(wc,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,u]of t)this.g.setRequestHeader(s,u);this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{bc(this),0<this.B&&((this.K=function Eh(n){return Wt&&function sa(){return function ch(n){var e=hh;return Object.prototype.hasOwnProperty.call(e,9)?e[9]:e[9]=n(9)}(function(){let n=0;const e=hs(String(gs)).split("."),t=hs("9").split("."),r=Math.max(e.length,t.length);for(let u=0;0==n&&u<r;u++){var i=e[u]||"",s=t[u]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==i[0].length&&0==s[0].length)break;n=ds(0==i[1].length?0:parseInt(i[1],10),0==s[1].length?0:parseInt(s[1],10))||ds(0==i[2].length,0==s[2].length)||ds(i[2],s[2]),i=i[3],s=s[3]}while(0==n)}return 0<=n})}()&&"number"==typeof n.timeout&&void 0!==n.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=$e(this.qa,this)):this.A=xr(this.qa,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){Si(this,s)}},Z.qa=function(){void 0!==On&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,qe(this,"timeout"),this.abort(8))},Z.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,qe(this,"complete"),qe(this,"abort"),Zn(this))},Z.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Zn(this,!0)),fe.X.M.call(this)},Z.Ha=function(){this.s||(this.F||this.v||this.l?Or(this):this.fb())},Z.fb=function(){Or(this)},Z.aa=function(){try{return 2<It(this)?this.g.status:-1}catch(n){return-1}},Z.fa=function(){try{return this.g?this.g.responseText:""}catch(n){return""}},Z.Sa=function(n){if(this.g){var e=this.g.responseText;return n&&0==e.indexOf(n)&&(e=e.substring(n.length)),wh(e)}},Z.Ea=function(){return this.m},Z.Oa=function(){return"string"==typeof this.j?this.j:String(this.j)},(Z=Ra.prototype).ma=8,Z.G=1,Z.Ja=function(n){if(this.m)if(this.m=null,1==this.G){if(!n){this.U=Math.floor(1e5*Math.random()),n=this.U++;const i=new wi(this,this.j,n,void 0);let s=this.s;if(this.S&&(s?(s=_s(s),vs(s,this.S)):s=this.S),null!==this.o||this.N||(i.H=s,s=null),this.O)e:{for(var e=0,t=0;t<this.i.length;t++){var r=this.i[t];if(void 0===(r="__data__"in r.g&&"string"==typeof(r=r.g.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=t;break e}if(4096===e||t===this.i.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=zs(this,i,e),de(t=et(this.F),"RID",n),de(t,"CVER",22),this.D&&de(t,"X-HTTP-Session-Id",this.D),Ci(this,t),s&&(this.N?e="headers="+encodeURIComponent(String($s(s)))+"&"+e:this.o&&Da(t,this.o,s)),xa(this.h,i),this.Ya&&de(t,"TYPE","init"),this.O?(de(t,"$req",e),de(t,"SID","null"),i.Z=!0,Ia(i,t,null)):Ia(i,t,e),this.G=2}}else 3==this.G&&(n?Ec(this,n):0==this.i.length||gc(this.h)||Ec(this))},Z.Ia=function(){if(this.u=null,kc(this),this.$&&!(this.K||null==this.g||0>=this.P)){var n=2*this.P;this.j.info("BP detection timer enabled: "+n),this.B=gi($e(this.eb,this),n)}},Z.eb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,Qe(10),js(this),kc(this))},Z.cb=function(){null!=this.v&&(this.v=null,js(this),Ws(this),Qe(19))},Z.kb=function(n){n?(this.j.info("Successfully pinged google.com"),Qe(2)):(this.j.info("Failed to ping google.com"),Qe(1))},(Z=Cc.prototype).xa=function(){},Z.wa=function(){},Z.va=function(){},Z.ua=function(){},Z.Ra=function(){},Ys.prototype.g=function(n,e){return new ut(n,e)},te(ut,ge),ut.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var n=this.g,e=this.l,t=this.h||void 0;Qe(0),n.V=e,n.ia=t||{},n.L=n.Y,n.F=Qs(n,null,n.V),Yt(n)},ut.prototype.close=function(){Na(this.g)},ut.prototype.u=function(n){var e=this.g;if("string"==typeof n){var t={};t.__data__=n,n=t}else this.v&&((t={}).__data__=Ts(n),n=t);e.i.push(new class{constructor(n,e){this.h=n,this.g=e}}(e.ab++,n)),3==e.G&&Yt(e)},ut.prototype.M=function(){this.g.l=null,delete this.j,Na(this.g),delete this.g,ut.X.M.call(this)},te(Dc,vi),te(Oa,_a),te(Mr,Cc),Mr.prototype.xa=function(){qe(this.g,"a")},Mr.prototype.wa=function(n){qe(this.g,new Dc(n))},Mr.prototype.va=function(n){qe(this.g,new Oa)},Mr.prototype.ua=function(){qe(this.g,"b")},Ys.prototype.createWebChannel=Ys.prototype.g,ut.prototype.send=ut.prototype.u,ut.prototype.open=ut.prototype.m,ut.prototype.close=ut.prototype.close,Cr.NO_ERROR=0,Cr.TIMEOUT=8,Cr.HTTP_ERROR=6,cc.COMPLETE="complete",Ds.EventType=_i,_i.OPEN="a",_i.CLOSE="b",_i.ERROR="c",_i.MESSAGE="d",ge.prototype.listen=ge.prototype.N,fe.prototype.listenOnce=fe.prototype.O,fe.prototype.getLastError=fe.prototype.Oa,fe.prototype.getLastErrorCode=fe.prototype.Ea,fe.prototype.getStatus=fe.prototype.aa,fe.prototype.getResponseJson=fe.prototype.Sa,fe.prototype.getResponseText=fe.prototype.fa,fe.prototype.send=fe.prototype.da,fe.prototype.setWithCredentials=fe.prototype.Ka;var xh=Tt.createWebChannelTransport=function(){return new Ys},Ah=Tt.getStatEventTarget=function(){return Sr()},Ri=Tt.ErrorCode=Cr,Sh=Tt.EventType=cc,Ma=Tt.Event=Ht,Rc=Tt.Stat={sb:0,vb:1,wb:2,Pb:3,Ub:4,Rb:5,Sb:6,Qb:7,Ob:8,Tb:9,PROXY:10,NOPROXY:11,Mb:12,Ib:13,Jb:14,Hb:15,Kb:16,Lb:17,ob:18,nb:19,pb:20},Pa=Tt.FetchXmlHttpFactory=xi,Js=Tt.WebChannel=Ds,La=Tt.XhrIo=fe;const Ni="@firebase/firestore";class xe{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xe.UNAUTHENTICATED=new xe(null),xe.GOOGLE_CREDENTIALS=new xe("google-credentials-uid"),xe.FIRST_PARTY=new xe("first-party-uid"),xe.MOCK_USER=new xe("mock-user");let Pr="9.15.0";const Ct=new $t.Yd("@firebase/firestore");function jn(){return Ct.logLevel}function D(n,...e){if(Ct.logLevel<=$t.in.DEBUG){const t=e.map(Fa);Ct.debug(`Firestore (${Pr}): ${n}`,...t)}}function Ee(n,...e){if(Ct.logLevel<=$t.in.ERROR){const t=e.map(Fa);Ct.error(`Firestore (${Pr}): ${n}`,...t)}}function Wn(n,...e){if(Ct.logLevel<=$t.in.WARN){const t=e.map(Fa);Ct.warn(`Firestore (${Pr}): ${n}`,...t)}}function Fa(n){if("string"==typeof n)return n;try{return JSON.stringify(n)}catch(t){return n}}function F(n="Unexpected state"){const e=`FIRESTORE (${Pr}) INTERNAL ASSERTION FAILED: `+n;throw Ee(e),new Error(e)}function q(n,e){n||F()}function P(n,e){return n}const E={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class A extends ie.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Te{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Nc{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class Ua{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xe.UNAUTHENTICATED))}shutdown(){}}class Va{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Dh{constructor(e){this.t=e,this.currentUser=xe.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){var r=this;let i=this.i;const s=m=>this.i!==i?(i=this.i,t(m)):Promise.resolve();let u=new Te;this.o=()=>{this.i++,this.currentUser=this.u(),u.resolve(),u=new Te,e.enqueueRetryable(()=>s(this.currentUser))};const h=()=>{const m=u;e.enqueueRetryable((0,k.Z)(function*(){yield m.promise,yield s(r.currentUser)}))},f=m=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=m,this.auth.addAuthTokenListener(this.o),h()};this.t.onInit(m=>f(m)),setTimeout(()=>{if(!this.auth){const m=this.t.getImmediate({optional:!0});m?f(m):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),u.resolve(),u=new Te)}},0),h()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.i!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q("string"==typeof r.accessToken),new Nc(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const e=this.auth&&this.auth.getUid();return q(null===e||"string"==typeof e),new xe(e)}}class Oi{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i,this.type="FirstParty",this.user=xe.FIRST_PARTY,this.p=new Map}I(){return this.g?this.g():(q(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}get headers(){this.p.set("X-Goog-AuthUser",this.l);const e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}class Rh{constructor(e,t,r,i){this.h=e,this.l=t,this.m=r,this.g=i}getToken(){return Promise.resolve(new Oi(this.h,this.l,this.m,this.g))}start(e,t){e.enqueueRetryable(()=>t(xe.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Oc{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class qa{constructor(e){this.T=e,this.forceRefresh=!1,this.appCheck=null,this.A=null}start(e,t){const r=s=>{null!=s.error&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);const u=s.token!==this.A;return this.A=s.token,D("FirebaseAppCheckTokenProvider",`Received ${u?"new":"existing"} token.`),u?t(s.token):Promise.resolve()};this.o=s=>{e.enqueueRetryable(()=>r(s))};const i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.o)};this.T.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){const s=this.T.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q("string"==typeof t.token),this.A=t.token,new Oc(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function Ba(n){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),t=new Uint8Array(n);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(t);else for(let r=0;r<n;r++)t[r]=Math.floor(256*Math.random());return t}class Pc{static R(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length;let r="";for(;r.length<20;){const i=Ba(40);for(let s=0;s<i.length;++s)r.length<20&&i[s]<t&&(r+=e.charAt(i[s]%e.length))}return r}}function z(n,e){return n<e?-1:n>e?1:0}function Kn(n,e,t){return n.length===e.length&&n.every((r,i)=>t(r,e[i]))}function Za(n){return n+"\0"}class pe{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new A(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new A(E.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<-62135596800)throw new A(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new A(E.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return pe.fromMillis(Date.now())}static fromDate(e){return pe.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor(1e6*(e-1e3*t));return new pe(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(e){return this.seconds===e.seconds?z(this.nanoseconds,e.nanoseconds):z(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ${constructor(e){this.timestamp=e}static fromTimestamp(e){return new $(e)}static min(){return new $(new pe(0,0))}static max(){return new $(new pe(253402300799,999999999))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class Hn{constructor(e,t,r){void 0===t?t=0:t>e.length&&F(),void 0===r?r=e.length-t:r>e.length-t&&F(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Hn.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Hn?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return this.construct(this.segments,this.offset+(e=void 0===e?1:e),this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let i=0;i<r;i++){const s=e.get(i),u=t.get(i);if(s<u)return-1;if(s>u)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}class ne extends Hn{construct(e,t,r){return new ne(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){const t=[];for(const r of e){if(r.indexOf("//")>=0)throw new A(E.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new ne(t)}static emptyPath(){return new ne([])}}const Nh=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class me extends Hn{construct(e,t,r){return new me(e,t,r)}static isValidIdentifier(e){return Nh.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),me.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new me(["__name__"])}static fromServerFormat(e){const t=[];let r="",i=0;const s=()=>{if(0===r.length)throw new A(E.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""};let u=!1;for(;i<e.length;){const h=e[i];if("\\"===h){if(i+1===e.length)throw new A(E.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[i+1];if("\\"!==f&&"."!==f&&"`"!==f)throw new A(E.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=f,i+=2}else"`"===h?(u=!u,i++):"."!==h||u?(r+=h,i++):(s(),i++)}if(s(),u)throw new A(E.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new me(t)}static emptyPath(){return new me([])}}class O{constructor(e){this.path=e}static fromPath(e){return new O(ne.fromString(e))}static fromName(e){return new O(ne.fromString(e).popFirst(5))}static empty(){return new O(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new O(new ne(e.slice()))}}class Xs{constructor(e,t,r,i){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=i}}function Mi(n){return n.fields.find(e=>2===e.kind)}function Qn(n){return n.fields.filter(e=>2!==e.kind)}Xs.UNKNOWN_ID=-1;class Yn{constructor(e,t){this.fieldPath=e,this.kind=t}}class Lr{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new Lr(0,tt.min())}}function eo(n,e){const t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=$.fromTimestamp(1e9===r?new pe(t+1,0):new pe(t,r));return new tt(i,O.empty(),e)}function Lc(n){return new tt(n.readTime,n.key,-1)}class tt{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new tt($.min(),O.empty(),-1)}static max(){return new tt($.max(),O.empty(),-1)}}function to(n,e){let t=n.readTime.compareTo(e.readTime);return 0!==t?t:(t=O.comparator(n.documentKey,e.documentKey),0!==t?t:z(n.largestBatchId,e.largestBatchId))}const ja="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Fc{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}function Jt(n){return Pi.apply(this,arguments)}function Pi(){return Pi=(0,k.Z)(function*(n){if(n.code!==E.FAILED_PRECONDITION||n.message!==ja)throw n;D("LocalStore","Unexpectedly lost primary lease")}),Pi.apply(this,arguments)}class b{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&F(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new b((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof b?t:b.resolve(t)}catch(t){return b.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):b.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):b.reject(t)}static resolve(e){return new b((t,r)=>{t(e)})}static reject(e){return new b((t,r)=>{r(e)})}static waitFor(e){return new b((t,r)=>{let i=0,s=0,u=!1;e.forEach(h=>{++i,h.next(()=>{++s,u&&s===i&&t()},f=>r(f))}),u=!0,s===i&&t()})}static or(e){let t=b.resolve(!1);for(const r of e)t=t.next(i=>i?b.resolve(i):r());return t}static forEach(e,t){const r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new b((r,i)=>{const s=e.length,u=new Array(s);let h=0;for(let f=0;f<s;f++){const m=f;t(e[m]).next(g=>{u[m]=g,++h,h===s&&r(u)},g=>i(g))}})}static doWhile(e,t){return new b((r,i)=>{const s=()=>{!0===e()?t().next(()=>{s()},i):r()};s()})}}class no{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.P=new Te,this.transaction.oncomplete=()=>{this.P.resolve()},this.transaction.onabort=()=>{t.error?this.P.reject(new Li(e,t.error)):this.P.resolve()},this.transaction.onerror=r=>{const i=Wa(r.target.error);this.P.reject(new Li(e,i))}}static open(e,t,r,i){try{return new no(t,e.transaction(i,r))}catch(s){throw new Li(t,s)}}get v(){return this.P.promise}abort(e){e&&this.P.reject(e),this.aborted||(D("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}V(){const e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}store(e){const t=this.transaction.objectStore(e);return new Uc(t)}}class wt{constructor(e,t,r){this.name=e,this.version=t,this.S=r,12.2===wt.D((0,ie.z$)())&&Ee("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return D("SimpleDb","Removing database:",e),Jn(window.indexedDB.deleteDatabase(e)).toPromise()}static C(){if(!(0,ie.hl)())return!1;if(wt.N())return!0;const e=(0,ie.z$)(),t=wt.D(e),r=0<t&&t<10,i=wt.k(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static N(){var e;return"undefined"!=typeof process&&"YES"===(null===(e=process.env)||void 0===e?void 0:e.O)}static M(e,t){return e.store(t)}static D(e){const t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static k(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}F(e){var t=this;return(0,k.Z)(function*(){return t.db||(D("SimpleDb","Opening database:",t.name),t.db=yield new Promise((r,i)=>{const s=indexedDB.open(t.name,t.version);s.onsuccess=u=>{r(u.target.result)},s.onblocked=()=>{i(new Li(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},s.onerror=u=>{const h=u.target.error;i("VersionError"===h.name?new A(E.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):"InvalidStateError"===h.name?new A(E.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+h):new Li(e,h))},s.onupgradeneeded=u=>{D("SimpleDb",'Database "'+t.name+'" requires upgrade from version:',u.oldVersion),t.S.$(u.target.result,s.transaction,u.oldVersion,t.version).next(()=>{D("SimpleDb","Database upgrade to version "+t.version+" complete")})}})),t.B&&(t.db.onversionchange=r=>t.B(r)),t.db})()}L(e){this.B=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){var s=this;return(0,k.Z)(function*(){const u="readonly"===t;let h=0;for(;;){++h;try{s.db=yield s.F(e);const f=no.open(s.db,e,u?"readonly":"readwrite",r),m=i(f).next(g=>(f.V(),g)).catch(g=>(f.abort(g),b.reject(g))).toPromise();return m.catch(()=>{}),yield f.v,m}catch(f){const m=f,g="FirebaseError"!==m.name&&h<3;if(D("SimpleDb","Transaction failed with error:",m.message,"Retrying:",g),s.close(),!g)return Promise.reject(m)}}})()}close(){this.db&&this.db.close(),this.db=void 0}}class za{constructor(e){this.q=e,this.U=!1,this.K=null}get isDone(){return this.U}get G(){return this.K}set cursor(e){this.q=e}done(){this.U=!0}j(e){this.K=e}delete(){return Jn(this.q.delete())}}class Li extends A{constructor(e,t){super(E.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}}function cn(n){return"IndexedDbTransactionError"===n.name}class Uc{constructor(e){this.store=e}put(e,t){let r;return void 0!==t?(D("SimpleDb","PUT",this.store.name,e,t),r=this.store.put(t,e)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),Jn(r)}add(e){return D("SimpleDb","ADD",this.store.name,e,e),Jn(this.store.add(e))}get(e){return Jn(this.store.get(e)).next(t=>(void 0===t&&(t=null),D("SimpleDb","GET",this.store.name,e,t),t))}delete(e){return D("SimpleDb","DELETE",this.store.name,e),Jn(this.store.delete(e))}count(){return D("SimpleDb","COUNT",this.store.name),Jn(this.store.count())}W(e,t){const r=this.options(e,t);if(r.index||"function"!=typeof this.store.getAll){const i=this.cursor(r),s=[];return this.H(i,(u,h)=>{s.push(h)}).next(()=>s)}{const i=this.store.getAll(r.range);return new b((s,u)=>{i.onerror=h=>{u(h.target.error)},i.onsuccess=h=>{s(h.target.result)}})}}J(e,t){const r=this.store.getAll(e,null===t?void 0:t);return new b((i,s)=>{r.onerror=u=>{s(u.target.error)},r.onsuccess=u=>{i(u.target.result)}})}Y(e,t){D("SimpleDb","DELETE ALL",this.store.name);const r=this.options(e,t);r.X=!1;const i=this.cursor(r);return this.H(i,(s,u,h)=>h.delete())}Z(e,t){let r;t?r=e:(r={},t=e);const i=this.cursor(r);return this.H(i,t)}tt(e){const t=this.cursor({});return new b((r,i)=>{t.onerror=s=>{const u=Wa(s.target.error);i(u)},t.onsuccess=s=>{const u=s.target.result;u?e(u.primaryKey,u.value).next(h=>{h?u.continue():r()}):r()}})}H(e,t){const r=[];return new b((i,s)=>{e.onerror=u=>{s(u.target.error)},e.onsuccess=u=>{const h=u.target.result;if(!h)return void i();const f=new za(h),m=t(h.primaryKey,h.value,f);if(m instanceof b){const g=m.catch(_=>(f.done(),b.reject(_)));r.push(g)}f.isDone?i():null===f.G?h.continue():h.continue(f.G)}}).next(()=>b.waitFor(r))}options(e,t){let r;return void 0!==e&&("string"==typeof e?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){const r=this.store.index(e.index);return e.X?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}function Jn(n){return new b((e,t)=>{n.onsuccess=r=>{e(r.target.result)},n.onerror=r=>{const i=Wa(r.target.error);t(i)}})}let Fi=!1;function Wa(n){const e=wt.D((0,ie.z$)());if(e>=12.2&&e<13){const t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){const r=new A("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return Fi||(Fi=!0,setTimeout(()=>{throw r},0)),r}}return n}class Oh{constructor(e,t){this.asyncQueue=e,this.et=t,this.task=null}start(){this.nt(15e3)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return null!==this.task}nt(e){var t=this;D("IndexBackiller",`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,(0,k.Z)(function*(){t.task=null;try{D("IndexBackiller",`Documents written: ${yield t.et.st()}`)}catch(r){cn(r)?D("IndexBackiller","Ignoring IndexedDB error during index backfill: ",r):yield Jt(r)}yield t.nt(6e4)}))}}class Mh{constructor(e,t){this.localStore=e,this.persistence=t}st(e=50){var t=this;return(0,k.Z)(function*(){return t.persistence.runTransaction("Backfill Indexes","readwrite-primary",r=>t.it(r,e))})()}it(e,t){const r=new Set;let i=t,s=!0;return b.doWhile(()=>!0===s&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(u=>{if(null!==u&&!r.has(u))return D("IndexBackiller",`Processing collection: ${u}`),this.rt(e,u,i).next(h=>{i-=h,r.add(u)});s=!1})).next(()=>t-i)}rt(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{const u=s.changes;return this.localStore.indexManager.updateIndexEntries(e,u).next(()=>this.ot(i,s)).next(h=>(D("IndexBackiller",`Updating offset: ${h}`),this.localStore.indexManager.updateCollectionGroup(e,t,h))).next(()=>u.size)}))}ot(e,t){let r=e;return t.changes.forEach((i,s)=>{const u=Lc(s);to(u,r)>0&&(r=u)}),new tt(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}}let ct=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.ut(i),this.ct=i=>r.writeSequenceNumber(i))}ut(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ct&&this.ct(t),t}}return n.at=-1,n})();class Ph{constructor(e,t,r,i,s,u,h,f){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=u,this.autoDetectLongPolling=h,this.useFetchStreams=f}}class ln{constructor(e,t){this.projectId=e,this.database=t||"(default)"}static empty(){return new ln("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(e){return e instanceof ln&&e.projectId===this.projectId&&e.database===this.database}}function Vc(n){let e=0;for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Xn(n,e){for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function ro(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Ui(n){return null==n}function Vi(n){return 0===n&&1/n==-1/0}function qc(n){return"number"==typeof n&&Number.isInteger(n)&&!Vi(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}class Re{constructor(e){this.binaryString=e}static fromBase64String(e){const t=atob(e);return new Re(t)}static fromUint8Array(e){const t=function(r){let i="";for(let s=0;s<r.length;++s)i+=String.fromCharCode(r[s]);return i}(e);return new Re(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return btoa(this.binaryString)}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return z(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Re.EMPTY_BYTE_STRING=new Re("");const Bc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hn(n){if(q(!!n),"string"==typeof n){let e=0;const t=Bc.exec(n);if(q(!!t),t[1]){let i=t[1];i=(i+"000000000").substr(0,9),e=Number(i)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:we(n.seconds),nanos:we(n.nanos)}}function we(n){return"number"==typeof n?n:"string"==typeof n?Number(n):0}function er(n){return"string"==typeof n?Re.fromBase64String(n):Re.fromUint8Array(n)}function Ka(n){var e,t;return"server_timestamp"===(null===(t=((null===(e=null==n?void 0:n.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===t?void 0:t.stringValue)}function io(n){const e=n.mapValue.fields.__previous_value__;return Ka(e)?io(e):e}function qi(n){const e=hn(n.mapValue.fields.__local_write_time__.timestampValue);return new pe(e.seconds,e.nanos)}const Dt={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},so={nullValue:"NULL_VALUE"};function dn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Ka(n)?4:pn(n)?9007199254740991:10:F()}function Rt(n,e){if(n===e)return!0;const t=dn(n);if(t!==dn(e))return!1;switch(t){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return qi(n).isEqual(qi(e));case 3:return function(r,i){if("string"==typeof r.timestampValue&&"string"==typeof i.timestampValue&&r.timestampValue.length===i.timestampValue.length)return r.timestampValue===i.timestampValue;const s=hn(r.timestampValue),u=hn(i.timestampValue);return s.seconds===u.seconds&&s.nanos===u.nanos}(n,e);case 5:return n.stringValue===e.stringValue;case 6:return i=e,er(n.bytesValue).isEqual(er(i.bytesValue));case 7:return n.referenceValue===e.referenceValue;case 8:return function(r,i){return we(r.geoPointValue.latitude)===we(i.geoPointValue.latitude)&&we(r.geoPointValue.longitude)===we(i.geoPointValue.longitude)}(n,e);case 2:return function(r,i){if("integerValue"in r&&"integerValue"in i)return we(r.integerValue)===we(i.integerValue);if("doubleValue"in r&&"doubleValue"in i){const s=we(r.doubleValue),u=we(i.doubleValue);return s===u?Vi(s)===Vi(u):isNaN(s)&&isNaN(u)}return!1}(n,e);case 9:return Kn(n.arrayValue.values||[],e.arrayValue.values||[],Rt);case 10:return function(r,i){const s=r.mapValue.fields||{},u=i.mapValue.fields||{};if(Vc(s)!==Vc(u))return!1;for(const h in s)if(s.hasOwnProperty(h)&&(void 0===u[h]||!Rt(s[h],u[h])))return!1;return!0}(n,e);default:return F()}var i}function tr(n,e){return void 0!==(n.values||[]).find(t=>Rt(t,e))}function fn(n,e){if(n===e)return 0;const t=dn(n),r=dn(e);if(t!==r)return z(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return z(n.booleanValue,e.booleanValue);case 2:return function(i,s){const u=we(i.integerValue||i.doubleValue),h=we(s.integerValue||s.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1}(n,e);case 3:return Ha(n.timestampValue,e.timestampValue);case 4:return Ha(qi(n),qi(e));case 5:return z(n.stringValue,e.stringValue);case 6:return function(i,s){const u=er(i),h=er(s);return u.compareTo(h)}(n.bytesValue,e.bytesValue);case 7:return function(i,s){const u=i.split("/"),h=s.split("/");for(let f=0;f<u.length&&f<h.length;f++){const m=z(u[f],h[f]);if(0!==m)return m}return z(u.length,h.length)}(n.referenceValue,e.referenceValue);case 8:return function(i,s){const u=z(we(i.latitude),we(s.latitude));return 0!==u?u:z(we(i.longitude),we(s.longitude))}(n.geoPointValue,e.geoPointValue);case 9:return function(i,s){const u=i.values||[],h=s.values||[];for(let f=0;f<u.length&&f<h.length;++f){const m=fn(u[f],h[f]);if(m)return m}return z(u.length,h.length)}(n.arrayValue,e.arrayValue);case 10:return function(i,s){if(i===Dt.mapValue&&s===Dt.mapValue)return 0;if(i===Dt.mapValue)return 1;if(s===Dt.mapValue)return-1;const u=i.fields||{},h=Object.keys(u),f=s.fields||{},m=Object.keys(f);h.sort(),m.sort();for(let g=0;g<h.length&&g<m.length;++g){const _=z(h[g],m[g]);if(0!==_)return _;const w=fn(u[h[g]],f[m[g]]);if(0!==w)return w}return z(h.length,m.length)}(n.mapValue,e.mapValue);default:throw F()}}function Ha(n,e){if("string"==typeof n&&"string"==typeof e&&n.length===e.length)return z(n,e);const t=hn(n),r=hn(e),i=z(t.seconds,r.seconds);return 0!==i?i:z(t.nanos,r.nanos)}function nr(n){return Qa(n)}function Qa(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?function(r){const i=hn(r);return`time(${i.seconds},${i.nanos})`}(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?er(n.bytesValue).toBase64():"referenceValue"in n?O.fromName(n.referenceValue).toString():"geoPointValue"in n?`geo(${(e=n.geoPointValue).latitude},${e.longitude})`:"arrayValue"in n?function(r){let i="[",s=!0;for(const u of r.values||[])s?s=!1:i+=",",i+=Qa(u);return i+"]"}(n.arrayValue):"mapValue"in n?function(r){const i=Object.keys(r.fields||{}).sort();let s="{",u=!0;for(const h of i)u?u=!1:s+=",",s+=`${h}:${Qa(r.fields[h])}`;return s+"}"}(n.mapValue):F();var e}function rr(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function Ya(n){return!!n&&"integerValue"in n}function Bi(n){return!!n&&"arrayValue"in n}function Zc(n){return!!n&&"nullValue"in n}function Ja(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function oo(n){return!!n&&"mapValue"in n}function ao(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&"object"==typeof n.timestampValue)return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){const e={mapValue:{fields:{}}};return Xn(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=ao(r)),e}if(n.arrayValue){const e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=ao(n.arrayValue.values[t]);return e}return Object.assign({},n)}function pn(n){return"__max__"===(((n.mapValue||{}).fields||{}).__type__||{}).stringValue}function Fh(n){return"nullValue"in n?so:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?rr(ln.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:F()}function Uh(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?rr(ln.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Dt:F()}function uo(n,e){const t=fn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function Gc(n,e){const t=fn(n.value,e.value);return 0!==t?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}class Nt{constructor(e,t){this.position=e,this.inclusive=t}}function $c(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){const s=e[i],u=n.position[i];if(r=s.field.isKeyField()?O.comparator(O.fromName(u.referenceValue),t.key):fn(u,t.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function jc(n,e){if(null===n)return null===e;if(null===e||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++)if(!Rt(n.position[t],e.position[t]))return!1;return!0}class co{}class J extends co{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new Vh(e,t,r):"array-contains"===t?new Bh(e,r):"in"===t?new Qc(e,r):"not-in"===t?new fo(e,r):"array-contains-any"===t?new Zh(e,r):new J(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new qh(e,r):new tu(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&this.matchesComparison(fn(t,this.value)):null!==t&&dn(this.value)===dn(t)&&this.matchesComparison(fn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return F()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}getFirstInequalityField(){return this.isInequality()?this.field:null}}class ae extends co{constructor(e,t){super(),this.filters=e,this.op=t,this.ht=null}static create(e,t){return new ae(e,t)}matches(e){return mn(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.ht||(this.ht=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.ht}getFilters(){return Object.assign([],this.filters)}getFirstInequalityField(){const e=this.lt(t=>t.isInequality());return null!==e?e.field:null}lt(e){for(const t of this.getFlattenedFilters())if(e(t))return t;return null}}function mn(n){return"and"===n.op}function Xa(n){return"or"===n.op}function zc(n){return Wc(n)&&mn(n)}function Wc(n){for(const e of n.filters)if(e instanceof ae)return!1;return!0}function Kc(n){if(n instanceof J)return n.field.canonicalString()+n.op.toString()+nr(n.value);{const e=n.filters.map(t=>Kc(t)).join(",");return`${n.op}(${e})`}}function Hc(n,e){return n instanceof J?(t=n,(r=e)instanceof J&&t.op===r.op&&t.field.isEqual(r.field)&&Rt(t.value,r.value)):n instanceof ae?function(t,r){return r instanceof ae&&t.op===r.op&&t.filters.length===r.filters.length&&t.filters.reduce((i,s,u)=>i&&Hc(s,r.filters[u]),!0)}(n,e):void F();var t,r}function eu(n,e){const t=n.filters.concat(e);return ae.create(t,n.op)}function lo(n){return n instanceof J?`${(e=n).field.canonicalString()} ${e.op} ${nr(e.value)}`:n instanceof ae?function(e){return e.op.toString()+" {"+e.getFilters().map(lo).join(" ,")+"}"}(n):"Filter";var e}class Vh extends J{constructor(e,t,r){super(e,t,r),this.key=O.fromName(r.referenceValue)}matches(e){const t=O.comparator(e.key,this.key);return this.matchesComparison(t)}}class qh extends J{constructor(e,t){super(e,"in",t),this.keys=ho(0,t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class tu extends J{constructor(e,t){super(e,"not-in",t),this.keys=ho(0,t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function ho(n,e){var t;return((null===(t=e.arrayValue)||void 0===t?void 0:t.values)||[]).map(r=>O.fromName(r.referenceValue))}class Bh extends J{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Bi(t)&&tr(t.arrayValue,this.value)}}class Qc extends J{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&tr(this.value.arrayValue,t)}}class fo extends J{constructor(e,t){super(e,"not-in",t)}matches(e){if(tr(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&!tr(this.value.arrayValue,t)}}class Zh extends J{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Bi(t)||!t.arrayValue.values)&&t.arrayValue.values.some(r=>tr(this.value.arrayValue,r))}}class Fr{constructor(e,t="asc"){this.field=e,this.dir=t}}function Gh(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}class ye{constructor(e,t){this.comparator=e,this.root=t||Be.EMPTY}insert(e,t){return new ye(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,Be.BLACK,null,null))}remove(e){return new ye(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Be.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const i=this.comparator(e,r.key);if(0===i)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new po(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new po(this.root,e,this.comparator,!1)}getReverseIterator(){return new po(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new po(this.root,e,this.comparator,!0)}}class po{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Be{constructor(e,t,r,i,s){this.key=e,this.value=t,this.color=null!=r?r:Be.RED,this.left=null!=i?i:Be.EMPTY,this.right=null!=s?s:Be.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,i,s){return new Be(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let i=this;const s=r(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,r),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,r)),i.fixUp()}removeMin(){if(this.left.isEmpty())return Be.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return Be.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Be.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Be.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw F();const e=this.left.check();if(e!==this.right.check())throw F();return e+(this.isRed()?0:1)}}Be.EMPTY=null,Be.RED=!0,Be.BLACK=!1,Be.EMPTY=new class{constructor(){this.size=0}get key(){throw F()}get value(){throw F()}get color(){throw F()}get left(){throw F()}get right(){throw F()}copy(n,e,t,r,i){return this}insert(n,e,t){return new Be(n,e)}remove(n,e){return this}isEmpty(){return!0}inorderTraversal(n){return!1}reverseTraversal(n){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ue{constructor(e){this.comparator=e,this.data=new ye(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Yc(this.data.getIterator())}getIteratorFrom(e){return new Yc(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof ue)||this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(0!==this.comparator(i,s))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new ue(this.comparator);return t.data=e,t}}class Yc{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}function Ot(n){return n.hasNext()?n.getNext():void 0}class lt{constructor(e){this.fields=e,e.sort(me.comparator)}static empty(){return new lt([])}unionWith(e){let t=new ue(me.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new lt(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Kn(this.fields,e.fields,(t,r)=>t.isEqual(r))}}class Fe{constructor(e){this.value=e}static empty(){return new Fe({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!oo(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=ao(t)}setAll(e){let t=me.emptyPath(),r={},i=[];e.forEach((u,h)=>{if(!t.isImmediateParentOf(h)){const f=this.getFieldsMap(t);this.applyChanges(f,r,i),r={},i=[],t=h.popLast()}u?r[h.lastSegment()]=ao(u):i.push(h.lastSegment())});const s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){const t=this.field(e.popLast());oo(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Rt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];oo(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Xn(t,(i,s)=>e[i]=s);for(const i of r)delete e[i]}clone(){return new Fe(ao(this.value))}}function Jc(n){const e=[];return Xn(n.fields,(t,r)=>{const i=new me([t]);if(oo(r)){const s=Jc(r.mapValue).fields;if(0===s.length)e.push(i);else for(const u of s)e.push(i.child(u))}else e.push(i)}),new lt(e)}class he{constructor(e,t,r,i,s,u,h){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=u,this.documentState=h}static newInvalidDocument(e){return new he(e,0,$.min(),$.min(),$.min(),Fe.empty(),0)}static newFoundDocument(e,t,r,i){return new he(e,1,t,$.min(),r,i,0)}static newNoDocument(e,t){return new he(e,2,t,$.min(),$.min(),Fe.empty(),0)}static newUnknownDocument(e,t){return new he(e,3,t,$.min(),$.min(),Fe.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual($.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Fe.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Fe.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=$.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof he&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new he(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class $h{constructor(e,t=null,r=[],i=[],s=null,u=null,h=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=u,this.endAt=h,this.ft=null}}function nu(n,e=null,t=[],r=[],i=null,s=null,u=null){return new $h(n,e,t,r,i,s,u)}function gn(n){const e=P(n);if(null===e.ft){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>Kc(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>{return(i=r).field.canonicalString()+i.dir;var i}).join(","),Ui(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>nr(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>nr(r)).join(",")),e.ft=t}return e.ft}function ir(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!Gh(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!Hc(n.filters[t],e.filters[t]))return!1;return n.collectionGroup===e.collectionGroup&&!!n.path.isEqual(e.path)&&!!jc(n.startAt,e.startAt)&&jc(n.endAt,e.endAt)}function Ur(n){return O.isDocumentKey(n.path)&&null===n.collectionGroup&&0===n.filters.length}function Zi(n,e){return n.filters.filter(t=>t instanceof J&&t.field.isEqual(e))}function Xc(n,e,t){let r=so,i=!0;for(const s of Zi(n,e)){let u=so,h=!0;switch(s.op){case"<":case"<=":u=Fh(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,h=!1;break;case"!=":case"not-in":u=so}uo({value:r,inclusive:i},{value:u,inclusive:h})<0&&(r=u,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];uo({value:r,inclusive:i},{value:u,inclusive:t.inclusive})<0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}function mo(n,e,t){let r=Dt,i=!0;for(const s of Zi(n,e)){let u=Dt,h=!0;switch(s.op){case">=":case">":u=Uh(s.value),h=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,h=!1;break;case"!=":case"not-in":u=Dt}Gc({value:r,inclusive:i},{value:u,inclusive:h})>0&&(r=u,i=h)}if(null!==t)for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){const u=t.position[s];Gc({value:r,inclusive:i},{value:u,inclusive:t.inclusive})>0&&(r=u,i=t.inclusive);break}return{value:r,inclusive:i}}class Xt{constructor(e,t=null,r=[],i=[],s=null,u="F",h=null,f=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=u,this.startAt=h,this.endAt=f,this.dt=null,this._t=null}}function nt(n,e,t,r,i,s,u,h){return new Xt(n,e,t,r,i,s,u,h)}function Mt(n){return new Xt(n)}function ru(n){return 0===n.filters.length&&null===n.limit&&null==n.startAt&&null==n.endAt&&(0===n.explicitOrderBy.length||1===n.explicitOrderBy.length&&n.explicitOrderBy[0].field.isKeyField())}function iu(n){return n.explicitOrderBy.length>0?n.explicitOrderBy[0].field:null}function Vr(n){for(const e of n.filters){const t=e.getFirstInequalityField();if(null!==t)return t}return null}function Gi(n){return null!==n.collectionGroup}function sr(n){const e=P(n);if(null===e.dt){e.dt=[];const t=Vr(e),r=iu(e);if(null!==t&&null===r)t.isKeyField()||e.dt.push(new Fr(t)),e.dt.push(new Fr(me.keyField(),"asc"));else{let i=!1;for(const s of e.explicitOrderBy)e.dt.push(s),s.field.isKeyField()&&(i=!0);if(!i){const s=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.dt.push(new Fr(me.keyField(),s))}}}return e.dt}function ze(n){const e=P(n);if(!e._t)if("F"===e.limitType)e._t=nu(e.path,e.collectionGroup,sr(e),e.filters,e.limit,e.startAt,e.endAt);else{const t=[];for(const s of sr(e))t.push(new Fr(s.field,"desc"===s.dir?"asc":"desc"));const r=e.endAt?new Nt(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new Nt(e.startAt.position,e.startAt.inclusive):null;e._t=nu(e.path,e.collectionGroup,t,e.filters,e.limit,r,i)}return e._t}function su(n,e){e.getFirstInequalityField(),Vr(n);const t=n.filters.concat([e]);return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function bt(n,e,t){return new Xt(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function qr(n,e){return ir(ze(n),ze(e))&&n.limitType===e.limitType}function el(n){return`${gn(ze(n))}|lt:${n.limitType}`}function ou(n){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map(r=>lo(r)).join(", ")}]`),Ui(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map(r=>{return`${(i=r).field.canonicalString()} (${i.dir})`;var i}).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>nr(r)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>nr(r)).join(",")),`Target(${t})`}(ze(n))}; limitType=${n.limitType})`}function au(n,e){return e.isFoundDocument()&&function(t,r){const i=r.key.path;return null!==t.collectionGroup?r.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(i):O.isDocumentKey(t.path)?t.path.isEqual(i):t.path.isImmediateParentOf(i)}(n,e)&&function(t,r){for(const i of sr(t))if(!i.field.isKeyField()&&null===r.data.field(i.field))return!1;return!0}(n,e)&&function(t,r){for(const i of t.filters)if(!i.matches(r))return!1;return!0}(n,e)&&(r=e,!((t=n).startAt&&!function(i,s,u){const h=$c(i,s,u);return i.inclusive?h<=0:h<0}(t.startAt,sr(t),r)||t.endAt&&!function(i,s,u){const h=$c(i,s,u);return i.inclusive?h>=0:h>0}(t.endAt,sr(t),r)));var t,r}function uu(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function Ye(n){return(e,t)=>{let r=!1;for(const i of sr(n)){const s=cu(i,e,t);if(0!==s)return s;r=r||i.field.isKeyField()}return 0}}function cu(n,e,t){const r=n.field.isKeyField()?O.comparator(e.key,t.key):function(i,s,u){const h=s.data.field(i),f=u.data.field(i);return null!==h&&null!==f?fn(h,f):F()}(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F()}}function go(n,e){if(n.wt){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Vi(e)?"-0":e}}function tl(n){return{integerValue:""+n}}function Pt(n,e){return qc(e)?tl(e):go(n,e)}class yn{constructor(){this._=void 0}}function nl(n,e,t){return n instanceof _n?function(r,i){const s={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:r.seconds,nanos:r.nanoseconds}}}};return i&&(s.fields.__previous_value__=i),{mapValue:s}}(t,e):n instanceof or?sl(n,e):n instanceof ar?ol(n,e):function(r,i){const s=il(r,i),u=o(s)+o(r.gt);return Ya(s)&&Ya(r.gt)?tl(u):go(r.yt,u)}(n,e)}function rl(n,e,t){return n instanceof or?sl(n,e):n instanceof ar?ol(n,e):t}function il(n,e){return n instanceof c?Ya(t=e)||(r=t)&&"doubleValue"in r?e:{integerValue:0}:null;var r,t}class _n extends yn{}class or extends yn{constructor(e){super(),this.elements=e}}function sl(n,e){const t=a(e);for(const r of n.elements)t.some(i=>Rt(i,r))||t.push(r);return{arrayValue:{values:t}}}class ar extends yn{constructor(e){super(),this.elements=e}}function ol(n,e){let t=a(e);for(const r of n.elements)t=t.filter(i=>!Rt(i,r));return{arrayValue:{values:t}}}class c extends yn{constructor(e,t){super(),this.yt=e,this.gt=t}}function o(n){return we(n.integerValue||n.doubleValue)}function a(n){return Bi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class l{constructor(e,t){this.field=e,this.transform=t}}class y{constructor(e,t){this.version=e,this.transformResults=t}}class v{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new v}static exists(e){return new v(void 0,e)}static updateTime(e){return new v(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function T(n,e){return void 0!==n.updateTime?e.isFoundDocument()&&e.version.isEqual(n.updateTime):void 0===n.exists||n.exists===e.isFoundDocument()}class N{}function U(n,e){if(!n.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return n.isNoDocument()?new vn(n.key,v.none()):new en(n.key,n.data,v.none());{const t=n.data,r=Fe.empty();let i=new ue(me.comparator);for(let s of e.fields)if(!i.has(s)){let u=t.field(s);null===u&&s.length>1&&(s=s.popLast(),u=t.field(s)),null===u?r.delete(s):r.set(s,u),i=i.add(s)}return new Lt(n.key,r,new lt(i.toArray()),v.none())}}function j(n,e,t){n instanceof en?function(r,i,s){const u=r.value.clone(),h=lu(r.fieldTransforms,i,s.transformResults);u.setAll(h),i.convertToFoundDocument(s.version,u).setHasCommittedMutations()}(n,e,t):n instanceof Lt?function(r,i,s){if(!T(r.precondition,i))return void i.convertToUnknownDocument(s.version);const u=lu(r.fieldTransforms,i,s.transformResults),h=i.data;h.setAll(yo(r)),h.setAll(u),i.convertToFoundDocument(s.version,h).setHasCommittedMutations()}(n,e,t):e.convertToNoDocument(t.version).setHasCommittedMutations()}function G(n,e,t,r){return n instanceof en?function(i,s,u,h){if(!T(i.precondition,s))return u;const f=i.value.clone(),m=hu(i.fieldTransforms,h,s);return f.setAll(m),s.convertToFoundDocument(s.version,f).setHasLocalMutations(),null}(n,e,t,r):n instanceof Lt?function(i,s,u,h){if(!T(i.precondition,s))return u;const f=hu(i.fieldTransforms,h,s),m=s.data;return m.setAll(yo(i)),m.setAll(f),s.convertToFoundDocument(s.version,m).setHasLocalMutations(),null===u?null:u.unionWith(i.fieldMask.fields).unionWith(i.fieldTransforms.map(g=>g.field))}(n,e,t,r):(u=t,T(n.precondition,s=e)?(s.convertToNoDocument(s.version).setHasLocalMutations(),null):u);var s,u}function Ne(n,e){let t=null;for(const r of n.fieldTransforms){const i=e.data.field(r.field),s=il(r.transform,i||null);null!=s&&(null===t&&(t=Fe.empty()),t.set(r.field,s))}return t||null}function gt(n,e){return n.type===e.type&&!!n.key.isEqual(e.key)&&!!n.precondition.isEqual(e.precondition)&&(r=e.fieldTransforms,!!(void 0===(t=n.fieldTransforms)&&void 0===r||t&&r&&Kn(t,r,(i,s)=>function p(n,e){return n.field.isEqual(e.field)&&(r=e.transform,(t=n.transform)instanceof or&&r instanceof or||t instanceof ar&&r instanceof ar?Kn(t.elements,r.elements,Rt):t instanceof c&&r instanceof c?Rt(t.gt,r.gt):t instanceof _n&&r instanceof _n);var t,r}(i,s))))&&(0===n.type?n.value.isEqual(e.value):1!==n.type||n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask));var t,r}class en extends N{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class Lt extends N{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function yo(n){const e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){const r=n.data.field(t);e.set(t,r)}}),e}function lu(n,e,t){const r=new Map;q(n.length===t.length);for(let i=0;i<t.length;i++){const s=n[i],u=s.transform,h=e.data.field(s.field);r.set(s.field,rl(u,h,t[i]))}return r}function hu(n,e,t){const r=new Map;for(const i of n){const s=i.transform,u=t.data.field(i.field);r.set(i.field,nl(s,u,e))}return r}class vn extends N{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class _o extends N{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class al{constructor(e){this.count=e}}var be,ee;function ul(n){switch(n){default:return F();case E.CANCELLED:case E.UNKNOWN:case E.DEADLINE_EXCEEDED:case E.RESOURCE_EXHAUSTED:case E.INTERNAL:case E.UNAVAILABLE:case E.UNAUTHENTICATED:return!1;case E.INVALID_ARGUMENT:case E.NOT_FOUND:case E.ALREADY_EXISTS:case E.PERMISSION_DENIED:case E.FAILED_PRECONDITION:case E.ABORTED:case E.OUT_OF_RANGE:case E.UNIMPLEMENTED:case E.DATA_LOSS:return!0}}function vo(n){if(void 0===n)return Ee("GRPC error has no .code"),E.UNKNOWN;switch(n){case be.OK:return E.OK;case be.CANCELLED:return E.CANCELLED;case be.UNKNOWN:return E.UNKNOWN;case be.DEADLINE_EXCEEDED:return E.DEADLINE_EXCEEDED;case be.RESOURCE_EXHAUSTED:return E.RESOURCE_EXHAUSTED;case be.INTERNAL:return E.INTERNAL;case be.UNAVAILABLE:return E.UNAVAILABLE;case be.UNAUTHENTICATED:return E.UNAUTHENTICATED;case be.INVALID_ARGUMENT:return E.INVALID_ARGUMENT;case be.NOT_FOUND:return E.NOT_FOUND;case be.ALREADY_EXISTS:return E.ALREADY_EXISTS;case be.PERMISSION_DENIED:return E.PERMISSION_DENIED;case be.FAILED_PRECONDITION:return E.FAILED_PRECONDITION;case be.ABORTED:return E.ABORTED;case be.OUT_OF_RANGE:return E.OUT_OF_RANGE;case be.UNIMPLEMENTED:return E.UNIMPLEMENTED;case be.DATA_LOSS:return E.DATA_LOSS;default:return F()}}(ee=be||(be={}))[ee.OK=0]="OK",ee[ee.CANCELLED=1]="CANCELLED",ee[ee.UNKNOWN=2]="UNKNOWN",ee[ee.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ee[ee.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ee[ee.NOT_FOUND=5]="NOT_FOUND",ee[ee.ALREADY_EXISTS=6]="ALREADY_EXISTS",ee[ee.PERMISSION_DENIED=7]="PERMISSION_DENIED",ee[ee.UNAUTHENTICATED=16]="UNAUTHENTICATED",ee[ee.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ee[ee.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ee[ee.ABORTED=10]="ABORTED",ee[ee.OUT_OF_RANGE=11]="OUT_OF_RANGE",ee[ee.UNIMPLEMENTED=12]="UNIMPLEMENTED",ee[ee.INTERNAL=13]="INTERNAL",ee[ee.UNAVAILABLE=14]="UNAVAILABLE",ee[ee.DATA_LOSS=15]="DATA_LOSS";class In{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[i,s]of r)if(this.equalsFn(i,e))return s}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),i=this.inner[r];if(void 0===i)return this.inner[r]=[[e,t]],void this.innerSize++;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e))return void(i[s]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return 1===r.length?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Xn(this.inner,(t,r)=>{for(const[i,s]of r)e(i,s)})}isEmpty(){return ro(this.inner)}size(){return this.innerSize}}const $y=new ye(O.comparator);function yt(){return $y}const wp=new ye(O.comparator);function du(...n){let e=wp;for(const t of n)e=e.insert(t.key,t);return e}function bp(n){let e=wp;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function wn(){return fu()}function Ep(){return fu()}function fu(){return new In(n=>n.toString(),(n,e)=>n.isEqual(e))}const jy=new ye(O.comparator),zy=new ue(O.comparator);function H(...n){let e=zy;for(const t of n)e=e.add(t);return e}const Wy=new ue(z);function cl(){return Wy}class pu{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const i=new Map;return i.set(e,mu.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new pu($.min(),i,cl(),yt(),H())}}class mu{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new mu(r,t,H(),H(),H())}}class ll{constructor(e,t,r,i){this.It=e,this.removedTargetIds=t,this.key=r,this.Tt=i}}class Tp{constructor(e,t){this.targetId=e,this.Et=t}}class kp{constructor(e,t,r=Re.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}}class xp{constructor(){this.At=0,this.Rt=Sp(),this.bt=Re.EMPTY_BYTE_STRING,this.Pt=!1,this.vt=!0}get current(){return this.Pt}get resumeToken(){return this.bt}get Vt(){return 0!==this.At}get St(){return this.vt}Dt(e){e.approximateByteSize()>0&&(this.vt=!0,this.bt=e)}Ct(){let e=H(),t=H(),r=H();return this.Rt.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:F()}}),new mu(this.bt,this.Pt,e,t,r)}xt(){this.vt=!1,this.Rt=Sp()}Nt(e,t){this.vt=!0,this.Rt=this.Rt.insert(e,t)}kt(e){this.vt=!0,this.Rt=this.Rt.remove(e)}Ot(){this.At+=1}Mt(){this.At-=1}Ft(){this.vt=!0,this.Pt=!0}}class Ky{constructor(e){this.$t=e,this.Bt=new Map,this.Lt=yt(),this.qt=Ap(),this.Ut=new ue(z)}Kt(e){for(const t of e.It)e.Tt&&e.Tt.isFoundDocument()?this.Gt(t,e.Tt):this.Qt(t,e.key,e.Tt);for(const t of e.removedTargetIds)this.Qt(t,e.key,e.Tt)}jt(e){this.forEachTarget(e,t=>{const r=this.Wt(t);switch(e.state){case 0:this.zt(t)&&r.Dt(e.resumeToken);break;case 1:r.Mt(),r.Vt||r.xt(),r.Dt(e.resumeToken);break;case 2:r.Mt(),r.Vt||this.removeTarget(t);break;case 3:this.zt(t)&&(r.Ft(),r.Dt(e.resumeToken));break;case 4:this.zt(t)&&(this.Ht(t),r.Dt(e.resumeToken));break;default:F()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Bt.forEach((r,i)=>{this.zt(i)&&t(i)})}Jt(e){const t=e.targetId,r=e.Et.count,i=this.Yt(t);if(i){const s=i.target;if(Ur(s))if(0===r){const u=new O(s.path);this.Qt(t,u,he.newNoDocument(u,$.min()))}else q(1===r);else this.Xt(t)!==r&&(this.Ht(t),this.Ut=this.Ut.add(t))}}Zt(e){const t=new Map;this.Bt.forEach((s,u)=>{const h=this.Yt(u);if(h){if(s.current&&Ur(h.target)){const f=new O(h.target.path);null!==this.Lt.get(f)||this.te(u,f)||this.Qt(u,f,he.newNoDocument(f,e))}s.St&&(t.set(u,s.Ct()),s.xt())}});let r=H();this.qt.forEach((s,u)=>{let h=!0;u.forEachWhile(f=>{const m=this.Yt(f);return!m||2===m.purpose||(h=!1,!1)}),h&&(r=r.add(s))}),this.Lt.forEach((s,u)=>u.setReadTime(e));const i=new pu(e,t,this.Ut,this.Lt,r);return this.Lt=yt(),this.qt=Ap(),this.Ut=new ue(z),i}Gt(e,t){if(!this.zt(e))return;const r=this.te(e,t.key)?2:0;this.Wt(e).Nt(t.key,r),this.Lt=this.Lt.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ee(t.key).add(e))}Qt(e,t,r){if(!this.zt(e))return;const i=this.Wt(e);this.te(e,t)?i.Nt(t,1):i.kt(t),this.qt=this.qt.insert(t,this.ee(t).delete(e)),r&&(this.Lt=this.Lt.insert(t,r))}removeTarget(e){this.Bt.delete(e)}Xt(e){const t=this.Wt(e).Ct();return this.$t.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ot(e){this.Wt(e).Ot()}Wt(e){let t=this.Bt.get(e);return t||(t=new xp,this.Bt.set(e,t)),t}ee(e){let t=this.qt.get(e);return t||(t=new ue(z),this.qt=this.qt.insert(e,t)),t}zt(e){const t=null!==this.Yt(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}Yt(e){const t=this.Bt.get(e);return t&&t.Vt?null:this.$t.ne(e)}Ht(e){this.Bt.set(e,new xp),this.$t.getRemoteKeysForTarget(e).forEach(t=>{this.Qt(e,t,null)})}te(e,t){return this.$t.getRemoteKeysForTarget(e).has(t)}}function Ap(){return new ye(O.comparator)}function Sp(){return new ye(O.comparator)}const Hy={asc:"ASCENDING",desc:"DESCENDING"},Qy={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Yy={and:"AND",or:"OR"};class Jy{constructor(e,t){this.databaseId=e,this.wt=t}}function Io(n,e){return n.wt?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cp(n,e){return n.wt?e.toBase64():e.toUint8Array()}function Xy(n,e){return Io(n,e.toTimestamp())}function Oe(n){return q(!!n),$.fromTimestamp(function(e){const t=hn(e);return new pe(t.seconds,t.nanos)}(n))}function jh(n,e){return(t=n,new ne(["projects",t.projectId,"databases",t.database])).child("documents").child(e).canonicalString();var t}function Dp(n){const e=ne.fromString(n);return q(Vp(e)),e}function gu(n,e){return jh(n.databaseId,e.path)}function bn(n,e){const t=Dp(e);if(t.get(1)!==n.databaseId.projectId)throw new A(E.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new A(E.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(Np(t))}function zh(n,e){return jh(n.databaseId,e)}function Rp(n){const e=Dp(n);return 4===e.length?ne.emptyPath():Np(e)}function yu(n){return new ne(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Np(n){return q(n.length>4&&"documents"===n.get(4)),n.popFirst(5)}function Op(n,e,t){return{name:gu(n,e),fields:t.value.mapValue.fields}}function Mp(n,e,t){const r=bn(n,e.name),i=Oe(e.updateTime),s=e.createTime?Oe(e.createTime):$.min(),u=new Fe({mapValue:{fields:e.fields}}),h=he.newFoundDocument(r,i,s,u);return t&&h.setHasCommittedMutations(),t?h.setHasCommittedMutations():h}function _u(n,e){let t;if(e instanceof en)t={update:Op(n,e.key,e.value)};else if(e instanceof vn)t={delete:gu(n,e.key)};else if(e instanceof Lt)t={update:Op(n,e.key,e.data),updateMask:a_(e.fieldMask)};else{if(!(e instanceof _o))return F();t={verify:gu(n,e.key)}}return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>function(i,s){const u=s.transform;if(u instanceof _n)return{fieldPath:s.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof or)return{fieldPath:s.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof ar)return{fieldPath:s.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof c)return{fieldPath:s.field.canonicalString(),increment:u.gt};throw F()}(0,r))),e.precondition.isNone||(t.currentDocument=void 0!==(i=e.precondition).updateTime?{updateTime:Xy(n,i.updateTime)}:void 0!==i.exists?{exists:i.exists}:F()),t;var i}function Wh(n,e){const t=e.currentDocument?void 0!==(i=e.currentDocument).updateTime?v.updateTime(Oe(i.updateTime)):void 0!==i.exists?v.exists(i.exists):v.none():v.none(),r=e.updateTransforms?e.updateTransforms.map(i=>function(s,u){let h=null;"setToServerValue"in u?(q("REQUEST_TIME"===u.setToServerValue),h=new _n):"appendMissingElements"in u?h=new or(u.appendMissingElements.values||[]):"removeAllFromArray"in u?h=new ar(u.removeAllFromArray.values||[]):"increment"in u?h=new c(s,u.increment):F();const f=me.fromServerFormat(u.fieldPath);return new l(f,h)}(n,i)):[];var i;if(e.update){const i=bn(n,e.update.name),s=new Fe({mapValue:{fields:e.update.fields}});if(e.updateMask){const u=new lt((e.updateMask.fieldPaths||[]).map(m=>me.fromServerFormat(m)));return new Lt(i,s,u,t,r)}return new en(i,s,t,r)}if(e.delete){const i=bn(n,e.delete);return new vn(i,t)}if(e.verify){const i=bn(n,e.verify);return new _o(i,t)}return F()}function Pp(n,e){return{documents:[zh(n,e.path)]}}function Kh(n,e){const t={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(t.parent=zh(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=zh(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);const i=function(f){if(0!==f.length)return Up(ae.create(f,"and"))}(e.filters);i&&(t.structuredQuery.where=i);const s=function(f){if(0!==f.length)return f.map(m=>{return{field:wo((g=m).field),direction:i_(g.dir)};var g})}(e.orderBy);s&&(t.structuredQuery.orderBy=s);const u=(m=e.limit,n.wt||Ui(m)?m:{value:m});var m,h,f;return null!==u&&(t.structuredQuery.limit=u),e.startAt&&(t.structuredQuery.startAt={before:(h=e.startAt).inclusive,values:h.position}),e.endAt&&(t.structuredQuery.endAt={before:!(f=e.endAt).inclusive,values:f.position}),t}function Lp(n){let e=Rp(n.parent);const t=n.structuredQuery,r=t.from?t.from.length:0;let i=null;if(r>0){q(1===r);const g=t.from[0];g.allDescendants?i=g.collectionId:e=e.child(g.collectionId)}let s=[];t.where&&(s=function(g){const _=Fp(g);return _ instanceof ae&&zc(_)?_.getFilters():[_]}(t.where));let u=[];t.orderBy&&(u=t.orderBy.map(g=>{return new Fr(bo((_=g).field),function(w){switch(w){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(_.direction));var _}));let h=null;t.limit&&(h=function(g){let _;return _="object"==typeof g?g.value:g,Ui(_)?null:_}(t.limit));let f=null;var g;t.startAt&&(f=new Nt((g=t.startAt).values||[],!!g.before));let m=null;return t.endAt&&(m=function(g){return new Nt(g.values||[],!g.before)}(t.endAt)),nt(e,i,u,s,h,"F",f,m)}function Fp(n){return void 0!==n.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=bo(e.unaryFilter.field);return J.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=bo(e.unaryFilter.field);return J.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=bo(e.unaryFilter.field);return J.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=bo(e.unaryFilter.field);return J.create(s,"!=",{nullValue:"NULL_VALUE"});default:return F()}}(n):void 0!==n.fieldFilter?J.create(bo((e=n).fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return F()}}(e.fieldFilter.op),e.fieldFilter.value):void 0!==n.compositeFilter?function(e){return ae.create(e.compositeFilter.filters.map(t=>Fp(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return F()}}(e.compositeFilter.op))}(n):F();var e}function i_(n){return Hy[n]}function s_(n){return Qy[n]}function o_(n){return Yy[n]}function wo(n){return{fieldPath:n.canonicalString()}}function bo(n){return me.fromServerFormat(n.fieldPath)}function Up(n){return n instanceof J?function(e){if("=="===e.op){if(Ja(e.value))return{unaryFilter:{field:wo(e.field),op:"IS_NAN"}};if(Zc(e.value))return{unaryFilter:{field:wo(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Ja(e.value))return{unaryFilter:{field:wo(e.field),op:"IS_NOT_NAN"}};if(Zc(e.value))return{unaryFilter:{field:wo(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:wo(e.field),op:s_(e.op),value:e.value}}}(n):n instanceof ae?function(e){const t=e.getFilters().map(r=>Up(r));return 1===t.length?t[0]:{compositeFilter:{op:o_(e.op),filters:t}}}(n):F()}function a_(n){const e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Vp(n){return n.length>=4&&"projects"===n.get(0)&&"databases"===n.get(2)}function ht(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=qp(e)),e=u_(n.get(t),e);return qp(e)}function u_(n,e){let t=e;const r=n.length;for(let i=0;i<r;i++){const s=n.charAt(i);switch(s){case"\0":t+="\x01\x10";break;case"\x01":t+="\x01\x11";break;default:t+=s}}return t}function qp(n){return n+"\x01\x01"}function En(n){const e=n.length;if(q(e>=2),2===e)return q("\x01"===n.charAt(0)&&"\x01"===n.charAt(1)),ne.emptyPath();const t=e-2,r=[];let i="";for(let s=0;s<e;){const u=n.indexOf("\x01",s);switch((u<0||u>t)&&F(),n.charAt(u+1)){case"\x01":const h=n.substring(s,u);let f;0===i.length?f=h:(i+=h,f=i,i=""),r.push(f);break;case"\x10":i+=n.substring(s,u),i+="\0";break;case"\x11":i+=n.substring(s,u+1);break;default:F()}s=u+2}return new ne(r)}const Bp=["userId","batchId"];function hl(n,e){return[n,ht(e)]}function Zp(n,e,t){return[n,ht(e),t]}const c_={},l_=["prefixPath","collectionGroup","readTime","documentId"],h_=["prefixPath","collectionGroup","documentId"],d_=["collectionGroup","readTime","prefixPath","documentId"],f_=["canonicalId","targetId"],p_=["targetId","path"],m_=["path","targetId"],g_=["collectionId","parent"],y_=["indexId","uid"],__=["uid","sequenceNumber"],v_=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],I_=["indexId","uid","orderedDocumentKey"],w_=["userId","collectionPath","documentId"],b_=["userId","collectionPath","largestBatchId"],E_=["userId","collectionGroup","largestBatchId"],Gp=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries"],T_=[...Gp,"documentOverlays"],$p=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],jp=$p,k_=[...jp,"indexConfiguration","indexState","indexEntries"];class Hh extends Fc{constructor(e,t){super(),this.se=e,this.currentSequenceNumber=t}}function We(n,e){const t=P(n);return wt.M(t.se,e)}class Qh{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){const s=this.mutations[i];s.key.isEqual(e.key)&&j(s,e,r[i])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=G(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=G(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Ep();return this.mutations.forEach(i=>{const s=e.get(i.key),u=s.overlayedDocument;let h=this.applyToLocalView(u,s.mutatedFields);h=t.has(i.key)?null:h;const f=U(u,h);null!==f&&r.set(i.key,f),u.isValidDocument()||u.convertToNoDocument($.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),H())}isEqual(e){return this.batchId===e.batchId&&Kn(this.mutations,e.mutations,(t,r)=>gt(t,r))&&Kn(this.baseMutations,e.baseMutations,(t,r)=>gt(t,r))}}class Yh{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){q(e.mutations.length===r.length);let i=jy;const s=e.mutations;for(let u=0;u<s.length;u++)i=i.insert(s[u].key,r[u].version);return new Yh(e,t,r,i)}}class Jh{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Br{constructor(e,t,r,i,s=$.min(),u=$.min(),h=Re.EMPTY_BYTE_STRING){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=h}withSequenceNumber(e){return new Br(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}withResumeToken(e,t){return new Br(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e)}withLastLimboFreeSnapshotVersion(e){return new Br(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)}}class zp{constructor(e){this.ie=e}}function Wp(n,e){const t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:dl(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document={name:gu(i=n.ie,(s=e).key),fields:s.data.value.mapValue.fields,updateTime:Io(i,s.version.toTimestamp()),createTime:Io(i,s.createTime.toTimestamp())};else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:$i(e.version)};else{if(!e.isUnknownDocument())return F();r.unknownDocument={path:t.path.toArray(),version:$i(e.version)}}var i,s;return r}function dl(n){const e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function $i(n){const e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function ji(n){const e=new pe(n.seconds,n.nanoseconds);return $.fromTimestamp(e)}function zi(n,e){const t=(e.baseMutations||[]).map(s=>Wh(n.ie,s));for(let s=0;s<e.mutations.length-1;++s){const u=e.mutations[s];s+1<e.mutations.length&&void 0!==e.mutations[s+1].transform&&(u.updateTransforms=e.mutations[s+1].transform.fieldTransforms,e.mutations.splice(s+1,1),++s)}const r=e.mutations.map(s=>Wh(n.ie,s)),i=pe.fromMillis(e.localWriteTimeMs);return new Qh(e.batchId,i,t,r)}function vu(n){const e=ji(n.readTime),t=void 0!==n.lastLimboFreeSnapshotVersion?ji(n.lastLimboFreeSnapshotVersion):$.min();let r;var i;return void 0!==n.query.documents?(q(1===(i=n.query).documents.length),r=ze(Mt(Rp(i.documents[0])))):r=ze(Lp(n.query)),new Br(r,n.targetId,0,n.lastListenSequenceNumber,e,t,Re.fromBase64String(n.resumeToken))}function Kp(n,e){const t=$i(e.snapshotVersion),r=$i(e.lastLimboFreeSnapshotVersion);let i;i=Ur(e.target)?Pp(n.ie,e.target):Kh(n.ie,e.target);const s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:gn(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Xh(n){const e=Lp({parent:n.parent,structuredQuery:n.structuredQuery});return"LAST"===n.limitType?bt(e,e.limit,"L"):e}function ed(n,e){return new Jh(e.largestBatchId,Wh(n.ie,e.overlayMutation))}function Hp(n,e){const t=e.path.lastSegment();return[n,ht(e.path.popLast()),t]}function Qp(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:$i(r.readTime),documentKey:ht(r.documentKey.path),largestBatchId:r.largestBatchId}}class A_{getBundleMetadata(e,t){return Yp(e).get(t).next(r=>{if(r)return{id:(i=r).bundleId,createTime:ji(i.createTime),version:i.version};var i})}saveBundleMetadata(e,t){return Yp(e).put({bundleId:(r=t).id,createTime:$i(Oe(r.createTime)),version:r.version});var r}getNamedQuery(e,t){return Jp(e).get(t).next(r=>{if(r)return{name:(i=r).name,query:Xh(i.bundledQuery),readTime:ji(i.readTime)};var i})}saveNamedQuery(e,t){return Jp(e).put({name:(r=t).name,readTime:$i(Oe(r.readTime)),bundledQuery:r.bundledQuery});var r}}function Yp(n){return We(n,"bundles")}function Jp(n){return We(n,"namedQueries")}class fl{constructor(e,t){this.yt=e,this.userId=t}static re(e,t){return new fl(e,t.uid||"")}getOverlay(e,t){return Iu(e).get(Hp(this.userId,t)).next(r=>r?ed(this.yt,r):null)}getOverlays(e,t){const r=wn();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){const i=[];return r.forEach((s,u)=>{const h=new Jh(t,u);i.push(this.oe(e,h))}),b.waitFor(i)}removeOverlaysForBatchId(e,t,r){const i=new Set;t.forEach(u=>i.add(ht(u.getCollectionPath())));const s=[];return i.forEach(u=>{const h=IDBKeyRange.bound([this.userId,u,r],[this.userId,u,r+1],!1,!0);s.push(Iu(e).Y("collectionPathOverlayIndex",h))}),b.waitFor(s)}getOverlaysForCollection(e,t,r){const i=wn(),s=ht(t),u=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Iu(e).W("collectionPathOverlayIndex",u).next(h=>{for(const f of h){const m=ed(this.yt,f);i.set(m.getKey(),m)}return i})}getOverlaysForCollectionGroup(e,t,r,i){const s=wn();let u;const h=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Iu(e).Z({index:"collectionGroupOverlayIndex",range:h},(f,m,g)=>{const _=ed(this.yt,m);s.size()<i||_.largestBatchId===u?(s.set(_.getKey(),_),u=_.largestBatchId):g.done()}).next(()=>s)}oe(e,t){return Iu(e).put(function(r,i,s){const[u,h,f]=Hp(i,s.mutation.key);return{userId:i,collectionPath:h,documentId:f,collectionGroup:s.mutation.key.getCollectionGroup(),largestBatchId:s.largestBatchId,overlayMutation:_u(r.ie,s.mutation)}}(this.yt,this.userId,t))}}function Iu(n){return We(n,"documentOverlays")}class Wi{constructor(){}ue(e,t){this.ce(e,t),t.ae()}ce(e,t){if("nullValue"in e)this.he(t,5);else if("booleanValue"in e)this.he(t,10),t.le(e.booleanValue?1:0);else if("integerValue"in e)this.he(t,15),t.le(we(e.integerValue));else if("doubleValue"in e){const r=we(e.doubleValue);isNaN(r)?this.he(t,13):(this.he(t,15),Vi(r)?t.le(0):t.le(r))}else if("timestampValue"in e){const r=e.timestampValue;this.he(t,20),"string"==typeof r?t.fe(r):(t.fe(`${r.seconds||""}`),t.le(r.nanos||0))}else if("stringValue"in e)this.de(e.stringValue,t),this._e(t);else if("bytesValue"in e)this.he(t,30),t.we(er(e.bytesValue)),this._e(t);else if("referenceValue"in e)this.me(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.he(t,45),t.le(r.latitude||0),t.le(r.longitude||0)}else"mapValue"in e?pn(e)?this.he(t,Number.MAX_SAFE_INTEGER):(this.ge(e.mapValue,t),this._e(t)):"arrayValue"in e?(this.ye(e.arrayValue,t),this._e(t)):F()}de(e,t){this.he(t,25),this.pe(e,t)}pe(e,t){t.fe(e)}ge(e,t){const r=e.fields||{};this.he(t,55);for(const i of Object.keys(r))this.de(i,t),this.ce(r[i],t)}ye(e,t){const r=e.values||[];this.he(t,50);for(const i of r)this.ce(i,t)}me(e,t){this.he(t,37),O.fromName(e).path.forEach(r=>{this.he(t,60),this.pe(r,t)})}he(e,t){e.le(t)}_e(e){e.le(2)}}function S_(n){if(0===n)return 8;let e=0;return n>>4==0&&(e+=4,n<<=4),n>>6==0&&(e+=2,n<<=2),n>>7==0&&(e+=1),e}function Xp(n){const e=64-function(t){let r=0;for(let i=0;i<8;++i){const s=S_(255&t[i]);if(r+=s,8!==s)break}return r}(n);return Math.ceil(e/8)}Wi.Ie=new Wi;class C_{constructor(){this.buffer=new Uint8Array(1024),this.position=0}Te(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.Ee(r.value),r=t.next();this.Ae()}Re(e){const t=e[Symbol.iterator]();let r=t.next();for(;!r.done;)this.be(r.value),r=t.next();this.Pe()}ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.Ee(r);else if(r<2048)this.Ee(960|r>>>6),this.Ee(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.Ee(480|r>>>12),this.Ee(128|63&r>>>6),this.Ee(128|63&r);else{const i=t.codePointAt(0);this.Ee(240|i>>>18),this.Ee(128|63&i>>>12),this.Ee(128|63&i>>>6),this.Ee(128|63&i)}}this.Ae()}Ve(e){for(const t of e){const r=t.charCodeAt(0);if(r<128)this.be(r);else if(r<2048)this.be(960|r>>>6),this.be(128|63&r);else if(t<"\ud800"||"\udbff"<t)this.be(480|r>>>12),this.be(128|63&r>>>6),this.be(128|63&r);else{const i=t.codePointAt(0);this.be(240|i>>>18),this.be(128|63&i>>>12),this.be(128|63&i>>>6),this.be(128|63&i)}}this.Pe()}Se(e){const t=this.De(e),r=Xp(t);this.Ce(1+r),this.buffer[this.position++]=255&r;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=255&t[i]}xe(e){const t=this.De(e),r=Xp(t);this.Ce(1+r),this.buffer[this.position++]=~(255&r);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(255&t[i])}Ne(){this.ke(255),this.ke(255)}Oe(){this.Me(255),this.Me(255)}reset(){this.position=0}seed(e){this.Ce(e.length),this.buffer.set(e,this.position),this.position+=e.length}Fe(){return this.buffer.slice(0,this.position)}De(e){const t=function(i){const s=new DataView(new ArrayBuffer(8));return s.setFloat64(0,i,!1),new Uint8Array(s.buffer)}(e),r=0!=(128&t[0]);t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}Ee(e){const t=255&e;0===t?(this.ke(0),this.ke(255)):255===t?(this.ke(255),this.ke(0)):this.ke(t)}be(e){const t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(e)}Ae(){this.ke(0),this.ke(1)}Pe(){this.Me(0),this.Me(1)}ke(e){this.Ce(1),this.buffer[this.position++]=e}Me(e){this.Ce(1),this.buffer[this.position++]=~e}Ce(e){const t=e+this.position;if(t<=this.buffer.length)return;let r=2*this.buffer.length;r<t&&(r=t);const i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}}class D_{constructor(e){this.$e=e}we(e){this.$e.Te(e)}fe(e){this.$e.ve(e)}le(e){this.$e.Se(e)}ae(){this.$e.Ne()}}class R_{constructor(e){this.$e=e}we(e){this.$e.Re(e)}fe(e){this.$e.Ve(e)}le(e){this.$e.xe(e)}ae(){this.$e.Oe()}}class wu{constructor(){this.$e=new C_,this.Be=new D_(this.$e),this.Le=new R_(this.$e)}seed(e){this.$e.seed(e)}qe(e){return 0===e?this.Be:this.Le}Fe(){return this.$e.Fe()}reset(){this.$e.reset()}}class Ki{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}Ue(){const e=this.directionalValue.length,t=0===e||255===this.directionalValue[e-1]?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new Ki(this.indexId,this.documentKey,this.arrayValue,r)}}function Zr(n,e){let t=n.indexId-e.indexId;return 0!==t?t:(t=em(n.arrayValue,e.arrayValue),0!==t?t:(t=em(n.directionalValue,e.directionalValue),0!==t?t:O.comparator(n.documentKey,e.documentKey)))}function em(n,e){for(let t=0;t<n.length&&t<e.length;++t){const r=n[t]-e[t];if(0!==r)return r}return n.length-e.length}class N_{constructor(e){this.collectionId=null!=e.collectionGroup?e.collectionGroup:e.path.lastSegment(),this.Ke=e.orderBy,this.Ge=[];for(const t of e.filters){const r=t;r.isInequality()?this.Qe=r:this.Ge.push(r)}}je(e){q(e.collectionGroup===this.collectionId);const t=Mi(e);if(void 0!==t&&!this.We(t))return!1;const r=Qn(e);let i=0,s=0;for(;i<r.length&&this.We(r[i]);++i);if(i===r.length)return!0;if(void 0!==this.Qe){const u=r[i];if(!this.ze(this.Qe,u)||!this.He(this.Ke[s++],u))return!1;++i}for(;i<r.length;++i){const u=r[i];if(s>=this.Ke.length||!this.He(this.Ke[s++],u))return!1}return!0}We(e){for(const t of this.Ge)if(this.ze(t,e))return!0;return!1}ze(e,t){return!(void 0===e||!e.field.isEqual(t.fieldPath))&&2===t.kind==("array-contains"===e.op||"array-contains-any"===e.op)}He(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}function tm(n){var e,t;if(q(n instanceof J||n instanceof ae),n instanceof J){if(n instanceof Qc){const i=(null===(t=null===(e=n.value.arrayValue)||void 0===e?void 0:e.values)||void 0===t?void 0:t.map(s=>J.create(n.field,"==",s)))||[];return ae.create(i,"or")}return n}const r=n.filters.map(i=>tm(i));return ae.create(r,n.op)}function O_(n){if(0===n.getFilters().length)return[];const e=rd(tm(n));return q(nm(e)),td(e)||nd(e)?[e]:e.getFilters()}function td(n){return n instanceof J}function nd(n){return n instanceof ae&&zc(n)}function nm(n){return td(n)||nd(n)||function(e){if(e instanceof ae&&Xa(e)){for(const t of e.getFilters())if(!td(t)&&!nd(t))return!1;return!0}return!1}(n)}function rd(n){if(q(n instanceof J||n instanceof ae),n instanceof J)return n;if(1===n.filters.length)return rd(n.filters[0]);const e=n.filters.map(r=>rd(r));let t=ae.create(e,n.op);return t=pl(t),nm(t)?t:(q(t instanceof ae),q(mn(t)),q(t.filters.length>1),t.filters.reduce((r,i)=>id(r,i)))}function id(n,e){let t;return q(n instanceof J||n instanceof ae),q(e instanceof J||e instanceof ae),t=n instanceof J?e instanceof J?ae.create([n,e],"and"):rm(n,e):e instanceof J?rm(e,n):function(r,i){if(q(r.filters.length>0&&i.filters.length>0),mn(r)&&mn(i))return eu(r,i.getFilters());const s=Xa(r)?r:i,u=Xa(r)?i:r,h=s.filters.map(f=>id(f,u));return ae.create(h,"or")}(n,e),pl(t)}function rm(n,e){if(mn(e))return eu(e,n.getFilters());{const t=e.filters.map(r=>id(n,r));return ae.create(t,"or")}}function pl(n){if(q(n instanceof J||n instanceof ae),n instanceof J)return n;const e=n.getFilters();if(1===e.length)return pl(e[0]);if(Wc(n))return n;const t=e.map(i=>pl(i)),r=[];return t.forEach(i=>{i instanceof J?r.push(i):i instanceof ae&&(i.op===n.op?r.push(...i.filters):r.push(i))}),1===r.length?r[0]:ae.create(r,n.op)}class M_{constructor(){this.Je=new sd}addToCollectionParentIndex(e,t){return this.Je.add(t),b.resolve()}getCollectionParents(e,t){return b.resolve(this.Je.getEntries(t))}addFieldIndex(e,t){return b.resolve()}deleteFieldIndex(e,t){return b.resolve()}getDocumentsMatchingTarget(e,t){return b.resolve(null)}getIndexType(e,t){return b.resolve(0)}getFieldIndexes(e,t){return b.resolve([])}getNextCollectionGroupToUpdate(e){return b.resolve(null)}getMinOffset(e,t){return b.resolve(tt.min())}getMinOffsetFromCollectionGroup(e,t){return b.resolve(tt.min())}updateCollectionGroup(e,t,r){return b.resolve()}updateIndexEntries(e,t){return b.resolve()}}class sd{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ue(ne.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){const t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ue(ne.comparator)).toArray()}}const ml=new Uint8Array(0);class P_{constructor(e,t){this.user=e,this.databaseId=t,this.Ye=new sd,this.Xe=new In(r=>gn(r),(r,i)=>ir(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.Ye.has(t)){const r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.Ye.add(t)});const s={collectionId:r,parent:ht(i)};return im(e).put(s)}return b.resolve()}getCollectionParents(e,t){const r=[],i=IDBKeyRange.bound([t,""],[Za(t),""],!1,!0);return im(e).W(i).next(s=>{for(const u of s){if(u.collectionId!==t)break;r.push(En(u.parent))}return r})}addFieldIndex(e,t){const r=gl(e),i={indexId:(u=t).indexId,collectionGroup:u.collectionGroup,fields:u.fields.map(h=>[h.fieldPath.canonicalString(),h.kind])};var u;delete i.indexId;const s=r.add(i);if(t.indexState){const u=Eu(e);return s.next(h=>{u.put(Qp(h,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}return s.next()}deleteFieldIndex(e,t){const r=gl(e),i=Eu(e),s=bu(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}getDocumentsMatchingTarget(e,t){const r=bu(e);let i=!0;const s=new Map;return b.forEach(this.Ze(t),u=>this.tn(e,u).next(h=>{i&&(i=!!h),s.set(u,h)})).next(()=>{if(i){let u=H();const h=[];return b.forEach(s,(f,m)=>{var g;D("IndexedDbIndexManager",`Using index ${g=f,`id=${g.indexId}|cg=${g.collectionGroup}|f=${g.fields.map(X=>`${X.fieldPath}:${X.kind}`).join(",")}`} to execute ${gn(t)}`);const _=function(X,Q){const K=Mi(Q);if(void 0===K)return null;for(const Y of Zi(X,K.fieldPath))switch(Y.op){case"array-contains-any":return Y.value.arrayValue.values||[];case"array-contains":return[Y.value]}return null}(m,f),w=function(X,Q){const K=new Map;for(const Y of Qn(Q))for(const Ze of Zi(X,Y.fieldPath))switch(Ze.op){case"==":case"in":K.set(Y.fieldPath.canonicalString(),Ze.value);break;case"not-in":case"!=":return K.set(Y.fieldPath.canonicalString(),Ze.value),Array.from(K.values())}return null}(m,f),x=function(X,Q){const K=[];let Y=!0;for(const Ze of Qn(Q)){const Bu=0===Ze.kind?Xc(X,Ze.fieldPath,X.startAt):mo(X,Ze.fieldPath,X.startAt);K.push(Bu.value),Y&&(Y=Bu.inclusive)}return new Nt(K,Y)}(m,f),S=function(X,Q){const K=[];let Y=!0;for(const Ze of Qn(Q)){const Bu=0===Ze.kind?mo(X,Ze.fieldPath,X.endAt):Xc(X,Ze.fieldPath,X.endAt);K.push(Bu.value),Y&&(Y=Bu.inclusive)}return new Nt(K,Y)}(m,f),M=this.en(f,m,x),V=this.en(f,m,S),se=this.nn(f,m,w),le=this.sn(f.indexId,_,M,x.inclusive,V,S.inclusive,se);return b.forEach(le,X=>r.J(X,t.limit).next(Q=>{Q.forEach(K=>{const Y=O.fromSegments(K.documentKey);u.has(Y)||(u=u.add(Y),h.push(Y))})}))}).next(()=>h)}return b.resolve(null)})}Ze(e){let t=this.Xe.get(e);return t||(t=0===e.filters.length?[e]:O_(ae.create(e.filters,"and")).map(r=>nu(e.path,e.collectionGroup,e.orderBy,r.getFilters(),e.limit,e.startAt,e.endAt)),this.Xe.set(e,t),t)}sn(e,t,r,i,s,u,h){const f=(null!=t?t.length:1)*Math.max(r.length,s.length),m=f/(null!=t?t.length:1),g=[];for(let _=0;_<f;++_){const w=t?this.rn(t[_/m]):ml,x=this.on(e,w,r[_%m],i),S=this.un(e,w,s[_%m],u),M=h.map(V=>this.on(e,w,V,!0));g.push(...this.createRange(x,S,M))}return g}on(e,t,r,i){const s=new Ki(e,O.empty(),t,r);return i?s:s.Ue()}un(e,t,r,i){const s=new Ki(e,O.empty(),t,r);return i?s.Ue():s}tn(e,t){const r=new N_(t),i=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let u=null;for(const h of s)r.je(h)&&(!u||h.fields.length>u.fields.length)&&(u=h);return u})}getIndexType(e,t){let r=2;const i=this.Ze(t);return b.forEach(i,s=>this.tn(e,s).next(u=>{u?0!==r&&u.fields.length<function(h){let f=new ue(me.comparator),m=!1;for(const g of h.filters)for(const _ of g.getFlattenedFilters())_.field.isKeyField()||("array-contains"===_.op||"array-contains-any"===_.op?m=!0:f=f.add(_.field));for(const g of h.orderBy)g.field.isKeyField()||(f=f.add(g.field));return f.size+(m?1:0)}(s)&&(r=1):r=0})).next(()=>null!==t.limit&&i.length>1&&2===r?1:r)}cn(e,t){const r=new wu;for(const i of Qn(e)){const s=t.data.field(i.fieldPath);if(null==s)return null;const u=r.qe(i.kind);Wi.Ie.ue(s,u)}return r.Fe()}rn(e){const t=new wu;return Wi.Ie.ue(e,t.qe(0)),t.Fe()}an(e,t){const r=new wu;return Wi.Ie.ue(rr(this.databaseId,t),r.qe(function(i){const s=Qn(i);return 0===s.length?0:s[s.length-1].kind}(e))),r.Fe()}nn(e,t,r){if(null===r)return[];let i=[];i.push(new wu);let s=0;for(const u of Qn(e)){const h=r[s++];for(const f of i)if(this.hn(t,u.fieldPath)&&Bi(h))i=this.ln(i,u,h);else{const m=f.qe(u.kind);Wi.Ie.ue(h,m)}}return this.fn(i)}en(e,t,r){return this.nn(e,t,r.position)}fn(e){const t=[];for(let r=0;r<e.length;++r)t[r]=e[r].Fe();return t}ln(e,t,r){const i=[...e],s=[];for(const u of r.arrayValue.values||[])for(const h of i){const f=new wu;f.seed(h.Fe()),Wi.Ie.ue(u,f.qe(t.kind)),s.push(f)}return s}hn(e,t){return!!e.filters.find(r=>r instanceof J&&r.field.isEqual(t)&&("in"===r.op||"not-in"===r.op))}getFieldIndexes(e,t){const r=gl(e),i=Eu(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next(s=>{const u=[];return b.forEach(s,h=>i.get([h.indexId,this.uid]).next(f=>{u.push(function(m,g){const _=g?new Lr(g.sequenceNumber,new tt(ji(g.readTime),new O(En(g.documentKey)),g.largestBatchId)):Lr.empty(),w=m.fields.map(([x,S])=>new Yn(me.fromServerFormat(x),S));return new Xs(m.indexId,m.collectionGroup,w,_)}(h,f))})).next(()=>u)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>0===t.length?null:(t.sort((r,i)=>{const s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return 0!==s?s:z(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){const i=gl(e),s=Eu(e);return this.dn(e).next(u=>i.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next(h=>b.forEach(h,f=>s.put(Qp(f.indexId,this.user,u,r)))))}updateIndexEntries(e,t){const r=new Map;return b.forEach(t,(i,s)=>{const u=r.get(i.collectionGroup);return(u?b.resolve(u):this.getFieldIndexes(e,i.collectionGroup)).next(h=>(r.set(i.collectionGroup,h),b.forEach(h,f=>this._n(e,i,f).next(m=>{const g=this.wn(s,f);return m.isEqual(g)?b.resolve():this.mn(e,s,f,m,g)}))))})}gn(e,t,r,i){return bu(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.an(r,t.key),documentKey:t.key.path.toArray()})}yn(e,t,r,i){return bu(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.an(r,t.key),t.key.path.toArray()])}_n(e,t,r){const i=bu(e);let s=new ue(Zr);return i.Z({index:"documentKeyIndex",range:IDBKeyRange.only([r.indexId,this.uid,this.an(r,t)])},(u,h)=>{s=s.add(new Ki(r.indexId,t,h.arrayValue,h.directionalValue))}).next(()=>s)}wn(e,t){let r=new ue(Zr);const i=this.cn(t,e);if(null==i)return r;const s=Mi(t);if(null!=s){const u=e.data.field(s.fieldPath);if(Bi(u))for(const h of u.arrayValue.values||[])r=r.add(new Ki(t.indexId,e.key,this.rn(h),i))}else r=r.add(new Ki(t.indexId,e.key,ml,i));return r}mn(e,t,r,i,s){D("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);const u=[];return function(h,f,m,g,_){const w=h.getIterator(),x=f.getIterator();let S=Ot(w),M=Ot(x);for(;S||M;){let V=!1,se=!1;if(S&&M){const le=m(S,M);le<0?se=!0:le>0&&(V=!0)}else null!=S?se=!0:V=!0;V?(g(M),M=Ot(x)):se?(_(S),S=Ot(w)):(S=Ot(w),M=Ot(x))}}(i,s,Zr,h=>{u.push(this.gn(e,t,r,h))},h=>{u.push(this.yn(e,t,r,h))}),b.waitFor(u)}dn(e){let t=1;return Eu(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(r,i,s)=>{s.done(),t=i.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((u,h)=>Zr(u,h)).filter((u,h,f)=>!h||0!==Zr(u,f[h-1]));const i=[];i.push(e);for(const u of r){const h=Zr(u,e),f=Zr(u,t);if(0===h)i[0]=e.Ue();else if(h>0&&f<0)i.push(u),i.push(u.Ue());else if(f>0)break}i.push(t);const s=[];for(let u=0;u<i.length;u+=2){if(this.pn(i[u],i[u+1]))return[];s.push(IDBKeyRange.bound([i[u].indexId,this.uid,i[u].arrayValue,i[u].directionalValue,ml,[]],[i[u+1].indexId,this.uid,i[u+1].arrayValue,i[u+1].directionalValue,ml,[]]))}return s}pn(e,t){return Zr(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(sm)}getMinOffset(e,t){return b.mapArray(this.Ze(t),r=>this.tn(e,r).next(i=>i||F())).next(sm)}}function im(n){return We(n,"collectionParents")}function bu(n){return We(n,"indexEntries")}function gl(n){return We(n,"indexConfiguration")}function Eu(n){return We(n,"indexState")}function sm(n){q(0!==n.length);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){const i=n[r].indexState.offset;to(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new tt(e.readTime,e.documentKey,t)}const om={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0};class _t{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new _t(e,_t.DEFAULT_COLLECTION_PERCENTILE,_t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}function am(n,e,t){const r=n.store("mutations"),i=n.store("documentMutations"),s=[],u=IDBKeyRange.only(t.batchId);let h=0;const f=r.Z({range:u},(g,_,w)=>(h++,w.delete()));s.push(f.next(()=>{q(1===h)}));const m=[];for(const g of t.mutations){const _=Zp(e,g.key.path,t.batchId);s.push(i.delete(_)),m.push(g.key)}return b.waitFor(s).next(()=>m)}function yl(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw F();e=n.noDocument}return JSON.stringify(e).length}_t.DEFAULT_COLLECTION_PERCENTILE=10,_t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,_t.DEFAULT=new _t(41943040,_t.DEFAULT_COLLECTION_PERCENTILE,_t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),_t.DISABLED=new _t(-1,0,0);class _l{constructor(e,t,r,i){this.userId=e,this.yt=t,this.indexManager=r,this.referenceDelegate=i,this.In={}}static re(e,t,r,i){q(""!==e.uid);const s=e.isAuthenticated()?e.uid:"";return new _l(s,t,r,i)}checkEmpty(e){let t=!0;const r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return Gr(e).Z({index:"userMutationsIndex",range:r},(i,s,u)=>{t=!1,u.done()}).next(()=>t)}addMutationBatch(e,t,r,i){const s=Eo(e),u=Gr(e);return u.add({}).next(h=>{q("number"==typeof h);const f=new Qh(h,t,r,i),m=function(w,x,S){const M=S.baseMutations.map(se=>_u(w.ie,se)),V=S.mutations.map(se=>_u(w.ie,se));return{userId:x,batchId:S.batchId,localWriteTimeMs:S.localWriteTime.toMillis(),baseMutations:M,mutations:V}}(this.yt,this.userId,f),g=[];let _=new ue((w,x)=>z(w.canonicalString(),x.canonicalString()));for(const w of i){const x=Zp(this.userId,w.key.path,h);_=_.add(w.key.path.popLast()),g.push(u.put(m)),g.push(s.put(x,c_))}return _.forEach(w=>{g.push(this.indexManager.addToCollectionParentIndex(e,w))}),e.addOnCommittedListener(()=>{this.In[h]=f.keys()}),b.waitFor(g).next(()=>f)})}lookupMutationBatch(e,t){return Gr(e).get(t).next(r=>r?(q(r.userId===this.userId),zi(this.yt,r)):null)}Tn(e,t){return this.In[t]?b.resolve(this.In[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){const i=r.keys();return this.In[t]=i,i}return null})}getNextMutationBatchAfterBatchId(e,t){const r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]);let s=null;return Gr(e).Z({index:"userMutationsIndex",range:i},(u,h,f)=>{h.userId===this.userId&&(q(h.batchId>=r),s=zi(this.yt,h)),f.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){const t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]);let r=-1;return Gr(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(i,s,u)=>{r=s.batchId,u.done()}).next(()=>r)}getAllMutationBatches(e){const t=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return Gr(e).W("userMutationsIndex",t).next(r=>r.map(i=>zi(this.yt,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){const r=hl(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return Eo(e).Z({range:i},(u,h,f)=>{const[m,g,_]=u,w=En(g);if(m===this.userId&&t.path.isEqual(w))return Gr(e).get(_).next(x=>{if(!x)throw F();q(x.userId===this.userId),s.push(zi(this.yt,x))});f.done()}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(z);const i=[];return t.forEach(s=>{const u=hl(this.userId,s.path),h=IDBKeyRange.lowerBound(u),f=Eo(e).Z({range:h},(m,g,_)=>{const[w,x,S]=m,M=En(x);w===this.userId&&s.path.isEqual(M)?r=r.add(S):_.done()});i.push(f)}),b.waitFor(i).next(()=>this.En(e,r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1,s=hl(this.userId,r),u=IDBKeyRange.lowerBound(s);let h=new ue(z);return Eo(e).Z({range:u},(f,m,g)=>{const[_,w,x]=f,S=En(w);_===this.userId&&r.isPrefixOf(S)?S.length===i&&(h=h.add(x)):g.done()}).next(()=>this.En(e,h))}En(e,t){const r=[],i=[];return t.forEach(s=>{i.push(Gr(e).get(s).next(u=>{if(null===u)throw F();q(u.userId===this.userId),r.push(zi(this.yt,u))}))}),b.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return am(e.se,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.An(t.batchId)}),b.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}An(e){delete this.In[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return b.resolve();const r=IDBKeyRange.lowerBound([this.userId]),i=[];return Eo(e).Z({range:r},(s,u,h)=>{if(s[0]===this.userId){const f=En(s[1]);i.push(f)}else h.done()}).next(()=>{q(0===i.length)})})}containsKey(e,t){return um(e,this.userId,t)}Rn(e){return cm(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""})}}function um(n,e,t){const r=hl(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r);let u=!1;return Eo(n).Z({range:s,X:!0},(h,f,m)=>{const[g,_,w]=h;g===e&&_===i&&(u=!0),m.done()}).next(()=>u)}function Gr(n){return We(n,"mutations")}function Eo(n){return We(n,"documentMutations")}function cm(n){return We(n,"mutationQueues")}class Hi{constructor(e){this.bn=e}next(){return this.bn+=2,this.bn}static Pn(){return new Hi(0)}static vn(){return new Hi(-1)}}class L_{constructor(e,t){this.referenceDelegate=e,this.yt=t}allocateTargetId(e){return this.Vn(e).next(t=>{const r=new Hi(t.highestTargetId);return t.highestTargetId=r.next(),this.Sn(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.Vn(e).next(t=>$.fromTimestamp(new pe(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.Vn(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.Vn(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.Sn(e,i)))}addTargetData(e,t){return this.Dn(e,t).next(()=>this.Vn(e).next(r=>(r.targetCount+=1,this.Cn(t,r),this.Sn(e,r))))}updateTargetData(e,t){return this.Dn(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>To(e).delete(t.targetId)).next(()=>this.Vn(e)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.Sn(e,r)))}removeTargets(e,t,r){let i=0;const s=[];return To(e).Z((u,h)=>{const f=vu(h);f.sequenceNumber<=t&&null===r.get(f.targetId)&&(i++,s.push(this.removeTargetData(e,f)))}).next(()=>b.waitFor(s)).next(()=>i)}forEachTarget(e,t){return To(e).Z((r,i)=>{const s=vu(i);t(s)})}Vn(e){return lm(e).get("targetGlobalKey").next(t=>(q(null!==t),t))}Sn(e,t){return lm(e).put("targetGlobalKey",t)}Dn(e,t){return To(e).put(Kp(this.yt,t))}Cn(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.Vn(e).next(t=>t.targetCount)}getTargetData(e,t){const r=gn(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]);let s=null;return To(e).Z({range:i,index:"queryTargetsIndex"},(u,h,f)=>{const m=vu(h);ir(t,m.target)&&(s=m,f.done())}).next(()=>s)}addMatchingKeys(e,t,r){const i=[],s=$r(e);return t.forEach(u=>{const h=ht(u.path);i.push(s.put({targetId:r,path:h})),i.push(this.referenceDelegate.addReference(e,r,u))}),b.waitFor(i)}removeMatchingKeys(e,t,r){const i=$r(e);return b.forEach(t,s=>{const u=ht(s.path);return b.waitFor([i.delete([r,u]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){const r=$r(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){const r=IDBKeyRange.bound([t],[t+1],!1,!0),i=$r(e);let s=H();return i.Z({range:r,X:!0},(u,h,f)=>{const m=En(u[1]),g=new O(m);s=s.add(g)}).next(()=>s)}containsKey(e,t){const r=ht(t.path),i=IDBKeyRange.bound([r],[Za(r)],!1,!0);let s=0;return $r(e).Z({index:"documentTargetsIndex",X:!0,range:i},([u,h],f,m)=>{0!==u&&(s++,m.done())}).next(()=>s>0)}ne(e,t){return To(e).get(t).next(r=>r?vu(r):null)}}function To(n){return We(n,"targets")}function lm(n){return We(n,"targetGlobal")}function $r(n){return We(n,"targetDocuments")}function hm([n,e],[t,r]){const i=z(n,t);return 0===i?z(e,r):i}class F_{constructor(e){this.xn=e,this.buffer=new ue(hm),this.Nn=0}kn(){return++this.Nn}On(e){const t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{const r=this.buffer.last();hm(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}}class U_{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Mn=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}stop(){this.Mn&&(this.Mn.cancel(),this.Mn=null)}get started(){return null!==this.Mn}Fn(e){var t=this;D("LruGarbageCollector",`Garbage collection scheduled in ${e}ms`),this.Mn=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(0,k.Z)(function*(){t.Mn=null;try{yield t.localStore.collectGarbage(t.garbageCollector)}catch(r){cn(r)?D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",r):yield Jt(r)}yield t.Fn(3e5)}))}}class V_{constructor(e,t){this.$n=e,this.params=t}calculateTargetCount(e,t){return this.$n.Bn(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(0===t)return b.resolve(ct.at);const r=new F_(t);return this.$n.forEachTarget(e,i=>r.On(i.sequenceNumber)).next(()=>this.$n.Ln(e,i=>r.On(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.$n.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.$n.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),b.resolve(om)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),om):this.qn(e,t))}getCacheSize(e){return this.$n.getCacheSize(e)}qn(e,t){let r,i,s,u,h,f,m;const g=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(_=>(_>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${_}`),i=this.params.maximumSequenceNumbersToCollect):i=_,u=Date.now(),this.nthSequenceNumber(e,i))).next(_=>(r=_,h=Date.now(),this.removeTargets(e,r,t))).next(_=>(s=_,f=Date.now(),this.removeOrphanedDocuments(e,r))).next(_=>(m=Date.now(),jn()<=$t.in.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${u-g}ms\n\tDetermined least recently used ${i} in `+(h-u)+`ms\n\tRemoved ${s} targets in `+(f-h)+`ms\n\tRemoved ${_} documents in `+(m-f)+`ms\nTotal Duration: ${m-g}ms`),b.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:_})))}}class q_{constructor(e,t){this.db=e,this.garbageCollector=new V_(this,t)}Bn(e){const t=this.Un(e);return this.db.getTargetCache().getTargetCount(e).next(r=>t.next(i=>r+i))}Un(e){let t=0;return this.Ln(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}Ln(e,t){return this.Kn(e,(r,i)=>t(i))}addReference(e,t,r){return vl(e,r)}removeReference(e,t,r){return vl(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return vl(e,t)}Gn(e,t){return function(r,i){let s=!1;return cm(r).tt(u=>um(r,u,i).next(h=>(h&&(s=!0),b.resolve(!h)))).next(()=>s)}(e,t)}removeOrphanedDocuments(e,t){const r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[];let s=0;return this.Kn(e,(u,h)=>{if(h<=t){const f=this.Gn(e,u).next(m=>{if(!m)return s++,r.getEntry(e,u).next(()=>(r.removeEntry(u,$.min()),$r(e).delete([0,ht(u.path)])))});i.push(f)}}).next(()=>b.waitFor(i)).next(()=>r.apply(e)).next(()=>s)}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return vl(e,t)}Kn(e,t){const r=$r(e);let i,s=ct.at;return r.Z({index:"documentTargetsIndex"},([u,h],{path:f,sequenceNumber:m})=>{0===u?(s!==ct.at&&t(new O(En(i)),s),s=m,i=f):s=ct.at}).next(()=>{s!==ct.at&&t(new O(En(i)),s)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}}function vl(n,e){return $r(n).put((r=n.currentSequenceNumber,{targetId:0,path:ht(e.path),sequenceNumber:r}));var r}class dm{constructor(){this.changes=new In(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,he.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?b.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class B_{constructor(e){this.yt=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return Qi(e).put(r)}removeEntry(e,t,r){return Qi(e).delete(function(i,s){const u=i.path.toArray();return[u.slice(0,u.length-2),u[u.length-2],dl(s),u[u.length-1]]}(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.Qn(e,r)))}getEntry(e,t){let r=he.newInvalidDocument(t);return Qi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Tu(t))},(i,s)=>{r=this.jn(t,s)}).next(()=>r)}Wn(e,t){let r={size:0,document:he.newInvalidDocument(t)};return Qi(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(Tu(t))},(i,s)=>{r={document:this.jn(t,s),size:yl(s)}}).next(()=>r)}getEntries(e,t){let r=yt();return this.zn(e,t,(i,s)=>{const u=this.jn(i,s);r=r.insert(i,u)}).next(()=>r)}Hn(e,t){let r=yt(),i=new ye(O.comparator);return this.zn(e,t,(s,u)=>{const h=this.jn(s,u);r=r.insert(s,h),i=i.insert(s,yl(u))}).next(()=>({documents:r,Jn:i}))}zn(e,t,r){if(t.isEmpty())return b.resolve();let i=new ue(gm);t.forEach(f=>i=i.add(f));const s=IDBKeyRange.bound(Tu(i.first()),Tu(i.last())),u=i.getIterator();let h=u.getNext();return Qi(e).Z({index:"documentKeyIndex",range:s},(f,m,g)=>{const _=O.fromSegments([...m.prefixPath,m.collectionGroup,m.documentId]);for(;h&&gm(h,_)<0;)r(h,null),h=u.getNext();h&&h.isEqual(_)&&(r(h,m),h=u.hasNext()?u.getNext():null),h?g.j(Tu(h)):g.done()}).next(()=>{for(;h;)r(h,null),h=u.hasNext()?u.getNext():null})}getAllFromCollection(e,t,r){const i=[t.popLast().toArray(),t.lastSegment(),dl(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],s=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Qi(e).W(IDBKeyRange.bound(i,s,!0)).next(u=>{let h=yt();for(const f of u){const m=this.jn(O.fromSegments(f.prefixPath.concat(f.collectionGroup,f.documentId)),f);h=h.insert(m.key,m)}return h})}getAllFromCollectionGroup(e,t,r,i){let s=yt();const u=mm(t,r),h=mm(t,tt.max());return Qi(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(u,h,!0)},(f,m,g)=>{const _=this.jn(O.fromSegments(m.prefixPath.concat(m.collectionGroup,m.documentId)),m);s=s.insert(_.key,_),s.size===i&&g.done()}).next(()=>s)}newChangeBuffer(e){return new Z_(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return pm(e).get("remoteDocumentGlobalKey").next(t=>(q(!!t),t))}Qn(e,t){return pm(e).put("remoteDocumentGlobalKey",t)}jn(e,t){if(t){const r=function x_(n,e){let t;if(e.document)t=Mp(n.ie,e.document,!!e.hasCommittedMutations);else if(e.noDocument){const r=O.fromSegments(e.noDocument.path),i=ji(e.noDocument.readTime);t=he.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else{if(!e.unknownDocument)return F();{const r=O.fromSegments(e.unknownDocument.path),i=ji(e.unknownDocument.version);t=he.newUnknownDocument(r,i)}}return e.readTime&&t.setReadTime(function(r){const i=new pe(r[0],r[1]);return $.fromTimestamp(i)}(e.readTime)),t}(this.yt,t);if(!r.isNoDocument()||!r.version.isEqual($.min()))return r}return he.newInvalidDocument(e)}}function fm(n){return new B_(n)}class Z_ extends dm{constructor(e,t){super(),this.Yn=e,this.trackRemovals=t,this.Xn=new In(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){const t=[];let r=0,i=new ue((s,u)=>z(s.canonicalString(),u.canonicalString()));return this.changes.forEach((s,u)=>{const h=this.Xn.get(s);if(t.push(this.Yn.removeEntry(e,s,h.readTime)),u.isValidDocument()){const f=Wp(this.Yn.yt,u);i=i.add(s.path.popLast()),r+=yl(f)-h.size,t.push(this.Yn.addEntry(e,s,f))}else if(r-=h.size,this.trackRemovals){const f=Wp(this.Yn.yt,u.convertToNoDocument($.min()));t.push(this.Yn.addEntry(e,s,f))}}),i.forEach(s=>{t.push(this.Yn.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.Yn.updateMetadata(e,r)),b.waitFor(t)}getFromCache(e,t){return this.Yn.Wn(e,t).next(r=>(this.Xn.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.Yn.Hn(e,t).next(({documents:r,Jn:i})=>(i.forEach((s,u)=>{this.Xn.set(s,{size:u,readTime:r.get(s).readTime})}),r))}}function pm(n){return We(n,"remoteDocumentGlobal")}function Qi(n){return We(n,"remoteDocumentsV14")}function Tu(n){const e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function mm(n,e){const t=e.documentKey.path.toArray();return[n,dl(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function gm(n,e){const t=n.path.toArray(),r=e.path.toArray();let i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=z(t[s],r[s]),i)return i;return i=z(t.length,r.length),i||(i=z(t[t.length-2],r[r.length-2]),i||z(t[t.length-1],r[r.length-1]))}class G_{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class ym{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(null!==r&&G(r.mutation,i,lt.empty(),pe.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,H()).next(()=>r))}getLocalViewOfDocuments(e,t,r=H()){const i=wn();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let u=du();return s.forEach((h,f)=>{u=u.insert(h,f.overlayedDocument)}),u}))}getOverlayedDocuments(e,t){const r=wn();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,H()))}populateOverlays(e,t,r){const i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((u,h)=>{t.set(u,h)})})}computeViews(e,t,r,i){let s=yt();const u=fu(),h=fu();return t.forEach((f,m)=>{const g=r.get(m.key);i.has(m.key)&&(void 0===g||g.mutation instanceof Lt)?s=s.insert(m.key,m):void 0!==g&&(u.set(m.key,g.mutation.getFieldMask()),G(g.mutation,m,g.mutation.getFieldMask(),pe.now()))}),this.recalculateAndSaveOverlays(e,s).next(f=>(f.forEach((m,g)=>u.set(m,g)),t.forEach((m,g)=>{var _;return h.set(m,new G_(g,null!==(_=u.get(m))&&void 0!==_?_:null))}),h))}recalculateAndSaveOverlays(e,t){const r=fu();let i=new ye((u,h)=>u-h),s=H();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(u=>{for(const h of u)h.keys().forEach(f=>{const m=t.get(f);if(null===m)return;let g=r.get(f)||lt.empty();g=h.applyToLocalView(m,g),r.set(f,g);const _=(i.get(h.batchId)||H()).add(f);i=i.insert(h.batchId,_)})}).next(()=>{const u=[],h=i.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),m=f.key,g=f.value,_=Ep();g.forEach(w=>{if(!s.has(w)){const x=U(t.get(w),r.get(w));null!==x&&_.set(w,x),s=s.add(w)}}),u.push(this.documentOverlayCache.saveOverlays(e,m,_))}return b.waitFor(u)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r){return O.isDocumentKey((i=t).path)&&null===i.collectionGroup&&0===i.filters.length?this.getDocumentsMatchingDocumentQuery(e,t.path):Gi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r):this.getDocumentsMatchingCollectionQuery(e,t,r);var i}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{const u=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):b.resolve(wn());let h=-1,f=s;return u.next(m=>b.forEach(m,(g,_)=>(h<_.largestBatchId&&(h=_.largestBatchId),s.get(g)?b.resolve():this.remoteDocumentCache.getEntry(e,g).next(w=>{f=f.insert(g,w)}))).next(()=>this.populateOverlays(e,m,s)).next(()=>this.computeViews(e,f,m,H())).next(g=>({batchId:h,changes:bp(g)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(r=>{let i=du();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r){const i=t.collectionGroup;let s=du();return this.indexManager.getCollectionParents(e,i).next(u=>b.forEach(u,h=>{const f=(m=t,g=h.child(i),new Xt(g,null,m.explicitOrderBy.slice(),m.filters.slice(),m.limit,m.limitType,m.startAt,m.endAt));var m,g;return this.getDocumentsMatchingCollectionQuery(e,f,r).next(m=>{m.forEach((g,_)=>{s=s.insert(g,_)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r){let i;return this.remoteDocumentCache.getAllFromCollection(e,t.path,r).next(s=>(i=s,this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId))).next(s=>{s.forEach((h,f)=>{const m=f.getKey();null===i.get(m)&&(i=i.insert(m,he.newInvalidDocument(m)))});let u=du();return i.forEach((h,f)=>{const m=s.get(h);void 0!==m&&G(m.mutation,f,lt.empty(),pe.now()),au(t,f)&&(u=u.insert(h,f))}),u})}}class $_{constructor(e){this.yt=e,this.Zn=new Map,this.ts=new Map}getBundleMetadata(e,t){return b.resolve(this.Zn.get(t))}saveBundleMetadata(e,t){var r;return this.Zn.set(t.id,{id:(r=t).id,version:r.version,createTime:Oe(r.createTime)}),b.resolve()}getNamedQuery(e,t){return b.resolve(this.ts.get(t))}saveNamedQuery(e,t){return this.ts.set(t.name,{name:(r=t).name,query:Xh(r.bundledQuery),readTime:Oe(r.readTime)}),b.resolve();var r}}class j_{constructor(){this.overlays=new ye(O.comparator),this.es=new Map}getOverlay(e,t){return b.resolve(this.overlays.get(t))}getOverlays(e,t){const r=wn();return b.forEach(t,i=>this.getOverlay(e,i).next(s=>{null!==s&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.oe(e,t,s)}),b.resolve()}removeOverlaysForBatchId(e,t,r){const i=this.es.get(r);return void 0!==i&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.es.delete(r)),b.resolve()}getOverlaysForCollection(e,t,r){const i=wn(),s=t.length+1,u=new O(t.child("")),h=this.overlays.getIteratorFrom(u);for(;h.hasNext();){const f=h.getNext().value,m=f.getKey();if(!t.isPrefixOf(m.path))break;m.path.length===s&&f.largestBatchId>r&&i.set(f.getKey(),f)}return b.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new ye((m,g)=>m-g);const u=this.overlays.getIterator();for(;u.hasNext();){const m=u.getNext().value;if(m.getKey().getCollectionGroup()===t&&m.largestBatchId>r){let g=s.get(m.largestBatchId);null===g&&(g=wn(),s=s.insert(m.largestBatchId,g)),g.set(m.getKey(),m)}}const h=wn(),f=s.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach((m,g)=>h.set(m,g)),!(h.size()>=i)););return b.resolve(h)}oe(e,t,r){const i=this.overlays.get(r.key);if(null!==i){const u=this.es.get(i.largestBatchId).delete(r.key);this.es.set(i.largestBatchId,u)}this.overlays=this.overlays.insert(r.key,new Jh(t,r));let s=this.es.get(t);void 0===s&&(s=H(),this.es.set(t,s)),this.es.set(t,s.add(r.key))}}class od{constructor(){this.ns=new ue(Ke.ss),this.rs=new ue(Ke.os)}isEmpty(){return this.ns.isEmpty()}addReference(e,t){const r=new Ke(e,t);this.ns=this.ns.add(r),this.rs=this.rs.add(r)}us(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.cs(new Ke(e,t))}hs(e,t){e.forEach(r=>this.removeReference(r,t))}ls(e){const t=new O(new ne([])),r=new Ke(t,e),i=new Ke(t,e+1),s=[];return this.rs.forEachInRange([r,i],u=>{this.cs(u),s.push(u.key)}),s}fs(){this.ns.forEach(e=>this.cs(e))}cs(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}ds(e){const t=new O(new ne([])),r=new Ke(t,e),i=new Ke(t,e+1);let s=H();return this.rs.forEachInRange([r,i],u=>{s=s.add(u.key)}),s}containsKey(e){const t=new Ke(e,0),r=this.ns.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class Ke{constructor(e,t){this.key=e,this._s=t}static ss(e,t){return O.comparator(e.key,t.key)||z(e._s,t._s)}static os(e,t){return z(e._s,t._s)||O.comparator(e.key,t.key)}}class z_{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.ws=1,this.gs=new ue(Ke.ss)}checkEmpty(e){return b.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,i){const s=this.ws;this.ws++;const u=new Qh(s,t,r,i);this.mutationQueue.push(u);for(const h of i)this.gs=this.gs.add(new Ke(h.key,s)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return b.resolve(u)}lookupMutationBatch(e,t){return b.resolve(this.ys(t))}getNextMutationBatchAfterBatchId(e,t){const i=this.ps(t+1),s=i<0?0:i;return b.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return b.resolve(0===this.mutationQueue.length?-1:this.ws-1)}getAllMutationBatches(e){return b.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new Ke(t,0),i=new Ke(t,Number.POSITIVE_INFINITY),s=[];return this.gs.forEachInRange([r,i],u=>{const h=this.ys(u._s);s.push(h)}),b.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ue(z);return t.forEach(i=>{const s=new Ke(i,0),u=new Ke(i,Number.POSITIVE_INFINITY);this.gs.forEachInRange([s,u],h=>{r=r.add(h._s)})}),b.resolve(this.Is(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,i=r.length+1;let s=r;O.isDocumentKey(s)||(s=s.child(""));const u=new Ke(new O(s),0);let h=new ue(z);return this.gs.forEachWhile(f=>{const m=f.key.path;return!!r.isPrefixOf(m)&&(m.length===i&&(h=h.add(f._s)),!0)},u),b.resolve(this.Is(h))}Is(e){const t=[];return e.forEach(r=>{const i=this.ys(r);null!==i&&t.push(i)}),t}removeMutationBatch(e,t){q(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();let r=this.gs;return b.forEach(t.mutations,i=>{const s=new Ke(i.key,t.batchId);return r=r.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)}).next(()=>{this.gs=r})}An(e){}containsKey(e,t){const r=new Ke(t,0),i=this.gs.firstAfterOrEqual(r);return b.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return b.resolve()}Ts(e,t){return this.ps(e)}ps(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}ys(e){const t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class W_{constructor(e){this.Es=e,this.docs=new ye(O.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,i=this.docs.get(r),s=i?i.size:0,u=this.Es(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:u}),this.size+=u-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return b.resolve(r?r.document.mutableCopy():he.newInvalidDocument(t))}getEntries(e,t){let r=yt();return t.forEach(i=>{const s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():he.newInvalidDocument(i))}),b.resolve(r)}getAllFromCollection(e,t,r){let i=yt();const s=new O(t.child("")),u=this.docs.getIteratorFrom(s);for(;u.hasNext();){const{key:h,value:{document:f}}=u.getNext();if(!t.isPrefixOf(h.path))break;h.path.length>t.length+1||to(Lc(f),r)<=0||(i=i.insert(f.key,f.mutableCopy()))}return b.resolve(i)}getAllFromCollectionGroup(e,t,r,i){F()}As(e,t){return b.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new K_(this)}getSize(e){return b.resolve(this.size)}}class K_ extends dm{constructor(e){super(),this.Yn=e}applyChanges(e){const t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.Yn.addEntry(e,i)):this.Yn.removeEntry(r)}),b.waitFor(t)}getFromCache(e,t){return this.Yn.getEntry(e,t)}getAllFromCache(e,t){return this.Yn.getEntries(e,t)}}class H_{constructor(e){this.persistence=e,this.Rs=new In(t=>gn(t),ir),this.lastRemoteSnapshotVersion=$.min(),this.highestTargetId=0,this.bs=0,this.Ps=new od,this.targetCount=0,this.vs=Hi.Pn()}forEachTarget(e,t){return this.Rs.forEach((r,i)=>t(i)),b.resolve()}getLastRemoteSnapshotVersion(e){return b.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return b.resolve(this.bs)}allocateTargetId(e){return this.highestTargetId=this.vs.next(),b.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.bs&&(this.bs=t),b.resolve()}Dn(e){this.Rs.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.vs=new Hi(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}addTargetData(e,t){return this.Dn(t),this.targetCount+=1,b.resolve()}updateTargetData(e,t){return this.Dn(t),b.resolve()}removeTargetData(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,b.resolve()}removeTargets(e,t,r){let i=0;const s=[];return this.Rs.forEach((u,h)=>{h.sequenceNumber<=t&&null===r.get(h.targetId)&&(this.Rs.delete(u),s.push(this.removeMatchingKeysForTargetId(e,h.targetId)),i++)}),b.waitFor(s).next(()=>i)}getTargetCount(e){return b.resolve(this.targetCount)}getTargetData(e,t){const r=this.Rs.get(t)||null;return b.resolve(r)}addMatchingKeys(e,t,r){return this.Ps.us(t,r),b.resolve()}removeMatchingKeys(e,t,r){this.Ps.hs(t,r);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(u=>{s.push(i.markPotentiallyOrphaned(e,u))}),b.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.Ps.ls(t),b.resolve()}getMatchingKeysForTargetId(e,t){const r=this.Ps.ds(t);return b.resolve(r)}containsKey(e,t){return b.resolve(this.Ps.containsKey(t))}}class _m{constructor(e,t){this.Vs={},this.overlays={},this.Ss=new ct(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=e(this),this.Cs=new H_(this),this.indexManager=new M_,this.remoteDocumentCache=new W_(r=>this.referenceDelegate.xs(r)),this.yt=new zp(t),this.Ns=new $_(this.yt)}start(){return Promise.resolve()}shutdown(){return this.Ds=!1,Promise.resolve()}get started(){return this.Ds}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new j_,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.Vs[e.toKey()];return r||(r=new z_(t,this.referenceDelegate),this.Vs[e.toKey()]=r),r}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ns}runTransaction(e,t,r){D("MemoryPersistence","Starting transaction:",e);const i=new Q_(this.Ss.next());return this.referenceDelegate.ks(),r(i).next(s=>this.referenceDelegate.Os(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}Ms(e,t){return b.or(Object.values(this.Vs).map(r=>()=>r.containsKey(e,t)))}}class Q_ extends Fc{constructor(e){super(),this.currentSequenceNumber=e}}class Il{constructor(e){this.persistence=e,this.Fs=new od,this.$s=null}static Bs(e){return new Il(e)}get Ls(){if(this.$s)return this.$s;throw F()}addReference(e,t,r){return this.Fs.addReference(r,t),this.Ls.delete(r.toString()),b.resolve()}removeReference(e,t,r){return this.Fs.removeReference(r,t),this.Ls.add(r.toString()),b.resolve()}markPotentiallyOrphaned(e,t){return this.Ls.add(t.toString()),b.resolve()}removeTarget(e,t){this.Fs.ls(t.targetId).forEach(i=>this.Ls.add(i.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(i=>{i.forEach(s=>this.Ls.add(s.toString()))}).next(()=>r.removeTargetData(e,t))}ks(){this.$s=new Set}Os(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return b.forEach(this.Ls,r=>{const i=O.fromPath(r);return this.qs(e,i).next(s=>{s||t.removeEntry(i,$.min())})}).next(()=>(this.$s=null,t.apply(e)))}updateLimboDocument(e,t){return this.qs(e,t).next(r=>{r?this.Ls.delete(t.toString()):this.Ls.add(t.toString())})}xs(e){return 0}qs(e,t){return b.or([()=>b.resolve(this.Fs.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ms(e,t)])}}class Y_{constructor(e){this.yt=e}$(e,t,r,i){const s=new no("createOrUpgrade",t);var h;r<1&&i>=1&&(e.createObjectStore("owner"),(h=e).createObjectStore("mutationQueues",{keyPath:"userId"}),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Bp,{unique:!0}),h.createObjectStore("documentMutations"),vm(e),function(h){h.createObjectStore("remoteDocuments")}(e));let u=b.resolve();return r<3&&i>=3&&(0!==r&&(function(h){h.deleteObjectStore("targetDocuments"),h.deleteObjectStore("targets"),h.deleteObjectStore("targetGlobal")}(e),vm(e)),u=u.next(()=>function(h){const f=h.store("targetGlobal"),m={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:$.min().toTimestamp(),targetCount:0};return f.put("targetGlobalKey",m)}(s))),r<4&&i>=4&&(0!==r&&(u=u.next(()=>function(h,f){return f.store("mutations").W().next(m=>{h.deleteObjectStore("mutations"),h.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",Bp,{unique:!0});const g=f.store("mutations"),_=m.map(w=>g.put(w));return b.waitFor(_)})}(e,s))),u=u.next(()=>{!function(h){h.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)})),r<5&&i>=5&&(u=u.next(()=>this.Us(s))),r<6&&i>=6&&(u=u.next(()=>(function(h){h.createObjectStore("remoteDocumentGlobal")}(e),this.Ks(s)))),r<7&&i>=7&&(u=u.next(()=>this.Gs(s))),r<8&&i>=8&&(u=u.next(()=>this.Qs(e,s))),r<9&&i>=9&&(u=u.next(()=>{!function(h){h.objectStoreNames.contains("remoteDocumentChanges")&&h.deleteObjectStore("remoteDocumentChanges")}(e)})),r<10&&i>=10&&(u=u.next(()=>this.js(s))),r<11&&i>=11&&(u=u.next(()=>{(function(h){h.createObjectStore("bundles",{keyPath:"bundleId"})})(e),function(h){h.createObjectStore("namedQueries",{keyPath:"name"})}(e)})),r<12&&i>=12&&(u=u.next(()=>{!function(h){const f=h.createObjectStore("documentOverlays",{keyPath:w_});f.createIndex("collectionPathOverlayIndex",b_,{unique:!1}),f.createIndex("collectionGroupOverlayIndex",E_,{unique:!1})}(e)})),r<13&&i>=13&&(u=u.next(()=>function(h){const f=h.createObjectStore("remoteDocumentsV14",{keyPath:l_});f.createIndex("documentKeyIndex",h_),f.createIndex("collectionGroupIndex",d_)}(e)).next(()=>this.Ws(e,s)).next(()=>e.deleteObjectStore("remoteDocuments"))),r<14&&i>=14&&(u=u.next(()=>this.zs(e,s))),r<15&&i>=15&&(u=u.next(()=>function(h){h.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),h.createObjectStore("indexState",{keyPath:y_}).createIndex("sequenceNumberIndex",__,{unique:!1}),h.createObjectStore("indexEntries",{keyPath:v_}).createIndex("documentKeyIndex",I_,{unique:!1})}(e))),u}Ks(e){let t=0;return e.store("remoteDocuments").Z((r,i)=>{t+=yl(i)}).next(()=>{const r={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",r)})}Us(e){const t=e.store("mutationQueues"),r=e.store("mutations");return t.W().next(i=>b.forEach(i,s=>{const u=IDBKeyRange.bound([s.userId,-1],[s.userId,s.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",u).next(h=>b.forEach(h,f=>{q(f.userId===s.userId);const m=zi(this.yt,f);return am(e,s.userId,m).next(()=>{})}))}))}Gs(e){const t=e.store("targetDocuments"),r=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next(i=>{const s=[];return r.Z((u,h)=>{const f=new ne(u),m=[0,ht(f)];s.push(t.get(m).next(g=>g?b.resolve():t.put({targetId:0,path:ht(f),sequenceNumber:i.highestListenSequenceNumber})))}).next(()=>b.waitFor(s))})}Qs(e,t){e.createObjectStore("collectionParents",{keyPath:g_});const r=t.store("collectionParents"),i=new sd,s=u=>{if(i.add(u)){const h=u.lastSegment(),f=u.popLast();return r.put({collectionId:h,parent:ht(f)})}};return t.store("remoteDocuments").Z({X:!0},(u,h)=>{const f=new ne(u);return s(f.popLast())}).next(()=>t.store("documentMutations").Z({X:!0},([u,h,f],m)=>{const g=En(h);return s(g.popLast())}))}js(e){const t=e.store("targets");return t.Z((r,i)=>{const s=vu(i),u=Kp(this.yt,s);return t.put(u)})}Ws(e,t){const r=t.store("remoteDocuments"),i=[];return r.Z((s,u)=>{const h=t.store("remoteDocumentsV14"),f=(m=u,m.document?new O(ne.fromString(m.document.name).popFirst(5)):m.noDocument?O.fromSegments(m.noDocument.path):m.unknownDocument?O.fromSegments(m.unknownDocument.path):F()).path.toArray();var m;const g={prefixPath:f.slice(0,f.length-2),collectionGroup:f[f.length-2],documentId:f[f.length-1],readTime:u.readTime||[0,0],unknownDocument:u.unknownDocument,noDocument:u.noDocument,document:u.document,hasCommittedMutations:!!u.hasCommittedMutations};i.push(h.put(g))}).next(()=>b.waitFor(i))}zs(e,t){const r=t.store("mutations"),i=fm(this.yt),s=new _m(Il.Bs,this.yt.ie);return r.W().next(u=>{const h=new Map;return u.forEach(f=>{var m;let g=null!==(m=h.get(f.userId))&&void 0!==m?m:H();zi(this.yt,f).keys().forEach(_=>g=g.add(_)),h.set(f.userId,g)}),b.forEach(h,(f,m)=>{const g=new xe(m),_=fl.re(this.yt,g),w=s.getIndexManager(g),x=_l.re(g,this.yt,w,s.referenceDelegate);return new ym(i,x,_,w).recalculateAndSaveOverlaysForDocumentKeys(new Hh(t,ct.at),f).next()})})}}function vm(n){n.createObjectStore("targetDocuments",{keyPath:p_}).createIndex("documentTargetsIndex",m_,{unique:!0}),n.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",f_,{unique:!0}),n.createObjectStore("targetGlobal")}const ad="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.";class ud{constructor(e,t,r,i,s,u,h,f,m,g,_=15){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.Hs=s,this.window=u,this.document=h,this.Js=m,this.Ys=g,this.Xs=_,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=w=>Promise.resolve(),!ud.C())throw new A(E.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new q_(this,i),this.ii=t+"main",this.yt=new zp(f),this.ri=new wt(this.ii,this.Xs,new Y_(this.yt)),this.Cs=new L_(this.referenceDelegate,this.yt),this.remoteDocumentCache=fm(this.yt),this.Ns=new A_,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===g&&Ee("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.ui().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new A(E.FAILED_PRECONDITION,ad);return this.ci(),this.ai(),this.hi(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.Cs.getHighestSequenceNumber(e))}).then(e=>{this.Ss=new ct(e,this.Js)}).then(()=>{this.Ds=!0}).catch(e=>(this.ri&&this.ri.close(),Promise.reject(e)))}li(e){var t=this;return this.si=function(){var r=(0,k.Z)(function*(i){if(t.started)return e(i)});return function(i){return r.apply(this,arguments)}}(),e(this.isPrimary)}setDatabaseDeletedListener(e){this.ri.L(function(){var t=(0,k.Z)(function*(r){null===r.newVersion&&(yield e())});return function(r){return t.apply(this,arguments)}}())}setNetworkEnabled(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget((0,k.Z)(function*(){t.started&&(yield t.ui())})))}ui(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>wl(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.fi(e).next(t=>{t||(this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)))})}).next(()=>this.di(e)).next(t=>this.isPrimary&&!t?this._i(e).next(()=>!1):!!t&&this.wi(e).next(()=>!0))).catch(e=>{if(cn(e))return D("IndexedDbPersistence","Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.Hs.enqueueRetryable(()=>this.si(e)),this.isPrimary=e})}fi(e){return ku(e).get("owner").next(t=>b.resolve(this.mi(t)))}gi(e){return wl(e).delete(this.clientId)}yi(){var e=this;return(0,k.Z)(function*(){if(e.isPrimary&&!e.pi(e.ni,18e5)){e.ni=Date.now();const t=yield e.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",r=>{const i=We(r,"clientMetadata");return i.W().next(s=>{const u=e.Ii(s,18e5),h=s.filter(f=>-1===u.indexOf(f));return b.forEach(h,f=>i.delete(f.clientId)).next(()=>h)})}).catch(()=>[]);if(e.oi)for(const r of t)e.oi.removeItem(e.Ti(r.clientId))}})()}hi(){this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,()=>this.ui().then(()=>this.yi()).then(()=>this.hi()))}mi(e){return!!e&&e.ownerId===this.clientId}di(e){return this.Ys?b.resolve(!0):ku(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)){if(this.mi(t)&&this.networkEnabled)return!0;if(!this.mi(t)){if(!t.allowTabSynchronization)throw new A(E.FAILED_PRECONDITION,ad);return!1}}return!(!this.networkEnabled||!this.inForeground)||wl(e).W().next(r=>void 0===this.Ii(r,5e3).find(i=>{if(this.clientId!==i.clientId){const u=!this.inForeground&&i.inForeground,h=this.networkEnabled===i.networkEnabled;if(!this.networkEnabled&&i.networkEnabled||u&&h)return!0}return!1}))}).next(t=>(this.isPrimary!==t&&D("IndexedDbPersistence",`Client ${t?"is":"is not"} eligible for a primary lease.`),t))}shutdown(){var e=this;return(0,k.Z)(function*(){e.Ds=!1,e.Ai(),e.ei&&(e.ei.cancel(),e.ei=null),e.Ri(),e.bi(),yield e.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],t=>{const r=new Hh(t,ct.at);return e._i(r).next(()=>e.gi(r))}),e.ri.close(),e.Pi()})()}Ii(e,t){return e.filter(r=>this.pi(r.updateTimeMs,t)&&!this.Ei(r.clientId))}vi(){return this.runTransaction("getActiveClients","readonly",e=>wl(e).W().next(t=>this.Ii(t,18e5).map(r=>r.clientId)))}get started(){return this.Ds}getMutationQueue(e,t){return _l.re(e,this.yt,t,this.referenceDelegate)}getTargetCache(){return this.Cs}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new P_(e,this.yt.ie.databaseId)}getDocumentOverlayCache(e){return fl.re(this.yt,e)}getBundleCache(){return this.Ns}runTransaction(e,t,r){D("IndexedDbPersistence","Starting transaction:",e);const i="readonly"===t?"readonly":"readwrite",s=15===(u=this.Xs)?k_:14===u?jp:13===u?$p:12===u?T_:11===u?Gp:void F();var u;let h;return this.ri.runTransaction(e,i,s,f=>(h=new Hh(f,this.Ss?this.Ss.next():ct.at),"readwrite-primary"===t?this.fi(h).next(m=>!!m||this.di(h)).next(m=>{if(!m)throw Ee(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.Hs.enqueueRetryable(()=>this.si(!1)),new A(E.FAILED_PRECONDITION,ja);return r(h)}).next(m=>this.wi(h).next(()=>m)):this.Vi(h).next(()=>r(h)))).then(f=>(h.raiseOnCommittedEvent(),f))}Vi(e){return ku(e).get("owner").next(t=>{if(null!==t&&this.pi(t.leaseTimestampMs,5e3)&&!this.Ei(t.ownerId)&&!this.mi(t)&&!(this.Ys||this.allowTabSynchronization&&t.allowTabSynchronization))throw new A(E.FAILED_PRECONDITION,ad)})}wi(e){const t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return ku(e).put("owner",t)}static C(){return wt.C()}_i(e){const t=ku(e);return t.get("owner").next(r=>this.mi(r)?(D("IndexedDbPersistence","Releasing primary lease."),t.delete("owner")):b.resolve())}pi(e,t){const r=Date.now();return!(e<r-t||e>r&&(Ee(`Detected an update time that is in the future: ${e} > ${r}`),1))}ci(){null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=()=>{this.Hs.enqueueAndForget(()=>(this.inForeground="visible"===this.document.visibilityState,this.ui()))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}Ri(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}ai(){var e;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=()=>{this.Ai(),(0,ie.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&this.Hs.enterRestrictedMode(!0),this.Hs.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.Zs))}bi(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}Ei(e){var t;try{const r=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return D("IndexedDbPersistence",`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ee("IndexedDbPersistence","Failed to get zombied client id.",r),!1}}Ai(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(e){Ee("Failed to set zombie client id.",e)}}Pi(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(e){}}Ti(e){return`firestore_zombie_${this.persistenceKey}_${e}`}}function ku(n){return We(n,"owner")}function wl(n){return We(n,"clientMetadata")}function cd(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}class ld{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.Si=r,this.Di=i}static Ci(e,t){let r=H(),i=H();for(const s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}return new ld(e,t.fromCache,r,i)}}class Im{constructor(){this.xi=!1}initialize(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}getDocumentsMatchingQuery(e,t,r,i){return this.ki(e,t).next(s=>s||this.Oi(e,t,i,r)).next(s=>s||this.Mi(e,t))}ki(e,t){if(ru(t))return b.resolve(null);let r=ze(t);return this.indexManager.getIndexType(e,r).next(i=>0===i?null:(null!==t.limit&&1===i&&(t=bt(t,null,"F"),r=ze(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{const u=H(...s);return this.Ni.getDocuments(e,u).next(h=>this.indexManager.getMinOffset(e,r).next(f=>{const m=this.Fi(t,h);return this.$i(t,m,u,f.readTime)?this.ki(e,bt(t,null,"F")):this.Bi(e,m,t,f)}))})))}Oi(e,t,r,i){return ru(t)||i.isEqual($.min())?this.Mi(e,t):this.Ni.getDocuments(e,r).next(s=>{const u=this.Fi(t,s);return this.$i(t,u,r,i)?this.Mi(e,t):(jn()<=$t.in.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),ou(t)),this.Bi(e,u,t,eo(i,-1)))})}Fi(e,t){let r=new ue(Ye(e));return t.forEach((i,s)=>{au(e,s)&&(r=r.add(s))}),r}$i(e,t,r,i){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}Mi(e,t){return jn()<=$t.in.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",ou(t)),this.Ni.getDocumentsMatchingQuery(e,t,tt.min())}Bi(e,t,r,i){return this.Ni.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(u=>{s=s.insert(u.key,u)}),s))}}class J_{constructor(e,t,r,i){this.persistence=e,this.Li=t,this.yt=i,this.qi=new ye(z),this.Ui=new In(s=>gn(s),ir),this.Ki=new Map,this.Gi=e.getRemoteDocumentCache(),this.Cs=e.getTargetCache(),this.Ns=e.getBundleCache(),this.Qi(r)}Qi(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new ym(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.qi))}}function wm(n,e,t,r){return new J_(n,e,t,r)}function bm(n,e){return hd.apply(this,arguments)}function hd(){return hd=(0,k.Z)(function*(n,e){const t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",r=>{let i;return t.mutationQueue.getAllMutationBatches(r).next(s=>(i=s,t.Qi(e),t.mutationQueue.getAllMutationBatches(r))).next(s=>{const u=[],h=[];let f=H();for(const m of i){u.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}for(const m of s){h.push(m.batchId);for(const g of m.mutations)f=f.add(g.key)}return t.localDocuments.getDocuments(r,f).next(m=>({ji:m,removedBatchIds:u,addedBatchIds:h}))})})}),hd.apply(this,arguments)}function X_(n,e){const t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{const i=e.batch.keys(),s=t.Gi.newChangeBuffer({trackRemovals:!0});return function(u,h,f,m){const g=f.batch,_=g.keys();let w=b.resolve();return _.forEach(x=>{w=w.next(()=>m.getEntry(h,x)).next(S=>{const M=f.docVersions.get(x);q(null!==M),S.version.compareTo(M)<0&&(g.applyToRemoteDocument(S,f),S.isValidDocument()&&(S.setReadTime(f.commitVersion),m.addEntry(S)))})}),w.next(()=>u.mutationQueue.removeMutationBatch(h,g))}(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,function(u){let h=H();for(let f=0;f<u.mutationResults.length;++f)u.mutationResults[f].transformResults.length>0&&(h=h.add(u.batch.mutations[f].key));return h}(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function Em(n){const e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Cs.getLastRemoteSnapshotVersion(t))}function ev(n,e){const t=P(n),r=e.snapshotVersion;let i=t.qi;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{const u=t.Gi.newChangeBuffer({trackRemovals:!0});i=t.qi;const h=[];e.targetChanges.forEach((g,_)=>{const w=i.get(_);if(!w)return;h.push(t.Cs.removeMatchingKeys(s,g.removedDocuments,_).next(()=>t.Cs.addMatchingKeys(s,g.addedDocuments,_)));let x=w.withSequenceNumber(s.currentSequenceNumber);var S,M,V;e.targetMismatches.has(_)?x=x.withResumeToken(Re.EMPTY_BYTE_STRING,$.min()).withLastLimboFreeSnapshotVersion($.min()):g.resumeToken.approximateByteSize()>0&&(x=x.withResumeToken(g.resumeToken,r)),i=i.insert(_,x),M=x,V=g,(0===(S=w).resumeToken.approximateByteSize()||M.snapshotVersion.toMicroseconds()-S.snapshotVersion.toMicroseconds()>=3e8||V.addedDocuments.size+V.modifiedDocuments.size+V.removedDocuments.size>0)&&h.push(t.Cs.updateTargetData(s,x))});let f=yt(),m=H();if(e.documentUpdates.forEach(g=>{e.resolvedLimboDocuments.has(g)&&h.push(t.persistence.referenceDelegate.updateLimboDocument(s,g))}),h.push(Tm(s,u,e.documentUpdates).next(g=>{f=g.Wi,m=g.zi})),!r.isEqual($.min())){const g=t.Cs.getLastRemoteSnapshotVersion(s).next(_=>t.Cs.setTargetsMetadata(s,s.currentSequenceNumber,r));h.push(g)}return b.waitFor(h).next(()=>u.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,f,m)).next(()=>f)}).then(s=>(t.qi=i,s))}function Tm(n,e,t){let r=H(),i=H();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let u=yt();return t.forEach((h,f)=>{const m=s.get(h);f.isFoundDocument()!==m.isFoundDocument()&&(i=i.add(h)),f.isNoDocument()&&f.version.isEqual($.min())?(e.removeEntry(h,f.readTime),u=u.insert(h,f)):!m.isValidDocument()||f.version.compareTo(m.version)>0||0===f.version.compareTo(m.version)&&m.hasPendingWrites?(e.addEntry(f),u=u.insert(h,f)):D("LocalStore","Ignoring outdated watch update for ",h,". Current version:",m.version," Watch version:",f.version)}),{Wi:u,zi:i}})}function tv(n,e){const t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(void 0===e&&(e=-1),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function ko(n,e){const t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.Cs.getTargetData(r,e).next(s=>s?(i=s,b.resolve(i)):t.Cs.allocateTargetId(r).next(u=>(i=new Br(e,u,0,r.currentSequenceNumber),t.Cs.addTargetData(r,i).next(()=>i))))}).then(r=>{const i=t.qi.get(r.targetId);return(null===i||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.qi=t.qi.insert(r.targetId,r),t.Ui.set(e,r.targetId)),r})}function xo(n,e,t){return dd.apply(this,arguments)}function dd(){return dd=(0,k.Z)(function*(n,e,t){const r=P(n),i=r.qi.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,u=>r.persistence.referenceDelegate.removeTarget(u,i)))}catch(u){if(!cn(u))throw u;D("LocalStore",`Failed to update sequence numbers for target ${e}: ${u}`)}r.qi=r.qi.remove(e),r.Ui.delete(i.target)}),dd.apply(this,arguments)}function bl(n,e,t){const r=P(n);let i=$.min(),s=H();return r.persistence.runTransaction("Execute query","readonly",u=>function(h,f,m){const g=P(h),_=g.Ui.get(m);return void 0!==_?b.resolve(g.qi.get(_)):g.Cs.getTargetData(f,m)}(r,u,ze(e)).next(h=>{if(h)return i=h.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(u,h.targetId).next(f=>{s=f})}).next(()=>r.Li.getDocumentsMatchingQuery(u,e,t?i:$.min(),t?s:H())).next(h=>(Am(r,uu(e),h),{documents:h,Hi:s})))}function km(n,e){const t=P(n),r=P(t.Cs),i=t.qi.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.ne(s,e).next(u=>u?u.target:null))}function xm(n,e){const t=P(n),r=t.Ki.get(e)||$.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.Gi.getAllFromCollectionGroup(i,e,eo(r,-1),Number.MAX_SAFE_INTEGER)).then(i=>(Am(t,e,i),i))}function Am(n,e,t){let r=n.Ki.get(e)||$.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.Ki.set(e,r)}function fd(){return fd=(0,k.Z)(function*(n,e,t,r){const i=P(n);let s=H(),u=yt();for(const m of t){const g=e.Ji(m.metadata.name);m.document&&(s=s.add(g));const _=e.Yi(m);_.setReadTime(e.Xi(m.metadata.readTime)),u=u.insert(g,_)}const h=i.Gi.newChangeBuffer({trackRemovals:!0}),f=yield ko(i,(m=r,ze(Mt(ne.fromString(`__bundle__/docs/${m}`)))));var m;return i.persistence.runTransaction("Apply bundle documents","readwrite",m=>Tm(m,h,u).next(g=>(h.apply(m),g)).next(g=>i.Cs.removeMatchingKeysForTargetId(m,f.targetId).next(()=>i.Cs.addMatchingKeys(m,s,f.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(m,g.Wi,g.zi)).next(()=>g.Wi)))}),fd.apply(this,arguments)}function rv(n,e){return pd.apply(this,arguments)}function pd(){return pd=(0,k.Z)(function*(n,e,t=H()){const r=yield ko(n,ze(Xh(e.bundledQuery))),i=P(n);return i.persistence.runTransaction("Save named query","readwrite",s=>{const u=Oe(e.readTime);if(r.snapshotVersion.compareTo(u)>=0)return i.Ns.saveNamedQuery(s,e);const h=r.withResumeToken(Re.EMPTY_BYTE_STRING,u);return i.qi=i.qi.insert(h.targetId,h),i.Cs.updateTargetData(s,h).next(()=>i.Cs.removeMatchingKeysForTargetId(s,r.targetId)).next(()=>i.Cs.addMatchingKeys(s,t,r.targetId)).next(()=>i.Ns.saveNamedQuery(s,e))})}),pd.apply(this,arguments)}function Sm(n,e){return`firestore_clients_${n}_${e}`}function Cm(n,e,t){let r=`firestore_mutations_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}function md(n,e){return`firestore_targets_${n}_${e}`}class El{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static Zi(e,t,r){const i=JSON.parse(r);let s,u="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return u&&i.error&&(u="string"==typeof i.error.message&&"string"==typeof i.error.code,u&&(s=new A(i.error.code,i.error.message))),u?new El(e,t,i.state,s):(Ee("SharedClientState",`Failed to parse mutation state for ID '${t}': ${r}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class xu{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static Zi(e,t){const r=JSON.parse(t);let i,s="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error);return s&&r.error&&(s="string"==typeof r.error.message&&"string"==typeof r.error.code,s&&(i=new A(r.error.code,r.error.message))),s?new xu(e,r.state,i):(Ee("SharedClientState",`Failed to parse target state for ID '${e}': ${t}`),null)}tr(){const e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}class Tl{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static Zi(e,t){const r=JSON.parse(t);let i="object"==typeof r&&r.activeTargetIds instanceof Array,s=cl();for(let u=0;i&&u<r.activeTargetIds.length;++u)i=qc(r.activeTargetIds[u]),s=s.add(r.activeTargetIds[u]);return i?new Tl(e,s):(Ee("SharedClientState",`Failed to parse client data for instance '${e}': ${t}`),null)}}class gd{constructor(e,t){this.clientId=e,this.onlineState=t}static Zi(e){const t=JSON.parse(e);return"object"==typeof t&&-1!==["Unknown","Online","Offline"].indexOf(t.onlineState)&&"string"==typeof t.clientId?new gd(t.clientId,t.onlineState):(Ee("SharedClientState",`Failed to parse online state: ${e}`),null)}}class yd{constructor(){this.activeTargetIds=cl()}er(e){this.activeTargetIds=this.activeTargetIds.add(e)}nr(e){this.activeTargetIds=this.activeTargetIds.delete(e)}tr(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class _d{constructor(e,t,r,i,s){this.window=e,this.Hs=t,this.persistenceKey=r,this.sr=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new ye(z),this.started=!1,this.cr=[];const u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.ar=Sm(this.persistenceKey,this.sr),this.hr=`firestore_sequence_number_${this.persistenceKey}`,this.ur=this.ur.insert(this.sr,new yd),this.lr=new RegExp(`^firestore_clients_${u}_([^_]*)$`),this.dr=new RegExp(`^firestore_mutations_${u}_(\\d+)(?:_(.*))?$`),this._r=new RegExp(`^firestore_targets_${u}_(\\d+)$`),this.wr=`firestore_online_state_${this.persistenceKey}`,this.mr=function(h){return`firestore_bundle_loaded_v2_${h}`}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}static C(e){return!(!e||!e.localStorage)}start(){var e=this;return(0,k.Z)(function*(){const t=yield e.syncEngine.vi();for(const i of t){if(i===e.sr)continue;const s=e.getItem(Sm(e.persistenceKey,i));if(s){const u=Tl.Zi(i,s);u&&(e.ur=e.ur.insert(u.clientId,u))}}e.gr();const r=e.storage.getItem(e.wr);if(r){const i=e.yr(r);i&&e.pr(i)}for(const i of e.cr)e.rr(i);e.cr=[],e.window.addEventListener("pagehide",()=>e.shutdown()),e.started=!0})()}writeSequenceNumber(e){this.setItem(this.hr,JSON.stringify(e))}getAllActiveQueryTargets(){return this.Ir(this.ur)}isActiveQueryTarget(e){let t=!1;return this.ur.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.Tr(e,"pending")}updateMutationState(e,t,r){this.Tr(e,t,r),this.Er(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){const r=this.storage.getItem(md(this.persistenceKey,e));if(r){const i=xu.Zi(e,r);i&&(t=i.state)}}return this.Ar.er(e),this.gr(),t}removeLocalQueryTarget(e){this.Ar.nr(e),this.gr()}isLocalQueryTarget(e){return this.Ar.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(md(this.persistenceKey,e))}updateQueryState(e,t,r){this.Rr(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.Er(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.br(e)}notifyBundleLoaded(e){this.Pr(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}getItem(e){const t=this.storage.getItem(e);return D("SharedClientState","READ",e,t),t}setItem(e,t){D("SharedClientState","SET",e,t),this.storage.setItem(e,t)}removeItem(e){D("SharedClientState","REMOVE",e),this.storage.removeItem(e)}rr(e){var t=this;const r=e;if(r.storageArea===this.storage){if(D("SharedClientState","EVENT",r.key,r.newValue),r.key===this.ar)return void Ee("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable((0,k.Z)(function*(){if(t.started){if(null!==r.key)if(t.lr.test(r.key)){if(null==r.newValue){const i=t.vr(r.key);return t.Vr(i,null)}{const i=t.Sr(r.key,r.newValue);if(i)return t.Vr(i.clientId,i)}}else if(t.dr.test(r.key)){if(null!==r.newValue){const i=t.Dr(r.key,r.newValue);if(i)return t.Cr(i)}}else if(t._r.test(r.key)){if(null!==r.newValue){const i=t.Nr(r.key,r.newValue);if(i)return t.kr(i)}}else if(r.key===t.wr){if(null!==r.newValue){const i=t.yr(r.newValue);if(i)return t.pr(i)}}else if(r.key===t.hr){const i=function(s){let u=ct.at;if(null!=s)try{const h=JSON.parse(s);q("number"==typeof h),u=h}catch(h){Ee("SharedClientState","Failed to read sequence number from WebStorage",h)}return u}(r.newValue);i!==ct.at&&t.sequenceNumberHandler(i)}else if(r.key===t.mr){const i=t.Or(r.newValue);yield Promise.all(i.map(s=>t.syncEngine.Mr(s)))}}else t.cr.push(r)}))}}get Ar(){return this.ur.get(this.sr)}gr(){this.setItem(this.ar,this.Ar.tr())}Tr(e,t,r){const i=new El(this.currentUser,e,t,r),s=Cm(this.persistenceKey,this.currentUser,e);this.setItem(s,i.tr())}Er(e){const t=Cm(this.persistenceKey,this.currentUser,e);this.removeItem(t)}br(e){this.storage.setItem(this.wr,JSON.stringify({clientId:this.sr,onlineState:e}))}Rr(e,t,r){const i=md(this.persistenceKey,e),s=new xu(e,t,r);this.setItem(i,s.tr())}Pr(e){const t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}vr(e){const t=this.lr.exec(e);return t?t[1]:null}Sr(e,t){const r=this.vr(e);return Tl.Zi(r,t)}Dr(e,t){const r=this.dr.exec(e),i=Number(r[1]);return El.Zi(new xe(void 0!==r[2]?r[2]:null),i,t)}Nr(e,t){const r=this._r.exec(e),i=Number(r[1]);return xu.Zi(i,t)}yr(e){return gd.Zi(e)}Or(e){return JSON.parse(e)}Cr(e){var t=this;return(0,k.Z)(function*(){if(e.user.uid===t.currentUser.uid)return t.syncEngine.Fr(e.batchId,e.state,e.error);D("SharedClientState",`Ignoring mutation for non-active user ${e.user.uid}`)})()}kr(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}Vr(e,t){const r=t?this.ur.insert(e,t):this.ur.remove(e),i=this.Ir(this.ur),s=this.Ir(r),u=[],h=[];return s.forEach(f=>{i.has(f)||u.push(f)}),i.forEach(f=>{s.has(f)||h.push(f)}),this.syncEngine.Br(u,h).then(()=>{this.ur=r})}pr(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}Ir(e){let t=cl();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}}class Dm{constructor(){this.Lr=new yd,this.qr={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.Lr.er(e),this.qr[e]||"not-current"}updateQueryState(e,t,r){this.qr[e]=t}removeLocalQueryTarget(e){this.Lr.nr(e)}isLocalQueryTarget(e){return this.Lr.activeTargetIds.has(e)}clearQueryState(e){delete this.qr[e]}getAllActiveQueryTargets(){return this.Lr.activeTargetIds}isActiveQueryTarget(e){return this.Lr.activeTargetIds.has(e)}start(){return this.Lr=new yd,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class iv{Ur(e){}shutdown(){}}class Rm{constructor(){this.Kr=()=>this.Gr(),this.Qr=()=>this.jr(),this.Wr=[],this.zr()}Ur(e){this.Wr.push(e)}shutdown(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}zr(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}Gr(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const e of this.Wr)e(0)}jr(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const e of this.Wr)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}const sv={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ov{constructor(e){this.Hr=e.Hr,this.Jr=e.Jr}Yr(e){this.Xr=e}Zr(e){this.eo=e}onMessage(e){this.no=e}close(){this.Jr()}send(e){this.Hr(e)}so(){this.Xr()}io(e){this.eo(e)}ro(e){this.no(e)}}class av extends class{constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId,this.oo=(e.ssl?"https":"http")+"://"+e.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}get co(){return!1}ao(e,t,r,i,s){const u=this.ho(e,t);D("RestConnection","Sending: ",u,r);const h={};return this.lo(h,i,s),this.fo(e,u,h,r).then(f=>(D("RestConnection","Received: ",f),f),f=>{throw Wn("RestConnection",`${e} failed with error: `,f,"url: ",u,"request:",r),f})}_o(e,t,r,i,s,u){return this.ao(e,t,r,i,s)}lo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+Pr,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((i,s)=>e[s]=i),r&&r.headers.forEach((i,s)=>e[s]=i)}ho(e,t){return`${this.oo}/v1/${t}:${sv[e]}`}}{constructor(e){super(e),this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams}fo(e,t,r,i){return new Promise((s,u)=>{const h=new La;h.setWithCredentials(!0),h.listenOnce(Sh.COMPLETE,()=>{try{switch(h.getLastErrorCode()){case Ri.NO_ERROR:const m=h.getResponseJson();D("Connection","XHR received:",JSON.stringify(m)),s(m);break;case Ri.TIMEOUT:D("Connection",'RPC "'+e+'" timed out'),u(new A(E.DEADLINE_EXCEEDED,"Request time out"));break;case Ri.HTTP_ERROR:const g=h.getStatus();if(D("Connection",'RPC "'+e+'" failed with status:',g,"response text:",h.getResponseText()),g>0){let _=h.getResponseJson();Array.isArray(_)&&(_=_[0]);const w=null==_?void 0:_.error;if(w&&w.status&&w.message){const x=function(S){const M=S.toLowerCase().replace(/_/g,"-");return Object.values(E).indexOf(M)>=0?M:E.UNKNOWN}(w.status);u(new A(x,w.message))}else u(new A(E.UNKNOWN,"Server responded with status "+h.getStatus()))}else u(new A(E.UNAVAILABLE,"Connection failed."));break;default:F()}}finally{D("Connection",'RPC "'+e+'" completed.')}});const f=JSON.stringify(i);h.send(t,"POST",f,r,15)})}wo(e,t,r){const i=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=xh(),u=Ah(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(h.xmlHttpFactory=new Pa({})),this.lo(h.initMessageHeaders,t,r),h.encodeInitMessageHeaders=!0;const f=i.join("");D("Connection","Creating WebChannel: "+f,h);const m=s.createWebChannel(f,h);let g=!1,_=!1;const w=new ov({Hr:S=>{_?D("Connection","Not sending because WebChannel is closed:",S):(g||(D("Connection","Opening WebChannel transport."),m.open(),g=!0),D("Connection","WebChannel sending:",S),m.send(S))},Jr:()=>m.close()}),x=(S,M,V)=>{S.listen(M,se=>{try{V(se)}catch(le){setTimeout(()=>{throw le},0)}})};return x(m,Js.EventType.OPEN,()=>{_||D("Connection","WebChannel transport opened.")}),x(m,Js.EventType.CLOSE,()=>{_||(_=!0,D("Connection","WebChannel transport closed"),w.io())}),x(m,Js.EventType.ERROR,S=>{_||(_=!0,Wn("Connection","WebChannel transport errored:",S),w.io(new A(E.UNAVAILABLE,"The operation could not be completed")))}),x(m,Js.EventType.MESSAGE,S=>{var M;if(!_){const V=S.data[0];q(!!V);const se=V,le=se.error||(null===(M=se[0])||void 0===M?void 0:M.error);if(le){D("Connection","WebChannel received error:",le);const X=le.status;let Q=function(Y){const Ze=be[Y];if(void 0!==Ze)return vo(Ze)}(X),K=le.message;void 0===Q&&(Q=E.INTERNAL,K="Unknown error status: "+X+" with message "+le.message),_=!0,w.io(new A(Q,K)),m.close()}else D("Connection","WebChannel received:",V),w.ro(V)}}),x(u,Ma.STAT_EVENT,S=>{S.stat===Rc.PROXY?D("Connection","Detected buffering proxy"):S.stat===Rc.NOPROXY&&D("Connection","Detected no buffering proxy")}),setTimeout(()=>{w.so()},0),w}}function Nm(){return"undefined"!=typeof window?window:null}function kl(){return"undefined"!=typeof document?document:null}function Au(n){return new Jy(n,!0)}class vd{constructor(e,t,r=1e3,i=1.5,s=6e4){this.Hs=e,this.timerId=t,this.mo=r,this.yo=i,this.po=s,this.Io=0,this.To=null,this.Eo=Date.now(),this.reset()}reset(){this.Io=0}Ao(){this.Io=this.po}Ro(e){this.cancel();const t=Math.floor(this.Io+this.bo()),r=Math.max(0,Date.now()-this.Eo),i=Math.max(0,t-r);i>0&&D("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.Io} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.To=this.Hs.enqueueAfterDelay(this.timerId,i,()=>(this.Eo=Date.now(),e())),this.Io*=this.yo,this.Io<this.mo&&(this.Io=this.mo),this.Io>this.po&&(this.Io=this.po)}Po(){null!==this.To&&(this.To.skipDelay(),this.To=null)}cancel(){null!==this.To&&(this.To.cancel(),this.To=null)}bo(){return(Math.random()-.5)*this.Io}}class Om{constructor(e,t,r,i,s,u,h,f){this.Hs=e,this.vo=r,this.Vo=i,this.connection=s,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new vd(e,t)}No(){return 1===this.state||5===this.state||this.ko()}ko(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Oo()}stop(){var e=this;return(0,k.Z)(function*(){e.No()&&(yield e.close(0))})()}Mo(){this.state=0,this.xo.reset()}Fo(){this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.vo,6e4,()=>this.$o()))}Bo(e){this.Lo(),this.stream.send(e)}$o(){var e=this;return(0,k.Z)(function*(){if(e.ko())return e.close(0)})()}Lo(){this.Do&&(this.Do.cancel(),this.Do=null)}qo(){this.Co&&(this.Co.cancel(),this.Co=null)}close(e,t){var r=this;return(0,k.Z)(function*(){r.Lo(),r.qo(),r.xo.cancel(),r.So++,4!==e?r.xo.reset():t&&t.code===E.RESOURCE_EXHAUSTED?(Ee(t.toString()),Ee("Using maximum backoff delay to prevent overloading the backend."),r.xo.Ao()):t&&t.code===E.UNAUTHENTICATED&&3!==r.state&&(r.authCredentialsProvider.invalidateToken(),r.appCheckCredentialsProvider.invalidateToken()),null!==r.stream&&(r.Uo(),r.stream.close(),r.stream=null),r.state=e,yield r.listener.Zr(t)})()}Uo(){}auth(){this.state=1;const e=this.Ko(this.So),t=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.So===t&&this.Go(r,i)},r=>{e(()=>{const i=new A(E.UNKNOWN,"Fetching auth token failed: "+r.message);return this.Qo(i)})})}Go(e,t){const r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr(()=>{r(()=>(this.state=2,this.Co=this.Hs.enqueueAfterDelay(this.Vo,1e4,()=>(this.ko()&&(this.state=3),Promise.resolve())),this.listener.Yr()))}),this.stream.Zr(i=>{r(()=>this.Qo(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}Oo(){var e=this;this.state=5,this.xo.Ro((0,k.Z)(function*(){e.state=0,e.start()}))}Qo(e){return D("PersistentStream",`close with error: ${e}`),this.stream=null,this.close(4,e)}Ko(e){return t=>{this.Hs.enqueueAndForget(()=>this.So===e?t():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class uv extends Om{constructor(e,t,r,i,s,u){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,u),this.yt=s}jo(e,t){return this.connection.wo("Listen",e,t)}onMessage(e){this.xo.reset();const t=function t_(n,e){let t;if("targetChange"in e){const r="NO_CHANGE"===(f=e.targetChange.targetChangeType||"NO_CHANGE")?0:"ADD"===f?1:"REMOVE"===f?2:"CURRENT"===f?3:"RESET"===f?4:F(),i=e.targetChange.targetIds||[],s=function(f,m){return f.wt?(q(void 0===m||"string"==typeof m),Re.fromBase64String(m||"")):(q(void 0===m||m instanceof Uint8Array),Re.fromUint8Array(m||new Uint8Array))}(n,e.targetChange.resumeToken),u=e.targetChange.cause,h=u&&function(f){const m=void 0===f.code?E.UNKNOWN:vo(f.code);return new A(m,f.message||"")}(u);t=new kp(r,i,s,h||null)}else if("documentChange"in e){const r=e.documentChange,i=bn(n,r.document.name),s=Oe(r.document.updateTime),u=r.document.createTime?Oe(r.document.createTime):$.min(),h=new Fe({mapValue:{fields:r.document.fields}}),f=he.newFoundDocument(i,s,u,h);t=new ll(r.targetIds||[],r.removedTargetIds||[],f.key,f)}else if("documentDelete"in e){const r=e.documentDelete,i=bn(n,r.document),s=r.readTime?Oe(r.readTime):$.min(),u=he.newNoDocument(i,s);t=new ll([],r.removedTargetIds||[],u.key,u)}else if("documentRemove"in e){const r=e.documentRemove,i=bn(n,r.document);t=new ll([],r.removedTargetIds||[],i,null)}else{if(!("filter"in e))return F();{const r=e.filter,s=new al(r.count||0);t=new Tp(r.targetId,s)}}var f;return t}(this.yt,e),r=function(i){if(!("targetChange"in i))return $.min();const s=i.targetChange;return s.targetIds&&s.targetIds.length?$.min():s.readTime?Oe(s.readTime):$.min()}(e);return this.listener.Wo(t,r)}zo(e){const t={};t.database=yu(this.yt),t.addTarget=function(i,s){let u;const h=s.target;return u=Ur(h)?{documents:Pp(i,h)}:{query:Kh(i,h)},u.targetId=s.targetId,s.resumeToken.approximateByteSize()>0?u.resumeToken=Cp(i,s.resumeToken):s.snapshotVersion.compareTo($.min())>0&&(u.readTime=Io(i,s.snapshotVersion.toTimestamp())),u}(this.yt,e);const r=function r_(n,e){const t=function(r,i){switch(i){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return F()}}(0,e.purpose);return null==t?null:{"goog-listen-tags":t}}(0,e);r&&(t.labels=r),this.Bo(t)}Ho(e){const t={};t.database=yu(this.yt),t.removeTarget=e,this.Bo(t)}}class cv extends Om{constructor(e,t,r,i,s,u){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,u),this.yt=s,this.Jo=!1}get Yo(){return this.Jo}start(){this.Jo=!1,this.lastStreamToken=void 0,super.start()}Uo(){this.Jo&&this.Xo([])}jo(e,t){return this.connection.wo("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();const t=function n_(n,e){return n&&n.length>0?(q(void 0!==e),n.map(t=>function(r,i){let s=Oe(r.updateTime?r.updateTime:i);return s.isEqual($.min())&&(s=Oe(i)),new y(s,r.transformResults||[])}(t,e))):[]}(e.writeResults,e.commitTime),r=Oe(e.commitTime);return this.listener.Zo(r,t)}return q(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}eu(){const e={};e.database=yu(this.yt),this.Bo(e)}Xo(e){const t={streamToken:this.lastStreamToken,writes:e.map(r=>_u(this.yt,r))};this.Bo(t)}}class lv extends class{}{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.yt=i,this.nu=!1}su(){if(this.nu)throw new A(E.FAILED_PRECONDITION,"The client has already been terminated.")}ao(e,t,r){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.ao(e,t,r,i,s)).catch(i=>{throw"FirebaseError"===i.name?(i.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new A(E.UNKNOWN,i.toString())})}_o(e,t,r,i){return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,u])=>this.connection._o(e,t,r,s,u,i)).catch(s=>{throw"FirebaseError"===s.name?(s.code===E.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new A(E.UNKNOWN,s.toString())})}terminate(){this.nu=!0}}class dv{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}uu(){0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.ru=null,this.au("Backend didn't respond within 10 seconds."),this.cu("Offline"),Promise.resolve())))}hu(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.cu("Offline")))}set(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}cu(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}au(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ou?(Ee(t),this.ou=!1):D("OnlineStateTracker",t)}lu(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}class fv{constructor(e,t,r,i,s){var u=this;this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=s,this.mu.Ur(h=>{r.enqueueAndForget((0,k.Z)(function*(){var f;ur(u)&&(D("RemoteStore","Restarting streams for network reachability change."),yield(f=(0,k.Z)(function*(m){const g=P(m);g._u.add(4),yield Ao(g),g.gu.set("Unknown"),g._u.delete(4),yield Su(g)}),function(m){return f.apply(this,arguments)})(u))}))}),this.gu=new dv(r,i)}}function Su(n){return wd.apply(this,arguments)}function wd(){return wd=(0,k.Z)(function*(n){if(ur(n))for(const e of n.wu)yield e(!0)}),wd.apply(this,arguments)}function Ao(n){return bd.apply(this,arguments)}function bd(){return bd=(0,k.Z)(function*(n){for(const e of n.wu)yield e(!1)}),bd.apply(this,arguments)}function xl(n,e){const t=P(n);t.du.has(e.targetId)||(t.du.set(e.targetId,e),kd(t)?Td(t):Co(t).ko()&&Ed(t,e))}function Cu(n,e){const t=P(n),r=Co(t);t.du.delete(e),r.ko()&&Mm(t,e),0===t.du.size&&(r.ko()?r.Fo():ur(t)&&t.gu.set("Unknown"))}function Ed(n,e){n.yu.Ot(e.targetId),Co(n).zo(e)}function Mm(n,e){n.yu.Ot(e),Co(n).Ho(e)}function Td(n){n.yu=new Ky({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),ne:e=>n.du.get(e)||null}),Co(n).start(),n.gu.uu()}function kd(n){return ur(n)&&!Co(n).No()&&n.du.size>0}function ur(n){return 0===P(n)._u.size}function Pm(n){n.yu=void 0}function pv(n){return xd.apply(this,arguments)}function xd(){return xd=(0,k.Z)(function*(n){n.du.forEach((e,t)=>{Ed(n,e)})}),xd.apply(this,arguments)}function mv(n,e){return Ad.apply(this,arguments)}function Ad(){return Ad=(0,k.Z)(function*(n,e){Pm(n),kd(n)?(n.gu.hu(e),Td(n)):n.gu.set("Unknown")}),Ad.apply(this,arguments)}function gv(n,e,t){return Sd.apply(this,arguments)}function Sd(){return Sd=(0,k.Z)(function*(n,e,t){if(n.gu.set("Online"),e instanceof kp&&2===e.state&&e.cause)try{yield(r=(0,k.Z)(function*(i,s){const u=s.cause;for(const h of s.targetIds)i.du.has(h)&&(yield i.remoteSyncer.rejectListen(h,u),i.du.delete(h),i.yu.removeTarget(h))}),function(i,s){return r.apply(this,arguments)})(n,e)}catch(r){D("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Al(n,r)}else if(e instanceof ll?n.yu.Kt(e):e instanceof Tp?n.yu.Jt(e):n.yu.jt(e),!t.isEqual($.min()))try{const r=yield Em(n.localStore);t.compareTo(r)>=0&&(yield function(i,s){const u=i.yu.Zt(s);return u.targetChanges.forEach((h,f)=>{if(h.resumeToken.approximateByteSize()>0){const m=i.du.get(f);m&&i.du.set(f,m.withResumeToken(h.resumeToken,s))}}),u.targetMismatches.forEach(h=>{const f=i.du.get(h);if(!f)return;i.du.set(h,f.withResumeToken(Re.EMPTY_BYTE_STRING,f.snapshotVersion)),Mm(i,h);const m=new Br(f.target,h,1,f.sequenceNumber);Ed(i,m)}),i.remoteSyncer.applyRemoteEvent(u)}(n,t))}catch(r){D("RemoteStore","Failed to raise snapshot:",r),yield Al(n,r)}var r}),Sd.apply(this,arguments)}function Al(n,e,t){return Cd.apply(this,arguments)}function Cd(){return Cd=(0,k.Z)(function*(n,e,t){if(!cn(e))throw e;n._u.add(1),yield Ao(n),n.gu.set("Offline"),t||(t=()=>Em(n.localStore)),n.asyncQueue.enqueueRetryable((0,k.Z)(function*(){D("RemoteStore","Retrying IndexedDB access"),yield t(),n._u.delete(1),yield Su(n)}))}),Cd.apply(this,arguments)}function Lm(n,e){return e().catch(t=>Al(n,t,e))}function So(n){return Dd.apply(this,arguments)}function Dd(){return Dd=(0,k.Z)(function*(n){const e=P(n),t=jr(e);let r=e.fu.length>0?e.fu[e.fu.length-1].batchId:-1;for(;yv(e);)try{const i=yield tv(e.localStore,r);if(null===i){0===e.fu.length&&t.Fo();break}r=i.batchId,_v(e,i)}catch(i){yield Al(e,i)}Fm(e)&&Um(e)}),Dd.apply(this,arguments)}function yv(n){return ur(n)&&n.fu.length<10}function _v(n,e){n.fu.push(e);const t=jr(n);t.ko()&&t.Yo&&t.Xo(e.mutations)}function Fm(n){return ur(n)&&!jr(n).No()&&n.fu.length>0}function Um(n){jr(n).start()}function vv(n){return Rd.apply(this,arguments)}function Rd(){return Rd=(0,k.Z)(function*(n){jr(n).eu()}),Rd.apply(this,arguments)}function Iv(n){return Nd.apply(this,arguments)}function Nd(){return Nd=(0,k.Z)(function*(n){const e=jr(n);for(const t of n.fu)e.Xo(t.mutations)}),Nd.apply(this,arguments)}function wv(n,e,t){return Od.apply(this,arguments)}function Od(){return Od=(0,k.Z)(function*(n,e,t){const r=n.fu.shift(),i=Yh.from(r,e,t);yield Lm(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield So(n)}),Od.apply(this,arguments)}function bv(n,e){return Md.apply(this,arguments)}function Md(){return Md=(0,k.Z)(function*(n,e){var t;e&&jr(n).Yo&&(yield(t=(0,k.Z)(function*(r,i){if(ul(s=i.code)&&s!==E.ABORTED){const u=r.fu.shift();jr(r).Mo(),yield Lm(r,()=>r.remoteSyncer.rejectFailedWrite(u.batchId,i)),yield So(r)}var s}),function(r,i){return t.apply(this,arguments)})(n,e)),Fm(n)&&Um(n)}),Md.apply(this,arguments)}function Vm(n,e){return Pd.apply(this,arguments)}function Pd(){return Pd=(0,k.Z)(function*(n,e){const t=P(n);t.asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials");const r=ur(t);t._u.add(3),yield Ao(t),r&&t.gu.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t._u.delete(3),yield Su(t)}),Pd.apply(this,arguments)}function Ld(n,e){return Fd.apply(this,arguments)}function Fd(){return Fd=(0,k.Z)(function*(n,e){const t=P(n);e?(t._u.delete(2),yield Su(t)):e||(t._u.add(2),yield Ao(t),t.gu.set("Unknown"))}),Fd.apply(this,arguments)}function Co(n){return n.pu||(n.pu=function(e,t,r){const i=P(e);return i.su(),new uv(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:pv.bind(null,n),Zr:mv.bind(null,n),Wo:gv.bind(null,n)}),n.wu.push(function(){var e=(0,k.Z)(function*(t){t?(n.pu.Mo(),kd(n)?Td(n):n.gu.set("Unknown")):(yield n.pu.stop(),Pm(n))});return function(t){return e.apply(this,arguments)}}())),n.pu}function jr(n){return n.Iu||(n.Iu=function(e,t,r){const i=P(e);return i.su(),new cv(t,i.connection,i.authCredentials,i.appCheckCredentials,i.yt,r)}(n.datastore,n.asyncQueue,{Yr:vv.bind(null,n),Zr:bv.bind(null,n),tu:Iv.bind(null,n),Zo:wv.bind(null,n)}),n.wu.push(function(){var e=(0,k.Z)(function*(t){t?(n.Iu.Mo(),yield So(n)):(yield n.Iu.stop(),n.fu.length>0&&(D("RemoteStore",`Stopping write stream with ${n.fu.length} pending writes`),n.fu=[]))});return function(t){return e.apply(this,arguments)}}())),n.Iu}class Ud{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new Te,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(u=>{})}static createAndSchedule(e,t,r,i,s){const u=Date.now()+r,h=new Ud(e,t,u,i,s);return h.start(r),h}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new A(E.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Do(n,e){if(Ee("AsyncQueue",`${e}: ${n}`),cn(n))return new A(E.UNAVAILABLE,`${e}: ${n}`);throw n}class Ro{constructor(e){this.comparator=e?(t,r)=>e(t,r)||O.comparator(t.key,r.key):(t,r)=>O.comparator(t.key,r.key),this.keyedMap=du(),this.sortedSet=new ye(this.comparator)}static emptySet(e){return new Ro(e.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Ro)||this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Ro;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class qm{constructor(){this.Tu=new ye(O.comparator)}track(e){const t=e.doc.key,r=this.Tu.get(t);r?0!==e.type&&3===r.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==r.type?this.Tu=this.Tu.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.Tu=this.Tu.remove(t):1===e.type&&2===r.type?this.Tu=this.Tu.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):F():this.Tu=this.Tu.insert(t,e)}Eu(){const e=[];return this.Tu.inorderTraversal((t,r)=>{e.push(r)}),e}}class No{constructor(e,t,r,i,s,u,h,f,m){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=u,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=m}static fromInitialDocuments(e,t,r,i,s){const u=[];return t.forEach(h=>{u.push({type:0,doc:h})}),new No(e,t,Ro.emptySet(t),u,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&qr(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}}class Ev{constructor(){this.Au=void 0,this.listeners=[]}}class Tv{constructor(){this.queries=new In(e=>el(e),qr),this.onlineState="Unknown",this.Ru=new Set}}function Vd(n,e){return qd.apply(this,arguments)}function qd(){return qd=(0,k.Z)(function*(n,e){const t=P(n),r=e.query;let i=!1,s=t.queries.get(r);if(s||(i=!0,s=new Ev),i)try{s.Au=yield t.onListen(r)}catch(u){const h=Do(u,`Initialization of query '${ou(e.query)}' failed`);return void e.onError(h)}t.queries.set(r,s),s.listeners.push(e),e.bu(t.onlineState),s.Au&&e.Pu(s.Au)&&Gd(t)}),qd.apply(this,arguments)}function Bd(n,e){return Zd.apply(this,arguments)}function Zd(){return Zd=(0,k.Z)(function*(n,e){const t=P(n),r=e.query;let i=!1;const s=t.queries.get(r);if(s){const u=s.listeners.indexOf(e);u>=0&&(s.listeners.splice(u,1),i=0===s.listeners.length)}if(i)return t.queries.delete(r),t.onUnlisten(r)}),Zd.apply(this,arguments)}function kv(n,e){const t=P(n);let r=!1;for(const i of e){const u=t.queries.get(i.query);if(u){for(const h of u.listeners)h.Pu(i)&&(r=!0);u.Au=i}}r&&Gd(t)}function xv(n,e,t){const r=P(n),i=r.queries.get(e);if(i)for(const s of i.listeners)s.onError(t);r.queries.delete(e)}function Gd(n){n.Ru.forEach(e=>{e.next()})}class $d{constructor(e,t,r){this.query=e,this.vu=t,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}Pu(e){if(!this.options.includeMetadataChanges){const r=[];for(const i of e.docChanges)3!==i.type&&r.push(i);e=new No(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),t=!0):this.Cu(e,this.onlineState)&&(this.xu(e),t=!0),this.Su=e,t}onError(e){this.vu.error(e)}bu(e){this.onlineState=e;let t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}Cu(e,t){return!e.fromCache||(!this.options.Nu||!("Offline"!==t))&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Du(e){return e.docChanges.length>0||!!(e.syncStateChanged||this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites)&&!0===this.options.includeMetadataChanges}xu(e){e=No.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Vu=!0,this.vu.next(e)}}class Av{constructor(e,t){this.ku=e,this.byteLength=t}Ou(){return"metadata"in this.ku}}class Bm{constructor(e){this.yt=e}Ji(e){return bn(this.yt,e)}Yi(e){return e.metadata.exists?Mp(this.yt,e.document,!1):he.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}Xi(e){return Oe(e)}}class Sv{constructor(e,t,r){this.Mu=e,this.localStore=t,this.yt=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=Zm(e)}Fu(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.ku.namedQuery)this.queries.push(e.ku.namedQuery);else if(e.ku.documentMetadata){this.documents.push({metadata:e.ku.documentMetadata}),e.ku.documentMetadata.exists||++t;const r=ne.fromString(e.ku.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.ku.document&&(this.documents[this.documents.length-1].document=e.ku.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}$u(e){const t=new Map,r=new Bm(this.yt);for(const i of e)if(i.metadata.queries){const s=r.Ji(i.metadata.name);for(const u of i.metadata.queries){const h=(t.get(u)||H()).add(s);t.set(u,h)}}return t}complete(){var e=this;return(0,k.Z)(function*(){const t=yield function nv(n,e,t,r){return fd.apply(this,arguments)}(e.localStore,new Bm(e.yt),e.documents,e.Mu.id),r=e.$u(e.documents);for(const i of e.queries)yield rv(e.localStore,i,r.get(i.name));return e.progress.taskState="Success",{progress:e.progress,Bu:e.collectionGroups,Lu:t}})()}}function Zm(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}class Gm{constructor(e){this.key=e}}class $m{constructor(e){this.key=e}}class jm{constructor(e,t){this.query=e,this.qu=t,this.Uu=null,this.hasCachedResults=!1,this.current=!1,this.Ku=H(),this.mutatedKeys=H(),this.Gu=Ye(e),this.Qu=new Ro(this.Gu)}get ju(){return this.qu}Wu(e,t){const r=t?t.zu:new qm,i=t?t.Qu:this.Qu;let s=t?t.mutatedKeys:this.mutatedKeys,u=i,h=!1;const f="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,m="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((g,_)=>{const w=i.get(g),x=au(this.query,_)?_:null,S=!!w&&this.mutatedKeys.has(w.key),M=!!x&&(x.hasLocalMutations||this.mutatedKeys.has(x.key)&&x.hasCommittedMutations);let V=!1;w&&x?w.data.isEqual(x.data)?S!==M&&(r.track({type:3,doc:x}),V=!0):this.Hu(w,x)||(r.track({type:2,doc:x}),V=!0,(f&&this.Gu(x,f)>0||m&&this.Gu(x,m)<0)&&(h=!0)):!w&&x?(r.track({type:0,doc:x}),V=!0):w&&!x&&(r.track({type:1,doc:w}),V=!0,(f||m)&&(h=!0)),V&&(x?(u=u.add(x),s=M?s.add(g):s.delete(g)):(u=u.delete(g),s=s.delete(g)))}),null!==this.query.limit)for(;u.size>this.query.limit;){const g="F"===this.query.limitType?u.last():u.first();u=u.delete(g.key),s=s.delete(g.key),r.track({type:1,doc:g})}return{Qu:u,zu:r,$i:h,mutatedKeys:s}}Hu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r){const i=this.Qu;this.Qu=e.Qu,this.mutatedKeys=e.mutatedKeys;const s=e.zu.Eu();s.sort((m,g)=>function(_,w){const x=S=>{switch(S){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F()}};return x(_)-x(w)}(m.type,g.type)||this.Gu(m.doc,g.doc)),this.Ju(r);const u=t?this.Yu():[],h=0===this.Ku.size&&this.current?1:0,f=h!==this.Uu;return this.Uu=h,0!==s.length||f?{snapshot:new No(this.query,e.Qu,i,s,e.mutatedKeys,0===h,f,!1,!!r&&r.resumeToken.approximateByteSize()>0),Xu:u}:{Xu:u}}bu(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Qu:this.Qu,zu:new qm,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Xu:[]}}Zu(e){return!this.qu.has(e)&&!!this.Qu.has(e)&&!this.Qu.get(e).hasLocalMutations}Ju(e){e&&(e.addedDocuments.forEach(t=>this.qu=this.qu.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this.qu=this.qu.delete(t)),this.current=e.current)}Yu(){if(!this.current)return[];const e=this.Ku;this.Ku=H(),this.Qu.forEach(r=>{this.Zu(r.key)&&(this.Ku=this.Ku.add(r.key))});const t=[];return e.forEach(r=>{this.Ku.has(r)||t.push(new $m(r))}),this.Ku.forEach(r=>{e.has(r)||t.push(new Gm(r))}),t}tc(e){this.qu=e.Hi,this.Ku=H();const t=this.Wu(e.documents);return this.applyChanges(t,!0)}ec(){return No.fromInitialDocuments(this.query,this.Qu,this.mutatedKeys,0===this.Uu,this.hasCachedResults)}}class Cv{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class Dv{constructor(e){this.key=e,this.nc=!1}}class Rv{constructor(e,t,r,i,s,u){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=u,this.sc={},this.ic=new In(h=>el(h),qr),this.rc=new Map,this.oc=new Set,this.uc=new ye(O.comparator),this.cc=new Map,this.ac=new od,this.hc={},this.lc=new Map,this.fc=Hi.vn(),this.onlineState="Unknown",this.dc=void 0}get isPrimaryClient(){return!0===this.dc}}function Nv(n,e){return jd.apply(this,arguments)}function jd(){return jd=(0,k.Z)(function*(n,e){const t=mf(n);let r,i;const s=t.ic.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.ec();else{const u=yield ko(t.localStore,ze(e));t.isPrimaryClient&&xl(t.remoteStore,u);const h=t.sharedClientState.addLocalQueryTarget(u.targetId);r=u.targetId,i=yield zd(t,e,r,"current"===h,u.resumeToken)}return i}),jd.apply(this,arguments)}function zd(n,e,t,r,i){return Wd.apply(this,arguments)}function Wd(){return Wd=(0,k.Z)(function*(n,e,t,r,i){n._c=(_,w,x)=>{return(S=(0,k.Z)(function*(M,V,se,le){let X=V.view.Wu(se);X.$i&&(X=yield bl(M.localStore,V.query,!1).then(({documents:Y})=>V.view.Wu(Y,X)));const Q=le&&le.targetChanges.get(V.targetId),K=V.view.applyChanges(X,M.isPrimaryClient,Q);return rf(M,V.targetId,K.Xu),K.snapshot}),function(M,V,se,le){return S.apply(this,arguments)})(n,_,w,x);var S};const s=yield bl(n.localStore,e,!0),u=new jm(e,s.Hi),h=u.Wu(s.documents),f=mu.createSynthesizedTargetChangeForCurrentChange(t,r&&"Offline"!==n.onlineState,i),m=u.applyChanges(h,n.isPrimaryClient,f);rf(n,t,m.Xu);const g=new Cv(e,t,u);return n.ic.set(e,g),n.rc.has(t)?n.rc.get(t).push(e):n.rc.set(t,[e]),m.snapshot}),Wd.apply(this,arguments)}function Ov(n,e){return Kd.apply(this,arguments)}function Kd(){return Kd=(0,k.Z)(function*(n,e){const t=P(n),r=t.ic.get(e),i=t.rc.get(r.targetId);if(i.length>1)return t.rc.set(r.targetId,i.filter(s=>!qr(s,e))),void t.ic.delete(e);t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield xo(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Cu(t.remoteStore,r.targetId),Oo(t,r.targetId)}).catch(Jt))):(Oo(t,r.targetId),yield xo(t.localStore,r.targetId,!0))}),Kd.apply(this,arguments)}function Hd(){return Hd=(0,k.Z)(function*(n,e,t){const r=gf(n);try{const i=yield function(s,u){const h=P(s),f=pe.now(),m=u.reduce((w,x)=>w.add(x.key),H());let g,_;return h.persistence.runTransaction("Locally write mutations","readwrite",w=>{let x=yt(),S=H();return h.Gi.getEntries(w,m).next(M=>{x=M,x.forEach((V,se)=>{se.isValidDocument()||(S=S.add(V))})}).next(()=>h.localDocuments.getOverlayedDocuments(w,x)).next(M=>{g=M;const V=[];for(const se of u){const le=Ne(se,g.get(se.key).overlayedDocument);null!=le&&V.push(new Lt(se.key,le,Jc(le.value.mapValue),v.exists(!0)))}return h.mutationQueue.addMutationBatch(w,f,V,u)}).next(M=>{_=M;const V=M.applyToLocalDocumentSet(g,S);return h.documentOverlayCache.saveOverlays(w,M.batchId,V)})}).then(()=>({batchId:_.batchId,changes:bp(g)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),function(s,u,h){let f=s.hc[s.currentUser.toKey()];f||(f=new ye(z)),f=f.insert(u,h),s.hc[s.currentUser.toKey()]=f}(r,i.batchId,t),yield cr(r,i.changes),yield So(r.remoteStore)}catch(i){const s=Do(i,"Failed to persist write");t.reject(s)}}),Hd.apply(this,arguments)}function zm(n,e){return Qd.apply(this,arguments)}function Qd(){return Qd=(0,k.Z)(function*(n,e){const t=P(n);try{const r=yield ev(t.localStore,e);e.targetChanges.forEach((i,s)=>{const u=t.cc.get(s);u&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?u.nc=!0:i.modifiedDocuments.size>0?q(u.nc):i.removedDocuments.size>0&&(q(u.nc),u.nc=!1))}),yield cr(t,r,e)}catch(r){yield Jt(r)}}),Qd.apply(this,arguments)}function Wm(n,e,t){const r=P(n);if(r.isPrimaryClient&&0===t||!r.isPrimaryClient&&1===t){const i=[];r.ic.forEach((s,u)=>{const h=u.view.bu(e);h.snapshot&&i.push(h.snapshot)}),function(s,u){const h=P(s);h.onlineState=u;let f=!1;h.queries.forEach((m,g)=>{for(const _ of g.listeners)_.bu(u)&&(f=!0)}),f&&Gd(h)}(r.eventManager,e),i.length&&r.sc.Wo(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Pv(n,e,t){return Yd.apply(this,arguments)}function Yd(){return Yd=(0,k.Z)(function*(n,e,t){const r=P(n);r.sharedClientState.updateQueryState(e,"rejected",t);const i=r.cc.get(e),s=i&&i.key;if(s){let u=new ye(O.comparator);u=u.insert(s,he.newNoDocument(s,$.min()));const h=H().add(s),f=new pu($.min(),new Map,new ue(z),u,h);yield zm(r,f),r.uc=r.uc.remove(s),r.cc.delete(e),sf(r)}else yield xo(r.localStore,e,!1).then(()=>Oo(r,e,t)).catch(Jt)}),Yd.apply(this,arguments)}function Lv(n,e){return Jd.apply(this,arguments)}function Jd(){return Jd=(0,k.Z)(function*(n,e){const t=P(n),r=e.batch.batchId;try{const i=yield X_(t.localStore,e);nf(t,r,null),tf(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield cr(t,i)}catch(i){yield Jt(i)}}),Jd.apply(this,arguments)}function Fv(n,e,t){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,k.Z)(function*(n,e,t){const r=P(n);try{const i=yield function(s,u){const h=P(s);return h.persistence.runTransaction("Reject batch","readwrite-primary",f=>{let m;return h.mutationQueue.lookupMutationBatch(f,u).next(g=>(q(null!==g),m=g.keys(),h.mutationQueue.removeMutationBatch(f,g))).next(()=>h.mutationQueue.performConsistencyCheck(f)).next(()=>h.documentOverlayCache.removeOverlaysForBatchId(f,m,u)).next(()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(f,m)).next(()=>h.localDocuments.getDocuments(f,m))})}(r.localStore,e);nf(r,e,t),tf(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield cr(r,i)}catch(i){yield Jt(i)}}),Xd.apply(this,arguments)}function ef(){return ef=(0,k.Z)(function*(n,e){const t=P(n);ur(t.remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{const r=yield function(s){const u=P(s);return u.persistence.runTransaction("Get highest unacknowledged batch id","readonly",h=>u.mutationQueue.getHighestUnacknowledgedBatchId(h))}(t.localStore);if(-1===r)return void e.resolve();const i=t.lc.get(r)||[];i.push(e),t.lc.set(r,i)}catch(r){const i=Do(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}}),ef.apply(this,arguments)}function tf(n,e){(n.lc.get(e)||[]).forEach(t=>{t.resolve()}),n.lc.delete(e)}function nf(n,e,t){const r=P(n);let i=r.hc[r.currentUser.toKey()];if(i){const s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.hc[r.currentUser.toKey()]=i}}function Oo(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(const r of n.rc.get(e))n.ic.delete(r),t&&n.sc.wc(r,t);n.rc.delete(e),n.isPrimaryClient&&n.ac.ls(e).forEach(r=>{n.ac.containsKey(r)||Km(n,r)})}function Km(n,e){n.oc.delete(e.path.canonicalString());const t=n.uc.get(e);null!==t&&(Cu(n.remoteStore,t),n.uc=n.uc.remove(e),n.cc.delete(t),sf(n))}function rf(n,e,t){for(const r of t)r instanceof Gm?(n.ac.addReference(r.key,e),Vv(n,r)):r instanceof $m?(D("SyncEngine","Document no longer in limbo: "+r.key),n.ac.removeReference(r.key,e),n.ac.containsKey(r.key)||Km(n,r.key)):F()}function Vv(n,e){const t=e.key,r=t.path.canonicalString();n.uc.get(t)||n.oc.has(r)||(D("SyncEngine","New document in limbo: "+t),n.oc.add(r),sf(n))}function sf(n){for(;n.oc.size>0&&n.uc.size<n.maxConcurrentLimboResolutions;){const e=n.oc.values().next().value;n.oc.delete(e);const t=new O(ne.fromString(e)),r=n.fc.next();n.cc.set(r,new Dv(t)),n.uc=n.uc.insert(t,r),xl(n.remoteStore,new Br(ze(Mt(t.path)),r,2,ct.at))}}function cr(n,e,t){return of.apply(this,arguments)}function of(){return of=(0,k.Z)(function*(n,e,t){const r=P(n),i=[],s=[],u=[];var h;r.ic.isEmpty()||(r.ic.forEach((h,f)=>{u.push(r._c(f,e,t).then(m=>{if((m||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(f.targetId,(null==m?void 0:m.fromCache)?"not-current":"current"),m){i.push(m);const g=ld.Ci(f.targetId,m);s.push(g)}}))}),yield Promise.all(u),r.sc.Wo(i),yield(h=(0,k.Z)(function*(f,m){const g=P(f);try{yield g.persistence.runTransaction("notifyLocalViewChanges","readwrite",_=>b.forEach(m,w=>b.forEach(w.Si,x=>g.persistence.referenceDelegate.addReference(_,w.targetId,x)).next(()=>b.forEach(w.Di,x=>g.persistence.referenceDelegate.removeReference(_,w.targetId,x)))))}catch(_){if(!cn(_))throw _;D("LocalStore","Failed to update sequence numbers: "+_)}for(const _ of m){const w=_.targetId;if(!_.fromCache){const x=g.qi.get(w),M=x.withLastLimboFreeSnapshotVersion(x.snapshotVersion);g.qi=g.qi.insert(w,M)}}}),function(f,m){return h.apply(this,arguments)})(r.localStore,s))}),of.apply(this,arguments)}function qv(n,e){return af.apply(this,arguments)}function af(){return af=(0,k.Z)(function*(n,e){const t=P(n);if(!t.currentUser.isEqual(e)){D("SyncEngine","User change. New user:",e.toKey());const r=yield bm(t.localStore,e);t.currentUser=e,(i=t).lc.forEach(u=>{u.forEach(h=>{h.reject(new A(E.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),i.lc.clear(),t.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),yield cr(t,r.ji)}var i}),af.apply(this,arguments)}function Bv(n,e){const t=P(n),r=t.cc.get(e);if(r&&r.nc)return H().add(r.key);{let i=H();const s=t.rc.get(e);if(!s)return i;for(const u of s){const h=t.ic.get(u);i=i.unionWith(h.view.ju)}return i}}function Zv(n,e){return uf.apply(this,arguments)}function uf(){return uf=(0,k.Z)(function*(n,e){const t=P(n),r=yield bl(t.localStore,e.query,!0),i=e.view.tc(r);return t.isPrimaryClient&&rf(t,e.targetId,i.Xu),i}),uf.apply(this,arguments)}function Gv(n,e){return cf.apply(this,arguments)}function cf(){return cf=(0,k.Z)(function*(n,e){const t=P(n);return xm(t.localStore,e).then(r=>cr(t,r))}),cf.apply(this,arguments)}function $v(n,e,t,r){return lf.apply(this,arguments)}function lf(){return lf=(0,k.Z)(function*(n,e,t,r){const i=P(n),s=yield function(u,h){const f=P(u),m=P(f.mutationQueue);return f.persistence.runTransaction("Lookup mutation documents","readonly",g=>m.Tn(g,h).next(_=>_?f.localDocuments.getDocuments(g,_):b.resolve(null)))}(i.localStore,e);var h;null!==s?("pending"===t?yield So(i.remoteStore):"acknowledged"===t||"rejected"===t?(nf(i,e,r||null),tf(i,e),h=e,P(P(i.localStore).mutationQueue).An(h)):F(),yield cr(i,s)):D("SyncEngine","Cannot apply mutation batch with id: "+e)}),lf.apply(this,arguments)}function hf(){return hf=(0,k.Z)(function*(n,e){const t=P(n);if(mf(t),gf(t),!0===e&&!0!==t.dc){const r=t.sharedClientState.getAllActiveQueryTargets(),i=yield Hm(t,r.toArray());t.dc=!0,yield Ld(t.remoteStore,!0);for(const s of i)xl(t.remoteStore,s)}else if(!1===e&&!1!==t.dc){const r=[];let i=Promise.resolve();t.rc.forEach((s,u)=>{t.sharedClientState.isLocalQueryTarget(u)?r.push(u):i=i.then(()=>(Oo(t,u),xo(t.localStore,u,!0))),Cu(t.remoteStore,u)}),yield i,yield Hm(t,r),function(s){const u=P(s);u.cc.forEach((h,f)=>{Cu(u.remoteStore,f)}),u.ac.fs(),u.cc=new Map,u.uc=new ye(O.comparator)}(t),t.dc=!1,yield Ld(t.remoteStore,!1)}}),hf.apply(this,arguments)}function Hm(n,e,t){return df.apply(this,arguments)}function df(){return df=(0,k.Z)(function*(n,e,t){const r=P(n),i=[],s=[];for(const u of e){let h;const f=r.rc.get(u);if(f&&0!==f.length){h=yield ko(r.localStore,ze(f[0]));for(const m of f){const g=r.ic.get(m),_=yield Zv(r,g);_.snapshot&&s.push(_.snapshot)}}else{const m=yield km(r.localStore,u);h=yield ko(r.localStore,m),yield zd(r,Qm(m),u,!1,h.resumeToken)}i.push(h)}return r.sc.Wo(s),i}),df.apply(this,arguments)}function Qm(n){return nt(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function zv(n){const e=P(n);return P(P(e.localStore).persistence).vi()}function Wv(n,e,t,r){return ff.apply(this,arguments)}function ff(){return ff=(0,k.Z)(function*(n,e,t,r){const i=P(n);if(i.dc)return void D("SyncEngine","Ignoring unexpected query state notification.");const s=i.rc.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{const u=yield xm(i.localStore,uu(s[0])),h=pu.createSynthesizedRemoteEventForCurrentChange(e,"current"===t,Re.EMPTY_BYTE_STRING);yield cr(i,u,h);break}case"rejected":yield xo(i.localStore,e,!0),Oo(i,e,r);break;default:F()}}),ff.apply(this,arguments)}function Kv(n,e,t){return pf.apply(this,arguments)}function pf(){return pf=(0,k.Z)(function*(n,e,t){const r=mf(n);if(r.dc){for(const i of e){if(r.rc.has(i)){D("SyncEngine","Adding an already active target "+i);continue}const s=yield km(r.localStore,i),u=yield ko(r.localStore,s);yield zd(r,Qm(s),u.targetId,!1,u.resumeToken),xl(r.remoteStore,u)}for(const i of t)r.rc.has(i)&&(yield xo(r.localStore,i,!1).then(()=>{Cu(r.remoteStore,i),Oo(r,i)}).catch(Jt))}}),pf.apply(this,arguments)}function mf(n){const e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=zm.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Bv.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Pv.bind(null,e),e.sc.Wo=kv.bind(null,e.eventManager),e.sc.wc=xv.bind(null,e.eventManager),e}function gf(n){const e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Lv.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Fv.bind(null,e),e}class Ym{constructor(){this.synchronizeTabs=!1}initialize(e){var t=this;return(0,k.Z)(function*(){t.yt=Au(e.databaseInfo.databaseId),t.sharedClientState=t.gc(e),t.persistence=t.yc(e),yield t.persistence.start(),t.localStore=t.Ic(e),t.gcScheduler=t.Tc(e,t.localStore),t.indexBackfillerScheduler=t.Ec(e,t.localStore)})()}Tc(e,t){return null}Ec(e,t){return null}Ic(e){return wm(this.persistence,new Im,e.initialUser,this.yt)}yc(e){return new _m(Il.Bs,this.yt)}gc(e){return new Dm}terminate(){var e=this;return(0,k.Z)(function*(){e.gcScheduler&&e.gcScheduler.stop(),yield e.sharedClientState.shutdown(),yield e.persistence.shutdown()})()}}class Jm extends Ym{constructor(e,t,r){super(),this.Ac=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){var t=()=>super.initialize,r=this;return(0,k.Z)(function*(){yield t().call(r,e),yield r.Ac.initialize(r,e),yield gf(r.Ac.syncEngine),yield So(r.Ac.remoteStore),yield r.persistence.li(()=>(r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()))})()}Ic(e){return wm(this.persistence,new Im,e.initialUser,this.yt)}Tc(e,t){return new U_(this.persistence.referenceDelegate.garbageCollector,e.asyncQueue,t)}Ec(e,t){const r=new Mh(t,this.persistence);return new Oh(e.asyncQueue,r)}yc(e){const t=cd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=void 0!==this.cacheSizeBytes?_t.withCacheSize(this.cacheSizeBytes):_t.DEFAULT;return new ud(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,Nm(),kl(),this.yt,this.sharedClientState,!!this.forceOwnership)}gc(e){return new Dm}}class Qv extends Jm{constructor(e,t){super(e,t,!1),this.Ac=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){var t=()=>super.initialize,r=this;return(0,k.Z)(function*(){yield t().call(r,e);const i=r.Ac.syncEngine;r.sharedClientState instanceof _d&&(r.sharedClientState.syncEngine={Fr:$v.bind(null,i),$r:Wv.bind(null,i),Br:Kv.bind(null,i),vi:zv.bind(null,i),Mr:Gv.bind(null,i)},yield r.sharedClientState.start()),yield r.persistence.li(function(){var s=(0,k.Z)(function*(u){yield function jv(n,e){return hf.apply(this,arguments)}(r.Ac.syncEngine,u),r.gcScheduler&&(u&&!r.gcScheduler.started?r.gcScheduler.start():u||r.gcScheduler.stop()),r.indexBackfillerScheduler&&(u&&!r.indexBackfillerScheduler.started?r.indexBackfillerScheduler.start():u||r.indexBackfillerScheduler.stop())});return function(u){return s.apply(this,arguments)}}())})()}gc(e){const t=Nm();if(!_d.C(t))throw new A(E.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");const r=cd(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new _d(t,e.asyncQueue,r,e.clientId,e.initialUser)}}class yf{initialize(e,t){var r=this;return(0,k.Z)(function*(){r.localStore||(r.localStore=e.localStore,r.sharedClientState=e.sharedClientState,r.datastore=r.createDatastore(t),r.remoteStore=r.createRemoteStore(t),r.eventManager=r.createEventManager(t),r.syncEngine=r.createSyncEngine(t,!e.synchronizeTabs),r.sharedClientState.onlineStateHandler=i=>Wm(r.syncEngine,i,1),r.remoteStore.remoteSyncer.handleCredentialChange=qv.bind(null,r.syncEngine),yield Ld(r.remoteStore,r.syncEngine.isPrimaryClient))})()}createEventManager(e){return new Tv}createDatastore(e){const t=Au(e.databaseInfo.databaseId),r=new av(e.databaseInfo);return new lv(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return t=this.localStore,r=this.datastore,i=e.asyncQueue,s=h=>Wm(this.syncEngine,h,0),u=Rm.C()?new Rm:new iv,new fv(t,r,i,s,u);var t,r,i,s,u}createSyncEngine(e,t){return function(r,i,s,u,h,f,m){const g=new Rv(r,i,s,u,h,f);return m&&(g.dc=!0),g}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return(e=(0,k.Z)(function*(t){const r=P(t);D("RemoteStore","RemoteStore shutting down."),r._u.add(5),yield Ao(r),r.mu.shutdown(),r.gu.set("Unknown")}),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}function _f(n,e,t){if(!t)throw new A(E.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function Xm(n,e,t,r){if(!0===e&&!0===r)throw new A(E.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function eg(n){if(!O.isDocumentKey(n))throw new A(E.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function tg(n){if(O.isDocumentKey(n))throw new A(E.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Sl(n){if(void 0===n)return"undefined";if(null===n)return"null";if("string"==typeof n)return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if("number"==typeof n||"boolean"==typeof n)return""+n;if("object"==typeof n){if(n instanceof Array)return"an array";{const e=(t=n).constructor?t.constructor.name:null;return e?`a custom ${e} object`:"an object"}}var t;return"function"==typeof n?"a function":F()}function re(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new A(E.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const t=Sl(n);throw new A(E.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function ng(n,e){if(e<=0)throw new A(E.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}const rg=new Map;class ig{constructor(e){var t;if(void 0===e.host){if(void 0!==e.ssl)throw new A(E.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,void 0===e.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new A(E.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.useFetchStreams=!!e.useFetchStreams,Xm("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling)}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Du{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ig({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new A(E.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new A(E.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ig(e),void 0!==e.credentials&&(this._authCredentials=function(t){if(!t)return new Ua;switch(t.type){case"gapi":return new Rh(t.client,t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new A(E.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=rg.get(e);t&&(D("ComponentProvider","Removing Datastore"),rg.delete(e),t.terminate())}(this),Promise.resolve()}}class _e{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Tn(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new _e(this.firestore,e,this._key)}}class Je{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Je(this.firestore,e,this._query)}}class Tn extends Je{constructor(e,t,r){super(e,t,Mt(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new _e(this.firestore,null,new O(e))}withConverter(e){return new Tn(this.firestore,e,this._path)}}function og(n,e,...t){if(n=(0,ie.m9)(n),_f("collection","path",e),n instanceof Du){const r=ne.fromString(e,...t);return tg(r),new Tn(n,null,r)}{if(!(n instanceof _e||n instanceof Tn))throw new A(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return tg(r),new Tn(n.firestore,null,r)}}function Cl(n,e,...t){if(n=(0,ie.m9)(n),1===arguments.length&&(e=Pc.R()),_f("doc","path",e),n instanceof Du){const r=ne.fromString(e,...t);return eg(r),new _e(n,null,new O(r))}{if(!(n instanceof _e||n instanceof Tn))throw new A(E.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(ne.fromString(e,...t));return eg(r),new _e(n.firestore,n instanceof Tn?n.converter:null,new O(r))}}function ag(n,e){return n=(0,ie.m9)(n),e=(0,ie.m9)(e),(n instanceof _e||n instanceof Tn)&&(e instanceof _e||e instanceof Tn)&&n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter}function vf(n,e){return n=(0,ie.m9)(n),e=(0,ie.m9)(e),n instanceof Je&&e instanceof Je&&n.firestore===e.firestore&&qr(n._query,e._query)&&n.converter===e.converter}function ug(n,e=10240){let t=0;return{read:()=>(0,k.Z)(function*(){if(t<n.byteLength){const r={value:n.slice(t,t+e),done:!1};return t+=e,r}return{done:!0}})(),cancel:()=>(0,k.Z)(function*(){})(),releaseLock(){},closed:Promise.reject("unimplemented")}}class Dl{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.Rc(this.observer.next,e)}error(e){this.observer.error?this.Rc(this.observer.error,e):Ee("Uncaught Error in snapshot listener:",e.toString())}bc(){this.muted=!0}Rc(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}}class Jv{constructor(e,t){this.Pc=e,this.yt=t,this.metadata=new Te,this.buffer=new Uint8Array,this.vc=new TextDecoder("utf-8"),this.Vc().then(r=>{r&&r.Ou()?this.metadata.resolve(r.ku.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is\n             ${JSON.stringify(null==r?void 0:r.ku)}`))},r=>this.metadata.reject(r))}close(){return this.Pc.cancel()}getMetadata(){var e=this;return(0,k.Z)(function*(){return e.metadata.promise})()}mc(){var e=this;return(0,k.Z)(function*(){return yield e.getMetadata(),e.Vc()})()}Vc(){var e=this;return(0,k.Z)(function*(){const t=yield e.Sc();if(null===t)return null;const r=e.vc.decode(t),i=Number(r);isNaN(i)&&e.Dc(`length string (${r}) is not valid number`);const s=yield e.Cc(i);return new Av(JSON.parse(s),t.length+i)})()}xc(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}Sc(){var e=this;return(0,k.Z)(function*(){for(;e.xc()<0&&!(yield e.Nc()););if(0===e.buffer.length)return null;const t=e.xc();t<0&&e.Dc("Reached the end of bundle when a length string is expected.");const r=e.buffer.slice(0,t);return e.buffer=e.buffer.slice(t),r})()}Cc(e){var t=this;return(0,k.Z)(function*(){for(;t.buffer.length<e;)(yield t.Nc())&&t.Dc("Reached the end of bundle when more is expected.");const r=t.vc.decode(t.buffer.slice(0,e));return t.buffer=t.buffer.slice(e),r})()}Dc(e){throw this.Pc.cancel(),new Error(`Invalid bundle format: ${e}`)}Nc(){var e=this;return(0,k.Z)(function*(){const t=yield e.Pc.read();if(!t.done){const r=new Uint8Array(e.buffer.length+t.value.length);r.set(e.buffer),r.set(t.value,e.buffer.length),e.buffer=r}return t.done})()}}class t0{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){var t=this;return(0,k.Z)(function*(){if(t.ensureCommitNotCalled(),t.mutations.length>0)throw new A(E.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");const r=yield(i=(0,k.Z)(function*(s,u){const h=P(s),f=yu(h.yt)+"/documents",m={documents:u.map(x=>gu(h.yt,x))},g=yield h._o("BatchGetDocuments",f,m,u.length),_=new Map;g.forEach(x=>{const S=function e_(n,e){return"found"in e?function(t,r){q(!!r.found);const i=bn(t,r.found.name),s=Oe(r.found.updateTime),u=r.found.createTime?Oe(r.found.createTime):$.min(),h=new Fe({mapValue:{fields:r.found.fields}});return he.newFoundDocument(i,s,u,h)}(n,e):"missing"in e?function(t,r){q(!!r.missing),q(!!r.readTime);const i=bn(t,r.missing),s=Oe(r.readTime);return he.newNoDocument(i,s)}(n,e):F()}(h.yt,x);_.set(S.key.toString(),S)});const w=[];return u.forEach(x=>{const S=_.get(x.toString());q(!!S),w.push(S)}),w}),function(s,u){return i.apply(this,arguments)})(t.datastore,e);var i;return r.forEach(i=>t.recordVersion(i)),r})()}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new vn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){var e=this;return(0,k.Z)(function*(){if(e.ensureCommitNotCalled(),e.lastWriteError)throw e.lastWriteError;const t=e.readVersions;var r;e.mutations.forEach(r=>{t.delete(r.key.toString())}),t.forEach((r,i)=>{const s=O.fromPath(i);e.mutations.push(new _o(s,e.precondition(s)))}),yield(r=(0,k.Z)(function*(i,s){const u=P(i),h=yu(u.yt)+"/documents",f={writes:s.map(m=>_u(u.yt,m))};yield u.ao("Commit",h,f)}),function(i,s){return r.apply(this,arguments)})(e.datastore,e.mutations),e.committed=!0})()}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw F();t=$.min()}const r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new A(E.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual($.min())?v.exists(!1):v.updateTime(t):v.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual($.min()))throw new A(E.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return v.updateTime(t)}return v.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class n0{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.kc=r.maxAttempts,this.xo=new vd(this.asyncQueue,"transaction_retry")}run(){this.kc-=1,this.Oc()}Oc(){var e=this;this.xo.Ro((0,k.Z)(function*(){const t=new t0(e.datastore),r=e.Mc(t);r&&r.then(i=>{e.asyncQueue.enqueueAndForget(()=>t.commit().then(()=>{e.deferred.resolve(i)}).catch(s=>{e.Fc(s)}))}).catch(i=>{e.Fc(i)})}))}Mc(e){try{const t=this.updateFunction(e);return!Ui(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}}Fc(e){this.kc>0&&this.$c(e)?(this.kc-=1,this.asyncQueue.enqueueAndForget(()=>(this.Oc(),Promise.resolve()))):this.deferred.reject(e)}$c(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!ul(t)}return!1}}class r0{constructor(e,t,r,i){var s=this;this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=xe.UNAUTHENTICATED,this.clientId=Pc.R(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,function(){var u=(0,k.Z)(function*(h){D("FirestoreClient","Received user=",h.uid),yield s.authCredentialListener(h),s.user=h});return function(h){return u.apply(this,arguments)}}()),this.appCheckCredentials.start(r,u=>(D("FirestoreClient","Received new app check token=",u),this.appCheckCredentialListener(u,this.user)))}getConfiguration(){var e=this;return(0,k.Z)(function*(){return{asyncQueue:e.asyncQueue,databaseInfo:e.databaseInfo,clientId:e.clientId,authCredentials:e.authCredentials,appCheckCredentials:e.appCheckCredentials,initialUser:e.user,maxConcurrentLimboResolutions:100}})()}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new A(E.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){var e=this;this.asyncQueue.enterRestrictedMode();const t=new Te;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,k.Z)(function*(){try{e.onlineComponents&&(yield e.onlineComponents.terminate()),e.offlineComponents&&(yield e.offlineComponents.terminate()),e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve()}catch(r){const i=Do(r,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}function cg(n,e){return If.apply(this,arguments)}function If(){return If=(0,k.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider");const t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(function(){var i=(0,k.Z)(function*(s){r.isEqual(s)||(yield bm(e.localStore,s),r=s)});return function(s){return i.apply(this,arguments)}}()),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n.offlineComponents=e}),If.apply(this,arguments)}function lg(n,e){return wf.apply(this,arguments)}function wf(){return wf=(0,k.Z)(function*(n,e){n.asyncQueue.verifyOperationInProgress();const t=yield bf(n);D("FirestoreClient","Initializing OnlineComponentProvider");const r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>Vm(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>Vm(e.remoteStore,s)),n.onlineComponents=e}),wf.apply(this,arguments)}function bf(n){return Ef.apply(this,arguments)}function Ef(){return Ef=(0,k.Z)(function*(n){return n.offlineComponents||(D("FirestoreClient","Using default OfflineComponentProvider"),yield cg(n,new Ym)),n.offlineComponents}),Ef.apply(this,arguments)}function Rl(n){return Tf.apply(this,arguments)}function Tf(){return Tf=(0,k.Z)(function*(n){return n.onlineComponents||(D("FirestoreClient","Using default OnlineComponentProvider"),yield lg(n,new yf)),n.onlineComponents}),Tf.apply(this,arguments)}function hg(n){return bf(n).then(e=>e.persistence)}function Nl(n){return bf(n).then(e=>e.localStore)}function kf(n){return Rl(n).then(e=>e.remoteStore)}function xf(n){return Rl(n).then(e=>e.syncEngine)}function Mo(n){return Af.apply(this,arguments)}function Af(){return Af=(0,k.Z)(function*(n){const e=yield Rl(n),t=e.eventManager;return t.onListen=Nv.bind(null,e.syncEngine),t.onUnlisten=Ov.bind(null,e.syncEngine),t}),Af.apply(this,arguments)}function fg(n,e,t={}){const r=new Te;return n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return function(i,s,u,h,f){const m=new Dl({next:_=>{s.enqueueAndForget(()=>Bd(i,g));const w=_.docs.has(u);!w&&_.fromCache?f.reject(new A(E.UNAVAILABLE,"Failed to get document because the client is offline.")):w&&_.fromCache&&h&&"server"===h.source?f.reject(new A(E.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new $d(Mt(u.path),m,{includeMetadataChanges:!0,Nu:!0});return Vd(i,g)}(yield Mo(n),n.asyncQueue,e,t,r)})),r.promise}function pg(n,e,t={}){const r=new Te;return n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return function(i,s,u,h,f){const m=new Dl({next:_=>{s.enqueueAndForget(()=>Bd(i,g)),_.fromCache&&"server"===h.source?f.reject(new A(E.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):f.resolve(_)},error:_=>f.reject(_)}),g=new $d(u,m,{includeMetadataChanges:!0,Nu:!0});return Vd(i,g)}(yield Mo(n),n.asyncQueue,e,t,r)})),r.promise}class d0{constructor(){this.Bc=Promise.resolve(),this.Lc=[],this.qc=!1,this.Uc=[],this.Kc=null,this.Gc=!1,this.Qc=!1,this.jc=[],this.xo=new vd(this,"async_queue_retry"),this.Wc=()=>{const t=kl();t&&D("AsyncQueue","Visibility state changed to "+t.visibilityState),this.xo.Po()};const e=kl();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Wc)}get isShuttingDown(){return this.qc}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.zc(),this.Hc(e)}enterRestrictedMode(e){if(!this.qc){this.qc=!0,this.Qc=e||!1;const t=kl();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Wc)}}enqueue(e){if(this.zc(),this.qc)return new Promise(()=>{});const t=new Te;return this.Hc(()=>this.qc&&this.Qc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Lc.push(e),this.Jc()))}Jc(){var e=this;return(0,k.Z)(function*(){if(0!==e.Lc.length){try{yield e.Lc[0](),e.Lc.shift(),e.xo.reset()}catch(t){if(!cn(t))throw t;D("AsyncQueue","Operation failed with retryable error: "+t)}e.Lc.length>0&&e.xo.Ro(()=>e.Jc())}})()}Hc(e){const t=this.Bc.then(()=>(this.Gc=!0,e().catch(r=>{throw this.Kc=r,this.Gc=!1,Ee("INTERNAL UNHANDLED ERROR: ",function(s){let u=s.message||"";return s.stack&&(u=s.stack.includes(s.message)?s.stack:s.message+"\n"+s.stack),u}(r)),r}).then(r=>(this.Gc=!1,r))));return this.Bc=t,t}enqueueAfterDelay(e,t,r){this.zc(),this.jc.indexOf(e)>-1&&(t=0);const i=Ud.createAndSchedule(this,e,t,r,s=>this.Yc(s));return this.Uc.push(i),i}zc(){this.Kc&&F()}verifyOperationInProgress(){}Xc(){var e=this;return(0,k.Z)(function*(){let t;do{t=e.Bc,yield t}while(t!==e.Bc)})()}Zc(e){for(const t of this.Uc)if(t.timerId===e)return!0;return!1}ta(e){return this.Xc().then(()=>{this.Uc.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(const t of this.Uc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Xc()})}ea(e){this.jc.push(e)}Yc(e){const t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}function Sf(n){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const i of["next","error","complete"])if(i in r&&"function"==typeof r[i])return!0;return!1}(n)}class f0{constructor(){this._progressObserver={},this._taskCompletionResolver=new Te,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}class ve extends Du{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=new d0,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||mg(this),this._firestoreClient.terminate()}}function Me(n){return n._firestoreClient||mg(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function mg(n){var e;const t=n._freezeSettings(),r=(s=(null===(e=n._app)||void 0===e?void 0:e.options.appId)||"",new Ph(n._databaseId,s,n._persistenceKey,(h=t).host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,h.useFetchStreams));var s,h;n._firestoreClient=new r0(n._authCredentials,n._appCheckCredentials,n._queue,r)}function gg(n,e,t){const r=new Te;return n.asyncQueue.enqueue((0,k.Z)(function*(){try{yield cg(n,t),yield lg(n,e),r.resolve()}catch(i){const s=i;if(!("FirebaseError"===(u=s).name?u.code===E.FAILED_PRECONDITION||u.code===E.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&u instanceof DOMException)||22===u.code||20===u.code||11===u.code))throw s;Wn("Error enabling offline persistence. Falling back to persistence disabled: "+s),r.reject(s)}var u})).then(()=>r.promise)}function yg(n){if(n._initialized||n._terminated)throw new A(E.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}class kn{constructor(e){this._byteString=e}static fromBase64String(e){try{return new kn(Re.fromBase64String(e))}catch(t){throw new A(E.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new kn(Re.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}}class lr{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new A(E.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new me(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Yi{constructor(e){this._methodName=e}}class Ol{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new A(E.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new A(E.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return z(this._lat,e._lat)||z(this._long,e._long)}}const E0=/^__.*__$/;class T0{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms):new en(e,this.data,t,this.fieldTransforms)}}class _g{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Lt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function vg(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F()}}class Ml{constructor(e,t,r,i,s,u){this.settings=e,this.databaseId=t,this.yt=r,this.ignoreUndefinedProperties=i,void 0===s&&this.na(),this.fieldTransforms=s||[],this.fieldMask=u||[]}get path(){return this.settings.path}get sa(){return this.settings.sa}ia(e){return new Ml(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.yt,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}ra(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.ua(e),i}ca(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.ia({path:r,oa:!1});return i.na(),i}aa(e){return this.ia({path:void 0,oa:!0})}ha(e){return Fl(e,this.settings.methodName,this.settings.la||!1,this.path,this.settings.fa)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}na(){if(this.path)for(let e=0;e<this.path.length;e++)this.ua(this.path.get(e))}ua(e){if(0===e.length)throw this.ha("Document fields must not be empty");if(vg(this.sa)&&E0.test(e))throw this.ha('Document fields cannot begin and end with "__"')}}class k0{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.yt=r||Au(e)}da(e,t,r,i=!1){return new Ml({sa:e,methodName:t,fa:r,path:me.emptyPath(),oa:!1,la:i},this.databaseId,this.yt,this.ignoreUndefinedProperties)}}function Ji(n){const e=n._freezeSettings(),t=Au(n._databaseId);return new k0(n._databaseId,!!e.ignoreUndefinedProperties,t)}function Pl(n,e,t,r,i,s={}){const u=n.da(s.merge||s.mergeFields?2:0,e,t,i);Nf("Data must be an object, but it was:",u,r);const h=bg(r,u);let f,m;if(s.merge)f=new lt(u.fieldMask),m=u.fieldTransforms;else if(s.mergeFields){const g=[];for(const _ of s.mergeFields){const w=Of(e,_,t);if(!u.contains(w))throw new A(E.INVALID_ARGUMENT,`Field '${w}' is specified in your field mask but missing from your input data.`);Tg(g,w)||g.push(w)}f=new lt(g),m=u.fieldTransforms.filter(_=>f.covers(_.field))}else f=null,m=u.fieldTransforms;return new T0(new Fe(h),f,m)}class Ru extends Yi{_toFieldTransform(e){if(2!==e.sa)throw e.ha(1===e.sa?`${this._methodName}() can only appear at the top level of your update data`:`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Ru}}function Ig(n,e,t){return new Ml({sa:3,fa:e.settings.fa,methodName:n._methodName,oa:t},e.databaseId,e.yt,e.ignoreUndefinedProperties)}class Cf extends Yi{_toFieldTransform(e){return new l(e.path,new _n)}isEqual(e){return e instanceof Cf}}class x0 extends Yi{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Ig(this,e,!0),r=this._a.map(s=>Xi(s,t)),i=new or(r);return new l(e.path,i)}isEqual(e){return this===e}}class A0 extends Yi{constructor(e,t){super(e),this._a=t}_toFieldTransform(e){const t=Ig(this,e,!0),r=this._a.map(s=>Xi(s,t)),i=new ar(r);return new l(e.path,i)}isEqual(e){return this===e}}class S0 extends Yi{constructor(e,t){super(e),this.wa=t}_toFieldTransform(e){const t=new c(e.yt,Pt(e.yt,this.wa));return new l(e.path,t)}isEqual(e){return this===e}}function Df(n,e,t,r){const i=n.da(1,e,t);Nf("Data must be an object, but it was:",i,r);const s=[],u=Fe.empty();Xn(r,(f,m)=>{const g=Ll(e,f,t);m=(0,ie.m9)(m);const _=i.ca(g);if(m instanceof Ru)s.push(g);else{const w=Xi(m,_);null!=w&&(s.push(g),u.set(g,w))}});const h=new lt(s);return new _g(u,h,i.fieldTransforms)}function Rf(n,e,t,r,i,s){const u=n.da(1,e,t),h=[Of(e,r,t)],f=[i];if(s.length%2!=0)throw new A(E.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let w=0;w<s.length;w+=2)h.push(Of(e,s[w])),f.push(s[w+1]);const m=[],g=Fe.empty();for(let w=h.length-1;w>=0;--w)if(!Tg(m,h[w])){const x=h[w];let S=f[w];S=(0,ie.m9)(S);const M=u.ca(x);if(S instanceof Ru)m.push(x);else{const V=Xi(S,M);null!=V&&(m.push(x),g.set(x,V))}}const _=new lt(m);return new _g(g,_,u.fieldTransforms)}function wg(n,e,t,r=!1){return Xi(t,n.da(r?4:3,e))}function Xi(n,e){if(Eg(n=(0,ie.m9)(n)))return Nf("Unsupported field value:",e,n),bg(n,e);if(n instanceof Yi)return function(t,r){if(!vg(r.sa))throw r.ha(`${t._methodName}() can only be used with update() and set()`);if(!r.path)throw r.ha(`${t._methodName}() is not currently supported inside arrays`);const i=t._toFieldTransform(r);i&&r.fieldTransforms.push(i)}(n,e),null;if(void 0===n&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.oa&&4!==e.sa)throw e.ha("Nested arrays are not supported");return function(t,r){const i=[];let s=0;for(const u of t){let h=Xi(u,r.aa(s));null==h&&(h={nullValue:"NULL_VALUE"}),i.push(h),s++}return{arrayValue:{values:i}}}(n,e)}return function(t,r){if(null===(t=(0,ie.m9)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return Pt(r.yt,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const i=pe.fromDate(t);return{timestampValue:Io(r.yt,i)}}if(t instanceof pe){const i=new pe(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:Io(r.yt,i)}}if(t instanceof Ol)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof kn)return{bytesValue:Cp(r.yt,t._byteString)};if(t instanceof _e){const i=r.databaseId,s=t.firestore._databaseId;if(!s.isEqual(i))throw r.ha(`Document reference is for database ${s.projectId}/${s.database} but should be for database ${i.projectId}/${i.database}`);return{referenceValue:jh(t.firestore._databaseId||r.databaseId,t._key.path)}}throw r.ha(`Unsupported field value: ${Sl(t)}`)}(n,e)}function bg(n,e){const t={};return ro(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Xn(n,(r,i)=>{const s=Xi(i,e.ra(r));null!=s&&(t[r]=s)}),{mapValue:{fields:t}}}function Eg(n){return!("object"!=typeof n||null===n||n instanceof Array||n instanceof Date||n instanceof pe||n instanceof Ol||n instanceof kn||n instanceof _e||n instanceof Yi)}function Nf(n,e,t){if(!Eg(t)||"object"!=typeof(r=t)||null===r||Object.getPrototypeOf(r)!==Object.prototype&&null!==Object.getPrototypeOf(r)){const r=Sl(t);throw e.ha("an object"===r?n+" a custom object":n+" "+r)}var r}function Of(n,e,t){if((e=(0,ie.m9)(e))instanceof lr)return e._internalPath;if("string"==typeof e)return Ll(n,e);throw Fl("Field path arguments must be of type string or ",n,!1,void 0,t)}const C0=new RegExp("[~\\*/\\[\\]]");function Ll(n,e,t){if(e.search(C0)>=0)throw Fl(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new lr(...e.split("."))._internalPath}catch(r){throw Fl(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Fl(n,e,t,r,i){const s=r&&!r.isEmpty(),u=void 0!==i;let h=`Function ${e}() called with invalid data`;t&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(s||u)&&(f+=" (found",s&&(f+=` in field ${r}`),u&&(f+=` in document ${i}`),f+=")"),new A(E.INVALID_ARGUMENT,h+n+f)}function Tg(n,e){return n.some(t=>t.isEqual(e))}class Nu{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new _e(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new D0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Ul("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class D0 extends Nu{data(){return super.data()}}function Ul(n,e){return"string"==typeof e?Ll(n,e):e instanceof lr?e._internalPath:e._delegate._internalPath}function kg(n){if("L"===n.limitType&&0===n.explicitOrderBy.length)throw new A(E.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Mf{}class Ou extends Mf{}function zr(n,e,...t){let r=[];e instanceof Mf&&r.push(e),r=r.concat(t),function(i){const s=i.filter(h=>h instanceof Po).length,u=i.filter(h=>h instanceof Mu).length;if(s>1||s>0&&u>0)throw new A(E.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const i of r)n=i._apply(n);return n}class Mu extends Ou{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Mu(e,t,r)}_apply(e){const t=this._parse(e);return Cg(e._query,t),new Je(e.firestore,e.converter,su(e._query,t))}_parse(e){const t=Ji(e.firestore);return function(i,s,u,h,f,m,g){let _;if(f.isKeyField()){if("array-contains"===m||"array-contains-any"===m)throw new A(E.INVALID_ARGUMENT,`Invalid Query. You can't perform '${m}' queries on documentId().`);if("in"===m||"not-in"===m){Sg(g,m);const w=[];for(const x of g)w.push(Ag(h,i,x));_={arrayValue:{values:w}}}else _=Ag(h,i,g)}else"in"!==m&&"not-in"!==m&&"array-contains-any"!==m||Sg(g,m),_=wg(u,"where",g,"in"===m||"not-in"===m);return J.create(f,m,_)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value)}}class Po extends Mf{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new Po(e,t)}_parse(e){const t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return 1===t.length?t[0]:ae.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(r,i){let s=r;const u=i.getFlattenedFilters();for(const h of u)Cg(s,h),s=su(s,h)}(e._query,t),new Je(e.firestore,e.converter,su(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Pf extends Ou{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Pf(e,t)}_apply(e){const t=function(r,i,s){if(null!==r.startAt)throw new A(E.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==r.endAt)throw new A(E.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");const u=new Fr(i,s);return function(h,f){if(null===iu(h)){const m=Vr(h);null!==m&&Dg(0,m,f.field)}}(r,u),u}(e._query,this._field,this._direction);return new Je(e.firestore,e.converter,function(r,i){const s=r.explicitOrderBy.concat([i]);return new Xt(r.path,r.collectionGroup,s,r.filters.slice(),r.limit,r.limitType,r.startAt,r.endAt)}(e._query,t))}}class Vl extends Ou{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new Vl(e,t,r)}_apply(e){return new Je(e.firestore,e.converter,bt(e._query,this._limit,this._limitType))}}class ql extends Ou{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new ql(e,t,r)}_apply(e){const t=xg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(i=t,new Xt((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,i,r.endAt)));var r,i}}class Bl extends Ou{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new Bl(e,t,r)}_apply(e){const t=xg(e,this.type,this._docOrFields,this._inclusive);return new Je(e.firestore,e.converter,(i=t,new Xt((r=e._query).path,r.collectionGroup,r.explicitOrderBy.slice(),r.filters.slice(),r.limit,r.limitType,r.startAt,i)));var r,i}}function xg(n,e,t,r){if(t[0]=(0,ie.m9)(t[0]),t[0]instanceof Nu)return function(i,s,u,h,f){if(!h)throw new A(E.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${u}().`);const m=[];for(const g of sr(i))if(g.field.isKeyField())m.push(rr(s,h.key));else{const _=h.data.field(g.field);if(Ka(_))throw new A(E.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+g.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===_){const w=g.field.canonicalString();throw new A(E.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${w}' (used as the orderBy) does not exist.`)}m.push(_)}return new Nt(m,f)}(n._query,n.firestore._databaseId,e,t[0]._document,r);{const i=Ji(n.firestore);return function(s,u,h,f,m,g){const _=s.explicitOrderBy;if(m.length>_.length)throw new A(E.INVALID_ARGUMENT,`Too many arguments provided to ${f}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);const w=[];for(let x=0;x<m.length;x++){const S=m[x];if(_[x].field.isKeyField()){if("string"!=typeof S)throw new A(E.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${f}(), but got a ${typeof S}`);if(!Gi(s)&&-1!==S.indexOf("/"))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${f}() must be a plain document ID, but '${S}' contains a slash.`);const M=s.path.child(ne.fromString(S));if(!O.isDocumentKey(M))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${f}() must result in a valid document path, but '${M}' is not because it contains an odd number of segments.`);const V=new O(M);w.push(rr(u,V))}else{const M=wg(h,f,S);w.push(M)}}return new Nt(w,g)}(n._query,n.firestore._databaseId,i,e,t,r)}}function Ag(n,e,t){if("string"==typeof(t=(0,ie.m9)(t))){if(""===t)throw new A(E.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Gi(e)&&-1!==t.indexOf("/"))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);const r=e.path.child(ne.fromString(t));if(!O.isDocumentKey(r))throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return rr(n,new O(r))}if(t instanceof _e)return rr(n,t._key);throw new A(E.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Sl(t)}.`)}function Sg(n,e){if(!Array.isArray(n)||0===n.length)throw new A(E.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`);if(n.length>10)throw new A(E.INVALID_ARGUMENT,`Invalid Query. '${e.toString()}' filters support a maximum of 10 elements in the value array.`)}function Cg(n,e){if(e.isInequality()){const r=Vr(n),i=e.field;if(null!==r&&!r.isEqual(i))throw new A(E.INVALID_ARGUMENT,`Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '${r.toString()}' and '${i.toString()}'`);const s=iu(n);null!==s&&Dg(0,i,s)}const t=function(r,i){for(const s of r)for(const u of s.getFlattenedFilters())if(i.indexOf(u.op)>=0)return u.op;return null}(n.filters,function(r){switch(r){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==t)throw new A(E.INVALID_ARGUMENT,t===e.op?`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`:`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function Dg(n,e,t){if(!t.isEqual(e))throw new A(E.INVALID_ARGUMENT,`Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '${e.toString()}' and so you must also use '${e.toString()}' as your first argument to orderBy(), but your first orderBy() is on field '${t.toString()}' instead.`)}class Lf{convertValue(e,t="none"){switch(dn(e)){case 0:return null;case 1:return e.booleanValue;case 2:return we(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(er(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw F()}}convertObject(e,t){const r={};return Xn(e.fields,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new Ol(we(e.latitude),we(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=io(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(qi(e));default:return null}}convertTimestamp(e){const t=hn(e);return new pe(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=ne.fromString(e);q(Vp(r));const i=new ln(r.get(1),r.get(3)),s=new O(r.popFirst(5));return i.isEqual(t)||Ee(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function Zl(n,e,t){let r;return r=n?t&&(t.merge||t.mergeFields)?n.toFirestore(e,t):n.toFirestore(e):e,r}class V0 extends Lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new kn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new _e(this.firestore,null,t)}}class es{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class hr extends Nu{constructor(e,t,r,i,s,u){super(e,t,r,i,u),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new Pu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const r=this._document.data.field(Ul("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}}class Pu extends hr{data(e={}){return super.data(e)}}class Wr{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new es(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Pu(this._firestore,this._userDataWriter,r.key,r,new es(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new A(E.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(r,i){if(r._snapshot.oldDocs.isEmpty()){let s=0;return r._snapshot.docChanges.map(u=>({type:"added",doc:new Pu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new es(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter),oldIndex:-1,newIndex:s++}))}{let s=r._snapshot.oldDocs;return r._snapshot.docChanges.filter(u=>i||3!==u.type).map(u=>{const h=new Pu(r._firestore,r._userDataWriter,u.doc.key,u.doc,new es(r._snapshot.mutatedKeys.has(u.doc.key),r._snapshot.fromCache),r.query.converter);let f=-1,m=-1;return 0!==u.type&&(f=s.indexOf(u.doc.key),s=s.delete(u.doc.key)),1!==u.type&&(s=s.add(u.doc),m=s.indexOf(u.doc.key)),{type:q0(u.type),doc:h,oldIndex:f,newIndex:m}})}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}function q0(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F()}}function Ng(n,e){return n instanceof hr&&e instanceof hr?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(null===n._document?null===e._document:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Wr&&e instanceof Wr&&n._firestore===e._firestore&&vf(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot)}class Kr extends Lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new kn(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new _e(this.firestore,null,t)}}function Og(n,e,t){n=re(n,_e);const r=re(n.firestore,ve),i=Zl(n.converter,e,t);return Lo(r,[Pl(Ji(r),"setDoc",n._key,i,null!==n.converter,t).toMutation(n._key,v.none())])}function Mg(n,e,t,...r){n=re(n,_e);const i=re(n.firestore,ve),s=Ji(i);let u;return u="string"==typeof(e=(0,ie.m9)(e))||e instanceof lr?Rf(s,"updateDoc",n._key,e,t,r):Df(s,"updateDoc",n._key,e),Lo(i,[u.toMutation(n._key,v.exists(!0))])}function Pg(n,...e){var t,r,i;n=(0,ie.m9)(n);let s={includeMetadataChanges:!1},u=0;"object"!=typeof e[u]||Sf(e[u])||(s=e[u],u++);const h={includeMetadataChanges:s.includeMetadataChanges};if(Sf(e[u])){const _=e[u];e[u]=null===(t=_.next)||void 0===t?void 0:t.bind(_),e[u+1]=null===(r=_.error)||void 0===r?void 0:r.bind(_),e[u+2]=null===(i=_.complete)||void 0===i?void 0:i.bind(_)}let f,m,g;if(n instanceof _e)m=re(n.firestore,ve),g=Mt(n._key.path),f={next:_=>{e[u]&&e[u](Ff(m,n,_))},error:e[u+1],complete:e[u+2]};else{const _=re(n,Je);m=re(_.firestore,ve),g=_._query;const w=new Kr(m);f={next:x=>{e[u]&&e[u](new Wr(m,w,_,x))},error:e[u+1],complete:e[u+2]},kg(n._query)}return function(_,w,x,S){const M=new Dl(S),V=new $d(w,M,x);return _.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return Vd(yield Mo(_),V)})),()=>{M.bc(),_.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return Bd(yield Mo(_),V)}))}}(Me(m),g,h,f)}function Lo(n,e){return function(t,r){const i=new Te;return t.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return function Mv(n,e,t){return Hd.apply(this,arguments)}(yield xf(t),r,i)})),i.promise}(Me(n),e)}function Ff(n,e,t){const r=t.docs.get(e._key),i=new Kr(n);return new hr(n,i,e._key,r,new es(t.hasPendingWrites,t.fromCache),e.converter)}const Q0={maxAttempts:5};class Lg{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ji(e)}set(e,t,r){this._verifyNotCommitted();const i=Hr(e,this._firestore),s=Zl(i.converter,t,r),u=Pl(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,r);return this._mutations.push(u.toMutation(i._key,v.none())),this}update(e,t,r,...i){this._verifyNotCommitted();const s=Hr(e,this._firestore);let u;return u="string"==typeof(t=(0,ie.m9)(t))||t instanceof lr?Rf(this._dataReader,"WriteBatch.update",s._key,t,r,i):Df(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(u.toMutation(s._key,v.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Hr(e,this._firestore);return this._mutations=this._mutations.concat(new vn(t._key,v.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new A(E.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Hr(n,e){if((n=(0,ie.m9)(n)).firestore!==e)throw new A(E.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}class Y0 extends class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ji(e)}get(e){const t=Hr(e,this._firestore),r=new V0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||1!==i.length)return F();const s=i[0];if(s.isFoundDocument())return new Nu(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Nu(this._firestore,r,t._key,null,t.converter);throw F()})}set(e,t,r){const i=Hr(e,this._firestore),s=Zl(i.converter,t,r),u=Pl(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,r);return this._transaction.set(i._key,u),this}update(e,t,r,...i){const s=Hr(e,this._firestore);let u;return u="string"==typeof(t=(0,ie.m9)(t))||t instanceof lr?Rf(this._dataReader,"Transaction.update",s._key,t,r,i):Df(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,u),this}delete(e){const t=Hr(e,this._firestore);return this._transaction.delete(t._key),this}}{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Hr(e,this._firestore),r=new Kr(this._firestore);return super.get(e).then(i=>new hr(this._firestore,r,t._key,i._document,new es(!1,!1),t.converter))}}function Uf(n,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new A("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function Ug(){if("undefined"==typeof Uint8Array)throw new A("unimplemented","Uint8Arrays are not available in this environment.")}function Vg(){if(!function Lh(){return"undefined"!=typeof atob}())throw new A("unimplemented","Blobs are unavailable in Firestore in this environment.")}!function(n,e=!0){Pr=st.SDK_VERSION,(0,st._registerComponent)(new Gt.wA("firestore",(t,{instanceIdentifier:r,options:i})=>{const s=t.getProvider("app").getImmediate(),u=new ve(new Dh(t.getProvider("auth-internal")),new qa(t.getProvider("app-check-internal")),function(h,f){if(!Object.prototype.hasOwnProperty.apply(h.options,["projectId"]))throw new A(E.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ln(h.options.projectId,f)}(s,r),s);return i=Object.assign({useFetchStreams:e},i),u._setSettings(i),u},"PUBLIC").setMultipleInstances(!0)),(0,st.registerVersion)(Ni,"3.8.0",n),(0,st.registerVersion)(Ni,"3.8.0","esm2017")}();class Lu{constructor(e){this._delegate=e}static fromBase64String(e){return Vg(),new Lu(kn.fromBase64String(e))}static fromUint8Array(e){return Ug(),new Lu(kn.fromUint8Array(e))}toBase64(){return Vg(),this._delegate.toBase64()}toUint8Array(){return Ug(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}}function Vf(n){return function oI(n,e){if("object"!=typeof n||null===n)return!1;const t=n;for(const r of e)if(r in t&&"function"==typeof t[r])return!0;return!1}(n,["next","error","complete"])}class aI{enableIndexedDbPersistence(e,t){return function m0(n,e){yg(n=re(n,ve));const t=Me(n),r=n._freezeSettings(),i=new yf;return gg(t,i,new Jm(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return function g0(n){yg(n=re(n,ve));const e=Me(n),t=n._freezeSettings(),r=new yf;return gg(e,r,new Qv(r,t.cacheSizeBytes))}(e._delegate)}clearIndexedDbPersistence(e){return function y0(n){if(n._initialized&&!n._terminated)throw new A(E.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");const e=new Te;return n._queue.enqueueAndForgetEvenWhileRestricted((0,k.Z)(function*(){try{yield(t=(0,k.Z)(function*(r){if(!wt.C())return Promise.resolve();const i=r+"main";yield wt.delete(i)}),function(r){return t.apply(this,arguments)})(cd(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}var t})),e.promise}(e._delegate)}}class qg{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof ln||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){const t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&Wn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}useEmulator(e,t,r={}){!function sg(n,e,t,r={}){var i;const s=(n=re(n,Du))._getSettings();if("firestore.googleapis.com"!==s.host&&s.host!==e&&Wn("Host has been set in both settings() and useEmulator(), emulator host will be used"),n._setSettings(Object.assign(Object.assign({},s),{host:`${e}:${t}`,ssl:!1})),r.mockUserToken){let u,h;if("string"==typeof r.mockUserToken)u=r.mockUserToken,h=xe.MOCK_USER;else{u=(0,ie.Sg)(r.mockUserToken,null===(i=n._app)||void 0===i?void 0:i.options.projectId);const f=r.mockUserToken.sub||r.mockUserToken.user_id;if(!f)throw new A(E.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new xe(f)}n._authCredentials=new Va(new Nc(u,h))}}(this._delegate,e,t,r)}enableNetwork(){return function v0(n){return function s0(n){return n.asyncQueue.enqueue((0,k.Z)(function*(){const e=yield hg(n),t=yield kf(n);return e.setNetworkEnabled(!0),function(r){const i=P(r);return i._u.delete(0),Su(i)}(t)}))}(Me(n=re(n,ve)))}(this._delegate)}disableNetwork(){return function I0(n){return function o0(n){return n.asyncQueue.enqueue((0,k.Z)(function*(){const e=yield hg(n),t=yield kf(n);return e.setNetworkEnabled(!1),(r=(0,k.Z)(function*(i){const s=P(i);s._u.add(0),yield Ao(s),s.gu.set("Offline")}),function(i){return r.apply(this,arguments)})(t);var r}))}(Me(n=re(n,ve)))}(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,Xm("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return function _0(n){return function(e){const t=new Te;return e.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return function Uv(n,e){return ef.apply(this,arguments)}(yield xf(e),t)})),t.promise}(Me(n=re(n,ve)))}(this._delegate)}onSnapshotsInSync(e){return function H0(n,e){return function c0(n,e){const t=new Dl(e);return n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return r=yield Mo(n),i=t,P(r).Ru.add(i),void i.next();var r,i})),()=>{t.bc(),n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return r=yield Mo(n),i=t,void P(r).Ru.delete(i);var r,i}))}}(Me(n=re(n,ve)),Sf(e)?e:{next:e})}(this._delegate,e)}get app(){if(!this._appCompat)throw new A("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Fo(this,og(this._delegate,e))}catch(t){throw dt(t,"collection()","Firestore.collection()")}}doc(e){try{return new Ft(this,Cl(this._delegate,e))}catch(t){throw dt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new ft(this,function Yv(n,e){if(n=re(n,Du),_f("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new A(E.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new Je(n,null,(t=e,new Xt(ne.emptyPath(),t)));var t}(this._delegate,e))}catch(t){throw dt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return function J0(n,e,t){n=re(n,ve);const r=Object.assign(Object.assign({},Q0),t);return function(i){if(i.maxAttempts<1)throw new A(E.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(i,s,u){const h=new Te;return i.asyncQueue.enqueueAndForget((0,k.Z)(function*(){const f=yield function dg(n){return Rl(n).then(e=>e.datastore)}(i);new n0(i.asyncQueue,f,u,s,h).run()})),h.promise}(Me(n),i=>e(new Y0(n,i)),r)}(this._delegate,t=>e(new Bg(this,t)))}batch(){return Me(this._delegate),new Zg(new Lg(this._delegate,e=>Lo(this._delegate,e)))}loadBundle(e){return function w0(n,e){const t=Me(n=re(n,ve)),r=new f0;return function l0(n,e,t,r){const i=function(s,u){let h;return h="string"==typeof s?(new TextEncoder).encode(s):s,f=function(f,m){if(f instanceof Uint8Array)return ug(f,m);if(f instanceof ArrayBuffer)return ug(new Uint8Array(f),m);if(f instanceof ReadableStream)return f.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}(h),new Jv(f,u);var f}(t,Au(e));n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){!function Hv(n,e,t){const r=P(n);var i;(i=(0,k.Z)(function*(s,u,h){try{const f=yield u.getMetadata();if(yield function(w,x){const S=P(w),M=Oe(x.createTime);return S.persistence.runTransaction("hasNewerBundle","readonly",V=>S.Ns.getBundleMetadata(V,x.id)).then(V=>!!V&&V.createTime.compareTo(M)>=0)}(s.localStore,f))return yield u.close(),h._completeWith({taskState:"Success",documentsLoaded:(w=f).totalDocuments,bytesLoaded:w.totalBytes,totalDocuments:w.totalDocuments,totalBytes:w.totalBytes}),Promise.resolve(new Set);h._updateProgress(Zm(f));const m=new Sv(f,s.localStore,u.yt);let g=yield u.mc();for(;g;){const w=yield m.Fu(g);w&&h._updateProgress(w),g=yield u.mc()}const _=yield m.complete();return yield cr(s,_.Lu,void 0),yield function(w,x){const S=P(w);return S.persistence.runTransaction("Save bundle","readwrite",M=>S.Ns.saveBundleMetadata(M,x))}(s.localStore,f),h._completeWith(_.progress),Promise.resolve(_.Bu)}catch(f){return Wn("SyncEngine",`Loading bundle failed with ${f}`),h._failWith(f),Promise.resolve(new Set)}var w}),function(s,u,h){return i.apply(this,arguments)})(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}(yield xf(n),i,r)}))}(t,n._databaseId,e,r),r}(this._delegate,e)}namedQuery(e){return function b0(n,e){return function h0(n,e){return n.asyncQueue.enqueue((0,k.Z)(function*(){return function(t,r){const i=P(t);return i.persistence.runTransaction("Get named query","readonly",s=>i.Ns.getNamedQuery(s,r))}(yield Nl(n),e)}))}(Me(n=re(n,ve)),e).then(t=>t?new Je(n,null,t.query):null)}(this._delegate,e).then(t=>t?new ft(this,t):null)}}class Gl extends Lf{constructor(e){super(),this.firestore=e}convertBytes(e){return new Lu(new kn(e))}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return Ft.forKey(t,this.firestore,null)}}class Bg{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new Gl(e)}get(e){const t=ns(e);return this._delegate.get(t).then(r=>new Fu(this._firestore,new hr(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){const i=ns(e);return r?(Uf("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ns(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ns(e);return this._delegate.delete(t),this}}class Zg{constructor(e){this._delegate=e}set(e,t,r){const i=ns(e);return r?(Uf("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){const s=ns(e);return 2===arguments.length?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){const t=ns(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}}class ts{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){const r=new Pu(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Uu(this._firestore,r),null!=t?t:{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){const r=ts.INSTANCES;let i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new ts(e,new Gl(e),t),i.set(t,s)),s}}ts.INSTANCES=new WeakMap;class Ft{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Gl(e)}static forPath(e,t,r){if(e.length%2!=0)throw new A("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new Ft(t,new _e(t._delegate,r,new O(e)))}static forKey(e,t,r){return new Ft(t,new _e(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Fo(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Fo(this.firestore,og(this._delegate,e))}catch(t){throw dt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return(e=(0,ie.m9)(e))instanceof _e&&ag(this._delegate,e)}set(e,t){t=Uf("DocumentReference.set",t);try{return t?Og(this._delegate,e,t):Og(this._delegate,e)}catch(r){throw dt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return 1===arguments.length?Mg(this._delegate,e):Mg(this._delegate,e,t,...r)}catch(i){throw dt(i,"updateDoc()","DocumentReference.update()")}}delete(){return function W0(n){return Lo(re(n.firestore,ve),[new vn(n._key,v.none())])}(this._delegate)}onSnapshot(...e){const t=Gg(e),r=$g(e,i=>new Fu(this.firestore,new hr(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return Pg(this._delegate,t,r)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function Z0(n){n=re(n,_e);const e=re(n.firestore,ve),t=Me(e),r=new Kr(e);return function a0(n,e){const t=new Te;return n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return(r=(0,k.Z)(function*(i,s,u){try{const h=yield function(f,m){const g=P(f);return g.persistence.runTransaction("read document","readonly",_=>g.localDocuments.getDocument(_,m))}(i,s);h.isFoundDocument()?u.resolve(h):h.isNoDocument()?u.resolve(null):u.reject(new A(E.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(h){const f=Do(h,`Failed to get document '${s} from cache`);u.reject(f)}}),function(i,s,u){return r.apply(this,arguments)})(yield Nl(n),e,t);var r})),t.promise}(t,n._key).then(i=>new hr(e,r,n._key,i,new es(null!==i&&i.hasLocalMutations,!0),n.converter))}(this._delegate):"server"===(null==e?void 0:e.source)?function G0(n){n=re(n,_e);const e=re(n.firestore,ve);return fg(Me(e),n._key,{source:"server"}).then(t=>Ff(e,n,t))}(this._delegate):function B0(n){n=re(n,_e);const e=re(n.firestore,ve);return fg(Me(e),n._key).then(t=>Ff(e,n,t))}(this._delegate),t.then(r=>new Fu(this.firestore,new hr(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new Ft(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}function dt(n,e,t){return n.message=n.message.replace(e,t),n}function Gg(n){for(const e of n)if("object"==typeof e&&!Vf(e))return e;return{}}function $g(n,e){var t,r;let i;return i=Vf(n[0])?n[0]:Vf(n[1])?n[1]:"function"==typeof n[0]?{next:n[0],error:n[1],complete:n[2]}:{next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:null===(t=i.error)||void 0===t?void 0:t.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}class Fu{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new Ft(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return Ng(this._delegate,e._delegate)}}class Uu extends Fu{data(e){const t=this._delegate.data(e);return function Ch(n,e){n||F()}(void 0!==t),t}}class ft{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new Gl(e)}where(e,t,r){try{return new ft(this.firestore,zr(this._delegate,function R0(n,e,t){const r=e,i=Ul("where",n);return Mu._create(i,r,t)}(e,t,r)))}catch(i){throw dt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new ft(this.firestore,zr(this._delegate,function N0(n,e="asc"){const t=e,r=Ul("orderBy",n);return Pf._create(r,t)}(e,t)))}catch(r){throw dt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new ft(this.firestore,zr(this._delegate,function O0(n){return ng("limit",n),Vl._create("limit",n,"F")}(e)))}catch(t){throw dt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new ft(this.firestore,zr(this._delegate,function M0(n){return ng("limitToLast",n),Vl._create("limitToLast",n,"L")}(e)))}catch(t){throw dt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new ft(this.firestore,zr(this._delegate,function P0(...n){return ql._create("startAt",n,!0)}(...e)))}catch(t){throw dt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new ft(this.firestore,zr(this._delegate,function L0(...n){return ql._create("startAfter",n,!1)}(...e)))}catch(t){throw dt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new ft(this.firestore,zr(this._delegate,function F0(...n){return Bl._create("endBefore",n,!1)}(...e)))}catch(t){throw dt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new ft(this.firestore,zr(this._delegate,function U0(...n){return Bl._create("endAt",n,!0)}(...e)))}catch(t){throw dt(t,"endAt()","Query.endAt()")}}isEqual(e){return vf(this._delegate,e._delegate)}get(e){let t;return t="cache"===(null==e?void 0:e.source)?function j0(n){n=re(n,Je);const e=re(n.firestore,ve),t=Me(e),r=new Kr(e);return function u0(n,e){const t=new Te;return n.asyncQueue.enqueueAndForget((0,k.Z)(function*(){return(r=(0,k.Z)(function*(i,s,u){try{const h=yield bl(i,s,!0),f=new jm(s,h.Hi),m=f.Wu(h.documents),g=f.applyChanges(m,!1);u.resolve(g.snapshot)}catch(h){const f=Do(h,`Failed to execute query '${s} against cache`);u.reject(f)}}),function(i,s,u){return r.apply(this,arguments)})(yield Nl(n),e,t);var r})),t.promise}(t,n._query).then(i=>new Wr(e,r,n,i))}(this._delegate):"server"===(null==e?void 0:e.source)?function z0(n){n=re(n,Je);const e=re(n.firestore,ve),t=Me(e),r=new Kr(e);return pg(t,n._query,{source:"server"}).then(i=>new Wr(e,r,n,i))}(this._delegate):function $0(n){n=re(n,Je);const e=re(n.firestore,ve),t=Me(e),r=new Kr(e);return kg(n._query),pg(t,n._query).then(i=>new Wr(e,r,n,i))}(this._delegate),t.then(r=>new qf(this.firestore,new Wr(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){const t=Gg(e),r=$g(e,i=>new qf(this.firestore,new Wr(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return Pg(this._delegate,t,r)}withConverter(e){return new ft(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}class cI{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new Uu(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}}class qf{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new ft(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new Uu(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new cI(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new Uu(this._firestore,r))})}isEqual(e){return Ng(this._delegate,e._delegate)}}class Fo extends ft{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){const e=this._delegate.parent;return e?new Ft(this.firestore,e):null}doc(e){try{return new Ft(this.firestore,void 0===e?Cl(this._delegate):Cl(this._delegate,e))}catch(t){throw dt(t,"doc()","CollectionReference.doc()")}}add(e){return function K0(n,e){const t=re(n.firestore,ve),r=Cl(n),i=Zl(n.converter,e);return Lo(t,[Pl(Ji(n.firestore),"addDoc",r._key,i,null!==n.converter,{}).toMutation(r._key,v.exists(!1))]).then(()=>r)}(this._delegate,e).then(t=>new Ft(this.firestore,t))}isEqual(e){return ag(this._delegate,e._delegate)}withConverter(e){return new Fo(this.firestore,this._delegate.withConverter(e?ts.getInstance(this.firestore,e):null))}}function ns(n){return re(n,_e)}class Bf{constructor(...e){this._delegate=new lr(...e)}static documentId(){return new Bf(me.keyField().canonicalString())}isEqual(e){return(e=(0,ie.m9)(e))instanceof lr&&this._delegate._internalPath.isEqual(e._internalPath)}}class rs{constructor(e){this._delegate=e}static serverTimestamp(){const e=function eI(){return new Cf("serverTimestamp")}();return e._methodName="FieldValue.serverTimestamp",new rs(e)}static delete(){const e=function X0(){return new Ru("deleteField")}();return e._methodName="FieldValue.delete",new rs(e)}static arrayUnion(...e){const t=function tI(...n){return new x0("arrayUnion",n)}(...e);return t._methodName="FieldValue.arrayUnion",new rs(t)}static arrayRemove(...e){const t=function nI(...n){return new A0("arrayRemove",n)}(...e);return t._methodName="FieldValue.arrayRemove",new rs(t)}static increment(e){const t=function rI(n){return new S0("increment",n)}(e);return t._methodName="FieldValue.increment",new rs(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}}const lI={Firestore:qg,GeoPoint:Ol,Timestamp:pe,Blob:Lu,Transaction:Bg,WriteBatch:Zg,DocumentReference:Ft,DocumentSnapshot:Fu,Query:ft,QueryDocumentSnapshot:Uu,QuerySnapshot:qf,CollectionReference:Fo,FieldPath:Bf,FieldValue:rs,setLogLevel:function uI(n){!function zn(n){Ct.setLogLevel(n)}(n)},CACHE_SIZE_UNLIMITED:-1};!function dI(n){(function hI(n,e){n.INTERNAL.registerComponent(new Gt.wA("firestore-compat",t=>{const r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},lI)))})(n,(e,t)=>new qg(e,t,new aI)),n.registerVersion("@firebase/firestore-compat","0.3.0")}(vr.Z);var jg=L(6451),$l=L(5363),Qr=L(3900),zg=L(3151),fI=L(590),pI=L(576);function Wg(n,e){return(0,pI.m)(e)?(0,Qr.w)(()=>n,e):(0,Qr.w)(()=>n)}var Zf=L(9468);L(259);const $f=new Map,Hg={activated:!1,tokenObservers:[]},vI={initialized:!1,enabled:!1};function Xe(n){return $f.get(n)||Object.assign({},Hg)}function zl(){return vI}class kI{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){var t=this;return(0,k.Z)(function*(){t.stop();try{t.pending=new ie.BH,yield function xI(n){return new Promise(e=>{setTimeout(e,n)})}(t.getNextRun(e)),t.pending.resolve(),yield t.pending.promise,t.pending=new ie.BH,yield t.operation(),t.pending.resolve(),yield t.pending.promise,t.process(!0).catch(()=>{})}catch(r){t.retryPolicy(r)?t.process(!1).catch(()=>{}):t.stop()}})()}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{const t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}}const pt=new ie.LL("appCheck","AppCheck",{"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"});function Yg(n){if(!Xe(n).activated)throw pt.create("use-before-activation",{appName:n.name})}function Wf(n,e){return Kf.apply(this,arguments)}function Kf(){return Kf=(0,k.Z)(function*({url:n,body:e},t){const r={"Content-Type":"application/json"},i=t.getImmediate({optional:!0});if(i){const _=yield i.getHeartbeatsHeader();_&&(r["X-Firebase-Client"]=_)}const s={method:"POST",body:JSON.stringify(e),headers:r};let u,h;try{u=yield fetch(n,s)}catch(_){throw pt.create("fetch-network-error",{originalErrorMessage:null==_?void 0:_.message})}if(200!==u.status)throw pt.create("fetch-status-error",{httpStatus:u.status});try{h=yield u.json()}catch(_){throw pt.create("fetch-parse-error",{originalErrorMessage:null==_?void 0:_.message})}const f=h.ttl.match(/^([\d.]+)(s)$/);if(!f||!f[2]||isNaN(Number(f[1])))throw pt.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${h.ttl}`});const m=1e3*Number(f[1]),g=Date.now();return{token:h.token,expireTimeMillis:g+m,issuedAtTimeMillis:g}}),Kf.apply(this,arguments)}function DI(n,e){const{projectId:t,appId:r,apiKey:i}=n.options;return{url:`https://content-firebaseappcheck.googleapis.com/v1/projects/${t}/apps/${r}:exchangeDebugToken?key=${i}`,body:{debug_token:e}}}const Vu="firebase-app-check-store";let Hl=null;function Xg(){return Hl||(Hl=new Promise((n,e)=>{try{const t=indexedDB.open("firebase-app-check-database",1);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(pt.create("storage-open",{originalErrorMessage:null===(i=r.target.error)||void 0===i?void 0:i.message}))},t.onupgradeneeded=r=>{0===r.oldVersion&&r.target.result.createObjectStore(Vu,{keyPath:"compositeKey"})}}catch(t){e(pt.create("storage-open",{originalErrorMessage:null==t?void 0:t.message}))}}),Hl)}function Hf(){return Hf=(0,k.Z)(function*(n,e){const r=(yield Xg()).transaction(Vu,"readwrite"),s=r.objectStore(Vu).put({compositeKey:n,value:e});return new Promise((u,h)=>{s.onsuccess=f=>{u()},r.onerror=f=>{var m;h(pt.create("storage-set",{originalErrorMessage:null===(m=f.target.error)||void 0===m?void 0:m.message}))}})}),Hf.apply(this,arguments)}const qu=new $t.Yd("@firebase/app-check");function Jf(n,e){return(0,ie.hl)()?function MI(n,e){return function ey(n,e){return Hf.apply(this,arguments)}(function ny(n){return`${n.options.appId}-${n.name}`}(n),e)}(n,e).catch(t=>{qu.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function ry(){return zl().enabled}function iy(){return ep.apply(this,arguments)}function ep(){return ep=(0,k.Z)(function*(){const n=zl();if(n.enabled&&n.token)return n.token.promise;throw Error("\n            Can't get debug token in production mode.\n        ")}),ep.apply(this,arguments)}const qI={error:"UNKNOWN_ERROR"};function BI(n){return ie.US.encodeString(JSON.stringify(n),!1)}function Ql(n){return tp.apply(this,arguments)}function tp(){return tp=(0,k.Z)(function*(n,e=!1){const t=n.app;Yg(t);const r=Xe(t);let s,i=r.token;if(i&&!Uo(i)&&(r.token=void 0,i=void 0),!i){const f=yield r.cachedTokenPromise;f&&(Uo(f)?i=f:yield Jf(t,void 0))}if(!e&&i&&Uo(i))return{token:i.token};let h,u=!1;if(ry()){r.exchangeTokenPromise||(r.exchangeTokenPromise=Wf(DI(t,yield iy()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),u=!0);const f=yield r.exchangeTokenPromise;return yield Jf(t,f),r.token=f,{token:f.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),u=!0),i=yield Xe(t).exchangeTokenPromise}catch(f){"appCheck/throttled"===f.code?qu.warn(f.message):qu.error(f),s=f}return i?s?h=Uo(i)?{token:i.token,internalError:s}:ay(s):(h={token:i.token},r.token=i,yield Jf(t,i)):h=ay(s),u&&oy(t,h),h}),tp.apply(this,arguments)}function rp(n,e){const t=Xe(n),r=t.tokenObservers.filter(i=>i.next!==e);0===r.length&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function sy(n){const{app:e}=n,t=Xe(e);let r=t.tokenRefresher;r||(r=function ZI(n){const{app:e}=n;return new kI((0,k.Z)(function*(){let r;if(r=Xe(e).token?yield Ql(n,!0):yield Ql(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{const t=Xe(e);if(t.token){let r=t.token.issuedAtTimeMillis+.5*(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)+3e5;return r=Math.min(r,t.token.expireTimeMillis-3e5),Math.max(0,r-Date.now())}return 0},3e4,96e4)}(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function oy(n,e){const t=Xe(n).tokenObservers;for(const r of t)try{"EXTERNAL"===r.type&&null!=e.error?r.error(e.error):r.next(e)}catch(i){}}function Uo(n){return n.expireTimeMillis-Date.now()>0}function ay(n){return{token:BI(qI),error:n}}class GI{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){const{tokenObservers:e}=Xe(this.app);for(const t of e)rp(this.app,t.next);return Promise.resolve()}}const my="app-check-internal";!function rw(){(0,st._registerComponent)(new Gt.wA("app-check",n=>function $I(n,e){return new GI(n,e)}(n.getProvider("app").getImmediate(),n.getProvider("heartbeat")),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(my).initialize()})),(0,st._registerComponent)(new Gt.wA(my,n=>function jI(n){return{getToken:e=>Ql(n,e),addTokenListener:e=>function np(n,e,t,r){const{app:i}=n,s=Xe(i);if(s.tokenObservers=[...s.tokenObservers,{next:t,error:r,type:e}],s.token&&Uo(s.token)){const h=s.token;Promise.resolve().then(()=>{t({token:h.token}),sy(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>sy(n))}(n,"INTERNAL",e),removeTokenListener:e=>rp(n.app,e)}}(n.getProvider("app-check").getImmediate()),"PUBLIC").setInstantiationMode("EXPLICIT")),(0,st.registerVersion)("@firebase/app-check","0.6.0")}();class ap{constructor(){return(0,Le.vb)("app-check")}}"undefined"!=typeof window&&window,L(9260);const yy=new d.OlP("angularfire2.auth.use-emulator"),_y=new d.OlP("angularfire2.auth.settings"),vy=new d.OlP("angularfire2.auth.tenant-id"),Iy=new d.OlP("angularfire2.auth.langugage-code"),wy=new d.OlP("angularfire2.auth.use-device-language"),by=new d.OlP("angularfire.auth.persistence"),Ey=(n,e,t,r,i,s,u,h)=>(0,Ge.cc)(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{const f=e.runOutsideAngular(()=>n.auth());if(t&&f.useEmulator(...t),r&&(f.tenantId=r),f.languageCode=i,s&&f.useDeviceLanguage(),u)for(const[m,g]of Object.entries(u))f.settings[m]=g;return h&&f.setPersistence(h),f},[t,r,i,s,u,h]);let Ty=(()=>{class n{constructor(t,r,i,s,u,h,f,m,g,_,w,x){const S=new oe.x,M=(0,tn.of)(void 0).pipe((0,$l.Q)(u.outsideAngular),(0,Qr.w)(()=>s.runOutsideAngular(()=>Promise.resolve().then(L.bind(L,9169)))),(0,Ve.U)(()=>(0,Ge.on)(t,s,r)),(0,Ve.U)(V=>Ey(V,s,h,m,g,_,f,w)),(0,zg.d)({bufferSize:1,refCount:!1}));if((0,Ie.PM)(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=(0,tn.of)(null);else{M.pipe((0,fI.P)()).subscribe();const se=M.pipe((0,Qr.w)(Q=>Q.getRedirectResult().then(K=>K,()=>null)),Le.iC,(0,zg.d)({bufferSize:1,refCount:!1})),le=M.pipe((0,Qr.w)(Q=>new Ho.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onAuthStateChanged(Y=>K.next(Y),Y=>K.error(Y),()=>K.complete()))})))),X=M.pipe((0,Qr.w)(Q=>new Ho.y(K=>({unsubscribe:s.runOutsideAngular(()=>Q.onIdTokenChanged(Y=>K.next(Y),Y=>K.error(Y),()=>K.complete()))}))));this.authState=se.pipe(Wg(le),(0,Zf.R)(u.outsideAngular),(0,$l.Q)(u.insideAngular)),this.user=se.pipe(Wg(X),(0,Zf.R)(u.outsideAngular),(0,$l.Q)(u.insideAngular)),this.idToken=this.user.pipe((0,Qr.w)(Q=>Q?(0,vt.D)(Q.getIdToken()):(0,tn.of)(null))),this.idTokenResult=this.user.pipe((0,Qr.w)(Q=>Q?(0,vt.D)(Q.getIdTokenResult()):(0,tn.of)(null))),this.credential=(0,jg.T)(se,S,this.authState.pipe((0,Pe.h)(Q=>!Q))).pipe((0,Ve.U)(Q=>(null==Q?void 0:Q.user)?Q:null),(0,Zf.R)(u.outsideAngular),(0,$l.Q)(u.insideAngular))}return(0,Ge.pX)(this,M,s,{spy:{apply:(V,se,le)=>{(V.startsWith("signIn")||V.startsWith("createUser"))&&le.then(X=>S.next(X))}}})}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Ge.Dh),d.LFG(Ge.xv,8),d.LFG(d.Lbi),d.LFG(d.R0b),d.LFG(Le.HU),d.LFG(yy,8),d.LFG(_y,8),d.LFG(vy,8),d.LFG(Iy,8),d.LFG(wy,8),d.LFG(by,8),d.LFG(ap,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})();function ky(n,e){return function cw(n,e=Ko.z){return new Ho.y(t=>{let r;return null!=e?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{null!=r&&r()}})}(n,e)}function cp(n,e){return ky(n,e).pipe((0,Ve.U)(t=>({payload:t,type:"query"})))}function Jl(n,e){return cp(n,e).pipe((0,R.O)(void 0),Qo(),(0,Ve.U)(([t,r])=>{const i=r.payload.docChanges(),s=i.map(u=>({type:u.type,payload:u}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(r.payload.metadata)&&r.payload.docs.forEach((u,h)=>{const f=i.find(g=>g.doc.ref.isEqual(u.ref)),m=null==t?void 0:t.payload.docs.find(g=>g.ref.isEqual(u.ref));f&&JSON.stringify(f.doc.metadata)===JSON.stringify(u.metadata)||!f&&m&&JSON.stringify(m.metadata)===JSON.stringify(u.metadata)||s.push({type:"modified",payload:{oldIndex:h,newIndex:h,type:"modified",doc:u}})}),s}))}function xy(n,e,t){return Jl(n,t).pipe((0,Nn.R)((r,i)=>function hw(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=function dw(n,e){switch(e.type){case"added":if(!n[e.newIndex]||!n[e.newIndex].doc.ref.isEqual(e.doc.ref))return lp(n,e.newIndex,0,e);break;case"modified":if(null==n[e.oldIndex]||n[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}return lp(n,e.newIndex,1,e)}break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return lp(n,e.oldIndex,1)}return n}(n,r))}),n}(r,i.map(s=>s.payload),e),[]),(0,Zt.x)(),(0,Ve.U)(r=>r.map(i=>({type:i.type,payload:i}))))}function lp(n,e,t,...r){const i=n.slice();return i.splice(e,t,...r),i}function Ay(n){return(!n||0===n.length)&&(n=["added","removed","modified"]),n}class Sy{constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=Jl(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe((0,Ve.U)(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe((0,R.O)(void 0),Qo(),(0,Pe.h)(([r,i])=>i.length>0||!r),(0,Ve.U)(([r,i])=>i),Le.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Nn.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ay(e);return xy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Le.iC)}valueChanges(e={}){return cp(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ve.U)(t=>t.payload.docs.map(r=>e.idField?Object.assign(Object.assign({},r.data()),{[e.idField]:r.id}):r.data())),Le.iC)}get(e){return(0,vt.D)(this.query.get(e)).pipe(Le.iC)}add(e){return this.ref.add(e)}doc(e){return new Cy(this.ref.doc(e),this.afs)}}class Cy{constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){const r=this.ref.collection(e),{ref:i,query:s}=Dy(r,t);return new Sy(i,s,this.afs)}snapshotChanges(){return function lw(n,e){return ky(n,e).pipe((0,R.O)(void 0),Qo(),(0,Ve.U)(([t,r])=>r.exists?(null==t?void 0:t.exists)?{payload:r,type:"modified"}:{payload:r,type:"added"}:{payload:r,type:"removed"}))}(this.ref,this.afs.schedulers.outsideAngular).pipe(Le.iC)}valueChanges(e={}){return this.snapshotChanges().pipe((0,Ve.U)(({payload:t})=>e.idField?Object.assign(Object.assign({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return(0,vt.D)(this.ref.get(e)).pipe(Le.iC)}}class fw{constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return e&&0!==e.length?Jl(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ve.U)(t=>t.filter(r=>e.indexOf(r.type)>-1)),(0,Pe.h)(t=>t.length>0),Le.iC):Jl(this.query,this.afs.schedulers.outsideAngular).pipe(Le.iC)}auditTrail(e){return this.stateChanges(e).pipe((0,Nn.R)((t,r)=>[...t,...r],[]))}snapshotChanges(e){const t=Ay(e);return xy(this.query,t,this.afs.schedulers.outsideAngular).pipe(Le.iC)}valueChanges(e={}){return cp(this.query,this.afs.schedulers.outsideAngular).pipe((0,Ve.U)(r=>r.payload.docs.map(i=>e.idField?Object.assign({[e.idField]:i.id},i.data()):i.data())),Le.iC)}get(e){return(0,vt.D)(this.query.get(e)).pipe(Le.iC)}}const pw=new d.OlP("angularfire2.enableFirestorePersistence"),mw=new d.OlP("angularfire2.firestore.persistenceSettings"),gw=new d.OlP("angularfire2.firestore.settings"),yw=new d.OlP("angularfire2.firestore.use-emulator");function Dy(n,e=(t=>t)){return{query:e(n),ref:n}}let Ry=(()=>{class n{constructor(t,r,i,s,u,h,f,m,g,_,w,x,S,M,V,se,le){this.schedulers=f;const X=(0,Ge.on)(t,h,r),Q=g;_&&Ey(X,h,w,S,M,V,x,se),[this.firestore,this.persistenceEnabled$]=(0,Ge.cc)(`${X.name}.firestore`,"AngularFirestore",X.name,()=>{const K=h.runOutsideAngular(()=>X.firestore());if(s&&K.settings(s),Q&&K.useEmulator(...Q),i&&!(0,Ie.PM)(u)){const Y=()=>{try{return(0,vt.D)(K.enablePersistence(m||void 0).then(()=>!0,()=>!1))}catch(Ze){return"undefined"!=typeof console&&console.warn(Ze),(0,tn.of)(!1)}};return[K,h.runOutsideAngular(Y)]}return[K,(0,tn.of)(!1)]},[s,Q,i])}collection(t,r){let i;i="string"==typeof t?this.firestore.collection(t):t;const{ref:s,query:u}=Dy(i,r),h=this.schedulers.ngZone.run(()=>s);return new Sy(h,u,this)}collectionGroup(t,r){const i=r||(u=>u),s=this.firestore.collectionGroup(t);return new fw(i(s),this)}doc(t){let r;r="string"==typeof t?this.firestore.doc(t):t;const i=this.schedulers.ngZone.run(()=>r);return new Cy(i,this)}createId(){return this.firestore.collection("_").doc().id}}return n.\u0275fac=function(t){return new(t||n)(d.LFG(Ge.Dh),d.LFG(Ge.xv,8),d.LFG(pw,8),d.LFG(gw,8),d.LFG(d.Lbi),d.LFG(d.R0b),d.LFG(Le.HU),d.LFG(mw,8),d.LFG(yw,8),d.LFG(Ty,8),d.LFG(yy,8),d.LFG(_y,8),d.LFG(vy,8),d.LFG(Iy,8),d.LFG(wy,8),d.LFG(by,8),d.LFG(ap,8))},n.\u0275prov=d.Yz7({token:n,factory:n.\u0275fac,providedIn:"any"}),n})(),_w=(()=>{class n{constructor(t,r,i,s){this.fb=t,this.dialogRef=r,this.data=i,this.store=s}onSubmit(){this.dialogRef.close(),window.navigator.clipboard.writeText(this.formGroup.value.copy_link)}ngOnInit(){this.formGroup=this.fb.group({copy_link:[{value:null,disabled:!1},B.kI.required]});const t=Gu(30);(0,vt.D)(this.store.collection(t).add({actors:this.data.actors.map(r=>r.toDto()),rotations:this.data.rotations.map(r=>r.toDto()),current_rotation:this.data.current_rotation})).subscribe(()=>{this.formGroup.patchValue({copy_link:`${window.location.href}?store=${t}`})})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt),d.Y36(os),d.Y36(Ry))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-export-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","copy_link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"button",4),d._uU(11),d.ALo(12,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,5,"export_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,7,"export_dialog.placeholder.copy_link")),d.xp6(3),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(12,9,"export_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,rn.Nt,B.Fj,B.JJ,B.u,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})(),vw=(()=>{class n{constructor(t,r){this.fb=t,this.dialogRef=r}onSubmit(){const t=this.formGroup.value.link.split("?store=");t.length<2||this.dialogRef.close(t[t.length-1])}ngOnInit(){this.formGroup=this.fb.group({link:[null,B.kI.required]})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(Vt))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-import-actor-dialog"]],decls:13,vars:11,consts:[["mat-dialog-title",""],[3,"formGroup","submit"],["appearance","fill","tabindex","-1"],["matInput","","formControlName","link"],["mat-raised-button","","color","primary","type","submit",3,"disabled"]],template:function(t,r){1&t&&(d.TgZ(0,"h1",0),d._uU(1),d.ALo(2,"translate"),d.qZA(),d.TgZ(3,"mat-dialog-content",1),d.NdJ("submit",function(){return r.onSubmit()}),d.TgZ(4,"form")(5,"mat-form-field",2)(6,"mat-label"),d._uU(7),d.ALo(8,"translate"),d.qZA(),d._UZ(9,"input",3),d.qZA(),d.TgZ(10,"button",4),d._uU(11),d.ALo(12,"translate"),d.qZA()()()),2&t&&(d.xp6(1),d.Oqu(d.lcZ(2,5,"import_dialog.title")),d.xp6(2),d.Q6J("formGroup",r.formGroup),d.xp6(4),d.Oqu(d.lcZ(8,7,"import_dialog.placeholder.link")),d.xp6(3),d.Q6J("disabled",r.formGroup.invalid),d.xp6(1),d.hij(" ",d.lcZ(12,9,"import_dialog.submit")," "))},directives:[yr,nn,B.JL,B.sg,B._Y,He.KE,He.hX,rn.Nt,B.Fj,B.JJ,B.u,Dn.lW],pipes:[Et.X$],styles:["form[_ngcontent-%COMP%]{display:flex;flex-direction:column}"]}),n})();class Iw extends Vo{constructor(e){super(e),this.positions=[]}addPosition(e,t){this.positions.push({x:this.toDiscreteX(e),y:this.toDiscreteY(t)})}drawShape(){if(!(this.positions.length<=1)){this.context.beginPath(),this.context.moveTo(this.fromDiscreteX(this.positions[0].x),this.fromDiscreteY(this.positions[0].y));for(let e=1;e<this.positions.length;++e)this.context.lineTo(this.fromDiscreteX(this.positions[e].x),this.fromDiscreteY(this.positions[e].y));this.context.lineWidth=3,this.context.strokeStyle="#003300",this.context.stroke()}}isHit(e,t){const r=this.toDiscreteX(e),i=this.toDiscreteY(t);let s=this.positions[0];for(let u=1;u<this.positions.length;++u){const h=this.positions[u];if(s.x<h.x){const f=s.x<=r&&h.x>=r;if(s.y<h.y){if(f&&s.y<=i&&h.y>=i)return!0}else if(f&&s.y>=i&&h.y<=i)return!0}else{const f=s.x>=r&&h.x<=r;if(s.y<h.y){if(f&&s.y<=i&&h.y>=i)return!0}else if(f&&s.y>=i&&h.y<=i)return!0}s=h}return!1}toDto(){}}var mt=(()=>(function(n){n[n.MOVE_ACTOR=0]="MOVE_ACTOR",n[n.DRAW_LINE=1]="DRAW_LINE",n[n.ERASE_LINE=2]="ERASE_LINE"}(mt||(mt={})),mt))(),xn=L(8962),Ut=L(3191),Ny=L(9718),dr=L(2722),ww=L(8372);const Xl=["*"],bw=["content"];function Ew(n,e){if(1&n){const t=d.EpF();d.TgZ(0,"div",2),d.NdJ("click",function(){return d.CHM(t),d.oxw()._onBackdropClicked()}),d.qZA()}if(2&n){const t=d.oxw();d.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Tw(n,e){1&n&&(d.TgZ(0,"mat-drawer-content"),d.Hsn(1,2),d.qZA())}const kw=[[["mat-drawer"]],[["mat-drawer-content"]],"*"],xw=["mat-drawer","mat-drawer-content","*"];function Aw(n,e){if(1&n){const t=d.EpF();d.TgZ(0,"div",2),d.NdJ("click",function(){return d.CHM(t),d.oxw()._onBackdropClicked()}),d.qZA()}if(2&n){const t=d.oxw();d.ekj("mat-drawer-shown",t._isShowingBackdrop())}}function Sw(n,e){1&n&&(d.TgZ(0,"mat-sidenav-content"),d.Hsn(1,2),d.qZA())}const Cw=[[["mat-sidenav"]],[["mat-sidenav-content"]],"*"],Dw=["mat-sidenav","mat-sidenav-content","*"],Oy={transformDrawer:(0,ce.X$)("transform",[(0,ce.SB)("open, open-instant",(0,ce.oB)({transform:"none",visibility:"visible"})),(0,ce.SB)("void",(0,ce.oB)({"box-shadow":"none",visibility:"hidden"})),(0,ce.eR)("void => open-instant",(0,ce.jt)("0ms")),(0,ce.eR)("void <=> open, open-instant => void",(0,ce.jt)("400ms cubic-bezier(0.25, 0.8, 0.25, 1)"))])},Nw=new d.OlP("MAT_DRAWER_DEFAULT_AUTOSIZE",{providedIn:"root",factory:function Ow(){return!1}}),hp=new d.OlP("MAT_DRAWER_CONTAINER");let eh=(()=>{class n extends xn.PQ{constructor(t,r,i,s,u){super(i,s,u),this._changeDetectorRef=t,this._container=r}ngAfterContentInit(){this._container._contentMarginChanges.subscribe(()=>{this._changeDetectorRef.markForCheck()})}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(d.sBO),d.Y36((0,d.Gpc)(()=>Py)),d.Y36(d.SBq),d.Y36(xn.mF),d.Y36(d.R0b))},n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-drawer-content"]],hostAttrs:[1,"mat-drawer-content"],hostVars:4,hostBindings:function(t,r){2&t&&d.Udp("margin-left",r._container._contentMargins.left,"px")("margin-right",r._container._contentMargins.right,"px")},features:[d._Bn([{provide:xn.PQ,useExisting:n}]),d.qOj],ngContentSelectors:Xl,decls:1,vars:0,template:function(t,r){1&t&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),My=(()=>{class n{constructor(t,r,i,s,u,h,f,m){this._elementRef=t,this._focusTrapFactory=r,this._focusMonitor=i,this._platform=s,this._ngZone=u,this._interactivityChecker=h,this._doc=f,this._container=m,this._elementFocusedBeforeDrawerWasOpened=null,this._enableAnimations=!1,this._position="start",this._mode="over",this._disableClose=!1,this._opened=!1,this._animationStarted=new oe.x,this._animationEnd=new oe.x,this._animationState="void",this.openedChange=new d.vpe(!0),this._openedStream=this.openedChange.pipe((0,Pe.h)(g=>g),(0,Ve.U)(()=>{})),this.openedStart=this._animationStarted.pipe((0,Pe.h)(g=>g.fromState!==g.toState&&0===g.toState.indexOf("open")),(0,Ny.h)(void 0)),this._closedStream=this.openedChange.pipe((0,Pe.h)(g=>!g),(0,Ve.U)(()=>{})),this.closedStart=this._animationStarted.pipe((0,Pe.h)(g=>g.fromState!==g.toState&&"void"===g.toState),(0,Ny.h)(void 0)),this._destroyed=new oe.x,this.onPositionChanged=new d.vpe,this._modeChanged=new oe.x,this.openedChange.subscribe(g=>{g?(this._doc&&(this._elementFocusedBeforeDrawerWasOpened=this._doc.activeElement),this._takeFocus()):this._isFocusWithinDrawer()&&this._restoreFocus(this._openedVia||"program")}),this._ngZone.runOutsideAngular(()=>{(0,Wo.R)(this._elementRef.nativeElement,"keydown").pipe((0,Pe.h)(g=>g.keyCode===ss.hY&&!this.disableClose&&!(0,ss.Vb)(g)),(0,dr.R)(this._destroyed)).subscribe(g=>this._ngZone.run(()=>{this.close(),g.stopPropagation(),g.preventDefault()}))}),this._animationEnd.pipe((0,Zt.x)((g,_)=>g.fromState===_.fromState&&g.toState===_.toState)).subscribe(g=>{const{fromState:_,toState:w}=g;(0===w.indexOf("open")&&"void"===_||"void"===w&&0===_.indexOf("open"))&&this.openedChange.emit(this._opened)})}get position(){return this._position}set position(t){(t="end"===t?"end":"start")!==this._position&&(this._isAttached&&this._updatePositionInParent(t),this._position=t,this.onPositionChanged.emit())}get mode(){return this._mode}set mode(t){this._mode=t,this._updateFocusTrapState(),this._modeChanged.next()}get disableClose(){return this._disableClose}set disableClose(t){this._disableClose=(0,Ut.Ig)(t)}get autoFocus(){const t=this._autoFocus;return null==t?"side"===this.mode?"dialog":"first-tabbable":t}set autoFocus(t){("true"===t||"false"===t||null==t)&&(t=(0,Ut.Ig)(t)),this._autoFocus=t}get opened(){return this._opened}set opened(t){this.toggle((0,Ut.Ig)(t))}_forceFocus(t,r){this._interactivityChecker.isFocusable(t)||(t.tabIndex=-1,this._ngZone.runOutsideAngular(()=>{const i=()=>{t.removeEventListener("blur",i),t.removeEventListener("mousedown",i),t.removeAttribute("tabindex")};t.addEventListener("blur",i),t.addEventListener("mousedown",i)})),t.focus(r)}_focusByCssSelector(t,r){let i=this._elementRef.nativeElement.querySelector(t);i&&this._forceFocus(i,r)}_takeFocus(){if(!this._focusTrap)return;const t=this._elementRef.nativeElement;switch(this.autoFocus){case!1:case"dialog":return;case!0:case"first-tabbable":this._focusTrap.focusInitialElementWhenReady().then(r=>{!r&&"function"==typeof this._elementRef.nativeElement.focus&&t.focus()});break;case"first-heading":this._focusByCssSelector('h1, h2, h3, h4, h5, h6, [role="heading"]');break;default:this._focusByCssSelector(this.autoFocus)}}_restoreFocus(t){"dialog"!==this.autoFocus&&(this._elementFocusedBeforeDrawerWasOpened?this._focusMonitor.focusVia(this._elementFocusedBeforeDrawerWasOpened,t):this._elementRef.nativeElement.blur(),this._elementFocusedBeforeDrawerWasOpened=null)}_isFocusWithinDrawer(){const t=this._doc.activeElement;return!!t&&this._elementRef.nativeElement.contains(t)}ngAfterViewInit(){this._isAttached=!0,this._focusTrap=this._focusTrapFactory.create(this._elementRef.nativeElement),this._updateFocusTrapState(),"end"===this._position&&this._updatePositionInParent("end")}ngAfterContentChecked(){this._platform.isBrowser&&(this._enableAnimations=!0)}ngOnDestroy(){var t;this._focusTrap&&this._focusTrap.destroy(),null===(t=this._anchor)||void 0===t||t.remove(),this._anchor=null,this._animationStarted.complete(),this._animationEnd.complete(),this._modeChanged.complete(),this._destroyed.next(),this._destroyed.complete()}open(t){return this.toggle(!0,t)}close(){return this.toggle(!1)}_closeViaBackdropClick(){return this._setOpen(!1,!0,"mouse")}toggle(t=!this.opened,r){t&&r&&(this._openedVia=r);const i=this._setOpen(t,!t&&this._isFocusWithinDrawer(),this._openedVia||"program");return t||(this._openedVia=null),i}_setOpen(t,r,i){return this._opened=t,t?this._animationState=this._enableAnimations?"open":"open-instant":(this._animationState="void",r&&this._restoreFocus(i)),this._updateFocusTrapState(),new Promise(s=>{this.openedChange.pipe((0,Cn.q)(1)).subscribe(u=>s(u?"open":"close"))})}_getWidth(){return this._elementRef.nativeElement&&this._elementRef.nativeElement.offsetWidth||0}_updateFocusTrapState(){this._focusTrap&&(this._focusTrap.enabled=this.opened&&"side"!==this.mode)}_updatePositionInParent(t){const r=this._elementRef.nativeElement,i=r.parentNode;"end"===t?(this._anchor||(this._anchor=this._doc.createComment("mat-drawer-anchor"),i.insertBefore(this._anchor,r)),i.appendChild(r)):this._anchor&&this._anchor.parentNode.insertBefore(r,this._anchor)}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(d.SBq),d.Y36(Se.qV),d.Y36(Se.tE),d.Y36(it.t4),d.Y36(d.R0b),d.Y36(Se.ic),d.Y36(Ie.K0,8),d.Y36(hp,8))},n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-drawer"]],viewQuery:function(t,r){if(1&t&&d.Gf(bw,5),2&t){let i;d.iGM(i=d.CRH())&&(r._content=i.first)}},hostAttrs:["tabIndex","-1",1,"mat-drawer"],hostVars:12,hostBindings:function(t,r){1&t&&d.WFA("@transform.start",function(s){return r._animationStarted.next(s)})("@transform.done",function(s){return r._animationEnd.next(s)}),2&t&&(d.uIk("align",null),d.d8E("@transform",r._animationState),d.ekj("mat-drawer-end","end"===r.position)("mat-drawer-over","over"===r.mode)("mat-drawer-push","push"===r.mode)("mat-drawer-side","side"===r.mode)("mat-drawer-opened",r.opened))},inputs:{position:"position",mode:"mode",disableClose:"disableClose",autoFocus:"autoFocus",opened:"opened"},outputs:{openedChange:"openedChange",_openedStream:"opened",openedStart:"openedStart",_closedStream:"closed",closedStart:"closedStart",onPositionChanged:"positionChanged"},exportAs:["matDrawer"],ngContentSelectors:Xl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,r){1&t&&(d.F$t(),d.TgZ(0,"div",0,1),d.Hsn(2),d.qZA())},directives:[xn.PQ],encapsulation:2,data:{animation:[Oy.transformDrawer]},changeDetection:0}),n})(),Py=(()=>{class n{constructor(t,r,i,s,u,h=!1,f){this._dir=t,this._element=r,this._ngZone=i,this._changeDetectorRef=s,this._animationMode=f,this._drawers=new d.n_E,this.backdropClick=new d.vpe,this._destroyed=new oe.x,this._doCheckSubject=new oe.x,this._contentMargins={left:null,right:null},this._contentMarginChanges=new oe.x,t&&t.change.pipe((0,dr.R)(this._destroyed)).subscribe(()=>{this._validateDrawers(),this.updateContentMargins()}),u.change().pipe((0,dr.R)(this._destroyed)).subscribe(()=>this.updateContentMargins()),this._autosize=h}get start(){return this._start}get end(){return this._end}get autosize(){return this._autosize}set autosize(t){this._autosize=(0,Ut.Ig)(t)}get hasBackdrop(){return null==this._backdropOverride?!this._start||"side"!==this._start.mode||!this._end||"side"!==this._end.mode:this._backdropOverride}set hasBackdrop(t){this._backdropOverride=null==t?null:(0,Ut.Ig)(t)}get scrollable(){return this._userContent||this._content}ngAfterContentInit(){this._allDrawers.changes.pipe((0,R.O)(this._allDrawers),(0,dr.R)(this._destroyed)).subscribe(t=>{this._drawers.reset(t.filter(r=>!r._container||r._container===this)),this._drawers.notifyOnChanges()}),this._drawers.changes.pipe((0,R.O)(null)).subscribe(()=>{this._validateDrawers(),this._drawers.forEach(t=>{this._watchDrawerToggle(t),this._watchDrawerPosition(t),this._watchDrawerMode(t)}),(!this._drawers.length||this._isDrawerOpen(this._start)||this._isDrawerOpen(this._end))&&this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),this._ngZone.runOutsideAngular(()=>{this._doCheckSubject.pipe((0,ww.b)(10),(0,dr.R)(this._destroyed)).subscribe(()=>this.updateContentMargins())})}ngOnDestroy(){this._contentMarginChanges.complete(),this._doCheckSubject.complete(),this._drawers.destroy(),this._destroyed.next(),this._destroyed.complete()}open(){this._drawers.forEach(t=>t.open())}close(){this._drawers.forEach(t=>t.close())}updateContentMargins(){let t=0,r=0;if(this._left&&this._left.opened)if("side"==this._left.mode)t+=this._left._getWidth();else if("push"==this._left.mode){const i=this._left._getWidth();t+=i,r-=i}if(this._right&&this._right.opened)if("side"==this._right.mode)r+=this._right._getWidth();else if("push"==this._right.mode){const i=this._right._getWidth();r+=i,t-=i}t=t||null,r=r||null,(t!==this._contentMargins.left||r!==this._contentMargins.right)&&(this._contentMargins={left:t,right:r},this._ngZone.run(()=>this._contentMarginChanges.next(this._contentMargins)))}ngDoCheck(){this._autosize&&this._isPushed()&&this._ngZone.runOutsideAngular(()=>this._doCheckSubject.next())}_watchDrawerToggle(t){t._animationStarted.pipe((0,Pe.h)(r=>r.fromState!==r.toState),(0,dr.R)(this._drawers.changes)).subscribe(r=>{"open-instant"!==r.toState&&"NoopAnimations"!==this._animationMode&&this._element.nativeElement.classList.add("mat-drawer-transition"),this.updateContentMargins(),this._changeDetectorRef.markForCheck()}),"side"!==t.mode&&t.openedChange.pipe((0,dr.R)(this._drawers.changes)).subscribe(()=>this._setContainerClass(t.opened))}_watchDrawerPosition(t){!t||t.onPositionChanged.pipe((0,dr.R)(this._drawers.changes)).subscribe(()=>{this._ngZone.onMicrotaskEmpty.pipe((0,Cn.q)(1)).subscribe(()=>{this._validateDrawers()})})}_watchDrawerMode(t){t&&t._modeChanged.pipe((0,dr.R)((0,jg.T)(this._drawers.changes,this._destroyed))).subscribe(()=>{this.updateContentMargins(),this._changeDetectorRef.markForCheck()})}_setContainerClass(t){const r=this._element.nativeElement.classList,i="mat-drawer-container-has-open";t?r.add(i):r.remove(i)}_validateDrawers(){this._start=this._end=null,this._drawers.forEach(t=>{"end"==t.position?this._end=t:this._start=t}),this._right=this._left=null,this._dir&&"rtl"===this._dir.value?(this._left=this._end,this._right=this._start):(this._left=this._start,this._right=this._end)}_isPushed(){return this._isDrawerOpen(this._start)&&"over"!=this._start.mode||this._isDrawerOpen(this._end)&&"over"!=this._end.mode}_onBackdropClicked(){this.backdropClick.emit(),this._closeModalDrawersViaBackdrop()}_closeModalDrawersViaBackdrop(){[this._start,this._end].filter(t=>t&&!t.disableClose&&this._canHaveBackdrop(t)).forEach(t=>t._closeViaBackdropClick())}_isShowingBackdrop(){return this._isDrawerOpen(this._start)&&this._canHaveBackdrop(this._start)||this._isDrawerOpen(this._end)&&this._canHaveBackdrop(this._end)}_canHaveBackdrop(t){return"side"!==t.mode||!!this._backdropOverride}_isDrawerOpen(t){return null!=t&&t.opened}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(gr.Is,8),d.Y36(d.SBq),d.Y36(d.R0b),d.Y36(d.sBO),d.Y36(xn.rL),d.Y36(Nw),d.Y36(qo.Qb,8))},n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-drawer-container"]],contentQueries:function(t,r,i){if(1&t&&(d.Suo(i,eh,5),d.Suo(i,My,5)),2&t){let s;d.iGM(s=d.CRH())&&(r._content=s.first),d.iGM(s=d.CRH())&&(r._allDrawers=s)}},viewQuery:function(t,r){if(1&t&&d.Gf(eh,5),2&t){let i;d.iGM(i=d.CRH())&&(r._userContent=i.first)}},hostAttrs:[1,"mat-drawer-container"],hostVars:2,hostBindings:function(t,r){2&t&&d.ekj("mat-drawer-container-explicit-backdrop",r._backdropOverride)},inputs:{autosize:"autosize",hasBackdrop:"hasBackdrop"},outputs:{backdropClick:"backdropClick"},exportAs:["matDrawerContainer"],features:[d._Bn([{provide:hp,useExisting:n}])],ngContentSelectors:xw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,r){1&t&&(d.F$t(kw),d.YNc(0,Ew,1,2,"div",0),d.Hsn(1),d.Hsn(2,1),d.YNc(3,Tw,2,0,"mat-drawer-content",1)),2&t&&(d.Q6J("ngIf",r.hasBackdrop),d.xp6(3),d.Q6J("ngIf",!r._content))},directives:[eh,Ie.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),dp=(()=>{class n extends eh{constructor(t,r,i,s,u){super(t,r,i,s,u)}}return n.\u0275fac=function(t){return new(t||n)(d.Y36(d.sBO),d.Y36((0,d.Gpc)(()=>Fy)),d.Y36(d.SBq),d.Y36(xn.mF),d.Y36(d.R0b))},n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-sidenav-content"]],hostAttrs:[1,"mat-drawer-content","mat-sidenav-content"],hostVars:4,hostBindings:function(t,r){2&t&&d.Udp("margin-left",r._container._contentMargins.left,"px")("margin-right",r._container._contentMargins.right,"px")},features:[d._Bn([{provide:xn.PQ,useExisting:n}]),d.qOj],ngContentSelectors:Xl,decls:1,vars:0,template:function(t,r){1&t&&(d.F$t(),d.Hsn(0))},encapsulation:2,changeDetection:0}),n})(),Ly=(()=>{class n extends My{constructor(){super(...arguments),this._fixedInViewport=!1,this._fixedTopGap=0,this._fixedBottomGap=0}get fixedInViewport(){return this._fixedInViewport}set fixedInViewport(t){this._fixedInViewport=(0,Ut.Ig)(t)}get fixedTopGap(){return this._fixedTopGap}set fixedTopGap(t){this._fixedTopGap=(0,Ut.su)(t)}get fixedBottomGap(){return this._fixedBottomGap}set fixedBottomGap(t){this._fixedBottomGap=(0,Ut.su)(t)}}return n.\u0275fac=function(){let e;return function(r){return(e||(e=d.n5z(n)))(r||n)}}(),n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-sidenav"]],hostAttrs:["tabIndex","-1",1,"mat-drawer","mat-sidenav"],hostVars:17,hostBindings:function(t,r){2&t&&(d.uIk("align",null),d.Udp("top",r.fixedInViewport?r.fixedTopGap:null,"px")("bottom",r.fixedInViewport?r.fixedBottomGap:null,"px"),d.ekj("mat-drawer-end","end"===r.position)("mat-drawer-over","over"===r.mode)("mat-drawer-push","push"===r.mode)("mat-drawer-side","side"===r.mode)("mat-drawer-opened",r.opened)("mat-sidenav-fixed",r.fixedInViewport))},inputs:{fixedInViewport:"fixedInViewport",fixedTopGap:"fixedTopGap",fixedBottomGap:"fixedBottomGap"},exportAs:["matSidenav"],features:[d.qOj],ngContentSelectors:Xl,decls:3,vars:0,consts:[["cdkScrollable","",1,"mat-drawer-inner-container"],["content",""]],template:function(t,r){1&t&&(d.F$t(),d.TgZ(0,"div",0,1),d.Hsn(2),d.qZA())},directives:[xn.PQ],encapsulation:2,data:{animation:[Oy.transformDrawer]},changeDetection:0}),n})(),Fy=(()=>{class n extends Py{}return n.\u0275fac=function(){let e;return function(r){return(e||(e=d.n5z(n)))(r||n)}}(),n.\u0275cmp=d.Xpm({type:n,selectors:[["mat-sidenav-container"]],contentQueries:function(t,r,i){if(1&t&&(d.Suo(i,dp,5),d.Suo(i,Ly,5)),2&t){let s;d.iGM(s=d.CRH())&&(r._content=s.first),d.iGM(s=d.CRH())&&(r._allDrawers=s)}},hostAttrs:[1,"mat-drawer-container","mat-sidenav-container"],hostVars:2,hostBindings:function(t,r){2&t&&d.ekj("mat-drawer-container-explicit-backdrop",r._backdropOverride)},exportAs:["matSidenavContainer"],features:[d._Bn([{provide:hp,useExisting:n}]),d.qOj],ngContentSelectors:Dw,decls:4,vars:2,consts:[["class","mat-drawer-backdrop",3,"mat-drawer-shown","click",4,"ngIf"],[4,"ngIf"],[1,"mat-drawer-backdrop",3,"click"]],template:function(t,r){1&t&&(d.F$t(Cw),d.YNc(0,Aw,1,2,"div",0),d.Hsn(1),d.Hsn(2,1),d.YNc(3,Sw,2,0,"mat-sidenav-content",1)),2&t&&(d.Q6J("ngIf",r.hasBackdrop),d.xp6(3),d.Q6J("ngIf",!r._content))},directives:[dp,Ie.O5],styles:['.mat-drawer-container{position:relative;z-index:1;box-sizing:border-box;-webkit-overflow-scrolling:touch;display:block;overflow:hidden}.mat-drawer-container[fullscreen]{top:0;left:0;right:0;bottom:0;position:absolute}.mat-drawer-container[fullscreen].mat-drawer-container-has-open{overflow:hidden}.mat-drawer-container.mat-drawer-container-explicit-backdrop .mat-drawer-side{z-index:3}.mat-drawer-container.ng-animate-disabled .mat-drawer-backdrop,.mat-drawer-container.ng-animate-disabled .mat-drawer-content,.ng-animate-disabled .mat-drawer-container .mat-drawer-backdrop,.ng-animate-disabled .mat-drawer-container .mat-drawer-content{transition:none}.mat-drawer-backdrop{top:0;left:0;right:0;bottom:0;position:absolute;display:block;z-index:3;visibility:hidden}.mat-drawer-backdrop.mat-drawer-shown{visibility:visible}.mat-drawer-transition .mat-drawer-backdrop{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:background-color,visibility}.cdk-high-contrast-active .mat-drawer-backdrop{opacity:.5}.mat-drawer-content{position:relative;z-index:1;display:block;height:100%;overflow:auto}.mat-drawer-transition .mat-drawer-content{transition-duration:400ms;transition-timing-function:cubic-bezier(0.25, 0.8, 0.25, 1);transition-property:transform,margin-left,margin-right}.mat-drawer{position:relative;z-index:4;display:block;position:absolute;top:0;bottom:0;z-index:3;outline:0;box-sizing:border-box;overflow-y:auto;transform:translate3d(-100%, 0, 0)}.cdk-high-contrast-active .mat-drawer,.cdk-high-contrast-active [dir=rtl] .mat-drawer.mat-drawer-end{border-right:solid 1px currentColor}.cdk-high-contrast-active [dir=rtl] .mat-drawer,.cdk-high-contrast-active .mat-drawer.mat-drawer-end{border-left:solid 1px currentColor;border-right:none}.mat-drawer.mat-drawer-side{z-index:2}.mat-drawer.mat-drawer-end{right:0;transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer{transform:translate3d(100%, 0, 0)}[dir=rtl] .mat-drawer.mat-drawer-end{left:0;right:auto;transform:translate3d(-100%, 0, 0)}.mat-drawer[style*="visibility: hidden"]{display:none}.mat-drawer-inner-container{width:100%;height:100%;overflow:auto;-webkit-overflow-scrolling:touch}.mat-sidenav-fixed{position:fixed}\n'],encapsulation:2,changeDetection:0}),n})(),Mw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[Ie.ez,Ae.BQ,xn.ZD],xn.ZD,Ae.BQ]}),n})();var Pw=L(5245);const Lw=["field"];function Fw(n,e){if(1&n&&(d.TgZ(0,"mat-option",8),d._uU(1),d.qZA()),2&n){const t=e.$implicit;d.Q6J("value",t.UUID),d.xp6(1),d.Oqu(t.toString())}}const Uw=[{path:"",component:(()=>{class n{constructor(t,r,i,s){this.formBuilder=t,this.matDialog=r,this.store=i,this.router=s,this.mouseDown=!1,this.actors=[],this.rotations=[],this.currentRotationIndex=0,this.FieldMode=mt,this.fieldMode=mt.MOVE_ACTOR,this.formGroup=this.formBuilder.group({current_rotation:[null,B.kI.required]})}get rotation(){return this.rotations[this.currentRotationIndex]}ngAfterViewInit(){var t=this;this.context=this.fieldElement.nativeElement.getContext("2d"),this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height;for(const r of[["touchstart","mousedown"],["touchmove","mousemove"]])this.context.canvas.addEventListener(r[0],i=>{const s=i.touches[0];this.fieldElement.nativeElement.dispatchEvent(new MouseEvent(r[1],{clientX:s.clientX,clientY:s.clientY}))});this.context.canvas.addEventListener("touchend",()=>this.onMouseUp()),this.context.canvas.addEventListener("touchcancel",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousedown",r=>this.onMouseDown(r)),this.fieldElement.nativeElement.addEventListener("mouseup",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mouseleave",()=>this.onMouseUp()),this.fieldElement.nativeElement.addEventListener("mousemove",r=>this.onMouseMove(r)),setTimeout((0,k.Z)(function*(){const r=new URLSearchParams(window.location.search);if(r&&r.get("store")&&30===r.get("store").length)yield t.importLink(r.get("store")),t.router.navigate(["/"]);else{const i=_r.retrieve(n.LOCAL_STORAGE_KEY_ROTATIONS),s=_r.retrieve(n.LOCAL_STORAGE_KEY_ACTORS),u=_r.retrieve(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION);i&&s&&u?(t.actors=s.map(h=>Jr.fromDto(h,t.context)),t.rotations=i.map(h=>Rn.fromDto(h)),t.currentRotationIndex=t.rotations.findIndex(h=>h.UUID===u),t.actors.forEach(h=>h.shape.setRotationProperties(t.rotation.UUID,t.rotation.rotation))):t.rotations=[new Rn(new An(1),"Default rotation")],t.formGroup.patchValue({current_rotation:t.rotation.UUID})}t.formGroup.valueChanges.subscribe(i=>t.onRotationChanged(i.current_rotation)),t.render()}),100),(0,Wo.R)(window,"resize").subscribe(()=>this.fixRenderDimensions())}fixRenderDimensions(){this.context.canvas.width=this.context.canvas.getBoundingClientRect().width,this.context.canvas.height=this.context.canvas.getBoundingClientRect().height,this.render()}onRotationChanged(t){this.currentRotationIndex=this.rotations.findIndex(r=>r.UUID===t),this.actors.forEach(r=>r.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.render()}onMouseDown(t){const r=t.clientX,i=t.clientY;if(this.mouseDown=!0,this.fieldMode===mt.MOVE_ACTOR)for(let s=this.actors.length-1;s>=0;--s){const u=this.actors[s].shape;if(u.isHit(r,i))return void(this.draggedShape=u)}else this.fieldMode===mt.DRAW_LINE&&(this.drawnLine=new Iw(this.context),this.drawnLine.addPosition(r,i),this.rotation.addLine(this.drawnLine))}onMouseUp(){this.draggedShape=void 0,this.drawnLine=void 0,this.mouseDown=!1}onMouseMove(t){const r=t.clientX,i=t.clientY;if(this.fieldMode===mt.ERASE_LINE)this.mouseDown&&this.rotation.removeIfHitLine(r,i);else if(this.draggedShape)this.draggedShape.setPosition(r,i);else{if(!this.drawnLine)return;this.drawnLine.addPosition(r,i)}this.render()}onAddActorClicked(){this.matDialog.open($o,{autoFocus:!1}).afterClosed().subscribe(r=>{if(r){switch(r.player_role){case rt.Setter:this.addShape(r,new Sn(r,this.context));break;case rt.MiddleBlocker:this.addShape(r,new is(r,this.context,!1));break;case rt.Libero:this.addShape(r,new is(r,this.context,!0));break;case rt.OutsideHitter:this.addShape(r,new fr(r,this.context,!1));break;case rt.OppositeHitter:this.addShape(r,new fr(r,this.context,!0))}this.render()}})}addShape(t,r){r.setRotationProperties(this.rotation.UUID,this.rotation.rotation),t.setShape(r),this.actors.push(t)}onDeleteActorClicked(){this.matDialog.open(cs,{data:{actors:this.actors},autoFocus:!1}).afterClosed().subscribe(r=>{if(!r)return;const i=this.actors.findIndex(s=>s.UUID===r);this.actors.splice(i,1),this.render()})}onDeleteRotationClicked(){this.matDialog.open(zo,{data:{rotations:this.rotations},autoFocus:!1}).afterClosed().subscribe(r=>{if(!r)return;const i=this.rotation.UUID,s=this.rotations.findIndex(u=>u.UUID===r);this.rotations.splice(s,1),this.actors.forEach(u=>u.shape.removeRotation(r)),i===r&&(0===this.rotations.length&&this.rotations.push(new Rn(new An(1),"Default rotation")),this.currentRotationIndex=0,this.formGroup.patchValue({current_rotation:this.rotation.UUID}),this.actors.forEach(u=>u.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation))),this.render()})}onAddRotationClicked(){this.matDialog.open(ih,{autoFocus:!1}).afterClosed().subscribe(r=>{!r||(this.actors.forEach(i=>i.shape.setRotationProperties(this.rotation.UUID,this.rotation.rotation)),this.rotations.push(r),this.currentRotationIndex=this.rotations.length-1,this.formGroup.patchValue({current_rotation:r.UUID}),this.render())})}onExportClicked(){this.matDialog.open(_w,{autoFocus:!1,data:{actors:this.actors,rotations:this.rotations,current_rotation:this.rotation.UUID}})}onImportClicked(){this.matDialog.open(vw,{autoFocus:!1}).afterClosed().subscribe(r=>this.importLink(r))}importLink(t){var r=this;return(0,k.Z)(function*(){!t||30!==t.length||(yield r.store.collection(t).get().toPromise().then(i=>{const s=i.docs[0].data();r.actors=s.actors.map(h=>Jr.fromDto(h,r.context)),r.rotations=s.rotations.map(h=>Rn.fromDto(h));const u=s.current_rotation;r.currentRotationIndex=r.rotations.findIndex(h=>h.UUID===u),r.formGroup.patchValue({current_rotation:r.rotation.UUID}),r.actors.forEach(h=>h.shape.setRotationProperties(r.rotation.UUID,r.rotation.rotation)),r.render()}))})()}setMoveActorMode(){this.fieldMode=mt.MOVE_ACTOR}onToggleDrawMode(){this.fieldMode=this.fieldMode===mt.DRAW_LINE?mt.MOVE_ACTOR:mt.DRAW_LINE}onToggleEraseMode(){this.fieldMode=this.fieldMode===mt.ERASE_LINE?mt.MOVE_ACTOR:mt.ERASE_LINE}render(){this.initCourt(),this.actors.forEach(t=>t.draw()),this.rotation.draw(),_r.store(n.LOCAL_STORAGE_KEY_ROTATIONS,this.rotations.map(t=>t.toDto())),_r.store(n.LOCAL_STORAGE_KEY_CURRENT_ROTATION,this.rotation.UUID),_r.store(n.LOCAL_STORAGE_KEY_ACTORS,this.actors.map(t=>t.toDto()))}initCourt(){const t=this.context.canvas.getBoundingClientRect().width,r=this.context.canvas.getBoundingClientRect().height;this.context.clearRect(0,0,t,r),this.context.fillStyle=n.OUTER_COLOR,this.context.fillRect(0,0,t,r);const i=.025*t,u=(r-.025*r)/10,h=(t-2*i)/9,f=i,m=t-2*i;this.context.fillStyle=n.FRONT_FIELD_COLOR,this.context.fillRect(f,0,m,4*u),this.context.fillStyle=n.BACK_FIELD_COLOR,this.context.fillRect(f,4*u,m,6*u);const g=u/20,_=h/20;this.context.fillStyle=n.LINE_COLOR,this.context.fillRect(f,0,_,10*u),this.context.fillRect(m+f-_,0,_,10*u),this.context.fillRect(f,4*u,m,g),this.context.fillRect(f,10*u,m,g),this.context.fillRect(f,1*u-3*g,m,3*g)}}return n.OUTER_COLOR="#469ABB",n.LINE_COLOR="#FFFFFF",n.FRONT_FIELD_COLOR="#FF5202",n.BACK_FIELD_COLOR="#F8A941",n.LOCAL_STORAGE_KEY_ACTORS="actors_storage",n.LOCAL_STORAGE_KEY_ROTATIONS="rotations_storage",n.LOCAL_STORAGE_KEY_CURRENT_ROTATION="current_rotation_uuid",n.\u0275fac=function(t){return new(t||n)(d.Y36(B.qu),d.Y36(ni),d.Y36(Ry),d.Y36(C.F0))},n.\u0275cmp=d.Xpm({type:n,selectors:[["vpms-field"]],viewQuery:function(t,r){if(1&t&&d.Gf(Lw,5),2&t){let i;d.iGM(i=d.CRH())&&(r.fieldElement=i.first)}},decls:57,vars:37,consts:[["mode","over"],["sidenav",""],[3,"formGroup"],["formControlName","current_rotation"],[3,"value",4,"ngFor","ngForOf"],["mat-stroked-button","",3,"click"],["mat-flat-button","",1,"toggle_sidenav",3,"click"],["field",""],[3,"value"]],template:function(t,r){if(1&t){const i=d.EpF();d.TgZ(0,"mat-sidenav-container")(1,"mat-sidenav",0,1)(3,"mat-form-field",2)(4,"mat-select",3),d.YNc(5,Fw,2,2,"mat-option",4),d.qZA()(),d.TgZ(6,"button",5),d.NdJ("click",function(){return r.onAddRotationClicked()}),d.TgZ(7,"mat-icon"),d._uU(8,"add"),d.qZA(),d._uU(9),d.ALo(10,"translate"),d.qZA(),d.TgZ(11,"button",5),d.NdJ("click",function(){return r.onDeleteRotationClicked()}),d.TgZ(12,"mat-icon"),d._uU(13,"delete"),d.qZA(),d._uU(14),d.ALo(15,"translate"),d.qZA(),d.TgZ(16,"button",5),d.NdJ("click",function(){return r.onAddActorClicked()}),d.TgZ(17,"mat-icon"),d._uU(18,"add"),d.qZA(),d._uU(19),d.ALo(20,"translate"),d.qZA(),d.TgZ(21,"button",5),d.NdJ("click",function(){return r.onDeleteActorClicked()}),d.TgZ(22,"mat-icon"),d._uU(23,"delete"),d.qZA(),d._uU(24),d.ALo(25,"translate"),d.qZA(),d.TgZ(26,"button",5),d.NdJ("click",function(){return r.onExportClicked()}),d.TgZ(27,"mat-icon"),d._uU(28,"share"),d.qZA(),d._uU(29),d.ALo(30,"translate"),d.qZA(),d.TgZ(31,"button",5),d.NdJ("click",function(){return r.onImportClicked()}),d.TgZ(32,"mat-icon"),d._uU(33,"import_export"),d.qZA(),d._uU(34),d.ALo(35,"translate"),d.qZA(),d.TgZ(36,"button",5),d.NdJ("click",function(){return r.setMoveActorMode()}),d.TgZ(37,"mat-icon"),d._uU(38,"person"),d.qZA(),d._uU(39),d.ALo(40,"translate"),d.qZA(),d.TgZ(41,"button",5),d.NdJ("click",function(){return r.onToggleDrawMode()}),d.TgZ(42,"mat-icon"),d._uU(43,"mode_edit_outline"),d.qZA(),d._uU(44),d.ALo(45,"translate"),d.qZA(),d.TgZ(46,"button",5),d.NdJ("click",function(){return r.onToggleEraseMode()}),d.TgZ(47,"mat-icon"),d._uU(48,"auto_fix_normal"),d.qZA(),d._uU(49),d.ALo(50,"translate"),d.qZA()(),d.TgZ(51,"mat-sidenav-content")(52,"button",6),d.NdJ("click",function(){return d.CHM(i),d.MAs(2).toggle()}),d.TgZ(53,"mat-icon"),d._uU(54,"arrow_right"),d.qZA()(),d._UZ(55,"canvas",null,7),d.qZA()()}if(2&t){const i=d.MAs(2);d.xp6(3),d.Q6J("formGroup",r.formGroup),d.xp6(2),d.Q6J("ngForOf",r.rotations),d.xp6(4),d.hij(" ",d.lcZ(10,19,"field.add_rotation")," "),d.xp6(5),d.hij(" ",d.lcZ(15,21,"field.delete_rotation")," "),d.xp6(5),d.hij(" ",d.lcZ(20,23,"field.add_actor")," "),d.xp6(5),d.hij(" ",d.lcZ(25,25,"field.delete_actor")," "),d.xp6(5),d.hij(" ",d.lcZ(30,27,"field.export")," "),d.xp6(5),d.hij(" ",d.lcZ(35,29,"field.import")," "),d.xp6(2),d.ekj("toggled",r.fieldMode===r.FieldMode.MOVE_ACTOR),d.xp6(3),d.hij(" ",d.lcZ(40,31,"field.actor_mode")," "),d.xp6(2),d.ekj("toggled",r.fieldMode===r.FieldMode.DRAW_LINE),d.xp6(3),d.hij(" ",d.lcZ(45,33,"field.draw_mode")," "),d.xp6(2),d.ekj("toggled",r.fieldMode===r.FieldMode.ERASE_LINE),d.xp6(3),d.hij(" ",d.lcZ(50,35,"field.erase_mode")," "),d.xp6(3),d.ekj("is_opened",i.opened)}},directives:[Fy,Ly,He.KE,B.JL,B.sg,us.gD,B.JJ,B.u,Ie.sg,Ae.ey,Dn.lW,Pw.Hw,dp],pipes:[Et.X$],styles:["[_ngcontent-%COMP%]:root{--vpms-primary-palette-50: #DAE8F3;--vpms-primary-palette-100: #9DC1DF;--vpms-primary-palette-200: #80AED5;--vpms-primary-palette-300: #609ACA;--vpms-primary-palette-400: #2F7BBA;--vpms-primary-palette-500: #0A64AE;--vpms-primary-palette-600: #095A9D;--vpms-primary-palette-700: #063C68;--vpms-primary-palette-800: #042846;--vpms-primary-palette-900: #021423;--vpms-accent-palette-50: #FEF2F8;--vpms-accent-palette-100: #F8BFDF;--vpms-accent-palette-200: #F599CB;--vpms-accent-palette-300: #EF66B1;--vpms-accent-palette-400: #EA3397;--vpms-accent-palette-500: #E5007D;--vpms-accent-palette-600: #CE0071;--vpms-accent-palette-700: #AC005E;--vpms-accent-palette-800: #7E0045;--vpms-accent-palette-900: #50002C;--vpms-grayscale-0: #FFFFFF;--vpms-grayscale-50: #FAFAFA;--vpms-grayscale-100: #F2F2F2;--vpms-grayscale-200: #E6E6E6;--vpms-grayscale-250: #DADAD9;--vpms-grayscale-300: #CCCCCC;--vpms-grayscale-400: #B3B3B3;--vpms-grayscale-500: #999999;--vpms-grayscale-600: #808080;--vpms-grayscale-700: #666666;--vpms-grayscale-800: #4D4D4D;--vpms-grayscale-900: #333333;--vpms-grayscale-1000: #000000}[_nghost-%COMP%]{display:block;height:100%}.toggled[_ngcontent-%COMP%]{color:#0a64ae}mat-sidenav-container[_ngcontent-%COMP%]{height:100%}mat-sidenav[_ngcontent-%COMP%]{width:15rem;padding:1rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{width:100%;height:3rem;text-align:left;margin-bottom:.5rem}mat-sidenav[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{color:#0a64ae}mat-sidenav[_ngcontent-%COMP%]   mat-form-field[_ngcontent-%COMP%]{width:100%}.toggle_sidenav[_ngcontent-%COMP%]{position:absolute;top:3rem;left:-1rem;z-index:20;transform:rotate(90deg)}.toggle_sidenav.is_opened[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(90deg)}.toggle_sidenav[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{transform:rotate(-90deg)}canvas[_ngcontent-%COMP%]{display:block;height:100%;width:100%;touch-action:none}"]}),n})()}];let Vw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[C.Bz.forChild(Uw)],C.Bz]}),n})();var Uy=L(7144);let By=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({}),n})(),Yw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[Ae.si,Ae.BQ,Uy.Q8,By],Ae.BQ,By]}),n})(),Jw=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=d.oAB({type:n}),n.\u0275inj=d.cJS({imports:[[Vw,I.m,Et.aw,rh,B.UX,Ie.ez,Yw,Mw]]}),n})()},9169:(Zy,Zu,L)=>{L.r(Zu);var I=L(5861),Et=L(3942),C=L(2090),k=L(9681),Vo=L(1877),Yr=L(655),fr=L(4859);const Jr=function is(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance."}},d=function $u(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},pr=new C.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),Ae=new Vo.Yd("@firebase/auth");function gr(c,...o){Ae.logLevel<=Vo.in.ERROR&&Ae.error(`Auth (${k.SDK_VERSION}): ${c}`,...o)}function oe(c,...o){throw Cn(c,...o)}function Ue(c,...o){return Cn(c,...o)}function tn(c,o,a){const l=Object.assign(Object.assign({},d()),{[o]:a});return new C.LL("auth","Firebase",l).create(o,{appName:c.name})}function Pe(c,o,a){if(!(o instanceof a))throw a.name!==o.constructor.name&&oe(c,"argument-error"),tn(c,"argument-error",`Type of ${o.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function Cn(c,...o){if("string"!=typeof c){const a=o[0],l=[...o.slice(1)];return l[0]&&(l[0].appName=c.name),c._errorFactory.create(a,...l)}return pr.create(c,...o)}function R(c,o,...a){if(!c)throw Cn(o,...a)}function it(c){const o="INTERNAL ASSERTION FAILED: "+c;throw gr(o),new Error(o)}function Ie(c,o){c||it(o)}const ce=new Map;function Se(c){Ie(c instanceof Function,"Expected a class definition");let o=ce.get(c);return o?(Ie(o instanceof c,"Instance stored in cache mismatched with class"),o):(o=new c,ce.set(c,o),o)}function Xr(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.href)||""}function ei(){return"http:"===ju()||"https:"===ju()}function ju(){var c;return"undefined"!=typeof self&&(null===(c=self.location)||void 0===c?void 0:c.protocol)||null}class ti{constructor(o,a){this.shortDelay=o,this.longDelay=a,Ie(a>o,"Short delay should be less than long delay!"),this.isMobile=(0,C.uI)()||(0,C.b$)()}get(){return function fp(){return!("undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&(ei()||(0,C.ru)()||"connection"in navigator))||navigator.onLine}()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Bo(c,o){Ie(c.emulator,"Emulator should always be set here");const{url:a}=c.emulator;return o?`${a}${o.startsWith("/")?o.slice(1):o}`:a}class Vt{static initialize(o,a,l){this.fetchImpl=o,a&&(this.headersImpl=a),l&&(this.responseImpl=l)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void it("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void it("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void it("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const zu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},os=new ti(3e4,6e4);function Ce(c,o){return c.tenantId&&!o.tenantId?Object.assign(Object.assign({},o),{tenantId:c.tenantId}):o}function De(c,o,a,l){return Wu.apply(this,arguments)}function Wu(){return(Wu=(0,I.Z)(function*(c,o,a,l,p={}){return Ku(c,p,(0,I.Z)(function*(){let y={},v={};l&&("GET"===o?v=l:y={body:JSON.stringify(l)});const T=(0,C.xO)(Object.assign({key:c.config.apiKey},v)).slice(1),N=yield c._getAdditionalHeaders();return N["Content-Type"]="application/json",c.languageCode&&(N["X-Firebase-Locale"]=c.languageCode),Vt.fetch()(Hu(c,c.config.apiHost,a,T),Object.assign({method:o,headers:N,referrerPolicy:"no-referrer"},y))}))})).apply(this,arguments)}function Ku(c,o,a){return Zo.apply(this,arguments)}function Zo(){return(Zo=(0,I.Z)(function*(c,o,a){c._canInitEmulator=!1;const l=Object.assign(Object.assign({},zu),o);try{const p=new nh(c),y=yield Promise.race([a(),p.promise]);p.clearNetworkTimeout();const v=yield y.json();if("needConfirmation"in v)throw as(c,"account-exists-with-different-credential",v);if(y.ok&&!("errorMessage"in v))return v;{const T=y.ok?v.errorMessage:v.error.message,[N,U]=T.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===N)throw as(c,"credential-already-in-use",v);if("EMAIL_EXISTS"===N)throw as(c,"email-already-in-use",v);if("USER_DISABLED"===N)throw as(c,"user-disabled",v);const j=l[N]||N.toLowerCase().replace(/[_\s]+/g,"-");if(U)throw tn(c,j,U);oe(c,j)}}catch(p){if(p instanceof C.ZR)throw p;oe(c,"network-request-failed")}})).apply(this,arguments)}function qt(c,o,a,l){return ni.apply(this,arguments)}function ni(){return(ni=(0,I.Z)(function*(c,o,a,l,p={}){const y=yield De(c,o,a,l,p);return"mfaPendingCredential"in y&&oe(c,"multi-factor-auth-required",{_serverResponse:y}),y})).apply(this,arguments)}function Hu(c,o,a,l){const p=`${o}${a}?${l}`;return c.config.emulator?Bo(c.config,p):`${c.config.apiScheme}://${p}`}class nh{constructor(o){this.auth=o,this.timer=null,this.promise=new Promise((a,l)=>{this.timer=setTimeout(()=>l(Ue(this.auth,"network-request-failed")),os.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function as(c,o,a){const l={appName:c.name};a.email&&(l.email=a.email),a.phoneNumber&&(l.phoneNumber=a.phoneNumber);const p=Ue(c,o,l);return p.customData._tokenResponse=a,p}function nn(){return(nn=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:delete",o)})).apply(this,arguments)}function pp(c,o){return Go.apply(this,arguments)}function Go(){return(Go=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function rh(c,o){return He.apply(this,arguments)}function He(){return(He=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:lookup",o)})).apply(this,arguments)}function rn(c){if(c)try{const o=new Date(Number(c));if(!isNaN(o.getTime()))return o.toUTCString()}catch(o){}}function $o(){return($o=(0,I.Z)(function*(c,o=!1){const a=(0,C.m9)(c),l=yield a.getIdToken(o),p=cs(l);R(p&&p.exp&&p.auth_time&&p.iat,a.auth,"internal-error");const y="object"==typeof p.firebase?p.firebase:void 0,v=null==y?void 0:y.sign_in_provider;return{claims:p,token:l,authTime:rn(jo(p.auth_time)),issuedAtTime:rn(jo(p.iat)),expirationTime:rn(jo(p.exp)),signInProvider:v||null,signInSecondFactor:(null==y?void 0:y.sign_in_second_factor)||null}})).apply(this,arguments)}function jo(c){return 1e3*Number(c)}function cs(c){const[o,a,l]=c.split(".");if(void 0===o||void 0===a||void 0===l)return gr("JWT malformed, contained fewer than 3 sections"),null;try{const p=(0,C.tV)(a);return p?JSON.parse(p):(gr("Failed to decode base64 JWT payload"),null)}catch(p){return gr("Caught error parsing JWT payload as JSON",null==p?void 0:p.toString()),null}}function Bt(c,o){return zo.apply(this,arguments)}function zo(){return(zo=(0,I.Z)(function*(c,o,a=!1){if(a)return o;try{return yield o}catch(l){throw l instanceof C.ZR&&ih(l)&&c.auth.currentUser===c&&(yield c.auth.signOut()),l}})).apply(this,arguments)}function ih({code:c}){return"auth/user-disabled"===c||"auth/user-token-expired"===c}class _r{constructor(o){this.user=o,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){!this.isRunning||(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(o){var a;if(o){const l=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),l}{this.errorBackoff=3e4;const p=(null!==(a=this.user.stsTokenManager.expirationTime)&&void 0!==a?a:0)-Date.now()-3e5;return Math.max(0,p)}}schedule(o=!1){var a=this;if(!this.isRunning)return;const l=this.getInterval(o);this.timerId=setTimeout((0,I.Z)(function*(){yield a.iteration()}),l)}iteration(){var o=this;return(0,I.Z)(function*(){try{yield o.user.getIdToken(!0)}catch(a){return void("auth/network-request-failed"===(null==a?void 0:a.code)&&o.schedule(!0))}o.schedule()})()}}class Wo{constructor(o,a){this.createdAt=o,this.lastLoginAt=a,this._initializeTime()}_initializeTime(){this.lastSignInTime=rn(this.lastLoginAt),this.creationTime=rn(this.createdAt)}_copy(o){this.createdAt=o.createdAt,this.lastLoginAt=o.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}function vt(c){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,I.Z)(function*(c){var o;const a=c.auth,l=yield c.getIdToken(),p=yield Bt(c,rh(a,{idToken:l}));R(null==p?void 0:p.users.length,a,"internal-error");const y=p.users[0];c._notifyReloadListener(y);const v=(null===(o=y.providerUserInfo)||void 0===o?void 0:o.length)?oh(y.providerUserInfo):[],T=sh(c.providerData,v),j=!!c.isAnonymous&&!(c.email&&y.passwordHash||(null==T?void 0:T.length)),G={uid:y.localId,displayName:y.displayName||null,photoURL:y.photoUrl||null,email:y.email||null,emailVerified:y.emailVerified||!1,phoneNumber:y.phoneNumber||null,tenantId:y.tenantId||null,providerData:T,metadata:new Wo(y.createdAt,y.lastLoginAt),isAnonymous:j};Object.assign(c,G)})).apply(this,arguments)}function Le(){return(Le=(0,I.Z)(function*(c){const o=(0,C.m9)(c);yield vt(o),yield o.auth._persistUserIfCurrent(o),o.auth._notifyListenersIfCurrent(o)})).apply(this,arguments)}function sh(c,o){return[...c.filter(l=>!o.some(p=>p.providerId===l.providerId)),...o]}function oh(c){return c.map(o=>{var{providerId:a}=o,l=(0,Yr._T)(o,["providerId"]);return{providerId:a,uid:l.rawId||"",displayName:l.displayName||null,email:l.email||null,phoneNumber:l.phoneNumber||null,photoURL:l.photoUrl||null}})}function Ve(){return(Ve=(0,I.Z)(function*(c,o){const a=yield Ku(c,{},(0,I.Z)(function*(){const l=(0,C.xO)({grant_type:"refresh_token",refresh_token:o}).slice(1),{tokenApiHost:p,apiKey:y}=c.config,v=Hu(c,p,"/v1/token",`key=${y}`),T=yield c._getAdditionalHeaders();return T["Content-Type"]="application/x-www-form-urlencoded",Vt.fetch()(v,{method:"POST",headers:T,body:l})}));return{accessToken:a.access_token,expiresIn:a.expires_in,refreshToken:a.refresh_token}})).apply(this,arguments)}class Nn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(o){R(o.idToken,"internal-error"),R(void 0!==o.idToken,"internal-error"),R(void 0!==o.refreshToken,"internal-error");const a="expiresIn"in o&&void 0!==o.expiresIn?Number(o.expiresIn):function Rn(c){const o=cs(c);return R(o,"internal-error"),R(void 0!==o.exp,"internal-error"),R(void 0!==o.iat,"internal-error"),Number(o.exp)-Number(o.iat)}(o.idToken);this.updateTokensAndExpiration(o.idToken,o.refreshToken,a)}getToken(o,a=!1){var l=this;return(0,I.Z)(function*(){return R(!l.accessToken||l.refreshToken,o,"user-token-expired"),a||!l.accessToken||l.isExpired?l.refreshToken?(yield l.refresh(o,l.refreshToken),l.accessToken):null:l.accessToken})()}clearRefreshToken(){this.refreshToken=null}refresh(o,a){var l=this;return(0,I.Z)(function*(){const{accessToken:p,refreshToken:y,expiresIn:v}=yield function Qo(c,o){return Ve.apply(this,arguments)}(o,a);l.updateTokensAndExpiration(p,y,Number(v))})()}updateTokensAndExpiration(o,a,l){this.refreshToken=a||null,this.accessToken=o||null,this.expirationTime=Date.now()+1e3*l}static fromJSON(o,a){const{refreshToken:l,accessToken:p,expirationTime:y}=a,v=new Nn;return l&&(R("string"==typeof l,"internal-error",{appName:o}),v.refreshToken=l),p&&(R("string"==typeof p,"internal-error",{appName:o}),v.accessToken=p),y&&(R("number"==typeof y,"internal-error",{appName:o}),v.expirationTime=y),v}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(o){this.accessToken=o.accessToken,this.refreshToken=o.refreshToken,this.expirationTime=o.expirationTime}_clone(){return Object.assign(new Nn,this.toJSON())}_performRefresh(){return it("not implemented")}}function Zt(c,o){R("string"==typeof c||void 0===c,"internal-error",{appName:o})}class Ge{constructor(o){var{uid:a,auth:l,stsTokenManager:p}=o,y=(0,Yr._T)(o,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new _r(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=a,this.auth=l,this.stsTokenManager=p,this.accessToken=p.accessToken,this.displayName=y.displayName||null,this.email=y.email||null,this.emailVerified=y.emailVerified||!1,this.phoneNumber=y.phoneNumber||null,this.photoURL=y.photoURL||null,this.isAnonymous=y.isAnonymous||!1,this.tenantId=y.tenantId||null,this.providerData=y.providerData?[...y.providerData]:[],this.metadata=new Wo(y.createdAt||void 0,y.lastLoginAt||void 0)}getIdToken(o){var a=this;return(0,I.Z)(function*(){const l=yield Bt(a,a.stsTokenManager.getToken(a.auth,o));return R(l,a.auth,"internal-error"),a.accessToken!==l&&(a.accessToken=l,yield a.auth._persistUserIfCurrent(a),a.auth._notifyListenersIfCurrent(a)),l})()}getIdTokenResult(o){return function Dn(c){return $o.apply(this,arguments)}(this,o)}reload(){return function Ho(c){return Le.apply(this,arguments)}(this)}_assign(o){this!==o&&(R(this.uid===o.uid,this.auth,"internal-error"),this.displayName=o.displayName,this.photoURL=o.photoURL,this.email=o.email,this.emailVerified=o.emailVerified,this.phoneNumber=o.phoneNumber,this.isAnonymous=o.isAnonymous,this.tenantId=o.tenantId,this.providerData=o.providerData.map(a=>Object.assign({},a)),this.metadata._copy(o.metadata),this.stsTokenManager._assign(o.stsTokenManager))}_clone(o){return new Ge(Object.assign(Object.assign({},this),{auth:o,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(o){R(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=o,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(o){this.reloadListener?this.reloadListener(o):this.reloadUserInfo=o}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(o,a=!1){var l=this;return(0,I.Z)(function*(){let p=!1;o.idToken&&o.idToken!==l.stsTokenManager.accessToken&&(l.stsTokenManager.updateFromServerResponse(o),p=!0),a&&(yield vt(l)),yield l.auth._persistUserIfCurrent(l),p&&l.auth._notifyListenersIfCurrent(l)})()}delete(){var o=this;return(0,I.Z)(function*(){const a=yield o.getIdToken();return yield Bt(o,function yr(c,o){return nn.apply(this,arguments)}(o.auth,{idToken:a})),o.stsTokenManager.clearRefreshToken(),o.auth.signOut()})()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(o=>Object.assign({},o)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(o,a){var l,p,y,v,T,N,U,j;const G=null!==(l=a.displayName)&&void 0!==l?l:void 0,Ne=null!==(p=a.email)&&void 0!==p?p:void 0,gt=null!==(y=a.phoneNumber)&&void 0!==y?y:void 0,en=null!==(v=a.photoURL)&&void 0!==v?v:void 0,Lt=null!==(T=a.tenantId)&&void 0!==T?T:void 0,yo=null!==(N=a._redirectEventId)&&void 0!==N?N:void 0,lu=null!==(U=a.createdAt)&&void 0!==U?U:void 0,hu=null!==(j=a.lastLoginAt)&&void 0!==j?j:void 0,{uid:vn,emailVerified:_o,isAnonymous:al,providerData:be,stsTokenManager:ee}=a;R(vn&&ee,o,"internal-error");const ul=Nn.fromJSON(this.name,ee);R("string"==typeof vn,o,"internal-error"),Zt(G,o.name),Zt(Ne,o.name),R("boolean"==typeof _o,o,"internal-error"),R("boolean"==typeof al,o,"internal-error"),Zt(gt,o.name),Zt(en,o.name),Zt(Lt,o.name),Zt(yo,o.name),Zt(lu,o.name),Zt(hu,o.name);const vo=new Ge({uid:vn,auth:o,email:Ne,emailVerified:_o,displayName:G,isAnonymous:al,photoURL:en,phoneNumber:gt,tenantId:Lt,stsTokenManager:ul,createdAt:lu,lastLoginAt:hu});return be&&Array.isArray(be)&&(vo.providerData=be.map(In=>Object.assign({},In))),yo&&(vo._redirectEventId=yo),vo}static _fromIdTokenResponse(o,a,l=!1){return(0,I.Z)(function*(){const p=new Nn;p.updateFromServerResponse(a);const y=new Ge({uid:a.localId,auth:o,stsTokenManager:p,isAnonymous:l});return yield vt(y),y})()}}const vr=(()=>{class c{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return(0,I.Z)(function*(){return!0})()}_set(a,l){var p=this;return(0,I.Z)(function*(){p.storage[a]=l})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=l.storage[a];return void 0===p?null:p})()}_remove(a){var l=this;return(0,I.Z)(function*(){delete l.storage[a]})()}_addListener(a,l){}_removeListener(a,l){}}return c.type="NONE",c})();function st(c,o,a){return`firebase:${c}:${o}:${a}`}class Gt{constructor(o,a,l){this.persistence=o,this.auth=a,this.userKey=l;const{config:p,name:y}=this.auth;this.fullUserKey=st(this.userKey,p.apiKey,y),this.fullPersistenceKey=st("persistence",p.apiKey,y),this.boundEventHandler=a._onStorageEvent.bind(a),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(o){return this.persistence._set(this.fullUserKey,o.toJSON())}getCurrentUser(){var o=this;return(0,I.Z)(function*(){const a=yield o.persistence._get(o.fullUserKey);return a?Ge._fromJSON(o.auth,a):null})()}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(o){var a=this;return(0,I.Z)(function*(){if(a.persistence===o)return;const l=yield a.getCurrentUser();return yield a.removeCurrentUser(),a.persistence=o,l?a.setCurrentUser(l):void 0})()}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(o,a,l="authUser"){return(0,I.Z)(function*(){if(!a.length)return new Gt(Se(vr),o,l);const p=(yield Promise.all(a.map(function(){var U=(0,I.Z)(function*(j){if(yield j._isAvailable())return j});return function(j){return U.apply(this,arguments)}}()))).filter(U=>U);let y=p[0]||Se(vr);const v=st(l,o.config.apiKey,o.name);let T=null;for(const U of a)try{const j=yield U._get(v);if(j){const G=Ge._fromJSON(o,j);U!==y&&(T=G),y=U;break}}catch(j){}const N=p.filter(U=>U._shouldAllowMigration);return y._shouldAllowMigration&&N.length?(y=N[0],T&&(yield y._set(v,T.toJSON())),yield Promise.all(a.map(function(){var U=(0,I.Z)(function*(j){if(j!==y)try{yield j._remove(v)}catch(G){}});return function(j){return U.apply(this,arguments)}}())),new Gt(y,o,l)):new Gt(y,o,l)})()}}function $t(c){const o=c.toLowerCase();if(o.includes("opera/")||o.includes("opr/")||o.includes("opios/"))return"Opera";if(Z(o))return"IEMobile";if(o.includes("msie")||o.includes("trident/"))return"IE";if(o.includes("edge/"))return"Edge";if(ie(o))return"Firefox";if(o.includes("silk/"))return"Silk";if(W(o))return"Blackberry";if(ri(o))return"Webos";if(Yo(o))return"Safari";if((o.includes("chrome/")||Tt(o))&&!o.includes("edge/"))return"Chrome";if(On(o))return"Android";{const l=c.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/);if(2===(null==l?void 0:l.length))return l[1]}return"Other"}function ie(c=(0,C.z$)()){return/firefox\//i.test(c)}function Yo(c=(0,C.z$)()){const o=c.toLowerCase();return o.includes("safari/")&&!o.includes("chrome/")&&!o.includes("crios/")&&!o.includes("android")}function Tt(c=(0,C.z$)()){return/crios\//i.test(c)}function Z(c=(0,C.z$)()){return/iemobile/i.test(c)}function On(c=(0,C.z$)()){return/android/i.test(c)}function W(c=(0,C.z$)()){return/blackberry/i.test(c)}function ri(c=(0,C.z$)()){return/webos/i.test(c)}function jt(c=(0,C.z$)()){return/iphone|ipad|ipod/i.test(c)||/macintosh/i.test(c)&&/mobile/i.test(c)}function Qu(c=(0,C.z$)()){return jt(c)||On(c)||ri(c)||W(c)||/windows phone/i.test(c)||Z(c)}function Yu(c,o=[]){let a;switch(c){case"Browser":a=$t((0,C.z$)());break;case"Worker":a=`${$t((0,C.z$)())}-${c}`;break;default:a=c}const l=o.length?o.join(","):"FirebaseCore-web";return`${a}/JsCore/${k.SDK_VERSION}/${l}`}class $e{constructor(o){this.auth=o,this.queue=[]}pushCallback(o,a){const l=y=>new Promise((v,T)=>{try{v(o(y))}catch(N){T(N)}});l.onAbort=a,this.queue.push(l);const p=this.queue.length-1;return()=>{this.queue[p]=()=>Promise.resolve()}}runMiddleware(o){var a=this;return(0,I.Z)(function*(){if(a.auth.currentUser===o)return;const l=[];try{for(const p of a.queue)yield p(o),p.onAbort&&l.push(p.onAbort)}catch(p){l.reverse();for(const y of l)try{y()}catch(v){}throw a.auth._errorFactory.create("login-blocked",{originalMessage:null==p?void 0:p.message})}})()}}class ls{constructor(o,a,l){this.app=o,this.heartbeatServiceProvider=a,this.config=l,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new zt(this),this.idTokenSubscription=new zt(this),this.beforeStateQueue=new $e(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=pr,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=o.name,this.clientVersion=l.sdkClientVersion}_initializeWithPersistence(o,a){var l=this;return a&&(this._popupRedirectResolver=Se(a)),this._initializationPromise=this.queue((0,I.Z)(function*(){var p,y;if(!l._deleted&&(l.persistenceManager=yield Gt.create(l,o),!l._deleted)){if(null===(p=l._popupRedirectResolver)||void 0===p?void 0:p._shouldInitProactively)try{yield l._popupRedirectResolver._initialize(l)}catch(v){}yield l.initializeCurrentUser(a),l.lastNotifiedUid=(null===(y=l.currentUser)||void 0===y?void 0:y.uid)||null,!l._deleted&&(l._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){var o=this;return(0,I.Z)(function*(){if(o._deleted)return;const a=yield o.assertedPersistence.getCurrentUser();if(o.currentUser||a){if(o.currentUser&&a&&o.currentUser.uid===a.uid)return o._currentUser._assign(a),void(yield o.currentUser.getIdToken());yield o._updateCurrentUser(a,!0)}})()}initializeCurrentUser(o){var a=this;return(0,I.Z)(function*(){var l;const p=yield a.assertedPersistence.getCurrentUser();let y=p,v=!1;if(o&&a.config.authDomain){yield a.getOrInitRedirectPersistenceManager();const T=null===(l=a.redirectUser)||void 0===l?void 0:l._redirectEventId,N=null==y?void 0:y._redirectEventId,U=yield a.tryRedirectSignIn(o);(!T||T===N)&&(null==U?void 0:U.user)&&(y=U.user,v=!0)}if(!y)return a.directlySetCurrentUser(null);if(!y._redirectEventId){if(v)try{yield a.beforeStateQueue.runMiddleware(y)}catch(T){y=p,a._popupRedirectResolver._overrideRedirectResult(a,()=>Promise.reject(T))}return y?a.reloadAndSetCurrentUserOrClear(y):a.directlySetCurrentUser(null)}return R(a._popupRedirectResolver,a,"argument-error"),yield a.getOrInitRedirectPersistenceManager(),a.redirectUser&&a.redirectUser._redirectEventId===y._redirectEventId?a.directlySetCurrentUser(y):a.reloadAndSetCurrentUserOrClear(y)})()}tryRedirectSignIn(o){var a=this;return(0,I.Z)(function*(){let l=null;try{l=yield a._popupRedirectResolver._completeRedirectFn(a,o,!0)}catch(p){yield a._setRedirectUser(null)}return l})()}reloadAndSetCurrentUserOrClear(o){var a=this;return(0,I.Z)(function*(){try{yield vt(o)}catch(l){if("auth/network-request-failed"!==(null==l?void 0:l.code))return a.directlySetCurrentUser(null)}return a.directlySetCurrentUser(o)})()}useDeviceLanguage(){this.languageCode=function th(){if("undefined"==typeof navigator)return null;const c=navigator;return c.languages&&c.languages[0]||c.language||null}()}_delete(){var o=this;return(0,I.Z)(function*(){o._deleted=!0})()}updateCurrentUser(o){var a=this;return(0,I.Z)(function*(){const l=o?(0,C.m9)(o):null;return l&&R(l.auth.config.apiKey===a.config.apiKey,a,"invalid-user-token"),a._updateCurrentUser(l&&l._clone(a))})()}_updateCurrentUser(o,a=!1){var l=this;return(0,I.Z)(function*(){if(!l._deleted)return o&&R(l.tenantId===o.tenantId,l,"tenant-id-mismatch"),a||(yield l.beforeStateQueue.runMiddleware(o)),l.queue((0,I.Z)(function*(){yield l.directlySetCurrentUser(o),l.notifyAuthListeners()}))})()}signOut(){var o=this;return(0,I.Z)(function*(){return yield o.beforeStateQueue.runMiddleware(null),(o.redirectPersistenceManager||o._popupRedirectResolver)&&(yield o._setRedirectUser(null)),o._updateCurrentUser(null,!0)})()}setPersistence(o){var a=this;return this.queue((0,I.Z)(function*(){yield a.assertedPersistence.setPersistence(Se(o))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(o){this._errorFactory=new C.LL("auth","Firebase",o())}onAuthStateChanged(o,a,l){return this.registerStateListener(this.authStateSubscription,o,a,l)}beforeAuthStateChanged(o,a){return this.beforeStateQueue.pushCallback(o,a)}onIdTokenChanged(o,a,l){return this.registerStateListener(this.idTokenSubscription,o,a,l)}toJSON(){var o;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(o=this._currentUser)||void 0===o?void 0:o.toJSON()}}_setRedirectUser(o,a){var l=this;return(0,I.Z)(function*(){const p=yield l.getOrInitRedirectPersistenceManager(a);return null===o?p.removeCurrentUser():p.setCurrentUser(o)})()}getOrInitRedirectPersistenceManager(o){var a=this;return(0,I.Z)(function*(){if(!a.redirectPersistenceManager){const l=o&&Se(o)||a._popupRedirectResolver;R(l,a,"argument-error"),a.redirectPersistenceManager=yield Gt.create(a,[Se(l._redirectPersistence)],"redirectUser"),a.redirectUser=yield a.redirectPersistenceManager.getCurrentUser()}return a.redirectPersistenceManager})()}_redirectUserForId(o){var a=this;return(0,I.Z)(function*(){var l,p;return a._isInitialized&&(yield a.queue((0,I.Z)(function*(){}))),(null===(l=a._currentUser)||void 0===l?void 0:l._redirectEventId)===o?a._currentUser:(null===(p=a.redirectUser)||void 0===p?void 0:p._redirectEventId)===o?a.redirectUser:null})()}_persistUserIfCurrent(o){var a=this;return(0,I.Z)(function*(){if(o===a.currentUser)return a.queue((0,I.Z)(function*(){return a.directlySetCurrentUser(o)}))})()}_notifyListenersIfCurrent(o){o===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var o,a;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const l=null!==(a=null===(o=this.currentUser)||void 0===o?void 0:o.uid)&&void 0!==a?a:null;this.lastNotifiedUid!==l&&(this.lastNotifiedUid=l,this.authStateSubscription.next(this.currentUser))}registerStateListener(o,a,l,p){if(this._deleted)return()=>{};const y="function"==typeof a?a:a.next.bind(a),v=this._isInitialized?Promise.resolve():this._initializationPromise;return R(v,this,"internal-error"),v.then(()=>y(this.currentUser)),"function"==typeof a?o.addObserver(a,l,p):o.addObserver(a)}directlySetCurrentUser(o){var a=this;return(0,I.Z)(function*(){a.currentUser&&a.currentUser!==o&&a._currentUser._stopProactiveRefresh(),o&&a.isProactiveRefreshEnabled&&o._startProactiveRefresh(),a.currentUser=o,o?yield a.assertedPersistence.setCurrentUser(o):yield a.assertedPersistence.removeCurrentUser()})()}queue(o){return this.operations=this.operations.then(o,o),this.operations}get assertedPersistence(){return R(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(o){!o||this.frameworks.includes(o)||(this.frameworks.push(o),this.frameworks.sort(),this.clientVersion=Yu(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){var o=this;return(0,I.Z)(function*(){var a;const l={"X-Client-Version":o.clientVersion};o.app.options.appId&&(l["X-Firebase-gmpid"]=o.app.options.appId);const p=yield null===(a=o.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===a?void 0:a.getHeartbeatsHeader();return p&&(l["X-Firebase-Client"]=p),l})()}}function te(c){return(0,C.m9)(c)}class zt{constructor(o){this.auth=o,this.observer=null,this.addObserver=(0,C.ne)(a=>this.observer=a)}get next(){return R(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Xo(c){const o=c.indexOf(":");return o<0?"":c.substr(0,o+1)}function ta(c){if(!c)return null;const o=Number(c);return isNaN(o)?null:o}class Ir{constructor(o,a){this.providerId=o,this.signInMethod=a}toJSON(){return it("not implemented")}_getIdTokenResponse(o){return it("not implemented")}_linkToIdToken(o,a){return it("not implemented")}_getReauthenticationResolver(o){return it("not implemented")}}function si(c,o){return hs.apply(this,arguments)}function hs(){return(hs=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:resetPassword",Ce(c,o))})).apply(this,arguments)}function ds(c,o){return wr.apply(this,arguments)}function wr(){return(wr=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function kt(c,o){return oi.apply(this,arguments)}function oi(){return(oi=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:update",Ce(c,o))})).apply(this,arguments)}function na(){return(na=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPassword",Ce(c,o))})).apply(this,arguments)}function Wt(c,o){return fs.apply(this,arguments)}function fs(){return(fs=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:sendOobCode",Ce(c,o))})).apply(this,arguments)}function ra(c,o){return ps.apply(this,arguments)}function ps(){return(ps=(0,I.Z)(function*(c,o){return Wt(c,o)})).apply(this,arguments)}function lh(c,o){return ms.apply(this,arguments)}function ms(){return(ms=(0,I.Z)(function*(c,o){return Wt(c,o)})).apply(this,arguments)}function gs(c,o){return ai.apply(this,arguments)}function ai(){return(ai=(0,I.Z)(function*(c,o){return Wt(c,o)})).apply(this,arguments)}function ia(c,o){return ui.apply(this,arguments)}function ui(){return(ui=(0,I.Z)(function*(c,o){return Wt(c,o)})).apply(this,arguments)}function sa(){return(sa=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithEmailLink",Ce(c,o))})).apply(this,arguments)}function ys(){return(ys=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithEmailLink",Ce(c,o))})).apply(this,arguments)}class ci extends Ir{constructor(o,a,l,p=null){super("password",l),this._email=o,this._password=a,this._tenantId=p}static _fromEmailAndPassword(o,a){return new ci(o,a,"password")}static _fromEmailAndCode(o,a,l=null){return new ci(o,a,"emailLink",l)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o;if((null==a?void 0:a.email)&&(null==a?void 0:a.password)){if("password"===a.signInMethod)return this._fromEmailAndPassword(a.email,a.password);if("emailLink"===a.signInMethod)return this._fromEmailAndCode(a.email,a.password,a.tenantId)}return null}_getIdTokenResponse(o){var a=this;return(0,I.Z)(function*(){switch(a.signInMethod){case"password":return function ch(c,o){return na.apply(this,arguments)}(o,{returnSecureToken:!0,email:a._email,password:a._password});case"emailLink":return function hh(c,o){return sa.apply(this,arguments)}(o,{email:a._email,oobCode:a._password});default:oe(o,"internal-error")}})()}_linkToIdToken(o,a){var l=this;return(0,I.Z)(function*(){switch(l.signInMethod){case"password":return ds(o,{idToken:a,returnSecureToken:!0,email:l._email,password:l._password});case"emailLink":return function oa(c,o){return ys.apply(this,arguments)}(o,{idToken:a,email:l._email,oobCode:l._password});default:oe(o,"internal-error")}})()}_getReauthenticationResolver(o){return this._getIdTokenResponse(o)}}function ot(c,o){return aa.apply(this,arguments)}function aa(){return(aa=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithIdp",Ce(c,o))})).apply(this,arguments)}class xt extends Ir{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(o){const a=new xt(o.providerId,o.signInMethod);return o.idToken||o.accessToken?(o.idToken&&(a.idToken=o.idToken),o.accessToken&&(a.accessToken=o.accessToken),o.nonce&&!o.pendingToken&&(a.nonce=o.nonce),o.pendingToken&&(a.pendingToken=o.pendingToken)):o.oauthToken&&o.oauthTokenSecret?(a.accessToken=o.oauthToken,a.secret=o.oauthTokenSecret):oe("argument-error"),a}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p}=a,y=(0,Yr._T)(a,["providerId","signInMethod"]);if(!l||!p)return null;const v=new xt(l,p);return v.idToken=y.idToken||void 0,v.accessToken=y.accessToken||void 0,v.secret=y.secret,v.nonce=y.nonce,v.pendingToken=y.pendingToken||null,v}_getIdTokenResponse(o){return ot(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,ot(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,ot(o,a)}buildRequest(){const o={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)o.pendingToken=this.pendingToken;else{const a={};this.idToken&&(a.id_token=this.idToken),this.accessToken&&(a.access_token=this.accessToken),this.secret&&(a.oauth_token_secret=this.secret),a.providerId=this.providerId,this.nonce&&!this.pendingToken&&(a.nonce=this.nonce),o.postBody=(0,C.xO)(a)}return o}}function dh(c,o){return br.apply(this,arguments)}function br(){return(br=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:sendVerificationCode",Ce(c,o))})).apply(this,arguments)}function _s(){return(_s=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPhoneNumber",Ce(c,o))})).apply(this,arguments)}function vs(){return(vs=(0,I.Z)(function*(c,o){const a=yield qt(c,"POST","/v1/accounts:signInWithPhoneNumber",Ce(c,o));if(a.temporaryProof)throw as(c,"account-exists-with-different-credential",a);return a})).apply(this,arguments)}const Is={USER_NOT_FOUND:"user-not-found"};function hi(){return(hi=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithPhoneNumber",Ce(c,Object.assign(Object.assign({},o),{operation:"REAUTH"})),Is)})).apply(this,arguments)}class Kt extends Ir{constructor(o){super("phone","phone"),this.params=o}static _fromVerification(o,a){return new Kt({verificationId:o,verificationCode:a})}static _fromTokenResponse(o,a){return new Kt({phoneNumber:o,temporaryProof:a})}_getIdTokenResponse(o){return function ua(c,o){return _s.apply(this,arguments)}(o,this._makeVerificationRequest())}_linkToIdToken(o,a){return function Xu(c,o){return vs.apply(this,arguments)}(o,Object.assign({idToken:a},this._makeVerificationRequest()))}_getReauthenticationResolver(o){return function ca(c,o){return hi.apply(this,arguments)}(o,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:o,phoneNumber:a,verificationId:l,verificationCode:p}=this.params;return o&&a?{temporaryProof:o,phoneNumber:a}:{sessionInfo:l,code:p}}toJSON(){const o={providerId:this.providerId};return this.params.phoneNumber&&(o.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(o.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(o.verificationCode=this.params.verificationCode),this.params.verificationId&&(o.verificationId=this.params.verificationId),o}static fromJSON(o){"string"==typeof o&&(o=JSON.parse(o));const{verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}=o;return l||a||p||y?new Kt({verificationId:a,verificationCode:l,phoneNumber:p,temporaryProof:y}):null}}class Er{constructor(o){var a,l,p,y,v,T;const N=(0,C.zd)((0,C.pd)(o)),U=null!==(a=N.apiKey)&&void 0!==a?a:null,j=null!==(l=N.oobCode)&&void 0!==l?l:null,G=function la(c){switch(c){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(p=N.mode)&&void 0!==p?p:null);R(U&&j&&G,"argument-error"),this.apiKey=U,this.operation=G,this.code=j,this.continueUrl=null!==(y=N.continueUrl)&&void 0!==y?y:null,this.languageCode=null!==(v=N.languageCode)&&void 0!==v?v:null,this.tenantId=null!==(T=N.tenantId)&&void 0!==T?T:null}static parseLink(o){const a=function ec(c){const o=(0,C.zd)((0,C.pd)(c)).link,a=o?(0,C.zd)((0,C.pd)(o)).deep_link_id:null,l=(0,C.zd)((0,C.pd)(c)).deep_link_id;return(l?(0,C.zd)((0,C.pd)(l)).link:null)||l||a||o||c}(o);try{return new Er(a)}catch(l){return null}}}let ws=(()=>{class c{constructor(){this.providerId=c.PROVIDER_ID}static credential(a,l){return ci._fromEmailAndPassword(a,l)}static credentialWithLink(a,l){const p=Er.parseLink(l);return R(p,"argument-error"),ci._fromEmailAndCode(a,p.code,p.tenantId)}}return c.PROVIDER_ID="password",c.EMAIL_PASSWORD_SIGN_IN_METHOD="password",c.EMAIL_LINK_SIGN_IN_METHOD="emailLink",c})();class At{constructor(o){this.providerId=o,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(o){this.defaultLanguageCode=o}setCustomParameters(o){return this.customParameters=o,this}getCustomParameters(){return this.customParameters}}class sn extends At{constructor(){super(...arguments),this.scopes=[]}addScope(o){return this.scopes.includes(o)||this.scopes.push(o),this}getScopes(){return[...this.scopes]}}class Mn extends sn{static credentialFromJSON(o){const a="string"==typeof o?JSON.parse(o):o;return R("providerId"in a&&"signInMethod"in a,"argument-error"),xt._fromParams(a)}credential(o){return this._credential(Object.assign(Object.assign({},o),{nonce:o.rawNonce}))}_credential(o){return R(o.idToken||o.accessToken,"argument-error"),xt._fromParams(Object.assign(Object.assign({},o),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(o){return Mn.oauthCredentialFromTaggedObject(o)}static credentialFromError(o){return Mn.oauthCredentialFromTaggedObject(o.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{oauthIdToken:a,oauthAccessToken:l,oauthTokenSecret:p,pendingToken:y,nonce:v,providerId:T}=o;if(!l&&!p&&!a&&!y||!T)return null;try{return new Mn(T)._credential({idToken:a,accessToken:l,nonce:v,pendingToken:y})}catch(N){return null}}}let tc=(()=>{class c extends sn{constructor(){super("facebook.com")}static credential(a){return xt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.FACEBOOK_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.FACEBOOK_SIGN_IN_METHOD="facebook.com",c.PROVIDER_ID="facebook.com",c})(),bs=(()=>{class c extends sn{constructor(){super("google.com"),this.addScope("profile")}static credential(a,l){return xt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GOOGLE_SIGN_IN_METHOD,idToken:a,accessToken:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthIdToken:l,oauthAccessToken:p}=a;if(!l&&!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.GOOGLE_SIGN_IN_METHOD="google.com",c.PROVIDER_ID="google.com",c})(),Es=(()=>{class c extends sn{constructor(){super("github.com")}static credential(a){return xt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.GITHUB_SIGN_IN_METHOD,accessToken:a})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a||!("oauthAccessToken"in a)||!a.oauthAccessToken)return null;try{return c.credential(a.oauthAccessToken)}catch(l){return null}}}return c.GITHUB_SIGN_IN_METHOD="github.com",c.PROVIDER_ID="github.com",c})();class ge extends Ir{constructor(o,a){super(o,o),this.pendingToken=a}_getIdTokenResponse(o){return ot(o,this.buildRequest())}_linkToIdToken(o,a){const l=this.buildRequest();return l.idToken=a,ot(o,l)}_getReauthenticationResolver(o){const a=this.buildRequest();return a.autoCreate=!1,ot(o,a)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(o){const a="string"==typeof o?JSON.parse(o):o,{providerId:l,signInMethod:p,pendingToken:y}=a;return l&&p&&y&&l===p?new ge(l,y):null}static _create(o,a){return new ge(o,a)}buildRequest(){return{requestUri:"http://localhost",returnSecureToken:!0,pendingToken:this.pendingToken}}}class Pn extends At{constructor(o){R(o.startsWith("saml."),"argument-error"),super(o)}static credentialFromResult(o){return Pn.samlCredentialFromTaggedObject(o)}static credentialFromError(o){return Pn.samlCredentialFromTaggedObject(o.customData||{})}static credentialFromJSON(o){const a=ge.fromJSON(o);return R(a,"argument-error"),a}static samlCredentialFromTaggedObject({_tokenResponse:o}){if(!o)return null;const{pendingToken:a,providerId:l}=o;if(!a||!l)return null;try{return ge._create(l,a)}catch(p){return null}}}let Ts=(()=>{class c extends sn{constructor(){super("twitter.com")}static credential(a,l){return xt._fromParams({providerId:c.PROVIDER_ID,signInMethod:c.TWITTER_SIGN_IN_METHOD,oauthToken:a,oauthTokenSecret:l})}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{oauthAccessToken:l,oauthTokenSecret:p}=a;if(!l||!p)return null;try{return c.credential(l,p)}catch(y){return null}}}return c.TWITTER_SIGN_IN_METHOD="twitter.com",c.PROVIDER_ID="twitter.com",c})();function nc(c,o){return da.apply(this,arguments)}function da(){return(da=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signUp",Ce(c,o))})).apply(this,arguments)}class at{constructor(o){this.user=o.user,this.providerId=o.providerId,this._tokenResponse=o._tokenResponse,this.operationType=o.operationType}static _fromIdTokenResponse(o,a,l,p=!1){return(0,I.Z)(function*(){const y=yield Ge._fromIdTokenResponse(o,l,p),v=rc(l);return new at({user:y,providerId:v,_tokenResponse:l,operationType:a})})()}static _forOperation(o,a,l){return(0,I.Z)(function*(){yield o._updateTokensIfNecessary(l,!0);const p=rc(l);return new at({user:o,providerId:p,_tokenResponse:l,operationType:a})})()}}function rc(c){return c.providerId?c.providerId:"phoneNumber"in c?"phone":null}function ks(){return(ks=(0,I.Z)(function*(c){var o;const a=te(c);if(yield a._initializationPromise,null===(o=a.currentUser)||void 0===o?void 0:o.isAnonymous)return new at({user:a.currentUser,providerId:null,operationType:"signIn"});const l=yield nc(a,{returnSecureToken:!0}),p=yield at._fromIdTokenResponse(a,"signIn",l,!0);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class Tr extends C.ZR{constructor(o,a,l,p){var y;super(a.code,a.message),this.operationType=l,this.user=p,Object.setPrototypeOf(this,Tr.prototype),this.customData={appName:o.name,tenantId:null!==(y=o.tenantId)&&void 0!==y?y:void 0,_serverResponse:a.customData._serverResponse,operationType:l}}static _fromErrorAndOperation(o,a,l,p){return new Tr(o,a,l,p)}}function ic(c,o,a,l){return("reauthenticate"===o?a._getReauthenticationResolver(c):a._getIdTokenResponse(c)).catch(y=>{throw"auth/multi-factor-auth-required"===y.code?Tr._fromErrorAndOperation(c,y,o,l):y})}function xs(c){return new Set(c.map(({providerId:o})=>o).filter(o=>!!o))}function fa(){return(fa=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c);yield xr(!0,a,o);const{providerUserInfo:l}=yield pp(a.auth,{idToken:yield a.getIdToken(),deleteProvider:[o]}),p=xs(l||[]);return a.providerData=a.providerData.filter(y=>p.has(y.providerId)),p.has("phone")||(a.phoneNumber=null),yield a.auth._persistUserIfCurrent(a),a})).apply(this,arguments)}function kr(c,o){return di.apply(this,arguments)}function di(){return(di=(0,I.Z)(function*(c,o,a=!1){const l=yield Bt(c,o._linkToIdToken(c.auth,yield c.getIdToken()),a);return at._forOperation(c,"link",l)})).apply(this,arguments)}function xr(c,o,a){return As.apply(this,arguments)}function As(){return(As=(0,I.Z)(function*(c,o,a){yield vt(o);const p=!1===c?"provider-already-linked":"no-such-provider";R(xs(o.providerData).has(a)===c,o.auth,p)})).apply(this,arguments)}function oc(c,o){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,I.Z)(function*(c,o,a=!1){const{auth:l}=c,p="reauthenticate";try{const y=yield Bt(c,ic(l,p,o,c),a);R(y.idToken,l,"internal-error");const v=cs(y.idToken);R(v,l,"internal-error");const{sub:T}=v;return R(c.uid===T,l,"user-mismatch"),at._forOperation(c,p,y)}catch(y){throw"auth/user-not-found"===(null==y?void 0:y.code)&&oe(l,"user-mismatch"),y}})).apply(this,arguments)}function pa(c,o){return Ss.apply(this,arguments)}function Ss(){return(Ss=(0,I.Z)(function*(c,o,a=!1){const l="signIn",p=yield ic(c,l,o),y=yield at._fromIdTokenResponse(c,l,p);return a||(yield c._updateCurrentUser(y.user)),y})).apply(this,arguments)}function fi(c,o){return Ar.apply(this,arguments)}function Ar(){return(Ar=(0,I.Z)(function*(c,o){return pa(te(c),o)})).apply(this,arguments)}function ac(c,o){return ma.apply(this,arguments)}function ma(){return(ma=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c);return yield xr(!1,a,o.providerId),kr(a,o)})).apply(this,arguments)}function Fn(c,o){return ga.apply(this,arguments)}function ga(){return(ga=(0,I.Z)(function*(c,o){return oc((0,C.m9)(c),o)})).apply(this,arguments)}function ph(c,o){return Ht.apply(this,arguments)}function Ht(){return(Ht=(0,I.Z)(function*(c,o){return qt(c,"POST","/v1/accounts:signInWithCustomToken",Ce(c,o))})).apply(this,arguments)}function Sr(){return(Sr=(0,I.Z)(function*(c,o){const a=te(c),l=yield ph(a,{token:o,returnSecureToken:!0}),p=yield at._fromIdTokenResponse(a,"signIn",l);return yield a._updateCurrentUser(p.user),p})).apply(this,arguments)}class pi{constructor(o,a){this.factorId=o,this.uid=a.mfaEnrollmentId,this.enrollmentTime=new Date(a.enrolledAt).toUTCString(),this.displayName=a.displayName}static _fromServerResponse(o,a){return"phoneInfo"in a?Un._fromServerResponse(o,a):oe(o,"internal-error")}}class Un extends pi{constructor(o){super("phone",o),this.phoneNumber=o.phoneInfo}static _fromServerResponse(o,a){return new Un(a)}}function mi(c,o,a){var l;R((null===(l=a.url)||void 0===l?void 0:l.length)>0,c,"invalid-continue-uri"),R(void 0===a.dynamicLinkDomain||a.dynamicLinkDomain.length>0,c,"invalid-dynamic-link-domain"),o.continueUrl=a.url,o.dynamicLinkDomain=a.dynamicLinkDomain,o.canHandleCodeInApp=a.handleCodeInApp,a.iOS&&(R(a.iOS.bundleId.length>0,c,"missing-ios-bundle-id"),o.iOSBundleId=a.iOS.bundleId),a.android&&(R(a.android.packageName.length>0,c,"missing-android-pkg-name"),o.androidInstallApp=a.android.installApp,o.androidMinimumVersionCode=a.android.minimumVersion,o.androidPackageName=a.android.packageName)}function Cs(){return(Cs=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p={requestType:"PASSWORD_RESET",email:o};a&&mi(l,p,a),yield lh(l,p)})).apply(this,arguments)}function Cr(){return(Cr=(0,I.Z)(function*(c,o,a){yield si((0,C.m9)(c),{oobCode:o,newPassword:a})})).apply(this,arguments)}function yi(){return(yi=(0,I.Z)(function*(c,o){yield kt((0,C.m9)(c),{oobCode:o})})).apply(this,arguments)}function ya(c,o){return Ds.apply(this,arguments)}function Ds(){return(Ds=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c),l=yield si(a,{oobCode:o}),p=l.requestType;switch(R(p,a,"internal-error"),p){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":R(l.newEmail,a,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":R(l.mfaInfo,a,"internal-error");default:R(l.email,a,"internal-error")}let y=null;return l.mfaInfo&&(y=pi._fromServerResponse(te(a),l.mfaInfo)),{data:{email:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.newEmail:l.email)||null,previousEmail:("VERIFY_AND_CHANGE_EMAIL"===l.requestType?l.email:l.newEmail)||null,multiFactorInfo:y},operation:p}})).apply(this,arguments)}function vi(){return(vi=(0,I.Z)(function*(c,o){const{data:a}=yield ya((0,C.m9)(c),o);return a.email})).apply(this,arguments)}function Ii(){return(Ii=(0,I.Z)(function*(c,o,a){const l=te(c),p=yield nc(l,{returnSecureToken:!0,email:o,password:a}),y=yield at._fromIdTokenResponse(l,"signIn",p);return yield l._updateCurrentUser(y.user),y})).apply(this,arguments)}function Ns(){return(Ns=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p={requestType:"EMAIL_SIGNIN",email:o};R(a.handleCodeInApp,l,"argument-error"),a&&mi(l,p,a),yield gs(l,p)})).apply(this,arguments)}function Dr(){return(Dr=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p=ws.credentialWithLink(o,a||Xr());return R(p._tenantId===(l.tenantId||null),l,"tenant-id-mismatch"),fi(l,p)})).apply(this,arguments)}function Ia(c,o){return Os.apply(this,arguments)}function Os(){return(Os=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:createAuthUri",Ce(c,o))})).apply(this,arguments)}function Ms(){return(Ms=(0,I.Z)(function*(c,o){const l={identifier:o,continueUri:ei()?Xr():"http://localhost"},{signinMethods:p}=yield Ia((0,C.m9)(c),l);return p||[]})).apply(this,arguments)}function Vn(){return(Vn=(0,I.Z)(function*(c,o){const a=(0,C.m9)(c),p={requestType:"VERIFY_EMAIL",idToken:yield c.getIdToken()};o&&mi(a.auth,p,o);const{email:y}=yield ra(a.auth,p);y!==c.email&&(yield c.reload())})).apply(this,arguments)}function Rr(){return(Rr=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),y={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:yield c.getIdToken(),newEmail:o};a&&mi(l.auth,y,a);const{email:v}=yield ia(l.auth,y);v!==c.email&&(yield c.reload())})).apply(this,arguments)}function bi(c,o){return Qt.apply(this,arguments)}function Qt(){return(Qt=(0,I.Z)(function*(c,o){return De(c,"POST","/v1/accounts:update",o)})).apply(this,arguments)}function ba(){return(ba=(0,I.Z)(function*(c,{displayName:o,photoURL:a}){if(void 0===o&&void 0===a)return;const l=(0,C.m9)(c),y={idToken:yield l.getIdToken(),displayName:o,photoUrl:a,returnSecureToken:!0},v=yield Bt(l,bi(l.auth,y));l.displayName=v.displayName||null,l.photoURL=v.photoUrl||null;const T=l.providerData.find(({providerId:N})=>"password"===N);T&&(T.displayName=l.displayName,T.photoURL=l.photoURL),yield l._updateTokensIfNecessary(v)})).apply(this,arguments)}function Ea(c,o,a){return Ta.apply(this,arguments)}function Ta(){return(Ta=(0,I.Z)(function*(c,o,a){const{auth:l}=c,y={idToken:yield c.getIdToken(),returnSecureToken:!0};o&&(y.email=o),a&&(y.password=a);const v=yield Bt(c,ds(l,y));yield c._updateTokensIfNecessary(v,!0)})).apply(this,arguments)}class et{constructor(o,a,l={}){this.isNewUser=o,this.providerId=a,this.profile=l}}class Ei extends et{constructor(o,a,l,p){super(o,a,l),this.username=p}}class Ps extends et{constructor(o,a){super(o,"facebook.com",a)}}class fc extends Ei{constructor(o,a){super(o,"github.com",a,"string"==typeof(null==a?void 0:a.login)?null==a?void 0:a.login:null)}}class de extends et{constructor(o,a){super(o,"google.com",a)}}class Ls extends Ei{constructor(o,a,l){super(o,"twitter.com",a,l)}}function Ti(c){const{user:o,_tokenResponse:a}=c;return o.isAnonymous&&!a?{providerId:null,isNewUser:!1,profile:null}:function qn(c){var o,a;if(!c)return null;const{providerId:l}=c,p=c.rawUserInfo?JSON.parse(c.rawUserInfo):{},y=c.isNewUser||"identitytoolkit#SignupNewUserResponse"===c.kind;if(!l&&(null==c?void 0:c.idToken)){const v=null===(a=null===(o=cs(c.idToken))||void 0===o?void 0:o.firebase)||void 0===a?void 0:a.sign_in_provider;if(v)return new et(y,"anonymous"!==v&&"custom"!==v?v:null)}if(!l)return null;switch(l){case"facebook.com":return new Ps(y,p);case"github.com":return new fc(y,p);case"google.com":return new de(y,p);case"twitter.com":return new Ls(y,p,c.screenName||null);case"custom":case"anonymous":return new et(y,null);default:return new et(y,l,p)}}(a)}class on{constructor(o,a,l){this.type=o,this.credential=a,this.auth=l}static _fromIdtoken(o,a){return new on("enroll",o,a)}static _fromMfaPendingCredential(o){return new on("signin",o)}toJSON(){return{multiFactorSession:{["enroll"===this.type?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(o){var a,l;if(null==o?void 0:o.multiFactorSession){if(null===(a=o.multiFactorSession)||void 0===a?void 0:a.pendingCredential)return on._fromMfaPendingCredential(o.multiFactorSession.pendingCredential);if(null===(l=o.multiFactorSession)||void 0===l?void 0:l.idToken)return on._fromIdtoken(o.multiFactorSession.idToken)}return null}}class Vs{constructor(o,a,l){this.session=o,this.hints=a,this.signInResolver=l}static _fromError(o,a){const l=te(o),p=a.customData._serverResponse,y=(p.mfaInfo||[]).map(T=>pi._fromServerResponse(l,T));R(p.mfaPendingCredential,l,"internal-error");const v=on._fromMfaPendingCredential(p.mfaPendingCredential);return new Vs(v,y,function(){var T=(0,I.Z)(function*(N){const U=yield N._process(l,v);delete p.mfaInfo,delete p.mfaPendingCredential;const j=Object.assign(Object.assign({},p),{idToken:U.idToken,refreshToken:U.refreshToken});switch(a.operationType){case"signIn":const G=yield at._fromIdTokenResponse(l,a.operationType,j);return yield l._updateCurrentUser(G.user),G;case"reauthenticate":return R(a.user,l,"internal-error"),at._forOperation(a.user,a.operationType,j);default:oe(l,"internal-error")}});return function(N){return T.apply(this,arguments)}}())}resolveSignIn(o){var a=this;return(0,I.Z)(function*(){return a.signInResolver(o)})()}}function Nr(c,o){return De(c,"POST","/v2/accounts/mfaEnrollment:start",Ce(c,o))}class qs{constructor(o){this.user=o,this.enrolledFactors=[],o._onReload(a=>{a.mfaInfo&&(this.enrolledFactors=a.mfaInfo.map(l=>pi._fromServerResponse(o.auth,l)))})}static _fromUser(o){return new qs(o)}getSession(){var o=this;return(0,I.Z)(function*(){return on._fromIdtoken(yield o.user.getIdToken(),o.user.auth)})()}enroll(o,a){var l=this;return(0,I.Z)(function*(){const p=o,y=yield l.getSession(),v=yield Bt(l.user,p._process(l.user.auth,y,a));return yield l.user._updateTokensIfNecessary(v),l.user.reload()})()}unenroll(o){var a=this;return(0,I.Z)(function*(){const l="string"==typeof o?o:o.uid,p=yield a.user.getIdToken(),y=yield Bt(a.user,function Ih(c,o){return De(c,"POST","/v2/accounts/mfaEnrollment:withdraw",Ce(c,o))}(a.user.auth,{idToken:p,mfaEnrollmentId:l}));a.enrolledFactors=a.enrolledFactors.filter(({uid:v})=>v!==l),yield a.user._updateTokensIfNecessary(y);try{yield a.user.reload()}catch(v){if("auth/user-token-expired"!==(null==v?void 0:v.code))throw v}})()}}const ka=new WeakMap,ki="__sak";class Bs{constructor(o,a){this.storageRetriever=o,this.type=a}_isAvailable(){try{return this.storage?(this.storage.setItem(ki,"1"),this.storage.removeItem(ki),Promise.resolve(!0)):Promise.resolve(!1)}catch(o){return Promise.resolve(!1)}}_set(o,a){return this.storage.setItem(o,JSON.stringify(a)),Promise.resolve()}_get(o){const a=this.storage.getItem(o);return Promise.resolve(a?JSON.parse(a):null)}_remove(o){return this.storage.removeItem(o),Promise.resolve()}get storage(){return this.storageRetriever()}}const Zs=(()=>{class c extends Bs{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(a,l)=>this.onStorageEvent(a,l),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function xa(){const c=(0,C.z$)();return Yo(c)||jt(c)}()&&function uh(){try{return!(!window||window===window.top)}catch(c){return!1}}(),this.fallbackToPolling=Qu(),this._shouldAllowMigration=!0}forAllChangedKeys(a){for(const l of Object.keys(this.listeners)){const p=this.storage.getItem(l),y=this.localCache[l];p!==y&&a(l,y,p)}}onStorageEvent(a,l=!1){if(!a.key)return void this.forAllChangedKeys((T,N,U)=>{this.notifyListeners(T,U)});const p=a.key;if(l?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const T=this.storage.getItem(p);if(a.newValue!==T)null!==a.newValue?this.storage.setItem(p,a.newValue):this.storage.removeItem(p);else if(this.localCache[p]===a.newValue&&!l)return}const y=()=>{const T=this.storage.getItem(p);!l&&this.localCache[p]===T||this.notifyListeners(p,T)},v=this.storage.getItem(p);!function Jo(){return(0,C.w1)()&&10===document.documentMode}()||v===a.newValue||a.newValue===a.oldValue?y():setTimeout(y,10)}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l&&JSON.parse(l))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((a,l,p)=>{this.onStorageEvent(new StorageEvent("storage",{key:a,oldValue:l,newValue:p}),!0)})},1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(a,l){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[a]||(this.listeners[a]=new Set,this.localCache[a]=this.storage.getItem(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}_set(a,l){var p=()=>super._set,y=this;return(0,I.Z)(function*(){yield p().call(y,a,l),y.localCache[a]=JSON.stringify(l)})()}_get(a){var l=()=>super._get,p=this;return(0,I.Z)(function*(){const y=yield l().call(p,a);return p.localCache[a]=JSON.stringify(y),y})()}_remove(a){var l=()=>super._remove,p=this;return(0,I.Z)(function*(){yield l().call(p,a),delete p.localCache[a]})()}}return c.type="LOCAL",c})(),an=(()=>{class c extends Bs{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(a,l){}_removeListener(a,l){}}return c.type="SESSION",c})();let xi=(()=>{class c{constructor(a){this.eventTarget=a,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(a){const l=this.receivers.find(y=>y.isListeningto(a));if(l)return l;const p=new c(a);return this.receivers.push(p),p}isListeningto(a){return this.eventTarget===a}handleEvent(a){var l=this;return(0,I.Z)(function*(){const p=a,{eventId:y,eventType:v,data:T}=p.data,N=l.handlersMap[v];if(!(null==N?void 0:N.size))return;p.ports[0].postMessage({status:"ack",eventId:y,eventType:v});const U=Array.from(N).map(function(){var G=(0,I.Z)(function*(Ne){return Ne(p.origin,T)});return function(Ne){return G.apply(this,arguments)}}()),j=yield function Gs(c){return Promise.all(c.map(function(){var o=(0,I.Z)(function*(a){try{return{fulfilled:!0,value:yield a}}catch(l){return{fulfilled:!1,reason:l}}});return function(a){return o.apply(this,arguments)}}()))}(U);p.ports[0].postMessage({status:"done",eventId:y,eventType:v,response:j})})()}_subscribe(a,l){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[a]||(this.handlersMap[a]=new Set),this.handlersMap[a].add(l)}_unsubscribe(a,l){this.handlersMap[a]&&l&&this.handlersMap[a].delete(l),(!l||0===this.handlersMap[a].size)&&delete this.handlersMap[a],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}return c.receivers=[],c})();function un(c="",o=10){let a="";for(let l=0;l<o;l++)a+=Math.floor(10*Math.random());return c+a}class Aa{constructor(o){this.target=o,this.handlers=new Set}removeMessageHandler(o){o.messageChannel&&(o.messageChannel.port1.removeEventListener("message",o.onMessage),o.messageChannel.port1.close()),this.handlers.delete(o)}_send(o,a,l=50){var p=this;return(0,I.Z)(function*(){const y="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!y)throw new Error("connection_unavailable");let v,T;return new Promise((N,U)=>{const j=un("",20);y.port1.start();const G=setTimeout(()=>{U(new Error("unsupported_event"))},l);T={messageChannel:y,onMessage(Ne){const gt=Ne;if(gt.data.eventId===j)switch(gt.data.status){case"ack":clearTimeout(G),v=setTimeout(()=>{U(new Error("timeout"))},3e3);break;case"done":clearTimeout(v),N(gt.data.response);break;default:clearTimeout(G),clearTimeout(v),U(new Error("invalid_response"))}}},p.handlers.add(T),y.port1.addEventListener("message",T.onMessage),p.target.postMessage({eventType:o,eventId:j,data:a},[y.port2])}).finally(()=>{T&&p.removeMessageHandler(T)})})()}}function ke(){return window}function Bn(){return void 0!==ke().WorkerGlobalScope&&"function"==typeof ke().importScripts}function fe(){return(fe=(0,I.Z)(function*(){if(!(null==navigator?void 0:navigator.serviceWorker))return null;try{return(yield navigator.serviceWorker.ready).active}catch(c){return null}})).apply(this,arguments)}const wc="firebaseLocalStorageDb",Si="firebaseLocalStorage",Sa="fbase_key";class Or{constructor(o){this.request=o}toPromise(){return new Promise((o,a)=>{this.request.addEventListener("success",()=>{o(this.request.result)}),this.request.addEventListener("error",()=>{a(this.request.error)})})}}function Zn(c,o){return c.transaction([Si],o?"readwrite":"readonly").objectStore(Si)}function It(){const c=indexedDB.open(wc,1);return new Promise((o,a)=>{c.addEventListener("error",()=>{a(c.error)}),c.addEventListener("upgradeneeded",()=>{const l=c.result;try{l.createObjectStore(Si,{keyPath:Sa})}catch(p){a(p)}}),c.addEventListener("success",(0,I.Z)(function*(){const l=c.result;l.objectStoreNames.contains(Si)?o(l):(l.close(),yield function bc(){const c=indexedDB.deleteDatabase(wc);return new Or(c).toPromise()}(),o(yield It()))}))})}function Ca(c,o,a){return $s.apply(this,arguments)}function $s(){return($s=(0,I.Z)(function*(c,o,a){const l=Zn(c,!0).put({[Sa]:o,value:a});return new Or(l).toPromise()})).apply(this,arguments)}function Gn(){return(Gn=(0,I.Z)(function*(c,o){const a=Zn(c,!1).get(o),l=yield new Or(a).toPromise();return void 0===l?null:l.value})).apply(this,arguments)}function Ra(c,o){const a=Zn(c,!0).delete(o);return new Or(a).toPromise()}const Yt=(()=>{class c{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}_openDb(){var a=this;return(0,I.Z)(function*(){return a.db||(a.db=yield It()),a.db})()}_withRetries(a){var l=this;return(0,I.Z)(function*(){let p=0;for(;;)try{const y=yield l._openDb();return yield a(y)}catch(y){if(p++>3)throw y;l.db&&(l.db.close(),l.db=void 0)}})()}initializeServiceWorkerMessaging(){var a=this;return(0,I.Z)(function*(){return Bn()?a.initializeReceiver():a.initializeSender()})()}initializeReceiver(){var a=this;return(0,I.Z)(function*(){a.receiver=xi._getInstance(function bh(){return Bn()?self:null}()),a.receiver._subscribe("keyChanged",function(){var l=(0,I.Z)(function*(p,y){return{keyProcessed:(yield a._poll()).includes(y.key)}});return function(p,y){return l.apply(this,arguments)}}()),a.receiver._subscribe("ping",function(){var l=(0,I.Z)(function*(p,y){return["keyChanged"]});return function(p,y){return l.apply(this,arguments)}}())})()}initializeSender(){var a=this;return(0,I.Z)(function*(){var l,p;if(a.activeServiceWorker=yield function wh(){return fe.apply(this,arguments)}(),!a.activeServiceWorker)return;a.sender=new Aa(a.activeServiceWorker);const y=yield a.sender._send("ping",{},800);!y||(null===(l=y[0])||void 0===l?void 0:l.fulfilled)&&(null===(p=y[0])||void 0===p?void 0:p.value.includes("keyChanged"))&&(a.serviceWorkerReceiverAvailable=!0)})()}notifyServiceWorker(a){var l=this;return(0,I.Z)(function*(){if(l.sender&&l.activeServiceWorker&&function Ic(){var c;return(null===(c=null==navigator?void 0:navigator.serviceWorker)||void 0===c?void 0:c.controller)||null}()===l.activeServiceWorker)try{yield l.sender._send("keyChanged",{key:a},l.serviceWorkerReceiverAvailable?800:50)}catch(p){}})()}_isAvailable(){return(0,I.Z)(function*(){try{if(!indexedDB)return!1;const a=yield It();return yield Ca(a,ki,"1"),yield Ra(a,ki),!0}catch(a){}return!1})()}_withPendingWrite(a){var l=this;return(0,I.Z)(function*(){l.pendingWrites++;try{yield a()}finally{l.pendingWrites--}})()}_set(a,l){var p=this;return(0,I.Z)(function*(){return p._withPendingWrite((0,I.Z)(function*(){return yield p._withRetries(y=>Ca(y,a,l)),p.localCache[a]=l,p.notifyServiceWorker(a)}))})()}_get(a){var l=this;return(0,I.Z)(function*(){const p=yield l._withRetries(y=>function Da(c,o){return Gn.apply(this,arguments)}(y,a));return l.localCache[a]=p,p})()}_remove(a){var l=this;return(0,I.Z)(function*(){return l._withPendingWrite((0,I.Z)(function*(){return yield l._withRetries(p=>Ra(p,a)),delete l.localCache[a],l.notifyServiceWorker(a)}))})()}_poll(){var a=this;return(0,I.Z)(function*(){const l=yield a._withRetries(v=>{const T=Zn(v,!1).getAll();return new Or(T).toPromise()});if(!l)return[];if(0!==a.pendingWrites)return[];const p=[],y=new Set;for(const{fbase_key:v,value:T}of l)y.add(v),JSON.stringify(a.localCache[v])!==JSON.stringify(T)&&(a.notifyListeners(v,T),p.push(v));for(const v of Object.keys(a.localCache))a.localCache[v]&&!y.has(v)&&(a.notifyListeners(v,null),p.push(v));return p})()}notifyListeners(a,l){this.localCache[a]=l;const p=this.listeners[a];if(p)for(const y of Array.from(p))y(l)}startPolling(){var a=this;this.stopPolling(),this.pollTimer=setInterval((0,I.Z)(function*(){return a._poll()}),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(a,l){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[a]||(this.listeners[a]=new Set,this._get(a)),this.listeners[a].add(l)}_removeListener(a,l){this.listeners[a]&&(this.listeners[a].delete(l),0===this.listeners[a].size&&delete this.listeners[a]),0===Object.keys(this.listeners).length&&this.stopPolling()}}return c.type="LOCAL",c})();function kh(c,o){return De(c,"POST","/v2/accounts/mfaSignIn:start",Ce(c,o))}function zs(){return(zs=(0,I.Z)(function*(c){return(yield De(c,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""})).apply(this,arguments)}function Ws(c){return new Promise((o,a)=>{const l=document.createElement("script");l.setAttribute("src",c),l.onload=o,l.onerror=p=>{const y=Ue("internal-error");y.customData=p,a(y)},l.type="text/javascript",l.charset="UTF-8",function Tc(){var c,o;return null!==(o=null===(c=document.getElementsByTagName("head"))||void 0===c?void 0:c[0])&&void 0!==o?o:document}().appendChild(l)})}function Ks(c){return`__${c}${Math.floor(1e6*Math.random())}`}const Di=1e12;class xc{constructor(o){this.auth=o,this.counter=Di,this._widgets=new Map}render(o,a){const l=this.counter;return this._widgets.set(l,new $n(o,this.auth.name,a||{})),this.counter++,l}reset(o){var a;const l=o||Di;null===(a=this._widgets.get(l))||void 0===a||a.delete(),this._widgets.delete(l)}getResponse(o){var a;return(null===(a=this._widgets.get(o||Di))||void 0===a?void 0:a.getResponse())||""}execute(o){var a=this;return(0,I.Z)(function*(){var l;return null===(l=a._widgets.get(o||Di))||void 0===l||l.execute(),""})()}}class $n{constructor(o,a,l){this.params=l,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const p="string"==typeof o?document.getElementById(o):o;R(p,"argument-error",{appName:a}),this.container=p,this.isVisible="invisible"!==this.params.size,this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=function Ac(c){const o=[],a="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let l=0;l<c;l++)o.push(a.charAt(Math.floor(Math.random()*a.length)));return o.join("")}(50);const{callback:o,"expired-callback":a}=this.params;if(o)try{o(this.responseToken)}catch(l){}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,a)try{a()}catch(l){}this.isVisible&&this.execute()},6e4)},500))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}const Qs=Ks("rcb"),Sc=new ti(3e4,6e4);class Ys{constructor(){var o;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(null===(o=ke().grecaptcha)||void 0===o?void 0:o.render)}load(o,a=""){return R(function ut(c){return c.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(c)}(a),o,"argument-error"),this.shouldResolveImmediately(a)?Promise.resolve(ke().grecaptcha):new Promise((l,p)=>{const y=ke().setTimeout(()=>{p(Ue(o,"network-request-failed"))},Sc.get());ke()[Qs]=()=>{ke().clearTimeout(y),delete ke()[Qs];const T=ke().grecaptcha;if(!T)return void p(Ue(o,"internal-error"));const N=T.render;T.render=(U,j)=>{const G=N(U,j);return this.counter++,G},this.hostLanguage=a,l(T)},Ws(`https://www.google.com/recaptcha/api.js??${(0,C.xO)({onload:Qs,render:"explicit",hl:a})}`).catch(()=>{clearTimeout(y),p(Ue(o,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(o){var a;return!!(null===(a=ke().grecaptcha)||void 0===a?void 0:a.render)&&(o===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}class Dc{load(o){return(0,I.Z)(function*(){return new xc(o)})()}clearedOneInstance(){}}const Oa="recaptcha",Mr={theme:"light",type:"image"};class xh{constructor(o,a=Object.assign({},Mr),l){this.parameters=a,this.type=Oa,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=te(l),this.isInvisible="invisible"===this.parameters.size,R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment");const p="string"==typeof o?document.getElementById(o):o;R(p,this.auth,"argument-error"),this.container=p,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Dc:new Ys,this.validateStartingState()}verify(){var o=this;return(0,I.Z)(function*(){o.assertNotDestroyed();const a=yield o.render(),l=o.getAssertedRecaptcha();return l.getResponse(a)||new Promise(y=>{const v=T=>{!T||(o.tokenChangeListeners.delete(v),y(T))};o.tokenChangeListeners.add(v),o.isInvisible&&l.execute(a)})})()}render(){try{this.assertNotDestroyed()}catch(o){return Promise.reject(o)}return this.renderPromise||(this.renderPromise=this.makeRenderPromise().catch(o=>{throw this.renderPromise=null,o})),this.renderPromise}_reset(){this.assertNotDestroyed(),null!==this.widgetId&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(o=>{this.container.removeChild(o)})}validateStartingState(){R(!this.parameters.sitekey,this.auth,"argument-error"),R(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),R("undefined"!=typeof document,this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(o){return a=>{if(this.tokenChangeListeners.forEach(l=>l(a)),"function"==typeof o)o(a);else if("string"==typeof o){const l=ke()[o];"function"==typeof l&&l(a)}}}assertNotDestroyed(){R(!this.destroyed,this.auth,"internal-error")}makeRenderPromise(){var o=this;return(0,I.Z)(function*(){if(yield o.init(),!o.widgetId){let a=o.container;if(!o.isInvisible){const l=document.createElement("div");a.appendChild(l),a=l}o.widgetId=o.getAssertedRecaptcha().render(a,o.parameters)}return o.widgetId})()}init(){var o=this;return(0,I.Z)(function*(){R(ei()&&!Bn(),o.auth,"internal-error"),yield function Ah(){let c=null;return new Promise(o=>{"complete"!==document.readyState?(c=()=>o(),window.addEventListener("load",c)):o()}).catch(o=>{throw c&&window.removeEventListener("load",c),o})}(),o.recaptcha=yield o._recaptchaLoader.load(o.auth,o.auth.languageCode||void 0);const a=yield function Ci(c){return zs.apply(this,arguments)}(o.auth);R(a,o.auth,"internal-error"),o.parameters.sitekey=a})()}getAssertedRecaptcha(){return R(this.recaptcha,this.auth,"internal-error"),this.recaptcha}}class Ri{constructor(o,a){this.verificationId=o,this.onConfirmation=a}confirm(o){const a=Kt._fromVerification(this.verificationId,o);return this.onConfirmation(a)}}function Ma(){return(Ma=(0,I.Z)(function*(c,o,a){const l=te(c),p=yield Ni(l,o,(0,C.m9)(a));return new Ri(p,y=>fi(l,y))})).apply(this,arguments)}function Pa(){return(Pa=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);yield xr(!1,l,"phone");const p=yield Ni(l.auth,o,(0,C.m9)(a));return new Ri(p,y=>ac(l,y))})).apply(this,arguments)}function La(){return(La=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c),p=yield Ni(l.auth,o,(0,C.m9)(a));return new Ri(p,y=>Fn(l,y))})).apply(this,arguments)}function Ni(c,o,a){return xe.apply(this,arguments)}function xe(){return(xe=(0,I.Z)(function*(c,o,a){var l;const p=yield a.verify();try{let y;if(R("string"==typeof p,c,"argument-error"),R(a.type===Oa,c,"argument-error"),y="string"==typeof o?{phoneNumber:o}:o,"session"in y){const v=y.session;if("phoneNumber"in y)return R("enroll"===v.type,c,"internal-error"),(yield Nr(c,{idToken:v.credential,phoneEnrollmentInfo:{phoneNumber:y.phoneNumber,recaptchaToken:p}})).phoneSessionInfo.sessionInfo;{R("signin"===v.type,c,"internal-error");const T=(null===(l=y.multiFactorHint)||void 0===l?void 0:l.uid)||y.multiFactorUid;return R(T,c,"missing-multi-factor-info"),(yield kh(c,{mfaPendingCredential:v.credential,mfaEnrollmentId:T,phoneSignInInfo:{recaptchaToken:p}})).phoneResponseInfo.sessionInfo}}{const{sessionInfo:v}=yield dh(c,{phoneNumber:y.phoneNumber,recaptchaToken:p});return v}}finally{a._reset()}})).apply(this,arguments)}function Ct(){return(Ct=(0,I.Z)(function*(c,o){yield kr((0,C.m9)(c),o)})).apply(this,arguments)}let jn=(()=>{class c{constructor(a){this.providerId=c.PROVIDER_ID,this.auth=te(a)}verifyPhoneNumber(a,l){return Ni(this.auth,a,(0,C.m9)(l))}static credential(a,l){return Kt._fromVerification(a,l)}static credentialFromResult(a){return c.credentialFromTaggedObject(a)}static credentialFromError(a){return c.credentialFromTaggedObject(a.customData||{})}static credentialFromTaggedObject({_tokenResponse:a}){if(!a)return null;const{phoneNumber:l,temporaryProof:p}=a;return l&&p?Kt._fromTokenResponse(l,p):null}}return c.PROVIDER_ID="phone",c.PHONE_SIGN_IN_METHOD="phone",c})();function zn(c,o){return o?Se(o):(R(c._popupRedirectResolver,c,"argument-error"),c._popupRedirectResolver)}class D extends Ir{constructor(o){super("custom","custom"),this.params=o}_getIdTokenResponse(o){return ot(o,this._buildIdpRequest())}_linkToIdToken(o,a){return ot(o,this._buildIdpRequest(a))}_getReauthenticationResolver(o){return ot(o,this._buildIdpRequest())}_buildIdpRequest(o){const a={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return o&&(a.idToken=o),a}}function Ee(c){return pa(c.auth,new D(c),c.bypassAuthState)}function Wn(c){const{auth:o,user:a}=c;return R(a,o,"internal-error"),oc(a,new D(c),c.bypassAuthState)}function Fa(c){return F.apply(this,arguments)}function F(){return(F=(0,I.Z)(function*(c){const{auth:o,user:a}=c;return R(a,o,"internal-error"),kr(a,new D(c),c.bypassAuthState)})).apply(this,arguments)}class q{constructor(o,a,l,p,y=!1){this.auth=o,this.resolver=l,this.user=p,this.bypassAuthState=y,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(a)?a:[a]}execute(){var o=this;return new Promise(function(){var a=(0,I.Z)(function*(l,p){o.pendingPromise={resolve:l,reject:p};try{o.eventManager=yield o.resolver._initialize(o.auth),yield o.onExecution(),o.eventManager.registerConsumer(o)}catch(y){o.reject(y)}});return function(l,p){return a.apply(this,arguments)}}())}onAuthEvent(o){var a=this;return(0,I.Z)(function*(){const{urlResponse:l,sessionId:p,postBody:y,tenantId:v,error:T,type:N}=o;if(T)return void a.reject(T);const U={auth:a.auth,requestUri:l,sessionId:p,tenantId:v||void 0,postBody:y||void 0,user:a.user,bypassAuthState:a.bypassAuthState};try{a.resolve(yield a.getIdpTask(N)(U))}catch(j){a.reject(j)}})()}onError(o){this.reject(o)}getIdpTask(o){switch(o){case"signInViaPopup":case"signInViaRedirect":return Ee;case"linkViaPopup":case"linkViaRedirect":return Fa;case"reauthViaPopup":case"reauthViaRedirect":return Wn;default:oe(this.auth,"internal-error")}}resolve(o){Ie(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(o),this.unregisterAndCleanUp()}reject(o){Ie(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(o),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Ch=new ti(2e3,1e4);function E(){return(E=(0,I.Z)(function*(c,o,a){const l=te(c);Pe(c,o,At);const p=zn(l,a);return new Va(l,"signInViaPopup",o,p).executeNotNull()})).apply(this,arguments)}function Te(){return(Te=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);Pe(l.auth,o,At);const p=zn(l.auth,a);return new Va(l.auth,"reauthViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}function Ua(){return(Ua=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);Pe(l.auth,o,At);const p=zn(l.auth,a);return new Va(l.auth,"linkViaPopup",o,p,l).executeNotNull()})).apply(this,arguments)}let Va=(()=>{class c extends q{constructor(a,l,p,y,v){super(a,l,y,v),this.provider=p,this.authWindow=null,this.pollId=null,c.currentPopupAction&&c.currentPopupAction.cancel(),c.currentPopupAction=this}executeNotNull(){var a=this;return(0,I.Z)(function*(){const l=yield a.execute();return R(l,a.auth,"internal-error"),l})()}onExecution(){var a=this;return(0,I.Z)(function*(){Ie(1===a.filter.length,"Popup operations only handle one event");const l=un();a.authWindow=yield a.resolver._openPopup(a.auth,a.provider,a.filter[0],l),a.authWindow.associatedEvent=l,a.resolver._originValidation(a.auth).catch(p=>{a.reject(p)}),a.resolver._isIframeWebStorageSupported(a.auth,p=>{p||a.reject(Ue(a.auth,"web-storage-unsupported"))}),a.pollUserCancellation()})()}get eventId(){var a;return(null===(a=this.authWindow)||void 0===a?void 0:a.associatedEvent)||null}cancel(){this.reject(Ue(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,c.currentPopupAction=null}pollUserCancellation(){const a=()=>{var l,p;this.pollId=(null===(p=null===(l=this.authWindow)||void 0===l?void 0:l.window)||void 0===p?void 0:p.closed)?window.setTimeout(()=>{this.pollId=null,this.reject(Ue(this.auth,"popup-closed-by-user"))},2e3):window.setTimeout(a,Ch.get())};a()}}return c.currentPopupAction=null,c})();const Oi=new Map;class Rh extends q{constructor(o,a,l=!1){super(o,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],a,void 0,l),this.eventId=null}execute(){var o=()=>super.execute,a=this;return(0,I.Z)(function*(){let l=Oi.get(a.auth._key());if(!l){try{const y=(yield function Oc(c,o){return qa.apply(this,arguments)}(a.resolver,a.auth))?yield o().call(a):null;l=()=>Promise.resolve(y)}catch(p){l=()=>Promise.reject(p)}Oi.set(a.auth._key(),l)}return a.bypassAuthState||Oi.set(a.auth._key(),()=>Promise.resolve(null)),l()})()}onAuthEvent(o){var a=()=>super.onAuthEvent,l=this;return(0,I.Z)(function*(){if("signInViaRedirect"===o.type)return a().call(l,o);if("unknown"!==o.type){if(o.eventId){const p=yield l.auth._redirectUserForId(o.eventId);if(p)return l.user=p,a().call(l,o);l.resolve(null)}}else l.resolve(null)})()}onExecution(){return(0,I.Z)(function*(){})()}cleanUp(){}}function qa(){return(qa=(0,I.Z)(function*(c,o){const a=Za(o),l=Kn(c);if(!(yield l._isAvailable()))return!1;const p="true"===(yield l._get(a));return yield l._remove(a),p})).apply(this,arguments)}function Mc(c,o){return Ba.apply(this,arguments)}function Ba(){return(Ba=(0,I.Z)(function*(c,o){return Kn(c)._set(Za(o),"true")})).apply(this,arguments)}function z(c,o){Oi.set(c._key(),o)}function Kn(c){return Se(c._redirectPersistence)}function Za(c){return st("pendingRedirect",c.config.apiKey,c.name)}function Hn(){return(Hn=(0,I.Z)(function*(c,o,a){const l=te(c);Pe(c,o,At);const p=zn(l,a);return yield Mc(p,l),p._openRedirect(l,o,"signInViaRedirect")})).apply(this,arguments)}function me(){return(me=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);Pe(l.auth,o,At);const p=zn(l.auth,a);yield Mc(p,l.auth);const y=yield Lr(l);return p._openRedirect(l.auth,o,"reauthViaRedirect",y)})).apply(this,arguments)}function Mi(){return(Mi=(0,I.Z)(function*(c,o,a){const l=(0,C.m9)(c);Pe(l.auth,o,At);const p=zn(l.auth,a);yield xr(!1,l,o.providerId),yield Mc(p,l.auth);const y=yield Lr(l);return p._openRedirect(l.auth,o,"linkViaRedirect",y)})).apply(this,arguments)}function Ga(){return(Ga=(0,I.Z)(function*(c,o){return yield te(c)._initializationPromise,Yn(c,o,!1)})).apply(this,arguments)}function Yn(c,o){return $a.apply(this,arguments)}function $a(){return($a=(0,I.Z)(function*(c,o,a=!1){const l=te(c),p=zn(l,o),v=yield new Rh(l,p,a).execute();return v&&!a&&(delete v.user._redirectEventId,yield l._persistUserIfCurrent(v.user),yield l._setRedirectUser(null,o)),v})).apply(this,arguments)}function Lr(c){return eo.apply(this,arguments)}function eo(){return(eo=(0,I.Z)(function*(c){const o=un(`${c.uid}:::`);return c._redirectEventId=o,yield c.auth._setRedirectUser(c),yield c.auth._persistUserIfCurrent(c),o})).apply(this,arguments)}class tt{constructor(o){this.auth=o,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(o){this.consumers.add(o),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,o)&&(this.sendToConsumer(this.queuedRedirectEvent,o),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(o){this.consumers.delete(o)}onEvent(o){if(this.hasEventBeenHandled(o))return!1;let a=!1;return this.consumers.forEach(l=>{this.isEventForConsumer(o,l)&&(a=!0,this.sendToConsumer(o,l),this.saveEventToCache(o))}),this.hasHandledPotentialRedirect||!function Fc(c){switch(c.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return ja(c);default:return!1}}(o)||(this.hasHandledPotentialRedirect=!0,a||(this.queuedRedirectEvent=o,a=!0)),a}sendToConsumer(o,a){var l;if(o.error&&!ja(o)){const p=(null===(l=o.error.code)||void 0===l?void 0:l.split("auth/")[1])||"internal-error";a.onError(Ue(this.auth,p))}else a.onAuthEvent(o)}isEventForConsumer(o,a){const l=null===a.eventId||!!o.eventId&&o.eventId===a.eventId;return a.filter.includes(o.type)&&l}hasEventBeenHandled(o){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(to(o))}saveEventToCache(o){this.cachedEventUids.add(to(o)),this.lastProcessedEventTime=Date.now()}}function to(c){return[c.type,c.eventId,c.sessionId,c.tenantId].filter(o=>o).join("-")}function ja({type:c,error:o}){return"unknown"===c&&"auth/no-auth-event"===(null==o?void 0:o.code)}function Jt(c){return Pi.apply(this,arguments)}function Pi(){return(Pi=(0,I.Z)(function*(c,o={}){return De(c,"GET","/v1/projects",o)})).apply(this,arguments)}const b=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,no=/^https?/;function za(){return(za=(0,I.Z)(function*(c){if(c.config.emulator)return;const{authorizedDomains:o}=yield Jt(c);for(const a of o)try{if(Li(a))return}catch(l){}oe(c,"unauthorized-domain")})).apply(this,arguments)}function Li(c){const o=Xr(),{protocol:a,hostname:l}=new URL(o);if(c.startsWith("chrome-extension://")){const v=new URL(c);return""===v.hostname&&""===l?"chrome-extension:"===a&&c.replace("chrome-extension://","")===o.replace("chrome-extension://",""):"chrome-extension:"===a&&v.hostname===l}if(!no.test(a))return!1;if(b.test(c))return l===c;const p=c.replace(/\./g,"\\.");return new RegExp("^(.+\\."+p+"|"+p+")$","i").test(l)}const cn=new ti(3e4,6e4);function Uc(){const c=ke().___jsl;if(null==c?void 0:c.H)for(const o of Object.keys(c.H))if(c.H[o].r=c.H[o].r||[],c.H[o].L=c.H[o].L||[],c.H[o].r=[...c.H[o].L],c.CP)for(let a=0;a<c.CP.length;a++)c.CP[a]=null}let Fi=null;function Wa(c){return Fi=Fi||function Jn(c){return new Promise((o,a)=>{var l,p,y;function v(){Uc(),gapi.load("gapi.iframes",{callback:()=>{o(gapi.iframes.getContext())},ontimeout:()=>{Uc(),a(Ue(c,"network-request-failed"))},timeout:cn.get()})}if(null===(p=null===(l=ke().gapi)||void 0===l?void 0:l.iframes)||void 0===p?void 0:p.Iframe)o(gapi.iframes.getContext());else{if(!(null===(y=ke().gapi)||void 0===y?void 0:y.load)){const T=Ks("iframefcb");return ke()[T]=()=>{gapi.load?v():a(Ue(c,"network-request-failed"))},Ws(`https://apis.google.com/js/api.js?onload=${T}`).catch(N=>a(N))}v()}}).catch(o=>{throw Fi=null,o})}(c),Fi}const Oh=new ti(5e3,15e3),Ph={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},ln=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Vc(c){const o=c.config;R(o.authDomain,c,"auth-domain-config-required");const a=o.emulator?Bo(o,"emulator/auth/iframe"):`https://${c.config.authDomain}/__/auth/iframe`,l={apiKey:o.apiKey,appName:c.name,v:k.SDK_VERSION},p=ln.get(c.config.apiHost);p&&(l.eid=p);const y=c._getFrameworks();return y.length&&(l.fw=y.join(",")),`${a}?${(0,C.xO)(l).slice(1)}`}function ro(){return ro=(0,I.Z)(function*(c){const o=yield Wa(c),a=ke().gapi;return R(a,c,"internal-error"),o.open({where:document.body,url:Vc(c),messageHandlersFilter:a.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ph,dontclear:!0},l=>new Promise(function(){var p=(0,I.Z)(function*(y,v){yield l.restyle({setHideOnLeave:!1});const T=Ue(c,"network-request-failed"),N=ke().setTimeout(()=>{v(T)},Oh.get());function U(){ke().clearTimeout(N),y(l)}l.ping(U).then(U,()=>{v(T)})});return function(y,v){return p.apply(this,arguments)}}()))}),ro.apply(this,arguments)}const Ui={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Bc{constructor(o){this.window=o,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(o){}}}function io(c,o,a,l,p,y){R(c.config.authDomain,c,"auth-domain-config-required"),R(c.config.apiKey,c,"invalid-api-key");const v={apiKey:c.config.apiKey,appName:c.name,authType:a,redirectUrl:l,v:k.SDK_VERSION,eventId:p};if(o instanceof At){o.setDefaultLanguage(c.languageCode),v.providerId=o.providerId||"",(0,C.xb)(o.getCustomParameters())||(v.customParameters=JSON.stringify(o.getCustomParameters()));for(const[N,U]of Object.entries(y||{}))v[N]=U}if(o instanceof sn){const N=o.getScopes().filter(U=>""!==U);N.length>0&&(v.scopes=N.join(","))}c.tenantId&&(v.tid=c.tenantId);const T=v;for(const N of Object.keys(T))void 0===T[N]&&delete T[N];return`${function qi({config:c}){return c.emulator?Bo(c,"emulator/auth/handler"):`https://${c.authDomain}/__/auth/handler`}(c)}?${(0,C.xO)(T).slice(1)}`}const Dt="webStorageSupport";class tr extends class Rt{constructor(o){this.factorId=o}_process(o,a,l){switch(a.type){case"enroll":return this._finalizeEnroll(o,a.credential,l);case"signin":return this._finalizeSignIn(o,a.credential);default:return it("unexpected MultiFactorSessionType")}}}{constructor(o){super("phone"),this.credential=o}static _fromCredential(o){return new tr(o)}_finalizeEnroll(o,a,l){return function vh(c,o){return De(c,"POST","/v2/accounts/mfaEnrollment:finalize",Ce(c,o))}(o,{idToken:a,displayName:l,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(o,a){return function Ec(c,o){return De(c,"POST","/v2/accounts/mfaSignIn:finalize",Ce(c,o))}(o,{mfaPendingCredential:a,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}let fn=(()=>{class c{constructor(){}static assertion(a){return tr._fromCredential(a)}}return c.FACTOR_ID="phone",c})();var Ha="@firebase/auth";class Qa{constructor(o){this.auth=o,this.internalListeners=new Map}getUid(){var o;return this.assertAuthConfigured(),(null===(o=this.auth.currentUser)||void 0===o?void 0:o.uid)||null}getToken(o){var a=this;return(0,I.Z)(function*(){return a.assertAuthConfigured(),yield a.auth._initializationPromise,a.auth.currentUser?{accessToken:yield a.auth.currentUser.getIdToken(o)}:null})()}addAuthTokenListener(o){if(this.assertAuthConfigured(),this.internalListeners.has(o))return;const a=this.auth.onIdTokenChanged(l=>{o((null==l?void 0:l.stsTokenManager.accessToken)||null)});this.internalListeners.set(o,a),this.updateProactiveRefresh()}removeAuthTokenListener(o){this.assertAuthConfigured();const a=this.internalListeners.get(o);!a||(this.internalListeners.delete(o),a(),this.updateProactiveRefresh())}assertAuthConfigured(){R(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function pn(){return window}function uo(){return(uo=(0,I.Z)(function*(c,o,a){var l;const{BuildInfo:p}=pn();Ie(o.sessionId,"AuthEvent did not contain a session ID");const y=yield ae(o.sessionId),v={};return jt()?v.ibi=p.packageName:On()?v.apn=p.packageName:oe(c,"operation-not-supported-in-this-environment"),p.displayName&&(v.appDisplayName=p.displayName),v.sessionId=y,io(c,a,o.type,void 0,null!==(l=o.eventId)&&void 0!==l?l:void 0,v)})).apply(this,arguments)}function Nt(){return(Nt=(0,I.Z)(function*(c){const{BuildInfo:o}=pn(),a={};jt()?a.iosBundleId=o.packageName:On()?a.androidPackageName=o.packageName:oe(c,"operation-not-supported-in-this-environment"),yield Jt(c,a)})).apply(this,arguments)}function co(){return(co=(0,I.Z)(function*(c,o,a){const{cordova:l}=pn();let p=()=>{};try{yield new Promise((y,v)=>{let T=null;function N(){var G;y();const Ne=null===(G=l.plugins.browsertab)||void 0===G?void 0:G.close;"function"==typeof Ne&&Ne(),"function"==typeof(null==a?void 0:a.close)&&a.close()}function U(){T||(T=window.setTimeout(()=>{v(Ue(c,"redirect-cancelled-by-user"))},2e3))}function j(){"visible"===(null==document?void 0:document.visibilityState)&&U()}o.addPassiveListener(N),document.addEventListener("resume",U,!1),On()&&document.addEventListener("visibilitychange",j,!1),p=()=>{o.removePassiveListener(N),document.removeEventListener("resume",U,!1),document.removeEventListener("visibilitychange",j,!1),T&&window.clearTimeout(T)}})}finally{p()}})).apply(this,arguments)}function ae(c){return mn.apply(this,arguments)}function mn(){return(mn=(0,I.Z)(function*(c){const o=Xa(c),a=yield crypto.subtle.digest("SHA-256",o);return Array.from(new Uint8Array(a)).map(p=>p.toString(16).padStart(2,"0")).join("")})).apply(this,arguments)}function Xa(c){if(Ie(/[0-9a-zA-Z]+/.test(c),"Can only convert alpha-numeric strings"),"undefined"!=typeof TextEncoder)return(new TextEncoder).encode(c);const o=new ArrayBuffer(c.length),a=new Uint8Array(o);for(let l=0;l<c.length;l++)a[l]=c.charCodeAt(l);return a}(0,C.Pz)("authIdTokenMaxAge"),function Ya(c){(0,k._registerComponent)(new fr.wA("auth",(o,{options:a})=>{const l=o.getProvider("app").getImmediate(),p=o.getProvider("heartbeat"),{apiKey:y,authDomain:v}=l.options;return((T,N)=>{R(y&&!y.includes(":"),"invalid-api-key",{appName:T.name}),R(!(null==v?void 0:v.includes(":")),"argument-error",{appName:T.name});const U={apiKey:y,authDomain:v,clientPlatform:c,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yu(c)},j=new ls(T,N,U);return function qo(c,o){const a=(null==o?void 0:o.persistence)||[],l=(Array.isArray(a)?a:[a]).map(Se);(null==o?void 0:o.errorMap)&&c._updateErrorMap(o.errorMap),c._initializeWithPersistence(l,null==o?void 0:o.popupRedirectResolver)}(j,a),j})(l,p)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((o,a,l)=>{o.getProvider("auth-internal").initialize()})),(0,k._registerComponent)(new fr.wA("auth-internal",o=>{const a=te(o.getProvider("auth").getImmediate());return new Qa(a)},"PRIVATE").setInstantiationMode("EXPLICIT")),(0,k.registerVersion)(Ha,"0.21.0",function rr(c){switch(c){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(c)),(0,k.registerVersion)(Ha,"0.21.0","esm2017")}("Browser");class Wc extends tt{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(o=>{this.resolveInialized=o})}addPassiveListener(o){this.passiveListeners.add(o)}removePassiveListener(o){this.passiveListeners.delete(o)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(o){return this.resolveInialized(),this.passiveListeners.forEach(a=>a(o)),super.onEvent(o)}initialized(){var o=this;return(0,I.Z)(function*(){yield o.initPromise})()}}function eu(c){return lo.apply(this,arguments)}function lo(){return(lo=(0,I.Z)(function*(c){const o=yield tu()._get(ho(c));return o&&(yield tu()._remove(ho(c))),o})).apply(this,arguments)}function qh(){const c=[],o="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let a=0;a<20;a++){const l=Math.floor(Math.random()*o.length);c.push(o.charAt(l))}return c.join("")}function tu(){return Se(Zs)}function ho(c){return st("authEvent",c.config.apiKey,c.name)}function fo(c){if(!(null==c?void 0:c.includes("?")))return{};const[o,...a]=c.split("?");return(0,C.zd)(a.join("?"))}function ye(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:Ue("no-auth-event")}}function Ot(){var c;return(null===(c=null==self?void 0:self.location)||void 0===c?void 0:c.protocol)||null}function Fe(c=(0,C.z$)()){return!("file:"!==Ot()&&"ionic:"!==Ot()&&"capacitor:"!==Ot()||!c.toLowerCase().match(/iphone|ipad|ipod|android/))}function gn(){try{const c=self.localStorage,o=un();if(c)return c.setItem(o,"1"),c.removeItem(o),!function nu(c=(0,C.z$)()){return function he(){return(0,C.w1)()&&11===(null==document?void 0:document.documentMode)}()||function $h(c=(0,C.z$)()){return/Edge\/\d+/.test(c)}(c)}()||(0,C.hl)()}catch(c){return ir()&&(0,C.hl)()}return!1}function ir(){return"undefined"!=typeof global&&"WorkerGlobalScope"in global&&"importScripts"in global}function Ur(){return(function lt(){return"http:"===Ot()||"https:"===Ot()}()||(0,C.ru)()||Fe())&&!function Jc(){return(0,C.b$)()||(0,C.UG)()}()&&gn()&&!ir()}function Zi(){return Fe()&&"undefined"!=typeof document}function mo(){return(mo=(0,I.Z)(function*(){return!!Zi()&&new Promise(c=>{const o=setTimeout(()=>{c(!1)},1e3);document.addEventListener("deviceready",()=>{clearTimeout(o),c(!0)})})})).apply(this,arguments)}const nt={LOCAL:"local",NONE:"none",SESSION:"session"},Mt=R,ru="persistence";function Vr(c){return Gi.apply(this,arguments)}function Gi(){return(Gi=(0,I.Z)(function*(c){yield c._initializationPromise;const o=ze(),a=st(ru,c.config.apiKey,c.name);o&&o.setItem(a,c._getPersistence())})).apply(this,arguments)}function ze(){var c;try{return(null===(c=function Xt(){return"undefined"!=typeof window?window:null}())||void 0===c?void 0:c.sessionStorage)||null}catch(o){return null}}const su=R;class bt{constructor(){this.browserResolver=Se(class so{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=an,this._completeRedirectFn=Yn,this._overrideRedirectResult=z}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){var v;Ie(null===(v=y.eventManagers[o._key()])||void 0===v?void 0:v.manager,"_initialize() not called before _openPopup()");const T=io(o,a,l,Xr(),p);return function hn(c,o,a,l=500,p=600){const y=Math.max((window.screen.availHeight-p)/2,0).toString(),v=Math.max((window.screen.availWidth-l)/2,0).toString();let T="";const N=Object.assign(Object.assign({},Ui),{width:l.toString(),height:p.toString(),top:y,left:v}),U=(0,C.z$)().toLowerCase();a&&(T=Tt(U)?"_blank":a),ie(U)&&(o=o||"http://localhost",N.scrollbars="yes");const j=Object.entries(N).reduce((Ne,[gt,en])=>`${Ne}${gt}=${en},`,"");if(function ah(c=(0,C.z$)()){var o;return jt(c)&&!!(null===(o=window.navigator)||void 0===o?void 0:o.standalone)}(U)&&"_self"!==T)return function we(c,o){const a=document.createElement("a");a.href=c,a.target=o;const l=document.createEvent("MouseEvent");l.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),a.dispatchEvent(l)}(o||"",T),new Bc(null);const G=window.open(o||"",T,j);R(G,c,"popup-blocked");try{G.focus()}catch(Ne){}return new Bc(G)}(o,T,un())})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y._originValidation(o),function Ai(c){ke().location.href=c}(io(o,a,l,Xr(),p)),new Promise(()=>{})})()}_initialize(o){const a=o._key();if(this.eventManagers[a]){const{manager:p,promise:y}=this.eventManagers[a];return p?Promise.resolve(p):(Ie(y,"If manager is not set, promise should be"),y)}const l=this.initAndGetManager(o);return this.eventManagers[a]={promise:l},l.catch(()=>{delete this.eventManagers[a]}),l}initAndGetManager(o){var a=this;return(0,I.Z)(function*(){const l=yield function Xn(c){return ro.apply(this,arguments)}(o),p=new tt(o);return l.register("authEvent",y=>(R(null==y?void 0:y.authEvent,o,"invalid-auth-event"),{status:p.onEvent(y.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),a.eventManagers[o._key()]={manager:p},a.iframes[o._key()]=l,p})()}_isIframeWebStorageSupported(o,a){this.iframes[o._key()].send(Dt,{type:Dt},p=>{var y;const v=null===(y=null==p?void 0:p[0])||void 0===y?void 0:y[Dt];void 0!==v&&a(!!v),oe(o,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function wt(c){return za.apply(this,arguments)}(o)),this.originValidationPromises[a]}get _shouldInitProactively(){return Qu()||Yo()||jt()}}),this.cordovaResolver=Se(class Fr{constructor(){this._redirectPersistence=an,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=Yn,this._overrideRedirectResult=z}_initialize(o){var a=this;return(0,I.Z)(function*(){const l=o._key();let p=a.eventManagers.get(l);return p||(p=new Wc(o),a.eventManagers.set(l,p),a.attachCallbackListeners(o,p)),p})()}_openPopup(o){oe(o,"operation-not-supported-in-this-environment")}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){!function J(c){var o,a,l,p,y,v,T,N,U,j;const G=pn();R("function"==typeof(null===(o=null==G?void 0:G.universalLinks)||void 0===o?void 0:o.subscribe),c,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),R(void 0!==(null===(a=null==G?void 0:G.BuildInfo)||void 0===a?void 0:a.packageName),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),R("function"==typeof(null===(y=null===(p=null===(l=null==G?void 0:G.cordova)||void 0===l?void 0:l.plugins)||void 0===p?void 0:p.browsertab)||void 0===y?void 0:y.openUrl),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(N=null===(T=null===(v=null==G?void 0:G.cordova)||void 0===v?void 0:v.plugins)||void 0===T?void 0:T.browsertab)||void 0===N?void 0:N.isAvailable),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),R("function"==typeof(null===(j=null===(U=null==G?void 0:G.cordova)||void 0===U?void 0:U.InAppBrowser)||void 0===j?void 0:j.open),c,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}(o);const v=yield y._initialize(o);yield v.initialized(),v.resetRedirect(),function Pc(){Oi.clear()}(),yield y._originValidation(o);const T=function Kc(c,o,a=null){return{type:o,eventId:a,urlResponse:null,sessionId:qh(),postBody:null,tenantId:c.tenantId,error:Ue(c,"no-auth-event")}}(o,l,p);yield function Hc(c,o){return tu()._set(ho(c),o)}(o,T);const N=yield function Uh(c,o,a){return uo.apply(this,arguments)}(o,T,a),U=yield function $c(c){const{cordova:o}=pn();return new Promise(a=>{o.plugins.browsertab.isAvailable(l=>{let p=null;l?o.plugins.browsertab.openUrl(c):p=o.InAppBrowser.open(c,function ii(c=(0,C.z$)()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(c)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(c)}()?"_blank":"_system","location=yes"),a(p)})})}(N);return function jc(c,o,a){return co.apply(this,arguments)}(o,v,U)})()}_isIframeWebStorageSupported(o,a){throw new Error("Method not implemented.")}_originValidation(o){const a=o._key();return this.originValidationPromises[a]||(this.originValidationPromises[a]=function Gc(c){return Nt.apply(this,arguments)}(o)),this.originValidationPromises[a]}attachCallbackListeners(o,a){const{universalLinks:l,handleOpenURL:p,BuildInfo:y}=pn(),v=setTimeout((0,I.Z)(function*(){yield eu(o),a.onEvent(ye())}),500),T=function(){var j=(0,I.Z)(function*(G){clearTimeout(v);const Ne=yield eu(o);let gt=null;Ne&&(null==G?void 0:G.url)&&(gt=function Vh(c,o){var a,l;const p=function Qc(c){const o=fo(c),a=o.link?decodeURIComponent(o.link):void 0,l=fo(a).link,p=o.deep_link_id?decodeURIComponent(o.deep_link_id):void 0;return fo(p).link||p||l||a||c}(o);if(p.includes("/__/auth/callback")){const y=fo(p),v=y.firebaseError?function Bh(c){try{return JSON.parse(c)}catch(o){return null}}(decodeURIComponent(y.firebaseError)):null,T=null===(l=null===(a=null==v?void 0:v.code)||void 0===a?void 0:a.split("auth/"))||void 0===l?void 0:l[1],N=T?Ue(T):null;return N?{type:c.type,eventId:c.eventId,tenantId:c.tenantId,error:N,urlResponse:null,sessionId:null,postBody:null}:{type:c.type,eventId:c.eventId,tenantId:c.tenantId,sessionId:c.sessionId,urlResponse:p,postBody:null}}return null}(Ne,G.url)),a.onEvent(gt||ye())});return function(Ne){return j.apply(this,arguments)}}();void 0!==l&&"function"==typeof l.subscribe&&l.subscribe(null,T);const N=p,U=`${y.packageName.toLowerCase()}://`;pn().handleOpenURL=function(){var j=(0,I.Z)(function*(G){if(G.toLowerCase().startsWith(U)&&T({url:G}),"function"==typeof N)try{N(G)}catch(Ne){console.error(Ne)}});return function(G){return j.apply(this,arguments)}}()}}),this.underlyingResolver=null,this._redirectPersistence=an,this._completeRedirectFn=Yn,this._overrideRedirectResult=z}_initialize(o){var a=this;return(0,I.Z)(function*(){return yield a.selectUnderlyingResolver(),a.assertedUnderlyingResolver._initialize(o)})()}_openPopup(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openPopup(o,a,l,p)})()}_openRedirect(o,a,l,p){var y=this;return(0,I.Z)(function*(){return yield y.selectUnderlyingResolver(),y.assertedUnderlyingResolver._openRedirect(o,a,l,p)})()}_isIframeWebStorageSupported(o,a){this.assertedUnderlyingResolver._isIframeWebStorageSupported(o,a)}_originValidation(o){return this.assertedUnderlyingResolver._originValidation(o)}get _shouldInitProactively(){return Zi()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return su(this.underlyingResolver,"internal-error"),this.underlyingResolver}selectUnderlyingResolver(){var o=this;return(0,I.Z)(function*(){if(o.underlyingResolver)return;const a=yield function Xc(){return mo.apply(this,arguments)}();o.underlyingResolver=a?o.cordovaResolver:o.browserResolver})()}}function qr(c){return c.unwrap()}function ou(c){return uu(c)}function uu(c){const{_tokenResponse:o}=c instanceof C.ZR?c.customData:c;if(!o)return null;if(!(c instanceof C.ZR)&&"temporaryProof"in o&&"phoneNumber"in o)return jn.credentialFromResult(c);const a=o.providerId;if(!a||"password"===a)return null;let l;switch(a){case"google.com":l=bs;break;case"facebook.com":l=tc;break;case"github.com":l=Es;break;case"twitter.com":l=Ts;break;default:const{oauthIdToken:p,oauthAccessToken:y,oauthTokenSecret:v,pendingToken:T,nonce:N}=o;return y||v||p||T?T?a.startsWith("saml.")?ge._create(a,T):xt._fromParams({providerId:a,signInMethod:a,pendingToken:T,idToken:p,accessToken:y}):new Mn(a).credential({idToken:p,accessToken:y,rawNonce:N}):null}return c instanceof C.ZR?l.credentialFromError(c):l.credentialFromResult(c)}function Ye(c,o){return o.catch(a=>{throw a instanceof C.ZR&&function au(c,o){var a;const l=null===(a=o.customData)||void 0===a?void 0:a._tokenResponse;if("auth/multi-factor-auth-required"===(null==o?void 0:o.code))o.resolver=new tl(c,function mc(c,o){var a;const l=(0,C.m9)(c),p=o;return R(o.customData.operationType,l,"argument-error"),R(null===(a=p.customData._serverResponse)||void 0===a?void 0:a.mfaPendingCredential,l,"argument-error"),Vs._fromError(l,p)}(c,o));else if(l){const p=uu(o),y=o;p&&(y.credential=p,y.tenantId=l.tenantId||void 0,y.email=l.email||void 0,y.phoneNumber=l.phoneNumber||void 0)}}(c,a),a}).then(a=>{const p=a.user;return{operationType:a.operationType,credential:ou(a),additionalUserInfo:Ti(a),user:Pt.getOrCreate(p)}})}function cu(c,o){return go.apply(this,arguments)}function go(){return(go=(0,I.Z)(function*(c,o){const a=yield o;return{verificationId:a.verificationId,confirm:l=>Ye(c,a.confirm(l))}})).apply(this,arguments)}class tl{constructor(o,a){this.resolver=a,this.auth=function el(c){return c.wrapped()}(o)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(o){return Ye(qr(this.auth),this.resolver.resolveSignIn(o))}}class Pt{constructor(o){this._delegate=o,this.multiFactor=function gc(c){const o=(0,C.m9)(c);return ka.has(o)||ka.set(o,qs._fromUser(o)),ka.get(o)}(o)}static getOrCreate(o){return Pt.USER_MAP.has(o)||Pt.USER_MAP.set(o,new Pt(o)),Pt.USER_MAP.get(o)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(o){return this._delegate.getIdTokenResult(o)}getIdToken(o){return this._delegate.getIdToken(o)}linkAndRetrieveDataWithCredential(o){return this.linkWithCredential(o)}linkWithCredential(o){var a=this;return(0,I.Z)(function*(){return Ye(a.auth,ac(a._delegate,o))})()}linkWithPhoneNumber(o,a){var l=this;return(0,I.Z)(function*(){return cu(l.auth,function Rc(c,o,a){return Pa.apply(this,arguments)}(l._delegate,o,a))})()}linkWithPopup(o){var a=this;return(0,I.Z)(function*(){return Ye(a.auth,function Nc(c,o,a){return Ua.apply(this,arguments)}(a._delegate,o,bt))})()}linkWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Vr(te(a.auth)),function O(c,o,a){return function Xs(c,o,a){return Mi.apply(this,arguments)}(c,o,a)}(a._delegate,o,bt)})()}reauthenticateAndRetrieveDataWithCredential(o){return this.reauthenticateWithCredential(o)}reauthenticateWithCredential(o){var a=this;return(0,I.Z)(function*(){return Ye(a.auth,Fn(a._delegate,o))})()}reauthenticateWithPhoneNumber(o,a){return cu(this.auth,function Js(c,o,a){return La.apply(this,arguments)}(this._delegate,o,a))}reauthenticateWithPopup(o){return Ye(this.auth,function A(c,o,a){return Te.apply(this,arguments)}(this._delegate,o,bt))}reauthenticateWithRedirect(o){var a=this;return(0,I.Z)(function*(){return yield Vr(te(a.auth)),function ne(c,o,a){return function Nh(c,o,a){return me.apply(this,arguments)}(c,o,a)}(a._delegate,o,bt)})()}sendEmailVerification(o){return function gh(c,o){return Vn.apply(this,arguments)}(this._delegate,o)}unlink(o){var a=this;return(0,I.Z)(function*(){return yield function sc(c,o){return fa.apply(this,arguments)}(a._delegate,o),a})()}updateEmail(o){return function yh(c,o){return Ea((0,C.m9)(c),o,null)}(this._delegate,o)}updatePassword(o){return function dc(c,o){return Ea((0,C.m9)(c),null,o)}(this._delegate,o)}updatePhoneNumber(o){return function Pr(c,o){return Ct.apply(this,arguments)}(this._delegate,o)}updateProfile(o){return function wa(c,o){return ba.apply(this,arguments)}(this._delegate,o)}verifyBeforeUpdateEmail(o,a){return function hc(c,o,a){return Rr.apply(this,arguments)}(this._delegate,o,a)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Pt.USER_MAP=new WeakMap;const yn=R;let nl=(()=>{class c{constructor(a,l){if(this.app=a,l.isInitialized())return this._delegate=l.getImmediate(),void this.linkUnderlyingAuth();const{apiKey:p}=a.options;yn(p,"invalid-api-key",{appName:a.name}),yn(p,"invalid-api-key",{appName:a.name});const y="undefined"!=typeof window?bt:void 0;this._delegate=l.initialize({options:{persistence:il(p,a.name),popupRedirectResolver:y}}),this._delegate._updateErrorMap(Jr),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Pt.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(a){this._delegate.languageCode=a}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(a){this._delegate.tenantId=a}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(a,l){!function Ju(c,o,a){const l=te(c);R(l._canInitEmulator,l,"emulator-config-failed"),R(/^https?:\/\//.test(o),l,"invalid-emulator-scheme");const p=!!(null==a?void 0:a.disableWarnings),y=Xo(o),{host:v,port:T}=function ea(c){const o=Xo(c),a=/(\/\/)?([^?#/]+)/.exec(c.substr(o.length));if(!a)return{host:"",port:null};const l=a[2].split("@").pop()||"",p=/^(\[[^\]]+\])(:|$)/.exec(l);if(p){const y=p[1];return{host:y,port:ta(l.substr(y.length+1))}}{const[y,v]=l.split(":");return{host:y,port:ta(v)}}}(o);l.config.emulator={url:`${y}//${v}${null===T?"":`:${T}`}/`},l.settings.appVerificationDisabledForTesting=!0,l.emulatorConfig=Object.freeze({host:v,port:T,protocol:y.replace(":",""),options:Object.freeze({disableWarnings:p})}),p||function je(){function c(){const o=document.createElement("p"),a=o.style;o.innerText="Running in emulator mode. Do not use with production credentials.",a.position="fixed",a.width="100%",a.backgroundColor="#ffffff",a.border=".1em solid #000000",a.color="#b50000",a.bottom="0px",a.left="0px",a.margin="0px",a.zIndex="10000",a.textAlign="center",o.classList.add("firebase-emulator-warning"),document.body.appendChild(o)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",c):c())}()}(this._delegate,a,l)}applyActionCode(a){return function cc(c,o){return yi.apply(this,arguments)}(this._delegate,a)}checkActionCode(a){return ya(this._delegate,a)}confirmPasswordReset(a,l){return function gi(c,o,a){return Cr.apply(this,arguments)}(this._delegate,a,l)}createUserWithEmailAndPassword(a,l){var p=this;return(0,I.Z)(function*(){return Ye(p._delegate,function _a(c,o,a){return Ii.apply(this,arguments)}(p._delegate,a,l))})()}fetchProvidersForEmail(a){return this.fetchSignInMethodsForEmail(a)}fetchSignInMethodsForEmail(a){return function lc(c,o){return Ms.apply(this,arguments)}(this._delegate,a)}isSignInWithEmailLink(a){return function mh(c,o){const a=Er.parseLink(o);return"EMAIL_SIGNIN"===(null==a?void 0:a.operation)}(0,a)}getRedirectResult(){var a=this;return(0,I.Z)(function*(){yn(Ur(),a._delegate,"operation-not-supported-in-this-environment");const l=yield function Qn(c,o){return Ga.apply(this,arguments)}(a._delegate,bt);return l?Ye(a._delegate,Promise.resolve(l)):{credential:null,user:null}})()}addFrameworkForLogging(a){!function po(c,o){te(c)._logFramework(o)}(this._delegate,a)}onAuthStateChanged(a,l,p){const{next:y,error:v,complete:T}=rl(a,l,p);return this._delegate.onAuthStateChanged(y,v,T)}onIdTokenChanged(a,l,p){const{next:y,error:v,complete:T}=rl(a,l,p);return this._delegate.onIdTokenChanged(y,v,T)}sendSignInLinkToEmail(a,l){return function wi(c,o,a){return Ns.apply(this,arguments)}(this._delegate,a,l)}sendPasswordResetEmail(a,l){return function Qe(c,o,a){return Cs.apply(this,arguments)}(this._delegate,a,l||void 0)}setPersistence(a){var l=this;return(0,I.Z)(function*(){let p;switch(function iu(c,o){Mt(Object.values(nt).includes(o),c,"invalid-persistence-type"),(0,C.b$)()?Mt(o!==nt.SESSION,c,"unsupported-persistence-type"):(0,C.UG)()?Mt(o===nt.NONE,c,"unsupported-persistence-type"):ir()?Mt(o===nt.NONE||o===nt.LOCAL&&(0,C.hl)(),c,"unsupported-persistence-type"):Mt(o===nt.NONE||gn(),c,"unsupported-persistence-type")}(l._delegate,a),a){case nt.SESSION:p=an;break;case nt.LOCAL:p=(yield Se(Yt)._isAvailable())?Yt:Zs;break;case nt.NONE:p=vr;break;default:return oe("argument-error",{appName:l._delegate.name})}return l._delegate.setPersistence(p)})()}signInAndRetrieveDataWithCredential(a){return this.signInWithCredential(a)}signInAnonymously(){return Ye(this._delegate,function fh(c){return ks.apply(this,arguments)}(this._delegate))}signInWithCredential(a){return Ye(this._delegate,fi(this._delegate,a))}signInWithCustomToken(a){return Ye(this._delegate,function uc(c,o){return Sr.apply(this,arguments)}(this._delegate,a))}signInWithEmailAndPassword(a,l){return Ye(this._delegate,function Rs(c,o,a){return fi((0,C.m9)(c),ws.credential(o,a))}(this._delegate,a,l))}signInWithEmailLink(a,l){return Ye(this._delegate,function va(c,o,a){return Dr.apply(this,arguments)}(this._delegate,a,l))}signInWithPhoneNumber(a,l){return cu(this._delegate,function Sh(c,o,a){return Ma.apply(this,arguments)}(this._delegate,a,l))}signInWithPopup(a){var l=this;return(0,I.Z)(function*(){return yn(Ur(),l._delegate,"operation-not-supported-in-this-environment"),Ye(l._delegate,function P(c,o,a){return E.apply(this,arguments)}(l._delegate,a,bt))})()}signInWithRedirect(a){var l=this;return(0,I.Z)(function*(){return yn(Ur(),l._delegate,"operation-not-supported-in-this-environment"),yield Vr(l._delegate),function pe(c,o,a){return function $(c,o,a){return Hn.apply(this,arguments)}(c,o,a)}(l._delegate,a,bt)})()}updateCurrentUser(a){return this._delegate.updateCurrentUser(a)}verifyPasswordResetCode(a){return function _i(c,o){return vi.apply(this,arguments)}(this._delegate,a)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}return c.Persistence=nt,c})();function rl(c,o,a){let l=c;"function"!=typeof c&&({next:l,error:o,complete:a}=c);const p=l;return{next:v=>p(v&&Pt.getOrCreate(v)),error:o,complete:a}}function il(c,o){const a=function sr(c,o){const a=ze();if(!a)return[];const l=st(ru,c,o);switch(a.getItem(l)){case nt.NONE:return[vr];case nt.LOCAL:return[Yt,an];case nt.SESSION:return[an];default:return[]}}(c,o);if("undefined"!=typeof self&&!a.includes(Yt)&&a.push(Yt),"undefined"!=typeof window)for(const l of[Zs,an])a.includes(l)||a.push(l);return a.includes(vr)||a.push(vr),a}class _n{constructor(){this.providerId="phone",this._delegate=new jn(qr(Et.Z.auth()))}static credential(o,a){return jn.credential(o,a)}verifyPhoneNumber(o,a){return this._delegate.verifyPhoneNumber(o,a)}unwrap(){return this._delegate}}_n.PHONE_SIGN_IN_METHOD=jn.PHONE_SIGN_IN_METHOD,_n.PROVIDER_ID=jn.PROVIDER_ID;const or=R;class sl{constructor(o,a,l=Et.Z.app()){var p;or(null===(p=l.options)||void 0===p?void 0:p.apiKey,"invalid-api-key",{appName:l.name}),this._delegate=new xh(o,a,l.auth()),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}!function ol(c){c.INTERNAL.registerComponent(new fr.wA("auth-compat",o=>{const a=o.getProvider("app-compat").getImmediate(),l=o.getProvider("auth");return new nl(a,l)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},EmailAuthProvider:ws,FacebookAuthProvider:tc,GithubAuthProvider:Es,GoogleAuthProvider:bs,OAuthProvider:Mn,SAMLAuthProvider:Pn,PhoneAuthProvider:_n,PhoneMultiFactorGenerator:fn,RecaptchaVerifier:sl,TwitterAuthProvider:Ts,Auth:nl,AuthCredential:Ir,Error:C.ZR}).setInstantiationMode("LAZY").setMultipleInstances(!1)),c.registerVersion("@firebase/auth-compat","0.3.0")}(Et.Z)}}]);